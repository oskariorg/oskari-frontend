"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var l=0;l<t.length;l++){var i=t[l];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,l,i){return l&&e(t.prototype,l),i&&e(t,i),t}}();!function(e,t){"function"==typeof define&&define.amd?define(["exports"],t):t("object"==typeof exports?exports:e)}(window,function(e){var t="smartSelect",l={toggleButton:!1,wrapperClass:"ms-parent",textStandard:"Placeholder",textCountSelected:"%d Selected",textAllSelected:"All selected",textSelectAll:"Select all",textUnselectAll:"Unselect all"},i=function(){function e(t,i){_classCallCheck(this,e),this.el="string"==typeof t?document.querySelector(t):t,this.container="",this.button="",this.dropdown="",this.changeListener=!0,this.selectedValue=[],this.options=this._helperExtend(l,i),this._defaults={multiple:!1},this._defaults.multiple=!!this.el.hasAttribute("multiple"),this._resetSelectedValue(),this._buildElement(),this._defineEvents(),this._listener("bind"),this._syncOption()}return _createClass(e,[{key:"_buildElement",value:function(){this.container=document.createElement("div"),this.container.className=this.options.wrapperClass,this.button=document.createElement("button"),this.button.className="ms-choice",this.button.appendChild(document.createElement("span")),this.button.appendChild(document.createElement("div")),this.dropdown=document.createElement("div"),this.dropdown.style.display="none",this.dropdown.className="ms-drop"+(this._defaults.multiple?" multiple":""),this.container.appendChild(this.button),this.container.appendChild(this.dropdown),this.el.parentNode.insertBefore(this.container,this.el.nextSibling),this.el.style.display="none"}},{key:"_defineEvents",value:function(){var e=this;this.selectChange=function(){e.changeListener&&e._syncOption()},this.buttonClick=function(){e._toggleList()},this.windowClose=function(t){var l=e.button.querySelector("div");l.classList.contains("open")&&"HTML"!==t.target.tagName&&!e.container.contains(t.target)&&e._toggleList(!1)},this.dropdownClick=function(t){t.target&&"LI"===t.target.nodeName&&!t.target.classList.contains("select-toggle")&&e._updateSelected(t.target.getAttribute("data-value")),e._defaults.multiple||e._toggleList(!1)},this.togglerClick=function(){e._toggleAll()}}},{key:"_setSelectedValue",value:function(e){if(this._defaults.multiple){var t=this.selectedValue.indexOf(e);t!==-1?this.selectedValue.splice(t,1):this.selectedValue.push(e)}else this.selectedValue[0]=e}},{key:"_resetSelectedValue",value:function(){this.selectedValue=[]}},{key:"_updateNativeSelect",value:function(){for(var e=this.el.querySelectorAll("option"),t=0;t<e.length;t++)this.selectedValue.indexOf(e[t].value)!==-1?e[t].selected=!0:e[t].selected=!1}},{key:"_syncOption",value:function(){var e="<ul>";this._defaults.multiple&&this.options.toggler&&(e+='\n                <li class="select-toggle" data-translate-toggle="'+this.options.textUnselectAll+'">\n                    '+this.options.textSelectAll+"\n                </li>"),this._resetSelectedValue();for(var t=this.el.querySelectorAll("option"),l=0;l<t.length;l++){var i=t[l],s=["item"];s.push(i.classList),i.selected&&(this._setSelectedValue(i.value.toString()),s.push("selected")),e+='\n                <li class="'+s.join(" ")+'" data-value="'+i.value+'">\n                    '+i.text+"\n                </li>"}e+="</ul>";for(var l=0;l<this.el.options.length;l++)this.el.options[l].selected=!1;this._updateNativeSelect(),this.dropdown.innerHTML=e,this._defaults.multiple&&this.options.toggler&&(this.toggler=this.dropdown.querySelector("li.select-toggle")),this._setLabel(),this._event("unbind"),this._event("bind")}},{key:"_listener",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"bind":arguments[0];this._helperAddEvent(e,"change",this.el,this.selectChange),this._helperAddEvent(e,"click",this.button,this.buttonClick),this._helperAddEvent(e,"click",window,this.windowClose)}},{key:"_setLabel",value:function(){for(var e=this.el.options[0].text,t=0;t<this.el.options.length;t++)""===this.el.options[t].value&&(e=this.el.options[t].text);if(this._defaults.multiple){e=this.options.textStandard;var l=this.dropdown.querySelectorAll("li:not(.select-toggle)");this.options.toggler&&this._setToggleLabel("off"),this.selectedValue.length>=2&&this.selectedValue.length<l.length?e=this.options.textCountSelected.replace("%d",this.selectedValue.length):this.selectedValue.length===l.length?(e=this.options.textAllSelected,this.options.toggler&&this._setToggleLabel("on")):1===this.selectedValue.length&&(e=this.el.querySelector('option[value="'+this.selectedValue[0]+'"]').text)}else if(1===this.selectedValue.length)for(var t=0;t<this.el.options.length;t++)this.el.options[t].value===this.selectedValue[0]&&(e=this.el.options[t].text);else if(0===this.selectedValue[0])for(var t=0;t<this.el.options.length;t++)"0"===this.el.options[t].value&&(e=this.el.options[t].text);this.button.querySelector("span").innerHTML=e}},{key:"_setToggleLabel",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"on":arguments[0];if("on"===e){if(this.toggler.classList.contains("all"))return}else if(!this.toggler.classList.contains("all"))return;this.toggler.classList.toggle("all","on"===e);var t=this.toggler.textContent;this.toggler.textContent=this.toggler.getAttribute("data-translate-toggle"),this.toggler.setAttribute("data-translate-toggle",t)}},{key:"_event",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"bind":arguments[0];"unbind"===e?(this._helperAddEvent("unbind","click",this.dropdown,this.dropdownClick),this._defaults.multiple&&this.options.toggler&&this._helperAddEvent("unbind","click",this.toggler,this.togglerClick)):(this._helperAddEvent("bind","click",this.dropdown,this.dropdownClick),this._defaults.multiple&&this.options.toggler&&this._helperAddEvent("bind","click",this.toggler,this.togglerClick))}},{key:"_toggleAll",value:function(){if(this.toggler.classList.contains("all")){this._resetSelectedValue(),this._updateNativeSelect();for(var e=this.dropdown.querySelectorAll("li:not(.select-toggle)"),t=0;t<e.length;t++)e[t].classList.remove("selected");this._setToggleLabel("off")}else{for(var l=[],i=this.el.querySelectorAll("option"),t=0;t<this.el.options.length;t++)l.push(i[t].value);this.selectedValue=l,this._updateNativeSelect();for(var e=this.dropdown.querySelectorAll("li:not(.select-toggle)"),t=0;t<e.length;t++)e[t].classList.add("selected");this._setToggleLabel("on")}this._setLabel(),this.changeListener=!1;var s=document.createEvent("HTMLEvents");s.initEvent("change",!0,!0),this.el.dispatchEvent(s),this.changeListener=!0}},{key:"_toggleList",value:function(e){for(var t=document.querySelectorAll("button.ms-choice"),l=0;l<t.length;l++)this.button!==t[l]&&t[l].classList.remove("open");for(var i=document.querySelectorAll(".ms-drop"),l=0;l<i.length;l++)this.dropdown!==i[l]&&(i[l].style.display="none");"undefined"==typeof e?(this.button.querySelector("div").classList.toggle("open"),this.dropdown.style.display="none"!==this.dropdown.style.display?"none":"block"):(this.button.querySelector("div").classList.toggle("open",e),this.dropdown.style.display=e?"block":"none")}},{key:"_updateSelected",value:function(e){this._setSelectedValue(e),this._updateNativeSelect(),this._setLabel(),this._defaults.multiple?this.dropdown.querySelector('li[data-value="'+e+'"]').classList.toggle("selected"):(this.dropdown.querySelector("li.selected").classList.remove("selected"),this.dropdown.querySelector('li[data-value="'+e+'"]').classList.add("selected")),this.changeListener=!1;var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!0),this.el.dispatchEvent(t),this.changeListener=!0}},{key:"_helperExtend",value:function(e,t){var l=e;return Object.keys(t).forEach(function(e){l[e]=t[e]}),l}},{key:"_helperAddEvent",value:function(e,t,l,i){l.addEventListener?"bind"===e?l.addEventListener(t,i):l.removeEventListener(t,i):l.attachEvent?"bind"===e?l.attachEvent("on"+t,i):l.detachEvent("on"+t,i):l[t]=i}},{key:"refresh",value:function(){this._syncOption()}},{key:"destroy",value:function(){this._listener("unbind"),this.container.outerHTML="",delete this.container,this.el.style.display="block"}}]),e}();window.jQuery&&($.fn[t]=function(e){var l=arguments,s=void 0;if(void 0===e||"object"==typeof e)s=this.each(function(){$.data(this,"plugin_"+t)||$.data(this,"plugin_"+t,new i(this,e))});else if("string"==typeof e&&"_"!==e[0]&&"init"!==e){var n=void 0;this.each(function(){var i=$.data(this,"plugin_"+t);"function"==typeof i[e]&&(n=i[e].apply(i,Array.prototype.slice.call(l,1))),"destroy"===e&&$.data(this,"plugin_"+t,null)}),s=void 0!==n?n:this}return s}),e.SmartSelect=i});