function phi4z(eccent,e0,e1,e2,e3,a,b,c,phi){var sinphi,sin2ph,ml,mlp,con1,con2,con3,dphi,i;for(phi=a,i=1;i<=15;i++)if(sinphi=Math.sin(phi),tanphi=Math.tan(phi),c=tanphi*Math.sqrt(1-eccent*sinphi*sinphi),sin2ph=Math.sin(2*phi),ml=e0*phi-e1*sin2ph+e2*Math.sin(4*phi)-e3*Math.sin(6*phi),mlp=e0-2*e1*Math.cos(2*phi)+4*e2*Math.cos(4*phi)-6*e3*Math.cos(6*phi),con1=2*ml+c*(ml*ml+b)-2*a*(c*ml+1),con2=eccent*sin2ph*(ml*ml+b-2*a*ml)/(2*c),con3=2*(a-ml)*(c*mlp-2/sin2ph)-2*mlp,dphi=con1/(con2+con3),phi+=dphi,Math.abs(dphi)<=1e-10)return phi;return Proj4js.reportError("phi4z: No convergence"),null}function e4fn(x){var con,com;return con=1+x,com=1-x,Math.sqrt(Math.pow(con,con)*Math.pow(com,com))}var OpenLayers,jscolor;Oskari=function(){function buildPathForLoaderMode(fn,bpath){var pathBuilder=pathBuilders[mode];return pathBuilder?pathBuilder(fn,bpath):basePathForBundles?basePathForBundles+fn:fn}function isPackedMode(){return!isNotPackMode[mode]}function preloaded(){return _preloaded}function buildPathForPackedMode(bpath){return bpath+"/build/"+mode+".js"}function buildBundlePathForPackedMode(bpath){return bpath+"/build/bundle-"+mode+".js"}function buildLocalePathForPackedMode(bpath){return bpath+"/build/"+mode+"-locale-"+blocale.getLang()+".js"}var isDebug=!1,isConsole=window.console&&window.console.debug,logMsg=function(msg){isDebug&&isConsole&&window.console.debug(msg)},bundle_locale=function(){this.lang=null;this.localizations={};this.supportedLocales=null},isNotPackMode,_preloaded,clazzadapter,bundle_loader_id,bundle_loader,bundle_mediator,bundle_trigger,bundle_manager,bundle_facade,cs,bm,bndl,o2main;bundle_locale.prototype={setLocalization:function(lang,key,value){this.localizations[lang]||(this.localizations[lang]={});this.localizations[lang][key]=value},setLang:function(lang){this.lang=lang},setSupportedLocales:function(locales){this.supportedLocales=locales},getLang:function(){return this.lang},getLocalization:function(key){return this.localizations[this.lang][key]},getSupportedLocales:function(){return this.supportedLocales?this.supportedLocales:[]},getDefaultLanguage:function(){var locale=this.supportedLocales[0];return locale.substring(0,locale.indexOf("_"))},getSupportedLanguages:function(){for(var langs=[],locale,i=0;i<this.supportedLocales.length;i+=1)locale=this.supportedLocales[i],langs.push(locale.substring(0,locale.indexOf("_")));return langs}};var blocale=new bundle_locale,localesURL=null,supportBundleAsync=!1,mode="dev",instTs=(new Date).getTime(),basePathForBundles=null,pathBuilders={"default":function(fn){return basePathForBundles?basePathForBundles+fn:fn},dev:function(fn){return basePathForBundles?basePathForBundles+fn+"?ts="+instTs:fn+"?ts="+instTs}};isNotPackMode={dev:!0,"default":!0,static:!0};_preloaded=!1;clazzadapter=function(i,md){var p;this.impl=i;for(p in md)md.hasOwnProperty(p)&&(this[p]=md[p])};clazzadapter.prototype={define:function(){throw"define not supported for this adapter "+this.impl;},category:function(){throw"category not supported for this adapter "+this.impl;},create:function(){throw"create not supported for this adapter "+this.impl;},construct:function(){throw"construct not supported for this adapter "+this.impl;},global:function(){throw"global not supported for this adapter "+this.impl;},metadata:function(){throw"metadata not supported for this adapter "+this.impl;},protocol:function(){throw"protocol not supported for this adapter "+this.impl;},purge:function(){throw"purge not supported for this adapter "+this.impl;}};var clazzdef=function(){this.packages={};this.protocols={};this.inheritance={};this.aspects={};this.clazzcache={}},nativeadapter=new clazzadapter(new clazzdef,{purge:function(){},protocol:function(){var args=arguments;if(args.length===0)throw"missing arguments";return this.impl.protocols[args[0]]},metadata:function(){var args=arguments,cdef,pdefsp,bp=null,pp=null,sp=null,parts,pdef;if(args.length===0)throw"missing arguments";if(cdef=args[0],pdefsp=this.impl.clazzcache[cdef],pdefsp||(parts=cdef.split("."),bp=parts[0],pp=parts[1],sp=parts.slice(2).join("."),pdef=this.impl.packages[pp],pdef||(pdef={},this.impl.packages[pp]=pdef),pdefsp=pdef[sp],this.impl.clazzcache[cdef]=pdefsp),!pdefsp)throw"clazz "+sp+" does not exist in package "+pp+" bundle "+bp;return pdefsp._metadata},updateMetadata:function(bp,pp,sp,pdefsp,classMeta){var protocols,p,pt,cn;if(pdefsp._metadata||(pdefsp._metadata={}),pdefsp._metadata.meta=classMeta,protocols=classMeta.protocol,protocols)for(p=0;p<protocols.length;p+=1)pt=protocols[p],this.impl.protocols[pt]||(this.impl.protocols[pt]={}),cn=bp+"."+pp+"."+sp,this.impl.protocols[pt][cn]=pdefsp},_super:function(){var supCat=arguments[0],supMet=arguments[1],me=this;return function(){return me._._superCategory[supCat][supMet].apply(me,arguments)}},define:function(){var args=arguments,cdef,parts,bp,pp,sp,pdef,pdefsp,catFuncs,prot,pi,catName,extnds,e,p,superClazz,cd,compo;if(args.length===0)throw"missing arguments";if(cdef=args[0],parts=cdef.split("."),bp=parts[0],pp=parts[1],sp=parts.slice(2).join("."),pdef=this.impl.packages[pp],pdef||(pdef={},this.impl.packages[pp]=pdef),pdefsp=pdef[sp],pdefsp){pdefsp._constructor=args[1];catFuncs=args[2];prot=pdefsp._class.prototype;for(p in catFuncs)catFuncs.hasOwnProperty(p)&&(pi=catFuncs[p],prot[p]=pi);if(catName=cdef,pdefsp._category[catName]=catFuncs,args.length>3){for(extnds=args[3].extend,e=0;extnds&&e<extnds.length;e+=1)superClazz=this.lookup(extnds[e]),superClazz._composition.subClazz||(superClazz._composition.subClazz={}),superClazz._composition.subClazz[extnds[e]]=pdefsp,pdefsp._composition.superClazz=superClazz;this.updateMetadata(bp,pp,sp,pdefsp,args[3])}return this.pullDown(pdefsp),this.pushDown(pdefsp),pdefsp}cd=function(){};compo={clazzName:cdef,superClazz:null,subClazz:null};cd.prototype={};pdefsp={_class:cd,_constructor:args[1],_category:{},_composition:compo};cd.prototype._=pdefsp;cd.prototype._super=this._super;catFuncs=args[2];prot=cd.prototype;for(p in catFuncs)catFuncs.hasOwnProperty(p)&&(pi=catFuncs[p],prot[p]=pi);if(catName=cdef,pdefsp._category[catName]=catFuncs,this.impl.inheritance[cdef]=compo,pdef[sp]=pdefsp,catName=cdef,pdefsp._category[catName]=args[2],args.length>3){for(extnds=args[3].extend,e=0;extnds&&e<extnds.length;e+=1)superClazz=this.lookup(extnds[e]),superClazz._composition.subClazz||(superClazz._composition.subClazz={}),superClazz._composition.subClazz[cdef]=pdefsp,pdefsp._composition.superClazz=superClazz;this.updateMetadata(bp,pp,sp,pdefsp,args[3])}return this.pullDown(pdefsp),this.pushDown(pdefsp),pdefsp},category:function(){var args=arguments,cdef,parts,bp,pp,sp,pdef,pdefsp,cd,compo,catName,catFuncs,prot,pi,p;if(args.length===0)throw"missing arguments";cdef=args[0];parts=cdef.split(".");bp=parts[0];pp=parts[1];sp=parts.slice(2).join(".");pdef=this.impl.packages[pp];pdef||(pdef={},this.impl.packages[pp]=pdef);pdefsp=pdef[sp];pdefsp||(cd=function(){},compo={clazzName:cdef,superClazz:null,subClazz:null},cd.prototype={},pdefsp={_class:cd,_constructor:args[1],_category:{},_composition:compo},cd.prototype._=pdefsp,cd.prototype._super=this._super,this.impl.inheritance[cdef]=compo,pdef[sp]=pdefsp);catName=args[1];catFuncs=args[2];prot=pdefsp._class.prototype;for(p in catFuncs)catFuncs.hasOwnProperty(p)&&(pi=catFuncs[p],prot[p]=pi);return pdefsp._category[catName]=catFuncs,this.pullDown(pdefsp),this.pushDown(pdefsp),pdefsp},lookup:function(){var args=arguments,cdef,parts,bp,pp,sp,pdef,pdefsp,cd,compo;if(args.length===0)throw"missing arguments";return cdef=args[0],parts=cdef.split("."),bp=parts[0],pp=parts[1],sp=parts.slice(2).join("."),pdef=this.impl.packages[pp],pdef||(pdef={},this.impl.packages[pp]=pdef),pdefsp=pdef[sp],pdefsp||(cd=function(){},cd.prototype={},compo={clazzName:cdef,superClazz:null,subClazz:null},pdefsp={_class:cd,_constructor:args[1],_category:{},_composition:compo},this.impl.inheritance[cdef]=compo,pdef[sp]=pdefsp),pdefsp},extend:function(){var args=arguments,superClazz=this.lookup(args[1]),subClazz=this.lookup(args[0]);return superClazz._composition.subClazz||(superClazz._composition.subClazz={}),superClazz._composition.subClazz[args[0]]=subClazz,subClazz._composition.superClazz=superClazz,this.pullDown(subClazz),subClazz},composition:function(){var cdef=arguments[0],pdefsp=this.impl.clazzcache[cdef],bp=null,pp=null,sp=null,parts,pdef;return pdefsp||(parts=cdef.split("."),bp=parts[0],pp=parts[1],sp=parts.slice(2).join("."),pdef=this.impl.packages[pp],pdef||(pdef={},this.impl.packages[pp]=pdef),pdefsp=pdef[sp],this.impl.clazzcache[cdef]=pdefsp),pdefsp},pushDown:function(pdefsp){var sub,pdefsub;if(pdefsp._composition.subClazz)for(sub in pdefsp._composition.subClazz)pdefsp._composition.subClazz.hasOwnProperty(sub)&&(pdefsub=pdefsp._composition.subClazz[sub],this.pullDown(pdefsub),this.pushDown(pdefsub))},pullDown:function(pdefsp){var clazzHierarchy=[],spr,prot,constructors=[],superClazzMethodCats={},s,cn,ctor,superClazzMetCat,c,catName,catFuncs,p,pi;if(pdefsp._composition.superClazz){for(clazzHierarchy.push(pdefsp),spr=pdefsp;;){if(spr=spr._composition.superClazz,!spr)break;clazzHierarchy.push(spr)}for(prot=pdefsp._class.prototype,s=clazzHierarchy.length-1;s>=0;s-=1){cn=clazzHierarchy[s]._composition.clazzName;ctor=clazzHierarchy[s]._constructor;constructors.push(ctor);superClazzMetCat={};for(c in clazzHierarchy[s]._category)if(clazzHierarchy[s]._category.hasOwnProperty(c)){catName=cn+"#"+c;catFuncs=clazzHierarchy[s]._category[c];for(p in catFuncs)catFuncs.hasOwnProperty(p)&&(pi=catFuncs[p],prot[p]=pi,superClazzMetCat[p]=pi)}superClazzMethodCats[cn]=superClazzMetCat}return pdefsp._constructors=constructors,pdefsp._superCategory=superClazzMethodCats,clazz}},printAncestry:function(){var pdefsp=this.lookup.apply(this,arguments),clazzHierarchy=[],spr,s;if(pdefsp._composition.superClazz){for(clazzHierarchy.push(pdefsp),spr=pdefsp;;){if(spr=spr._composition.superClazz,!spr)break;clazzHierarchy.push(spr)}for(s=clazzHierarchy.length-1;s>=0;s-=1)console&&console.log&&console.log("                 ".substring(0,clazzHierarchy.length-s)+"|_ "+clazzHierarchy[s]._composition.clazzName)}},printHierarchy:function(){var pdefsp=this.lookup.apply(this,arguments),clazzHierarchy=[],taskList=[],task,pdefc,pdefsub,p,s;if(pdefsp._composition.subClazz){for(taskList.push({c:null,sub:pdefsp,level:0});;){if(task=taskList.shift(),!task)break;if(clazzHierarchy.push("                 ".substring(0,task.level)+"|_ "+task.sub._composition.clazzName),pdefc=task.c,pdefsub=task.sub,pdefsub._composition.subClazz)for(p in pdefsub._composition.subClazz)pdefsub._composition.subClazz.hasOwnProperty(p)&&taskList.push({c:pdefc,sub:pdefsub._composition.subClazz[p],level:task.level+1})}for(s=0;s<clazzHierarchy.length;s+=1)console&&console.log&&console.log(clazzHierarchy[s])}},apropos:function(){var pdefsp=this.lookup.apply(this,arguments);for(var p in pdefsp._category[arguments[0]])pdefsp._category[arguments[0]].hasOwnProperty(p)&&console&&console.log&&console.log(p)},slicer:Array.prototype.slice,create:function(){var args=arguments,instargs,cdef,pdef,pdefsp,bp,pp,sp,parts,inst,ctors,c;if(args.length===0)throw"missing arguments";if(instargs=this.slicer.apply(arguments,[1]),cdef=args[0],pdefsp=this.impl.clazzcache[cdef],bp=null,pp=null,sp=null,pdefsp||(parts=cdef.split("."),bp=parts[0],pp=parts[1],sp=parts.slice(2).join("."),pdef=this.impl.packages[pp],pdef||(pdef={},this.impl.packages[pp]=pdef),pdefsp=pdef[sp],this.impl.clazzcache[cdef]=pdefsp),!pdefsp)throw"clazz "+sp+" does not exist in package "+pp+" bundle "+bp;if(inst=new pdefsp._class,ctors=pdefsp._constructors,ctors)for(c=0;c<ctors.length;c+=1)ctors[c].apply(inst,instargs);else pdefsp._constructor.apply(inst,instargs);return inst},createWithPdefsp:function(){var args=arguments,instargs,pdefsp,inst,ctors,c;if(args.length===0)throw"missing arguments";if(instargs=arguments[1],pdefsp=args[0],!pdefsp)throw"clazz does not exist ";if(inst=new pdefsp._class,ctors=pdefsp._constructors,ctors)for(c=0;c<ctors.length;c+=1)ctors[c].apply(inst,instargs);else pdefsp._constructor.apply(inst,instargs);return inst},construct:function(){var args=arguments,cdef,instprops,pdefsp,bp=null,pp=null,sp=null,parts,pdef,inst;if(args.length!==2)throw"missing arguments";if(cdef=args[0],instprops=args[1],pdefsp=this.impl.clazzcache[cdef],pdefsp||(parts=cdef.split("."),bp=parts[0],pp=parts[1],sp=parts.slice(2).join("."),pdef=this.impl.packages[pp],pdef||(pdef={},this.impl.packages[pp]=pdef),pdefsp=pdef[sp],this.impl.clazzcache[cdef]=pdefsp),!pdefsp)throw"clazz "+sp+" does not exist in package "+pp+" bundle "+bp;return inst=new pdefsp._class,pdefsp._constructor.apply(inst,[instprops]),inst},builder:function(){var args=arguments,cdef,pdefsp,bp=null,pp=null,sp=null,parts,pdef,instargs,inst,ctors,c;if(args.length===0)throw"missing arguments";if(cdef=args[0],pdefsp=this.impl.clazzcache[cdef],pdefsp||(parts=cdef.split("."),bp=parts[0],pp=parts[1],sp=parts.slice(2).join("."),pdef=this.impl.packages[pp],pdef||(pdef={},this.impl.packages[pp]=pdef),pdefsp=pdef[sp],this.impl.clazzcache[cdef]=pdefsp),!pdefsp)throw"clazz "+sp+" does not exist in package "+pp+" bundle "+bp;return pdefsp._builder?pdefsp._builder:(pdefsp._builder=function(){if(instargs=arguments,inst=new pdefsp._class,ctors=pdefsp._constructors,ctors)for(c=0;c<ctors.length;c+=1)ctors[c].apply(inst,instargs);return pdefsp._constructor.apply(inst,instargs),inst},pdefsp._builder)},builderFromPdefsp:function(){var args=arguments,pdefsp,instargs,inst,ctors,c;if(args.length===0)throw"missing arguments";if(pdefsp=args[0],!pdefsp)throw"pdefsp not defined.";return pdefsp._builder?pdefsp._builder:(pdefsp._builder=function(){if(instargs=arguments,inst=new pdefsp._class,ctors=pdefsp._constructors,ctors)for(c=0;c<ctors.length;c+=1)ctors[c].apply(inst,instargs);else pdefsp._constructor.apply(inst,instargs);return inst},pdefsp._builder)}}),clazz=function(regExp,adapter){this.defRex=new RegExp(regExp);this.def=adapter;this.hasOtherNs=!1;this.ns={};this.alias={};this.globals={}};clazz.prototype={get:function(){var args=arguments,parts,bp,ai;if(!this.hasOtherNs||this.defRex.test(args[0]))return this.def;if(parts=args[0].split("."),bp=parts[0],ai=this.ns[bp],!ai)throw"clazz: ns NOT bound "+bp;return ai},self:function(bp){var ai=this.ns[bp];if(!ai)throw"clazz: ns NOT bound "+bp;return ai.self},adapt:function(base,adapter){this.ns[base]=adapter;this.hasOtherNs=!0},define:function(){var ai=this.get.apply(this,arguments);return ai.define.apply(ai,arguments)},category:function(){var ai=this.get.apply(this,arguments);return ai.category.apply(ai,arguments)},composition:function(){var ai=this.get.apply(this,arguments);return ai.composition.apply(ai,arguments)},extend:function(){var ai=this.get.apply(this,arguments);return ai.extend.apply(ai,arguments)},create:function(){var ai=this.get.apply(this,arguments);return ai.create.apply(ai,arguments)},createWithPdefsp:function(){var ai=this.get.apply(this,arguments);return ai.createWithPdefsp.apply(ai,arguments)},construct:function(){var ai=this.get.apply(this,arguments);return ai.construct.apply(ai,arguments)},createArrArgs:function(args){var ai=this.get.apply(this,arguments);return ai.create.apply(ai,args)},builder:function(){var ai=this.get.apply(this,arguments);return ai.builder.apply(ai,arguments)},builderFromPdefsp:function(){var ai=this.get.apply(this,arguments);return ai.builderFromPdefsp.apply(ai,arguments)},global:function(){var name;return arguments.length===0?this.globals:(name=arguments[0],arguments.length===2&&(this.globals[name]=arguments[1]),this.globals[name])},metadata:function(){var ai=this.get.apply(this,arguments);return ai.metadata.apply(ai,arguments)},protocol:function(){var ai=this.get.apply(this,arguments);return ai.protocol.apply(ai,arguments)},purge:function(){var ai=this.get.apply(this,arguments);return ai.purge.apply(ai,arguments)},printAncestry:function(){var ai=this.get.apply(this,arguments);return ai.printAncestry.apply(ai,arguments)},printHierarchy:function(){var ai=this.get.apply(this,arguments);return ai.printHierarchy.apply(ai,arguments)},apropos:function(){var ai=this.get.apply(this,arguments);return ai.apropos.apply(ai,arguments)},lookup:function(){var ai=this.get.apply(this,arguments);return ai.lookup.apply(ai,arguments)}};clazz.prototype.singleton=new clazz("^Oskari(.*)",nativeadapter);bundle_loader_id=0;bundle_loader=function(manager,cb){this.loader_identifier=++bundle_loader_id;this.manager=manager;this.callback=cb;this.filesRequested=0;this.filesLoaded=0;this.files={};this.fileList=[];this.metadata={}};bundle_loader.prototype={add:function(fn,pdef){var me=this,def;me.files[fn]||(def={src:fn,type:(pdef?pdef.type:null)||"text/javascript",id:pdef?pdef.id:null,state:!1},me.files[fn]=def,"text/javascript"===def.type&&(me.filesRequested+=1),me.fileList.push(def))},getState:function(){return this.filesRequested===0?1:this.filesLoaded/this.filesRequested},commit:function(){var head=document.getElementsByTagName("head")[0],fragment=document.createDocumentFragment(),me=this,numFiles=me.filesRequested,onFileLoaded,f,n,def,fn,st;if(numFiles===0){me.callback();me.manager.notifyLoaderStateChanged(me,!0);return}if(preloaded()){me.callback();me.manager.notifyLoaderStateChanged(me,!0);return}for(onFileLoaded=function(){me.filesLoaded+=1;me.manager.log("Files loaded "+me.filesLoaded+"/"+me.filesRequested);numFiles===me.filesLoaded?(me.callback(),me.manager.notifyLoaderStateChanged(me,!0)):me.manager.notifyLoaderStateChanged(me,!1)},f=!1,n=0;n<me.fileList.length;n+=1)def=me.fileList[n],fn=def.src,st=me.buildScriptTag(fn,onFileLoaded,def.type,def.id),st&&(preloaded()?onFileLoaded():(fragment.appendChild(st),f=!0));f&&head.appendChild(fragment)},buildScriptTag:function(filename,callback,elementtype,elementId){var me=this,script=document.createElement("script");return elementId&&(script.id=elementId),script.type=elementtype,script.charset="utf-8",script.src=preloaded()?"/Oskari/empty.js":filename,script.readyState?script.onreadystatechange=function(){(script.readyState==="loaded"||script.readyState==="complete")&&(script.onreadystatechange=null,callback())}:script.onload=callback,script}};bundle_mediator=function(opts){var p;this.manager=null;for(p in opts)opts.hasOwnProperty(p)&&(this[p]=opts[p])};bundle_mediator.prototype={setState:function(state){return this.state=state,this.manager.postChange(this.bundle,this.instance,this.state),this.state},getState:function(){return this.state}};bundle_trigger=function(btc,cb,info){this.config=btc;this.callback=cb;this.fired=!1;this.info=info};bundle_trigger.prototype={execute:function(manager,b,bi,info){var me=this,p,srcState,cb;if(!me.fired){for(p in me.config["Import-Bundle"])if(me.config["Import-Bundle"].hasOwnProperty(p)&&(srcState=manager.stateForBundleSources[p],!srcState||srcState.state!==1)){manager.log("trigger not fired due "+p+" for "+info||this.info);return}me.fired=!0;manager.log("posting trigger");cb=this.callback;window.setTimeout(function(){cb(manager)},0)}}};bundle_manager=function(){this.serial=0;this.impls={};this.sources={};this.instances={};this.bundles={};this.stateForBundleDefinitions={};this.stateForBundleSources={};this.stateForBundles={};this.stateForBundleInstances={};this.stateForPackages={sources:{},sinks:{}};this.triggers=[];this.loaderStateListeners=[]};bundle_manager.prototype={purge:function(){var p,me=this;for(p in me.sources)me.sources.hasOwnProperty(p)&&delete me.sources[p];for(p in me.stateForBundleDefinitions)me.stateForBundleDefinitions.hasOwnProperty(p)&&delete me.stateForBundleDefinitions[p].loader;for(p in me.stateForBundleSources)me.stateForBundleSources.hasOwnProperty(p)&&delete me.stateForBundleSources[p].loader},notifyLoaderStateChanged:function(bl,finished){var l,cb;if(this.loaderStateListeners.length!==0)for(l=0;l<this.loaderStateListeners.length;l+=1)cb=this.loaderStateListeners[l],cb(bl,finished)},registerLoaderStateListener:function(cb){this.loaderStateListeners.push(cb)},alert:function(what){logMsg(what)},log:function(what){logMsg(what)},loadCss:function(sScriptSrc){this.log("loading CSS "+sScriptSrc);var cssParentElement=document.getElementsByTagName("head").length?document.getElementsByTagName("head")[0]:document.body,styles,linkElement;preloaded()||(jQuery.browser.msie?jQuery.ajax({url:sScriptSrc,dataType:"text"}).done(function(css){return styles=document.getElementById("concatenated"),styles?styles.styleSheet.cssText+=css:(styles=document.createElement("style"),cssParentElement.appendChild(styles),styles.setAttribute("type","text/css"),styles.styleSheet.cssText=css,styles.id="concatenated"),css}):(linkElement=document.createElement("link"),linkElement.type="text/css",linkElement.rel="stylesheet",linkElement.href=sScriptSrc,cssParentElement.appendChild(linkElement)))},self:function(){return this},install:function(implid,bp,srcs,metadata){var me=this,bundleImpl=implid,defState=me.stateForBundleDefinitions[bundleImpl],srcState;defState?(defState.state=1,me.log("SETTING STATE FOR BUNDLEDEF "+bundleImpl+" existing state to "+defState.state)):(defState={state:1},me.stateForBundleDefinitions[bundleImpl]=defState,me.log("SETTING STATE FOR BUNDLEDEF "+bundleImpl+" NEW state to "+defState.state));defState.metadata=metadata;me.impls[bundleImpl]=bp;me.sources[bundleImpl]=srcs;srcState=me.stateForBundleSources[bundleImpl];srcState&&(srcState.state===-1?(me.log("triggering loadBundleSources for "+bundleImpl+" at loadBundleDefinition"),window.setTimeout(function(){me.loadBundleSources(bundleImpl)},0)):me.log("source state for "+bundleImpl+" at loadBundleDefinition is "+srcState.state));me.postChange(null,null,"bundle_definition_loaded")},installBundleClass:function(implid,clazzName){var cs=clazz.prototype.singleton,classmeta=cs.metadata(clazzName),bp=cs.builder(clazzName),srcs=classmeta.meta.source,bundleMetadata=classmeta.meta.bundle;this.install(implid,bp,srcs,bundleMetadata)},installBundlePdefsp:function(implid,pdefsp){var cs=clazz.prototype.singleton,bp=cs.builderFromPdefsp(pdefsp),bundleMetadata=pdefsp._metadata;this.install(implid,bp,{},bundleMetadata)},impl:function(implid){return this.impls[implid]},loadBundleDefinition:function(implid,bundleSrc,pbundlePath){var me=this,bundleImpl=implid,defState=me.stateForBundleDefinitions[bundleImpl],bundlePath,bl;if(me.log("loadBundleDefinition called with "+bundleImpl),defState){if(defState.state===1){me.log("bundle definition already loaded for "+bundleImpl);me.postChange(null,null,"bundle_definition_loaded");return}me.log("bundle definition already loaded OR WHAT?"+bundleImpl+" "+defState.state);return}defState={state:-1};me.stateForBundleDefinitions[bundleImpl]=defState;me.log("set NEW state for DEFINITION "+bundleImpl+" to "+defState.state);defState.bundleSrcPath=bundleSrc;bundlePath=pbundlePath||bundleSrc.substring(0,bundleSrc.lastIndexOf("/"));defState.bundlePath=bundlePath;bl=new bundle_loader(this,function(){me.log("bundle_def_loaded_callback")});bl.metadata.context="bundleDefinition";defState.loader=bl;bl.add(bundleSrc);bl.commit()},loadBundleSources:function(implid){var me=this,bundleImpl=implid,defState=me.stateForBundleDefinitions[bundleImpl],srcFiles,srcState,callback,bundlePath,srcs,p,def,defs,defSrc,src,n,fn,fnWithPath,requiredLocale,bl,js,fileCount,srcsFn,localesFn;if(me.log("loadBundleSources called with "+bundleImpl),!defState)throw"INVALID_STATE: bundle definition load not requested for "+bundleImpl;if(defState&&me.log("- definition STATE for "+bundleImpl+" at load sources "+defState.state),mode==="static"){me.postChange(null,null,"bundle_definition_loaded");return}if(srcState=me.stateForBundleSources[bundleImpl],srcState){if(srcState.state===1){me.log("already loaded sources for : "+bundleImpl);return}if(srcState.state===-1)me.log("loading previously pending sources for "+bundleImpl+" "+srcState.state+" or what?");else throw"INVALID_STATE: at "+bundleImpl;}else srcState={state:-1},me.stateForBundleSources[bundleImpl]=srcState,me.log("setting STATE for sources "+bundleImpl+" to "+srcState.state);if(defState.state!==1){me.log("pending DEFINITION at sources for "+bundleImpl+" to "+defState.state+" -> postponed");return}if(me.log("STARTING load for sources "+bundleImpl),srcFiles={count:0,loaded:0,files:{},css:{}},callback=function(){me.log("finished loading "+srcFiles.count+" files for "+bundleImpl+".");me.stateForBundleSources[bundleImpl].state=1;me.log("set NEW state post source load for "+bundleImpl+" to "+me.stateForBundleSources[bundleImpl].state);me.postChange(null,null,"bundle_sources_loaded")},bundlePath=defState.bundlePath,srcs=me.sources[bundleImpl],srcs){me.log("got sources for "+bundleImpl);for(p in srcs)if(p==="scripts")for(defs=srcs[p],n=0;n<defs.length;n+=1)def=defs[n],def.type==="text/css"?(fn=def.src,fnWithPath=null,fnWithPath=fn.indexOf("http")!==-1?fn:bundlePath+"/"+fn,srcFiles.css[fnWithPath]=def):def.type&&(srcFiles.count+=1,fn=buildPathForLoaderMode(def.src,bundlePath),fnWithPath=null,fnWithPath=fn.indexOf("http")!==-1?fn:bundlePath+"/"+fn,srcFiles.files[fnWithPath]=def);else if(p==="locales")for(requiredLocale=blocale.getLang(),defs=srcs[p],n=0;n<defs.length;n+=1)def=defs[n],def.type==="text/css"?(fn=def.src,fnWithPath=null,fnWithPath=fn.indexOf("http")!==-1?fn:bundlePath+"/"+fn,srcFiles.css[fnWithPath]=def):def.type&&(srcFiles.count+=1,fn=buildPathForLoaderMode(def.src,bundlePath),fnWithPath=null,fnWithPath=fn.indexOf("http")!==-1?fn:bundlePath+"/"+fn,srcFiles.files[fnWithPath]=def)}else me.log("NO sources for "+bundleImpl);for(src in srcFiles.css)srcFiles.css.hasOwnProperty(src)&&(defSrc=src,fn=buildPathForLoaderMode(defSrc,bundlePath),me.loadCss(fn,callback),me.log("- added css source "+fn+" for "+bundleImpl));if(bl=new bundle_loader(this,callback),bl.metadata.context="bundleSources",bl.metadata.bundleImpl=bundleImpl,srcState.loader=bl,isPackedMode()){fileCount=0;for(js in srcFiles.files)srcFiles.files.hasOwnProperty(js)&&(fileCount+=1);fileCount>0&&(srcsFn=buildPathForPackedMode(bundlePath),bl.add(srcsFn,"text/javascript"),me.log("- added PACKED javascript source "+srcsFn+" for "+bundleImpl),localesFn=buildLocalePathForPackedMode(bundlePath),bl.add(localesFn,"text/javascript"),me.log("- added PACKED locale javascript source "+localesFn+" for "+bundleImpl))}else for(js in srcFiles.files)srcFiles.files.hasOwnProperty(js)&&(bl.add(js,srcFiles.files[js]),me.log("- added script source "+js+" for "+bundleImpl));bl.commit()},postChange:function(b,bi,info){var me=this,bid,o,i;me.update(b,bi,info);for(bid in me.bundles)me.bundles.hasOwnProperty(bid)&&(o=me.bundles[bid],o.update(me,b,bi,info));for(i in me.instances)if(me.instances.hasOwnProperty(i)){if(o=me.instances[i],!o)continue;o.update(me,b,bi,info)}},createBundle:function(implid,bundleid){var bundlImpl=implid,me=this,defState=me.stateForBundleDefinitions[bundlImpl],bp,b;if(!defState)throw"INVALID_STATE: for createBundle / definition not loaded "+implid+"/"+bundleid;if(bp=this.impls[implid],!bp){alert("this.impls["+implid+"] is null!");return}return b=bp(defState),this.bundles[bundleid]=b,this.stateForBundles[bundleid]={state:!0,bundlImpl:bundlImpl},this.postChange(b,null,"bundle_created"),b},bindImportedPackages:function(){},bindImportedNamespaces:function(){},bindImportedEvents:function(){},bindExportedPackages:function(){},bindExportedNamespaces:function(){},bindExportedRequests:function(){},update:function(b,bi,info){var me=this,n,t;for(me.log("update called with info "+info),n=0;n<me.triggers.length;n+=1)t=me.triggers[n],t.execute(me)},bundle:function(bundleid){return this.bundles[bundleid]},destroyBundle:function(){},uninstall:function(implid){return this.impls[implid]},createInstance:function(bundleid){var me=this;if(!me.stateForBundles[bundleid]||!me.stateForBundles[bundleid].state)throw"INVALID_STATE: for createInstance / definition not loaded "+bundleid;var s=""+ ++this.serial,b=this.bundles[bundleid],bi=b.create();return bi.mediator=new bundle_mediator({bundleId:bundleid,instanceid:s,state:"initial",bundle:b,instance:bi,manager:this,clazz:clazz.prototype.singleton,requestMediator:{}}),this.instances[s]=bi,this.stateForBundleInstances[s]={state:!0,bundleid:bundleid},this.postChange(b,bi,"instance_created"),bi},instance:function(instanceid){return this.instances[instanceid]},destroyInstance:function(instanceid){var bi=this.instances[instanceid],mediator=bi.mediator;return mediator.bundle=null,mediator.manager=null,mediator.clazz=null,bi.mediator=null,this.instances[instanceid]=null,null},on:function(cfg,cb,info){this.triggers.push(new bundle_trigger(cfg,cb,info))}};bundle_facade=function(bm){this.manager=bm;this.bundles={};this.bundleInstances={};this.bundlePath="../src/mapframework/bundle/";this.appSetup=null;this.appConfig={}};bundle_facade.prototype={getBundleInstanceByName:function(bundleinstancename){var me=this;return me.bundleInstances[bundleinstancename]},getBundleInstanceConfigurationByName:function(bundleinstancename){var me=this;return me.appConfig[bundleinstancename]},requireBundle:function(implid,bundleid,cb){var me=this,b=me.manager.createBundle(implid,bundleid);cb(me.manager,b)},require:function(config,cb,info){var me=this,imports,p,packedBundleFn;me.manager.on(config,cb,info);imports=config["Import-Bundle"];for(p in imports)if(imports.hasOwnProperty(p)){var pp=p,def=imports[p],bundlePath=def.bundlePath||me.bundlePath,bundleDefFilename;isPackedMode()?(packedBundleFn=buildBundlePathForPackedMode(bundlePath+pp),bundleDefFilename=buildPathForLoaderMode(packedBundleFn,bundlePath)):bundleDefFilename=buildPathForLoaderMode(bundlePath+pp+"/bundle.js",bundlePath);me.manager.log("FACADE requesting load for "+pp+" from "+bundleDefFilename);me.manager.loadBundleDefinition(pp,bundleDefFilename,bundlePath+pp);me.manager.loadBundleSources(pp)}},setBundlePath:function(p){this.bundlePath=p},loadBundleDeps:function(deps,callback,manager,info){var me=this,bdep=deps["Import-Bundle"],depslist=[],hasPhase=!1,p,name,def;for(p in bdep)bdep.hasOwnProperty(p)&&(name=p,def=bdep[p],depslist.push({name:name,def:def,phase:def.phase}),hasPhase=hasPhase||def.phase);depslist.sort(function(a,b){return!a.phase&&!b.phase?0:a.phase?b.phase?a.phase<b.phase?-1:1:-1:1});hasPhase||!supportBundleAsync?me.loadBundleDep(depslist,callback,manager,info):me.loadBundleDepAsync(deps,callback,manager,info)},loadBundleDep:function(depslist,callback,manager,info){var me=this,bundledef=depslist.pop(),def,bundlename,fcd,bdep;if(!bundledef){callback(manager);return}def=bundledef.def;bundlename=bundledef.name;fcd=this;bdep={"Import-Bundle":{}};bdep["Import-Bundle"][bundlename]=def;fcd.require(bdep,function(manager){me.loadBundleDep(depslist,callback,manager,info)},info)},loadBundleDepAsync:function(deps,callback,manager,info){this.require(deps,callback,info)},playBundle:function(recData,cb){var metas=recData.metadata,bundlename=recData.bundlename,bundleinstancename=recData.bundleinstancename,isSingleton=metas.Singleton,fcd=this,me=this,instanceRequirements=metas["Require-Bundle-Instance"]||[],instanceProps=recData.instanceProp,r,implInfo,implid,bundleid,b,bi,configProps,yy;me.loadBundleDeps(metas,function(manager){var ip;for(r=0;r<instanceRequirements.length;r+=1)if(implInfo=instanceRequirements[r],implid=typeof implInfo=="object"?implInfo.bundlename:implInfo,bundleid=typeof implInfo=="object"?implInfo.bundleinstancename:implInfo+"Instance",b=me.bundles[implid],b||(b=manager.createBundle(implid,bundleid),me.bundles[implid]=b),bi=me.bundleInstances[bundleid],!bi||!isSingleton){if(bi=manager.createInstance(bundleid),me.bundleInstances[bundleid]=bi,configProps=me.getBundleInstanceConfigurationByName(bundleid),configProps)for(ip in configProps)configProps.hasOwnProperty(ip)&&(bi[ip]=configProps[ip]);bi.start()}fcd.requireBundle(bundlename,bundleinstancename,function(){var ip;yy=manager.createInstance(bundleinstancename);for(ip in instanceProps)instanceProps.hasOwnProperty(ip)&&(yy[ip]=instanceProps[ip]);if(configProps=me.getBundleInstanceConfigurationByName(bundleinstancename),configProps)for(ip in configProps)configProps.hasOwnProperty(ip)&&(yy[ip]=configProps[ip]);yy.start();me.bundleInstances[bundleinstancename]=yy;cb(yy)})},fcd.manager,bundlename)},setApplicationSetup:function(setup){this.appSetup=setup},getApplicationSetup:function(){return this.appSetup},setConfiguration:function(config){this.appConfig=config},getConfiguration:function(){return this.appConfig},startApplication:function(cb){function schedule(){window.setTimeout(mediator.player,0)}var me=this,appSetup=this.appSetup,appConfig=this.appConfig,seq=this.appSetup.startupSequence.slice(0),seqLen=seq.length,startupInfo={bundlesInstanceConfigurations:appConfig,bundlesInstanceInfos:{}},mediator={facade:me,seq:seq,bndl:null,player:null,startupInfo:startupInfo};mediator.player=function(){if(mediator.bndl=mediator.seq.shift(),!mediator.bndl){cb&&cb(startupInfo);return}mediator.facade.playBundle(mediator.bndl,function(bi){var bndlName=mediator.bndl.bundlename,bndlInstanceName=mediator.bndl.bundleinstancename;mediator.startupInfo.bundlesInstanceInfos[bndlInstanceName]={bundlename:bndlName,bundleinstancename:bndlInstanceName,bundleInstance:bi};mediator.bndl.callback&&(typeof mediator.bndl.callback=="string"&&eval(mediator.bndl.callback),mediator.bndl.callback.apply(this,[bi,mediator.bndl]));schedule()})};schedule()},stopApplication:function(){throw"NYI";}};cs=clazz.prototype.singleton;bm=new bundle_manager;bm.clazz=cs;var fcd=new bundle_facade(bm),ga=cs.global,bundle_dom_manager=function(dollar){this.$=dollar};bundle_dom_manager.prototype={getEl:function(selector){return this.$(selector)},getElForPart:function(){throw"N/A";},setElForPart:function(){throw"N/A";},setElParts:function(){throw"N/A";},getElParts:function(){throw"N/A";},pushLayout:function(){throw"N/A";},popLayout:function(){throw"N/A";},getLayout:function(){throw"N/A";}};var domMgr=new bundle_dom_manager(jQuery),o2anonclass=0,o2anoncategory=0,o2anonbundle=0;return cs.define("Oskari.ModuleSpec",function(clazzInfo,clazzName){this.cs=cs;this.clazzInfo=clazzInfo;this.clazzName=clazzName},{slicer:Array.prototype.slice,category:function(protoProps,traitsName){var clazzInfo=cs.category(this.clazzName,traitsName||["__",++o2anoncategory].join("_"),protoProps);return this.clazzInfo=clazzInfo,this},methods:function(protoProps,traitsName){var clazzInfo=cs.category(this.clazzName,traitsName||["__",++o2anoncategory].join("_"),protoProps);return this.clazzInfo=clazzInfo,this},extend:function(clsss){var clazzInfo=cs.extend(this.clazzName,clsss.length?clsss:[clsss]);return this.clazzInfo=clazzInfo,this},create:function(){return cs.createWithPdefsp(this.clazzInfo,arguments)},name:function(){return this.clazzName},metadata:function(){return cs.metadata(this.clazzName)},events:function(events){var orgmodspec=this;return orgmodspec.category({eventHandlers:events,onEvent:function(event){var handler=this.eventHandlers[event.getName()];if(handler)return handler.apply(this,[event])}},"___events"),orgmodspec},requests:function(requests){var orgmodspec=this;return orgmodspec.category({requestHandlers:requests,onRequest:function(request){var handler=this.requestHandlers[request.getName()];if(handler)return handler.apply(this,[request])}},"___requests"),orgmodspec},builder:function(){return cs.builderFromPdefsp(this.clazzInfo)}}),bndl={bundle_manager:bm,bundle_facade:fcd,bundle_locale:blocale,app:fcd,clazz:cs,$:function(){return ga.apply(cs,arguments)},clazzadapter:clazzadapter,run:function(func){func()},setLoaderMode:function(m){mode=m},getLoaderMode:function(){return mode},setDebugMode:function(d){isDebug=d},setSupportBundleAsync:function(a){supportBundleAsync=a},getSupportBundleAsync:function(){return supportBundleAsync},setBundleBasePath:function(bp){basePathForBundles=bp},getBundleBasePath:function(){return basePathForBundles},setPreloaded:function(usep){_preloaded=usep},setInstTs:function(x){instTs=x},registerLocalization:function(props){var p,pp;if(props.length)for(p=0;p<props.length;p+=1)pp=props[p],blocale.setLocalization(pp.lang,pp.key,pp.value);else return blocale.setLocalization(props.lang,props.key,props.value)},getLocalization:function(key){return blocale.getLocalization(key)},getLang:function(){return blocale.getLang()},setLang:function(lang){return blocale.setLang(lang)},setSupportedLocales:function(locales){return blocale.setSupportedLocales(locales)},getSupportedLocales:function(){return blocale.getSupportedLocales()},getDefaultLanguage:function(){return blocale.getDefaultLanguage()},getSupportedLanguages:function(){return blocale.getSupportedLanguages()},purge:function(){bm.purge();cs.purge("Oskari")},getDomManager:function(){return domMgr},setDomManager:function(dm){domMgr=dm},getSandbox:function(sandboxName){return ga.apply(cs,[sandboxName||"sandbox"])},setSandbox:function(sandboxName,sandbox){return ga.apply(cs,[sandboxName||"sandbox",sandbox])},cls:function(clazzName,ctor,protoProps,metas){var clazzInfo;return clazzName?clazzInfo=cs.lookup(clazzName):clazzName=["Oskari","_",++o2anonclass].join("."),clazzInfo&&clazzInfo._constructor&&!ctor||(clazzInfo=cs.define(clazzName,ctor||function(){},protoProps,metas||{})),cs.create("Oskari.ModuleSpec",clazzInfo,clazzName)},sandbox:function(sandboxName){var sandboxref={sandbox:ga.apply(cs,[sandboxName||"sandbox"])};return sandboxref.on=function(instance){var me=this,p,r;if(instance.eventHandlers)for(p in instance.eventHandlers)instance.eventHandlers.hasOwnProperty(p)&&me.sandbox.registerForEventByName(instance,p);if(instance.requestHandlers)for(r in instance.requestHandlers)instance.requestHandlers.hasOwnProperty(r)&&me.sandbox.addRequestHandler(r,reqHandlers[r])},sandboxref.off=function(instance){var me=this,p,r;if(instance.eventHandlers)for(p in instance.eventHandlers)instance.eventHandlers.hasOwnProperty(p)&&me.sandbox.unregisterFromEventByName(instance,p);if(instance.requestHandlers)for(r in instance.requestHandlers)instance.requestHandlers.hasOwnProperty(r)&&me.sandbox.removeRequestHandler(r,reqHandlers[r])},sandboxref.slicer=Array.prototype.slice,sandboxref.notify=function(eventName){var me=this,sandbox=me.sandbox,builder=me.sandbox.getEventBuilder(eventName),args=me.slicer.apply(arguments,[1]),eventObj=builder.apply(builder,args);return sandbox.notifyAll(eventObj)},sandboxref},loc:function(){return o2main.registerLocalization.apply(o2main,arguments)}},o2main=bndl,o2main.eventCls=function(eventName,constructor,protoProps){var clazzName=["Oskari","event","registry",eventName].join("."),rv=o2main.cls(clazzName,constructor,protoProps,{protocol:["Oskari.mapframework.event.Event"]});return rv.category({getName:function(){return eventName}},"___event"),rv.eventName=eventName,rv},o2main.requestCls=function(requestName,constructor,protoProps){var clazzName=["Oskari","request","registry",requestName].join("."),rv=o2main.cls(clazzName,constructor,protoProps,{protocol:["Oskari.mapframework.request.Request"]});return rv.category({getName:function(){return requestName}},"___request"),rv.requestName=requestName,rv},o2main._baseClassFor={extension:"Oskari.userinterface.extension.EnhancedExtension",bundle:"Oskari.mapframework.bundle.extension.ExtensionBundle",tile:"Oskari.userinterface.extension.EnhancedTile",flyout:"Oskari.userinterface.extension.EnhancedFlyout",view:"Oskari.userinterface.extension.EnhancedView"},o2main.extensionCls=function(clazzName){return o2main.cls(clazzName).extend(this._baseClassFor.extension)},o2main.bundleCls=function(bnldId,clazzName){bnldId||(bnldId=["__",++o2anonbundle].join("_"));var rv=o2main.cls(clazzName,function(){},{update:function(){}},{protocol:["Oskari.bundle.Bundle",this._baseClassFor.bundle],manifest:{"Bundle-Identifier":bnldId}});return bm.installBundlePdefsp(bnldId,rv.clazzInfo),rv.___bundleIdentifier=bnldId,rv.loc=function(props){return props.key=this.___bundleIdentifier,o2main.registerLocalization(props),rv},rv.start=function(){var bundleid=this.___bundleIdentifier,b,bi,configProps,ip;if(fcd.bundles[bundleid]||(b=bm.createBundle(bundleid,bundleid),fcd.bundles[bundleid]=b),bi=bm.createInstance(bundleid),fcd.bundleInstances[bundleid]=bi,configProps=fcd.getBundleInstanceConfigurationByName(bundleid),configProps)for(ip in configProps)configProps.hasOwnProperty(ip)&&(bi[ip]=configProps[ip]);return bi.start(),bi},rv.stop=function(){var bundleid=this.___bundleIdentifier,bi=fcd.bundleInstances[bundleid];return bi.stop()},rv},o2main.flyoutCls=function(clazzName){return o2main.cls(clazzName).extend(this._baseClassFor.flyout)},o2main.tileCls=function(clazzName){return o2main.cls(clazzName).extend(this._baseClassFor.tile)},o2main.viewCls=function(clazzName){return o2main.cls(clazzName).extend(this._baseClassFor.view)},ga.apply(cs,["Oskari",bndl]),bndl}();OpenLayers={VERSION_NUMBER:"Release 2.12",singleFile:!0,_getScriptLocation:function(){for(var m,r=new RegExp("(^|(.*?\\/))(OpenLayers.js)(\\?|$)"),s=document.getElementsByTagName("script"),src,l="",i=0,len=s.length;i<len;i++)if(src=s[i].getAttribute("src"),src&&(m=src.match(r),m)){l=m[1];break}return function(){return l}}()};Proj4js={},function(){Oskari.clazz.define("Oskari.openlayers.bundle.openlayers-single-full.OpenLayersBundle",function(){},{create:function(){return this},update:function(){},start:function(){},stop:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.bundle.BundleInstance"],source:{scripts:[{type:"text/javascript",src:"../../../../libraries/proj4js-1.0.1/proj4js-compressed.js"},{type:"text/javascript",src:"../../../../libraries/OpenLayers/OpenLayers-2.12-c5bb52d-patched.js"}]},bundle:{manifest:{"Bundle-Identifier":"openlayers-map-full","Bundle-Name":"mapframework.openlayers.mapfull.Bundle","Bundle-Author":[{Name:"ah",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:[{Part:"OpenLayers","License-Name":"BSD","License-Online-Resource":"http://svn.openlayers.org/trunk/openlayers/license.txt"},{Part:"Proj4JS","License-Name":"LGPL/BSD","License-Online-Resource":""}]}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}});Oskari.bundle_manager.installBundleClass("openlayers-single-full","Oskari.openlayers.bundle.openlayers-single-full.OpenLayersBundle")}();Proj4js={defaultDatum:"WGS84",transform:function(source,dest,point){if(!source.readyToUse||!dest.readyToUse)return this.reportError("Proj4js initialization for "+source.srsCode+" not yet complete"),point;if(source.srsProjNumber=="900913"&&dest.datumCode!="WGS84"||dest.srsProjNumber=="900913"&&source.datumCode!="WGS84"){var wgs84=Proj4js.WGS84;this.transform(source,wgs84,point);source=wgs84}return source.projName=="longlat"?(point.x*=Proj4js.common.D2R,point.y*=Proj4js.common.D2R):(source.to_meter&&(point.x*=source.to_meter,point.y*=source.to_meter),source.inverse(point)),source.from_greenwich&&(point.x+=source.from_greenwich),point=this.datum_transform(source.datum,dest.datum,point),dest.from_greenwich&&(point.x-=dest.from_greenwich),dest.projName=="longlat"?(point.x*=Proj4js.common.R2D,point.y*=Proj4js.common.R2D):(dest.forward(point),dest.to_meter&&(point.x/=dest.to_meter,point.y/=dest.to_meter)),point},datum_transform:function(source,dest,point){return source.compare_datums(dest)?point:source.datum_type==Proj4js.common.PJD_NODATUM||dest.datum_type==Proj4js.common.PJD_NODATUM?point:(source.datum_type==Proj4js.common.PJD_GRIDSHIFT&&alert("ERROR: Grid shift transformations are not implemented yet."),dest.datum_type==Proj4js.common.PJD_GRIDSHIFT&&alert("ERROR: Grid shift transformations are not implemented yet."),(source.es!=dest.es||source.a!=dest.a||source.datum_type==Proj4js.common.PJD_3PARAM||source.datum_type==Proj4js.common.PJD_7PARAM||dest.datum_type==Proj4js.common.PJD_3PARAM||dest.datum_type==Proj4js.common.PJD_7PARAM)&&(source.geodetic_to_geocentric(point),(source.datum_type==Proj4js.common.PJD_3PARAM||source.datum_type==Proj4js.common.PJD_7PARAM)&&source.geocentric_to_wgs84(point),(dest.datum_type==Proj4js.common.PJD_3PARAM||dest.datum_type==Proj4js.common.PJD_7PARAM)&&dest.geocentric_from_wgs84(point),dest.geocentric_to_geodetic(point)),dest.datum_type==Proj4js.common.PJD_GRIDSHIFT&&alert("ERROR: Grid shift transformations are not implemented yet."),point)},reportError:function(){},extend:function(destination,source){var property,value;if(destination=destination||{},source)for(property in source)value=source[property],value!==undefined&&(destination[property]=value);return destination},Class:function(){for(var Class=function(){this.initialize.apply(this,arguments)},extended={},parent,i=0;i<arguments.length;++i)parent=typeof arguments[i]=="function"?arguments[i].prototype:arguments[i],Proj4js.extend(extended,parent);return Class.prototype=extended,Class},bind:function(func,object){var args=Array.prototype.slice.apply(arguments,[2]);return function(){var newArgs=args.concat(Array.prototype.slice.apply(arguments,[0]));return func.apply(object,newArgs)}},scriptName:"proj4js-compressed.js",defsLookupService:"http://spatialreference.org/ref",libPath:null,getScriptLocation:function(){var i,src,index;if(this.libPath)return this.libPath;var scriptName=this.scriptName,scriptNameLen=scriptName.length,scripts=document.getElementsByTagName("script");for(i=0;i<scripts.length;i++)if(src=scripts[i].getAttribute("src"),src&&(index=src.lastIndexOf(scriptName),index>-1&&index+scriptNameLen==src.length)){this.libPath=src.slice(0,-scriptNameLen);break}return this.libPath||""},loadScript:function(url,onload,onfail,loadCheck){var script=document.createElement("script");script.defer=!1;script.type="text/javascript";script.id=url;script.src=url;script.onload=onload;script.onerror=onfail;script.loadCheck=loadCheck;/MSIE/.test(navigator.userAgent)&&(script.onreadystatechange=this.checkReadyState);document.getElementsByTagName("head")[0].appendChild(script)},checkReadyState:function(){this.readyState=="loaded"&&(this.loadCheck()?this.onload():this.onerror())}};Proj4js.Proj=Proj4js.Class({readyToUse:!1,title:null,projName:null,units:null,datum:null,x0:0,y0:0,initialize:function(srsCode){var urn,url;this.srsCodeInput=srsCode;srsCode.indexOf("urn:")==0?(urn=srsCode.split(":"),(urn[1]=="ogc"||urn[1]=="x-ogc")&&urn[2]=="def"&&urn[3]=="crs"&&(srsCode=urn[4]+":"+urn[urn.length-1])):srsCode.indexOf("http://")==0&&(url=srsCode.split("#"),url[0].match(/epsg.org/)?srsCode="EPSG:"+url[1]:url[0].match(/RIG.xml/)&&(srsCode="IGNF:"+url[1]));this.srsCode=srsCode.toUpperCase();this.srsCode.indexOf("EPSG")==0?(this.srsCode=this.srsCode,this.srsAuth="epsg",this.srsProjNumber=this.srsCode.substring(5)):this.srsCode.indexOf("IGNF")==0?(this.srsCode=this.srsCode,this.srsAuth="IGNF",this.srsProjNumber=this.srsCode.substring(5)):this.srsCode.indexOf("CRS")==0?(this.srsCode=this.srsCode,this.srsAuth="CRS",this.srsProjNumber=this.srsCode.substring(4)):(this.srsAuth="",this.srsProjNumber=this.srsCode);this.loadProjDefinition()},loadProjDefinition:function(){if(Proj4js.defs[this.srsCode]){this.defsLoaded();return}var url=Proj4js.getScriptLocation()+"defs/"+this.srsAuth.toUpperCase()+this.srsProjNumber+".js";Proj4js.loadScript(url,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.loadFromService,this),Proj4js.bind(this.checkDefsLoaded,this))},loadFromService:function(){var url=Proj4js.defsLookupService+"/"+this.srsAuth+"/"+this.srsProjNumber+"/proj4js/";Proj4js.loadScript(url,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.defsFailed,this),Proj4js.bind(this.checkDefsLoaded,this))},defsLoaded:function(){this.parseDefs();this.loadProjCode(this.projName)},checkDefsLoaded:function(){return Proj4js.defs[this.srsCode]?!0:!1},defsFailed:function(){Proj4js.reportError("failed to load projection definition for: "+this.srsCode);Proj4js.defs[this.srsCode]=Proj4js.defs.WGS84;this.defsLoaded()},loadProjCode:function(projName){if(Proj4js.Proj[projName]){this.initTransforms();return}var url=Proj4js.getScriptLocation()+"projCode/"+projName+".js";Proj4js.loadScript(url,Proj4js.bind(this.loadProjCodeSuccess,this,projName),Proj4js.bind(this.loadProjCodeFailure,this,projName),Proj4js.bind(this.checkCodeLoaded,this,projName))},loadProjCodeSuccess:function(projName){Proj4js.Proj[projName].dependsOn?this.loadProjCode(Proj4js.Proj[projName].dependsOn):this.initTransforms()},loadProjCodeFailure:function(projName){Proj4js.reportError("failed to find projection file for: "+projName)},checkCodeLoaded:function(projName){return Proj4js.Proj[projName]?!0:!1},initTransforms:function(){Proj4js.extend(this,Proj4js.Proj[this.projName]);this.init();this.readyToUse=!0},parseDefs:function(){var paramName,paramVal,paramArray,prop,property;if(this.defData=Proj4js.defs[this.srsCode],this.defData){for(paramArray=this.defData.split("+"),prop=0;prop<paramArray.length;prop++){property=paramArray[prop].split("=");paramName=property[0].toLowerCase();paramVal=property[1];switch(paramName.replace(/\s/gi,"")){case"title":this.title=paramVal;break;case"proj":this.projName=paramVal.replace(/\s/gi,"");break;case"units":this.units=paramVal.replace(/\s/gi,"");break;case"datum":this.datumCode=paramVal.replace(/\s/gi,"");break;case"nadgrids":this.nagrids=paramVal.replace(/\s/gi,"");break;case"ellps":this.ellps=paramVal.replace(/\s/gi,"");break;case"a":this.a=parseFloat(paramVal);break;case"b":this.b=parseFloat(paramVal);break;case"rf":this.rf=parseFloat(paramVal);break;case"lat_0":this.lat0=paramVal*Proj4js.common.D2R;break;case"lat_1":this.lat1=paramVal*Proj4js.common.D2R;break;case"lat_2":this.lat2=paramVal*Proj4js.common.D2R;break;case"lat_ts":this.lat_ts=paramVal*Proj4js.common.D2R;break;case"lon_0":this.long0=paramVal*Proj4js.common.D2R;break;case"alpha":this.alpha=parseFloat(paramVal)*Proj4js.common.D2R;break;case"lonc":this.longc=paramVal*Proj4js.common.D2R;break;case"x_0":this.x0=parseFloat(paramVal);break;case"y_0":this.y0=parseFloat(paramVal);break;case"k_0":this.k0=parseFloat(paramVal);break;case"k":this.k0=parseFloat(paramVal);break;case"r_a":this.R_A=!0;break;case"zone":this.zone=parseInt(paramVal);break;case"south":this.utmSouth=!0;break;case"towgs84":this.datum_params=paramVal.split(",");break;case"to_meter":this.to_meter=parseFloat(paramVal);break;case"from_greenwich":this.from_greenwich=paramVal*Proj4js.common.D2R;break;case"pm":paramVal=paramVal.replace(/\s/gi,"");this.from_greenwich=Proj4js.PrimeMeridian[paramVal]?Proj4js.PrimeMeridian[paramVal]:parseFloat(paramVal);this.from_greenwich*=Proj4js.common.D2R}}this.deriveConstants()}},deriveConstants:function(){var datumDef,ellipse;this.nagrids=="@null"&&(this.datumCode="none");this.datumCode&&this.datumCode!="none"&&(datumDef=Proj4js.Datum[this.datumCode],datumDef&&(this.datum_params=datumDef.towgs84?datumDef.towgs84.split(","):null,this.ellps=datumDef.ellipse,this.datumName=datumDef.datumName?datumDef.datumName:this.datumCode));this.a||(ellipse=Proj4js.Ellipsoid[this.ellps]?Proj4js.Ellipsoid[this.ellps]:Proj4js.Ellipsoid.WGS84,Proj4js.extend(this,ellipse));this.rf&&!this.b&&(this.b=(1-1/this.rf)*this.a);Math.abs(this.a-this.b)<Proj4js.common.EPSLN&&(this.sphere=!0,this.b=this.a);this.a2=this.a*this.a;this.b2=this.b*this.b;this.es=(this.a2-this.b2)/this.a2;this.e=Math.sqrt(this.es);this.R_A&&(this.a*=1-this.es*(Proj4js.common.SIXTH+this.es*(Proj4js.common.RA4+this.es*Proj4js.common.RA6)),this.a2=this.a*this.a,this.b2=this.b*this.b,this.es=0);this.ep2=(this.a2-this.b2)/this.b2;this.k0||(this.k0=1);this.datum=new Proj4js.datum(this)}});Proj4js.Proj.longlat={init:function(){},forward:function(pt){return pt},inverse:function(pt){return pt}};Proj4js.defs={WGS84:"+title=long/lat:WGS84 +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4326":"+title=long/lat:WGS84 +proj=longlat +a=6378137.0 +b=6356752.31424518 +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4269":"+title=long/lat:NAD83 +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees","EPSG:3785":"+title= Google Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"};Proj4js.defs.GOOGLE=Proj4js.defs["EPSG:3785"];Proj4js.defs["EPSG:900913"]=Proj4js.defs["EPSG:3785"];Proj4js.defs["EPSG:102113"]=Proj4js.defs["EPSG:3785"];Proj4js.common={PI:3.1415926535897931,HALF_PI:1.5707963267948966,TWO_PI:6.2831853071795862,FORTPI:.78539816339744828,R2D:57.295779513082323,D2R:.017453292519943295,SEC_TO_RAD:484813681109536e-20,EPSLN:1e-10,MAX_ITER:20,COS_67P5:.38268343236508978,AD_C:1.0026,PJD_UNKNOWN:0,PJD_3PARAM:1,PJD_7PARAM:2,PJD_GRIDSHIFT:3,PJD_WGS84:4,PJD_NODATUM:5,SRS_WGS84_SEMIMAJOR:6378137,SIXTH:.16666666666666666,RA4:.047222222222222221,RA6:.022156084656084655,RV4:.069444444444444448,RV6:.042438271604938273,msfnz:function(eccent,sinphi,cosphi){var con=eccent*sinphi;return cosphi/Math.sqrt(1-con*con)},tsfnz:function(eccent,phi,sinphi){var con=eccent*sinphi,com=.5*eccent;return con=Math.pow((1-con)/(1+con),com),Math.tan(.5*(this.HALF_PI-phi))/con},phi2z:function(eccent,ts){var eccnth=.5*eccent,con,dphi,phi=this.HALF_PI-2*Math.atan(ts);for(i=0;i<=15;i++)if(con=eccent*Math.sin(phi),dphi=this.HALF_PI-2*Math.atan(ts*Math.pow((1-con)/(1+con),eccnth))-phi,phi+=dphi,Math.abs(dphi)<=1e-10)return phi;return alert("phi2z has NoConvergence"),-9999},qsfnz:function(eccent,sinphi){var con;return eccent>1e-7?(con=eccent*sinphi,(1-eccent*eccent)*(sinphi/(1-con*con)-.5/eccent*Math.log((1-con)/(1+con)))):2*sinphi},asinz:function(x){return Math.abs(x)>1&&(x=x>1?1:-1),Math.asin(x)},e0fn:function(x){return 1-.25*x*(1+x/16*(3+1.25*x))},e1fn:function(x){return.375*x*(1+.25*x*(1+.46875*x))},e2fn:function(x){return.05859375*x*x*(1+.75*x)},e3fn:function(x){return x*x*x*(35/3072)},mlfn:function(e0,e1,e2,e3,phi){return e0*phi-e1*Math.sin(2*phi)+e2*Math.sin(4*phi)-e3*Math.sin(6*phi)},srat:function(esinp,exp){return Math.pow((1-esinp)/(1+esinp),exp)},sign:function(x){return x<0?-1:1},adjust_lon:function(x){return Math.abs(x)<this.PI?x:x-this.sign(x)*this.TWO_PI},adjust_lat:function(x){return Math.abs(x)<this.HALF_PI?x:x-this.sign(x)*this.PI},latiso:function(eccent,phi,sinphi){if(Math.abs(phi)>this.HALF_PI)return+Number.NaN;if(phi==this.HALF_PI)return Number.POSITIVE_INFINITY;if(phi==-1*this.HALF_PI)return-1*Number.POSITIVE_INFINITY;var con=eccent*sinphi;return Math.log(Math.tan((this.HALF_PI+phi)/2))+eccent*Math.log((1-con)/(1+con))/2},fL:function(x,L){return 2*Math.atan(x*Math.exp(L))-this.HALF_PI},invlatiso:function(eccent,ts){var phi=this.fL(1,ts),Iphi=0,con=0;do Iphi=phi,con=eccent*Math.sin(Iphi),phi=this.fL(Math.exp(eccent*Math.log((1+con)/(1-con))/2),ts);while(Math.abs(phi-Iphi)>1e-12);return phi},sinh:function(x){var r=Math.exp(x);return(r-1/r)/2},cosh:function(x){var r=Math.exp(x);return(r+1/r)/2},tanh:function(x){var r=Math.exp(x);return(r-1/r)/(r+1/r)},asinh:function(x){var s=x>=0?1:-1;return s*Math.log(Math.abs(x)+Math.sqrt(x*x+1))},acosh:function(x){return 2*Math.log(Math.sqrt((x+1)/2)+Math.sqrt((x-1)/2))},atanh:function(x){return Math.log((x-1)/(x+1))/2},gN:function(a,e,sinphi){var temp=e*sinphi;return a/Math.sqrt(1-temp*temp)}};Proj4js.datum=Proj4js.Class({initialize:function(proj){if(this.datum_type=Proj4js.common.PJD_WGS84,proj.datumCode&&proj.datumCode=="none"&&(this.datum_type=Proj4js.common.PJD_NODATUM),proj&&proj.datum_params){for(var i=0;i<proj.datum_params.length;i++)proj.datum_params[i]=parseFloat(proj.datum_params[i]);(proj.datum_params[0]!=0||proj.datum_params[1]!=0||proj.datum_params[2]!=0)&&(this.datum_type=Proj4js.common.PJD_3PARAM);proj.datum_params.length>3&&(proj.datum_params[3]!=0||proj.datum_params[4]!=0||proj.datum_params[5]!=0||proj.datum_params[6]!=0)&&(this.datum_type=Proj4js.common.PJD_7PARAM,proj.datum_params[3]*=Proj4js.common.SEC_TO_RAD,proj.datum_params[4]*=Proj4js.common.SEC_TO_RAD,proj.datum_params[5]*=Proj4js.common.SEC_TO_RAD,proj.datum_params[6]=proj.datum_params[6]/1e6+1)}proj&&(this.a=proj.a,this.b=proj.b,this.es=proj.es,this.ep2=proj.ep2,this.datum_params=proj.datum_params)},compare_datums:function(dest){return this.datum_type!=dest.datum_type?!1:this.a!=dest.a||Math.abs(this.es-dest.es)>5e-11?!1:this.datum_type==Proj4js.common.PJD_3PARAM?this.datum_params[0]==dest.datum_params[0]&&this.datum_params[1]==dest.datum_params[1]&&this.datum_params[2]==dest.datum_params[2]:this.datum_type==Proj4js.common.PJD_7PARAM?this.datum_params[0]==dest.datum_params[0]&&this.datum_params[1]==dest.datum_params[1]&&this.datum_params[2]==dest.datum_params[2]&&this.datum_params[3]==dest.datum_params[3]&&this.datum_params[4]==dest.datum_params[4]&&this.datum_params[5]==dest.datum_params[5]&&this.datum_params[6]==dest.datum_params[6]:this.datum_type==Proj4js.common.PJD_GRIDSHIFT?strcmp(pj_param(this.params,"snadgrids").s,pj_param(dest.params,"snadgrids").s)==0:!0},geodetic_to_geocentric:function(p){var Longitude=p.x,Latitude=p.y,Height=p.z?p.z:0,X,Y,Z,Rn,Sin_Lat,Sin2_Lat,Cos_Lat;if(Latitude<-Proj4js.common.HALF_PI&&Latitude>-1.001*Proj4js.common.HALF_PI)Latitude=-Proj4js.common.HALF_PI;else if(Latitude>Proj4js.common.HALF_PI&&Latitude<1.001*Proj4js.common.HALF_PI)Latitude=Proj4js.common.HALF_PI;else if(Latitude<-Proj4js.common.HALF_PI||Latitude>Proj4js.common.HALF_PI)return Proj4js.reportError("geocent:lat out of range:"+Latitude),null;return Longitude>Proj4js.common.PI&&(Longitude-=2*Proj4js.common.PI),Sin_Lat=Math.sin(Latitude),Cos_Lat=Math.cos(Latitude),Sin2_Lat=Sin_Lat*Sin_Lat,Rn=this.a/Math.sqrt(1-this.es*Sin2_Lat),X=(Rn+Height)*Cos_Lat*Math.cos(Longitude),Y=(Rn+Height)*Cos_Lat*Math.sin(Longitude),Z=(Rn*(1-this.es)+Height)*Sin_Lat,p.x=X,p.y=Y,p.z=Z,0},geocentric_to_geodetic:function(p){var genau=1e-12,genau2=genau*genau,P,RR,CT,ST,RX,RK,RN,CPHI0,SPHI0,CPHI,SPHI,SDPHI,At_Pole,iter,X=p.x,Y=p.y,Z=p.z?p.z:0,Longitude,Latitude,Height;if(At_Pole=!1,P=Math.sqrt(X*X+Y*Y),RR=Math.sqrt(X*X+Y*Y+Z*Z),P/this.a<genau){if(At_Pole=!0,Longitude=0,RR/this.a<genau){Latitude=Proj4js.common.HALF_PI;Height=-this.b;return}}else Longitude=Math.atan2(Y,X);CT=Z/RR;ST=P/RR;RX=1/Math.sqrt(1-this.es*(2-this.es)*ST*ST);CPHI0=ST*(1-this.es)*RX;SPHI0=CT*RX;iter=0;do iter++,RN=this.a/Math.sqrt(1-this.es*SPHI0*SPHI0),Height=P*CPHI0+Z*SPHI0-RN*(1-this.es*SPHI0*SPHI0),RK=this.es*RN/(RN+Height),RX=1/Math.sqrt(1-RK*(2-RK)*ST*ST),CPHI=ST*(1-RK)*RX,SPHI=CT*RX,SDPHI=SPHI*CPHI0-CPHI*SPHI0,CPHI0=CPHI,SPHI0=SPHI;while(SDPHI*SDPHI>genau2&&iter<30);return Latitude=Math.atan(SPHI/Math.abs(CPHI)),p.x=Longitude,p.y=Latitude,p.z=Height,p},geocentric_to_geodetic_noniter:function(p){var X=p.x,Y=p.y,Z=p.z?p.z:0,Longitude,Latitude,Height,W,W2,T0,T1,S0,S1,Sin_B0,Sin3_B0,Cos_B0,Sin_p1,Cos_p1,Rn,Sum,At_Pole;if(X=parseFloat(X),Y=parseFloat(Y),Z=parseFloat(Z),At_Pole=!1,X!=0)Longitude=Math.atan2(Y,X);else if(Y>0)Longitude=Proj4js.common.HALF_PI;else if(Y<0)Longitude=-Proj4js.common.HALF_PI;else if(At_Pole=!0,Longitude=0,Z>0)Latitude=Proj4js.common.HALF_PI;else if(Z<0)Latitude=-Proj4js.common.HALF_PI;else{Latitude=Proj4js.common.HALF_PI;Height=-this.b;return}return W2=X*X+Y*Y,W=Math.sqrt(W2),T0=Z*Proj4js.common.AD_C,S0=Math.sqrt(T0*T0+W2),Sin_B0=T0/S0,Cos_B0=W/S0,Sin3_B0=Sin_B0*Sin_B0*Sin_B0,T1=Z+this.b*this.ep2*Sin3_B0,Sum=W-this.a*this.es*Cos_B0*Cos_B0*Cos_B0,S1=Math.sqrt(T1*T1+Sum*Sum),Sin_p1=T1/S1,Cos_p1=Sum/S1,Rn=this.a/Math.sqrt(1-this.es*Sin_p1*Sin_p1),Height=Cos_p1>=Proj4js.common.COS_67P5?W/Cos_p1-Rn:Cos_p1<=-Proj4js.common.COS_67P5?W/-Cos_p1-Rn:Z/Sin_p1+Rn*(this.es-1),At_Pole==!1&&(Latitude=Math.atan(Sin_p1/Cos_p1)),p.x=Longitude,p.y=Latitude,p.z=Height,p},geocentric_to_wgs84:function(p){if(this.datum_type==Proj4js.common.PJD_3PARAM)p.x+=this.datum_params[0],p.y+=this.datum_params[1],p.z+=this.datum_params[2];else if(this.datum_type==Proj4js.common.PJD_7PARAM){var Dx_BF=this.datum_params[0],Dy_BF=this.datum_params[1],Dz_BF=this.datum_params[2],Rx_BF=this.datum_params[3],Ry_BF=this.datum_params[4],Rz_BF=this.datum_params[5],M_BF=this.datum_params[6],x_out=M_BF*(p.x-Rz_BF*p.y+Ry_BF*p.z)+Dx_BF,y_out=M_BF*(Rz_BF*p.x+p.y-Rx_BF*p.z)+Dy_BF,z_out=M_BF*(-Ry_BF*p.x+Rx_BF*p.y+p.z)+Dz_BF;p.x=x_out;p.y=y_out;p.z=z_out}},geocentric_from_wgs84:function(p){if(this.datum_type==Proj4js.common.PJD_3PARAM)p.x-=this.datum_params[0],p.y-=this.datum_params[1],p.z-=this.datum_params[2];else if(this.datum_type==Proj4js.common.PJD_7PARAM){var Dx_BF=this.datum_params[0],Dy_BF=this.datum_params[1],Dz_BF=this.datum_params[2],Rx_BF=this.datum_params[3],Ry_BF=this.datum_params[4],Rz_BF=this.datum_params[5],M_BF=this.datum_params[6],x_tmp=(p.x-Dx_BF)/M_BF,y_tmp=(p.y-Dy_BF)/M_BF,z_tmp=(p.z-Dz_BF)/M_BF;p.x=x_tmp+Rz_BF*y_tmp-Ry_BF*z_tmp;p.y=-Rz_BF*x_tmp+y_tmp+Rx_BF*z_tmp;p.z=Ry_BF*x_tmp-Rx_BF*y_tmp+z_tmp}}});Proj4js.Point=Proj4js.Class({initialize:function(x,y,z){if(typeof x=="object")this.x=x[0],this.y=x[1],this.z=x[2]||0;else if(typeof x=="string"){var coords=x.split(",");this.x=parseFloat(coords[0]);this.y=parseFloat(coords[1]);this.z=parseFloat(coords[2])||0}else this.x=x,this.y=y,this.z=z||0},clone:function(){return new Proj4js.Point(this.x,this.y,this.z)},toString:function(){return"x="+this.x+",y="+this.y},toShortString:function(){return this.x+", "+this.y}});Proj4js.PrimeMeridian={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667};Proj4js.Ellipsoid={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},"APL4.":{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS72:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}};Proj4js.Datum={WGS84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},GGRS87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},NAD83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},NAD27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},OSGB36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"}};Proj4js.WGS84=new Proj4js.Proj("WGS84");Proj4js.Datum.OSB36=Proj4js.Datum.OSGB36;Proj4js.Proj.aea={init:function(){if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError("aeaInitEqualLatitudes");return}this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e3=Math.sqrt(this.es);this.sin_po=Math.sin(this.lat1);this.cos_po=Math.cos(this.lat1);this.t1=this.sin_po;this.con=this.sin_po;this.ms1=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po);this.qs1=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);this.sin_po=Math.sin(this.lat2);this.cos_po=Math.cos(this.lat2);this.t2=this.sin_po;this.ms2=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po);this.qs2=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);this.sin_po=Math.sin(this.lat0);this.cos_po=Math.cos(this.lat0);this.t3=this.sin_po;this.qs0=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);this.ns0=Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN?(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.con;this.c=this.ms1*this.ms1+this.ns0*this.qs1;this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0},forward:function(p){var lon=p.x,lat=p.y;this.sin_phi=Math.sin(lat);this.cos_phi=Math.cos(lat);var qs=Proj4js.common.qsfnz(this.e3,this.sin_phi,this.cos_phi),rh1=this.a*Math.sqrt(this.c-this.ns0*qs)/this.ns0,theta=this.ns0*Proj4js.common.adjust_lon(lon-this.long0),x=rh1*Math.sin(theta)+this.x0,y=this.rh-rh1*Math.cos(theta)+this.y0;return p.x=x,p.y=y,p},inverse:function(p){var rh1,qs,con,theta,lon,lat;return p.x-=this.x0,p.y=this.rh-p.y+this.y0,this.ns0>=0?(rh1=Math.sqrt(p.x*p.x+p.y*p.y),con=1):(rh1=-Math.sqrt(p.x*p.x+p.y*p.y),con=-1),theta=0,rh1!=0&&(theta=Math.atan2(con*p.x,con*p.y)),con=rh1*this.ns0/this.a,qs=(this.c-con*con)/this.ns0,this.e3>=1e-10?(con=1-.5*(1-this.es)*Math.log((1-this.e3)/(1+this.e3))/this.e3,lat=Math.abs(Math.abs(con)-Math.abs(qs))>1e-10?this.phi1z(this.e3,qs):qs>=0?.5*PI:-.5*PI):lat=this.phi1z(e3,qs),lon=Proj4js.common.adjust_lon(theta/this.ns0+this.long0),p.x=lon,p.y=lat,p},phi1z:function(eccent,qs){var con,com,dphi,phi=Proj4js.common.asinz(.5*qs),eccnts,i;if(eccent<Proj4js.common.EPSLN)return phi;for(eccnts=eccent*eccent,i=1;i<=25;i++)if(sinphi=Math.sin(phi),cosphi=Math.cos(phi),con=eccent*sinphi,com=1-con*con,dphi=.5*com*com/cosphi*(qs/(1-eccnts)-sinphi/com+.5/eccent*Math.log((1-con)/(1+con))),phi=phi+dphi,Math.abs(dphi)<=1e-7)return phi;return Proj4js.reportError("aea:phi1z:Convergence error"),null}};Proj4js.Proj.sterea={dependsOn:"gauss",init:function(){if(Proj4js.Proj.gauss.init.apply(this),!this.rc){Proj4js.reportError("sterea:init:E_ERROR_0");return}this.sinc0=Math.sin(this.phic0);this.cosc0=Math.cos(this.phic0);this.R2=2*this.rc;this.title||(this.title="Oblique Stereographic Alternative")},forward:function(p){return p.x=Proj4js.common.adjust_lon(p.x-this.long0),Proj4js.Proj.gauss.forward.apply(this,[p]),sinc=Math.sin(p.y),cosc=Math.cos(p.y),cosl=Math.cos(p.x),k=this.k0*this.R2/(1+this.sinc0*sinc+this.cosc0*cosc*cosl),p.x=k*cosc*Math.sin(p.x),p.y=k*(this.cosc0*sinc-this.sinc0*cosc*cosl),p.x=this.a*p.x+this.x0,p.y=this.a*p.y+this.y0,p},inverse:function(p){var lon,lat;return p.x=(p.x-this.x0)/this.a,p.y=(p.y-this.y0)/this.a,p.x/=this.k0,p.y/=this.k0,(rho=Math.sqrt(p.x*p.x+p.y*p.y))?(c=2*Math.atan2(rho,this.R2),sinc=Math.sin(c),cosc=Math.cos(c),lat=Math.asin(cosc*this.sinc0+p.y*sinc*this.cosc0/rho),lon=Math.atan2(p.x*sinc,rho*this.cosc0*cosc-p.y*this.sinc0*sinc)):(lat=this.phic0,lon=0),p.x=lon,p.y=lat,Proj4js.Proj.gauss.inverse.apply(this,[p]),p.x=Proj4js.common.adjust_lon(p.x+this.long0),p}};Proj4js.Proj.poly={init:function(){(this.lat0=0)&&(this.lat0=90);this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e=Math.sqrt(this.es);this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(p){var sinphi,cosphi,con,ml,ms,x,y,lon=p.x,lat=p.y;return con=Proj4js.common.adjust_lon(lon-this.long0),Math.abs(lat)<=1e-7?(x=this.x0+this.a*con,y=this.y0-this.a*this.ml0):(sinphi=Math.sin(lat),cosphi=Math.cos(lat),ml=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,lat),ms=Proj4js.common.msfnz(this.e,sinphi,cosphi),con=sinphi,x=this.x0+this.a*ms*Math.sin(con)/sinphi,y=this.y0+this.a*(ml-this.ml0+ms*(1-Math.cos(con))/sinphi)),p.x=x,p.y=y,p},inverse:function(p){var al,b,c,iflg,lon,lat;if(p.x-=this.x0,p.y-=this.y0,al=this.ml0+p.y/this.a,iflg=0,Math.abs(al)<=1e-7)lon=p.x/this.a+this.long0,lat=0;else{if(b=al*al+p.x/this.a*(p.x/this.a),iflg=phi4z(this.es,this.e0,this.e1,this.e2,this.e3,this.al,b,c,lat),iflg!=1)return iflg;lon=Proj4js.common.adjust_lon(Proj4js.common.asinz(p.x*c/this.a)/Math.sin(lat)+this.long0)}return p.x=lon,p.y=lat,p}};Proj4js.Proj.equi={init:function(){this.x0||(this.x0=0);this.y0||(this.y0=0);this.lat0||(this.lat0=0);this.long0||(this.long0=0)},forward:function(p){var lon=p.x,lat=p.y,dlon=Proj4js.common.adjust_lon(lon-this.long0),x=this.x0+this.a*dlon*Math.cos(this.lat0),y=this.y0+this.a*lat;return this.t1=x,this.t2=Math.cos(this.lat0),p.x=x,p.y=y,p},inverse:function(p){var lat,lon;p.x-=this.x0;p.y-=this.y0;lat=p.y/this.a;Math.abs(lat)>Proj4js.common.HALF_PI&&Proj4js.reportError("equi:Inv:DataError");lon=Proj4js.common.adjust_lon(this.long0+p.x/(this.a*Math.cos(this.lat0)));p.x=lon;p.y=lat}};Proj4js.Proj.merc={init:function(){this.lat_ts&&(this.k0=this.sphere?Math.cos(this.lat_ts):Proj4js.common.msfnz(this.es,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(p){var lon=p.x,lat=p.y,x,y,sinphi,ts;return lat*Proj4js.common.R2D>90&&lat*Proj4js.common.R2D<-90&&lon*Proj4js.common.R2D>180&&lon*Proj4js.common.R2D<-180?(Proj4js.reportError("merc:forward: llInputOutOfRange: "+lon+" : "+lat),null):Math.abs(Math.abs(lat)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN?(Proj4js.reportError("merc:forward: ll2mAtPoles"),null):(this.sphere?(x=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(lon-this.long0),y=this.y0+this.a*this.k0*Math.log(Math.tan(Proj4js.common.FORTPI+.5*lat))):(sinphi=Math.sin(lat),ts=Proj4js.common.tsfnz(this.e,lat,sinphi),x=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(lon-this.long0),y=this.y0-this.a*this.k0*Math.log(ts)),p.x=x,p.y=y,p)},inverse:function(p){var x=p.x-this.x0,y=p.y-this.y0,lon,lat,ts;if(this.sphere)lat=Proj4js.common.HALF_PI-2*Math.atan(Math.exp(-y/this.a*this.k0));else if(ts=Math.exp(-y/(this.a*this.k0)),lat=Proj4js.common.phi2z(this.e,ts),lat==-9999)return Proj4js.reportError("merc:inverse: lat = -9999"),null;return lon=Proj4js.common.adjust_lon(this.long0+x/(this.a*this.k0)),p.x=lon,p.y=lat,p}};Proj4js.Proj.utm={dependsOn:"tmerc",init:function(){if(!this.zone){Proj4js.reportError("utm:init: zone must be specified for UTM");return}this.lat0=0;this.long0=(6*Math.abs(this.zone)-183)*Proj4js.common.D2R;this.x0=5e5;this.y0=this.utmSouth?1e7:0;this.k0=.9996;Proj4js.Proj.tmerc.init.apply(this);this.forward=Proj4js.Proj.tmerc.forward;this.inverse=Proj4js.Proj.tmerc.inverse}};Proj4js.Proj.eqdc={init:function(){this.mode||(this.mode=0);this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e=Math.sqrt(this.es);this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.sinphi=Math.sin(this.lat1);this.cosphi=Math.cos(this.lat1);this.ms1=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi);this.ml1=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat1);this.mode!=0?(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN&&Proj4js.reportError("eqdc:Init:EqualLatitudes"),this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi),this.ml2=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=Math.abs(this.lat1-this.lat2)>=Proj4js.common.EPSLN?(this.ms1-this.ms2)/(this.ml2-this.ml1):this.sinphi):this.ns=this.sinphi;this.g=this.ml1+this.ms1/this.ns;this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0);this.rh=this.a*(this.g-this.ml0)},forward:function(p){var lon=p.x,lat=p.y,ml=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,lat),rh1=this.a*(this.g-ml),theta=this.ns*Proj4js.common.adjust_lon(lon-this.long0),x=this.x0+rh1*Math.sin(theta),y=this.y0+this.rh-rh1*Math.cos(theta);return p.x=x,p.y=y,p},inverse:function(p){var rh1,con,theta;p.x-=this.x0;p.y=this.rh-p.y+this.y0;this.ns>=0?(rh1=Math.sqrt(p.x*p.x+p.y*p.y),con=1):(rh1=-Math.sqrt(p.x*p.x+p.y*p.y),con=-1);theta=0;rh1!=0&&(theta=Math.atan2(con*p.x,con*p.y));var ml=this.g-rh1/this.a,lat=this.phi3z(this.ml,this.e0,this.e1,this.e2,this.e3),lon=Proj4js.common.adjust_lon(this.long0+theta/this.ns);return p.x=lon,p.y=lat,p},phi3z:function(ml,e0,e1,e2,e3){for(var dphi,phi=ml,i=0;i<15;i++)if(dphi=(ml+e1*Math.sin(2*phi)-e2*Math.sin(4*phi)+e3*Math.sin(6*phi))/e0-phi,phi+=dphi,Math.abs(dphi)<=1e-10)return phi;return Proj4js.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations"),null}};Proj4js.Proj.tmerc={init:function(){this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.ml0=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(p){var lon=p.x,lat=p.y,delta_lon=Proj4js.common.adjust_lon(lon-this.long0),con,x,y,sin_phi=Math.sin(lat),cos_phi=Math.cos(lat),b,n,ml;if(this.sphere){if(b=cos_phi*Math.sin(delta_lon),Math.abs(Math.abs(b)-1)<1e-10)return Proj4js.reportError("tmerc:forward: Point projects into infinity"),93;x=.5*this.a*this.k0*Math.log((1+b)/(1-b));con=Math.acos(cos_phi*Math.cos(delta_lon)/Math.sqrt(1-b*b));lat<0&&(con=-con);y=this.a*this.k0*(con-this.lat0)}else{var al=cos_phi*delta_lon,als=Math.pow(al,2),c=this.ep2*Math.pow(cos_phi,2),tq=Math.tan(lat),t=Math.pow(tq,2);con=1-this.es*Math.pow(sin_phi,2);n=this.a/Math.sqrt(con);ml=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,lat);x=this.k0*n*al*(1+als/6*(1-t+c+als/20*(5-18*t+Math.pow(t,2)+72*c-58*this.ep2)))+this.x0;y=this.k0*(ml-this.ml0+n*tq*als*(.5+als/24*(5-t+9*c+4*Math.pow(c,2)+als/30*(61-58*t+Math.pow(t,2)+600*c-330*this.ep2))))+this.y0}return p.x=x,p.y=y,p},inverse:function(p){var con,phi,delta_phi,i,lat,lon,x,y;if(this.sphere){var f=Math.exp(p.x/(this.a*this.k0)),g=.5*(f-1/f),temp=this.lat0+p.y/(this.a*this.k0),h=Math.cos(temp);con=Math.sqrt((1-h*h)/(1+g*g));lat=Proj4js.common.asinz(con);temp<0&&(lat=-lat);lon=g==0&&h==0?this.long0:Proj4js.common.adjust_lon(Math.atan2(g,h)+this.long0)}else{for(x=p.x-this.x0,y=p.y-this.y0,con=(this.ml0+y/this.k0)/this.a,phi=con,i=0;;i++){if(delta_phi=(con+this.e1*Math.sin(2*phi)-this.e2*Math.sin(4*phi)+this.e3*Math.sin(6*phi))/this.e0-phi,phi+=delta_phi,Math.abs(delta_phi)<=Proj4js.common.EPSLN)break;if(i>=6)return Proj4js.reportError("tmerc:inverse: Latitude failed to converge"),95}if(Math.abs(phi)<Proj4js.common.HALF_PI){var sin_phi=Math.sin(phi),cos_phi=Math.cos(phi),tan_phi=Math.tan(phi),c=this.ep2*Math.pow(cos_phi,2),cs=Math.pow(c,2),t=Math.pow(tan_phi,2),ts=Math.pow(t,2);con=1-this.es*Math.pow(sin_phi,2);var n=this.a/Math.sqrt(con),r=n*(1-this.es)/con,d=x/(n*this.k0),ds=Math.pow(d,2);lat=phi-n*tan_phi*ds/r*(.5-ds/24*(5+3*t+10*c-4*cs-9*this.ep2-ds/30*(61+90*t+298*c+45*ts-252*this.ep2-3*cs)));lon=Proj4js.common.adjust_lon(this.long0+d*(1-ds/6*(1+2*t+c-ds/20*(5-2*c+28*t-3*cs+8*this.ep2+24*ts)))/cos_phi)}else lat=Proj4js.common.HALF_PI*Proj4js.common.sign(y),lon=this.long0}return p.x=lon,p.y=lat,p}};Proj4js.defs.GOOGLE="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs";Proj4js.defs["EPSG:900913"]=Proj4js.defs.GOOGLE;Proj4js.Proj.gstmerc={init:function(){var temp=this.b/this.a;this.e=Math.sqrt(1-temp*temp);this.lc=this.long0;this.rs=Math.sqrt(1+this.e*this.e*Math.pow(Math.cos(this.lat0),4)/(1-this.e*this.e));var sinz=Math.sin(this.lat0),pc=Math.asin(sinz/this.rs),sinzpc=Math.sin(pc);this.cp=Proj4js.common.latiso(0,pc,sinzpc)-this.rs*Proj4js.common.latiso(this.e,this.lat0,sinz);this.n2=this.k0*this.a*Math.sqrt(1-this.e*this.e)/(1-this.e*this.e*sinz*sinz);this.xs=this.x0;this.ys=this.y0-this.n2*pc;this.title||(this.title="Gauss Schreiber transverse mercator")},forward:function(p){var lon=p.x,lat=p.y,L=this.rs*(lon-this.lc),Ls=this.cp+this.rs*Proj4js.common.latiso(this.e,lat,Math.sin(lat)),lat1=Math.asin(Math.sin(L)/Proj4js.common.cosh(Ls)),Ls1=Proj4js.common.latiso(0,lat1,Math.sin(lat1));return p.x=this.xs+this.n2*Ls1,p.y=this.ys+this.n2*Math.atan(Proj4js.common.sinh(Ls)/Math.cos(L)),p},inverse:function(p){var x=p.x,y=p.y,L=Math.atan(Proj4js.common.sinh((x-this.xs)/this.n2)/Math.cos((y-this.ys)/this.n2)),lat1=Math.asin(Math.sin((y-this.ys)/this.n2)/Proj4js.common.cosh((x-this.xs)/this.n2)),LC=Proj4js.common.latiso(0,lat1,Math.sin(lat1));return p.x=this.lc+L/this.rs,p.y=Proj4js.common.invlatiso(this.e,(LC-this.cp)/this.rs),p}};Proj4js.Proj.ortho={init:function(){this.sin_p14=Math.sin(this.lat0);this.cos_p14=Math.cos(this.lat0)},forward:function(p){var sinphi,cosphi,dlon,coslon,ksp,g,lon=p.x,lat=p.y,x,y;return dlon=Proj4js.common.adjust_lon(lon-this.long0),sinphi=Math.sin(lat),cosphi=Math.cos(lat),coslon=Math.cos(dlon),g=this.sin_p14*sinphi+this.cos_p14*cosphi*coslon,ksp=1,g>0||Math.abs(g)<=Proj4js.common.EPSLN?(x=this.a*ksp*cosphi*Math.sin(dlon),y=this.y0+this.a*ksp*(this.cos_p14*sinphi-this.sin_p14*cosphi*coslon)):Proj4js.reportError("orthoFwdPointError"),p.x=x,p.y=y,p},inverse:function(p){var rh,z,sinz,cosz,con,lon,lat;return p.x-=this.x0,p.y-=this.y0,rh=Math.sqrt(p.x*p.x+p.y*p.y),rh>this.a+1e-7&&Proj4js.reportError("orthoInvDataError"),z=Proj4js.common.asinz(rh/this.a),sinz=Math.sin(z),cosz=Math.cos(z),lon=this.long0,Math.abs(rh)<=Proj4js.common.EPSLN&&(lat=this.lat0),lat=Proj4js.common.asinz(cosz*this.sin_p14+p.y*sinz*this.cos_p14/rh),con=Math.abs(lat0)-Proj4js.common.HALF_PI,Math.abs(con)<=Proj4js.common.EPSLN&&(lon=this.lat0>=0?Proj4js.common.adjust_lon(this.long0+Math.atan2(p.x,-p.y)):Proj4js.common.adjust_lon(this.long0-Math.atan2(-p.x,p.y))),con=cosz-this.sin_p14*Math.sin(lat),(Math.abs(con)>=Proj4js.common.EPSLN||Math.abs(x)>=Proj4js.common.EPSLN)&&(lon=Proj4js.common.adjust_lon(this.long0+Math.atan2(p.x*sinz*this.cos_p14,con*rh))),p.x=lon,p.y=lat,p}};Proj4js.Proj.somerc={init:function(){var phy0=this.lat0;this.lambda0=this.long0;var sinPhy0=Math.sin(phy0),semiMajorAxis=this.a,invF=this.rf,flattening=1/invF,e2=2*flattening-Math.pow(flattening,2),e=this.e=Math.sqrt(e2);this.R=semiMajorAxis*Math.sqrt(1-e2)/(1-e2*Math.pow(sinPhy0,2));this.alpha=Math.sqrt(1+e2/(1-e2)*Math.pow(Math.cos(phy0),4));this.b0=Math.asin(sinPhy0/this.alpha);this.K=Math.log(Math.tan(Math.PI/4+this.b0/2))-this.alpha*Math.log(Math.tan(Math.PI/4+phy0/2))+this.alpha*e/2*Math.log((1+e*sinPhy0)/(1-e*sinPhy0))},forward:function(p){var Sa1=Math.log(Math.tan(Math.PI/4-p.y/2)),Sa2=this.e/2*Math.log((1+this.e*Math.sin(p.y))/(1-this.e*Math.sin(p.y))),S=-this.alpha*(Sa1+Sa2)+this.K,b=2*(Math.atan(Math.exp(S))-Math.PI/4),I=this.alpha*(p.x-this.lambda0),rotI=Math.atan(Math.sin(I)/(Math.sin(this.b0)*Math.tan(b)+Math.cos(this.b0)*Math.cos(I))),rotB=Math.asin(Math.cos(this.b0)*Math.sin(b)-Math.sin(this.b0)*Math.cos(b)*Math.cos(I));return p.y=this.R/2*Math.log((1+Math.sin(rotB))/(1-Math.sin(rotB)))+this.y0,p.x=this.R*rotI+this.x0,p},inverse:function(p){for(var Y=p.x-this.x0,X=p.y-this.y0,rotI=Y/this.R,rotB=2*(Math.atan(Math.exp(X/this.R))-Math.PI/4),b=Math.asin(Math.cos(this.b0)*Math.sin(rotB)+Math.sin(this.b0)*Math.cos(rotB)*Math.cos(rotI)),I=Math.atan(Math.sin(rotI)/(Math.cos(this.b0)*Math.cos(rotI)-Math.sin(this.b0)*Math.tan(rotB))),lambda=this.lambda0+I/this.alpha,S=0,phy=b,prevPhy=-1e3,iteration=0;Math.abs(phy-prevPhy)>1e-7;){if(++iteration>20){Proj4js.reportError("omercFwdInfinity");return}S=1/this.alpha*(Math.log(Math.tan(Math.PI/4+b/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(phy))/2));prevPhy=phy;phy=2*Math.atan(Math.exp(S))-Math.PI/2}return p.x=lambda,p.y=phy,p}};Proj4js.Proj.stere={ssfn_:function(phit,sinphi,eccen){return sinphi*=eccen,Math.tan(.5*(Proj4js.common.HALF_PI+phit))*Math.pow((1-sinphi)/(1+sinphi),.5*eccen)},TOL:1e-8,NITER:8,CONV:1e-10,S_POLE:0,N_POLE:1,OBLIQ:2,EQUIT:3,init:function(){var t,X;if(this.phits=this.lat_ts?this.lat_ts:Proj4js.common.HALF_PI,t=Math.abs(this.lat0),this.mode=Math.abs(t)-Proj4js.common.HALF_PI<Proj4js.common.EPSLN?this.lat0<0?this.S_POLE:this.N_POLE:t>Proj4js.common.EPSLN?this.OBLIQ:this.EQUIT,this.phits=Math.abs(this.phits),this.es)switch(this.mode){case this.N_POLE:case this.S_POLE:Math.abs(this.phits-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN?this.akm1=2*this.k0/Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)):(t=Math.sin(this.phits),this.akm1=Math.cos(this.phits)/Proj4js.common.tsfnz(this.e,this.phits,t),t*=this.e,this.akm1/=Math.sqrt(1-t*t));break;case this.EQUIT:this.akm1=2*this.k0;break;case this.OBLIQ:t=Math.sin(this.lat0);X=2*Math.atan(this.ssfn_(this.lat0,t,this.e))-Proj4js.common.HALF_PI;t*=this.e;this.akm1=2*this.k0*Math.cos(this.lat0)/Math.sqrt(1-t*t);this.sinX1=Math.sin(X);this.cosX1=Math.cos(X)}else switch(this.mode){case this.OBLIQ:this.sinph0=Math.sin(this.lat0);this.cosph0=Math.cos(this.lat0);case this.EQUIT:this.akm1=2*this.k0;break;case this.S_POLE:case this.N_POLE:this.akm1=Math.abs(this.phits-Proj4js.common.HALF_PI)>=Proj4js.common.EPSLN?Math.cos(this.phits)/Math.tan(Proj4js.common.FORTPI-.5*this.phits):2*this.k0}},forward:function(p){var lon=p.x,lat,x,y,sinphi,cosphi,coslam,sinlam;if(lon=Proj4js.common.adjust_lon(lon-this.long0),lat=p.y,this.sphere){sinphi=Math.sin(lat);cosphi=Math.cos(lat);coslam=Math.cos(lon);sinlam=Math.sin(lon);switch(this.mode){case this.EQUIT:y=1+cosphi*coslam;y<=Proj4js.common.EPSLN&&F_ERROR;y=this.akm1/y;x=y*cosphi*sinlam;y*=sinphi;break;case this.OBLIQ:y=1+this.sinph0*sinphi+this.cosph0*cosphi*coslam;y<=Proj4js.common.EPSLN&&F_ERROR;y=this.akm1/y;x=y*cosphi*sinlam;y*=this.cosph0*sinphi-this.sinph0*cosphi*coslam;break;case this.N_POLE:coslam=-coslam;lat=-lat;case this.S_POLE:Math.abs(lat-Proj4js.common.HALF_PI)<this.TOL&&F_ERROR;y=this.akm1*Math.tan(Proj4js.common.FORTPI+.5*lat);x=sinlam*y;y*=coslam}}else{coslam=Math.cos(lon);sinlam=Math.sin(lon);sinphi=Math.sin(lat);(this.mode==this.OBLIQ||this.mode==this.EQUIT)&&(X=2*Math.atan(this.ssfn_(lat,sinphi,this.e)),sinX=Math.sin(X-Proj4js.common.HALF_PI),cosX=Math.cos(X));switch(this.mode){case this.OBLIQ:A=this.akm1/(this.cosX1*(1+this.sinX1*sinX+this.cosX1*cosX*coslam));y=A*(this.cosX1*sinX-this.sinX1*cosX*coslam);x=A*cosX;break;case this.EQUIT:A=2*this.akm1/(1+cosX*coslam);y=A*sinX;x=A*cosX;break;case this.S_POLE:lat=-lat;coslam=-coslam;sinphi=-sinphi;case this.N_POLE:x=this.akm1*Proj4js.common.tsfnz(this.e,lat,sinphi);y=-x*coslam}x=x*sinlam}return p.x=x*this.a+this.x0,p.y=y*this.a+this.y0,p},inverse:function(p){var x=(p.x-this.x0)/this.a,y=(p.y-this.y0)/this.a,lon,lat,cosphi,sinphi,tp=0,phi_l=0,rho,halfe=0,pi2=0,i,c,rh,sinc,cosc;if(this.sphere){rh=Math.sqrt(x*x+y*y);c=2*Math.atan(rh/this.akm1);sinc=Math.sin(c);cosc=Math.cos(c);lon=0;switch(this.mode){case this.EQUIT:lat=Math.abs(rh)<=Proj4js.common.EPSLN?0:Math.asin(y*sinc/rh);(cosc!=0||x!=0)&&(lon=Math.atan2(x*sinc,cosc*rh));break;case this.OBLIQ:lat=Math.abs(rh)<=Proj4js.common.EPSLN?this.phi0:Math.asin(cosc*sinph0+y*sinc*cosph0/rh);c=cosc-sinph0*Math.sin(lat);(c!=0||x!=0)&&(lon=Math.atan2(x*sinc*cosph0,c*rh));break;case this.N_POLE:y=-y;case this.S_POLE:lat=Math.abs(rh)<=Proj4js.common.EPSLN?this.phi0:Math.asin(this.mode==this.S_POLE?-cosc:cosc);lon=x==0&&y==0?0:Math.atan2(x,y)}}else{rho=Math.sqrt(x*x+y*y);switch(this.mode){case this.OBLIQ:case this.EQUIT:tp=2*Math.atan2(rho*this.cosX1,this.akm1);cosphi=Math.cos(tp);sinphi=Math.sin(tp);phi_l=rho==0?Math.asin(cosphi*this.sinX1):Math.asin(cosphi*this.sinX1+y*sinphi*this.cosX1/rho);tp=Math.tan(.5*(Proj4js.common.HALF_PI+phi_l));x*=sinphi;y=rho*this.cosX1*cosphi-y*this.sinX1*sinphi;pi2=Proj4js.common.HALF_PI;halfe=.5*this.e;break;case this.N_POLE:y=-y;case this.S_POLE:tp=-rho/this.akm1;phi_l=Proj4js.common.HALF_PI-2*Math.atan(tp);pi2=-Proj4js.common.HALF_PI;halfe=-.5*this.e}for(i=this.NITER;i--;phi_l=lat)if(sinphi=this.e*Math.sin(phi_l),lat=2*Math.atan(tp*Math.pow((1+sinphi)/(1-sinphi),halfe))-pi2,Math.abs(phi_l-lat)<this.CONV)return this.mode==this.S_POLE&&(lat=-lat),lon=x==0&&y==0?0:Math.atan2(x,y),p.x=Proj4js.common.adjust_lon(lon+this.long0),p.y=lat,p}}};Proj4js.Proj.nzmg={iterations:1,init:function(){this.A=[];this.A[1]=.6399175073;this.A[2]=-.1358797613;this.A[3]=.063294409;this.A[4]=-.02526853;this.A[5]=.0117879;this.A[6]=-.0055161;this.A[7]=.0026906;this.A[8]=-.001333;this.A[9]=.00067;this.A[10]=-.00034;this.B_re=[];this.B_im=[];this.B_re[1]=.7557853228;this.B_im[1]=0;this.B_re[2]=.249204646;this.B_im[2]=.003371507;this.B_re[3]=-.001541739;this.B_im[3]=.04105856;this.B_re[4]=-.10162907;this.B_im[4]=.01727609;this.B_re[5]=-.26623489;this.B_im[5]=-.36249218;this.B_re[6]=-.6870983;this.B_im[6]=-1.1651967;this.C_re=[];this.C_im=[];this.C_re[1]=1.3231270439;this.C_im[1]=0;this.C_re[2]=-.577245789;this.C_im[2]=-.007809598;this.C_re[3]=.508307513;this.C_im[3]=-.112208952;this.C_re[4]=-.15094762;this.C_im[4]=.18200602;this.C_re[5]=1.01418179;this.C_im[5]=1.64497696;this.C_re[6]=1.9660549;this.C_im[6]=2.5127645;this.D=[];this.D[1]=1.5627014243;this.D[2]=.5185406398;this.D[3]=-.03333098;this.D[4]=-.1052906;this.D[5]=-.0368594;this.D[6]=.007317;this.D[7]=.0122;this.D[8]=.00394;this.D[9]=-.0013},forward:function(p){var lon=p.x,lat=p.y,delta_lat=lat-this.lat0,delta_lon=lon-this.long0,d_phi=delta_lat/Proj4js.common.SEC_TO_RAD*1e-5,d_lambda=delta_lon,d_phi_n=1,d_psi=0;for(n=1;n<=10;n++)d_phi_n=d_phi_n*d_phi,d_psi=d_psi+this.A[n]*d_phi_n;var th_re=d_psi,th_im=d_lambda,th_n_re=1,th_n_im=0,th_n_re1,th_n_im1,z_re=0,z_im=0;for(n=1;n<=6;n++)th_n_re1=th_n_re*th_re-th_n_im*th_im,th_n_im1=th_n_im*th_re+th_n_re*th_im,th_n_re=th_n_re1,th_n_im=th_n_im1,z_re=z_re+this.B_re[n]*th_n_re-this.B_im[n]*th_n_im,z_im=z_im+this.B_im[n]*th_n_re+this.B_re[n]*th_n_im;return x=z_im*this.a+this.x0,y=z_re*this.a+this.y0,p.x=x,p.y=y,p},inverse:function(p){var x=p.x,y=p.y,delta_x=x-this.x0,delta_y=y-this.y0,z_re=delta_y/this.a,z_im=delta_x/this.a,z_n_re=1,z_n_im=0,z_n_re1,z_n_im1,th_re=0,th_im=0,den_re,den_im,den2,lat,lon;for(n=1;n<=6;n++)z_n_re1=z_n_re*z_re-z_n_im*z_im,z_n_im1=z_n_im*z_re+z_n_re*z_im,z_n_re=z_n_re1,z_n_im=z_n_im1,th_re=th_re+this.C_re[n]*z_n_re-this.C_im[n]*z_n_im,th_im=th_im+this.C_im[n]*z_n_re+this.C_re[n]*z_n_im;for(i=0;i<this.iterations;i++){var th_n_re=th_re,th_n_im=th_im,th_n_re1,th_n_im1,num_re=z_re,num_im=z_im;for(n=2;n<=6;n++)th_n_re1=th_n_re*th_re-th_n_im*th_im,th_n_im1=th_n_im*th_re+th_n_re*th_im,th_n_re=th_n_re1,th_n_im=th_n_im1,num_re=num_re+(n-1)*(this.B_re[n]*th_n_re-this.B_im[n]*th_n_im),num_im=num_im+(n-1)*(this.B_im[n]*th_n_re+this.B_re[n]*th_n_im);for(th_n_re=1,th_n_im=0,den_re=this.B_re[1],den_im=this.B_im[1],n=2;n<=6;n++)th_n_re1=th_n_re*th_re-th_n_im*th_im,th_n_im1=th_n_im*th_re+th_n_re*th_im,th_n_re=th_n_re1,th_n_im=th_n_im1,den_re=den_re+n*(this.B_re[n]*th_n_re-this.B_im[n]*th_n_im),den_im=den_im+n*(this.B_im[n]*th_n_re+this.B_re[n]*th_n_im);den2=den_re*den_re+den_im*den_im;th_re=(num_re*den_re+num_im*den_im)/den2;th_im=(num_im*den_re-num_re*den_im)/den2}var d_psi=th_re,d_lambda=th_im,d_psi_n=1,d_phi=0;for(n=1;n<=9;n++)d_psi_n=d_psi_n*d_psi,d_phi=d_phi+this.D[n]*d_psi_n;return lat=this.lat0+d_phi*Proj4js.common.SEC_TO_RAD*1e5,lon=this.long0+d_lambda,p.x=lon,p.y=lat,p}};Proj4js.Proj.mill={init:function(){},forward:function(p){var lon=p.x,lat=p.y,dlon=Proj4js.common.adjust_lon(lon-this.long0),x=this.x0+this.a*dlon,y=this.y0+this.a*Math.log(Math.tan(Proj4js.common.PI/4+lat/2.5))*1.25;return p.x=x,p.y=y,p},inverse:function(p){p.x-=this.x0;p.y-=this.y0;var lon=Proj4js.common.adjust_lon(this.long0+p.x/this.a),lat=2.5*(Math.atan(Math.exp(.8*p.y/this.a))-Proj4js.common.PI/4);return p.x=lon,p.y=lat,p}};Proj4js.Proj.gnom={init:function(){this.sin_p14=Math.sin(this.lat0);this.cos_p14=Math.cos(this.lat0);this.infinity_dist=1e3*this.a},forward:function(p){var sinphi,cosphi,dlon,coslon,ksp,g,lon=p.x,lat=p.y;return dlon=Proj4js.common.adjust_lon(lon-this.long0),sinphi=Math.sin(lat),cosphi=Math.cos(lat),coslon=Math.cos(dlon),g=this.sin_p14*sinphi+this.cos_p14*cosphi*coslon,ksp=1,g>0||Math.abs(g)<=Proj4js.common.EPSLN?(x=this.x0+this.a*ksp*cosphi*Math.sin(dlon)/g,y=this.y0+this.a*ksp*(this.cos_p14*sinphi-this.sin_p14*cosphi*coslon)/g):(Proj4js.reportError("orthoFwdPointError"),x=this.x0+this.infinity_dist*cosphi*Math.sin(dlon),y=this.y0+this.infinity_dist*(this.cos_p14*sinphi-this.sin_p14*cosphi*coslon)),p.x=x,p.y=y,p},inverse:function(p){var rh,sinc,cosc,c,lon,lat;return p.x=(p.x-this.x0)/this.a,p.y=(p.y-this.y0)/this.a,p.x/=this.k0,p.y/=this.k0,(rh=Math.sqrt(p.x*p.x+p.y*p.y))?(c=Math.atan2(rh,this.rc),sinc=Math.sin(c),cosc=Math.cos(c),lat=Proj4js.common.asinz(cosc*this.sin_p14+p.y*sinc*this.cos_p14/rh),lon=Math.atan2(p.x*sinc,rh*this.cos_p14*cosc-p.y*this.sin_p14*sinc),lon=Proj4js.common.adjust_lon(this.long0+lon)):(lat=this.phic0,lon=0),p.x=lon,p.y=lat,p}};Proj4js.Proj.sinu={init:function(){this.R=6370997},forward:function(p){var x,y,delta_lon,lon=p.x,lat=p.y;return delta_lon=Proj4js.common.adjust_lon(lon-this.long0),x=this.R*delta_lon*Math.cos(lat)+this.x0,y=this.R*lat+this.y0,p.x=x,p.y=y,p},inverse:function(p){var lat,temp,lon;return p.x-=this.x0,p.y-=this.y0,lat=p.y/this.R,Math.abs(lat)>Proj4js.common.HALF_PI&&Proj4js.reportError("sinu:Inv:DataError"),temp=Math.abs(lat)-Proj4js.common.HALF_PI,Math.abs(temp)>Proj4js.common.EPSLN?(temp=this.long0+p.x/(this.R*Math.cos(lat)),lon=Proj4js.common.adjust_lon(temp)):lon=this.long0,p.x=lon,p.y=lat,p}};Proj4js.Proj.vandg={init:function(){this.R=6370997},forward:function(p){var lon=p.x,lat=p.y,dlon=Proj4js.common.adjust_lon(lon-this.long0),x,y,theta;Math.abs(lat)<=Proj4js.common.EPSLN&&(x=this.x0+this.R*dlon,y=this.y0);theta=Proj4js.common.asinz(2*Math.abs(lat/Proj4js.common.PI));(Math.abs(dlon)<=Proj4js.common.EPSLN||Math.abs(Math.abs(lat)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN)&&(x=this.x0,y=lat>=0?this.y0+Proj4js.common.PI*this.R*Math.tan(.5*theta):this.y0+Proj4js.common.PI*this.R*-Math.tan(.5*theta));var al=.5*Math.abs(Proj4js.common.PI/dlon-dlon/Proj4js.common.PI),asq=al*al,sinth=Math.sin(theta),costh=Math.cos(theta),g=costh/(sinth+costh-1),gsq=g*g,m=g*(2/sinth-1),msq=m*m,con=Proj4js.common.PI*this.R*(al*(g-msq)+Math.sqrt(asq*(g-msq)*(g-msq)-(msq+asq)*(gsq-msq)))/(msq+asq);return dlon<0&&(con=-con),x=this.x0+con,con=Math.abs(con/(Proj4js.common.PI*this.R)),y=lat>=0?this.y0+Proj4js.common.PI*this.R*Math.sqrt(1-con*con-2*al*con):this.y0-Proj4js.common.PI*this.R*Math.sqrt(1-con*con-2*al*con),p.x=x,p.y=y,p},inverse:function(p){var xx,yy,xys,c1,c2,c3,a1,m1,con,th1,d;return p.x-=this.x0,p.y-=this.y0,con=Proj4js.common.PI*this.R,xx=p.x/con,yy=p.y/con,xys=xx*xx+yy*yy,c1=-Math.abs(yy)*(1+xys),c2=c1-2*yy*yy+xx*xx,c3=-2*c1+1+2*yy*yy+xys*xys,d=yy*yy/c3+(2*c2*c2*c2/c3/c3/c3-9*c1*c2/c3/c3)/27,a1=(c1-c2*c2/3/c3)/c3,m1=2*Math.sqrt(-a1/3),con=3*d/a1/m1,Math.abs(con)>1&&(con=con>=0?1:-1),th1=Math.acos(con)/3,lat=p.y>=0?(-m1*Math.cos(th1+Proj4js.common.PI/3)-c2/3/c3)*Proj4js.common.PI:-(-m1*Math.cos(th1+PI/3)-c2/3/c3)*Proj4js.common.PI,Math.abs(xx)<Proj4js.common.EPSLN&&(lon=this.long0),lon=Proj4js.common.adjust_lon(this.long0+Proj4js.common.PI*(xys-1+Math.sqrt(1+2*(xx*xx-yy*yy)+xys*xys))/2/xx),p.x=lon,p.y=lat,p}};Proj4js.Proj.cea={init:function(){},forward:function(p){var lon=p.x,lat=p.y,x,y;return dlon=Proj4js.common.adjust_lon(lon-this.long0),x=this.x0+this.a*dlon*Math.cos(this.lat_ts),y=this.y0+this.a*Math.sin(lat)/Math.cos(this.lat_ts),p.x=x,p.y=y,p},inverse:function(p){p.x-=this.x0;p.y-=this.y0;var lon=Proj4js.common.adjust_lon(this.long0+p.x/this.a/Math.cos(this.lat_ts)),lat=Math.asin(p.y/this.a*Math.cos(this.lat_ts));return p.x=lon,p.y=lat,p}};Proj4js.Proj.eqc={init:function(){this.x0||(this.x0=0);this.y0||(this.y0=0);this.lat0||(this.lat0=0);this.long0||(this.long0=0);this.lat_ts||(this.lat_ts=0);this.title||(this.title="Equidistant Cylindrical (Plate Carre)");this.rc=Math.cos(this.lat_ts)},forward:function(p){var lon=p.x,lat=p.y,dlon=Proj4js.common.adjust_lon(lon-this.long0),dlat=Proj4js.common.adjust_lat(lat-this.lat0);return p.x=this.x0+this.a*dlon*this.rc,p.y=this.y0+this.a*dlat,p},inverse:function(p){var x=p.x,y=p.y;return p.x=Proj4js.common.adjust_lon(this.long0+(x-this.x0)/(this.a*this.rc)),p.y=Proj4js.common.adjust_lat(this.lat0+(y-this.y0)/this.a),p}};Proj4js.Proj.cass={init:function(){this.sphere||(this.en=this.pj_enfn(this.es),this.m0=this.pj_mlfn(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},C1:.16666666666666666,C2:.0083333333333333332,C3:.041666666666666664,C4:.33333333333333331,C5:.066666666666666666,forward:function(p){var x,y,lam=p.x,phi=p.y;return lam=Proj4js.common.adjust_lon(lam-this.long0),this.sphere?(x=Math.asin(Math.cos(phi)*Math.sin(lam)),y=Math.atan2(Math.tan(phi),Math.cos(lam))-this.phi0):(this.n=Math.sin(phi),this.c=Math.cos(phi),y=this.pj_mlfn(phi,this.n,this.c,this.en),this.n=1/Math.sqrt(1-this.es*this.n*this.n),this.tn=Math.tan(phi),this.t=this.tn*this.tn,this.a1=lam*this.c,this.c*=this.es*this.c/(1-this.es),this.a2=this.a1*this.a1,x=this.n*this.a1*(1-this.a2*this.t*(this.C1-(8-this.t+8*this.c)*this.a2*this.C2)),y-=this.m0-this.n*this.tn*this.a2*(.5+(5-this.t+6*this.c)*this.a2*this.C3)),p.x=this.a*x+this.x0,p.y=this.a*y+this.y0,p},inverse:function(p){p.x-=this.x0;p.y-=this.y0;var x=p.x/this.a,y=p.y/this.a;return this.sphere?(this.dd=y+this.lat0,phi=Math.asin(Math.sin(this.dd)*Math.cos(x)),lam=Math.atan2(Math.tan(x),Math.cos(this.dd))):(ph1=this.pj_inv_mlfn(this.m0+y,this.es,this.en),this.tn=Math.tan(ph1),this.t=this.tn*this.tn,this.n=Math.sin(ph1),this.r=1/(1-this.es*this.n*this.n),this.n=Math.sqrt(this.r),this.r*=(1-this.es)*this.n,this.dd=x/this.n,this.d2=this.dd*this.dd,phi=ph1-this.n*this.tn/this.r*this.d2*(.5-(1+3*this.t)*this.d2*this.C3),lam=this.dd*(1+this.t*this.d2*(-this.C4+(1+3*this.t)*this.d2*this.C5))/Math.cos(ph1)),p.x=Proj4js.common.adjust_lon(this.long0+lam),p.y=phi,p},pj_enfn:function(es){en=[];en[0]=this.C00-es*(this.C02+es*(this.C04+es*(this.C06+es*this.C08)));en[1]=es*(this.C22-es*(this.C04+es*(this.C06+es*this.C08)));var t=es*es;return en[2]=t*(this.C44-es*(this.C46+es*this.C48)),t*=es,en[3]=t*(this.C66-es*this.C68),en[4]=t*es*this.C88,en},pj_mlfn:function(phi,sphi,cphi,en){return cphi*=sphi,sphi*=sphi,en[0]*phi-cphi*(en[1]+sphi*(en[2]+sphi*(en[3]+sphi*en[4])))},pj_inv_mlfn:function(arg,es,en){for(k=1/(1-es),phi=arg,i=Proj4js.common.MAX_ITER;i;--i)if(s=Math.sin(phi),t=1-es*s*s,t=(this.pj_mlfn(phi,s,Math.cos(phi),en)-arg)*t*Math.sqrt(t)*k,phi-=t,Math.abs(t)<Proj4js.common.EPSLN)return phi;return Proj4js.reportError("cass:pj_inv_mlfn: Convergence error"),phi},C00:1,C02:.25,C04:.046875,C06:.01953125,C08:.01068115234375,C22:.75,C44:.46875,C46:.013020833333333334,C48:.007120768229166667,C66:.36458333333333331,C68:.005696614583333333,C88:.3076171875};Proj4js.Proj.gauss={init:function(){sphi=Math.sin(this.lat0);cphi=Math.cos(this.lat0);cphi*=cphi;this.rc=Math.sqrt(1-this.es)/(1-this.es*sphi*sphi);this.C=Math.sqrt(1+this.es*cphi*cphi/(1-this.es));this.phic0=Math.asin(sphi/this.C);this.ratexp=.5*this.C*this.e;this.K=Math.tan(.5*this.phic0+Proj4js.common.FORTPI)/(Math.pow(Math.tan(.5*this.lat0+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*sphi,this.ratexp))},forward:function(p){var lon=p.x,lat=p.y;return p.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*lat+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*Math.sin(lat),this.ratexp))-Proj4js.common.HALF_PI,p.x=this.C*lon,p},inverse:function(p){var lon=p.x/this.C,lat=p.y,i;for(num=Math.pow(Math.tan(.5*lat+Proj4js.common.FORTPI)/this.K,1/this.C),i=Proj4js.common.MAX_ITER;i>0;--i){if(lat=2*Math.atan(num*Proj4js.common.srat(this.e*Math.sin(p.y),-.5*this.e))-Proj4js.common.HALF_PI,Math.abs(lat-p.y)<1e-14)break;p.y=lat}return i?(p.x=lon,p.y=lat,p):(Proj4js.reportError("gauss:inverse:convergence failed"),null)}};Proj4js.Proj.omerc={init:function(){this.mode||(this.mode=0);this.lon1||(this.lon1=0,this.mode=1);this.lon2||(this.lon2=0);this.lat2||(this.lat2=0);var temp=this.b/this.a,es=1-Math.pow(temp,2),e=Math.sqrt(es);this.sin_p20=Math.sin(this.lat0);this.cos_p20=Math.cos(this.lat0);this.con=1-this.es*this.sin_p20*this.sin_p20;this.com=Math.sqrt(1-es);this.bl=Math.sqrt(1+this.es*Math.pow(this.cos_p20,4)/(1-es));this.al=this.a*this.bl*this.k0*this.com/this.con;Math.abs(this.lat0)<Proj4js.common.EPSLN?(this.ts=1,this.d=1,this.el=1):(this.ts=Proj4js.common.tsfnz(this.e,this.lat0,this.sin_p20),this.con=Math.sqrt(this.con),this.d=this.bl*this.com/(this.cos_p20*this.con),this.f=this.d*this.d-1>0?this.lat0>=0?this.d+Math.sqrt(this.d*this.d-1):this.d-Math.sqrt(this.d*this.d-1):this.d,this.el=this.f*Math.pow(this.ts,this.bl));this.mode!=0?(this.g=.5*(this.f-1/this.f),this.gama=Proj4js.common.asinz(Math.sin(this.alpha)/this.d),this.longc=this.longc-Proj4js.common.asinz(this.g*Math.tan(this.gama))/this.bl,this.con=Math.abs(this.lat0),this.con>Proj4js.common.EPSLN&&Math.abs(this.con-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN?(this.singam=Math.sin(this.gama),this.cosgam=Math.cos(this.gama),this.sinaz=Math.sin(this.alpha),this.cosaz=Math.cos(this.alpha),this.u=this.lat0>=0?this.al/this.bl*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz):-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)):Proj4js.reportError("omerc:Init:DataError")):(this.sinphi=Math.sin(this.at1),this.ts1=Proj4js.common.tsfnz(this.e,this.lat1,this.sinphi),this.sinphi=Math.sin(this.lat2),this.ts2=Proj4js.common.tsfnz(this.e,this.lat2,this.sinphi),this.h=Math.pow(this.ts1,this.bl),this.l=Math.pow(this.ts2,this.bl),this.f=this.el/this.h,this.g=.5*(this.f-1/this.f),this.j=(this.el*this.el-this.l*this.h)/(this.el*this.el+this.l*this.h),this.p=(this.l-this.h)/(this.l+this.h),this.dlon=this.lon1-this.lon2,this.dlon<-Proj4js.common.PI&&(this.lon2=this.lon2-2*Proj4js.common.PI),this.dlon>Proj4js.common.PI&&(this.lon2=this.lon2+2*Proj4js.common.PI),this.dlon=this.lon1-this.lon2,this.longc=.5*(this.lon1+this.lon2)-Math.atan(this.j*Math.tan(.5*this.bl*this.dlon)/this.p)/this.bl,this.dlon=Proj4js.common.adjust_lon(this.lon1-this.longc),this.gama=Math.atan(Math.sin(this.bl*this.dlon)/this.g),this.alpha=Proj4js.common.asinz(this.d*Math.sin(this.gama)),Math.abs(this.lat1-this.lat2)<=Proj4js.common.EPSLN?Proj4js.reportError("omercInitDataError"):this.con=Math.abs(this.lat1),this.con<=Proj4js.common.EPSLN||Math.abs(this.con-HALF_PI)<=Proj4js.common.EPSLN?Proj4js.reportError("omercInitDataError"):Math.abs(Math.abs(this.lat0)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN&&Proj4js.reportError("omercInitDataError"),this.singam=Math.sin(this.gam),this.cosgam=Math.cos(this.gam),this.sinaz=Math.sin(this.alpha),this.cosaz=Math.cos(this.alpha),this.u=this.lat0>=0?this.al/this.bl*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz):-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz))},forward:function(p){var sin_phi,t,con,q,us,vl,ul,vs,s,dlon,ts1,lon=p.x,lat=p.y,x,y;return sin_phi=Math.sin(lat),dlon=Proj4js.common.adjust_lon(lon-this.longc),vl=Math.sin(this.bl*dlon),Math.abs(Math.abs(lat)-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN?(ts1=Proj4js.common.tsfnz(this.e,lat,sin_phi),q=this.el/Math.pow(ts1,this.bl),s=.5*(q-1/q),t=.5*(q+1/q),ul=(s*this.singam-vl*this.cosgam)/t,con=Math.cos(this.bl*dlon),Math.abs(con)<1e-7?us=this.al*this.bl*dlon:(us=this.al*Math.atan((s*this.cosgam+vl*this.singam)/con)/this.bl,con<0&&(us=us+Proj4js.common.PI*this.al/this.bl))):(ul=lat>=0?this.singam:-this.singam,us=this.al*lat/this.bl),Math.abs(Math.abs(ul)-1)<=Proj4js.common.EPSLN&&Proj4js.reportError("omercFwdInfinity"),vs=.5*this.al*Math.log((1-ul)/(1+ul))/this.bl,us=us-this.u,x=this.x0+vs*this.cosaz+us*this.sinaz,y=this.y0+us*this.cosaz-vs*this.sinaz,p.x=x,p.y=y,p},inverse:function(p){var theta,t,con,vs,us,q,s,ts1,vl,ul,flag;return p.x-=this.x0,p.y-=this.y0,flag=0,vs=p.x*this.cosaz-p.y*this.sinaz,us=p.y*this.cosaz+p.x*this.sinaz,us=us+this.u,q=Math.exp(-this.bl*vs/this.al),s=.5*(q-1/q),t=.5*(q+1/q),vl=Math.sin(this.bl*us/this.al),ul=(vl*this.cosgam+s*this.singam)/t,Math.abs(Math.abs(ul)-1)<=Proj4js.common.EPSLN?(lon=this.longc,lat=ul>=0?Proj4js.common.HALF_PI:-Proj4js.common.HALF_PI):(con=1/this.bl,ts1=Math.pow(this.el/Math.sqrt((1+ul)/(1-ul)),con),lat=Proj4js.common.phi2z(this.e,ts1),theta=this.longc-Math.atan2(s*this.cosgam-vl*this.singam,con)/this.bl,lon=Proj4js.common.adjust_lon(theta)),p.x=lon,p.y=lat,p}};Proj4js.Proj.lcc={init:function(){var temp;if(this.lat2||(this.lat2=this.lat0),this.k0||(this.k0=1),Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError("lcc:init: Equal Latitudes");return}temp=this.b/this.a;this.e=Math.sqrt(1-temp*temp);var sin1=Math.sin(this.lat1),cos1=Math.cos(this.lat1),ms1=Proj4js.common.msfnz(this.e,sin1,cos1),ts1=Proj4js.common.tsfnz(this.e,this.lat1,sin1),sin2=Math.sin(this.lat2),cos2=Math.cos(this.lat2),ms2=Proj4js.common.msfnz(this.e,sin2,cos2),ts2=Proj4js.common.tsfnz(this.e,this.lat2,sin2),ts0=Proj4js.common.tsfnz(this.e,this.lat0,Math.sin(this.lat0));this.ns=Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN?Math.log(ms1/ms2)/Math.log(ts1/ts2):sin1;this.f0=ms1/(this.ns*Math.pow(ts1,this.ns));this.rh=this.a*this.f0*Math.pow(ts0,this.ns);this.title||(this.title="Lambert Conformal Conic")},forward:function(p){var lon=p.x,lat=p.y,con,ts,rh1,theta;if(!(lat<=90)||!(lat>=-90)||!(lon<=180)||!(lon>=-180))return Proj4js.reportError("lcc:forward: llInputOutOfRange: "+lon+" : "+lat),null;if(con=Math.abs(Math.abs(lat)-Proj4js.common.HALF_PI),con>Proj4js.common.EPSLN)ts=Proj4js.common.tsfnz(this.e,lat,Math.sin(lat)),rh1=this.a*this.f0*Math.pow(ts,this.ns);else{if(con=lat*this.ns,con<=0)return Proj4js.reportError("lcc:forward: No Projection"),null;rh1=0}return theta=this.ns*Proj4js.common.adjust_lon(lon-this.long0),p.x=this.k0*rh1*Math.sin(theta)+this.x0,p.y=this.k0*(this.rh-rh1*Math.cos(theta))+this.y0,p},inverse:function(p){var rh1,con,ts,lat,lon,theta;if(x=(p.x-this.x0)/this.k0,y=this.rh-(p.y-this.y0)/this.k0,this.ns>0?(rh1=Math.sqrt(x*x+y*y),con=1):(rh1=-Math.sqrt(x*x+y*y),con=-1),theta=0,rh1!=0&&(theta=Math.atan2(con*x,con*y)),rh1!=0||this.ns>0){if(con=1/this.ns,ts=Math.pow(rh1/(this.a*this.f0),con),lat=Proj4js.common.phi2z(this.e,ts),lat==-9999)return null}else lat=-Proj4js.common.HALF_PI;return lon=Proj4js.common.adjust_lon(theta/this.ns+this.long0),p.x=lon,p.y=lat,p}};Proj4js.Proj.laea={S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4,init:function(){var t=Math.abs(this.lat0),sinphi;if(this.mode=Math.abs(t-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN?this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(t)<Proj4js.common.EPSLN?this.EQUIT:this.OBLIQ,this.es>0){this.qp=Proj4js.common.qsfnz(this.e,1);this.mmf=.5/(1-this.es);this.apa=this.authset(this.es);switch(this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp);this.dd=1/this.rq;this.xmf=1;this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp);sinphi=Math.sin(this.lat0);this.sinb1=Proj4js.common.qsfnz(this.e,sinphi)/this.qp;this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1);this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*sinphi*sinphi)*this.rq*this.cosb1);this.ymf=(this.xmf=this.rq)/this.dd;this.xmf*=this.dd}}else this.mode==this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(p){var x,y,lam=p.x,phi=p.y,coslam,cosphi,sinphi;if(lam=Proj4js.common.adjust_lon(lam-this.long0),this.sphere){sinphi=Math.sin(phi);cosphi=Math.cos(phi);coslam=Math.cos(lam);switch(this.mode){case this.EQUIT:if(y=this.mode==this.EQUIT?1+cosphi*coslam:1+this.sinph0*sinphi+this.cosph0*cosphi*coslam,y<=Proj4js.common.EPSLN)return Proj4js.reportError("laea:fwd:y less than eps"),null;y=Math.sqrt(2/y);x=y*cosphi*Math.sin(lam);y*=this.mode==this.EQUIT?sinphi:this.cosph0*sinphi-this.sinph0*cosphi*coslam;break;case this.N_POLE:coslam=-coslam;case this.S_POLE:if(Math.abs(phi+this.phi0)<Proj4js.common.EPSLN)return Proj4js.reportError("laea:fwd:phi < eps"),null;y=Proj4js.common.FORTPI-phi*.5;y=2*(this.mode==this.S_POLE?Math.cos(y):Math.sin(y));x=y*Math.sin(lam);y*=coslam}}else{var coslam,sinlam,sinphi,q,sinb=0,cosb=0,b=0;coslam=Math.cos(lam);sinlam=Math.sin(lam);sinphi=Math.sin(phi);q=Proj4js.common.qsfnz(this.e,sinphi);(this.mode==this.OBLIQ||this.mode==this.EQUIT)&&(sinb=q/this.qp,cosb=Math.sqrt(1-sinb*sinb));switch(this.mode){case this.OBLIQ:b=1+this.sinb1*sinb+this.cosb1*cosb*coslam;break;case this.EQUIT:b=1+cosb*coslam;break;case this.N_POLE:b=Proj4js.common.HALF_PI+phi;q=this.qp-q;break;case this.S_POLE:b=phi-Proj4js.common.HALF_PI;q=this.qp+q}if(Math.abs(b)<Proj4js.common.EPSLN)return Proj4js.reportError("laea:fwd:b < eps"),null;switch(this.mode){case this.OBLIQ:case this.EQUIT:b=Math.sqrt(2/b);y=this.mode==this.OBLIQ?this.ymf*b*(this.cosb1*sinb-this.sinb1*cosb*coslam):(b=Math.sqrt(2/(1+cosb*coslam)))*sinb*this.ymf;x=this.xmf*b*cosb*sinlam;break;case this.N_POLE:case this.S_POLE:q>=0?(x=(b=Math.sqrt(q))*sinlam,y=coslam*(this.mode==this.S_POLE?b:-b)):x=y=0}}return p.x=this.a*x+this.x0,p.y=this.a*y+this.y0,p},inverse:function(p){var x,y,cosz,rh,sinz,phi,cCe,sCe,q,rho,ab;if(p.x-=this.x0,p.y-=this.y0,x=p.x/this.a,y=p.y/this.a,this.sphere){if(cosz=0,sinz=0,rh=Math.sqrt(x*x+y*y),phi=rh*.5,phi>1)return Proj4js.reportError("laea:Inv:DataError"),null;phi=2*Math.asin(phi);(this.mode==this.OBLIQ||this.mode==this.EQUIT)&&(sinz=Math.sin(phi),cosz=Math.cos(phi));switch(this.mode){case this.EQUIT:phi=Math.abs(rh)<=Proj4js.common.EPSLN?0:Math.asin(y*sinz/rh);x*=sinz;y=cosz*rh;break;case this.OBLIQ:phi=Math.abs(rh)<=Proj4js.common.EPSLN?this.phi0:Math.asin(cosz*sinph0+y*sinz*cosph0/rh);x*=sinz*cosph0;y=(cosz-Math.sin(phi)*sinph0)*rh;break;case this.N_POLE:y=-y;phi=Proj4js.common.HALF_PI-phi;break;case this.S_POLE:phi-=Proj4js.common.HALF_PI}lam=y==0&&(this.mode==this.EQUIT||this.mode==this.OBLIQ)?0:Math.atan2(x,y)}else{ab=0;switch(this.mode){case this.EQUIT:case this.OBLIQ:if(x/=this.dd,y*=this.dd,rho=Math.sqrt(x*x+y*y),rho<Proj4js.common.EPSLN)return p.x=0,p.y=this.phi0,p;sCe=2*Math.asin(.5*rho/this.rq);cCe=Math.cos(sCe);x*=sCe=Math.sin(sCe);this.mode==this.OBLIQ?(ab=cCe*this.sinb1+y*sCe*this.cosb1/rho,q=this.qp*ab,y=rho*this.cosb1*cCe-y*this.sinb1*sCe):(ab=y*sCe/rho,q=this.qp*ab,y=rho*cCe);break;case this.N_POLE:y=-y;case this.S_POLE:if(q=x*x+y*y,!q)return p.x=0,p.y=this.phi0,p;ab=1-q/this.qp;this.mode==this.S_POLE&&(ab=-ab)}lam=Math.atan2(x,y);phi=this.authlat(Math.asin(ab),this.apa)}return p.x=Proj4js.common.adjust_lon(this.long0+lam),p.y=phi,p},P00:.33333333333333331,P01:.17222222222222222,P02:.10257936507936508,P10:.063888888888888884,P11:.0664021164021164,P20:.016415012942191543,authset:function(es){var t,APA=[];return APA[0]=es*this.P00,t=es*es,APA[0]+=t*this.P01,APA[1]=t*this.P10,t*=es,APA[0]+=t*this.P02,APA[1]+=t*this.P11,APA[2]=t*this.P20,APA},authlat:function(beta,APA){var t=beta+beta;return beta+APA[0]*Math.sin(t)+APA[1]*Math.sin(t+t)+APA[2]*Math.sin(t+t+t)}};Proj4js.Proj.aeqd={init:function(){this.sin_p12=Math.sin(this.lat0);this.cos_p12=Math.cos(this.lat0)},forward:function(p){var lon=p.x,lat=p.y,ksp,sinphi=Math.sin(p.y),cosphi=Math.cos(p.y),dlon=Proj4js.common.adjust_lon(lon-this.long0),coslon=Math.cos(dlon),g=this.sin_p12*sinphi+this.cos_p12*cosphi*coslon,z;if(Math.abs(Math.abs(g)-1)<Proj4js.common.EPSLN){if(ksp=1,g<0){Proj4js.reportError("aeqd:Fwd:PointError");return}}else z=Math.acos(g),ksp=z/Math.sin(z);return p.x=this.x0+this.a*ksp*cosphi*Math.sin(dlon),p.y=this.y0+this.a*ksp*(this.cos_p12*sinphi-this.sin_p12*cosphi*coslon),p},inverse:function(p){var rh,con,temp;if(p.x-=this.x0,p.y-=this.y0,rh=Math.sqrt(p.x*p.x+p.y*p.y),rh>2*Proj4js.common.HALF_PI*this.a){Proj4js.reportError("aeqdInvDataError");return}var z=rh/this.a,sinz=Math.sin(z),cosz=Math.cos(z),lon=this.long0,lat;return Math.abs(rh)<=Proj4js.common.EPSLN?lat=this.lat0:(lat=Proj4js.common.asinz(cosz*this.sin_p12+p.y*sinz*this.cos_p12/rh),con=Math.abs(this.lat0)-Proj4js.common.HALF_PI,Math.abs(con)<=Proj4js.common.EPSLN?lon=lat0>=0?Proj4js.common.adjust_lon(this.long0+Math.atan2(p.x,-p.y)):Proj4js.common.adjust_lon(this.long0-Math.atan2(-p.x,p.y)):(con=cosz-this.sin_p12*Math.sin(lat),Math.abs(con)<Proj4js.common.EPSLN&&Math.abs(p.x)<Proj4js.common.EPSLN||(temp=Math.atan2(p.x*sinz*this.cos_p12,con*rh),lon=Proj4js.common.adjust_lon(this.long0+Math.atan2(p.x*sinz*this.cos_p12,con*rh))))),p.x=lon,p.y=lat,p}};Proj4js.Proj.moll={init:function(){},forward:function(p){for(var delta_theta,x,y,lon=p.x,lat=p.y,delta_lon=Proj4js.common.adjust_lon(lon-this.long0),theta=lat,con=Proj4js.common.PI*Math.sin(lat),i=0;;i++){if(delta_theta=-(theta+Math.sin(theta)-con)/(1+Math.cos(theta)),theta+=delta_theta,Math.abs(delta_theta)<Proj4js.common.EPSLN)break;i>=50&&Proj4js.reportError("moll:Fwd:IterationError")}return theta/=2,Proj4js.common.PI/2-Math.abs(lat)<Proj4js.common.EPSLN&&(delta_lon=0),x=.900316316158*this.a*delta_lon*Math.cos(theta)+this.x0,y=1.4142135623731*this.a*Math.sin(theta)+this.y0,p.x=x,p.y=y,p},inverse:function(p){var arg,theta,lon,lat;return p.x-=this.x0,arg=p.y/(1.4142135623731*this.a),Math.abs(arg)>.999999999999&&(arg=.999999999999),theta=Math.asin(arg),lon=Proj4js.common.adjust_lon(this.long0+p.x/(.900316316158*this.a*Math.cos(theta))),lon<-Proj4js.common.PI&&(lon=-Proj4js.common.PI),lon>Proj4js.common.PI&&(lon=Proj4js.common.PI),arg=(2*theta+Math.sin(2*theta))/Proj4js.common.PI,Math.abs(arg)>1&&(arg=1),lat=Math.asin(arg),p.x=lon,p.y=lat,p}};OpenLayers={VERSION_NUMBER:"Release 2.13 dev",singleFile:!0,_getScriptLocation:function(){for(var r=new RegExp("(^|(.*?\\/))(OpenLayers[^\\/]*?\\.js)(\\?|$)"),s=document.getElementsByTagName("script"),src,m,l="",i=0,len=s.length;i<len;i++)if(src=s[i].getAttribute("src"),src&&(m=src.match(r),m)){l=m[1];break}return function(){return l}}(),ImgPath:""};OpenLayers.Class=function(){var len=arguments.length,P=arguments[0],F=arguments[len-1],C=typeof F.initialize=="function"?F.initialize:function(){P.prototype.initialize.apply(this,arguments)},newArgs;return len>1?(newArgs=[C,P].concat(Array.prototype.slice.call(arguments).slice(1,len-1),F),OpenLayers.inherit.apply(null,newArgs)):C.prototype=F,C};OpenLayers.inherit=function(C,P){var F=function(){},i,l,o;for(F.prototype=P.prototype,C.prototype=new F,i=2,l=arguments.length;i<l;i++)o=arguments[i],typeof o=="function"&&(o=o.prototype),OpenLayers.Util.extend(C.prototype,o)};OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.extend=function(destination,source){var property,value,sourceIsEvt;if(destination=destination||{},source){for(property in source)value=source[property],value!==undefined&&(destination[property]=value);sourceIsEvt=typeof window.Event=="function"&&source instanceof window.Event;!sourceIsEvt&&source.hasOwnProperty&&source.hasOwnProperty("toString")&&(destination.toString=source.toString)}return destination};OpenLayers.String={startsWith:function(str,sub){return str.indexOf(sub)==0},contains:function(str,sub){return str.indexOf(sub)!=-1},trim:function(str){return str.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(str){for(var s,oStringList=str.split("-"),camelizedString=oStringList[0],i=1,len=oStringList.length;i<len;i++)s=oStringList[i],camelizedString+=s.charAt(0).toUpperCase()+s.substring(1);return camelizedString},format:function(template,context,args){context||(context=window);var replacer=function(str,match){for(var replacement,subs=match.split(/\.+/),i=0;i<subs.length;i++)i==0&&(replacement=context),replacement=replacement[subs[i]];return typeof replacement=="function"&&(replacement=args?replacement.apply(null,args):replacement()),typeof replacement=="undefined"?"undefined":replacement};return template.replace(OpenLayers.String.tokenRegEx,replacer)},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(value){return OpenLayers.String.numberRegEx.test(value)},numericIf:function(value,trimWhitespace){var originalValue=value;return trimWhitespace===!0&&value!=null&&value.replace&&(value=value.replace(/^\s*|\s*$/g,"")),OpenLayers.String.isNumeric(value)?parseFloat(value):originalValue}};OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(num,sig){var fig=0;return sig>0&&(fig=parseFloat(num.toPrecision(sig))),fig},format:function(num,dec,tsep,dsep){var parts,integer,thousands,str,rem;if(dec=typeof dec!="undefined"?dec:0,tsep=typeof tsep!="undefined"?tsep:OpenLayers.Number.thousandsSeparator,dsep=typeof dsep!="undefined"?dsep:OpenLayers.Number.decimalSeparator,dec!=null&&(num=parseFloat(num.toFixed(dec))),parts=num.toString().split("."),parts.length==1&&dec==null&&(dec=0),integer=parts[0],tsep)for(thousands=/(-?[0-9]+)([0-9]{3})/;thousands.test(integer);)integer=integer.replace(thousands,"$1"+tsep+"$2");return dec==0?str=integer:(rem=parts.length>1?parts[1]:"0",dec!=null&&(rem=rem+new Array(dec-rem.length+1).join("0")),str=integer+dsep+rem),str}};OpenLayers.Function={bind:function(func,object){var args=Array.prototype.slice.apply(arguments,[2]);return function(){var newArgs=args.concat(Array.prototype.slice.apply(arguments,[0]));return func.apply(object,newArgs)}},bindAsEventListener:function(func,object){return function(event){return func.call(object,event||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}};OpenLayers.Array={filter:function(array,callback,caller){var selected=[],len,i,val;if(Array.prototype.filter)selected=array.filter(callback,caller);else{if(len=array.length,typeof callback!="function")throw new TypeError;for(i=0;i<len;i++)i in array&&(val=array[i],callback.call(caller,val,i,array)&&selected.push(val))}return selected}};OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(left,bottom,right,top){OpenLayers.Util.isArray(left)&&(top=left[3],right=left[2],bottom=left[1],left=left[0]);left!=null&&(this.left=OpenLayers.Util.toFloat(left));bottom!=null&&(this.bottom=OpenLayers.Util.toFloat(bottom));right!=null&&(this.right=OpenLayers.Util.toFloat(right));top!=null&&(this.top=OpenLayers.Util.toFloat(top))},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(bounds){var equals=!1;return bounds!=null&&(equals=this.left==bounds.left&&this.right==bounds.right&&this.top==bounds.top&&this.bottom==bounds.bottom),equals},toString:function(){return[this.left,this.bottom,this.right,this.top].join(",")},toArray:function(reverseAxisOrder){return reverseAxisOrder===!0?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]},toBBOX:function(decimal,reverseAxisOrder){decimal==null&&(decimal=6);var mult=Math.pow(10,decimal),xmin=Math.round(this.left*mult)/mult,ymin=Math.round(this.bottom*mult)/mult,xmax=Math.round(this.right*mult)/mult,ymax=Math.round(this.top*mult)/mult;return reverseAxisOrder===!0?ymin+","+xmin+","+ymax+","+xmax:xmin+","+ymin+","+xmax+","+ymax},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){return this.centerLonLat||(this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)),this.centerLonLat},scale:function(ratio,origin){var origx,origy;origin==null&&(origin=this.getCenterLonLat());origin.CLASS_NAME=="OpenLayers.LonLat"?(origx=origin.lon,origy=origin.lat):(origx=origin.x,origy=origin.y);var left=(this.left-origx)*ratio+origx,bottom=(this.bottom-origy)*ratio+origy,right=(this.right-origx)*ratio+origx,top=(this.top-origy)*ratio+origy;return new OpenLayers.Bounds(left,bottom,right,top)},add:function(x,y){if(x==null||y==null)throw new TypeError("Bounds.add cannot receive null values");return new OpenLayers.Bounds(this.left+x,this.bottom+y,this.right+x,this.top+y)},extend:function(object){var bounds=null;if(object){switch(object.CLASS_NAME){case"OpenLayers.LonLat":bounds=new OpenLayers.Bounds(object.lon,object.lat,object.lon,object.lat);break;case"OpenLayers.Geometry.Point":bounds=new OpenLayers.Bounds(object.x,object.y,object.x,object.y);break;case"OpenLayers.Bounds":bounds=object}bounds&&(this.centerLonLat=null,(this.left==null||bounds.left<this.left)&&(this.left=bounds.left),(this.bottom==null||bounds.bottom<this.bottom)&&(this.bottom=bounds.bottom),(this.right==null||bounds.right>this.right)&&(this.right=bounds.right),(this.top==null||bounds.top>this.top)&&(this.top=bounds.top))}},containsLonLat:function(ll,options){var contains,worldBounds;if(typeof options=="boolean"&&(options={inclusive:options}),options=options||{},contains=this.contains(ll.lon,ll.lat,options.inclusive),worldBounds=options.worldBounds,worldBounds&&!contains){var worldWidth=worldBounds.getWidth(),worldCenterX=(worldBounds.left+worldBounds.right)/2,worldsAway=Math.round((ll.lon-worldCenterX)/worldWidth);contains=this.containsLonLat({lon:ll.lon-worldsAway*worldWidth,lat:ll.lat},{inclusive:options.inclusive})}return contains},containsPixel:function(px,inclusive){return this.contains(px.x,px.y,inclusive)},contains:function(x,y,inclusive){return(inclusive==null&&(inclusive=!0),x==null||y==null)?!1:(x=OpenLayers.Util.toFloat(x),y=OpenLayers.Util.toFloat(y),inclusive?x>=this.left&&x<=this.right&&y>=this.bottom&&y<=this.top:x>this.left&&x<this.right&&y>this.bottom&&y<this.top)},intersectsBounds:function(bounds,options){var self,intersects,mightTouch;if(typeof options=="boolean"&&(options={inclusive:options}),options=options||{},options.worldBounds?(self=this.wrapDateLine(options.worldBounds),bounds=bounds.wrapDateLine(options.worldBounds)):self=this,options.inclusive==null&&(options.inclusive=!0),intersects=!1,mightTouch=self.left==bounds.right||self.right==bounds.left||self.top==bounds.bottom||self.bottom==bounds.top,options.inclusive||!mightTouch){var inBottom=bounds.bottom>=self.bottom&&bounds.bottom<=self.top||self.bottom>=bounds.bottom&&self.bottom<=bounds.top,inTop=bounds.top>=self.bottom&&bounds.top<=self.top||self.top>bounds.bottom&&self.top<bounds.top,inLeft=bounds.left>=self.left&&bounds.left<=self.right||self.left>=bounds.left&&self.left<=bounds.right,inRight=bounds.right>=self.left&&bounds.right<=self.right||self.right>=bounds.left&&self.right<=bounds.right;intersects=(inBottom||inTop)&&(inLeft||inRight)}if(options.worldBounds&&!intersects){var world=options.worldBounds,width=world.getWidth(),selfCrosses=!world.containsBounds(self),boundsCrosses=!world.containsBounds(bounds);selfCrosses&&!boundsCrosses?(bounds=bounds.add(-width,0),intersects=self.intersectsBounds(bounds,{inclusive:options.inclusive})):boundsCrosses&&!selfCrosses&&(self=self.add(-width,0),intersects=bounds.intersectsBounds(self,{inclusive:options.inclusive}))}return intersects},containsBounds:function(bounds,partial,inclusive){partial==null&&(partial=!1);inclusive==null&&(inclusive=!0);var bottomLeft=this.contains(bounds.left,bounds.bottom,inclusive),bottomRight=this.contains(bounds.right,bounds.bottom,inclusive),topLeft=this.contains(bounds.left,bounds.top,inclusive),topRight=this.contains(bounds.right,bounds.top,inclusive);return partial?bottomLeft||bottomRight||topLeft||topRight:bottomLeft&&bottomRight&&topLeft&&topRight},determineQuadrant:function(lonlat){var quadrant="",center=this.getCenterLonLat();return quadrant+=lonlat.lat<center.lat?"b":"t",quadrant+(lonlat.lon<center.lon?"l":"r")},transform:function(source,dest){this.centerLonLat=null;var ll=OpenLayers.Projection.transform({x:this.left,y:this.bottom},source,dest),lr=OpenLayers.Projection.transform({x:this.right,y:this.bottom},source,dest),ul=OpenLayers.Projection.transform({x:this.left,y:this.top},source,dest),ur=OpenLayers.Projection.transform({x:this.right,y:this.top},source,dest);return this.left=Math.min(ll.x,ul.x),this.bottom=Math.min(ll.y,lr.y),this.right=Math.max(lr.x,ur.x),this.top=Math.max(ul.y,ur.y),this},wrapDateLine:function(maxExtent,options){var width,newLeft;options=options||{};var leftTolerance=options.leftTolerance||0,rightTolerance=options.rightTolerance||0,newBounds=this.clone();if(maxExtent){for(width=maxExtent.getWidth();newBounds.left<maxExtent.left&&newBounds.right-rightTolerance<=maxExtent.left;)newBounds=newBounds.add(width,0);while(newBounds.left+leftTolerance>=maxExtent.right&&newBounds.right>maxExtent.right)newBounds=newBounds.add(-width,0);newLeft=newBounds.left+leftTolerance;newLeft<maxExtent.right&&newLeft>maxExtent.left&&newBounds.right-rightTolerance>maxExtent.right&&(newBounds=newBounds.add(-width,0))}return newBounds},CLASS_NAME:"OpenLayers.Bounds"});OpenLayers.Bounds.fromString=function(str,reverseAxisOrder){var bounds=str.split(",");return OpenLayers.Bounds.fromArray(bounds,reverseAxisOrder)};OpenLayers.Bounds.fromArray=function(bbox,reverseAxisOrder){return reverseAxisOrder===!0?new OpenLayers.Bounds(bbox[1],bbox[0],bbox[3],bbox[2]):new OpenLayers.Bounds(bbox[0],bbox[1],bbox[2],bbox[3])};OpenLayers.Bounds.fromSize=function(size){return new OpenLayers.Bounds(0,size.h,size.w,0)};OpenLayers.Bounds.oppositeQuadrant=function(quadrant){var opp="";return opp+=quadrant.charAt(0)=="t"?"b":"t",opp+(quadrant.charAt(1)=="l"?"r":"l")};OpenLayers.Element={visible:function(element){return OpenLayers.Util.getElement(element).style.display!="none"},toggle:function(){for(var element,display,i=0,len=arguments.length;i<len;i++)element=OpenLayers.Util.getElement(arguments[i]),display=OpenLayers.Element.visible(element)?"none":"",element.style.display=display},remove:function(element){element=OpenLayers.Util.getElement(element);element.parentNode.removeChild(element)},getHeight:function(element){return element=OpenLayers.Util.getElement(element),element.offsetHeight},hasClass:function(element,name){var names=element.className;return!!names&&new RegExp("(^|\\s)"+name+"(\\s|$)").test(names)},addClass:function(element,name){return OpenLayers.Element.hasClass(element,name)||(element.className+=(element.className?" ":"")+name),element},removeClass:function(element,name){var names=element.className;return names&&(element.className=OpenLayers.String.trim(names.replace(new RegExp("(^|\\s+)"+name+"(\\s+|$)")," "))),element},toggleClass:function(element,name){return OpenLayers.Element.hasClass(element,name)?OpenLayers.Element.removeClass(element,name):OpenLayers.Element.addClass(element,name),element},getStyle:function(element,style){var value,css,positions;return element=OpenLayers.Util.getElement(element),value=null,element&&element.style&&(value=element.style[OpenLayers.String.camelize(style)],value||(document.defaultView&&document.defaultView.getComputedStyle?(css=document.defaultView.getComputedStyle(element,null),value=css?css.getPropertyValue(style):null):element.currentStyle&&(value=element.currentStyle[OpenLayers.String.camelize(style)])),positions=["left","top","right","bottom"],window.opera&&OpenLayers.Util.indexOf(positions,style)!=-1&&OpenLayers.Element.getStyle(element,"position")=="static"&&(value="auto")),value=="auto"?null:value}};OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(lon,lat){OpenLayers.Util.isArray(lon)&&(lat=lon[1],lon=lon[0]);this.lon=OpenLayers.Util.toFloat(lon);this.lat=OpenLayers.Util.toFloat(lat)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(lon,lat){if(lon==null||lat==null)throw new TypeError("LonLat.add cannot receive null values");return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(lon),this.lat+OpenLayers.Util.toFloat(lat))},equals:function(ll){var equals=!1;return ll!=null&&(equals=this.lon==ll.lon&&this.lat==ll.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(ll.lon)&&isNaN(ll.lat)),equals},transform:function(source,dest){var point=OpenLayers.Projection.transform({x:this.lon,y:this.lat},source,dest);return this.lon=point.x,this.lat=point.y,this},wrapDateLine:function(maxExtent){var newLonLat=this.clone();if(maxExtent){while(newLonLat.lon<maxExtent.left)newLonLat.lon+=maxExtent.getWidth();while(newLonLat.lon>maxExtent.right)newLonLat.lon-=maxExtent.getWidth()}return newLonLat},CLASS_NAME:"OpenLayers.LonLat"});OpenLayers.LonLat.fromString=function(str){var pair=str.split(",");return new OpenLayers.LonLat(pair[0],pair[1])};OpenLayers.LonLat.fromArray=function(arr){var gotArr=OpenLayers.Util.isArray(arr),lon=gotArr&&arr[0],lat=gotArr&&arr[1];return new OpenLayers.LonLat(lon,lat)};OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(x,y){this.x=parseFloat(x);this.y=parseFloat(y)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(px){var equals=!1;return px!=null&&(equals=this.x==px.x&&this.y==px.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(px.x)&&isNaN(px.y)),equals},distanceTo:function(px){return Math.sqrt(Math.pow(this.x-px.x,2)+Math.pow(this.y-px.y,2))},add:function(x,y){if(x==null||y==null)throw new TypeError("Pixel.add cannot receive null values");return new OpenLayers.Pixel(this.x+x,this.y+y)},offset:function(px){var newPx=this.clone();return px&&(newPx=this.add(px.x,px.y)),newPx},CLASS_NAME:"OpenLayers.Pixel"});OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(w,h){this.w=parseFloat(w);this.h=parseFloat(h)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(sz){var equals=!1;return sz!=null&&(equals=this.w==sz.w&&this.h==sz.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(sz.w)&&isNaN(sz.h)),equals},CLASS_NAME:"OpenLayers.Size"});OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(error){alert(error)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"},function(){for(var scripts=document.getElementsByTagName("script"),i=0,len=scripts.length;i<len;++i)if(scripts[i].src.indexOf("firebug.js")!=-1&&console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}();OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){return OpenLayers.Lang.code||OpenLayers.Lang.setCode(),OpenLayers.Lang.code},setCode:function(code){var lang,parts,testLang;code||(code=OpenLayers.BROWSER_NAME=="msie"?navigator.userLanguage:navigator.language);parts=code.split("-");parts[0]=parts[0].toLowerCase();typeof OpenLayers.Lang[parts[0]]=="object"&&(lang=parts[0]);parts[1]&&(testLang=parts[0]+"-"+parts[1].toUpperCase(),typeof OpenLayers.Lang[testLang]=="object"&&(lang=testLang));lang||(OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+parts.join("-")+" dictionary, falling back to default language"),lang=OpenLayers.Lang.defaultCode);OpenLayers.Lang.code=lang},translate:function(key,context){var dictionary=OpenLayers.Lang[OpenLayers.Lang.getCode()],message=dictionary&&dictionary[key];return message||(message=key),context&&(message=OpenLayers.String.format(message,context)),message}};OpenLayers.i18n=OpenLayers.Lang.translate;OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.getElement=function(){for(var element,elements=[],i=0,len=arguments.length;i<len;i++){if(element=arguments[i],typeof element=="string"&&(element=document.getElementById(element)),arguments.length==1)return element;elements.push(element)}return elements};OpenLayers.Util.isElement=function(o){return!!(o&&o.nodeType===1)};OpenLayers.Util.isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]"};OpenLayers.Util.removeItem=function(array,item){for(var i=array.length-1;i>=0;i--)array[i]==item&&array.splice(i,1);return array};OpenLayers.Util.indexOf=function(array,obj){if(typeof array.indexOf=="function")return array.indexOf(obj);for(var i=0,len=array.length;i<len;i++)if(array[i]==obj)return i;return-1};OpenLayers.Util.dotless=/\./g;OpenLayers.Util.modifyDOMElement=function(element,id,px,sz,position,border,overflow,opacity){id&&(element.id=id.replace(OpenLayers.Util.dotless,"_"));px&&(element.style.left=px.x+"px",element.style.top=px.y+"px");sz&&(element.style.width=sz.w+"px",element.style.height=sz.h+"px");position&&(element.style.position=position);border&&(element.style.border=border);overflow&&(element.style.overflow=overflow);parseFloat(opacity)>=0&&parseFloat(opacity)<1?(element.style.filter="alpha(opacity="+opacity*100+")",element.style.opacity=opacity):parseFloat(opacity)==1&&(element.style.filter="",element.style.opacity="")};OpenLayers.Util.createDiv=function(id,px,sz,imgURL,position,border,overflow,opacity){var dom=document.createElement("div");return imgURL&&(dom.style.backgroundImage="url("+imgURL+")"),id||(id=OpenLayers.Util.createUniqueID("OpenLayersDiv")),position||(position="absolute"),OpenLayers.Util.modifyDOMElement(dom,id,px,sz,position,border,overflow,opacity),dom};OpenLayers.Util.createImage=function(id,px,sz,imgURL,position,border,opacity,delayDisplay){var image=document.createElement("img");if(id||(id=OpenLayers.Util.createUniqueID("OpenLayersDiv")),position||(position="relative"),OpenLayers.Util.modifyDOMElement(image,id,px,sz,position,border,null,opacity),delayDisplay){image.style.display="none";function display(){image.style.display="";OpenLayers.Event.stopObservingElement(image)}OpenLayers.Event.observe(image,"load",display);OpenLayers.Event.observe(image,"error",display)}return image.style.alt=id,image.galleryImg="no",imgURL&&(image.src=imgURL),image};OpenLayers.IMAGE_RELOAD_ATTEMPTS=0;OpenLayers.Util.alphaHackNeeded=null;OpenLayers.Util.alphaHack=function(){if(OpenLayers.Util.alphaHackNeeded==null){var arVersion=navigator.appVersion.split("MSIE"),version=parseFloat(arVersion[1]),filter=!1;try{filter=!!document.body.filters}catch(e){}OpenLayers.Util.alphaHackNeeded=filter&&version>=5.5&&version<7}return OpenLayers.Util.alphaHackNeeded};OpenLayers.Util.modifyAlphaImageDiv=function(div,id,px,sz,imgURL,position,border,sizing,opacity){OpenLayers.Util.modifyDOMElement(div,id,px,sz,position,null,null,opacity);var img=div.childNodes[0];imgURL&&(img.src=imgURL);OpenLayers.Util.modifyDOMElement(img,div.id+"_innerImage",null,sz,"relative",border);OpenLayers.Util.alphaHack()&&(div.style.display!="none"&&(div.style.display="inline-block"),sizing==null&&(sizing="scale"),div.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+img.src+"', sizingMethod='"+sizing+"')",parseFloat(div.style.opacity)>=0&&parseFloat(div.style.opacity)<1&&(div.style.filter+=" alpha(opacity="+div.style.opacity*100+")"),img.style.filter="alpha(opacity=0)")};OpenLayers.Util.createAlphaImageDiv=function(id,px,sz,imgURL,position,border,sizing,opacity,delayDisplay){var div=OpenLayers.Util.createDiv(),img=OpenLayers.Util.createImage(null,null,null,null,null,null,null,delayDisplay);return img.className="olAlphaImg",div.appendChild(img),OpenLayers.Util.modifyAlphaImageDiv(div,id,px,sz,imgURL,position,border,sizing,opacity),div};OpenLayers.Util.upperCaseObject=function(object){var uObject={};for(var key in object)uObject[key.toUpperCase()]=object[key];return uObject};OpenLayers.Util.applyDefaults=function(to,from){var fromIsEvt,key;to=to||{};fromIsEvt=typeof window.Event=="function"&&from instanceof window.Event;for(key in from)(to[key]===undefined||!fromIsEvt&&from.hasOwnProperty&&from.hasOwnProperty(key)&&!to.hasOwnProperty(key))&&(to[key]=from[key]);return!fromIsEvt&&from&&from.hasOwnProperty&&from.hasOwnProperty("toString")&&!to.hasOwnProperty("toString")&&(to.toString=from.toString),to};OpenLayers.Util.getParameterString=function(params){var paramsArray=[],key,value,encodedValue,encodedItemArray,item,itemIndex,len;for(key in params)if(value=params[key],value!=null&&typeof value!="function"){if(typeof value=="object"&&value.constructor==Array){for(encodedItemArray=[],itemIndex=0,len=value.length;itemIndex<len;itemIndex++)item=value[itemIndex],encodedItemArray.push(encodeURIComponent(item===null||item===undefined?"":item));encodedValue=encodedItemArray.join(",")}else encodedValue=encodeURIComponent(value);paramsArray.push(encodeURIComponent(key)+"="+encodedValue)}return paramsArray.join("&")};OpenLayers.Util.urlAppend=function(url,paramStr){var newUrl=url,parts;return paramStr&&(parts=(url+" ").split(/[?&]/),newUrl+=parts.pop()===" "?paramStr:parts.length?"&"+paramStr:"?"+paramStr),newUrl};OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"};OpenLayers.Util.getImageLocation=function(image){return OpenLayers.Util.getImagesLocation()+image};OpenLayers.Util.Try=function(){for(var lambda,returnValue=null,i=0,len=arguments.length;i<len;i++){lambda=arguments[i];try{returnValue=lambda();break}catch(e){}}return returnValue};OpenLayers.Util.getXmlNodeValue=function(node){var val=null;return OpenLayers.Util.Try(function(){val=node.text;val||(val=node.textContent);val||(val=node.firstChild.nodeValue)},function(){val=node.textContent}),val};OpenLayers.Util.mouseLeft=function(evt,div){for(var target=evt.relatedTarget?evt.relatedTarget:evt.toElement;target!=div&&target!=null;)target=target.parentNode;return target!=div};OpenLayers.Util.DEFAULT_PRECISION=14;OpenLayers.Util.toFloat=function(number,precision){return precision==null&&(precision=OpenLayers.Util.DEFAULT_PRECISION),typeof number!="number"&&(number=parseFloat(number)),precision===0?number:parseFloat(number.toPrecision(precision))};OpenLayers.Util.rad=function(x){return x*Math.PI/180};OpenLayers.Util.deg=function(x){return x*180/Math.PI};OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563};OpenLayers.Util.distVincenty=function(p1,p2){for(var ct=OpenLayers.Util.VincentyConstants,a=ct.a,b=ct.b,f=ct.f,L=OpenLayers.Util.rad(p2.lon-p1.lon),U1=Math.atan((1-f)*Math.tan(OpenLayers.Util.rad(p1.lat))),U2=Math.atan((1-f)*Math.tan(OpenLayers.Util.rad(p2.lat))),sinU1=Math.sin(U1),cosU1=Math.cos(U1),sinU2=Math.sin(U2),cosU2=Math.cos(U2),lambda=L,lambdaP=2*Math.PI,iterLimit=20;Math.abs(lambda-lambdaP)>1e-12&&--iterLimit>0;){var sinLambda=Math.sin(lambda),cosLambda=Math.cos(lambda),sinSigma=Math.sqrt(cosU2*sinLambda*cosU2*sinLambda+(cosU1*sinU2-sinU1*cosU2*cosLambda)*(cosU1*sinU2-sinU1*cosU2*cosLambda));if(sinSigma==0)return 0;var cosSigma=sinU1*sinU2+cosU1*cosU2*cosLambda,sigma=Math.atan2(sinSigma,cosSigma),alpha=Math.asin(cosU1*cosU2*sinLambda/sinSigma),cosSqAlpha=Math.cos(alpha)*Math.cos(alpha),cos2SigmaM=cosSigma-2*sinU1*sinU2/cosSqAlpha,C=f/16*cosSqAlpha*(4+f*(4-3*cosSqAlpha));lambdaP=lambda;lambda=L+(1-C)*f*Math.sin(alpha)*(sigma+C*sinSigma*(cos2SigmaM+C*cosSigma*(-1+2*cos2SigmaM*cos2SigmaM)))}if(iterLimit==0)return NaN;var uSq=cosSqAlpha*(a*a-b*b)/(b*b),A=1+uSq/16384*(4096+uSq*(-768+uSq*(320-175*uSq))),B=uSq/1024*(256+uSq*(-128+uSq*(74-47*uSq))),deltaSigma=B*sinSigma*(cos2SigmaM+B/4*(cosSigma*(-1+2*cos2SigmaM*cos2SigmaM)-B/6*cos2SigmaM*(-3+4*sinSigma*sinSigma)*(-3+4*cos2SigmaM*cos2SigmaM))),s=b*A*(sigma-deltaSigma);return s.toFixed(3)/1e3};OpenLayers.Util.destinationVincenty=function(lonlat,brng,dist){for(var u=OpenLayers.Util,ct=u.VincentyConstants,a=ct.a,b=ct.b,f=ct.f,lon1=lonlat.lon,lat1=lonlat.lat,s=dist,alpha1=u.rad(brng),sinAlpha1=Math.sin(alpha1),cosAlpha1=Math.cos(alpha1),tanU1=(1-f)*Math.tan(u.rad(lat1)),cosU1=1/Math.sqrt(1+tanU1*tanU1),sinU1=tanU1*cosU1,sigma1=Math.atan2(tanU1,cosAlpha1),sinAlpha=cosU1*sinAlpha1,cosSqAlpha=1-sinAlpha*sinAlpha,uSq=cosSqAlpha*(a*a-b*b)/(b*b),A=1+uSq/16384*(4096+uSq*(-768+uSq*(320-175*uSq))),B=uSq/1024*(256+uSq*(-128+uSq*(74-47*uSq))),sigma=s/(b*A),sigmaP=2*Math.PI;Math.abs(sigma-sigmaP)>1e-12;){var cos2SigmaM=Math.cos(2*sigma1+sigma),sinSigma=Math.sin(sigma),cosSigma=Math.cos(sigma),deltaSigma=B*sinSigma*(cos2SigmaM+B/4*(cosSigma*(-1+2*cos2SigmaM*cos2SigmaM)-B/6*cos2SigmaM*(-3+4*sinSigma*sinSigma)*(-3+4*cos2SigmaM*cos2SigmaM)));sigmaP=sigma;sigma=s/(b*A)+deltaSigma}var tmp=sinU1*sinSigma-cosU1*cosSigma*cosAlpha1,lat2=Math.atan2(sinU1*cosSigma+cosU1*sinSigma*cosAlpha1,(1-f)*Math.sqrt(sinAlpha*sinAlpha+tmp*tmp)),lambda=Math.atan2(sinSigma*sinAlpha1,cosU1*cosSigma-sinU1*sinSigma*cosAlpha1),C=f/16*cosSqAlpha*(4+f*(4-3*cosSqAlpha)),L=lambda-(1-C)*f*sinAlpha*(sigma+C*sinSigma*(cos2SigmaM+C*cosSigma*(-1+2*cos2SigmaM*cos2SigmaM))),revAz=Math.atan2(sinAlpha,-tmp);return new OpenLayers.LonLat(lon1+u.deg(L),u.deg(lat2))};OpenLayers.Util.getParameters=function(url){var paramsString,start,end,parameters,pairs,i,len,keyValue,key,value;for(url=url===null||url===undefined?window.location.href:url,paramsString="",OpenLayers.String.contains(url,"?")&&(start=url.indexOf("?")+1,end=OpenLayers.String.contains(url,"#")?url.indexOf("#"):url.length,paramsString=url.substring(start,end)),parameters={},pairs=paramsString.split(/[&;]/),i=0,len=pairs.length;i<len;++i)if(keyValue=pairs[i].split("="),keyValue[0]){key=keyValue[0];try{key=decodeURIComponent(key)}catch(err){key=unescape(key)}value=(keyValue[1]||"").replace(/\+/g," ");try{value=decodeURIComponent(value)}catch(err){value=unescape(value)}value=value.split(",");value.length==1&&(value=value[0]);parameters[key]=value}return parameters};OpenLayers.Util.lastSeqID=0;OpenLayers.Util.createUniqueID=function(prefix){return prefix=prefix==null?"id_":prefix.replace(OpenLayers.Util.dotless,"_"),OpenLayers.Util.lastSeqID+=1,prefix+OpenLayers.Util.lastSeqID};OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36};OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches;OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd;OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m;OpenLayers.METERS_PER_INCH=.0254000508001016;OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:.30480060960121919/OpenLayers.METERS_PER_INCH,IFoot:.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:.30479971018150881/OpenLayers.METERS_PER_INCH,IInch:.0254/OpenLayers.METERS_PER_INCH,MicroInch:254e-7/OpenLayers.METERS_PER_INCH,Mil:254e-10/OpenLayers.METERS_PER_INCH,Centimeter:.01/OpenLayers.METERS_PER_INCH,Kilometer:1e3/OpenLayers.METERS_PER_INCH,Yard:.91440182880365761/OpenLayers.METERS_PER_INCH,SearsYard:.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:.91439853074444077/OpenLayers.METERS_PER_INCH,IndianYd37:.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872233/OpenLayers.METERS_PER_INCH,Decimeter:.1/OpenLayers.METERS_PER_INCH,Millimeter:.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:.20116840233680469/OpenLayers.METERS_PER_INCH,BenoitLink:.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":5e4/OpenLayers.METERS_PER_INCH,"150kilometers":15e4/OpenLayers.METERS_PER_INCH});OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1e3,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:OpenLayers.INCHES_PER_UNIT.Meter*100,km:OpenLayers.INCHES_PER_UNIT.Meter*1e3,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH});OpenLayers.DOTS_PER_INCH=72;OpenLayers.Util.normalizeScale=function(scale){return scale>1?1/scale:scale};OpenLayers.Util.getResolutionFromScale=function(scale,units){var resolution,normScale;return scale&&(units==null&&(units="degrees"),normScale=OpenLayers.Util.normalizeScale(scale),resolution=1/(normScale*OpenLayers.INCHES_PER_UNIT[units]*OpenLayers.DOTS_PER_INCH)),resolution};OpenLayers.Util.getScaleFromResolution=function(resolution,units){units==null&&(units="degrees");return resolution*OpenLayers.INCHES_PER_UNIT[units]*OpenLayers.DOTS_PER_INCH};OpenLayers.Util.pagePosition=function(forElement){var pos=[0,0],viewportElement=OpenLayers.Util.getViewportElement(),BUGGY_GECKO_BOX_OBJECT,parent,box,scrollTop,scrollLeft,vpBox,browser;if(!forElement||forElement==window||forElement==viewportElement)return pos;if(BUGGY_GECKO_BOX_OBJECT=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&OpenLayers.Element.getStyle(forElement,"position")=="absolute"&&(forElement.style.top==""||forElement.style.left==""),parent=null,forElement.getBoundingClientRect)box=forElement.getBoundingClientRect(),scrollTop=viewportElement.scrollTop,scrollLeft=viewportElement.scrollLeft,pos[0]=box.left+scrollLeft,pos[1]=box.top+scrollTop;else if(document.getBoxObjectFor&&!BUGGY_GECKO_BOX_OBJECT)box=document.getBoxObjectFor(forElement),vpBox=document.getBoxObjectFor(viewportElement),pos[0]=box.screenX-vpBox.screenX,pos[1]=box.screenY-vpBox.screenY;else{if(pos[0]=forElement.offsetLeft,pos[1]=forElement.offsetTop,parent=forElement.offsetParent,parent!=forElement)while(parent)pos[0]+=parent.offsetLeft,pos[1]+=parent.offsetTop,parent=parent.offsetParent;for(browser=OpenLayers.BROWSER_NAME,(browser=="opera"||browser=="safari"&&OpenLayers.Element.getStyle(forElement,"position")=="absolute")&&(pos[1]-=document.body.offsetTop),parent=forElement.offsetParent;parent&&parent!=document.body;)pos[0]-=parent.scrollLeft,(browser!="opera"||parent.tagName!="TR")&&(pos[1]-=parent.scrollTop),parent=parent.offsetParent}return pos};OpenLayers.Util.getViewportElement=function(){var viewportElement=arguments.callee.viewportElement;return viewportElement==undefined&&(viewportElement=OpenLayers.BROWSER_NAME=="msie"&&document.compatMode!="CSS1Compat"?document.body:document.documentElement,arguments.callee.viewportElement=viewportElement),viewportElement};OpenLayers.Util.isEquivalentUrl=function(url1,url2,options){var urlObj1,urlObj2,key;options=options||{};OpenLayers.Util.applyDefaults(options,{ignoreCase:!0,ignorePort80:!0,ignoreHash:!0});urlObj1=OpenLayers.Util.createUrlObject(url1,options);urlObj2=OpenLayers.Util.createUrlObject(url2,options);for(key in urlObj1)if(key!=="args"&&urlObj1[key]!=urlObj2[key])return!1;for(key in urlObj1.args){if(urlObj1.args[key]!=urlObj2.args[key])return!1;delete urlObj2.args[key]}for(key in urlObj2.args)return!1;return!0};OpenLayers.Util.createUrlObject=function(url,options){var parts,a,urlObject,queryString,qMark;if(options=options||{},!/^\w+:\/\//.test(url)){var loc=window.location,port=loc.port?":"+loc.port:"",fullUrl=loc.protocol+"//"+loc.host.split(":").shift()+port;url.indexOf("/")===0?url=fullUrl+url:(parts=loc.pathname.split("/"),parts.pop(),url=fullUrl+parts.join("/")+"/"+url)}return options.ignoreCase&&(url=url.toLowerCase()),a=document.createElement("a"),a.href=url,urlObject={},urlObject.host=a.host.split(":").shift(),urlObject.protocol=a.protocol,urlObject.port=options.ignorePort80?a.port=="80"||a.port=="0"?"":a.port:a.port==""||a.port=="0"?"80":a.port,urlObject.hash=options.ignoreHash||a.hash==="#"?"":a.hash,queryString=a.search,queryString||(qMark=url.indexOf("?"),queryString=qMark!=-1?url.substr(qMark):""),urlObject.args=OpenLayers.Util.getParameters(queryString),urlObject.pathname=a.pathname.charAt(0)=="/"?a.pathname:"/"+a.pathname,urlObject};OpenLayers.Util.removeTail=function(url){var qMark=url.indexOf("?"),hashMark=url.indexOf("#");return qMark==-1?hashMark!=-1?url.substr(0,hashMark):url:hashMark!=-1?url.substr(0,Math.min(qMark,hashMark)):url.substr(0,qMark)};OpenLayers.IS_GECKO=function(){var ua=navigator.userAgent.toLowerCase();return ua.indexOf("webkit")==-1&&ua.indexOf("gecko")!=-1}();OpenLayers.CANVAS_SUPPORTED=function(){var elem=document.createElement("canvas");return!!(elem.getContext&&elem.getContext("2d"))}();OpenLayers.BROWSER_NAME=function(){var name="",ua=navigator.userAgent.toLowerCase();return ua.indexOf("opera")!=-1?name="opera":ua.indexOf("msie")!=-1?name="msie":ua.indexOf("safari")!=-1?name="safari":ua.indexOf("mozilla")!=-1&&(name=ua.indexOf("firefox")!=-1?"firefox":"mozilla"),name}();OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME};OpenLayers.Util.getRenderedDimensions=function(contentHTML,size,options){var w,h,container=document.createElement("div"),parentPosition,content,i,l;container.style.visibility="hidden";for(var containerElement=options&&options.containerElement?options.containerElement:document.body,parentHasPositionAbsolute=!1,superContainer=null,parent=containerElement;parent&&parent.tagName.toLowerCase()!="body";){if(parentPosition=OpenLayers.Element.getStyle(parent,"position"),parentPosition=="absolute"){parentHasPositionAbsolute=!0;break}else if(parentPosition&&parentPosition!="static")break;parent=parent.parentNode}if(parentHasPositionAbsolute&&(containerElement.clientHeight===0||containerElement.clientWidth===0)&&(superContainer=document.createElement("div"),superContainer.style.visibility="hidden",superContainer.style.position="absolute",superContainer.style.overflow="visible",superContainer.style.width=document.body.clientWidth+"px",superContainer.style.height=document.body.clientHeight+"px",superContainer.appendChild(container)),container.style.position="absolute",size&&(size.w?(w=size.w,container.style.width=w+"px"):size.h&&(h=size.h,container.style.height=h+"px")),options&&options.displayClass&&(container.className=options.displayClass),content=document.createElement("div"),content.innerHTML=contentHTML,content.style.overflow="visible",content.childNodes)for(i=0,l=content.childNodes.length;i<l;i++)content.childNodes[i].style&&(content.childNodes[i].style.overflow="visible");return container.appendChild(content),superContainer?containerElement.appendChild(superContainer):containerElement.appendChild(container),w||(w=parseInt(content.scrollWidth),container.style.width=w+"px"),h||(h=parseInt(content.scrollHeight)),container.removeChild(content),superContainer?(superContainer.removeChild(container),containerElement.removeChild(superContainer)):containerElement.removeChild(container),new OpenLayers.Size(w,h)};OpenLayers.Util.getScrollbarWidth=function(){var scrollbarWidth=OpenLayers.Util._scrollbarWidth;if(scrollbarWidth==null){var scr=null,inn=null,wNoScroll=0,wScroll=0;scr=document.createElement("div");scr.style.position="absolute";scr.style.top="-1000px";scr.style.left="-1000px";scr.style.width="100px";scr.style.height="50px";scr.style.overflow="hidden";inn=document.createElement("div");inn.style.width="100%";inn.style.height="200px";scr.appendChild(inn);document.body.appendChild(scr);wNoScroll=inn.offsetWidth;scr.style.overflow="scroll";wScroll=inn.offsetWidth;document.body.removeChild(document.body.lastChild);OpenLayers.Util._scrollbarWidth=wNoScroll-wScroll;scrollbarWidth=OpenLayers.Util._scrollbarWidth}return scrollbarWidth};OpenLayers.Util.getFormattedLonLat=function(coordinate,axis,dmsOption){var coordinateseconds,str;dmsOption||(dmsOption="dms");coordinate=(coordinate+540)%360-180;var abscoordinate=Math.abs(coordinate),coordinatedegrees=Math.floor(abscoordinate),coordinateminutes=(abscoordinate-coordinatedegrees)/(1/60),tempcoordinateminutes=coordinateminutes;return coordinateminutes=Math.floor(coordinateminutes),coordinateseconds=(tempcoordinateminutes-coordinateminutes)/(1/60),coordinateseconds=Math.round(coordinateseconds*10),coordinateseconds/=10,coordinateseconds>=60&&(coordinateseconds-=60,coordinateminutes+=1,coordinateminutes>=60&&(coordinateminutes-=60,coordinatedegrees+=1)),coordinatedegrees<10&&(coordinatedegrees="0"+coordinatedegrees),str=coordinatedegrees+"",dmsOption.indexOf("dm")>=0&&(coordinateminutes<10&&(coordinateminutes="0"+coordinateminutes),str+=coordinateminutes+"'",dmsOption.indexOf("dms")>=0&&(coordinateseconds<10&&(coordinateseconds="0"+coordinateseconds),str+=coordinateseconds+'"')),str+(axis=="lon"?coordinate<0?OpenLayers.i18n("W"):OpenLayers.i18n("E"):coordinate<0?OpenLayers.i18n("S"):OpenLayers.i18n("N"))};OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(options){OpenLayers.Util.extend(this,options);this.options=options},destroy:function(){},read:function(){throw new Error("Read not implemented.");},write:function(){throw new Error("Write not implemented.");},CLASS_NAME:"OpenLayers.Format"});OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(options){window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM"));OpenLayers.Format.prototype.initialize.apply(this,[options]);this.namespaces=OpenLayers.Util.extend({},this.namespaces);this.namespaceAlias={};for(var alias in this.namespaces)this.namespaceAlias[this.namespaces[alias]]=alias},destroy:function(){this.xmldom=null;OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(alias,uri){this.namespaces[alias]=uri;this.namespaceAlias[uri]=alias},read:function(text){var index=text.indexOf("<"),node;return index>0&&(text=text.substring(index)),node=OpenLayers.Util.Try(OpenLayers.Function.bind(function(){var xmldom;return xmldom=window.ActiveXObject&&!this.xmldom?new ActiveXObject("Microsoft.XMLDOM"):this.xmldom,xmldom.loadXML(text),xmldom},this),function(){return(new DOMParser).parseFromString(text,"text/xml")},function(){var req=new XMLHttpRequest;return req.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(text),!1),req.overrideMimeType&&req.overrideMimeType("text/xml"),req.send(null),req.responseXML}),this.keepData&&(this.data=node),node},write:function(node){var data,serializer,doc;return this.xmldom?data=node.xml:(serializer=new XMLSerializer,node.nodeType==1?(doc=document.implementation.createDocument("","",null),doc.importNode&&(node=doc.importNode(node,!0)),doc.appendChild(node),data=serializer.serializeToString(doc)):data=serializer.serializeToString(node)),data},createElementNS:function(uri,name){return this.xmldom?typeof uri=="string"?this.xmldom.createNode(1,name,uri):this.xmldom.createNode(1,name,""):document.createElementNS(uri,name)},createTextNode:function(text){return typeof text!="string"&&(text=String(text)),this.xmldom?this.xmldom.createTextNode(text):document.createTextNode(text)},getElementsByTagNameNS:function(node,uri,name){var elements=[],allNodes,potentialNode,fullName,i,len;if(node.getElementsByTagNameNS)elements=node.getElementsByTagNameNS(uri,name);else for(allNodes=node.getElementsByTagName("*"),i=0,len=allNodes.length;i<len;++i)potentialNode=allNodes[i],fullName=potentialNode.prefix?potentialNode.prefix+":"+name:name,(name=="*"||fullName==potentialNode.nodeName)&&(uri=="*"||uri==potentialNode.namespaceURI)&&elements.push(potentialNode);return elements},getAttributeNodeNS:function(node,uri,name){var attributeNode=null,attributes,potentialNode,fullName,i,len;if(node.getAttributeNodeNS)attributeNode=node.getAttributeNodeNS(uri,name);else for(attributes=node.attributes,i=0,len=attributes.length;i<len;++i)if(potentialNode=attributes[i],potentialNode.namespaceURI==uri&&(fullName=potentialNode.prefix?potentialNode.prefix+":"+name:name,fullName==potentialNode.nodeName)){attributeNode=potentialNode;break}return attributeNode},getAttributeNS:function(node,uri,name){var attributeValue="",attributeNode;return node.getAttributeNS?attributeValue=node.getAttributeNS(uri,name)||"":(attributeNode=this.getAttributeNodeNS(node,uri,name),attributeNode&&(attributeValue=attributeNode.nodeValue)),attributeValue},getChildValue:function(node,def){var value=def||"",child;if(node)for(child=node.firstChild;child;child=child.nextSibling)switch(child.nodeType){case 3:case 4:value+=child.nodeValue}return value},isSimpleContent:function(node){for(var simple=!0,child=node.firstChild;child;child=child.nextSibling)if(child.nodeType===1){simple=!1;break}return simple},contentType:function(node){for(var simple=!1,complex=!1,type=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY,child=node.firstChild;child;child=child.nextSibling){switch(child.nodeType){case 1:complex=!0;break;case 8:break;default:simple=!0}if(complex&&simple)break}if(complex&&simple)type=OpenLayers.Format.XML.CONTENT_TYPE.MIXED;else{if(complex)return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX;if(simple)return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}return type},hasAttributeNS:function(node,uri,name){return node.hasAttributeNS?node.hasAttributeNS(uri,name):!!this.getAttributeNodeNS(node,uri,name)},setAttributeNS:function(node,uri,name,value){if(node.setAttributeNS)node.setAttributeNS(uri,name,value);else if(this.xmldom)if(uri){var attribute=node.ownerDocument.createNode(2,name,uri);attribute.nodeValue=value;node.setAttributeNode(attribute)}else node.setAttribute(name,value);else throw"setAttributeNS not implemented";},createElementNSPlus:function(name,options){var uri,loc,node,value;return options=options||{},uri=options.uri||this.namespaces[options.prefix],uri||(loc=name.indexOf(":"),uri=this.namespaces[name.substring(0,loc)]),uri||(uri=this.namespaces[this.defaultPrefix]),node=this.createElementNS(uri,name),options.attributes&&this.setAttributes(node,options.attributes),value=options.value,value!=null&&node.appendChild(this.createTextNode(value)),node},setAttributes:function(node,obj){var value,uri;for(var name in obj)obj[name]!=null&&obj[name].toString&&(value=obj[name].toString(),uri=this.namespaces[name.substring(0,name.indexOf(":"))]||null,this.setAttributeNS(node,uri,name,value))},readNode:function(node,obj){var group,local,reader;return obj||(obj={}),group=this.readers[node.namespaceURI?this.namespaceAlias[node.namespaceURI]:this.defaultPrefix],group&&(local=node.localName||node.nodeName.split(":").pop(),reader=group[local]||group["*"],reader&&reader.apply(this,[node,obj])),obj},readChildNodes:function(node,obj){var children,child,i,len;for(obj||(obj={}),children=node.childNodes,i=0,len=children.length;i<len;++i)child=children[i],child.nodeType==1&&this.readNode(child,obj);return obj},writeNode:function(name,obj,parent){var prefix,local,split=name.indexOf(":"),child;return split>0?(prefix=name.substring(0,split),local=name.substring(split+1)):(prefix=parent?this.namespaceAlias[parent.namespaceURI]:this.defaultPrefix,local=name),child=this.writers[prefix][local].apply(this,[obj]),parent&&parent.appendChild(child),child},getChildEl:function(node,name,uri){return node&&this.getThisOrNextEl(node.firstChild,name,uri)},getNextEl:function(node,name,uri){return node&&this.getThisOrNextEl(node.nextSibling,name,uri)},getThisOrNextEl:function(node,name,uri){outer:for(var sibling=node;sibling;sibling=sibling.nextSibling)switch(sibling.nodeType){case 1:if((!name||name===(sibling.localName||sibling.nodeName.split(":").pop()))&&(!uri||uri===sibling.namespaceURI))break outer;sibling=null;break outer;case 3:if(/^\s*$/.test(sibling.nodeValue))break;case 4:case 6:case 12:case 10:case 11:sibling=null;break outer}return sibling||null},lookupNamespaceURI:function(node,prefix){var uri=null,len,attr,i;if(node)if(node.lookupNamespaceURI)uri=node.lookupNamespaceURI(prefix);else outer:switch(node.nodeType){case 1:if(node.namespaceURI!==null&&node.prefix===prefix){uri=node.namespaceURI;break outer}if(len=node.attributes.length,len)for(i=0;i<len;++i)if(attr=node.attributes[i],attr.prefix==="xmlns"&&attr.name==="xmlns:"+prefix){uri=attr.value||null;break outer}else if(attr.name==="xmlns"&&prefix===null){uri=attr.value||null;break outer}uri=this.lookupNamespaceURI(node.parentNode,prefix);break outer;case 2:uri=this.lookupNamespaceURI(node.ownerElement,prefix);break outer;case 9:uri=this.lookupNamespaceURI(node.documentElement,prefix);break outer;case 6:case 12:case 10:case 11:break outer;default:uri=this.lookupNamespaceURI(node.parentNode,prefix)}return uri},getXMLDoc:function(){return OpenLayers.Format.XML.document||this.xmldom||(document.implementation&&document.implementation.createDocument?OpenLayers.Format.XML.document=document.implementation.createDocument("","",null):!this.xmldom&&window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM"))),OpenLayers.Format.XML.document||this.xmldom},CLASS_NAME:"OpenLayers.Format.XML"});OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3};OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype);OpenLayers.Format.XML.document=null;OpenLayers.Date={dateRegEx:/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/,toISOString:function(){function pad(num,len){for(var str=num+"";str.length<len;)str="0"+str;return str}return"toISOString"in Date.prototype?function(date){return date.toISOString()}:function(date){return isNaN(date.getTime())?"Invalid Date":date.getUTCFullYear()+"-"+pad(date.getUTCMonth()+1,2)+"-"+pad(date.getUTCDate(),2)+"T"+pad(date.getUTCHours(),2)+":"+pad(date.getUTCMinutes(),2)+":"+pad(date.getUTCSeconds(),2)+"."+pad(date.getUTCMilliseconds(),3)+"Z"}}(),parse:function(str){var date,match=str.match(this.dateRegEx),type;if(match&&(match[1]||match[7])){var year=parseInt(match[1],10)||0,month=parseInt(match[2],10)-1||0,day=parseInt(match[3],10)||1;if(date=new Date(Date.UTC(year,month,day)),type=match[7],type){var hours=parseInt(match[4],10),minutes=parseInt(match[5],10),secFrac=parseFloat(match[6]),seconds=secFrac|0,milliseconds=Math.round(1e3*(secFrac-seconds));if(date.setUTCHours(hours,minutes,seconds,milliseconds),type!=="Z"){var hoursOffset=parseInt(type,10),minutesOffset=parseInt(match[8],10)||0,offset=-1e3*(hoursOffset*3600+minutesOffset*60);date=new Date(date.getTime()+offset)}}}else date=new Date("invalid");return date}};OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(layer,lonlat,data){this.layer=layer;this.lonlat=lonlat;this.data=data!=null?data:{};this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.layer!=null&&this.layer.map!=null&&this.popup!=null&&this.layer.map.removePopup(this.popup);this.layer!=null&&this.marker!=null&&this.layer.removeMarker(this.marker);this.layer=null;this.id=null;this.lonlat=null;this.data=null;this.marker!=null&&(this.destroyMarker(this.marker),this.marker=null);this.popup!=null&&(this.destroyPopup(this.popup),this.popup=null)},onScreen:function(){var onScreen=!1,screenBounds;return this.layer!=null&&this.layer.map!=null&&(screenBounds=this.layer.map.getExtent(),onScreen=screenBounds.containsLonLat(this.lonlat)),onScreen},createMarker:function(){return this.lonlat!=null&&(this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon)),this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(closeBox){if(this.lonlat!=null){if(!this.popup){var anchor=this.marker?this.marker.icon:null,popupClass=this.popupClass?this.popupClass:OpenLayers.Popup.Anchored;this.popup=new popupClass(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,anchor,closeBox)}this.data.overflow!=null&&(this.popup.contentDiv.style.overflow=this.data.overflow);this.popup.feature=this}return this.popup},destroyPopup:function(){this.popup&&(this.popup.feature=null,this.popup.destroy(),this.popup=null)},CLASS_NAME:"OpenLayers.Feature"});OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(geometry,attributes,style){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,attributes]);this.lonlat=null;this.geometry=geometry?geometry:null;this.state=null;this.attributes={};attributes&&(this.attributes=OpenLayers.Util.extend(this.attributes,attributes));this.style=style?style:null},destroy:function(){this.layer&&(this.layer.removeFeatures(this),this.layer=null);this.geometry=null;this.modified=null;OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(boundsOnly){var onScreen=!1,screenBounds,featureBounds,screenPoly;return this.layer&&this.layer.map&&(screenBounds=this.layer.map.getExtent(),boundsOnly?(featureBounds=this.geometry.getBounds(),onScreen=screenBounds.intersectsBounds(featureBounds)):(screenPoly=screenBounds.toGeometry(),onScreen=screenPoly.intersects(this.geometry))),onScreen},getVisibility:function(){return!(this.style&&this.style.display=="none"||!this.layer||this.layer&&this.layer.styleMap&&this.layer.styleMap.createSymbolizer(this,this.renderIntent).display=="none"||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(lonlat,toleranceLon,toleranceLat){var atPoint=!1;return this.geometry&&(atPoint=this.geometry.atPoint(lonlat,toleranceLon,toleranceLat)),atPoint},destroyPopup:function(){},move:function(location){var pixel,lastPixel,res;return!this.layer||!this.geometry.move?undefined:(pixel=location.CLASS_NAME=="OpenLayers.LonLat"?this.layer.getViewPortPxFromLonLat(location):location,lastPixel=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),res=this.layer.map.getResolution(),this.geometry.move(res*(pixel.x-lastPixel.x),res*(lastPixel.y-pixel.y)),this.layer.drawFeature(this),lastPixel)},toState:function(state){if(state==OpenLayers.State.UPDATE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=state}else if(state==OpenLayers.State.INSERT)switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=state}else if(state==OpenLayers.State.DELETE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=state}else state==OpenLayers.State.UNKNOWN&&(this.state=state)},CLASS_NAME:"OpenLayers.Feature.Vector"});OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},"delete":{display:"none"}};OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.id=null;this.bounds=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(bounds){bounds&&(this.bounds=bounds.clone())},clearBounds:function(){this.bounds=null;this.parent&&this.parent.clearBounds()},extendBounds:function(newBounds){var bounds=this.getBounds();bounds?this.bounds.extend(newBounds):this.setBounds(newBounds)},getBounds:function(){return this.bounds==null&&this.calculateBounds(),this.bounds},calculateBounds:function(){},distanceTo:function(){},getVertices:function(){},atPoint:function(lonlat,toleranceLon,toleranceLat){var atPoint=!1,bounds=this.getBounds();if(bounds!=null&&lonlat!=null){var dX=toleranceLon!=null?toleranceLon:0,dY=toleranceLat!=null?toleranceLat:0,toleranceBounds=new OpenLayers.Bounds(this.bounds.left-dX,this.bounds.bottom-dY,this.bounds.right+dX,this.bounds.top+dY);atPoint=toleranceBounds.containsLonLat(lonlat)}return atPoint},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){return OpenLayers.Format&&OpenLayers.Format.WKT?OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this)):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Geometry"});OpenLayers.Geometry.fromWKT=function(wkt){var geom,format,result,len,components,i;if(OpenLayers.Format&&OpenLayers.Format.WKT)if(format=OpenLayers.Geometry.fromWKT.format,format||(format=new OpenLayers.Format.WKT,OpenLayers.Geometry.fromWKT.format=format),result=format.read(wkt),result instanceof OpenLayers.Feature.Vector)geom=result.geometry;else if(OpenLayers.Util.isArray(result)){for(len=result.length,components=new Array(len),i=0;i<len;++i)components[i]=result[i].geometry;geom=new OpenLayers.Geometry.Collection(components)}return geom};OpenLayers.Geometry.segmentsIntersect=function(seg1,seg2,options){var point=options&&options.point,tolerance=options&&options.tolerance,intersection=!1,x11_21=seg1.x1-seg2.x1,y11_21=seg1.y1-seg2.y1,x12_11=seg1.x2-seg1.x1,y12_11=seg1.y2-seg1.y1,y22_21=seg2.y2-seg2.y1,x22_21=seg2.x2-seg2.x1,d=y22_21*x12_11-x22_21*y12_11,n1=x22_21*y11_21-y22_21*x11_21,n2=x12_11*y11_21-y12_11*x11_21,along1,along2,dist,seg,segs,source,target,x,y,p,result,i,j;if(d==0?n1==0&&n2==0&&(intersection=!0):(along1=n1/d,along2=n2/d,along1>=0&&along1<=1&&along2>=0&&along2<=1&&(point?(x=seg1.x1+along1*x12_11,y=seg1.y1+along1*y12_11,intersection=new OpenLayers.Geometry.Point(x,y)):intersection=!0)),tolerance)if(intersection){if(point){segs=[seg1,seg2];outer:for(i=0;i<2;++i)for(seg=segs[i],j=1;j<3;++j)if(x=seg["x"+j],y=seg["y"+j],dist=Math.sqrt(Math.pow(x-intersection.x,2)+Math.pow(y-intersection.y,2)),dist<tolerance){intersection.x=x;intersection.y=y;break outer}}}else{segs=[seg1,seg2];outer:for(i=0;i<2;++i)for(source=segs[i],target=segs[(i+1)%2],j=1;j<3;++j)if(p={x:source["x"+j],y:source["y"+j]},result=OpenLayers.Geometry.distanceToSegment(p,target),result.distance<tolerance){intersection=point?new OpenLayers.Geometry.Point(p.x,p.y):!0;break outer}}return intersection};OpenLayers.Geometry.distanceToSegment=function(point,segment){var x0=point.x,y0=point.y,x1=segment.x1,y1=segment.y1,x2=segment.x2,y2=segment.y2,dx=x2-x1,dy=y2-y1,along=(dx*(x0-x1)+dy*(y0-y1))/(Math.pow(dx,2)+Math.pow(dy,2)),x,y;return along<=0?(x=x1,y=y1):along>=1?(x=x2,y=y2):(x=x1+along*dx,y=y1+along*dy),{distance:Math.sqrt(Math.pow(x-x0,2)+Math.pow(y-y0,2)),x:x,y:y}};OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(x,y){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.x=parseFloat(x);this.y=parseFloat(y)},clone:function(obj){return obj==null&&(obj=new OpenLayers.Geometry.Point(this.x,this.y)),OpenLayers.Util.applyDefaults(obj,this),obj},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(geometry,options){var edge=!(options&&options.edge===!1),details=edge&&options&&options.details,distance,x0,y0,x1,y1,result;return geometry instanceof OpenLayers.Geometry.Point?(x0=this.x,y0=this.y,x1=geometry.x,y1=geometry.y,distance=Math.sqrt(Math.pow(x0-x1,2)+Math.pow(y0-y1,2)),result=details?{x0:x0,y0:y0,x1:x1,y1:y1,distance:distance}:distance):(result=geometry.distanceTo(this,options),details&&(result={x0:result.x1,y0:result.y1,x1:result.x0,y1:result.y0,distance:result.distance})),result},equals:function(geom){var equals=!1;return geom!=null&&(equals=this.x==geom.x&&this.y==geom.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(geom.x)&&isNaN(geom.y)),equals},toShortString:function(){return this.x+", "+this.y},move:function(x,y){this.x=this.x+x;this.y=this.y+y;this.clearBounds()},rotate:function(angle,origin){angle*=Math.PI/180;var radius=this.distanceTo(origin),theta=angle+Math.atan2(this.y-origin.y,this.x-origin.x);this.x=origin.x+radius*Math.cos(theta);this.y=origin.y+radius*Math.sin(theta);this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(scale,origin,ratio){return ratio=ratio==undefined?1:ratio,this.x=origin.x+scale*ratio*(this.x-origin.x),this.y=origin.y+scale*(this.y-origin.y),this.clearBounds(),this},intersects:function(geometry){return geometry.CLASS_NAME=="OpenLayers.Geometry.Point"?this.equals(geometry):geometry.intersects(this)},transform:function(source,dest){return source&&dest&&(OpenLayers.Projection.transform(this,source,dest),this.bounds=null),this},getVertices:function(){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"});OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(components){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.components=[];components!=null&&this.addComponents(components)},destroy:function(){this.components.length=0;this.components=null;OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){for(var geometry=eval("new "+this.CLASS_NAME+"()"),i=0,len=this.components.length;i<len;i++)geometry.addComponent(this.components[i].clone());return OpenLayers.Util.applyDefaults(geometry,this),geometry},getComponentsString:function(){for(var strings=[],i=0,len=this.components.length;i<len;i++)strings.push(this.components[i].toShortString());return strings.join(",")},calculateBounds:function(){var bounds,components,i,len;if(this.bounds=null,bounds=new OpenLayers.Bounds,components=this.components,components)for(i=0,len=components.length;i<len;i++)bounds.extend(components[i].getBounds());bounds.left!=null&&bounds.bottom!=null&&bounds.right!=null&&bounds.top!=null&&this.setBounds(bounds)},addComponents:function(components){OpenLayers.Util.isArray(components)||(components=[components]);for(var i=0,len=components.length;i<len;i++)this.addComponent(components[i])},addComponent:function(component,index){var added=!1,components1,components2;return component&&(this.componentTypes==null||OpenLayers.Util.indexOf(this.componentTypes,component.CLASS_NAME)>-1)&&(index!=null&&index<this.components.length?(components1=this.components.slice(0,index),components2=this.components.slice(index,this.components.length),components1.push(component),this.components=components1.concat(components2)):this.components.push(component),component.parent=this,this.clearBounds(),added=!0),added},removeComponents:function(components){var removed=!1,i;for(OpenLayers.Util.isArray(components)||(components=[components]),i=components.length-1;i>=0;--i)removed=this.removeComponent(components[i])||removed;return removed},removeComponent:function(component){return OpenLayers.Util.removeItem(this.components,component),this.clearBounds(),!0},getLength:function(){for(var length=0,i=0,len=this.components.length;i<len;i++)length+=this.components[i].getLength();return length},getArea:function(){for(var area=0,i=0,len=this.components.length;i<len;i++)area+=this.components[i].getArea();return area},getGeodesicArea:function(projection){for(var area=0,i=0,len=this.components.length;i<len;i++)area+=this.components[i].getGeodesicArea(projection);return area},getCentroid:function(weighted){var len,xSum,ySum,centroid,area,i;if(!weighted)return this.components.length&&this.components[0].getCentroid();if(len=this.components.length,!len)return!1;var areas=[],centroids=[],areaSum=0,minArea=Number.MAX_VALUE,component;for(i=0;i<len;++i)(component=this.components[i],area=component.getArea(),centroid=component.getCentroid(!0),isNaN(area)||isNaN(centroid.x)||isNaN(centroid.y))||(areas.push(area),areaSum+=area,minArea=area<minArea&&area>0?area:minArea,centroids.push(centroid));if(len=areas.length,areaSum===0){for(i=0;i<len;++i)areas[i]=1;areaSum=areas.length}else{for(i=0;i<len;++i)areas[i]/=minArea;areaSum/=minArea}for(xSum=0,ySum=0,i=0;i<len;++i)centroid=centroids[i],area=areas[i],xSum+=centroid.x*area,ySum+=centroid.y*area;return new OpenLayers.Geometry.Point(xSum/areaSum,ySum/areaSum)},getGeodesicLength:function(projection){for(var length=0,i=0,len=this.components.length;i<len;i++)length+=this.components[i].getGeodesicLength(projection);return length},move:function(x,y){for(var i=0,len=this.components.length;i<len;i++)this.components[i].move(x,y)},rotate:function(angle,origin){for(var i=0,len=this.components.length;i<len;++i)this.components[i].rotate(angle,origin)},resize:function(scale,origin,ratio){for(var i=0;i<this.components.length;++i)this.components[i].resize(scale,origin,ratio);return this},distanceTo:function(geometry,options){for(var edge=!(options&&options.edge===!1),details=edge&&options&&options.details,result,best,distance,min=Number.POSITIVE_INFINITY,i=0,len=this.components.length;i<len;++i)if(result=this.components[i].distanceTo(geometry,options),distance=details?result.distance:result,distance<min&&(min=distance,best=result,min==0))break;return best},equals:function(geometry){var equivalent=!0,i,len;if(geometry&&geometry.CLASS_NAME&&this.CLASS_NAME==geometry.CLASS_NAME)if(OpenLayers.Util.isArray(geometry.components)&&geometry.components.length==this.components.length){for(i=0,len=this.components.length;i<len;++i)if(!this.components[i].equals(geometry.components[i])){equivalent=!1;break}}else equivalent=!1;else equivalent=!1;return equivalent},transform:function(source,dest){var i,len,component;if(source&&dest){for(i=0,len=this.components.length;i<len;i++)component=this.components[i],component.transform(source,dest);this.bounds=null}return this},intersects:function(geometry){for(var intersect=!1,i=0,len=this.components.length;i<len;++i)if(intersect=geometry.intersects(this.components[i]),intersect)break;return intersect},getVertices:function(nodes){for(var vertices=[],i=0,len=this.components.length;i<len;++i)Array.prototype.push.apply(vertices,this.components[i].getVertices(nodes));return vertices},CLASS_NAME:"OpenLayers.Geometry.Collection"});OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],addPoint:function(point,index){this.addComponent(point,index)},removePoint:function(point){this.removeComponent(point)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"});OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],getLength:function(){var length=0,i,len;if(this.components&&this.components.length>1)for(i=1,len=this.components.length;i<len;i++)length+=this.components[i-1].distanceTo(this.components[i]);return length},getGeodesicLength:function(projection){var geom=this,gg,length,p1,p2,i,len;if(projection&&(gg=new OpenLayers.Projection("EPSG:4326"),gg.equals(projection)||(geom=this.clone().transform(projection,gg))),length=0,geom.components&&geom.components.length>1)for(i=1,len=geom.components.length;i<len;i++)p1=geom.components[i-1],p2=geom.components[i],length+=OpenLayers.Util.distVincenty({lon:p1.x,lat:p1.y},{lon:p2.x,lat:p2.y});return length*1e3},CLASS_NAME:"OpenLayers.Geometry.Curve"});OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{removeComponent:function(){var removed=this.components&&this.components.length>2;return removed&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),removed},intersects:function(geometry){var intersect=!1,type=geometry.CLASS_NAME,segs1,segs2,seg1,seg1x1,seg1x2,seg1y1,seg1y2,seg2,seg2y1,seg2y2,i,len,j,jlen;if(type=="OpenLayers.Geometry.LineString"||type=="OpenLayers.Geometry.LinearRing"||type=="OpenLayers.Geometry.Point"){segs1=this.getSortedSegments();segs2=type=="OpenLayers.Geometry.Point"?[{x1:geometry.x,y1:geometry.y,x2:geometry.x,y2:geometry.y}]:geometry.getSortedSegments();outer:for(i=0,len=segs1.length;i<len;++i)for(seg1=segs1[i],seg1x1=seg1.x1,seg1x2=seg1.x2,seg1y1=seg1.y1,seg1y2=seg1.y2,j=0,jlen=segs2.length;j<jlen;++j){if(seg2=segs2[j],seg2.x1>seg1x2)break;if(!(seg2.x2<seg1x1)&&(seg2y1=seg2.y1,seg2y2=seg2.y2,!(Math.min(seg2y1,seg2y2)>Math.max(seg1y1,seg1y2)))&&!(Math.max(seg2y1,seg2y2)<Math.min(seg1y1,seg1y2))&&OpenLayers.Geometry.segmentsIntersect(seg1,seg2)){intersect=!0;break outer}}}else intersect=geometry.intersects(this);return intersect},getSortedSegments:function(){function byX1(seg1,seg2){return seg1.x1-seg2.x1}for(var numSeg=this.components.length-1,segments=new Array(numSeg),point1,point2,i=0;i<numSeg;++i)point1=this.components[i],point2=this.components[i+1],segments[i]=point1.x<point2.x?{x1:point1.x,y1:point1.y,x2:point2.x,y2:point2.y}:{x1:point2.x,y1:point2.y,x2:point1.x,y2:point1.y};return segments.sort(byX1)},splitWithSegment:function(seg,options){for(var xDir,yDir,edge=!(options&&options.edge===!1),tolerance=options&&options.tolerance,lines=[],verts=this.getVertices(),points=[],intersections=[],split=!1,vert1,vert2,point,vertex,target,interOptions={point:!0,tolerance:tolerance},result=null,i=0,stop=verts.length-2;i<=stop;++i)if(vert1=verts[i],points.push(vert1.clone()),vert2=verts[i+1],target={x1:vert1.x,y1:vert1.y,x2:vert2.x,y2:vert2.y},point=OpenLayers.Geometry.segmentsIntersect(seg,target,interOptions),point instanceof OpenLayers.Geometry.Point&&(vertex=point.x===seg.x1&&point.y===seg.y1||point.x===seg.x2&&point.y===seg.y2||point.equals(vert1)||point.equals(vert2)?!0:!1,vertex||edge)){if(point.equals(intersections[intersections.length-1])||intersections.push(point.clone()),i===0&&point.equals(vert1))continue;if(point.equals(vert2))continue;split=!0;point.equals(vert1)||points.push(point);lines.push(new OpenLayers.Geometry.LineString(points));points=[point.clone()]}return split&&(points.push(vert2.clone()),lines.push(new OpenLayers.Geometry.LineString(points))),intersections.length>0&&(xDir=seg.x1<seg.x2?1:-1,yDir=seg.y1<seg.y2?1:-1,result={lines:lines,points:intersections.sort(function(p1,p2){return xDir*p1.x-xDir*p2.x||yDir*p1.y-yDir*p2.y})}),result},split:function(target,options){var results=null,mutual=options&&options.mutual,sourceSplit,targetSplit,sourceParts,targetParts,verts,vert1,vert2,seg,splits,lines,point,points,i,stop,j,k,len;if(target instanceof OpenLayers.Geometry.LineString){for(verts=this.getVertices(),points=[],sourceParts=[],i=0,stop=verts.length-2;i<=stop;++i)for(vert1=verts[i],vert2=verts[i+1],seg={x1:vert1.x,y1:vert1.y,x2:vert2.x,y2:vert2.y},targetParts=targetParts||[target],mutual&&points.push(vert1.clone()),j=0;j<targetParts.length;++j)if(splits=targetParts[j].splitWithSegment(seg,options),splits&&(lines=splits.lines,lines.length>0&&(lines.unshift(j,1),Array.prototype.splice.apply(targetParts,lines),j+=lines.length-2),mutual))for(k=0,len=splits.points.length;k<len;++k)point=splits.points[k],point.equals(vert1)||(points.push(point),sourceParts.push(new OpenLayers.Geometry.LineString(points)),points=point.equals(vert2)?[]:[point.clone()]);mutual&&sourceParts.length>0&&points.length>0&&(points.push(vert2.clone()),sourceParts.push(new OpenLayers.Geometry.LineString(points)))}else results=target.splitWith(this,options);return targetParts&&targetParts.length>1?targetSplit=!0:targetParts=[],sourceParts&&sourceParts.length>1?sourceSplit=!0:sourceParts=[],(targetSplit||sourceSplit)&&(results=mutual?[sourceParts,targetParts]:targetParts),results},splitWith:function(geometry,options){return geometry.split(this,options)},getVertices:function(nodes){return nodes===!0?[this.components[0],this.components[this.components.length-1]]:nodes===!1?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(geometry,options){var edge=!(options&&options.edge===!1),details=edge&&options&&options.details,result,best={},min=Number.POSITIVE_INFINITY,i,len,j,dist;if(geometry instanceof OpenLayers.Geometry.Point){var segs=this.getSortedSegments(),x=geometry.x,y=geometry.y,seg;for(i=0,len=segs.length;i<len;++i)if(seg=segs[i],result=OpenLayers.Geometry.distanceToSegment(geometry,seg),result.distance<min){if(min=result.distance,best=result,min===0)break}else if(seg.x2>x&&(y>seg.y1&&y<seg.y2||y<seg.y1&&y>seg.y2))break;best=details?{distance:best.distance,x0:best.x,y0:best.y,x1:x,y1:y}:best.distance}else if(geometry instanceof OpenLayers.Geometry.LineString){var segs0=this.getSortedSegments(),segs1=geometry.getSortedSegments(),seg0,seg1,intersection,x0,y0,len1=segs1.length,interOptions={point:!0};outer:for(i=0,len=segs0.length;i<len;++i)for(seg0=segs0[i],x0=seg0.x1,y0=seg0.y1,j=0;j<len1;++j)if(seg1=segs1[j],intersection=OpenLayers.Geometry.segmentsIntersect(seg0,seg1,interOptions),intersection){min=0;best={distance:0,x0:intersection.x,y0:intersection.y,x1:intersection.x,y1:intersection.y};break outer}else result=OpenLayers.Geometry.distanceToSegment({x:x0,y:y0},seg1),result.distance<min&&(min=result.distance,best={distance:min,x0:x0,y0:y0,x1:result.x,y1:result.y});details||(best=best.distance);min!==0&&seg0&&(result=geometry.distanceTo(new OpenLayers.Geometry.Point(seg0.x2,seg0.y2),options),dist=details?result.distance:result,dist<min&&(best=details?{distance:min,x0:result.x1,y0:result.y1,x1:result.x0,y1:result.y0}:dist))}else best=geometry.distanceTo(this,options),details&&(best={distance:best.distance,x0:best.x1,y0:best.y1,x1:best.x0,y1:best.y0});return best},simplify:function(tolerance){var points,returnPoints,index;if(this&&this!==null){if(points=this.getVertices(),points.length<3)return this;var compareNumbers=function(a,b){return a-b},douglasPeuckerReduction=function(points,firstPoint,lastPoint,tolerance){for(var maxDistance=0,indexFarthest=0,index=firstPoint,distance;index<lastPoint;index++)distance=perpendicularDistance(points[firstPoint],points[lastPoint],points[index]),distance>maxDistance&&(maxDistance=distance,indexFarthest=index);maxDistance>tolerance&&indexFarthest!=firstPoint&&(pointIndexsToKeep.push(indexFarthest),douglasPeuckerReduction(points,firstPoint,indexFarthest,tolerance),douglasPeuckerReduction(points,indexFarthest,lastPoint,tolerance))},perpendicularDistance=function(point1,point2,point){var area=Math.abs(.5*(point1.x*point2.y+point2.x*point.y+point.x*point1.y-point2.x*point1.y-point.x*point2.y-point1.x*point.y)),bottom=Math.sqrt(Math.pow(point1.x-point2.x,2)+Math.pow(point1.y-point2.y,2));return area/bottom*2},firstPoint=0,lastPoint=points.length-1,pointIndexsToKeep=[];for(pointIndexsToKeep.push(firstPoint),pointIndexsToKeep.push(lastPoint);points[firstPoint].equals(points[lastPoint]);)lastPoint--,pointIndexsToKeep.push(lastPoint);for(douglasPeuckerReduction(points,firstPoint,lastPoint,tolerance),returnPoints=[],pointIndexsToKeep.sort(compareNumbers),index=0;index<pointIndexsToKeep.length;index++)returnPoints.push(points[pointIndexsToKeep[index]]);return new OpenLayers.Geometry.LineString(returnPoints)}return this},CLASS_NAME:"OpenLayers.Geometry.LineString"});OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(point,index){var added=!1,lastPoint=this.components.pop(),firstPoint;return index==null&&point.equals(lastPoint)||(added=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments)),firstPoint=this.components[0],OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[firstPoint]),added},removeComponent:function(){var removed=this.components&&this.components.length>3,firstPoint;return removed&&(this.components.pop(),OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),firstPoint=this.components[0],OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[firstPoint])),removed},move:function(x,y){for(var i=0,len=this.components.length;i<len-1;i++)this.components[i].move(x,y)},rotate:function(angle,origin){for(var i=0,len=this.components.length;i<len-1;++i)this.components[i].rotate(angle,origin)},resize:function(scale,origin,ratio){for(var i=0,len=this.components.length;i<len-1;++i)this.components[i].resize(scale,origin,ratio);return this},transform:function(source,dest){var i,len,component;if(source&&dest){for(i=0,len=this.components.length;i<len-1;i++)component=this.components[i],component.transform(source,dest);this.bounds=null}return this},getCentroid:function(){var len,b,c,i,x,y;if(this.components){if(len=this.components.length,len>0&&len<=2)return this.components[0].clone();if(len>2){var sumX=0,sumY=0,x0=this.components[0].x,y0=this.components[0].y,area=-1*this.getArea();if(area!=0){for(i=0;i<len-1;i++)b=this.components[i],c=this.components[i+1],sumX+=(b.x+c.x-2*x0)*((b.x-x0)*(c.y-y0)-(c.x-x0)*(b.y-y0)),sumY+=(b.y+c.y-2*y0)*((b.x-x0)*(c.y-y0)-(c.x-x0)*(b.y-y0));x=x0+sumX/(6*area);y=y0+sumY/(6*area)}else{for(i=0;i<len-1;i++)sumX+=this.components[i].x,sumY+=this.components[i].y;x=sumX/(len-1);y=sumY/(len-1)}return new OpenLayers.Geometry.Point(x,y)}return null}},getArea:function(){var area=0,sum,i,len,b,c;if(this.components&&this.components.length>2){for(sum=0,i=0,len=this.components.length;i<len-1;i++)b=this.components[i],c=this.components[i+1],sum+=(b.x+c.x)*(c.y-b.y);area=-sum/2}return area},getGeodesicArea:function(projection){var ring=this,gg,area,len,p1,p2,i;if(projection&&(gg=new OpenLayers.Projection("EPSG:4326"),gg.equals(projection)||(ring=this.clone().transform(projection,gg))),area=0,len=ring.components&&ring.components.length,len>2){for(i=0;i<len-1;i++)p1=ring.components[i],p2=ring.components[i+1],area+=OpenLayers.Util.rad(p2.x-p1.x)*(2+Math.sin(OpenLayers.Util.rad(p1.y))+Math.sin(OpenLayers.Util.rad(p2.y)));area=area*40680631590769/2}return area},containsPoint:function(point){function getX(y,x1,y1,x2,y2){return(y-y2)*((x2-x1)/(y2-y1))+x2}for(var approx=OpenLayers.Number.limitSigDigs,digs=14,px=approx(point.x,digs),py=approx(point.y,digs),numSeg=this.components.length-1,start,end,x1,y1,x2,y2,cx,crosses=0,i=0;i<numSeg;++i){if(start=this.components[i],x1=approx(start.x,digs),y1=approx(start.y,digs),end=this.components[i+1],x2=approx(end.x,digs),y2=approx(end.y,digs),y1==y2){if(py==y1&&(x1<=x2&&px>=x1&&px<=x2||x1>=x2&&px<=x1&&px>=x2)){crosses=-1;break}continue}if(cx=approx(getX(py,x1,y1,x2,y2),digs),cx==px&&(y1<y2&&py>=y1&&py<=y2||y1>y2&&py<=y1&&py>=y2)){crosses=-1;break}cx<=px||x1!=x2&&(cx<Math.min(x1,x2)||cx>Math.max(x1,x2))||(y1<y2&&py>=y1&&py<y2||y1>y2&&py<y1&&py>=y2)&&++crosses}return crosses==-1?1:!!(crosses&1)},intersects:function(geometry){var intersect=!1,i,len;if(geometry.CLASS_NAME=="OpenLayers.Geometry.Point")intersect=this.containsPoint(geometry);else if(geometry.CLASS_NAME=="OpenLayers.Geometry.LineString")intersect=geometry.intersects(this);else if(geometry.CLASS_NAME=="OpenLayers.Geometry.LinearRing")intersect=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[geometry]);else for(i=0,len=geometry.components.length;i<len;++i)if(intersect=geometry.components[i].intersects(this),intersect)break;return intersect},getVertices:function(nodes){return nodes===!0?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"});OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],getArea:function(){var area=0,i,len;if(this.components&&this.components.length>0)for(area+=Math.abs(this.components[0].getArea()),i=1,len=this.components.length;i<len;i++)area-=Math.abs(this.components[i].getArea());return area},getGeodesicArea:function(projection){var area=0,i,len;if(this.components&&this.components.length>0)for(area+=Math.abs(this.components[0].getGeodesicArea(projection)),i=1,len=this.components.length;i<len;i++)area-=Math.abs(this.components[i].getGeodesicArea(projection));return area},containsPoint:function(point){var numRings=this.components.length,contained=!1,hole,i;if(numRings>0&&(contained=this.components[0].containsPoint(point),contained!==1&&contained&&numRings>1))for(i=1;i<numRings;++i)if(hole=this.components[i].containsPoint(point),hole){contained=hole===1?1:!1;break}return contained},intersects:function(geometry){var intersect=!1,i,len,ring;if(geometry.CLASS_NAME=="OpenLayers.Geometry.Point")intersect=this.containsPoint(geometry);else if(geometry.CLASS_NAME=="OpenLayers.Geometry.LineString"||geometry.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){for(i=0,len=this.components.length;i<len;++i)if(intersect=geometry.intersects(this.components[i]),intersect)break;if(!intersect)for(i=0,len=geometry.components.length;i<len;++i)if(intersect=this.containsPoint(geometry.components[i]),intersect)break}else for(i=0,len=geometry.components.length;i<len;++i)if(intersect=this.intersects(geometry.components[i]),intersect)break;if(!intersect&&geometry.CLASS_NAME=="OpenLayers.Geometry.Polygon")for(ring=this.components[0],i=0,len=ring.components.length;i<len;++i)if(intersect=geometry.containsPoint(ring.components[i]),intersect)break;return intersect},distanceTo:function(geometry,options){var edge=!(options&&options.edge===!1);return!edge&&this.intersects(geometry)?0:OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[geometry,options])},CLASS_NAME:"OpenLayers.Geometry.Polygon"});OpenLayers.Geometry.Polygon.createRegularPolygon=function(origin,radius,sides,rotation){var angle=Math.PI*(1/sides-1/2),rotatedAngle,x,y,points,i,ring;for(rotation&&(angle+=rotation/180*Math.PI),points=[],i=0;i<sides;++i)rotatedAngle=angle+i*2*Math.PI/sides,x=origin.x+radius*Math.cos(rotatedAngle),y=origin.y+radius*Math.sin(rotatedAngle),points.push(new OpenLayers.Geometry.Point(x,y));return ring=new OpenLayers.Geometry.LinearRing(points),new OpenLayers.Geometry.Polygon([ring])};OpenLayers.Event={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(event){return event.target||event.srcElement},isSingleTouch:function(event){return event.touches&&event.touches.length==1},isMultiTouch:function(event){return event.touches&&event.touches.length>1},isLeftClick:function(event){return event.which&&event.which==1||event.button&&event.button==1},isRightClick:function(event){return event.which&&event.which==3||event.button&&event.button==2},stop:function(event,allowDefault){allowDefault||OpenLayers.Event.preventDefault(event);event.stopPropagation?event.stopPropagation():event.cancelBubble=!0},preventDefault:function(event){event.preventDefault?event.preventDefault():event.returnValue=!1},findElement:function(event,tagName){for(var element=OpenLayers.Event.element(event);element.parentNode&&(!element.tagName||element.tagName.toUpperCase()!=tagName.toUpperCase());)element=element.parentNode;return element},observe:function(elementParam,name,observer,useCapture){var element=OpenLayers.Util.getElement(elementParam),idPrefix,cacheID;useCapture=useCapture||!1;name=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||element.attachEvent)&&(name="keydown");this.observers||(this.observers={});element._eventCacheID||(idPrefix="eventCacheID_",element.id&&(idPrefix=element.id+"_"+idPrefix),element._eventCacheID=OpenLayers.Util.createUniqueID(idPrefix));cacheID=element._eventCacheID;this.observers[cacheID]||(this.observers[cacheID]=[]);this.observers[cacheID].push({element:element,name:name,observer:observer,useCapture:useCapture});element.addEventListener?element.addEventListener(name,observer,useCapture):element.attachEvent&&element.attachEvent("on"+name,observer)},stopObservingElement:function(elementParam){var element=OpenLayers.Util.getElement(elementParam),cacheID=element._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[cacheID])},_removeElementObservers:function(elementObservers){var i,entry;if(elementObservers)for(i=elementObservers.length-1;i>=0;i--)entry=elementObservers[i],OpenLayers.Event.stopObserving.apply(this,[entry.element,entry.name,entry.observer,entry.useCapture])},stopObserving:function(elementParam,name,observer,useCapture){var element,cacheID,foundEntry,elementObservers,i,cacheEntry;if(useCapture=useCapture||!1,element=OpenLayers.Util.getElement(elementParam),cacheID=element._eventCacheID,name=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||element.detachEvent)&&(name="keydown"),foundEntry=!1,elementObservers=OpenLayers.Event.observers[cacheID],elementObservers)for(i=0;!foundEntry&&i<elementObservers.length;){if(cacheEntry=elementObservers[i],cacheEntry.name==name&&cacheEntry.observer==observer&&cacheEntry.useCapture==useCapture){elementObservers.splice(i,1);elementObservers.length==0&&delete OpenLayers.Event.observers[cacheID];foundEntry=!0;break}i++}return foundEntry&&(element.removeEventListener?element.removeEventListener(name,observer,useCapture):element&&element.detachEvent&&element.detachEvent("on"+name,observer)),foundEntry},unloadCache:function(){var cacheID,elementObservers;if(OpenLayers.Event&&OpenLayers.Event.observers){for(cacheID in OpenLayers.Event.observers)elementObservers=OpenLayers.Event.observers[cacheID],OpenLayers.Event._removeElementObservers.apply(this,[elementObservers]);OpenLayers.Event.observers=!1}},CLASS_NAME:"OpenLayers.Event"};OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,!1);OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend","keydown"],listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(object,element,eventTypes,fallThrough,options){OpenLayers.Util.extend(this,options);this.object=object;this.fallThrough=fallThrough;this.listeners={};this.extensions={};this.extensionCount={};element!=null&&this.attachToElement(element)},destroy:function(){for(var e in this.extensions)typeof this.extensions[e]!="boolean"&&this.extensions[e].destroy();this.extensions=null;this.element&&(OpenLayers.Event.stopObservingElement(this.element),this.element.hasScrollEvent&&OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener));this.element=null;this.listeners=null;this.object=null;this.fallThrough=null;this.eventHandler=null},addEventType:function(){},attachToElement:function(element){this.element?OpenLayers.Event.stopObservingElement(this.element):(this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this));this.element=element;for(var i=0,len=this.BROWSER_EVENTS.length;i<len;i++)OpenLayers.Event.observe(element,this.BROWSER_EVENTS[i],this.eventHandler);OpenLayers.Event.observe(element,"dragstart",OpenLayers.Event.stop)},on:function(object){for(var type in object)type!="scope"&&object.hasOwnProperty(type)&&this.register(type,object.scope,object[type])},register:function(type,obj,func,priority){var listeners,listener;type in OpenLayers.Events&&!this.extensions[type]&&(this.extensions[type]=new OpenLayers.Events[type](this));func!=null&&(obj==null&&(obj=this.object),listeners=this.listeners[type],listeners||(listeners=[],this.listeners[type]=listeners,this.extensionCount[type]=0),listener={obj:obj,func:func},priority?(listeners.splice(this.extensionCount[type],0,listener),typeof priority=="object"&&priority.extension&&this.extensionCount[type]++):listeners.push(listener))},registerPriority:function(type,obj,func){this.register(type,obj,func,!0)},un:function(object){for(var type in object)type!="scope"&&object.hasOwnProperty(type)&&this.unregister(type,object.scope,object[type])},unregister:function(type,obj,func){var listeners,i,len;if(obj==null&&(obj=this.object),listeners=this.listeners[type],listeners!=null)for(i=0,len=listeners.length;i<len;i++)if(listeners[i].obj==obj&&listeners[i].func==func){listeners.splice(i,1);break}},remove:function(type){this.listeners[type]!=null&&(this.listeners[type]=[])},triggerEvent:function(type,evt){var listeners=this.listeners[type],continueChain,i,len,callback;if(!listeners||listeners.length==0)return undefined;for(evt==null&&(evt={}),evt.object=this.object,evt.element=this.element,evt.type||(evt.type=type),listeners=listeners.slice(),i=0,len=listeners.length;i<len;i++)if(callback=listeners[i],continueChain=callback.func.apply(callback.obj,[evt]),continueChain!=undefined&&continueChain==!1)break;return this.fallThrough||OpenLayers.Event.stop(evt,!0),continueChain},handleBrowserEvent:function(evt){var type=evt.type,listeners=this.listeners[type],touches,i;if(listeners&&listeners.length!=0){if(touches=evt.touches,touches&&touches[0]){var x=0,y=0,num=touches.length,touch;for(i=0;i<num;++i)touch=touches[i],x+=touch.clientX,y+=touch.clientY;evt.clientX=x/num;evt.clientY=y/num}this.includeXY&&(evt.xy=this.getMousePosition(evt));this.triggerEvent(type,evt)}},clearMouseCache:function(){this.element.scrolls=null;this.element.lefttop=null;var body=document.body;!body||(body.scrollTop!=0||body.scrollLeft!=0)&&navigator.userAgent.match(/iPhone/i)||(this.element.offsets=null)},getMousePosition:function(evt){if(this.includeXY?this.element.hasScrollEvent||(OpenLayers.Event.observe(window,"scroll",this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache(),!this.element.scrolls){var viewportElement=OpenLayers.Util.getViewportElement();this.element.scrolls=[viewportElement.scrollLeft,viewportElement.scrollTop]}return this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]),this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element)),new OpenLayers.Pixel(evt.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],evt.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},CLASS_NAME:"OpenLayers.Events"});OpenLayers.ProxyHost="";OpenLayers.Request||(OpenLayers.Request={});OpenLayers.Util.extend(OpenLayers.Request,{DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:!0,user:undefined,password:undefined,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this),makeSameOrigin:function(url,proxy){var sameOrigin=url.indexOf("http")!==0,urlParts=!sameOrigin&&url.match(this.URL_SPLIT_REGEX),location,uPort,lPort;return urlParts&&(location=window.location,sameOrigin=urlParts[1]==location.protocol&&urlParts[3]==location.hostname,uPort=urlParts[4],lPort=location.port,(uPort!=80&&uPort!=""||lPort!="80"&&lPort!="")&&(sameOrigin=sameOrigin&&uPort==lPort)),sameOrigin||(proxy?url=typeof proxy=="function"?proxy(url):proxy+encodeURIComponent(url):OpenLayers.Console.warn(OpenLayers.i18n("proxyNeeded"),{url:url})),url},issue:function(config){var defaultConfig=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost}),customRequestedWithHeader,headerKey,request,url,header,events,self;config=OpenLayers.Util.applyDefaults(config,defaultConfig);customRequestedWithHeader=!1;for(headerKey in config.headers)config.headers.hasOwnProperty(headerKey)&&headerKey.toLowerCase()==="x-requested-with"&&(customRequestedWithHeader=!0);customRequestedWithHeader===!1&&(config.headers["X-Requested-With"]="XMLHttpRequest");request=new OpenLayers.Request.XMLHttpRequest;url=OpenLayers.Util.urlAppend(config.url,OpenLayers.Util.getParameterString(config.params||{}));url=OpenLayers.Request.makeSameOrigin(url,config.proxy);request.open(config.method,url,config.async,config.user,config.password);for(header in config.headers)request.setRequestHeader(header,config.headers[header]);return events=this.events,self=this,request.onreadystatechange=function(){if(request.readyState==OpenLayers.Request.XMLHttpRequest.DONE){var proceed=events.triggerEvent("complete",{request:request,config:config,requestUrl:url});proceed!==!1&&self.runCallbacks({request:request,config:config,requestUrl:url})}},config.async===!1?request.send(config.data):window.setTimeout(function(){request.readyState!==0&&request.send(config.data)},0),request},runCallbacks:function(options){var request=options.request,config=options.config,complete=config.scope?OpenLayers.Function.bind(config.callback,config.scope):config.callback,success,failure;config.success&&(success=config.scope?OpenLayers.Function.bind(config.success,config.scope):config.success);config.failure&&(failure=config.scope?OpenLayers.Function.bind(config.failure,config.scope):config.failure);OpenLayers.Util.createUrlObject(config.url).protocol=="file:"&&request.responseText&&(request.status=200);complete(request);(!request.status||request.status>=200&&request.status<300)&&(this.events.triggerEvent("success",options),success&&success(request));request.status&&(request.status<200||request.status>=300)&&(this.events.triggerEvent("failure",options),failure&&failure(request))},GET:function(config){return config=OpenLayers.Util.extend(config,{method:"GET"}),OpenLayers.Request.issue(config)},POST:function(config){return config=OpenLayers.Util.extend(config,{method:"POST"}),config.headers=config.headers?config.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(config.headers)||(config.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(config)},PUT:function(config){return config=OpenLayers.Util.extend(config,{method:"PUT"}),config.headers=config.headers?config.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(config.headers)||(config.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(config)},DELETE:function(config){return config=OpenLayers.Util.extend(config,{method:"DELETE"}),OpenLayers.Request.issue(config)},HEAD:function(config){return config=OpenLayers.Util.extend(config,{method:"HEAD"}),OpenLayers.Request.issue(config)},OPTIONS:function(config){return config=OpenLayers.Util.extend(config,{method:"OPTIONS"}),OpenLayers.Request.issue(config)}}),function(){function fXMLHttpRequest(){this._object=oXMLHttpRequest&&!bIE7?new oXMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");this._listeners=[]}function cXMLHttpRequest(){return new fXMLHttpRequest}function fXMLHttpRequest_send(oRequest){if(oRequest._object.send(oRequest._data),bGecko&&!oRequest._async)for(oRequest.readyState=cXMLHttpRequest.OPENED,fSynchronizeValues(oRequest);oRequest.readyState<cXMLHttpRequest.DONE;)if(oRequest.readyState++,fReadyStateChange(oRequest),oRequest._aborted)return}function fReadyStateChange(oRequest){cXMLHttpRequest.onreadystatechange&&cXMLHttpRequest.onreadystatechange.apply(oRequest);oRequest.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function fGetDocument(oRequest){var oDocument=oRequest.responseXML,sResponse=oRequest.responseText;return(bIE&&sResponse&&oDocument&&!oDocument.documentElement&&oRequest.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)&&(oDocument=new window.ActiveXObject("Microsoft.XMLDOM"),oDocument.async=!1,oDocument.validateOnParse=!1,oDocument.loadXML(sResponse)),oDocument&&(bIE&&oDocument.parseError!=0||!oDocument.documentElement||oDocument.documentElement&&oDocument.documentElement.tagName=="parsererror"))?null:oDocument}function fSynchronizeValues(oRequest){try{oRequest.responseText=oRequest._object.responseText}catch(e){}try{oRequest.responseXML=fGetDocument(oRequest._object)}catch(e){}try{oRequest.status=oRequest._object.status}catch(e){}try{oRequest.statusText=oRequest._object.statusText}catch(e){}}function fCleanTransport(oRequest){oRequest._object.onreadystatechange=new window.Function}var oXMLHttpRequest=window.XMLHttpRequest,bGecko=!!window.controllers,bIE=window.document.all&&!window.opera,bIE7=bIE&&window.navigator.userAgent.match(/MSIE 7.0/);cXMLHttpRequest.prototype=fXMLHttpRequest.prototype;bGecko&&oXMLHttpRequest.wrapped&&(cXMLHttpRequest.wrapped=oXMLHttpRequest.wrapped);cXMLHttpRequest.UNSENT=0;cXMLHttpRequest.OPENED=1;cXMLHttpRequest.HEADERS_RECEIVED=2;cXMLHttpRequest.LOADING=3;cXMLHttpRequest.DONE=4;cXMLHttpRequest.prototype.readyState=cXMLHttpRequest.UNSENT;cXMLHttpRequest.prototype.responseText="";cXMLHttpRequest.prototype.responseXML=null;cXMLHttpRequest.prototype.status=0;cXMLHttpRequest.prototype.statusText="";cXMLHttpRequest.prototype.priority="NORMAL";cXMLHttpRequest.prototype.onreadystatechange=null;cXMLHttpRequest.onreadystatechange=null;cXMLHttpRequest.onopen=null;cXMLHttpRequest.onsend=null;cXMLHttpRequest.onabort=null;cXMLHttpRequest.prototype.open=function(sMethod,sUrl,bAsync,sUser,sPassword){delete this._headers;arguments.length<3&&(bAsync=!0);this._async=bAsync;var oRequest=this,nState=this.readyState,fOnUnload;bIE&&bAsync&&(fOnUnload=function(){nState!=cXMLHttpRequest.DONE&&(fCleanTransport(oRequest),oRequest.abort())},window.attachEvent("onunload",fOnUnload));cXMLHttpRequest.onopen&&cXMLHttpRequest.onopen.apply(this,arguments);arguments.length>4?this._object.open(sMethod,sUrl,bAsync,sUser,sPassword):arguments.length>3?this._object.open(sMethod,sUrl,bAsync,sUser):this._object.open(sMethod,sUrl,bAsync);this.readyState=cXMLHttpRequest.OPENED;fReadyStateChange(this);this._object.onreadystatechange=function(){if(!bGecko||bAsync){if(oRequest.readyState=oRequest._object.readyState,fSynchronizeValues(oRequest),oRequest._aborted){oRequest.readyState=cXMLHttpRequest.UNSENT;return}oRequest.readyState==cXMLHttpRequest.DONE&&(delete oRequest._data,fCleanTransport(oRequest),bIE&&bAsync&&window.detachEvent("onunload",fOnUnload));nState!=oRequest.readyState&&fReadyStateChange(oRequest);nState=oRequest.readyState}}};cXMLHttpRequest.prototype.send=function(vData){cXMLHttpRequest.onsend&&cXMLHttpRequest.onsend.apply(this,arguments);arguments.length||(vData=null);vData&&vData.nodeType&&(vData=window.XMLSerializer?(new window.XMLSerializer).serializeToString(vData):vData.xml,this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml"));this._data=vData;fXMLHttpRequest_send(this)};cXMLHttpRequest.prototype.abort=function(){cXMLHttpRequest.onabort&&cXMLHttpRequest.onabort.apply(this,arguments);this.readyState>cXMLHttpRequest.UNSENT&&(this._aborted=!0);this._object.abort();fCleanTransport(this);this.readyState=cXMLHttpRequest.UNSENT;delete this._data};cXMLHttpRequest.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()};cXMLHttpRequest.prototype.getResponseHeader=function(sName){return this._object.getResponseHeader(sName)};cXMLHttpRequest.prototype.setRequestHeader=function(sName,sValue){return this._headers||(this._headers={}),this._headers[sName]=sValue,this._object.setRequestHeader(sName,sValue)};cXMLHttpRequest.prototype.addEventListener=function(sName,fHandler,bUseCapture){for(var nIndex=0,oListener;oListener=this._listeners[nIndex];nIndex++)if(oListener[0]==sName&&oListener[1]==fHandler&&oListener[2]==bUseCapture)return;this._listeners.push([sName,fHandler,bUseCapture])};cXMLHttpRequest.prototype.removeEventListener=function(sName,fHandler,bUseCapture){for(var nIndex=0,oListener;oListener=this._listeners[nIndex];nIndex++)if(oListener[0]==sName&&oListener[1]==fHandler&&oListener[2]==bUseCapture)break;oListener&&this._listeners.splice(nIndex,1)};cXMLHttpRequest.prototype.dispatchEvent=function(oEvent){var oEventPseudo={type:oEvent.type,target:this,currentTarget:this,eventPhase:2,bubbles:oEvent.bubbles,cancelable:oEvent.cancelable,timeStamp:oEvent.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}},nIndex,oListener;for(oEventPseudo.type=="readystatechange"&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[oEventPseudo]),nIndex=0;oListener=this._listeners[nIndex];nIndex++)oListener[0]!=oEventPseudo.type||oListener[2]||(oListener[1].handleEvent||oListener[1]).apply(this,[oEventPseudo])};cXMLHttpRequest.prototype.toString=function(){return"[object XMLHttpRequest]"};cXMLHttpRequest.toString=function(){return"[XMLHttpRequest]"};window.Function.prototype.apply||(window.Function.prototype.apply=function(oRequest,oArguments){oArguments||(oArguments=[]);oRequest.__func=this;oRequest.__func(oArguments[0],oArguments[1],oArguments[2],oArguments[3],oArguments[4]);delete oRequest.__func});OpenLayers.Request||(OpenLayers.Request={});OpenLayers.Request.XMLHttpRequest=cXMLHttpRequest}();OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(projCode,options){OpenLayers.Util.extend(this,options);this.projCode=projCode;typeof Proj4js=="object"&&(this.proj=new Proj4js.Proj(projCode))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(projection){var p=projection,equals=!1,source,target;return p&&(p instanceof OpenLayers.Projection||(p=new OpenLayers.Projection(p)),typeof Proj4js=="object"&&this.proj.defData&&p.proj.defData?equals=this.proj.defData.replace(this.titleRegEx,"")==p.proj.defData.replace(this.titleRegEx,""):p.getCode&&(source=this.getCode(),target=p.getCode(),equals=source==target||!!OpenLayers.Projection.transforms[source]&&OpenLayers.Projection.transforms[source][target]===OpenLayers.Projection.nullTransform)),equals},destroy:function(){delete this.proj;delete this.projCode},CLASS_NAME:"OpenLayers.Projection"});OpenLayers.Projection.transforms={};OpenLayers.Projection.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],yx:!0},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34]}};OpenLayers.Projection.addTransform=function(from,to,method){if(method===OpenLayers.Projection.nullTransform){var defaults=OpenLayers.Projection.defaults[from];defaults&&!OpenLayers.Projection.defaults[to]&&(OpenLayers.Projection.defaults[to]=defaults)}OpenLayers.Projection.transforms[from]||(OpenLayers.Projection.transforms[from]={});OpenLayers.Projection.transforms[from][to]=method};OpenLayers.Projection.transform=function(point,source,dest){if(source&&dest)if(source instanceof OpenLayers.Projection||(source=new OpenLayers.Projection(source)),dest instanceof OpenLayers.Projection||(dest=new OpenLayers.Projection(dest)),source.proj&&dest.proj)point=Proj4js.transform(source.proj,dest.proj,point);else{var sourceCode=source.getCode(),destCode=dest.getCode(),transforms=OpenLayers.Projection.transforms;transforms[sourceCode]&&transforms[sourceCode][destCode]&&transforms[sourceCode][destCode](point)}return point};OpenLayers.Projection.nullTransform=function(point){return point},function(){function inverseMercator(xy){return xy.x=180*xy.x/pole,xy.y=180/Math.PI*(2*Math.atan(Math.exp(xy.y/pole*Math.PI))-Math.PI/2),xy}function forwardMercator(xy){return xy.x=xy.x*pole/180,xy.y=Math.log(Math.tan((90+xy.y)*Math.PI/360))/Math.PI*pole,xy}function map(base,codes){for(var add=OpenLayers.Projection.addTransform,same=OpenLayers.Projection.nullTransform,code,other,j,i=0,len=codes.length;i<len;++i)for(code=codes[i],add(base,code,forwardMercator),add(code,base,inverseMercator),j=i+1;j<len;++j)other=codes[j],add(code,other,same),add(other,code,same)}for(var pole=20037508.34,mercator=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100"],geographic=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"],i=mercator.length-1;i>=0;--i)map(mercator[i],geographic);for(i=geographic.length-1;i>=0;--i)map(geographic[i],mercator)}();OpenLayers.Format.KML=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{kml:"http://www.opengis.net/kml/2.2",gx:"http://www.google.com/kml/ext/2.2"},kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"OpenLayers export",foldersDesc:"Exported on "+new Date,extractAttributes:!0,kvpAttributes:!1,extractStyles:!1,extractTracks:!1,trackAttributes:null,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(options){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,kmlColor:/(\w{2})(\w{2})(\w{2})(\w{2})/,kmlIconPalette:/root:\/\/icons\/palette-(\d+)(\.\w+)/,straightBracket:/\$\[(.*?)\]/g};this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,[options])},read:function(data){this.features=[];this.styles={};this.fetched={};var options={depth:0,styleBaseUrl:this.styleBaseUrl};return this.parseData(data,options)},parseData:function(data,options){var types,i,len,type,nodes;for(typeof data=="string"&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data])),types=["Link","NetworkLink","Style","StyleMap","Placemark"],i=0,len=types.length;i<len;++i)if(type=types[i],nodes=this.getElementsByTagNameNS(data,"*",type),nodes.length!=0)switch(type.toLowerCase()){case"link":case"networklink":this.parseLinks(nodes,options);break;case"style":this.extractStyles&&this.parseStyles(nodes,options);break;case"stylemap":this.extractStyles&&this.parseStyleMaps(nodes,options);break;case"placemark":this.parseFeatures(nodes,options)}return this.features},parseLinks:function(nodes,options){var newOptions,i,len,href,data;if(options.depth>=this.maxDepth)return!1;for(newOptions=OpenLayers.Util.extend({},options),newOptions.depth++,i=0,len=nodes.length;i<len;i++)href=this.parseProperty(nodes[i],"*","href"),href&&!this.fetched[href]&&(this.fetched[href]=!0,data=this.fetchLink(href),data&&this.parseData(data,newOptions))},fetchLink:function(href){var request=OpenLayers.Request.GET({url:href,async:!1});if(request)return request.responseText},parseStyles:function(nodes,options){for(var style,styleName,i=0,len=nodes.length;i<len;i++)style=this.parseStyle(nodes[i]),style&&(styleName=(options.styleBaseUrl||"")+"#"+style.id,this.styles[styleName]=style)},parseKmlColor:function(kmlColor){var color=null,matches;return kmlColor&&(matches=kmlColor.match(this.regExes.kmlColor),matches&&(color={color:"#"+matches[4]+matches[3]+matches[2],opacity:parseInt(matches[1],16)/255})),color},parseStyle:function(node){for(var width,fill,outline,href,matches,hotSpotNode,yUnits,balloonStyle,kmlColor,color,id,style={},types=["LineStyle","PolyStyle","IconStyle","BalloonStyle","LabelStyle"],type,styleTypeNode,i=0,len=types.length;i<len;++i)if(type=types[i],styleTypeNode=this.getElementsByTagNameNS(node,"*",type)[0],styleTypeNode)switch(type.toLowerCase()){case"linestyle":kmlColor=this.parseProperty(styleTypeNode,"*","color");color=this.parseKmlColor(kmlColor);color&&(style.strokeColor=color.color,style.strokeOpacity=color.opacity);width=this.parseProperty(styleTypeNode,"*","width");width&&(style.strokeWidth=width);break;case"polystyle":kmlColor=this.parseProperty(styleTypeNode,"*","color");color=this.parseKmlColor(kmlColor);color&&(style.fillOpacity=color.opacity,style.fillColor=color.color);fill=this.parseProperty(styleTypeNode,"*","fill");fill=="0"&&(style.fillColor="none");outline=this.parseProperty(styleTypeNode,"*","outline");outline=="0"&&(style.strokeWidth="0");break;case"iconstyle":var scale=parseFloat(this.parseProperty(styleTypeNode,"*","scale")||1),width=32*scale,height=32*scale,iconNode=this.getElementsByTagNameNS(styleTypeNode,"*","Icon")[0];if(iconNode&&(href=this.parseProperty(iconNode,"*","href"),href)){var w=this.parseProperty(iconNode,"*","w"),h=this.parseProperty(iconNode,"*","h");if(!OpenLayers.String.startsWith(href,"http://maps.google.com/mapfiles/kml")||w||h||(w=64,h=64,scale=scale/2),w=w||h,h=h||w,w&&(width=parseInt(w)*scale),h&&(height=parseInt(h)*scale),matches=href.match(this.regExes.kmlIconPalette),matches){var palette=matches[1],file_extension=matches[2],x=this.parseProperty(iconNode,"*","x"),y=this.parseProperty(iconNode,"*","y"),posX=x?x/32:0,posY=y?7-y/32:7,pos=posY*8+posX;href="http://maps.google.com/mapfiles/kml/pal"+palette+"/icon"+pos+file_extension}style.graphicOpacity=1;style.externalGraphic=href}if(hotSpotNode=this.getElementsByTagNameNS(styleTypeNode,"*","hotSpot")[0],hotSpotNode){var x=parseFloat(hotSpotNode.getAttribute("x")),y=parseFloat(hotSpotNode.getAttribute("y")),xUnits=hotSpotNode.getAttribute("xunits");xUnits=="pixels"?style.graphicXOffset=-x*scale:xUnits=="insetPixels"?style.graphicXOffset=-width+x*scale:xUnits=="fraction"&&(style.graphicXOffset=-width*x);yUnits=hotSpotNode.getAttribute("yunits");yUnits=="pixels"?style.graphicYOffset=-height+y*scale+1:yUnits=="insetPixels"?style.graphicYOffset=-(y*scale)+1:yUnits=="fraction"&&(style.graphicYOffset=-height*(1-y)+1)}style.graphicWidth=width;style.graphicHeight=height;break;case"balloonstyle":balloonStyle=OpenLayers.Util.getXmlNodeValue(styleTypeNode);balloonStyle&&(style.balloonStyle=balloonStyle.replace(this.regExes.straightBracket,"${$1}"));break;case"labelstyle":kmlColor=this.parseProperty(styleTypeNode,"*","color");color=this.parseKmlColor(kmlColor);color&&(style.fontColor=color.color,style.fontOpacity=color.opacity)}return!style.strokeColor&&style.fillColor&&(style.strokeColor=style.fillColor),id=node.getAttribute("id"),id&&style&&(style.id=id),style},parseStyleMaps:function(nodes,options){for(var j,jlen,i=0,len=nodes.length;i<len;i++){var node=nodes[i],pairs=this.getElementsByTagNameNS(node,"*","Pair"),id=node.getAttribute("id");for(j=0,jlen=pairs.length;j<jlen;j++){var pair=pairs[j],key=this.parseProperty(pair,"*","key"),styleUrl=this.parseProperty(pair,"*","styleUrl");styleUrl&&key=="normal"&&(this.styles[(options.styleBaseUrl||"")+"#"+id]=this.styles[(options.styleBaseUrl||"")+styleUrl])}}},parseFeatures:function(nodes,options){for(var featureNode,feature,inlineStyleNode,inlineStyle,tracks,track,container,features=[],i=0,len=nodes.length;i<len;i++)if(featureNode=nodes[i],feature=this.parseFeature.apply(this,[featureNode]),feature)this.extractStyles&&feature.attributes&&feature.attributes.styleUrl&&(feature.style=this.getStyle(feature.attributes.styleUrl,options)),this.extractStyles&&(inlineStyleNode=this.getElementsByTagNameNS(featureNode,"*","Style")[0],inlineStyleNode&&(inlineStyle=this.parseStyle(inlineStyleNode),inlineStyle&&(feature.style=OpenLayers.Util.extend(feature.style,inlineStyle)))),this.extractTracks?(tracks=this.getElementsByTagNameNS(featureNode,this.namespaces.gx,"Track"),tracks&&tracks.length>0&&(track=tracks[0],container={features:[],feature:feature},this.readNode(track,container),container.features.length>0&&features.push.apply(features,container.features))):features.push(feature);else throw"Bad Placemark: "+i;this.features=this.features.concat(features)},readers:{kml:{when:function(node,container){container.whens.push(OpenLayers.Date.parse(this.getChildValue(node)))},_trackPointAttribute:function(node,container){var name=node.nodeName.split(":").pop();container.attributes[name].push(this.getChildValue(node))}},gx:{Track:function(node,container){var obj={whens:[],points:[],angles:[]},name,hasAngles,feature,point,angles,i,ii,j,jj;if(this.trackAttributes)for(obj.attributes={},i=0,ii=this.trackAttributes.length;i<ii;++i)name=this.trackAttributes[i],obj.attributes[name]=[],name in this.readers.kml||(this.readers.kml[name]=this.readers.kml._trackPointAttribute);if(this.readChildNodes(node,obj),obj.whens.length!==obj.points.length)throw new Error("gx:Track with unequal number of when ("+obj.whens.length+") and gx:coord ("+obj.points.length+") elements.");if(hasAngles=obj.angles.length>0,hasAngles&&obj.whens.length!==obj.angles.length)throw new Error("gx:Track with unequal number of when ("+obj.whens.length+") and gx:angles ("+obj.angles.length+") elements.");for(i=0,ii=obj.whens.length;i<ii;++i){if(feature=container.feature.clone(),feature.fid=container.feature.fid||container.feature.id,point=obj.points[i],feature.geometry=point,"z"in point&&(feature.attributes.altitude=point.z),this.internalProjection&&this.externalProjection&&feature.geometry.transform(this.externalProjection,this.internalProjection),this.trackAttributes)for(j=0,jj=this.trackAttributes.length;j<jj;++j)feature.attributes[name]=obj.attributes[this.trackAttributes[j]][i];feature.attributes.when=obj.whens[i];feature.attributes.trackId=container.feature.id;hasAngles&&(angles=obj.angles[i],feature.attributes.heading=parseFloat(angles[0]),feature.attributes.tilt=parseFloat(angles[1]),feature.attributes.roll=parseFloat(angles[2]));container.features.push(feature)}},coord:function(node,container){var str=this.getChildValue(node),coords=str.replace(this.regExes.trimSpace,"").split(/\s+/),point=new OpenLayers.Geometry.Point(coords[0],coords[1]);coords.length>2&&(point.z=parseFloat(coords[2]));container.points.push(point)},angles:function(node,container){var str=this.getChildValue(node),parts=str.replace(this.regExes.trimSpace,"").split(/\s+/);container.angles.push(parts)}}},parseFeature:function(node){for(var parser,attributes,feature,fid,order=["MultiGeometry","Polygon","LineString","Point"],type,nodeList,geometry,i=0,len=order.length;i<len;++i)if(type=order[i],this.internalns=node.namespaceURI?node.namespaceURI:this.kmlns,nodeList=this.getElementsByTagNameNS(node,this.internalns,type),nodeList.length>0){if(parser=this.parseGeometry[type.toLowerCase()],parser)geometry=parser.apply(this,[nodeList[0]]),this.internalProjection&&this.externalProjection&&geometry.transform(this.externalProjection,this.internalProjection);else throw new TypeError("Unsupported geometry type: "+type);break}return this.extractAttributes&&(attributes=this.parseAttributes(node)),feature=new OpenLayers.Feature.Vector(geometry,attributes),fid=node.getAttribute("id")||node.getAttribute("name"),fid!=null&&(feature.fid=fid),feature},getStyle:function(styleUrl,options){var styleBaseUrl=OpenLayers.Util.removeTail(styleUrl),newOptions=OpenLayers.Util.extend({},options),data;return newOptions.depth++,newOptions.styleBaseUrl=styleBaseUrl,!this.styles[styleUrl]&&!OpenLayers.String.startsWith(styleUrl,"#")&&newOptions.depth<=this.maxDepth&&!this.fetched[styleBaseUrl]&&(data=this.fetchLink(styleBaseUrl),data&&this.parseData(data,newOptions)),OpenLayers.Util.extend({},this.styles[styleUrl])},parseGeometry:{point:function(node){var nodeList=this.getElementsByTagNameNS(node,this.internalns,"coordinates"),coords=[],coordString,point;if(nodeList.length>0&&(coordString=nodeList[0].firstChild.nodeValue,coordString=coordString.replace(this.regExes.removeSpace,""),coords=coordString.split(",")),point=null,coords.length>1)coords.length==2&&(coords[2]=null),point=new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2]);else throw"Bad coordinate string: "+coordString;return point},linestring:function(node,ring){var nodeList=this.getElementsByTagNameNS(node,this.internalns,"coordinates"),line=null,coordString,i;if(nodeList.length>0){coordString=this.getChildValue(nodeList[0]);coordString=coordString.replace(this.regExes.trimSpace,"");coordString=coordString.replace(this.regExes.trimComma,",");var pointList=coordString.split(this.regExes.splitSpace),numPoints=pointList.length,points=new Array(numPoints),coords,numCoords;for(i=0;i<numPoints;++i)if(coords=pointList[i].split(","),numCoords=coords.length,numCoords>1)coords.length==2&&(coords[2]=null),points[i]=new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2]);else throw"Bad LineString point coordinates: "+pointList[i];if(numPoints)line=ring?new OpenLayers.Geometry.LinearRing(points):new OpenLayers.Geometry.LineString(points);else throw"Bad LineString coordinates: "+coordString;}return line},polygon:function(node){var nodeList=this.getElementsByTagNameNS(node,this.internalns,"LinearRing"),numRings=nodeList.length,components=new Array(numRings),ring,i,len;if(numRings>0)for(i=0,len=nodeList.length;i<len;++i)if(ring=this.parseGeometry.linestring.apply(this,[nodeList[i],!0]),ring)components[i]=ring;else throw"Bad LinearRing geometry: "+i;return new OpenLayers.Geometry.Polygon(components)},multigeometry:function(node){for(var type,parser,child,parts=[],children=node.childNodes,i=0,len=children.length;i<len;++i)child=children[i],child.nodeType==1&&(type=child.prefix?child.nodeName.split(":")[1]:child.nodeName,parser=this.parseGeometry[type.toLowerCase()],parser&&parts.push(parser.apply(this,[child])));return new OpenLayers.Geometry.Collection(parts)}},parseAttributes:function(node){var attributes={},edNodes=node.getElementsByTagName("ExtendedData"),child,grandchildren,children,i,len,grandchild,c1,c2,name,value;for(edNodes.length&&(attributes=this.parseExtendedData(edNodes[0])),children=node.childNodes,i=0,len=children.length;i<len;++i)if(child=children[i],child.nodeType==1&&(grandchildren=child.childNodes,grandchildren.length>=1&&grandchildren.length<=3)){switch(grandchildren.length){case 1:grandchild=grandchildren[0];break;case 2:c1=grandchildren[0];c2=grandchildren[1];grandchild=c1.nodeType==3||c1.nodeType==4?c1:c2;break;case 3:default:grandchild=grandchildren[1]}(grandchild.nodeType==3||grandchild.nodeType==4)&&(name=child.prefix?child.nodeName.split(":")[1]:child.nodeName,value=OpenLayers.Util.getXmlNodeValue(grandchild),value&&(value=value.replace(this.regExes.trimSpace,""),attributes[name]=value))}return attributes},parseExtendedData:function(node){for(var attributes={},data,key,dataNodes=node.getElementsByTagName("Data"),valueNode,nameNode,simpleDataNodes,ed,i=0,len=dataNodes.length;i<len;i++)data=dataNodes[i],key=data.getAttribute("name"),ed={},valueNode=data.getElementsByTagName("value"),valueNode.length&&(ed.value=this.getChildValue(valueNode[0])),this.kvpAttributes?attributes[key]=ed.value:(nameNode=data.getElementsByTagName("displayName"),nameNode.length&&(ed.displayName=this.getChildValue(nameNode[0])),attributes[key]=ed);for(simpleDataNodes=node.getElementsByTagName("SimpleData"),i=0,len=simpleDataNodes.length;i<len;i++)ed={},data=simpleDataNodes[i],key=data.getAttribute("name"),ed.value=this.getChildValue(data),this.kvpAttributes?attributes[key]=ed.value:(ed.displayName=key,attributes[key]=ed);return attributes},parseProperty:function(xmlNode,namespace,tagName){var value,nodeList=this.getElementsByTagNameNS(xmlNode,namespace,tagName);try{value=OpenLayers.Util.getXmlNodeValue(nodeList[0])}catch(e){value=null}return value},write:function(features){var kml,folder,i,len;for(OpenLayers.Util.isArray(features)||(features=[features]),kml=this.createElementNS(this.kmlns,"kml"),folder=this.createFolderXML(),i=0,len=features.length;i<len;++i)folder.appendChild(this.createPlacemarkXML(features[i]));return kml.appendChild(folder),OpenLayers.Format.XML.prototype.write.apply(this,[kml])},createFolderXML:function(){var folder=this.createElementNS(this.kmlns,"Folder"),folderName,folderNameText,folderDesc,folderDescText;return this.foldersName&&(folderName=this.createElementNS(this.kmlns,"name"),folderNameText=this.createTextNode(this.foldersName),folderName.appendChild(folderNameText),folder.appendChild(folderName)),this.foldersDesc&&(folderDesc=this.createElementNS(this.kmlns,"description"),folderDescText=this.createTextNode(this.foldersDesc),folderDesc.appendChild(folderDescText),folder.appendChild(folderDesc)),folder},createPlacemarkXML:function(feature){var placemarkName=this.createElementNS(this.kmlns,"name"),label=feature.style&&feature.style.label?feature.style.label:feature.id,name=feature.attributes.name||label,placemarkDesc,desc,placemarkNode,geometryNode,edNode;return placemarkName.appendChild(this.createTextNode(name)),placemarkDesc=this.createElementNS(this.kmlns,"description"),desc=feature.attributes.description||this.placemarksDesc,placemarkDesc.appendChild(this.createTextNode(desc)),placemarkNode=this.createElementNS(this.kmlns,"Placemark"),feature.fid!=null&&placemarkNode.setAttribute("id",feature.fid),placemarkNode.appendChild(placemarkName),placemarkNode.appendChild(placemarkDesc),geometryNode=this.buildGeometryNode(feature.geometry),placemarkNode.appendChild(geometryNode),feature.attributes&&(edNode=this.buildExtendedData(feature.attributes),edNode&&placemarkNode.appendChild(edNode)),placemarkNode},buildGeometryNode:function(geometry){var className=geometry.CLASS_NAME,type=className.substring(className.lastIndexOf(".")+1),builder=this.buildGeometry[type.toLowerCase()],node=null;return builder&&(node=builder.apply(this,[geometry])),node},buildGeometry:{point:function(geometry){var kml=this.createElementNS(this.kmlns,"Point");return kml.appendChild(this.buildCoordinatesNode(geometry)),kml},multipoint:function(geometry){return this.buildGeometry.collection.apply(this,[geometry])},linestring:function(geometry){var kml=this.createElementNS(this.kmlns,"LineString");return kml.appendChild(this.buildCoordinatesNode(geometry)),kml},multilinestring:function(geometry){return this.buildGeometry.collection.apply(this,[geometry])},linearring:function(geometry){var kml=this.createElementNS(this.kmlns,"LinearRing");return kml.appendChild(this.buildCoordinatesNode(geometry)),kml},polygon:function(geometry){for(var kml=this.createElementNS(this.kmlns,"Polygon"),rings=geometry.components,ringMember,ringGeom,type,i=0,len=rings.length;i<len;++i)type=i==0?"outerBoundaryIs":"innerBoundaryIs",ringMember=this.createElementNS(this.kmlns,type),ringGeom=this.buildGeometry.linearring.apply(this,[rings[i]]),ringMember.appendChild(ringGeom),kml.appendChild(ringMember);return kml},multipolygon:function(geometry){return this.buildGeometry.collection.apply(this,[geometry])},collection:function(geometry){for(var kml=this.createElementNS(this.kmlns,"MultiGeometry"),child,i=0,len=geometry.components.length;i<len;++i)child=this.buildGeometryNode.apply(this,[geometry.components[i]]),child&&kml.appendChild(child);return kml}},buildCoordinatesNode:function(geometry){var coordinatesNode=this.createElementNS(this.kmlns,"coordinates"),path,points=geometry.components,point,numPoints,parts,i,txtNode;if(points){for(numPoints=points.length,parts=new Array(numPoints),i=0;i<numPoints;++i)point=points[i],parts[i]=this.buildCoordinates(point);path=parts.join(" ")}else path=this.buildCoordinates(geometry);return txtNode=this.createTextNode(path),coordinatesNode.appendChild(txtNode),coordinatesNode},buildCoordinates:function(point){return this.internalProjection&&this.externalProjection&&(point=point.clone(),point.transform(this.internalProjection,this.externalProjection)),point.x+","+point.y},buildExtendedData:function(attributes){var extendedData=this.createElementNS(this.kmlns,"ExtendedData"),attributeName,data,value,displayName;for(attributeName in attributes)attributes[attributeName]&&attributeName!="name"&&attributeName!="description"&&attributeName!="styleUrl"&&(data=this.createElementNS(this.kmlns,"Data"),data.setAttribute("name",attributeName),value=this.createElementNS(this.kmlns,"value"),typeof attributes[attributeName]=="object"?(attributes[attributeName].value&&value.appendChild(this.createTextNode(attributes[attributeName].value)),attributes[attributeName].displayName&&(displayName=this.createElementNS(this.kmlns,"displayName"),displayName.appendChild(this.getXMLDoc().createCDATASection(attributes[attributeName].displayName)),data.appendChild(displayName))):value.appendChild(this.createTextNode(attributes[attributeName])),data.appendChild(value),extendedData.appendChild(data));return this.isSimpleContent(extendedData)?null:extendedData},CLASS_NAME:"OpenLayers.Format.KML"});OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],split:function(geometry,options){for(var j,k,klen,results=null,mutual=options&&options.mutual,splits,sourceLine,sourceLines,sourceSplit,targetSplit,sourceParts=[],targetParts=[geometry],i=0,len=this.components.length;i<len;++i){for(sourceLine=this.components[i],sourceSplit=!1,j=0;j<targetParts.length;++j)if(splits=sourceLine.split(targetParts[j],options),splits){if(mutual){for(sourceLines=splits[0],k=0,klen=sourceLines.length;k<klen;++k)k===0&&sourceParts.length?sourceParts[sourceParts.length-1].addComponent(sourceLines[k]):sourceParts.push(new OpenLayers.Geometry.MultiLineString([sourceLines[k]]));sourceSplit=!0;splits=splits[1]}if(splits.length){splits.unshift(j,1);Array.prototype.splice.apply(targetParts,splits);break}}sourceSplit||(sourceParts.length?sourceParts[sourceParts.length-1].addComponent(sourceLine.clone()):sourceParts=[new OpenLayers.Geometry.MultiLineString(sourceLine.clone())])}return sourceParts&&sourceParts.length>1?sourceSplit=!0:sourceParts=[],targetParts&&targetParts.length>1?targetSplit=!0:targetParts=[],(sourceSplit||targetSplit)&&(results=mutual?[sourceParts,targetParts]:targetParts),results},splitWith:function(geometry,options){var results=null,mutual=options&&options.mutual,splits,targetLine,sourceLines,sourceSplit,targetSplit,sourceParts,targetParts,i,len,j,k,klen;if(geometry instanceof OpenLayers.Geometry.LineString)for(targetParts=[],sourceParts=[geometry],i=0,len=this.components.length;i<len;++i){for(targetSplit=!1,targetLine=this.components[i],j=0;j<sourceParts.length;++j)if(splits=sourceParts[j].split(targetLine,options),splits){for(mutual&&(sourceLines=splits[0],sourceLines.length&&(sourceLines.unshift(j,1),Array.prototype.splice.apply(sourceParts,sourceLines),j+=sourceLines.length-2),splits=splits[1],splits.length===0&&(splits=[targetLine.clone()])),k=0,klen=splits.length;k<klen;++k)k===0&&targetParts.length?targetParts[targetParts.length-1].addComponent(splits[k]):targetParts.push(new OpenLayers.Geometry.MultiLineString([splits[k]]));targetSplit=!0}targetSplit||(targetParts.length?targetParts[targetParts.length-1].addComponent(targetLine.clone()):targetParts=[new OpenLayers.Geometry.MultiLineString([targetLine.clone()])])}else results=geometry.split(this);return sourceParts&&sourceParts.length>1?sourceSplit=!0:sourceParts=[],targetParts&&targetParts.length>1?targetSplit=!0:targetParts=[],(sourceSplit||targetSplit)&&(results=mutual?[sourceParts,targetParts]:targetParts),results},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"});OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"});OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:!0,xy:!0,initialize:function(options){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g};OpenLayers.Format.XML.prototype.initialize.apply(this,[options])},read:function(data){var featureNodes,features,i,feature;for(typeof data=="string"&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data])),featureNodes=this.getElementsByTagNameNS(data.documentElement,this.gmlns,this.featureName),features=[],i=0;i<featureNodes.length;i++)feature=this.parseFeature(featureNodes[i]),feature&&features.push(feature);return features},parseFeature:function(node){for(var bounds,boxNodes,attributes,feature,childNode,fid,order=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"],type,nodeList,geometry,parser,i=0;i<order.length;++i)if(type=order[i],nodeList=this.getElementsByTagNameNS(node,this.gmlns,type),nodeList.length>0){if(parser=this.parseGeometry[type.toLowerCase()],parser)geometry=parser.apply(this,[nodeList[0]]),this.internalProjection&&this.externalProjection&&geometry.transform(this.externalProjection,this.internalProjection);else throw new TypeError("Unsupported geometry type: "+type);break}for(boxNodes=this.getElementsByTagNameNS(node,this.gmlns,"Box"),i=0;i<boxNodes.length;++i){var boxNode=boxNodes[i],box=this.parseGeometry.box.apply(this,[boxNode]),parentNode=boxNode.parentNode,parentName=parentNode.localName||parentNode.nodeName.split(":").pop();parentName==="boundedBy"?bounds=box:geometry=box.toGeometry()}for(this.extractAttributes&&(attributes=this.parseAttributes(node)),feature=new OpenLayers.Feature.Vector(geometry,attributes),feature.bounds=bounds,feature.gml={featureType:node.firstChild.nodeName.split(":")[1],featureNS:node.firstChild.namespaceURI,featureNSPrefix:node.firstChild.prefix},childNode=node.firstChild;childNode;){if(childNode.nodeType==1&&(fid=childNode.getAttribute("fid")||childNode.getAttribute("id"),fid))break;childNode=childNode.nextSibling}return feature.fid=fid,feature},parseGeometry:{point:function(node){var coordString,coords=[],nodeList=this.getElementsByTagNameNS(node,this.gmlns,"pos"),xList,yList;return nodeList.length>0&&(coordString=nodeList[0].firstChild.nodeValue,coordString=coordString.replace(this.regExes.trimSpace,""),coords=coordString.split(this.regExes.splitSpace)),coords.length==0&&(nodeList=this.getElementsByTagNameNS(node,this.gmlns,"coordinates"),nodeList.length>0&&(coordString=nodeList[0].firstChild.nodeValue,coordString=coordString.replace(this.regExes.removeSpace,""),coords=coordString.split(","))),coords.length==0&&(nodeList=this.getElementsByTagNameNS(node,this.gmlns,"coord"),nodeList.length>0&&(xList=this.getElementsByTagNameNS(nodeList[0],this.gmlns,"X"),yList=this.getElementsByTagNameNS(nodeList[0],this.gmlns,"Y"),xList.length>0&&yList.length>0&&(coords=[xList[0].firstChild.nodeValue,yList[0].firstChild.nodeValue]))),coords.length==2&&(coords[2]=null),this.xy?new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2]):new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2])},multipoint:function(node){var nodeList=this.getElementsByTagNameNS(node,this.gmlns,"Point"),components=[],point,i;if(nodeList.length>0)for(i=0;i<nodeList.length;++i)point=this.parseGeometry.point.apply(this,[nodeList[i]]),point&&components.push(point);return new OpenLayers.Geometry.MultiPoint(components)},linestring:function(node,ring){var nodeList,coordString,coords=[],points=[],dim,j,x,y,z,pointList,i,line;if(nodeList=this.getElementsByTagNameNS(node,this.gmlns,"posList"),nodeList.length>0)for(coordString=this.getChildValue(nodeList[0]),coordString=coordString.replace(this.regExes.trimSpace,""),coords=coordString.split(this.regExes.splitSpace),dim=parseInt(nodeList[0].getAttribute("dimension")),i=0;i<coords.length/dim;++i)j=i*dim,x=coords[j],y=coords[j+1],z=dim==2?null:coords[j+2],this.xy?points.push(new OpenLayers.Geometry.Point(x,y,z)):points.push(new OpenLayers.Geometry.Point(y,x,z));if(coords.length==0&&(nodeList=this.getElementsByTagNameNS(node,this.gmlns,"coordinates"),nodeList.length>0))for(coordString=this.getChildValue(nodeList[0]),coordString=coordString.replace(this.regExes.trimSpace,""),coordString=coordString.replace(this.regExes.trimComma,","),pointList=coordString.split(this.regExes.splitSpace),i=0;i<pointList.length;++i)coords=pointList[i].split(","),coords.length==2&&(coords[2]=null),this.xy?points.push(new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2])):points.push(new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2]));return line=null,points.length!=0&&(line=ring?new OpenLayers.Geometry.LinearRing(points):new OpenLayers.Geometry.LineString(points)),line},multilinestring:function(node){var nodeList=this.getElementsByTagNameNS(node,this.gmlns,"LineString"),components=[],line,i;if(nodeList.length>0)for(i=0;i<nodeList.length;++i)line=this.parseGeometry.linestring.apply(this,[nodeList[i]]),line&&components.push(line);return new OpenLayers.Geometry.MultiLineString(components)},polygon:function(node){var nodeList=this.getElementsByTagNameNS(node,this.gmlns,"LinearRing"),components=[],ring,i;if(nodeList.length>0)for(i=0;i<nodeList.length;++i)ring=this.parseGeometry.linestring.apply(this,[nodeList[i],!0]),ring&&components.push(ring);return new OpenLayers.Geometry.Polygon(components)},multipolygon:function(node){var nodeList=this.getElementsByTagNameNS(node,this.gmlns,"Polygon"),components=[],polygon,i;if(nodeList.length>0)for(i=0;i<nodeList.length;++i)polygon=this.parseGeometry.polygon.apply(this,[nodeList[i]]),polygon&&components.push(polygon);return new OpenLayers.Geometry.MultiPolygon(components)},envelope:function(node){var components=[],coordString,envelope,lpoint=this.getElementsByTagNameNS(node,this.gmlns,"lowerCorner"),lowerPoint,upoint,coords,upperPoint,ring;return lpoint.length>0&&(coords=[],lpoint.length>0&&(coordString=lpoint[0].firstChild.nodeValue,coordString=coordString.replace(this.regExes.trimSpace,""),coords=coordString.split(this.regExes.splitSpace)),coords.length==2&&(coords[2]=null),lowerPoint=this.xy?new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2]):new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2])),upoint=this.getElementsByTagNameNS(node,this.gmlns,"upperCorner"),upoint.length>0&&(coords=[],upoint.length>0&&(coordString=upoint[0].firstChild.nodeValue,coordString=coordString.replace(this.regExes.trimSpace,""),coords=coordString.split(this.regExes.splitSpace)),coords.length==2&&(coords[2]=null),upperPoint=this.xy?new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2]):new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2])),lowerPoint&&upperPoint&&(components.push(new OpenLayers.Geometry.Point(lowerPoint.x,lowerPoint.y)),components.push(new OpenLayers.Geometry.Point(upperPoint.x,lowerPoint.y)),components.push(new OpenLayers.Geometry.Point(upperPoint.x,upperPoint.y)),components.push(new OpenLayers.Geometry.Point(lowerPoint.x,upperPoint.y)),components.push(new OpenLayers.Geometry.Point(lowerPoint.x,lowerPoint.y)),ring=new OpenLayers.Geometry.LinearRing(components),envelope=new OpenLayers.Geometry.Polygon([ring])),envelope},box:function(node){var nodeList=this.getElementsByTagNameNS(node,this.gmlns,"coordinates"),coordString,coords,beginPoint=null,endPoint=null;return nodeList.length>0&&(coordString=nodeList[0].firstChild.nodeValue,coords=coordString.split(" "),coords.length==2&&(beginPoint=coords[0].split(","),endPoint=coords[1].split(","))),beginPoint!==null&&endPoint!==null?new OpenLayers.Bounds(parseFloat(beginPoint[0]),parseFloat(beginPoint[1]),parseFloat(endPoint[0]),parseFloat(endPoint[1])):void 0}},parseAttributes:function(node){for(var attributes={},childNode=node.firstChild,children,i,child,grandchildren,grandchild,name,value;childNode;){if(childNode.nodeType==1){for(children=childNode.childNodes,i=0;i<children.length;++i)child=children[i],child.nodeType==1&&(grandchildren=child.childNodes,grandchildren.length==1?(grandchild=grandchildren[0],(grandchild.nodeType==3||grandchild.nodeType==4)&&(name=child.prefix?child.nodeName.split(":")[1]:child.nodeName,value=grandchild.nodeValue.replace(this.regExes.trimSpace,""),attributes[name]=value)):attributes[child.nodeName.split(":").pop()]=null);break}childNode=childNode.nextSibling}return attributes},write:function(features){var gml,i;for(OpenLayers.Util.isArray(features)||(features=[features]),gml=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName),i=0;i<features.length;i++)gml.appendChild(this.createFeatureXML(features[i]));return OpenLayers.Format.XML.prototype.write.apply(this,[gml])},createFeatureXML:function(feature){var geometry=feature.geometry,geometryNode=this.buildGeometryNode(geometry),geomContainer=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName),attr;geomContainer.appendChild(geometryNode);var featureNode=this.createElementNS(this.gmlns,"gml:"+this.featureName),featureContainer=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName),fid=feature.fid||feature.id;featureContainer.setAttribute("fid",fid);featureContainer.appendChild(geomContainer);for(attr in feature.attributes){var attrText=this.createTextNode(feature.attributes[attr]),nodename=attr.substring(attr.lastIndexOf(":")+1),attrContainer=this.createElementNS(this.featureNS,this.featurePrefix+":"+nodename);attrContainer.appendChild(attrText);featureContainer.appendChild(attrContainer)}return featureNode.appendChild(featureContainer),featureNode},buildGeometryNode:function(geometry){this.externalProjection&&this.internalProjection&&(geometry=geometry.clone(),geometry.transform(this.internalProjection,this.externalProjection));var className=geometry.CLASS_NAME,type=className.substring(className.lastIndexOf(".")+1),builder=this.buildGeometry[type.toLowerCase()];return builder.apply(this,[geometry])},buildGeometry:{point:function(geometry){var gml=this.createElementNS(this.gmlns,"gml:Point");return gml.appendChild(this.buildCoordinatesNode(geometry)),gml},multipoint:function(geometry){for(var gml=this.createElementNS(this.gmlns,"gml:MultiPoint"),points=geometry.components,pointMember,pointGeom,i=0;i<points.length;i++)pointMember=this.createElementNS(this.gmlns,"gml:pointMember"),pointGeom=this.buildGeometry.point.apply(this,[points[i]]),pointMember.appendChild(pointGeom),gml.appendChild(pointMember);return gml},linestring:function(geometry){var gml=this.createElementNS(this.gmlns,"gml:LineString");return gml.appendChild(this.buildCoordinatesNode(geometry)),gml},multilinestring:function(geometry){for(var gml=this.createElementNS(this.gmlns,"gml:MultiLineString"),lines=geometry.components,lineMember,lineGeom,i=0;i<lines.length;++i)lineMember=this.createElementNS(this.gmlns,"gml:lineStringMember"),lineGeom=this.buildGeometry.linestring.apply(this,[lines[i]]),lineMember.appendChild(lineGeom),gml.appendChild(lineMember);return gml},linearring:function(geometry){var gml=this.createElementNS(this.gmlns,"gml:LinearRing");return gml.appendChild(this.buildCoordinatesNode(geometry)),gml},polygon:function(geometry){for(var gml=this.createElementNS(this.gmlns,"gml:Polygon"),rings=geometry.components,ringMember,ringGeom,type,i=0;i<rings.length;++i)type=i==0?"outerBoundaryIs":"innerBoundaryIs",ringMember=this.createElementNS(this.gmlns,"gml:"+type),ringGeom=this.buildGeometry.linearring.apply(this,[rings[i]]),ringMember.appendChild(ringGeom),gml.appendChild(ringMember);return gml},multipolygon:function(geometry){for(var gml=this.createElementNS(this.gmlns,"gml:MultiPolygon"),polys=geometry.components,polyMember,polyGeom,i=0;i<polys.length;++i)polyMember=this.createElementNS(this.gmlns,"gml:polygonMember"),polyGeom=this.buildGeometry.polygon.apply(this,[polys[i]]),polyMember.appendChild(polyGeom),gml.appendChild(polyMember);return gml},bounds:function(bounds){var gml=this.createElementNS(this.gmlns,"gml:Box");return gml.appendChild(this.buildCoordinatesNode(bounds)),gml}},buildCoordinatesNode:function(geometry){var coordinatesNode=this.createElementNS(this.gmlns,"gml:coordinates"),parts,points,i,txtNode;if(coordinatesNode.setAttribute("decimal","."),coordinatesNode.setAttribute("cs",","),coordinatesNode.setAttribute("ts"," "),parts=[],geometry instanceof OpenLayers.Bounds)parts.push(geometry.left+","+geometry.bottom),parts.push(geometry.right+","+geometry.top);else for(points=geometry.components?geometry.components:[geometry],i=0;i<points.length;i++)parts.push(points[i].x+","+points[i].y);return txtNode=this.createTextNode(parts.join(" ")),coordinatesNode.appendChild(txtNode),coordinatesNode},CLASS_NAME:"OpenLayers.Format.GML"});OpenLayers.Format.GML||(OpenLayers.Format.GML={});OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:!0,srsName:null,xy:!0,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,featureMember:/^(.*:)?featureMembers?$/},initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options]);this.setGeometryTypes();options&&options.featureNS&&this.setNamespace("feature",options.featureNS);this.singleFeatureType=!options||typeof options.featureType=="string"},read:function(data){var features,i,len,elements;if(typeof data=="string"&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data])),data&&data.nodeType==9&&(data=data.documentElement),features=[],this.readNode(data,{features:features},!0),features.length==0)if(elements=this.getElementsByTagNameNS(data,this.namespaces.gml,"featureMember"),elements.length)for(i=0,len=elements.length;i<len;++i)this.readNode(elements[i],{features:features},!0);else elements=this.getElementsByTagNameNS(data,this.namespaces.gml,"featureMembers"),elements.length&&this.readNode(elements[0],{features:features},!0);return features},readNode:function(node,obj,first){return first===!0&&this.autoConfig===!0&&(this.featureType=null,delete this.namespaceAlias[this.featureNS],delete this.namespaces.feature,this.featureNS=null),this.featureNS||node.prefix in this.namespaces||node.parentNode.namespaceURI!=this.namespaces.gml||!this.regExes.featureMember.test(node.parentNode.nodeName)||(this.featureType=node.nodeName.split(":").pop(),this.setNamespace("feature",node.namespaceURI),this.featureNS=node.namespaceURI,this.autoConfig=!0),OpenLayers.Format.XML.prototype.readNode.apply(this,[node,obj])},readers:{gml:{_inherit:function(){},featureMember:function(node,obj){this.readChildNodes(node,obj)},featureMembers:function(node,obj){this.readChildNodes(node,obj)},name:function(node,obj){obj.name=this.getChildValue(node)},boundedBy:function(node,obj){var container={};this.readChildNodes(node,container);container.components&&container.components.length>0&&(obj.bounds=container.components[0])},Point:function(node,container){var obj={points:[]};this.readChildNodes(node,obj);container.components||(container.components=[]);container.components.push(obj.points[0])},coordinates:function(node,obj){var str=this.getChildValue(node).replace(this.regExes.trimSpace,""),i;str=str.replace(this.regExes.trimComma,",");var pointList=str.split(this.regExes.splitSpace),coords,numPoints=pointList.length,points=new Array(numPoints);for(i=0;i<numPoints;++i)coords=pointList[i].split(","),points[i]=this.xy?new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2]):new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2]);obj.points=points},coord:function(node,obj){var coord={};this.readChildNodes(node,coord);obj.points||(obj.points=[]);obj.points.push(new OpenLayers.Geometry.Point(coord.x,coord.y,coord.z))},X:function(node,coord){coord.x=this.getChildValue(node)},Y:function(node,coord){coord.y=this.getChildValue(node)},Z:function(node,coord){coord.z=this.getChildValue(node)},MultiPoint:function(node,container){var obj={components:[]};this.readers.gml._inherit.apply(this,[node,obj,container]);this.readChildNodes(node,obj);container.components=[new OpenLayers.Geometry.MultiPoint(obj.components)]},pointMember:function(node,obj){this.readChildNodes(node,obj)},LineString:function(node,container){var obj={};this.readers.gml._inherit.apply(this,[node,obj,container]);this.readChildNodes(node,obj);container.components||(container.components=[]);container.components.push(new OpenLayers.Geometry.LineString(obj.points))},MultiLineString:function(node,container){var obj={components:[]};this.readers.gml._inherit.apply(this,[node,obj,container]);this.readChildNodes(node,obj);container.components=[new OpenLayers.Geometry.MultiLineString(obj.components)]},lineStringMember:function(node,obj){this.readChildNodes(node,obj)},Polygon:function(node,container){var obj={outer:null,inner:[]};this.readers.gml._inherit.apply(this,[node,obj,container]);this.readChildNodes(node,obj);obj.inner.unshift(obj.outer);container.components||(container.components=[]);container.components.push(new OpenLayers.Geometry.Polygon(obj.inner))},LinearRing:function(node,obj){var container={};this.readers.gml._inherit.apply(this,[node,container]);this.readChildNodes(node,container);obj.components=[new OpenLayers.Geometry.LinearRing(container.points)]},MultiPolygon:function(node,container){var obj={components:[]};this.readers.gml._inherit.apply(this,[node,obj,container]);this.readChildNodes(node,obj);container.components=[new OpenLayers.Geometry.MultiPolygon(obj.components)]},polygonMember:function(node,obj){this.readChildNodes(node,obj)},GeometryCollection:function(node,container){var obj={components:[]};this.readers.gml._inherit.apply(this,[node,obj,container]);this.readChildNodes(node,obj);container.components=[new OpenLayers.Geometry.Collection(obj.components)]},geometryMember:function(node,obj){this.readChildNodes(node,obj)}},feature:{"*":function(node,obj){var name,local=node.localName||node.nodeName.split(":").pop();obj.features?this.singleFeatureType||OpenLayers.Util.indexOf(this.featureType,local)===-1?local===this.featureType&&(name="_typeName"):name="_typeName":node.childNodes.length==0||node.childNodes.length==1&&node.firstChild.nodeType==3?this.extractAttributes&&(name="_attribute"):name="_geometry";name&&this.readers.feature[name].apply(this,[node,obj])},_typeName:function(node,obj){var container={components:[],attributes:{}},feature,fid;this.readChildNodes(node,container);container.name&&(container.attributes.name=container.name);feature=new OpenLayers.Feature.Vector(container.components[0],container.attributes);this.singleFeatureType||(feature.type=node.nodeName.split(":").pop(),feature.namespace=node.namespaceURI);fid=node.getAttribute("fid")||this.getAttributeNS(node,this.namespaces.gml,"id");fid&&(feature.fid=fid);this.internalProjection&&this.externalProjection&&feature.geometry&&feature.geometry.transform(this.externalProjection,this.internalProjection);container.bounds&&(feature.bounds=container.bounds);obj.features.push(feature)},_geometry:function(node,obj){this.geometryName||(this.geometryName=node.nodeName.split(":").pop());this.readChildNodes(node,obj)},_attribute:function(node,obj){var local=node.localName||node.nodeName.split(":").pop(),value=this.getChildValue(node);obj.attributes[local]=value}},wfs:{FeatureCollection:function(node,obj){this.readChildNodes(node,obj)}}},write:function(features){var name,root;return name=OpenLayers.Util.isArray(features)?"featureMembers":"featureMember",root=this.writeNode("gml:"+name,features),this.setAttributeNS(root,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[root])},writers:{gml:{featureMember:function(feature){var node=this.createElementNSPlus("gml:featureMember");return this.writeNode("feature:_typeName",feature,node),node},MultiPoint:function(geometry){for(var node=this.createElementNSPlus("gml:MultiPoint"),components=geometry.components||[geometry],i=0,ii=components.length;i<ii;++i)this.writeNode("pointMember",components[i],node);return node},pointMember:function(geometry){var node=this.createElementNSPlus("gml:pointMember");return this.writeNode("Point",geometry,node),node},MultiLineString:function(geometry){for(var node=this.createElementNSPlus("gml:MultiLineString"),components=geometry.components||[geometry],i=0,ii=components.length;i<ii;++i)this.writeNode("lineStringMember",components[i],node);return node},lineStringMember:function(geometry){var node=this.createElementNSPlus("gml:lineStringMember");return this.writeNode("LineString",geometry,node),node},MultiPolygon:function(geometry){for(var node=this.createElementNSPlus("gml:MultiPolygon"),components=geometry.components||[geometry],i=0,ii=components.length;i<ii;++i)this.writeNode("polygonMember",components[i],node);return node},polygonMember:function(geometry){var node=this.createElementNSPlus("gml:polygonMember");return this.writeNode("Polygon",geometry,node),node},GeometryCollection:function(geometry){for(var node=this.createElementNSPlus("gml:GeometryCollection"),i=0,len=geometry.components.length;i<len;++i)this.writeNode("geometryMember",geometry.components[i],node);return node},geometryMember:function(geometry){var node=this.createElementNSPlus("gml:geometryMember"),child=this.writeNode("feature:_geometry",geometry);return node.appendChild(child.firstChild),node}},feature:{_typeName:function(feature){var node=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:feature.fid}}),name,value;feature.geometry&&this.writeNode("feature:_geometry",feature.geometry,node);for(name in feature.attributes)value=feature.attributes[name],value!=null&&this.writeNode("feature:_attribute",{name:name,value:value},node);return node},_geometry:function(geometry){this.externalProjection&&this.internalProjection&&(geometry=geometry.clone().transform(this.internalProjection,this.externalProjection));var node=this.createElementNSPlus("feature:"+this.geometryName),type=this.geometryTypes[geometry.CLASS_NAME],child=this.writeNode("gml:"+type,geometry,node);return this.srsName&&child.setAttribute("srsName",this.srsName),node},_attribute:function(obj){return this.createElementNSPlus("feature:"+obj.name,{value:obj.value})}},wfs:{FeatureCollection:function(features){for(var node=this.createElementNSPlus("wfs:FeatureCollection"),i=0,len=features.length;i<len;++i)this.writeNode("gml:featureMember",features[i],node);return node}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.Base"});OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(options){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[options])},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(node,container){var obj={};this.readChildNodes(node,obj);container.outer=obj.components[0]},innerBoundaryIs:function(node,container){var obj={};this.readChildNodes(node,obj);container.inner.push(obj.components[0])},Box:function(node,container){var obj={},min,max;this.readChildNodes(node,obj);container.components||(container.components=[]);min=obj.points[0];max=obj.points[1];container.components.push(new OpenLayers.Bounds(min.x,min.y,max.x,max.y))}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(features){var name,root;return name=OpenLayers.Util.isArray(features)?"wfs:FeatureCollection":"gml:featureMember",root=this.writeNode(name,features),this.setAttributeNS(root,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[root])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(geometry){var node=this.createElementNSPlus("gml:Point");return this.writeNode("coordinates",[geometry],node),node},coordinates:function(points){for(var numPoints=points.length,parts=new Array(numPoints),point,i=0;i<numPoints;++i)point=points[i],parts[i]=this.xy?point.x+","+point.y:point.y+","+point.x,point.z!=undefined&&(parts[i]+=","+point.z);return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:numPoints==1?parts[0]:parts.join(" ")})},LineString:function(geometry){var node=this.createElementNSPlus("gml:LineString");return this.writeNode("coordinates",geometry.components,node),node},Polygon:function(geometry){var node=this.createElementNSPlus("gml:Polygon"),i;for(this.writeNode("outerBoundaryIs",geometry.components[0],node),i=1;i<geometry.components.length;++i)this.writeNode("innerBoundaryIs",geometry.components[i],node);return node},outerBoundaryIs:function(ring){var node=this.createElementNSPlus("gml:outerBoundaryIs");return this.writeNode("LinearRing",ring,node),node},innerBoundaryIs:function(ring){var node=this.createElementNSPlus("gml:innerBoundaryIs");return this.writeNode("LinearRing",ring,node),node},LinearRing:function(ring){var node=this.createElementNSPlus("gml:LinearRing");return this.writeNode("coordinates",ring.components,node),node},Box:function(bounds){var node=this.createElementNSPlus("gml:Box");return this.writeNode("coordinates",[{x:bounds.left,y:bounds.bottom},{x:bounds.right,y:bounds.top}],node),this.srsName&&node.setAttribute("srsName",this.srsName),node}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"});OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:!1,propertyStyles:null,initialize:function(style,options){OpenLayers.Util.extend(this,options);this.rules=[];options&&options.rules&&this.addRules(options.rules);this.setDefaultStyle(style||OpenLayers.Feature.Vector.style["default"]);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var i=0,len=this.rules.length;i<len;i++)this.rules[i].destroy(),this.rules[i]=null;this.rules=null;this.defaultStyle=null},createSymbolizer:function(feature){for(var applies,style=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),feature),rules=this.rules,rule,elseRules=[],appliedRules=!1,i=0,len=rules.length;i<len;i++)rule=rules[i],applies=rule.evaluate(feature),applies&&(rule instanceof OpenLayers.Rule&&rule.elseFilter?elseRules.push(rule):(appliedRules=!0,this.applySymbolizer(rule,style,feature)));if(appliedRules==!1&&elseRules.length>0)for(appliedRules=!0,i=0,len=elseRules.length;i<len;i++)this.applySymbolizer(elseRules[i],style,feature);return rules.length>0&&appliedRules==!1&&(style.display="none"),style.label!=null&&typeof style.label!="string"&&(style.label=String(style.label)),style},applySymbolizer:function(rule,style,feature){var symbolizerPrefix=feature.geometry?this.getSymbolizerPrefix(feature.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0],symbolizer=rule.symbolizer[symbolizerPrefix]||rule.symbolizer,defaults;return this.defaultsPerSymbolizer===!0&&(defaults=this.defaultStyle,OpenLayers.Util.applyDefaults(symbolizer,{pointRadius:defaults.pointRadius}),(symbolizer.stroke===!0||symbolizer.graphic===!0)&&OpenLayers.Util.applyDefaults(symbolizer,{strokeWidth:defaults.strokeWidth,strokeColor:defaults.strokeColor,strokeOpacity:defaults.strokeOpacity,strokeDashstyle:defaults.strokeDashstyle,strokeLinecap:defaults.strokeLinecap}),(symbolizer.fill===!0||symbolizer.graphic===!0)&&OpenLayers.Util.applyDefaults(symbolizer,{fillColor:defaults.fillColor,fillOpacity:defaults.fillOpacity}),symbolizer.graphic===!0&&OpenLayers.Util.applyDefaults(symbolizer,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})),this.createLiterals(OpenLayers.Util.extend(style,symbolizer),feature)},createLiterals:function(style,feature){var context=OpenLayers.Util.extend({},feature.attributes||feature.data),i;OpenLayers.Util.extend(context,this.context);for(i in this.propertyStyles)style[i]=OpenLayers.Style.createLiteral(style[i],context,feature,i);return style},findPropertyStyles:function(){var propertyStyles={},style=this.defaultStyle,rules,symbolizer,value,i,len,key;for(this.addPropertyStyles(propertyStyles,style),rules=this.rules,i=0,len=rules.length;i<len;i++){symbolizer=rules[i].symbolizer;for(key in symbolizer)if(value=symbolizer[key],typeof value=="object")this.addPropertyStyles(propertyStyles,value);else{this.addPropertyStyles(propertyStyles,symbolizer);break}}return propertyStyles},addPropertyStyles:function(propertyStyles,symbolizer){var property;for(var key in symbolizer)property=symbolizer[key],typeof property=="string"&&property.match(/\$\{\w+\}/)&&(propertyStyles[key]=!0);return propertyStyles},addRules:function(rules){Array.prototype.push.apply(this.rules,rules);this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(style){this.defaultStyle=style;this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(geometry){for(var prefixes=OpenLayers.Style.SYMBOLIZER_PREFIXES,i=0,len=prefixes.length;i<len;i++)if(geometry.CLASS_NAME.indexOf(prefixes[i])!=-1)return prefixes[i]},clone:function(){var options=OpenLayers.Util.extend({},this),i,len,defaultStyle;if(this.rules)for(options.rules=[],i=0,len=this.rules.length;i<len;++i)options.rules.push(this.rules[i].clone());return options.context=this.context&&OpenLayers.Util.extend({},this.context),defaultStyle=OpenLayers.Util.extend({},this.defaultStyle),new OpenLayers.Style(defaultStyle,options)},CLASS_NAME:"OpenLayers.Style"});OpenLayers.Style.createLiteral=function(value,context,feature,property){return typeof value=="string"&&value.indexOf("${")!=-1&&(value=OpenLayers.String.format(value,context,[feature,property]),value=isNaN(value)||!value?value:parseFloat(value)),value};OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"];OpenLayers.Rule=OpenLayers.Class({id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:!1,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(options){this.symbolizer={};OpenLayers.Util.extend(this,options);this.symbolizers&&delete this.symbolizer;this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var i in this.symbolizer)this.symbolizer[i]=null;this.symbolizer=null;delete this.symbolizers},evaluate:function(feature){var context=this.getContext(feature),applies=!0,scale;return(this.minScaleDenominator||this.maxScaleDenominator)&&(scale=feature.layer.map.getScale()),this.minScaleDenominator&&(applies=scale>=OpenLayers.Style.createLiteral(this.minScaleDenominator,context)),applies&&this.maxScaleDenominator&&(applies=scale<OpenLayers.Style.createLiteral(this.maxScaleDenominator,context)),applies&&this.filter&&(applies=this.filter.CLASS_NAME=="OpenLayers.Filter.FeatureId"?this.filter.evaluate(feature):this.filter.evaluate(context)),applies},getContext:function(feature){var context=this.context;return context||(context=feature.attributes||feature.data),typeof this.context=="function"&&(context=this.context(feature)),context},clone:function(){var options=OpenLayers.Util.extend({},this),len,i,value,type,key;if(this.symbolizers)for(len=this.symbolizers.length,options.symbolizers=new Array(len),i=0;i<len;++i)options.symbolizers[i]=this.symbolizers[i].clone();else{options.symbolizer={};for(key in this.symbolizer)value=this.symbolizer[key],type=typeof value,type==="object"?options.symbolizer[key]=OpenLayers.Util.extend({},value):type==="string"&&(options.symbolizer[key]=value)}return options.filter=this.filter&&this.filter.clone(),options.context=this.context&&OpenLayers.Util.extend({},this.context),new OpenLayers.Rule(options)},CLASS_NAME:"OpenLayers.Rule"});OpenLayers.Format.OGCExceptionReport=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},defaultPrefix:"ogc",read:function(data){var root,exceptionInfo;return typeof data=="string"&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data])),root=data.documentElement,exceptionInfo={exceptionReport:null},root&&(this.readChildNodes(data,exceptionInfo),exceptionInfo.exceptionReport===null&&(exceptionInfo=(new OpenLayers.Format.OWSCommon).read(data))),exceptionInfo},readers:{ogc:{ServiceExceptionReport:function(node,obj){obj.exceptionReport={exceptions:[]};this.readChildNodes(node,obj.exceptionReport)},ServiceException:function(node,exceptionReport){var exception={code:node.getAttribute("code"),locator:node.getAttribute("locator"),text:this.getChildValue(node)};exceptionReport.exceptions.push(exception)}}},CLASS_NAME:"OpenLayers.Format.OGCExceptionReport"});OpenLayers.Format.XML.VersionedOGC=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:null,version:null,profile:null,allowFallback:!1,errorProperty:null,name:null,stringifyOutput:!1,parser:null,initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options]);var className=this.CLASS_NAME;this.name=className.substring(className.lastIndexOf(".")+1)},getVersion:function(root,options){var version;return root?(version=this.version,version||(version=root.getAttribute("version"),version||(version=this.defaultVersion))):version=options&&options.version||this.version||this.defaultVersion,version},getParser:function(version){var profile,format;if(version=version||this.defaultVersion,profile=this.profile?"_"+this.profile:"",!this.parser||this.parser.VERSION!=version){if(format=OpenLayers.Format[this.name]["v"+version.replace(/\./g,"_")+profile],!format&&(profile!==""&&this.allowFallback&&(profile="",format=OpenLayers.Format[this.name]["v"+version.replace(/\./g,"_")]),!format))throw"Can't find a "+this.name+" parser for version "+version+profile;this.parser=new format(this.options)}return this.parser},write:function(obj,options){var version=this.getVersion(null,options),root;return this.parser=this.getParser(version),root=this.parser.write(obj,options),this.stringifyOutput===!1?root:OpenLayers.Format.XML.prototype.write.apply(this,[root])},read:function(data,options){var root,version,obj,format;return typeof data=="string"&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data])),root=data.documentElement,version=this.getVersion(root),this.parser=this.getParser(version),obj=this.parser.read(data,options),this.errorProperty!==null&&obj[this.errorProperty]===undefined&&(format=new OpenLayers.Format.OGCExceptionReport,obj.error=format.read(data)),obj.version=version,obj},CLASS_NAME:"OpenLayers.Format.XML.VersionedOGC"});OpenLayers.Filter=OpenLayers.Class({initialize:function(options){OpenLayers.Util.extend(this,options)},destroy:function(){},evaluate:function(){return!0},clone:function(){return null},toString:function(){return OpenLayers.Format&&OpenLayers.Format.CQL?OpenLayers.Format.CQL.prototype.write(this):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Filter"});OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,type:"FID",initialize:function(options){this.fids=[];OpenLayers.Filter.prototype.initialize.apply(this,[options])},evaluate:function(feature){for(var fid,i=0,len=this.fids.length;i<len;i++)if(fid=feature.fid||feature.id,fid==this.fids[i])return!0;return!1},clone:function(){var filter=new OpenLayers.Filter.FeatureId;return OpenLayers.Util.extend(filter,this),filter.fids=this.fids.slice(),filter},CLASS_NAME:"OpenLayers.Filter.FeatureId"});OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(options){this.filters=[];OpenLayers.Filter.prototype.initialize.apply(this,[options])},destroy:function(){this.filters=null;OpenLayers.Filter.prototype.destroy.apply(this)},evaluate:function(context){var i,len;switch(this.type){case OpenLayers.Filter.Logical.AND:for(i=0,len=this.filters.length;i<len;i++)if(this.filters[i].evaluate(context)==!1)return!1;return!0;case OpenLayers.Filter.Logical.OR:for(i=0,len=this.filters.length;i<len;i++)if(this.filters[i].evaluate(context)==!0)return!0;return!1;case OpenLayers.Filter.Logical.NOT:return!this.filters[0].evaluate(context)}return undefined},clone:function(){for(var filters=[],i=0,len=this.filters.length;i<len;++i)filters.push(this.filters[i].clone());return new OpenLayers.Filter.Logical({type:this.type,filters:filters})},CLASS_NAME:"OpenLayers.Filter.Logical"});OpenLayers.Filter.Logical.AND="&&";OpenLayers.Filter.Logical.OR="||";OpenLayers.Filter.Logical.NOT="!";OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:!0,lowerBoundary:null,upperBoundary:null,initialize:function(options){OpenLayers.Filter.prototype.initialize.apply(this,[options]);this.type===OpenLayers.Filter.Comparison.LIKE&&options.matchCase===undefined&&(this.matchCase=null)},evaluate:function(context){var result,got,exp,regexp;context instanceof OpenLayers.Feature.Vector&&(context=context.attributes);result=!1;got=context[this.property];switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:exp=this.value;result=this.matchCase||typeof got!="string"||typeof exp!="string"?got==exp:got.toUpperCase()==exp.toUpperCase();break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:exp=this.value;result=this.matchCase||typeof got!="string"||typeof exp!="string"?got!=exp:got.toUpperCase()!=exp.toUpperCase();break;case OpenLayers.Filter.Comparison.LESS_THAN:result=got<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:result=got>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:result=got<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:result=got>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:result=got>=this.lowerBoundary&&got<=this.upperBoundary;break;case OpenLayers.Filter.Comparison.LIKE:regexp=new RegExp(this.value,"gi");result=regexp.test(got)}return result},value2regex:function(wildCard,singleChar,escapeChar){if(wildCard==".")throw new Error("'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison");return wildCard=wildCard?wildCard:"*",singleChar=singleChar?singleChar:".",escapeChar=escapeChar?escapeChar:"!",this.value=this.value.replace(new RegExp("\\"+escapeChar+"(.|$)","g"),"\\$1"),this.value=this.value.replace(new RegExp("\\"+singleChar,"g"),"."),this.value=this.value.replace(new RegExp("\\"+wildCard,"g"),".*"),this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+wildCard),this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+singleChar),this.value},regex2value:function(){var value=this.value;return value=value.replace(/!/g,"!!"),value=value.replace(/(\\)?\\\./g,function($0,$1){return $1?$0:"!."}),value=value.replace(/(\\)?\\\*/g,function($0,$1){return $1?$0:"!*"}),value=value.replace(/\\\\/g,"\\"),value.replace(/\.\*/g,"*")},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison,this)},CLASS_NAME:"OpenLayers.Filter.Comparison"});OpenLayers.Filter.Comparison.EQUAL_TO="==";OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=";OpenLayers.Filter.Comparison.LESS_THAN="<";OpenLayers.Filter.Comparison.GREATER_THAN=">";OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=";OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=";OpenLayers.Filter.Comparison.BETWEEN="..";OpenLayers.Filter.Comparison.LIKE="~";OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,evaluate:function(feature){var intersect=!1,geom;switch(this.type){case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:feature.geometry&&(geom=this.value,this.value.CLASS_NAME=="OpenLayers.Bounds"&&(geom=this.value.toGeometry()),feature.geometry.intersects(geom)&&(intersect=!0));break;default:throw new Error("evaluate is not implemented for this filter type.");}return intersect},clone:function(){var options=OpenLayers.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new OpenLayers.Filter.Spatial(options)},CLASS_NAME:"OpenLayers.Filter.Spatial"});OpenLayers.Filter.Spatial.BBOX="BBOX";OpenLayers.Filter.Spatial.INTERSECTS="INTERSECTS";OpenLayers.Filter.Spatial.DWITHIN="DWITHIN";OpenLayers.Filter.Spatial.WITHIN="WITHIN";OpenLayers.Filter.Spatial.CONTAINS="CONTAINS";OpenLayers.Format.SLD=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{profile:null,defaultVersion:"1.0.0",stringifyOutput:!0,namedLayersAsArray:!1,CLASS_NAME:"OpenLayers.Format.SLD"});OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.Filter"});OpenLayers.Filter.Function=OpenLayers.Class(OpenLayers.Filter,{name:null,params:null,CLASS_NAME:"OpenLayers.Filter.Function"});OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options])},read:function(data){var obj={};return this.readers.ogc.Filter.apply(this,[data,obj]),obj.filter},readers:{ogc:{_expression:function(node){for(var obj,value="",child=node.firstChild;child;child=child.nextSibling)switch(child.nodeType){case 1:obj=this.readNode(child);obj.property?value+="${"+obj.property+"}":obj.value!==undefined&&(value+=obj.value);break;case 3:case 4:value+=child.nodeValue}return value},Filter:function(node,parent){var obj={fids:[],filters:[]};this.readChildNodes(node,obj);obj.fids.length>0?parent.filter=new OpenLayers.Filter.FeatureId({fids:obj.fids}):obj.filters.length>0&&(parent.filter=obj.filters[0])},FeatureId:function(node,obj){var fid=node.getAttribute("fid");fid&&obj.fids.push(fid)},And:function(node,obj){var filter=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(node,filter);obj.filters.push(filter)},Or:function(node,obj){var filter=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(node,filter);obj.filters.push(filter)},Not:function(node,obj){var filter=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(node,filter);obj.filters.push(filter)},PropertyIsLessThan:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(node,filter);obj.filters.push(filter)},PropertyIsGreaterThan:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(node,filter);obj.filters.push(filter)},PropertyIsLessThanOrEqualTo:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(node,filter);obj.filters.push(filter)},PropertyIsGreaterThanOrEqualTo:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(node,filter);obj.filters.push(filter)},PropertyIsBetween:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(node,filter);obj.filters.push(filter)},Literal:function(node,obj){obj.value=OpenLayers.String.numericIf(this.getChildValue(node),!0)},PropertyName:function(node,filter){filter.property=this.getChildValue(node)},LowerBoundary:function(node,filter){filter.lowerBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,node),!0)},UpperBoundary:function(node,filter){filter.upperBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,node),!0)},Intersects:function(node,obj){this.readSpatial(node,obj,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(node,obj){this.readSpatial(node,obj,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(node,obj){this.readSpatial(node,obj,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(node,obj){this.readSpatial(node,obj,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(node,obj){obj.distance=parseInt(this.getChildValue(node));obj.distanceUnits=node.getAttribute("units")},Function:function(){return}}},readSpatial:function(node,obj,type){var filter=new OpenLayers.Filter.Spatial({type:type});this.readChildNodes(node,filter);filter.value=filter.components[0];delete filter.components;obj.filters.push(filter)},writeOgcExpression:function(value,node){if(value instanceof OpenLayers.Filter.Function){var child=this.writeNode("Function",value,node);node.appendChild(child)}else this.writeNode("Literal",value,node);return node},write:function(filter){return this.writers.ogc.Filter.apply(this,[filter])},writeFeatureIdNodes:function(filter,node){for(var i=0,ii=filter.fids.length;i<ii;++i)this.writeNode("FeatureId",filter.fids[i],node)},writers:{ogc:{Filter:function(filter){var node=this.createElementNSPlus("ogc:Filter");return filter.type==="FID"?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,filter,node):this.writeNode(this.getFilterType(filter),filter,node),node},FeatureId:function(fid){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:fid}})},And:function(filter){for(var node=this.createElementNSPlus("ogc:And"),childFilter,i=0,ii=filter.filters.length;i<ii;++i)childFilter=filter.filters[i],childFilter.type==="FID"?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,childFilter,node):this.writeNode(this.getFilterType(childFilter),childFilter,node);return node},Or:function(filter){for(var node=this.createElementNSPlus("ogc:Or"),childFilter,i=0,ii=filter.filters.length;i<ii;++i)childFilter=filter.filters[i],childFilter.type==="FID"?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,childFilter,node):this.writeNode(this.getFilterType(childFilter),childFilter,node);return node},Not:function(filter){var node=this.createElementNSPlus("ogc:Not"),childFilter=filter.filters[0];return childFilter.type==="FID"?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,childFilter,node):this.writeNode(this.getFilterType(childFilter),childFilter,node),node},PropertyIsLessThan:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsLessThan");return this.writeNode("PropertyName",filter,node),this.writeOgcExpression(filter.value,node),node},PropertyIsGreaterThan:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsGreaterThan");return this.writeNode("PropertyName",filter,node),this.writeOgcExpression(filter.value,node),node},PropertyIsLessThanOrEqualTo:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");return this.writeNode("PropertyName",filter,node),this.writeOgcExpression(filter.value,node),node},PropertyIsGreaterThanOrEqualTo:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");return this.writeNode("PropertyName",filter,node),this.writeOgcExpression(filter.value,node),node},PropertyIsBetween:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsBetween");return this.writeNode("PropertyName",filter,node),this.writeNode("LowerBoundary",filter,node),this.writeNode("UpperBoundary",filter,node),node},PropertyName:function(filter){return this.createElementNSPlus("ogc:PropertyName",{value:filter.property})},Literal:function(value){return this.createElementNSPlus("ogc:Literal",{value:value})},LowerBoundary:function(filter){var node=this.createElementNSPlus("ogc:LowerBoundary");return this.writeOgcExpression(filter.lowerBoundary,node),node},UpperBoundary:function(filter){var node=this.createElementNSPlus("ogc:UpperBoundary");return this.writeNode("Literal",filter.upperBoundary,node),node},INTERSECTS:function(filter){return this.writeSpatial(filter,"Intersects")},WITHIN:function(filter){return this.writeSpatial(filter,"Within")},CONTAINS:function(filter){return this.writeSpatial(filter,"Contains")},DWITHIN:function(filter){var node=this.writeSpatial(filter,"DWithin");return this.writeNode("Distance",filter,node),node},Distance:function(filter){return this.createElementNSPlus("ogc:Distance",{attributes:{units:filter.distanceUnits},value:filter.distance})},Function:function(filter){for(var node=this.createElementNSPlus("ogc:Function",{attributes:{name:filter.name}}),params=filter.params,i=0,len=params.length;i<len;i++)this.writeOgcExpression(params[i],node);return node}}},getFilterType:function(filter){var filterType=this.filterMap[filter.type];if(!filterType)throw"Filter writing not supported for rule type: "+filter.type;return filterType},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"FeatureId"},CLASS_NAME:"OpenLayers.Format.Filter.v1"});OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(options){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[options])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(node,filter);obj.filters.push(filter)},PropertyIsNotEqualTo:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(node,filter);obj.filters.push(filter)},PropertyIsLike:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(node,filter);var wildCard=node.getAttribute("wildCard"),singleChar=node.getAttribute("singleChar"),esc=node.getAttribute("escape");filter.value2regex(wildCard,singleChar,esc);obj.filters.push(filter)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsEqualTo");return this.writeNode("PropertyName",filter,node),this.writeOgcExpression(filter.value,node),node},PropertyIsNotEqualTo:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");return this.writeNode("PropertyName",filter,node),this.writeOgcExpression(filter.value,node),node},PropertyIsLike:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});return this.writeNode("PropertyName",filter,node),this.writeNode("Literal",filter.regex2value(),node),node},BBOX:function(filter){var node=this.createElementNSPlus("ogc:BBOX"),box;return filter.property&&this.writeNode("PropertyName",filter,node),box=this.writeNode("gml:Box",filter.value,node),filter.projection&&box.setAttribute("srsName",filter.projection),node}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(filter,name){var node=this.createElementNSPlus("ogc:"+name),child;return this.writeNode("PropertyName",filter,node),filter.value instanceof OpenLayers.Filter.Function?this.writeNode("Function",filter.value,node):(child=filter.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",filter.value).firstChild:this.writeNode("gml:Box",filter.value),filter.projection&&child.setAttribute("srsName",filter.projection),node.appendChild(child)),node},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"});OpenLayers.Symbolizer=OpenLayers.Class({zIndex:0,initialize:function(config){OpenLayers.Util.extend(this,config)},clone:function(){var Type=eval(this.CLASS_NAME);return new Type(OpenLayers.Util.extend({},this))},CLASS_NAME:"OpenLayers.Symbolizer"});OpenLayers.Symbolizer.Point=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Point"});OpenLayers.Symbolizer.Line=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Line"});OpenLayers.Symbolizer.Polygon=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Polygon"});OpenLayers.Symbolizer.Text=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Text"});OpenLayers.Symbolizer.Raster=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Raster"});OpenLayers.Format.SLD.v1=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,{namespaces:{sld:"http://www.opengis.net/sld",ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"sld",schemaLocation:null,multipleSymbolizers:!1,featureTypeCounter:null,defaultSymbolizer:{fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square"},read:function(data,options){options=OpenLayers.Util.applyDefaults(options,this.options);var sld={namedLayers:options.namedLayersAsArray===!0?[]:{}};return this.readChildNodes(data,sld),sld},readers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(node,sld){sld.version=node.getAttribute("version");this.readChildNodes(node,sld)},Name:function(node,obj){obj.name=this.getChildValue(node)},Title:function(node,obj){obj.title=this.getChildValue(node)},Abstract:function(node,obj){obj.description=this.getChildValue(node)},NamedLayer:function(node,sld){var layer={userStyles:[],namedStyles:[]},i,len;for(this.readChildNodes(node,layer),i=0,len=layer.userStyles.length;i<len;++i)layer.userStyles[i].layerName=layer.name;OpenLayers.Util.isArray(sld.namedLayers)?sld.namedLayers.push(layer):sld.namedLayers[layer.name]=layer},NamedStyle:function(node,layer){layer.namedStyles.push(this.getChildName(node.firstChild))},UserStyle:function(node,layer){var obj={defaultsPerSymbolizer:!0,rules:[]},style;this.featureTypeCounter=-1;this.readChildNodes(node,obj);this.multipleSymbolizers?(delete obj.defaultsPerSymbolizer,style=new OpenLayers.Style2(obj)):style=new OpenLayers.Style(this.defaultSymbolizer,obj);layer.userStyles.push(style)},IsDefault:function(node,style){this.getChildValue(node)=="1"&&(style.isDefault=!0)},FeatureTypeStyle:function(node,style){++this.featureTypeCounter;var obj={rules:this.multipleSymbolizers?style.rules:[]};this.readChildNodes(node,obj);this.multipleSymbolizers||(style.rules=obj.rules)},Rule:function(node,obj){var config,rule;this.multipleSymbolizers&&(config={symbolizers:[]});rule=new OpenLayers.Rule(config);this.readChildNodes(node,rule);obj.rules.push(rule)},ElseFilter:function(node,rule){rule.elseFilter=!0},MinScaleDenominator:function(node,rule){rule.minScaleDenominator=parseFloat(this.getChildValue(node))},MaxScaleDenominator:function(node,rule){rule.maxScaleDenominator=parseFloat(this.getChildValue(node))},TextSymbolizer:function(node,rule){var config={};this.readChildNodes(node,config);this.multipleSymbolizers?(config.zIndex=this.featureTypeCounter,rule.symbolizers.push(new OpenLayers.Symbolizer.Text(config))):rule.symbolizer.Text=OpenLayers.Util.applyDefaults(config,rule.symbolizer.Text)},LabelPlacement:function(node,symbolizer){this.readChildNodes(node,symbolizer)},PointPlacement:function(node,symbolizer){var config={},labelAlign,x,y;this.readChildNodes(node,config);config.labelRotation=config.rotation;delete config.rotation;x=symbolizer.labelAnchorPointX;y=symbolizer.labelAnchorPointY;x<=1/3?labelAlign="l":x>1/3&&x<2/3?labelAlign="c":x>=2/3&&(labelAlign="r");y<=1/3?labelAlign+="b":y>1/3&&y<2/3?labelAlign+="m":y>=2/3&&(labelAlign+="t");config.labelAlign=labelAlign;OpenLayers.Util.applyDefaults(symbolizer,config)},AnchorPoint:function(node,symbolizer){this.readChildNodes(node,symbolizer)},AnchorPointX:function(node,symbolizer){var labelAnchorPointX=this.readers.ogc._expression.call(this,node);labelAnchorPointX&&(symbolizer.labelAnchorPointX=labelAnchorPointX)},AnchorPointY:function(node,symbolizer){var labelAnchorPointY=this.readers.ogc._expression.call(this,node);labelAnchorPointY&&(symbolizer.labelAnchorPointY=labelAnchorPointY)},Displacement:function(node,symbolizer){this.readChildNodes(node,symbolizer)},DisplacementX:function(node,symbolizer){var labelXOffset=this.readers.ogc._expression.call(this,node);labelXOffset&&(symbolizer.labelXOffset=labelXOffset)},DisplacementY:function(node,symbolizer){var labelYOffset=this.readers.ogc._expression.call(this,node);labelYOffset&&(symbolizer.labelYOffset=labelYOffset)},LinePlacement:function(node,symbolizer){this.readChildNodes(node,symbolizer)},PerpendicularOffset:function(node,symbolizer){var labelPerpendicularOffset=this.readers.ogc._expression.call(this,node);labelPerpendicularOffset&&(symbolizer.labelPerpendicularOffset=labelPerpendicularOffset)},Label:function(node,symbolizer){var value=this.readers.ogc._expression.call(this,node);value&&(symbolizer.label=value)},Font:function(node,symbolizer){this.readChildNodes(node,symbolizer)},Halo:function(node,symbolizer){var obj={};this.readChildNodes(node,obj);symbolizer.haloRadius=obj.haloRadius;symbolizer.haloColor=obj.fillColor;symbolizer.haloOpacity=obj.fillOpacity},Radius:function(node,symbolizer){var radius=this.readers.ogc._expression.call(this,node);radius!=null&&(symbolizer.haloRadius=radius)},RasterSymbolizer:function(node,rule){var config={};this.readChildNodes(node,config);this.multipleSymbolizers?(config.zIndex=this.featureTypeCounter,rule.symbolizers.push(new OpenLayers.Symbolizer.Raster(config))):rule.symbolizer.Raster=OpenLayers.Util.applyDefaults(config,rule.symbolizer.Raster)},Geometry:function(node,obj){obj.geometry={};this.readChildNodes(node,obj.geometry)},ColorMap:function(node,symbolizer){symbolizer.colorMap=[];this.readChildNodes(node,symbolizer.colorMap)},ColorMapEntry:function(node,colorMap){var q=node.getAttribute("quantity"),o=node.getAttribute("opacity");colorMap.push({color:node.getAttribute("color"),quantity:q!==null?parseFloat(q):undefined,label:node.getAttribute("label")||undefined,opacity:o!==null?parseFloat(o):undefined})},LineSymbolizer:function(node,rule){var config={};this.readChildNodes(node,config);this.multipleSymbolizers?(config.zIndex=this.featureTypeCounter,rule.symbolizers.push(new OpenLayers.Symbolizer.Line(config))):rule.symbolizer.Line=OpenLayers.Util.applyDefaults(config,rule.symbolizer.Line)},PolygonSymbolizer:function(node,rule){var config={fill:!1,stroke:!1};this.multipleSymbolizers||(config=rule.symbolizer.Polygon||config);this.readChildNodes(node,config);this.multipleSymbolizers?(config.zIndex=this.featureTypeCounter,rule.symbolizers.push(new OpenLayers.Symbolizer.Polygon(config))):rule.symbolizer.Polygon=config},PointSymbolizer:function(node,rule){var config={fill:!1,stroke:!1,graphic:!1};this.multipleSymbolizers||(config=rule.symbolizer.Point||config);this.readChildNodes(node,config);this.multipleSymbolizers?(config.zIndex=this.featureTypeCounter,rule.symbolizers.push(new OpenLayers.Symbolizer.Point(config))):rule.symbolizer.Point=config},Stroke:function(node,symbolizer){symbolizer.stroke=!0;this.readChildNodes(node,symbolizer)},Fill:function(node,symbolizer){symbolizer.fill=!0;this.readChildNodes(node,symbolizer)},CssParameter:function(node,symbolizer){var cssProperty=node.getAttribute("name"),symProperty=this.cssMap[cssProperty],value;symbolizer.label&&(cssProperty==="fill"?symProperty="fontColor":cssProperty==="fill-opacity"&&(symProperty="fontOpacity"));symProperty&&(value=this.readers.ogc._expression.call(this,node),value&&(symbolizer[symProperty]=value))},GraphicFill:function(node,symbolizer){symbolizer.pointRadius=null;this.readChildNodes(node,symbolizer)},Graphic:function(node,symbolizer){var graphic,properties,prop,value,i,len,pointRadius;for(symbolizer.graphic=!0,graphic={},this.readChildNodes(node,graphic),properties=["stroke","strokeColor","strokeWidth","strokeOpacity","strokeLinecap","fill","fillColor","fillOpacity","graphicName","rotation","graphicFormat"],i=0,len=properties.length;i<len;++i)prop=properties[i],value=graphic[prop],value!=undefined&&(symbolizer[prop]=value);graphic.opacity!=undefined&&(symbolizer.graphicOpacity=graphic.opacity);graphic.size!=undefined&&(pointRadius=graphic.size/2,isNaN(pointRadius)?symbolizer.graphicWidth=graphic.size:symbolizer.pointRadius=graphic.size/2);graphic.href!=undefined&&(symbolizer.externalGraphic=graphic.href);graphic.rotation!=undefined&&(symbolizer.rotation=graphic.rotation)},ExternalGraphic:function(node,graphic){this.readChildNodes(node,graphic)},Mark:function(node,graphic){this.readChildNodes(node,graphic)},WellKnownName:function(node,graphic){graphic.graphicName=this.getChildValue(node)},Opacity:function(node,obj){var opacity=this.readers.ogc._expression.call(this,node);opacity&&(obj.opacity=opacity)},Size:function(node,obj){var size=this.readers.ogc._expression.call(this,node);size&&(obj.size=size)},Rotation:function(node,obj){var rotation=this.readers.ogc._expression.call(this,node);rotation&&(obj.rotation=rotation)},OnlineResource:function(node,obj){obj.href=this.getAttributeNS(node,this.namespaces.xlink,"href")},Format:function(node,graphic){graphic.graphicFormat=this.getChildValue(node)}}},OpenLayers.Format.Filter.v1_0_0.prototype.readers),cssMap:{stroke:"strokeColor","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","stroke-linecap":"strokeLinecap","stroke-dasharray":"strokeDashstyle",fill:"fillColor","fill-opacity":"fillOpacity","font-family":"fontFamily","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle"},getCssProperty:function(sym){var css=null;for(var prop in this.cssMap)if(this.cssMap[prop]==sym){css=prop;break}return css},getGraphicFormat:function(href){var format;for(var key in this.graphicFormats)if(this.graphicFormats[key].test(href)){format=key;break}return format||this.defaultGraphicFormat},defaultGraphicFormat:"image/png",graphicFormats:{"image/jpeg":/\.jpe?g$/i,"image/gif":/\.gif$/i,"image/png":/\.png$/i},write:function(sld){return this.writers.sld.StyledLayerDescriptor.apply(this,[sld])},writers:OpenLayers.Util.applyDefaults({sld:{_OGCExpression:function(nodeName,value){var node=this.createElementNSPlus(nodeName),tokens=typeof value=="string"?value.split("${"):[value],item,last,i,len;for(node.appendChild(this.createTextNode(tokens[0])),i=1,len=tokens.length;i<len;i++)item=tokens[i],last=item.indexOf("}"),last>0?(this.writeNode("ogc:PropertyName",{property:item.substring(0,last)},node),node.appendChild(this.createTextNode(item.substring(++last)))):node.appendChild(this.createTextNode("${"+item));return node},StyledLayerDescriptor:function(sld){var root=this.createElementNSPlus("sld:StyledLayerDescriptor",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}}),i,len,name;if(root.setAttribute("xmlns:ogc",this.namespaces.ogc),root.setAttribute("xmlns:gml",this.namespaces.gml),sld.name&&this.writeNode("Name",sld.name,root),sld.title&&this.writeNode("Title",sld.title,root),sld.description&&this.writeNode("Abstract",sld.description,root),OpenLayers.Util.isArray(sld.namedLayers))for(i=0,len=sld.namedLayers.length;i<len;++i)this.writeNode("NamedLayer",sld.namedLayers[i],root);else for(name in sld.namedLayers)this.writeNode("NamedLayer",sld.namedLayers[name],root);return root},Name:function(name){return this.createElementNSPlus("sld:Name",{value:name})},Title:function(title){return this.createElementNSPlus("sld:Title",{value:title})},Abstract:function(description){return this.createElementNSPlus("sld:Abstract",{value:description})},NamedLayer:function(layer){var node=this.createElementNSPlus("sld:NamedLayer"),i,len;if(this.writeNode("Name",layer.name,node),layer.namedStyles)for(i=0,len=layer.namedStyles.length;i<len;++i)this.writeNode("NamedStyle",layer.namedStyles[i],node);if(layer.userStyles)for(i=0,len=layer.userStyles.length;i<len;++i)this.writeNode("UserStyle",layer.userStyles[i],node);return node},NamedStyle:function(name){var node=this.createElementNSPlus("sld:NamedStyle");return this.writeNode("Name",name,node),node},UserStyle:function(style){var node=this.createElementNSPlus("sld:UserStyle"),rulesByZ,zValues,rule,ruleMap,symbolizer,zIndex,clone,j,jj,rules,i,ii;if(style.name&&this.writeNode("Name",style.name,node),style.title&&this.writeNode("Title",style.title,node),style.description&&this.writeNode("Abstract",style.description,node),style.isDefault&&this.writeNode("IsDefault",style.isDefault,node),this.multipleSymbolizers&&style.rules){for(rulesByZ={0:[]},zValues=[0],i=0,ii=style.rules.length;i<ii;++i)if(rule=style.rules[i],rule.symbolizers){for(ruleMap={},j=0,jj=rule.symbolizers.length;j<jj;++j)symbolizer=rule.symbolizers[j],zIndex=symbolizer.zIndex,zIndex in ruleMap||(clone=rule.clone(),clone.symbolizers=[],ruleMap[zIndex]=clone),ruleMap[zIndex].symbolizers.push(symbolizer.clone());for(zIndex in ruleMap)zIndex in rulesByZ||(zValues.push(zIndex),rulesByZ[zIndex]=[]),rulesByZ[zIndex].push(ruleMap[zIndex])}else rulesByZ[0].push(rule.clone());for(zValues.sort(),i=0,ii=zValues.length;i<ii;++i)rules=rulesByZ[zValues[i]],rules.length>0&&(clone=style.clone(),clone.rules=rulesByZ[zValues[i]],this.writeNode("FeatureTypeStyle",clone,node))}else this.writeNode("FeatureTypeStyle",style,node);return node},IsDefault:function(bool){return this.createElementNSPlus("sld:IsDefault",{value:bool?"1":"0"})},FeatureTypeStyle:function(style){for(var node=this.createElementNSPlus("sld:FeatureTypeStyle"),i=0,len=style.rules.length;i<len;++i)this.writeNode("Rule",style.rules[i],node);return node},Rule:function(rule){var node=this.createElementNSPlus("sld:Rule"),type,symbolizer,ii,types,i,len;if(rule.name&&this.writeNode("Name",rule.name,node),rule.title&&this.writeNode("Title",rule.title,node),rule.description&&this.writeNode("Abstract",rule.description,node),rule.elseFilter?this.writeNode("ElseFilter",null,node):rule.filter&&this.writeNode("ogc:Filter",rule.filter,node),rule.minScaleDenominator!=undefined&&this.writeNode("MinScaleDenominator",rule.minScaleDenominator,node),rule.maxScaleDenominator!=undefined&&this.writeNode("MaxScaleDenominator",rule.maxScaleDenominator,node),this.multipleSymbolizers&&rule.symbolizers)for(i=0,ii=rule.symbolizers.length;i<ii;++i)symbolizer=rule.symbolizers[i],type=symbolizer.CLASS_NAME.split(".").pop(),this.writeNode(type+"Symbolizer",symbolizer,node);else for(types=OpenLayers.Style.SYMBOLIZER_PREFIXES,i=0,len=types.length;i<len;++i)type=types[i],symbolizer=rule.symbolizer[type],symbolizer&&this.writeNode(type+"Symbolizer",symbolizer,node);return node},ElseFilter:function(){return this.createElementNSPlus("sld:ElseFilter")},MinScaleDenominator:function(scale){return this.createElementNSPlus("sld:MinScaleDenominator",{value:scale})},MaxScaleDenominator:function(scale){return this.createElementNSPlus("sld:MaxScaleDenominator",{value:scale})},LineSymbolizer:function(symbolizer){var node=this.createElementNSPlus("sld:LineSymbolizer");return this.writeNode("Stroke",symbolizer,node),node},Stroke:function(symbolizer){var node=this.createElementNSPlus("sld:Stroke");return symbolizer.strokeColor!=undefined&&this.writeNode("CssParameter",{symbolizer:symbolizer,key:"strokeColor"},node),symbolizer.strokeOpacity!=undefined&&this.writeNode("CssParameter",{symbolizer:symbolizer,key:"strokeOpacity"},node),symbolizer.strokeWidth!=undefined&&this.writeNode("CssParameter",{symbolizer:symbolizer,key:"strokeWidth"},node),symbolizer.strokeDashstyle!=undefined&&symbolizer.strokeDashstyle!=="solid"&&this.writeNode("CssParameter",{symbolizer:symbolizer,key:"strokeDashstyle"},node),symbolizer.strokeLinecap!=undefined&&this.writeNode("CssParameter",{symbolizer:symbolizer,key:"strokeLinecap"},node),node},CssParameter:function(obj){return this.createElementNSPlus("sld:CssParameter",{attributes:{name:this.getCssProperty(obj.key)},value:obj.symbolizer[obj.key]})},TextSymbolizer:function(symbolizer){var node=this.createElementNSPlus("sld:TextSymbolizer");return symbolizer.label!=null&&this.writeNode("Label",symbolizer.label,node),(symbolizer.fontFamily!=null||symbolizer.fontSize!=null||symbolizer.fontWeight!=null||symbolizer.fontStyle!=null)&&this.writeNode("Font",symbolizer,node),(symbolizer.labelAnchorPointX!=null||symbolizer.labelAnchorPointY!=null||symbolizer.labelAlign!=null||symbolizer.labelXOffset!=null||symbolizer.labelYOffset!=null||symbolizer.labelRotation!=null||symbolizer.labelPerpendicularOffset!=null)&&this.writeNode("LabelPlacement",symbolizer,node),(symbolizer.haloRadius!=null||symbolizer.haloColor!=null||symbolizer.haloOpacity!=null)&&this.writeNode("Halo",symbolizer,node),(symbolizer.fontColor!=null||symbolizer.fontOpacity!=null)&&this.writeNode("Fill",{fillColor:symbolizer.fontColor,fillOpacity:symbolizer.fontOpacity},node),node},LabelPlacement:function(symbolizer){var node=this.createElementNSPlus("sld:LabelPlacement");return(symbolizer.labelAnchorPointX!=null||symbolizer.labelAnchorPointY!=null||symbolizer.labelAlign!=null||symbolizer.labelXOffset!=null||symbolizer.labelYOffset!=null||symbolizer.labelRotation!=null)&&symbolizer.labelPerpendicularOffset==null&&this.writeNode("PointPlacement",symbolizer,node),symbolizer.labelPerpendicularOffset!=null&&this.writeNode("LinePlacement",symbolizer,node),node},LinePlacement:function(symbolizer){var node=this.createElementNSPlus("sld:LinePlacement");return this.writeNode("PerpendicularOffset",symbolizer.labelPerpendicularOffset,node),node},PerpendicularOffset:function(value){return this.createElementNSPlus("sld:PerpendicularOffset",{value:value})},PointPlacement:function(symbolizer){var node=this.createElementNSPlus("sld:PointPlacement");return(symbolizer.labelAnchorPointX!=null||symbolizer.labelAnchorPointY!=null||symbolizer.labelAlign!=null)&&this.writeNode("AnchorPoint",symbolizer,node),(symbolizer.labelXOffset!=null||symbolizer.labelYOffset!=null)&&this.writeNode("Displacement",symbolizer,node),symbolizer.labelRotation!=null&&this.writeNode("Rotation",symbolizer.labelRotation,node),node},AnchorPoint:function(symbolizer){var node=this.createElementNSPlus("sld:AnchorPoint"),x=symbolizer.labelAnchorPointX,y=symbolizer.labelAnchorPointY,xAlign,yAlign;return x!=null&&this.writeNode("AnchorPointX",x,node),y!=null&&this.writeNode("AnchorPointY",y,node),x==null&&y==null&&(xAlign=symbolizer.labelAlign.substr(0,1),yAlign=symbolizer.labelAlign.substr(1,1),xAlign==="l"?x=0:xAlign==="c"?x=.5:xAlign==="r"&&(x=1),yAlign==="b"?y=0:yAlign==="m"?y=.5:yAlign==="t"&&(y=1),this.writeNode("AnchorPointX",x,node),this.writeNode("AnchorPointY",y,node)),node},AnchorPointX:function(value){return this.createElementNSPlus("sld:AnchorPointX",{value:value})},AnchorPointY:function(value){return this.createElementNSPlus("sld:AnchorPointY",{value:value})},Displacement:function(symbolizer){var node=this.createElementNSPlus("sld:Displacement");return symbolizer.labelXOffset!=null&&this.writeNode("DisplacementX",symbolizer.labelXOffset,node),symbolizer.labelYOffset!=null&&this.writeNode("DisplacementY",symbolizer.labelYOffset,node),node},DisplacementX:function(value){return this.createElementNSPlus("sld:DisplacementX",{value:value})},DisplacementY:function(value){return this.createElementNSPlus("sld:DisplacementY",{value:value})},Font:function(symbolizer){var node=this.createElementNSPlus("sld:Font");return symbolizer.fontFamily&&this.writeNode("CssParameter",{symbolizer:symbolizer,key:"fontFamily"},node),symbolizer.fontSize&&this.writeNode("CssParameter",{symbolizer:symbolizer,key:"fontSize"},node),symbolizer.fontWeight&&this.writeNode("CssParameter",{symbolizer:symbolizer,key:"fontWeight"},node),symbolizer.fontStyle&&this.writeNode("CssParameter",{symbolizer:symbolizer,key:"fontStyle"},node),node},Label:function(label){return this.writers.sld._OGCExpression.call(this,"sld:Label",label)},Halo:function(symbolizer){var node=this.createElementNSPlus("sld:Halo");return symbolizer.haloRadius&&this.writeNode("Radius",symbolizer.haloRadius,node),(symbolizer.haloColor||symbolizer.haloOpacity)&&this.writeNode("Fill",{fillColor:symbolizer.haloColor,fillOpacity:symbolizer.haloOpacity},node),node},Radius:function(value){return this.createElementNSPlus("sld:Radius",{value:value})},RasterSymbolizer:function(symbolizer){var node=this.createElementNSPlus("sld:RasterSymbolizer");return symbolizer.geometry&&this.writeNode("Geometry",symbolizer.geometry,node),symbolizer.opacity&&this.writeNode("Opacity",symbolizer.opacity,node),symbolizer.colorMap&&this.writeNode("ColorMap",symbolizer.colorMap,node),node},Geometry:function(geometry){var node=this.createElementNSPlus("sld:Geometry");return geometry.property&&this.writeNode("ogc:PropertyName",geometry,node),node},ColorMap:function(colorMap){for(var node=this.createElementNSPlus("sld:ColorMap"),i=0,len=colorMap.length;i<len;++i)this.writeNode("ColorMapEntry",colorMap[i],node);return node},ColorMapEntry:function(colorMapEntry){var node=this.createElementNSPlus("sld:ColorMapEntry"),a=colorMapEntry;return node.setAttribute("color",a.color),a.opacity!==undefined&&node.setAttribute("opacity",parseFloat(a.opacity)),a.quantity!==undefined&&node.setAttribute("quantity",parseFloat(a.quantity)),a.label!==undefined&&node.setAttribute("label",a.label),node},PolygonSymbolizer:function(symbolizer){var node=this.createElementNSPlus("sld:PolygonSymbolizer");return symbolizer.fill!==!1&&this.writeNode("Fill",symbolizer,node),symbolizer.stroke!==!1&&this.writeNode("Stroke",symbolizer,node),node},Fill:function(symbolizer){var node=this.createElementNSPlus("sld:Fill");return symbolizer.externalGraphic?this.writeNode("GraphicFill",symbolizer,node):(symbolizer.fillColor&&this.writeNode("CssParameter",{symbolizer:symbolizer,key:"fillColor"},node),symbolizer.fillOpacity!=null&&this.writeNode("CssParameter",{symbolizer:symbolizer,key:"fillOpacity"},node)),node},PointSymbolizer:function(symbolizer){var node=this.createElementNSPlus("sld:PointSymbolizer");return this.writeNode("Graphic",symbolizer,node),node},GraphicFill:function(symbolizer){var node=this.createElementNSPlus("sld:GraphicFill");return this.writeNode("Graphic",symbolizer,node),node},Graphic:function(symbolizer){var node=this.createElementNSPlus("sld:Graphic");return symbolizer.externalGraphic!=undefined?this.writeNode("ExternalGraphic",symbolizer,node):this.writeNode("Mark",symbolizer,node),symbolizer.graphicOpacity!=undefined&&this.writeNode("Opacity",symbolizer.graphicOpacity,node),symbolizer.pointRadius!=undefined?this.writeNode("Size",symbolizer.pointRadius*2,node):symbolizer.graphicWidth!=undefined&&this.writeNode("Size",symbolizer.graphicWidth,node),symbolizer.rotation!=undefined&&this.writeNode("Rotation",symbolizer.rotation,node),node},ExternalGraphic:function(symbolizer){var node=this.createElementNSPlus("sld:ExternalGraphic"),format;return this.writeNode("OnlineResource",symbolizer.externalGraphic,node),format=symbolizer.graphicFormat||this.getGraphicFormat(symbolizer.externalGraphic),this.writeNode("Format",format,node),node},Mark:function(symbolizer){var node=this.createElementNSPlus("sld:Mark");return symbolizer.graphicName&&this.writeNode("WellKnownName",symbolizer.graphicName,node),symbolizer.fill!==!1&&this.writeNode("Fill",symbolizer,node),symbolizer.stroke!==!1&&this.writeNode("Stroke",symbolizer,node),node},WellKnownName:function(name){return this.createElementNSPlus("sld:WellKnownName",{value:name})},Opacity:function(value){return this.createElementNSPlus("sld:Opacity",{value:value})},Size:function(value){return this.writers.sld._OGCExpression.call(this,"sld:Size",value)},Rotation:function(value){return this.createElementNSPlus("sld:Rotation",{value:value})},OnlineResource:function(href){return this.createElementNSPlus("sld:OnlineResource",{attributes:{"xlink:type":"simple","xlink:href":href}})},Format:function(format){return this.createElementNSPlus("sld:Format",{value:format})}}},OpenLayers.Format.Filter.v1_0_0.prototype.writers),CLASS_NAME:"OpenLayers.Format.SLD.v1"});OpenLayers.Format.SLD.v1_0_0=OpenLayers.Class(OpenLayers.Format.SLD.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sld http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd",CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0"});OpenLayers.Format.Context=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{layerOptions:null,layerParams:null,read:function(data,options){var context=OpenLayers.Format.XML.VersionedOGC.prototype.read.apply(this,arguments),map,mapOptions;return options&&options.map?(this.context=context,options.map instanceof OpenLayers.Map?map=this.mergeContextToMap(context,options.map):(mapOptions=options.map,(OpenLayers.Util.isElement(mapOptions)||typeof mapOptions=="string")&&(mapOptions={div:mapOptions}),map=this.contextToMap(context,mapOptions))):map=context,map},getLayerFromContext:function(layerContext){var i,len,options={queryable:layerContext.queryable,visibility:layerContext.visibility,maxExtent:layerContext.maxExtent,metadata:OpenLayers.Util.applyDefaults(layerContext.metadata,{styles:layerContext.styles,formats:layerContext.formats,abstract:layerContext.abstract,dataURL:layerContext.dataURL}),numZoomLevels:layerContext.numZoomLevels,units:layerContext.units,isBaseLayer:layerContext.isBaseLayer,opacity:layerContext.opacity,displayInLayerSwitcher:layerContext.displayInLayerSwitcher,singleTile:layerContext.singleTile,tileSize:layerContext.tileSize?new OpenLayers.Size(layerContext.tileSize.width,layerContext.tileSize.height):undefined,minScale:layerContext.minScale||layerContext.maxScaleDenominator,maxScale:layerContext.maxScale||layerContext.minScaleDenominator,srs:layerContext.srs,dimensions:layerContext.dimensions,metadataURL:layerContext.metadataURL},params,format,style,layer,service;if(this.layerOptions&&OpenLayers.Util.applyDefaults(options,this.layerOptions),params={layers:layerContext.name,transparent:layerContext.transparent,version:layerContext.version},layerContext.formats&&layerContext.formats.length>0)for(params.format=layerContext.formats[0].value,i=0,len=layerContext.formats.length;i<len;i++)if(format=layerContext.formats[i],format.current==!0){params.format=format.value;break}if(layerContext.styles&&layerContext.styles.length>0)for(i=0,len=layerContext.styles.length;i<len;i++)if(style=layerContext.styles[i],style.current==!0){style.href?params.sld=style.href:style.body?params.sld_body=style.body:params.styles=style.name;break}return this.layerParams&&OpenLayers.Util.applyDefaults(params,this.layerParams),layer=null,service=layerContext.service,service==OpenLayers.Format.Context.serviceTypes.WFS?(options.strategies=[new OpenLayers.Strategy.BBOX],options.protocol=new OpenLayers.Protocol.WFS({url:layerContext.url,featurePrefix:layerContext.name.split(":")[0],featureType:layerContext.name.split(":").pop()}),layer=new OpenLayers.Layer.Vector(layerContext.title||layerContext.name,options)):service==OpenLayers.Format.Context.serviceTypes.KML?(options.strategies=[new OpenLayers.Strategy.Fixed],options.protocol=new OpenLayers.Protocol.HTTP({url:layerContext.url,format:new OpenLayers.Format.KML}),layer=new OpenLayers.Layer.Vector(layerContext.title||layerContext.name,options)):service==OpenLayers.Format.Context.serviceTypes.GML?(options.strategies=[new OpenLayers.Strategy.Fixed],options.protocol=new OpenLayers.Protocol.HTTP({url:layerContext.url,format:new OpenLayers.Format.GML}),layer=new OpenLayers.Layer.Vector(layerContext.title||layerContext.name,options)):layerContext.features?(layer=new OpenLayers.Layer.Vector(layerContext.title||layerContext.name,options),layer.addFeatures(layerContext.features)):layerContext.categoryLayer!==!0&&(layer=new OpenLayers.Layer.WMS(layerContext.title||layerContext.name,layerContext.url,params,options)),layer},getLayersFromContext:function(layersContext){for(var layer,layers=[],i=0,len=layersContext.length;i<len;i++)layer=this.getLayerFromContext(layersContext[i]),layer!==null&&layers.push(layer);return layers},contextToMap:function(context,options){var metadata,map;return options=OpenLayers.Util.applyDefaults({maxExtent:context.maxExtent,projection:context.projection,units:context.units},options),options.maxExtent&&(options.maxResolution=options.maxExtent.getWidth()/OpenLayers.Map.TILE_WIDTH),metadata={contactInformation:context.contactInformation,abstract:context.abstract,keywords:context.keywords,logo:context.logo,descriptionURL:context.descriptionURL},options.metadata=metadata,map=new OpenLayers.Map(options),map.addLayers(this.getLayersFromContext(context.layersContext)),map.setCenter(context.bounds.getCenterLonLat(),map.getZoomForExtent(context.bounds,!0)),map},mergeContextToMap:function(context,map){return map.addLayers(this.getLayersFromContext(context.layersContext)),map},write:function(obj){return obj=this.toContext(obj),OpenLayers.Format.XML.VersionedOGC.prototype.write.apply(this,arguments)},CLASS_NAME:"OpenLayers.Format.Context"});OpenLayers.Format.Context.serviceTypes={WMS:"urn:ogc:serviceType:WMS",WFS:"urn:ogc:serviceType:WFS",WCS:"urn:ogc:serviceType:WCS",GML:"urn:ogc:serviceType:GML",SLD:"urn:ogc:serviceType:SLD",FES:"urn:ogc:serviceType:FES",KML:"urn:ogc:serviceType:KML"};OpenLayers.Format.OWSContext=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"0.3.1",getVersion:function(){var version=OpenLayers.Format.XML.VersionedOGC.prototype.getVersion.apply(this,arguments);return version==="0.3.0"&&(version=this.defaultVersion),version},toContext:function(obj){var context={};return obj.CLASS_NAME=="OpenLayers.Map"&&(context.bounds=obj.getExtent(),context.maxExtent=obj.maxExtent,context.projection=obj.projection,context.size=obj.getSize(),context.layers=obj.layers),context},CLASS_NAME:"OpenLayers.Format.OWSContext"});OpenLayers.Format.OWSCommon=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",getVersion:function(root){var version=this.version,uri;return version||(uri=root.getAttribute("xmlns:ows"),uri&&uri.substring(uri.lastIndexOf("/")+1)==="1.1"&&(version="1.1.0"),version||(version=this.defaultVersion)),version},CLASS_NAME:"OpenLayers.Format.OWSCommon"});OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(data,options){options=OpenLayers.Util.applyDefaults(options,this.options);var ows={};return this.readChildNodes(data,ows),ows},readers:{ows:{Exception:function(node,exceptionReport){var exception={code:node.getAttribute("exceptionCode"),locator:node.getAttribute("locator"),texts:[]};exceptionReport.exceptions.push(exception);this.readChildNodes(node,exception)},ExceptionText:function(node,exception){var text=this.getChildValue(node);exception.texts.push(text)},ServiceIdentification:function(node,obj){obj.serviceIdentification={};this.readChildNodes(node,obj.serviceIdentification)},Title:function(node,obj){obj.title=this.getChildValue(node)},Abstract:function(node,serviceIdentification){serviceIdentification.abstract=this.getChildValue(node)},Keywords:function(node,serviceIdentification){serviceIdentification.keywords={};this.readChildNodes(node,serviceIdentification.keywords)},Keyword:function(node,keywords){keywords[this.getChildValue(node)]=!0},ServiceType:function(node,serviceIdentification){serviceIdentification.serviceType={codeSpace:node.getAttribute("codeSpace"),value:this.getChildValue(node)}},ServiceTypeVersion:function(node,serviceIdentification){serviceIdentification.serviceTypeVersion=this.getChildValue(node)},Fees:function(node,serviceIdentification){serviceIdentification.fees=this.getChildValue(node)},AccessConstraints:function(node,serviceIdentification){serviceIdentification.accessConstraints=this.getChildValue(node)},ServiceProvider:function(node,obj){obj.serviceProvider={};this.readChildNodes(node,obj.serviceProvider)},ProviderName:function(node,serviceProvider){serviceProvider.providerName=this.getChildValue(node)},ProviderSite:function(node,serviceProvider){serviceProvider.providerSite=this.getAttributeNS(node,this.namespaces.xlink,"href")},ServiceContact:function(node,serviceProvider){serviceProvider.serviceContact={};this.readChildNodes(node,serviceProvider.serviceContact)},IndividualName:function(node,serviceContact){serviceContact.individualName=this.getChildValue(node)},PositionName:function(node,serviceContact){serviceContact.positionName=this.getChildValue(node)},ContactInfo:function(node,serviceContact){serviceContact.contactInfo={};this.readChildNodes(node,serviceContact.contactInfo)},Phone:function(node,contactInfo){contactInfo.phone={};this.readChildNodes(node,contactInfo.phone)},Voice:function(node,phone){phone.voice=this.getChildValue(node)},Address:function(node,contactInfo){contactInfo.address={};this.readChildNodes(node,contactInfo.address)},DeliveryPoint:function(node,address){address.deliveryPoint=this.getChildValue(node)},City:function(node,address){address.city=this.getChildValue(node)},AdministrativeArea:function(node,address){address.administrativeArea=this.getChildValue(node)},PostalCode:function(node,address){address.postalCode=this.getChildValue(node)},Country:function(node,address){address.country=this.getChildValue(node)},ElectronicMailAddress:function(node,address){address.electronicMailAddress=this.getChildValue(node)},Role:function(node,serviceContact){serviceContact.role=this.getChildValue(node)},OperationsMetadata:function(node,obj){obj.operationsMetadata={};this.readChildNodes(node,obj.operationsMetadata)},Operation:function(node,operationsMetadata){var name=node.getAttribute("name");operationsMetadata[name]={};this.readChildNodes(node,operationsMetadata[name])},DCP:function(node,operation){operation.dcp={};this.readChildNodes(node,operation.dcp)},HTTP:function(node,dcp){dcp.http={};this.readChildNodes(node,dcp.http)},Get:function(node,http){http.get||(http.get=[]);var obj={url:this.getAttributeNS(node,this.namespaces.xlink,"href")};this.readChildNodes(node,obj);http.get.push(obj)},Post:function(node,http){http.post||(http.post=[]);var obj={url:this.getAttributeNS(node,this.namespaces.xlink,"href")};this.readChildNodes(node,obj);http.post.push(obj)},Parameter:function(node,operation){operation.parameters||(operation.parameters={});var name=node.getAttribute("name");operation.parameters[name]={};this.readChildNodes(node,operation.parameters[name])},Constraint:function(node,obj){obj.constraints||(obj.constraints={});var name=node.getAttribute("name");obj.constraints[name]={};this.readChildNodes(node,obj.constraints[name])},Value:function(node,allowedValues){allowedValues[this.getChildValue(node)]=!0},OutputFormat:function(node,obj){obj.formats.push({value:this.getChildValue(node)});this.readChildNodes(node,obj)},WGS84BoundingBox:function(node,obj){var boundingBox={};boundingBox.crs=node.getAttribute("crs");obj.BoundingBox?obj.BoundingBox.push(boundingBox):(obj.projection=boundingBox.crs,boundingBox=obj);this.readChildNodes(node,boundingBox)},BoundingBox:function(node,obj){this.readers.ows.WGS84BoundingBox.apply(this,[node,obj])},LowerCorner:function(node,obj){var str=this.getChildValue(node).replace(this.regExes.trimSpace,""),pointList;str=str.replace(this.regExes.trimComma,",");pointList=str.split(this.regExes.splitSpace);obj.left=pointList[0];obj.bottom=pointList[1]},UpperCorner:function(node,obj){var str=this.getChildValue(node).replace(this.regExes.trimSpace,""),pointList;str=str.replace(this.regExes.trimComma,",");pointList=str.split(this.regExes.splitSpace);obj.right=pointList[0];obj.top=pointList[1];obj.bounds=new OpenLayers.Bounds(obj.left,obj.bottom,obj.right,obj.top);delete obj.left;delete obj.bottom;delete obj.right;delete obj.top},Language:function(node,obj){obj.language=this.getChildValue(node)}}},writers:{ows:{BoundingBox:function(options,nodeName){var node=this.createElementNSPlus(nodeName||"ows:BoundingBox",{attributes:{crs:options.projection}});return this.writeNode("ows:LowerCorner",options,node),this.writeNode("ows:UpperCorner",options,node),node},LowerCorner:function(options){return this.createElementNSPlus("ows:LowerCorner",{value:options.bounds.left+" "+options.bounds.bottom})},UpperCorner:function(options){return this.createElementNSPlus("ows:UpperCorner",{value:options.bounds.right+" "+options.bounds.top})},Identifier:function(identifier){return this.createElementNSPlus("ows:Identifier",{value:identifier})},Title:function(title){return this.createElementNSPlus("ows:Title",{value:title})},Abstract:function(abstractValue){return this.createElementNSPlus("ows:Abstract",{value:abstractValue})},OutputFormat:function(format){return this.createElementNSPlus("ows:OutputFormat",{value:format})}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"});OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(node,obj){obj.success=!1;obj.exceptionReport={version:node.getAttribute("version"),language:node.getAttribute("language"),exceptions:[]};this.readChildNodes(node,obj.exceptionReport)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_0_0"});OpenLayers.Format.OWSContext.v0_3_1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{owc:"http://www.opengis.net/ows-context",gml:"http://www.opengis.net/gml",kml:"http://www.opengis.net/kml/2.2",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},VERSION:"0.3.1",schemaLocation:"http://www.opengis.net/ows-context http://www.ogcnetwork.net/schemas/owc/0.3.1/owsContext.xsd",defaultPrefix:"owc",extractAttributes:!0,xy:!0,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},featureNS:"http://mapserver.gis.umn.edu/mapserver",featureType:"vector",geometryName:"geometry",nestingLayerLookup:null,initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options]);OpenLayers.Format.GML.v2.prototype.setGeometryTypes.call(this)},setNestingPath:function(l){var i,len;if(l.layersContext)for(i=0,len=l.layersContext.length;i<len;i++){var layerContext=l.layersContext[i],nPath=[],nTitle=l.title||"";l.metadata&&l.metadata.nestingPath&&(nPath=l.metadata.nestingPath.slice());nTitle!=""&&nPath.push(nTitle);layerContext.metadata.nestingPath=nPath;layerContext.layersContext&&this.setNestingPath(layerContext)}},decomposeNestingPath:function(nPath){var a=[],path;if(OpenLayers.Util.isArray(nPath)){for(path=nPath.slice();path.length>0;)a.push(path.slice()),path.pop();a.reverse()}return a},read:function(data){var context,layers;return typeof data=="string"&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data])),data&&data.nodeType==9&&(data=data.documentElement),context={},this.readNode(data,context),this.setNestingPath({layersContext:context.layersContext}),layers=[],this.processLayer(layers,context),delete context.layersContext,context.layersContext=layers,context},processLayer:function(layerArray,layer){var i,len,l;if(layer.layersContext)for(i=0,len=layer.layersContext.length;i<len;i++)l=layer.layersContext[i],layerArray.push(l),l.layersContext&&this.processLayer(layerArray,l)},write:function(context,options){var root;return this.nestingLayerLookup={},options=options||{},OpenLayers.Util.applyDefaults(options,context),root=this.writeNode("OWSContext",options),this.nestingLayerLookup=null,this.setAttributeNS(root,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[root])},readers:{kml:{Document:function(node,obj){obj.features=new OpenLayers.Format.KML({kmlns:this.namespaces.kml,extractStyles:!0}).read(node)}},owc:{OWSContext:function(node,obj){this.readChildNodes(node,obj)},General:function(node,obj){this.readChildNodes(node,obj)},ResourceList:function(node,obj){this.readChildNodes(node,obj)},Layer:function(node,obj){var layerContext={metadata:{},visibility:node.getAttribute("hidden")!="1",queryable:node.getAttribute("queryable")=="1",opacity:node.getAttribute("opacity")!=null?parseFloat(node.getAttribute("opacity")):null,name:node.getAttribute("name"),categoryLayer:node.getAttribute("name")==null,formats:[],styles:[]};obj.layersContext||(obj.layersContext=[]);obj.layersContext.push(layerContext);this.readChildNodes(node,layerContext)},InlineGeometry:function(node,obj){var elements,el,featurenode;obj.features=[];elements=this.getElementsByTagNameNS(node,this.namespaces.gml,"featureMember");elements.length>=1&&(el=elements[0]);el&&el.firstChild&&(featurenode=el.firstChild.nextSibling?el.firstChild.nextSibling:el.firstChild,this.setNamespace("feature",featurenode.namespaceURI),this.featureType=featurenode.localName||featurenode.nodeName.split(":").pop(),this.readChildNodes(node,obj))},Server:function(node,obj){(obj.service||obj.version)&&obj.service==OpenLayers.Format.Context.serviceTypes.WMS||(obj.service=node.getAttribute("service"),obj.version=node.getAttribute("version"),this.readChildNodes(node,obj))},Name:function(node,obj){obj.name=this.getChildValue(node);this.readChildNodes(node,obj)},Title:function(node,obj){obj.title=this.getChildValue(node);this.readChildNodes(node,obj)},StyleList:function(node,obj){this.readChildNodes(node,obj.styles)},Style:function(node,obj){var style={};obj.push(style);this.readChildNodes(node,style)},LegendURL:function(node,obj){var legend={};obj.legend=legend;this.readChildNodes(node,legend)},OnlineResource:function(node,obj){obj.url=this.getAttributeNS(node,this.namespaces.xlink,"href");this.readChildNodes(node,obj)}},ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows,gml:OpenLayers.Format.GML.v2.prototype.readers.gml,sld:OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{owc:{OWSContext:function(options){var node=this.createElementNSPlus("OWSContext",{attributes:{version:this.VERSION,id:options.id||OpenLayers.Util.createUniqueID("OpenLayers_OWSContext_")}});return this.writeNode("General",options,node),this.writeNode("ResourceList",options,node),node},General:function(options){var node=this.createElementNSPlus("General");return this.writeNode("ows:BoundingBox",options,node),this.writeNode("ows:Title",options.title||"OpenLayers OWSContext",node),node},ResourceList:function(options){for(var layer,decomposedPath,node=this.createElementNSPlus("ResourceList"),i=0,len=options.layers.length;i<len;i++)layer=options.layers[i],decomposedPath=this.decomposeNestingPath(layer.metadata.nestingPath),this.writeNode("_Layer",{layer:layer,subPaths:decomposedPath},node);return node},Server:function(options){var node=this.createElementNSPlus("Server",{attributes:{version:options.version,service:options.service}});return this.writeNode("OnlineResource",options,node),node},OnlineResource:function(options){return this.createElementNSPlus("OnlineResource",{attributes:{"xlink:href":options.url}})},InlineGeometry:function(layer){var node=this.createElementNSPlus("InlineGeometry"),i,len;for(this.writeNode("gml:boundedBy",layer.getDataExtent(),node),i=0,len=layer.features.length;i<len;i++)this.writeNode("gml:featureMember",layer.features[i],node);return node},StyleList:function(styles){for(var node=this.createElementNSPlus("StyleList"),i=0,len=styles.length;i<len;i++)this.writeNode("Style",styles[i],node);return node},Style:function(style){var node=this.createElementNSPlus("Style");return this.writeNode("Name",style,node),this.writeNode("Title",style,node),style.legend&&this.writeNode("LegendURL",style,node),node},Name:function(obj){return this.createElementNSPlus("Name",{value:obj.name})},Title:function(obj){return this.createElementNSPlus("Title",{value:obj.title})},LegendURL:function(style){var node=this.createElementNSPlus("LegendURL");return this.writeNode("OnlineResource",style.legend,node),node},_WMS:function(layer){var node=this.createElementNSPlus("Layer",{attributes:{name:layer.params.LAYERS,queryable:layer.queryable?"1":"0",hidden:layer.visibility?"0":"1",opacity:layer.hasOwnProperty("opacity")?layer.opacity:null}});return this.writeNode("ows:Title",layer.name,node),this.writeNode("ows:OutputFormat",layer.params.FORMAT,node),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WMS,version:layer.params.VERSION,url:layer.url},node),layer.metadata.styles&&layer.metadata.styles.length>0&&this.writeNode("StyleList",layer.metadata.styles,node),node},_Layer:function(options){var layer,subPaths,node,title,path,index;return layer=options.layer,subPaths=options.subPaths,node=null,title=null,subPaths.length>0?(path=subPaths[0].join("/"),index=path.lastIndexOf("/"),node=this.nestingLayerLookup[path],title=index>0?path.substring(index+1,path.length):path,node||(node=this.createElementNSPlus("Layer"),this.writeNode("ows:Title",title,node),this.nestingLayerLookup[path]=node),options.subPaths.shift(),this.writeNode("_Layer",options,node),node):(layer instanceof OpenLayers.Layer.WMS?node=this.writeNode("_WMS",layer):layer instanceof OpenLayers.Layer.Vector&&(layer.protocol instanceof OpenLayers.Protocol.WFS.v1?node=this.writeNode("_WFS",layer):layer.protocol instanceof OpenLayers.Protocol.HTTP?layer.protocol.format instanceof OpenLayers.Format.GML?(layer.protocol.format.version="2.1.2",node=this.writeNode("_GML",layer)):layer.protocol.format instanceof OpenLayers.Format.KML&&(layer.protocol.format.version="2.2",node=this.writeNode("_KML",layer)):(this.setNamespace("feature",this.featureNS),node=this.writeNode("_InlineGeometry",layer))),layer.options.maxScale&&this.writeNode("sld:MinScaleDenominator",layer.options.maxScale,node),layer.options.minScale&&this.writeNode("sld:MaxScaleDenominator",layer.options.minScale,node),this.nestingLayerLookup[layer.name]=node,node)},_WFS:function(layer){var node=this.createElementNSPlus("Layer",{attributes:{name:layer.protocol.featurePrefix+":"+layer.protocol.featureType,hidden:layer.visibility?"0":"1"}});return this.writeNode("ows:Title",layer.name,node),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WFS,version:layer.protocol.version,url:layer.protocol.url},node),node},_InlineGeometry:function(layer){var node=this.createElementNSPlus("Layer",{attributes:{name:this.featureType,hidden:layer.visibility?"0":"1"}});return this.writeNode("ows:Title",layer.name,node),this.writeNode("InlineGeometry",layer,node),node},_GML:function(layer){var node=this.createElementNSPlus("Layer");return this.writeNode("ows:Title",layer.name,node),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.GML,url:layer.protocol.url,version:layer.protocol.format.version},node),node},_KML:function(layer){var node=this.createElementNSPlus("Layer");return this.writeNode("ows:Title",layer.name,node),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.KML,version:layer.protocol.format.version,url:layer.protocol.url},node),node}},gml:OpenLayers.Util.applyDefaults({boundedBy:function(bounds){var node=this.createElementNSPlus("gml:boundedBy");return this.writeNode("gml:Box",bounds,node),node}},OpenLayers.Format.GML.v2.prototype.writers.gml),ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.writers.ows,sld:OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},CLASS_NAME:"OpenLayers.Format.OWSContext.v0_3_1"});OpenLayers.Format.CSWGetRecords=function(options){options=OpenLayers.Util.applyDefaults(options,OpenLayers.Format.CSWGetRecords.DEFAULTS);var cls=OpenLayers.Format.CSWGetRecords["v"+options.version.replace(/\./g,"_")];if(!cls)throw"Unsupported CSWGetRecords version: "+options.version;return new cls(options)};OpenLayers.Format.CSWGetRecords.DEFAULTS={version:"2.0.2"};OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:!1,displayClass:"",title:"",autoActivate:!1,active:null,handlerOptions:null,handler:null,eventListeners:null,events:null,initialize:function(options){if(this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,""),OpenLayers.Util.extend(this,options),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object)this.events.on(this.eventListeners);this.id==null&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"))},destroy:function(){if(this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.events=null),this.eventListeners=null,this.handler&&(this.handler.destroy(),this.handler=null),this.handlers){for(var key in this.handlers)this.handlers.hasOwnProperty(key)&&typeof this.handlers[key].destroy=="function"&&this.handlers[key].destroy();this.handlers=null}this.map&&(this.map.removeControl(this),this.map=null);this.div=null},setMap:function(map){this.map=map;this.handler&&this.handler.setMap(map)},draw:function(px){return this.div==null&&(this.div=OpenLayers.Util.createDiv(this.id),this.div.className=this.displayClass,this.allowSelection||(this.div.className+=" olControlNoSelect",this.div.setAttribute("unselectable","on",0),this.div.onselectstart=OpenLayers.Function.False),this.title!=""&&(this.div.title=this.title)),px!=null&&(this.position=px.clone()),this.moveTo(this.position),this.div},moveTo:function(px){px!=null&&this.div!=null&&(this.div.style.left=px.x+"px",this.div.style.top=px.y+"px")},activate:function(){return this.active?!1:(this.handler&&this.handler.activate(),this.active=!0,this.map&&OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("activate"),!0)},deactivate:function(){return this.active?(this.handler&&this.handler.deactivate(),this.active=!1,this.map&&OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("deactivate"),!0):!1},CLASS_NAME:"OpenLayers.Control"});OpenLayers.Control.TYPE_BUTTON=1;OpenLayers.Control.TYPE_TOGGLE=2;OpenLayers.Control.TYPE_TOOL=3;OpenLayers.Events.buttonclick=OpenLayers.Class({target:null,events:["mousedown","mouseup","click","dblclick","touchstart","touchmove","touchend","keydown"],startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,initialize:function(target){this.target=target;for(var i=this.events.length-1;i>=0;--i)this.target.register(this.events[i],this,this.buttonClick,{extension:!0})},destroy:function(){for(var i=this.events.length-1;i>=0;--i)this.target.unregister(this.events[i],this,this.buttonClick);delete this.target},getPressedButton:function(element){var depth=3,button;do{if(OpenLayers.Element.hasClass(element,"olButton")){button=element;break}element=element.parentNode}while(--depth>0&&element);return button},ignore:function(element){var depth=3,ignore=!1;do{if(element.nodeName.toLowerCase()==="a"){ignore=!0;break}element=element.parentNode}while(--depth>0&&element);return ignore},buttonClick:function(evt){var propagate=!0,element=OpenLayers.Event.element(evt),button,pos;if(element&&(OpenLayers.Event.isLeftClick(evt)||!~evt.type.indexOf("mouse")))if(button=this.getPressedButton(element),button){if(evt.type==="keydown")switch(evt.keyCode){case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",{buttonElement:button});OpenLayers.Event.stop(evt);propagate=!1}else this.startEvt&&(this.completeRegEx.test(evt.type)&&(pos=OpenLayers.Util.pagePosition(button),this.target.triggerEvent("buttonclick",{buttonElement:button,buttonXY:{x:this.startEvt.clientX-pos[0],y:this.startEvt.clientY-pos[1]}})),this.cancelRegEx.test(evt.type)&&delete this.startEvt,OpenLayers.Event.stop(evt),propagate=!1);this.startRegEx.test(evt.type)&&(this.startEvt=evt,OpenLayers.Event.stop(evt),propagate=!1)}else propagate=!this.ignore(OpenLayers.Event.element(evt)),delete this.startEvt;return propagate}});OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.vendorPrefix=function(){"use strict";function domToCss(prefixedDom){return prefixedDom?prefixedDom.replace(/([A-Z])/g,function(c){return"-"+c.toLowerCase()}).replace(/^ms-/,"-ms-"):null}function css(property){if(cssCache[property]===undefined){var domProperty=property.replace(/(-[\s\S])/g,function(c){return c.charAt(1).toUpperCase()}),prefixedDom=style(domProperty);cssCache[property]=domToCss(prefixedDom)}return cssCache[property]}function js(obj,property){if(jsCache[property]===undefined){var tmpProp,i=0,l=VENDOR_PREFIXES.length,prefix,isStyleObj=typeof obj.cssText!="undefined";for(jsCache[property]=null;i<l;i++)if(prefix=VENDOR_PREFIXES[i],prefix?(isStyleObj||(prefix=prefix.toLowerCase()),tmpProp=prefix+property.charAt(0).toUpperCase()+property.slice(1)):tmpProp=property,obj[tmpProp]!==undefined){jsCache[property]=tmpProp;break}}return jsCache[property]}function style(property){return js(divStyle,property)}var VENDOR_PREFIXES=["","O","ms","Moz","Webkit"],divStyle=document.createElement("div").style,cssCache={},jsCache={};return{css:css,js:js,style:style,cssCache:cssCache,jsCache:jsCache}}();OpenLayers.Animation=function(window){function start(callback,duration,element){duration=duration>0?duration:Number.POSITIVE_INFINITY;var id=++counter,start=+new Date;return loops[id]=function(){loops[id]&&+new Date-start<=duration?(callback(),loops[id]&&requestFrame(loops[id],element)):delete loops[id]},requestFrame(loops[id],element),id}function stop(id){delete loops[id]}var requestAnimationFrame=OpenLayers.Util.vendorPrefix.js(window,"requestAnimationFrame"),isNative=!!requestAnimationFrame,requestFrame=function(){var request=window[requestAnimationFrame]||function(callback){window.setTimeout(callback,16)};return function(callback,element){request.apply(window,[callback,element])}}(),counter=0,loops={};return{isNative:isNative,requestFrame:requestFrame,start:start,stop:stop}}(window);OpenLayers.Tween=OpenLayers.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,animationId:null,playing:!1,initialize:function(easing){this.easing=easing?easing:OpenLayers.Easing.Expo.easeOut},start:function(begin,finish,duration,options){this.playing=!0;this.begin=begin;this.finish=finish;this.duration=duration;this.callbacks=options.callbacks;this.time=0;OpenLayers.Animation.stop(this.animationId);this.animationId=null;this.callbacks&&this.callbacks.start&&this.callbacks.start.call(this,this.begin);this.animationId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.play,this))},stop:function(){this.playing&&(this.callbacks&&this.callbacks.done&&this.callbacks.done.call(this,this.finish),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.playing=!1)},play:function(){var value={},i,b,f,c;for(i in this.begin){if(b=this.begin[i],f=this.finish[i],b==null||f==null||isNaN(b)||isNaN(f))throw new TypeError("invalid value for Tween");c=f-b;value[i]=this.easing.apply(this,[this.time,b,c,this.duration])}this.time++;this.callbacks&&this.callbacks.eachStep&&this.callbacks.eachStep.call(this,value);this.time>this.duration&&this.stop()},CLASS_NAME:"OpenLayers.Tween"});OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"};OpenLayers.Easing.Linear={easeIn:function(t,b,c,d){return c*t/d+b},easeOut:function(t,b,c,d){return c*t/d+b},easeInOut:function(t,b,c,d){return c*t/d+b},CLASS_NAME:"OpenLayers.Easing.Linear"};OpenLayers.Easing.Expo={easeIn:function(t,b,c,d){return t==0?b:c*Math.pow(2,10*(t/d-1))+b},easeOut:function(t,b,c,d){return t==d?b+c:c*(-Math.pow(2,-10*t/d)+1)+b},easeInOut:function(t,b,c,d){return t==0?b:t==d?b+c:(t/=d/2)<1?c/2*Math.pow(2,10*(t-1))+b:c/2*(-Math.pow(2,-10*--t)+2)+b},CLASS_NAME:"OpenLayers.Easing.Expo"};OpenLayers.Easing.Quad={easeIn:function(t,b,c,d){return c*(t/=d)*t+b},easeOut:function(t,b,c,d){return-c*(t/=d)*(t-2)+b},easeInOut:function(t,b,c,d){return(t/=d/2)<1?c/2*t*t+b:-c/2*(--t*(t-2)-1)+b},CLASS_NAME:"OpenLayers.Easing.Quad"};OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1e3},id:null,fractionalZoom:!1,events:null,allOverlays:!1,div:null,dragging:!1,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:!0,autoUpdateSize:!0,panTween:null,eventListeners:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,paddingForPopups:null,layerContainerOriginPx:null,minPx:null,maxPx:null,initialize:function(div,options){var projCode,id,addNode,nodes,cssNode,i,len;if(arguments.length===1&&typeof div=="object"&&(options=div,div=options&&options.div),this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT),this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15),this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css",this.options=OpenLayers.Util.extend({},options),OpenLayers.Util.extend(this,options),projCode=this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection,OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[projCode]),!this.maxExtent||this.maxExtent instanceof OpenLayers.Bounds||(this.maxExtent=new OpenLayers.Bounds(this.maxExtent)),!this.minExtent||this.minExtent instanceof OpenLayers.Bounds||(this.minExtent=new OpenLayers.Bounds(this.minExtent)),!this.restrictedExtent||this.restrictedExtent instanceof OpenLayers.Bounds||(this.restrictedExtent=new OpenLayers.Bounds(this.restrictedExtent)),!this.center||this.center instanceof OpenLayers.LonLat||(this.center=new OpenLayers.LonLat(this.center)),this.layers=[],this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_"),this.div=OpenLayers.Util.getElement(div),this.div||(this.div=document.createElement("div"),this.div.style.height="1px",this.div.style.width="1px"),OpenLayers.Element.addClass(this.div,"olMap"),id=this.id+"_OpenLayers_ViewPort",this.viewPortDiv=OpenLayers.Util.createDiv(id,null,null,null,"relative",null,"hidden"),this.viewPortDiv.style.width="100%",this.viewPortDiv.style.height="100%",this.viewPortDiv.className="olMapViewport",this.div.appendChild(this.viewPortDiv),this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:!0}),id=this.id+"_OpenLayers_Container",this.layerContainerDiv=OpenLayers.Util.createDiv(id),this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1,this.layerContainerOriginPx={x:0,y:0},this.viewPortDiv.appendChild(this.layerContainerDiv),this.updateSize(),this.eventListeners instanceof Object)this.events.on(this.eventListeners);if(this.autoUpdateSize===!0&&(this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this),OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)),this.theme){for(addNode=!0,nodes=document.getElementsByTagName("link"),i=0,len=nodes.length;i<len;++i)if(OpenLayers.Util.isEquivalentUrl(nodes.item(i).href,this.theme)){addNode=!1;break}addNode&&(cssNode=document.createElement("link"),cssNode.setAttribute("rel","stylesheet"),cssNode.setAttribute("type","text/css"),cssNode.setAttribute("href",this.theme),document.getElementsByTagName("head")[0].appendChild(cssNode))}for(this.controls==null&&(this.controls=[],OpenLayers.Control!=null&&(OpenLayers.Control.Navigation?this.controls.push(new OpenLayers.Control.Navigation):OpenLayers.Control.TouchNavigation&&this.controls.push(new OpenLayers.Control.TouchNavigation),OpenLayers.Control.Zoom?this.controls.push(new OpenLayers.Control.Zoom):OpenLayers.Control.PanZoom&&this.controls.push(new OpenLayers.Control.PanZoom),OpenLayers.Control.ArgParser&&this.controls.push(new OpenLayers.Control.ArgParser),OpenLayers.Control.Attribution&&this.controls.push(new OpenLayers.Control.Attribution))),i=0,len=this.controls.length;i<len;i++)this.addControlToMap(this.controls[i]);this.popups=[];this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this);OpenLayers.Event.observe(window,"unload",this.unloadDestroy);options&&options.layers&&(delete this.center,delete this.zoom,this.addLayers(options.layers),options.center&&!this.getCenter()&&this.setCenter(options.center,options.zoom))},getViewport:function(){return this.viewPortDiv},render:function(div){this.div=OpenLayers.Util.getElement(div);OpenLayers.Element.addClass(this.div,"olMap");this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.div.appendChild(this.viewPortDiv);this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){var i;if(!this.unloadDestroy)return!1;if(this.panTween&&(this.panTween.stop(),this.panTween=null),OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy),this.unloadDestroy=null,this.updateSizeDestroy&&OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy),this.paddingForPopups=null,this.controls!=null){for(i=this.controls.length-1;i>=0;--i)this.controls[i].destroy();this.controls=null}if(this.layers!=null){for(i=this.layers.length-1;i>=0;--i)this.layers[i].destroy(!1);this.layers=null}this.viewPortDiv&&this.div.removeChild(this.viewPortDiv);this.viewPortDiv=null;this.eventListeners&&(this.events.un(this.eventListeners),this.eventListeners=null);this.events.destroy();this.events=null;this.options=null},setOptions:function(options){var updatePxExtent=this.minPx&&options.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,options);updatePxExtent&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:!0})},getTileSize:function(){return this.tileSize},getBy:function(array,property,match){var test=typeof match.test=="function";return OpenLayers.Array.filter(this[array],function(item){return item[property]==match||test&&match.test(item[property])})},getLayersBy:function(property,match){return this.getBy("layers",property,match)},getLayersByName:function(match){return this.getLayersBy("name",match)},getLayersByClass:function(match){return this.getLayersBy("CLASS_NAME",match)},getControlsBy:function(property,match){return this.getBy("controls",property,match)},getControlsByClass:function(match){return this.getControlsBy("CLASS_NAME",match)},getLayer:function(id){for(var layer,foundLayer=null,i=0,len=this.layers.length;i<len;i++)if(layer=this.layers[i],layer.id==id){foundLayer=layer;break}return foundLayer},setLayerZIndex:function(layer,zIdx){layer.setZIndex(this.Z_INDEX_BASE[layer.isBaseLayer?"BaseLayer":"Overlay"]+zIdx*5)},resetLayersZIndex:function(){for(var layer,i=0,len=this.layers.length;i<len;i++)layer=this.layers[i],this.setLayerZIndex(layer,i)},addLayer:function(layer){for(var i=0,len=this.layers.length;i<len;i++)if(this.layers[i]==layer)return!1;return this.events.triggerEvent("preaddlayer",{layer:layer})===!1?!1:(this.allOverlays&&(layer.isBaseLayer=!1),layer.div.className="olLayerDiv",layer.div.style.overflow="",this.setLayerZIndex(layer,this.layers.length),layer.isFixed?this.viewPortDiv.appendChild(layer.div):this.layerContainerDiv.appendChild(layer.div),this.layers.push(layer),layer.setMap(this),layer.isBaseLayer||this.allOverlays&&!this.baseLayer?this.baseLayer==null?this.setBaseLayer(layer):layer.setVisibility(!1):layer.redraw(),this.events.triggerEvent("addlayer",{layer:layer}),layer.events.triggerEvent("added",{map:this,layer:layer}),layer.afterAdd(),!0)},addLayers:function(layers){for(var i=0,len=layers.length;i<len;i++)this.addLayer(layers[i])},removeLayer:function(layer,setNewBaseLayer){var i,len,iLayer;if(this.events.triggerEvent("preremovelayer",{layer:layer})!==!1){if(setNewBaseLayer==null&&(setNewBaseLayer=!0),layer.isFixed?this.viewPortDiv.removeChild(layer.div):this.layerContainerDiv.removeChild(layer.div),OpenLayers.Util.removeItem(this.layers,layer),layer.removeMap(this),layer.map=null,this.baseLayer==layer&&(this.baseLayer=null,setNewBaseLayer))for(i=0,len=this.layers.length;i<len;i++)if(iLayer=this.layers[i],iLayer.isBaseLayer||this.allOverlays){this.setBaseLayer(iLayer);break}this.resetLayersZIndex();this.events.triggerEvent("removelayer",{layer:layer});layer.events.triggerEvent("removed",{map:this,layer:layer})}},getNumLayers:function(){return this.layers.length},getLayerIndex:function(layer){return OpenLayers.Util.indexOf(this.layers,layer)},setLayerIndex:function(layer,idx){var base=this.getLayerIndex(layer),i,len;if(idx<0?idx=0:idx>this.layers.length&&(idx=this.layers.length),base!=idx){for(this.layers.splice(base,1),this.layers.splice(idx,0,layer),i=0,len=this.layers.length;i<len;i++)this.setLayerZIndex(this.layers[i],i);this.events.triggerEvent("changelayer",{layer:layer,property:"order"});this.allOverlays&&(idx===0?this.setBaseLayer(layer):this.baseLayer!==this.layers[0]&&this.setBaseLayer(this.layers[0]))}},raiseLayer:function(layer,delta){var idx=this.getLayerIndex(layer)+delta;this.setLayerIndex(layer,idx)},setBaseLayer:function(newBaseLayer){var center,newResolution,newZoom;newBaseLayer!=this.baseLayer&&OpenLayers.Util.indexOf(this.layers,newBaseLayer)!=-1&&(center=this.getCachedCenter(),newResolution=OpenLayers.Util.getResolutionFromScale(this.getScale(),newBaseLayer.units),this.baseLayer==null||this.allOverlays||this.baseLayer.setVisibility(!1),this.baseLayer=newBaseLayer,(!this.allOverlays||this.baseLayer.visibility)&&(this.baseLayer.setVisibility(!0),this.baseLayer.inRange===!1&&this.baseLayer.redraw()),center!=null&&(newZoom=this.getZoomForResolution(newResolution||this.resolution,!0),this.setCenter(center,newZoom,!1,!0)),this.events.triggerEvent("changebaselayer",{layer:this.baseLayer}))},addControl:function(control,px){this.controls.push(control);this.addControlToMap(control,px)},addControls:function(controls,pixels){for(var ctrl,px,pxs=arguments.length===1?[]:pixels,i=0,len=controls.length;i<len;i++)ctrl=controls[i],px=pxs[i]?pxs[i]:null,this.addControl(ctrl,px)},addControlToMap:function(control,px){control.outsideViewport=control.div!=null;this.displayProjection&&!control.displayProjection&&(control.displayProjection=this.displayProjection);control.setMap(this);var div=control.draw(px);div&&(control.outsideViewport||(div.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length,this.viewPortDiv.appendChild(div)));control.autoActivate&&control.activate()},getControl:function(id){for(var control,returnControl=null,i=0,len=this.controls.length;i<len;i++)if(control=this.controls[i],control.id==id){returnControl=control;break}return returnControl},removeControl:function(control){control&&control==this.getControl(control.id)&&(control.div&&control.div.parentNode==this.viewPortDiv&&this.viewPortDiv.removeChild(control.div),OpenLayers.Util.removeItem(this.controls,control))},addPopup:function(popup,exclusive){var i,popupDiv;if(exclusive)for(i=this.popups.length-1;i>=0;--i)this.removePopup(this.popups[i]);popup.map=this;this.popups.push(popup);popupDiv=popup.draw();popupDiv&&(popupDiv.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length,this.layerContainerDiv.appendChild(popupDiv))},removePopup:function(popup){if(OpenLayers.Util.removeItem(this.popups,popup),popup.div)try{this.layerContainerDiv.removeChild(popup.div)}catch(e){}popup.map=null},getSize:function(){var size=null;return this.size!=null&&(size=this.size.clone()),size},updateSize:function(){var newSize=this.getCurrentSize(),oldSize,i,len,center,zoom;if(newSize&&!isNaN(newSize.h)&&!isNaN(newSize.w)&&(this.events.clearMouseCache(),oldSize=this.getSize(),oldSize==null&&(this.size=oldSize=newSize),!newSize.equals(oldSize))){for(this.size=newSize,i=0,len=this.layers.length;i<len;i++)this.layers[i].onMapResize();center=this.getCachedCenter();this.baseLayer!=null&&center!=null&&(zoom=this.getZoom(),this.zoom=null,this.setCenter(center,zoom))}this.events.triggerEvent("updatesize")},getCurrentSize:function(){var size=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);return(size.w==0&&size.h==0||isNaN(size.w)&&isNaN(size.h))&&(size.w=this.div.offsetWidth,size.h=this.div.offsetHeight),(size.w==0&&size.h==0||isNaN(size.w)&&isNaN(size.h))&&(size.w=parseInt(this.div.style.width),size.h=parseInt(this.div.style.height)),size},calculateBounds:function(center,resolution){var extent=null,halfWDeg,halfHDeg;return center==null&&(center=this.getCachedCenter()),resolution==null&&(resolution=this.getResolution()),center!=null&&resolution!=null&&(halfWDeg=this.size.w*resolution/2,halfHDeg=this.size.h*resolution/2,extent=new OpenLayers.Bounds(center.lon-halfWDeg,center.lat-halfHDeg,center.lon+halfWDeg,center.lat+halfHDeg)),extent},getCenter:function(){var center=null,cachedCenter=this.getCachedCenter();return cachedCenter&&(center=cachedCenter.clone()),center},getCachedCenter:function(){return!this.center&&this.size&&(this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2})),this.center},getZoom:function(){return this.zoom},pan:function(dx,dy,options){var centerPx,newCenterPx,newCenterLonLat;options=OpenLayers.Util.applyDefaults(options,{animate:!0,dragging:!1});options.dragging?(dx!=0||dy!=0)&&this.moveByPx(dx,dy):(centerPx=this.getViewPortPxFromLonLat(this.getCachedCenter()),newCenterPx=centerPx.add(dx,dy),(this.dragging||!newCenterPx.equals(centerPx))&&(newCenterLonLat=this.getLonLatFromViewPortPx(newCenterPx),options.animate?this.panTo(newCenterLonLat):(this.moveTo(newCenterLonLat),this.dragging&&(this.dragging=!1,this.events.triggerEvent("moveend")))))},panTo:function(lonlat){var center;if(this.panMethod&&this.getExtent().scale(this.panRatio).containsLonLat(lonlat)){if(this.panTween||(this.panTween=new OpenLayers.Tween(this.panMethod)),center=this.getCachedCenter(),lonlat.equals(center))return;var from=this.getPixelFromLonLat(center),to=this.getPixelFromLonLat(lonlat),vector={x:to.x-from.x,y:to.y-from.y},last={x:0,y:0};this.panTween.start({x:0,y:0},vector,this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(px){var x=px.x-last.x,y=px.y-last.y;this.moveByPx(x,y);last.x=Math.round(px.x);last.y=Math.round(px.y)},this),done:OpenLayers.Function.bind(function(){this.moveTo(lonlat);this.dragging=!1;this.events.triggerEvent("moveend")},this)}})}else this.setCenter(lonlat)},setCenter:function(lonlat,zoom,dragging,forceZoomChange){this.panTween&&this.panTween.stop();this.moveTo(lonlat,zoom,{dragging:dragging,forceZoomChange:forceZoomChange})},moveByPx:function(dx,dy){var hw=this.size.w/2,hh=this.size.h/2,x=hw+dx,y=hh+dy,wrapDateLine=this.baseLayer.wrapDateLine,xRestriction=0,yRestriction=0,layer,i,len;if(this.restrictedExtent&&(xRestriction=hw,yRestriction=hh,wrapDateLine=!1),dx=wrapDateLine||x<=this.maxPx.x-xRestriction&&x>=this.minPx.x+xRestriction?Math.round(dx):0,dy=y<=this.maxPx.y-yRestriction&&y>=this.minPx.y+yRestriction?Math.round(dy):0,dx||dy){for(this.dragging||(this.dragging=!0,this.events.triggerEvent("movestart")),this.center=null,dx&&(this.layerContainerDiv.style.left=(this.layerContainerOriginPx.x-=dx)+"px",this.minPx.x-=dx,this.maxPx.x-=dx),dy&&(this.layerContainerDiv.style.top=(this.layerContainerOriginPx.y-=dy)+"px",this.minPx.y-=dy,this.maxPx.y-=dy),i=0,len=this.layers.length;i<len;++i)layer=this.layers[i],layer.visibility&&(layer===this.baseLayer||layer.inRange)&&(layer.moveByPx(dx,dy),layer.events.triggerEvent("move"));this.events.triggerEvent("move")}},adjustZoom:function(zoom){var resolutions,maxResolution,i,ii;if(this.baseLayer&&this.baseLayer.wrapDateLine&&(resolutions=this.baseLayer.resolutions,maxResolution=this.getMaxExtent().getWidth()/this.size.w,this.getResolutionForZoom(zoom)>maxResolution))if(this.fractionalZoom)zoom=this.getZoomForResolution(maxResolution);else for(i=zoom|0,ii=resolutions.length;i<ii;++i)if(resolutions[i]<=maxResolution){zoom=i;break}return zoom},getMinZoom:function(){return this.adjustZoom(0)},moveTo:function(lonlat,zoom,options){var requestedZoom,dragging,forceZoomChange,resolution,extent,maxCenter,zoomChanged,centerChanged,res,style,bounds,layer,inRange,i,len;if(lonlat==null||lonlat instanceof OpenLayers.LonLat||(lonlat=new OpenLayers.LonLat(lonlat)),options||(options={}),zoom!=null&&(zoom=parseFloat(zoom),this.fractionalZoom||(zoom=Math.round(zoom))),requestedZoom=zoom,zoom=this.adjustZoom(zoom),zoom!==requestedZoom&&(lonlat=this.getCenter()),dragging=options.dragging||this.dragging,forceZoomChange=options.forceZoomChange,this.getCachedCenter()||this.isValidLonLat(lonlat)||(lonlat=this.maxExtent.getCenterLonLat(),this.center=lonlat.clone()),this.restrictedExtent!=null&&(lonlat==null&&(lonlat=this.center),zoom==null&&(zoom=this.getZoom()),resolution=this.getResolutionForZoom(zoom),extent=this.calculateBounds(lonlat,resolution),this.restrictedExtent.containsBounds(extent)||(maxCenter=this.restrictedExtent.getCenterLonLat(),extent.getWidth()>this.restrictedExtent.getWidth()?lonlat=new OpenLayers.LonLat(maxCenter.lon,lonlat.lat):extent.left<this.restrictedExtent.left?lonlat=lonlat.add(this.restrictedExtent.left-extent.left,0):extent.right>this.restrictedExtent.right&&(lonlat=lonlat.add(this.restrictedExtent.right-extent.right,0)),extent.getHeight()>this.restrictedExtent.getHeight()?lonlat=new OpenLayers.LonLat(lonlat.lon,maxCenter.lat):extent.bottom<this.restrictedExtent.bottom?lonlat=lonlat.add(0,this.restrictedExtent.bottom-extent.bottom):extent.top>this.restrictedExtent.top&&(lonlat=lonlat.add(0,this.restrictedExtent.top-extent.top)))),zoomChanged=forceZoomChange||this.isValidZoomLevel(zoom)&&zoom!=this.getZoom(),centerChanged=this.isValidLonLat(lonlat)&&!lonlat.equals(this.center),zoomChanged||centerChanged||dragging){if(dragging||this.events.triggerEvent("movestart"),centerChanged&&(!zoomChanged&&this.center&&this.centerLayerContainer(lonlat),this.center=lonlat.clone()),res=zoomChanged?this.getResolutionForZoom(zoom):this.getResolution(),zoomChanged||this.layerContainerOrigin==null){this.layerContainerOrigin=this.getCachedCenter();style=this.layerContainerDiv.style;style.left="0px";style.top="0px";this.layerContainerOriginPx.x=0;this.layerContainerOriginPx.y=0;var maxExtent=this.getMaxExtent({restricted:!0}),maxExtentCenter=maxExtent.getCenterLonLat(),lonDelta=this.center.lon-maxExtentCenter.lon,latDelta=maxExtentCenter.lat-this.center.lat,extentWidth=Math.round(maxExtent.getWidth()/res),extentHeight=Math.round(maxExtent.getHeight()/res);this.minPx={x:(this.size.w-extentWidth)/2-lonDelta/res,y:(this.size.h-extentHeight)/2-latDelta/res};this.maxPx={x:this.minPx.x+Math.round(maxExtent.getWidth()/res),y:this.minPx.y+Math.round(maxExtent.getHeight()/res)}}for(zoomChanged&&(this.zoom=zoom,this.resolution=res),bounds=this.getExtent(),this.baseLayer.visibility&&(this.baseLayer.moveTo(bounds,zoomChanged,options.dragging),options.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:zoomChanged})),bounds=this.baseLayer.getExtent(),i=this.layers.length-1;i>=0;--i)layer=this.layers[i],layer===this.baseLayer||layer.isBaseLayer||(inRange=layer.calculateInRange(),layer.inRange!=inRange&&(layer.inRange=inRange,inRange||layer.display(!1)),inRange&&layer.visibility&&(layer.moveTo(bounds,zoomChanged,options.dragging),options.dragging||layer.events.triggerEvent("moveend",{zoomChanged:zoomChanged})));if(this.events.triggerEvent("move"),dragging||this.events.triggerEvent("moveend"),zoomChanged){for(i=0,len=this.popups.length;i<len;i++)this.popups[i].updatePosition();this.events.triggerEvent("zoomend")}}},centerLayerContainer:function(lonlat){var originPx=this.getViewPortPxFromLonLat(this.layerContainerOrigin),newPx=this.getViewPortPxFromLonLat(lonlat),dx,dy;if(originPx!=null&&newPx!=null){var oldLeft=this.layerContainerOriginPx.x,oldTop=this.layerContainerOriginPx.y,newLeft=Math.round(originPx.x-newPx.x),newTop=Math.round(originPx.y-newPx.y);this.layerContainerDiv.style.left=(this.layerContainerOriginPx.x=newLeft)+"px";this.layerContainerDiv.style.top=(this.layerContainerOriginPx.y=newTop)+"px";dx=oldLeft-newLeft;dy=oldTop-newTop;this.minPx.x-=dx;this.maxPx.x-=dx;this.minPx.y-=dy;this.maxPx.y-=dy}},isValidZoomLevel:function(zoomLevel){return zoomLevel!=null&&zoomLevel>=0&&zoomLevel<this.getNumZoomLevels()},isValidLonLat:function(lonlat){var valid=!1,maxExtent,worldBounds;return lonlat!=null&&(maxExtent=this.getMaxExtent(),worldBounds=this.baseLayer.wrapDateLine&&maxExtent,valid=maxExtent.containsLonLat(lonlat,{worldBounds:worldBounds})),valid},getProjection:function(){var projection=this.getProjectionObject();return projection?projection.getCode():null},getProjectionObject:function(){var projection=null;return this.baseLayer!=null&&(projection=this.baseLayer.projection),projection},getMaxResolution:function(){var maxResolution=null;return this.baseLayer!=null&&(maxResolution=this.baseLayer.maxResolution),maxResolution},getMaxExtent:function(options){var maxExtent=null;return options&&options.restricted&&this.restrictedExtent?maxExtent=this.restrictedExtent:this.baseLayer!=null&&(maxExtent=this.baseLayer.maxExtent),maxExtent},getNumZoomLevels:function(){var numZoomLevels=null;return this.baseLayer!=null&&(numZoomLevels=this.baseLayer.numZoomLevels),numZoomLevels},getExtent:function(){var extent=null;return this.baseLayer!=null&&(extent=this.baseLayer.getExtent()),extent},getResolution:function(){var resolution=null;return this.baseLayer!=null?resolution=this.baseLayer.getResolution():this.allOverlays===!0&&this.layers.length>0&&(resolution=this.layers[0].getResolution()),resolution},getUnits:function(){var units=null;return this.baseLayer!=null&&(units=this.baseLayer.units),units},getScale:function(){var scale=null,res,units;return this.baseLayer!=null&&(res=this.getResolution(),units=this.baseLayer.units,scale=OpenLayers.Util.getScaleFromResolution(res,units)),scale},getZoomForExtent:function(bounds,closest){var zoom=null;return this.baseLayer!=null&&(zoom=this.baseLayer.getZoomForExtent(bounds,closest)),zoom},getResolutionForZoom:function(zoom){var resolution=null;return this.baseLayer&&(resolution=this.baseLayer.getResolutionForZoom(zoom)),resolution},getZoomForResolution:function(resolution,closest){var zoom=null;return this.baseLayer!=null&&(zoom=this.baseLayer.getZoomForResolution(resolution,closest)),zoom},zoomTo:function(zoom){this.isValidZoomLevel(zoom)&&this.setCenter(null,zoom)},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(bounds,closest){var center,maxExtent;if(bounds instanceof OpenLayers.Bounds||(bounds=new OpenLayers.Bounds(bounds)),center=bounds.getCenterLonLat(),this.baseLayer.wrapDateLine){for(maxExtent=this.getMaxExtent(),bounds=bounds.clone();bounds.right<bounds.left;)bounds.right+=maxExtent.getWidth();center=bounds.getCenterLonLat().wrapDateLine(maxExtent)}this.setCenter(center,this.getZoomForExtent(bounds,closest))},zoomToMaxExtent:function(options){var restricted=options?options.restricted:!0,maxExtent=this.getMaxExtent({restricted:restricted});this.zoomToExtent(maxExtent)},zoomToScale:function(scale,closest){var res=OpenLayers.Util.getResolutionFromScale(scale,this.baseLayer.units),halfWDeg=this.size.w*res/2,halfHDeg=this.size.h*res/2,center=this.getCachedCenter(),extent=new OpenLayers.Bounds(center.lon-halfWDeg,center.lat-halfHDeg,center.lon+halfWDeg,center.lat+halfHDeg);this.zoomToExtent(extent,closest)},getLonLatFromViewPortPx:function(viewPortPx){var lonlat=null;return this.baseLayer!=null&&(lonlat=this.baseLayer.getLonLatFromViewPortPx(viewPortPx)),lonlat},getViewPortPxFromLonLat:function(lonlat){var px=null;return this.baseLayer!=null&&(px=this.baseLayer.getViewPortPxFromLonLat(lonlat)),px},getLonLatFromPixel:function(px){return this.getLonLatFromViewPortPx(px)},getPixelFromLonLat:function(lonlat){var px=this.getViewPortPxFromLonLat(lonlat);return px.x=Math.round(px.x),px.y=Math.round(px.y),px},getGeodesicPixelSize:function(px){var lonlat=px?this.getLonLatFromPixel(px):this.getCachedCenter()||new OpenLayers.LonLat(0,0),res=this.getResolution(),left=lonlat.add(-res/2,0),right=lonlat.add(res/2,0),bottom=lonlat.add(0,-res/2),top=lonlat.add(0,res/2),dest=new OpenLayers.Projection("EPSG:4326"),source=this.getProjectionObject()||dest;return source.equals(dest)||(left.transform(source,dest),right.transform(source,dest),bottom.transform(source,dest),top.transform(source,dest)),new OpenLayers.Size(OpenLayers.Util.distVincenty(left,right),OpenLayers.Util.distVincenty(bottom,top))},getViewPortPxFromLayerPx:function(layerPx){var viewPortPx=null,dX,dY;return layerPx!=null&&(dX=this.layerContainerOriginPx.x,dY=this.layerContainerOriginPx.y,viewPortPx=layerPx.add(dX,dY)),viewPortPx},getLayerPxFromViewPortPx:function(viewPortPx){var layerPx=null,dX,dY;return viewPortPx!=null&&(dX=-this.layerContainerOriginPx.x,dY=-this.layerContainerOriginPx.y,layerPx=viewPortPx.add(dX,dY),(isNaN(layerPx.x)||isNaN(layerPx.y))&&(layerPx=null)),layerPx},getLonLatFromLayerPx:function(px){return px=this.getViewPortPxFromLayerPx(px),this.getLonLatFromViewPortPx(px)},getLayerPxFromLonLat:function(lonlat){var px=this.getPixelFromLonLat(lonlat);return this.getLayerPxFromViewPortPx(px)},CLASS_NAME:"OpenLayers.Map"});OpenLayers.Map.TILE_WIDTH=256;OpenLayers.Map.TILE_HEIGHT=256;OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:!1,evt:null,initialize:function(control,callbacks,options){OpenLayers.Util.extend(this,options);this.control=control;this.callbacks=callbacks;var map=this.map||control.map;map&&this.setMap(map);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(map){this.map=map},checkModifiers:function(evt){if(this.keyMask==null)return!0;var keyModifiers=(evt.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(evt.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(evt.altKey?OpenLayers.Handler.MOD_ALT:0)|(evt.metaKey?OpenLayers.Handler.MOD_META:0);return keyModifiers==this.keyMask},activate:function(){var events,i,len;if(this.active)return!1;for(events=OpenLayers.Events.prototype.BROWSER_EVENTS,i=0,len=events.length;i<len;i++)this[events[i]]&&this.register(events[i],this[events[i]]);return this.active=!0,!0},deactivate:function(){var events,i,len;if(!this.active)return!1;for(events=OpenLayers.Events.prototype.BROWSER_EVENTS,i=0,len=events.length;i<len;i++)this[events[i]]&&this.unregister(events[i],this[events[i]]);return this.active=!1,!0},callback:function(name,args){name&&this.callbacks[name]&&this.callbacks[name].apply(this.control,args)},register:function(name,method){this.map.events.registerPriority(name,this,method);this.map.events.registerPriority(name,this,this.setEvent)},unregister:function(name,method){this.map.events.unregister(name,this,method);this.map.events.unregister(name,this,this.setEvent)},setEvent:function(evt){return this.evt=evt,!0},destroy:function(){this.deactivate();this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"});OpenLayers.Handler.MOD_NONE=0;OpenLayers.Handler.MOD_SHIFT=1;OpenLayers.Handler.MOD_CTRL=2;OpenLayers.Handler.MOD_ALT=4;OpenLayers.Handler.MOD_META=8;OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:!0,double:!1,pixelTolerance:0,dblclickTolerance:13,stopSingle:!1,stopDouble:!1,timerId:null,touch:!1,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(evt){return this.touch||(this.unregisterMouseListeners(),this.touch=!0),this.down=this.getEventInfo(evt),this.last=this.getEventInfo(evt),!0},touchmove:function(evt){return this.last=this.getEventInfo(evt),!0},touchend:function(evt){return this.down&&(evt.xy=this.last.xy,evt.lastTouches=this.last.touches,this.handleSingle(evt),this.down=null),!0},unregisterMouseListeners:function(){this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,click:this.click,dblclick:this.dblclick,scope:this})},mousedown:function(evt){return this.down=this.getEventInfo(evt),this.last=this.getEventInfo(evt),!0},mouseup:function(evt){var propagate=!0;return this.checkModifiers(evt)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(evt)&&(propagate=this.rightclick(evt)),propagate},rightclick:function(evt){if(this.passesTolerance(evt)){if(this.rightclickTimerId!=null)return this.clearTimer(),this.callback("dblrightclick",[evt]),!this.stopDouble;var clickEvent=this.double?OpenLayers.Util.extend({},evt):this.callback("rightclick",[evt]),delayedRightCall=OpenLayers.Function.bind(this.delayedRightCall,this,clickEvent);this.rightclickTimerId=window.setTimeout(delayedRightCall,this.delay)}return!this.stopSingle},delayedRightCall:function(evt){this.rightclickTimerId=null;evt&&this.callback("rightclick",[evt])},click:function(evt){return this.last||(this.last=this.getEventInfo(evt)),this.handleSingle(evt),!this.stopSingle},dblclick:function(evt){return this.handleDouble(evt),!this.stopDouble},handleDouble:function(evt){this.passesDblclickTolerance(evt)&&(this.double&&this.callback("dblclick",[evt]),this.clearTimer())},handleSingle:function(evt){if(this.passesTolerance(evt))if(this.timerId!=null)this.last.touches&&this.last.touches.length===1&&(this.double&&OpenLayers.Event.stop(evt),this.handleDouble(evt)),this.last.touches&&this.last.touches.length===2||this.clearTimer();else{this.first=this.getEventInfo(evt);var clickEvent=this.single?OpenLayers.Util.extend({},evt):null;this.queuePotentialClick(clickEvent)}},queuePotentialClick:function(evt){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,evt),this.delay)},passesTolerance:function(evt){var passes=!0,i,ii;if(this.pixelTolerance!=null&&this.down&&this.down.xy&&(passes=this.pixelTolerance>=this.down.xy.distanceTo(evt.xy),passes&&this.touch&&this.down.touches.length===this.last.touches.length))for(i=0,ii=this.down.touches.length;i<ii;++i)if(this.getTouchDistance(this.down.touches[i],this.last.touches[i])>this.pixelTolerance){passes=!1;break}return passes},getTouchDistance:function(from,to){return Math.sqrt(Math.pow(from.clientX-to.clientX,2)+Math.pow(from.clientY-to.clientY,2))},passesDblclickTolerance:function(){var passes=!0;return this.down&&this.first&&(passes=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance),passes},clearTimer:function(){this.timerId!=null&&(window.clearTimeout(this.timerId),this.timerId=null);this.rightclickTimerId!=null&&(window.clearTimeout(this.rightclickTimerId),this.rightclickTimerId=null)},delayedCall:function(evt){this.timerId=null;evt&&this.callback("click",[evt])},getEventInfo:function(evt){var touches,len,touch,i;if(evt.touches)for(len=evt.touches.length,touches=new Array(len),i=0;i<len;i++)touch=evt.touches[i],touches[i]={clientX:touch.clientX,clientY:touch.clientY};return{xy:evt.xy,touches:touches}},deactivate:function(){var deactivated=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),this.down=null,this.first=null,this.last=null,this.touch=!1,deactivated=!0),deactivated},CLASS_NAME:"OpenLayers.Handler.Click"});OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!0,dragging:!1,touch:!1,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:!1,documentEvents:null,initialize:function(){if(OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.documentDrag===!0){var me=this;this._docMove=function(evt){me.mousemove({xy:{x:evt.clientX,y:evt.clientY},element:document})};this._docUp=function(evt){me.mouseup({xy:{x:evt.clientX,y:evt.clientY}})}}},dragstart:function(evt){var propagate=!0;return this.dragging=!1,this.checkModifiers(evt)&&(OpenLayers.Event.isLeftClick(evt)||OpenLayers.Event.isSingleTouch(evt))?(this.started=!0,this.start=evt.xy,this.last=evt.xy,OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown"),this.down(evt),this.callback("down",[evt.xy]),OpenLayers.Event.preventDefault(evt),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True),document.onselectstart=OpenLayers.Function.False,propagate=!this.stopDown):(this.started=!1,this.start=null,this.last=null),propagate},dragmove:function(evt){return this.lastMoveEvt=evt,this.started&&!this.timeoutId&&(evt.xy.x!=this.last.x||evt.xy.y!=this.last.y)&&(this.documentDrag===!0&&this.documentEvents&&(evt.element===document?(this.adjustXY(evt),this.setEvent(evt)):this.removeDocumentEvents()),this.interval>0&&(this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)),this.dragging=!0,this.move(evt),this.callback("move",[evt.xy]),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart,document.onselectstart=OpenLayers.Function.False),this.last=evt.xy),!0},dragend:function(evt){if(this.started){this.documentDrag===!0&&this.documentEvents&&(this.adjustXY(evt),this.removeDocumentEvents());var dragged=this.start!=this.last;this.started=!1;this.dragging=!1;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.up(evt);this.callback("up",[evt.xy]);dragged&&this.callback("done",[evt.xy]);document.onselectstart=this.oldOnselectstart}return!0},down:function(){},move:function(){},up:function(){},out:function(){},mousedown:function(evt){return this.dragstart(evt)},touchstart:function(evt){return this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,scope:this})),this.dragstart(evt)},mousemove:function(evt){return this.dragmove(evt)},touchmove:function(evt){return this.dragmove(evt)},removeTimeout:function(){this.timeoutId=null;this.dragging&&this.mousemove(this.lastMoveEvt)},mouseup:function(evt){return this.dragend(evt)},touchend:function(evt){return evt.xy=this.last,this.dragend(evt)},mouseout:function(evt){if(this.started&&OpenLayers.Util.mouseLeft(evt,this.map.viewPortDiv))if(this.documentDrag===!0)this.addDocumentEvents();else{var dragged=this.start!=this.last;this.started=!1;this.dragging=!1;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.out(evt);this.callback("out",[]);dragged&&this.callback("done",[evt.xy]);document.onselectstart&&(document.onselectstart=this.oldOnselectstart)}return!0},click:function(){return this.start==this.last},activate:function(){var activated=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragging=!1,activated=!0),activated},deactivate:function(){var deactivated=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.touch=!1,this.started=!1,this.dragging=!1,this.start=null,this.last=null,deactivated=!0,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")),deactivated},adjustXY:function(evt){var pos=OpenLayers.Util.pagePosition(this.map.viewPortDiv);evt.xy.x-=pos[0];evt.xy.y-=pos[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown");this.documentEvents=!0;OpenLayers.Event.observe(document,"mousemove",this._docMove);OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown");this.documentEvents=!1;OpenLayers.Event.stopObserving(document,"mousemove",this._docMove);OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"});OpenLayers.Control.OverviewMap=OpenLayers.Class(OpenLayers.Control,{element:null,ovmap:null,size:{w:180,h:90},layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan:!1,handlers:null,resolutionFactor:1,maximized:!1,maximizeTitle:"",minimizeTitle:"",initialize:function(options){this.layers=[];this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,[options])},destroy:function(){this.mapDiv&&(this.handlers.click&&this.handlers.click.destroy(),this.handlers.drag&&this.handlers.drag.destroy(),this.ovmap&&this.ovmap.viewPortDiv.removeChild(this.extentRectangle),this.extentRectangle=null,this.rectEvents&&(this.rectEvents.destroy(),this.rectEvents=null),this.ovmap&&(this.ovmap.destroy(),this.ovmap=null),this.element.removeChild(this.mapDiv),this.mapDiv=null,this.div.removeChild(this.element),this.element=null,this.maximizeDiv&&(this.div.removeChild(this.maximizeDiv),this.maximizeDiv=null),this.minimizeDiv&&(this.div.removeChild(this.minimizeDiv),this.minimizeDiv=null),this.map.events.un({buttonclick:this.onButtonClick,moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments))},draw:function(){var layer,img;if(OpenLayers.Control.prototype.draw.apply(this,arguments),this.layers.length===0)if(this.map.baseLayer)layer=this.map.baseLayer.clone(),this.layers=[layer];else return this.map.events.register("changebaselayer",this,this.baseLayerDraw),this.div;this.element=document.createElement("div");this.element.className=this.displayClass+"Element";this.element.style.display="none";this.mapDiv=document.createElement("div");this.mapDiv.style.width=this.size.w+"px";this.mapDiv.style.height=this.size.h+"px";this.mapDiv.style.position="relative";this.mapDiv.style.overflow="hidden";this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap");this.extentRectangle=document.createElement("div");this.extentRectangle.style.position="absolute";this.extentRectangle.style.zIndex=1e3;this.extentRectangle.className=this.displayClass+"ExtentRectangle";this.element.appendChild(this.mapDiv);this.div.appendChild(this.element);this.outsideViewport?this.element.style.display="":(this.div.className+=" "+this.displayClass+"Container",img=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png"),this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,null,img,"absolute"),this.maximizeDiv.style.display="none",this.maximizeDiv.className=this.displayClass+"MaximizeButton olButton",this.maximizeTitle&&(this.maximizeDiv.title=this.maximizeTitle),this.div.appendChild(this.maximizeDiv),img=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png"),this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,null,img,"absolute"),this.minimizeDiv.style.display="none",this.minimizeDiv.className=this.displayClass+"MinimizeButton olButton",this.minimizeTitle&&(this.minimizeDiv.title=this.minimizeTitle),this.div.appendChild(this.minimizeDiv),this.minimizeControl());this.map.getExtent()&&this.update();this.map.events.on({buttonclick:this.onButtonClick,moveend:this.update,scope:this});return this.maximized&&this.maximizeControl(),this.div},baseLayerDraw:function(){this.draw();this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)},rectDrag:function(px){var deltaX=this.handlers.drag.last.x-px.x,deltaY=this.handlers.drag.last.y-px.y,newLeft;if(deltaX!=0||deltaY!=0){var rectTop=this.rectPxBounds.top,rectLeft=this.rectPxBounds.left,rectHeight=Math.abs(this.rectPxBounds.getHeight()),rectWidth=this.rectPxBounds.getWidth(),newTop=Math.max(0,rectTop-deltaY);newTop=Math.min(newTop,this.ovmap.size.h-this.hComp-rectHeight);newLeft=Math.max(0,rectLeft-deltaX);newLeft=Math.min(newLeft,this.ovmap.size.w-this.wComp-rectWidth);this.setRectPxBounds(new OpenLayers.Bounds(newLeft,newTop+rectHeight,newLeft+rectWidth,newTop))}},mapDivClick:function(evt){var pxCenter=this.rectPxBounds.getCenterPixel(),deltaX=evt.xy.x-pxCenter.x,deltaY=evt.xy.y-pxCenter.y,top=this.rectPxBounds.top,left=this.rectPxBounds.left,height=Math.abs(this.rectPxBounds.getHeight()),width=this.rectPxBounds.getWidth(),newTop=Math.max(0,top+deltaY),newLeft;newTop=Math.min(newTop,this.ovmap.size.h-height);newLeft=Math.max(0,left+deltaX);newLeft=Math.min(newLeft,this.ovmap.size.w-width);this.setRectPxBounds(new OpenLayers.Bounds(newLeft,newTop+height,newLeft+width,newTop));this.updateMapToRect()},onButtonClick:function(evt){evt.buttonElement===this.minimizeDiv?this.minimizeControl():evt.buttonElement===this.maximizeDiv&&this.maximizeControl()},maximizeControl:function(e){this.element.style.display="";this.showToggle(!1);e!=null&&OpenLayers.Event.stop(e)},minimizeControl:function(e){this.element.style.display="none";this.showToggle(!0);e!=null&&OpenLayers.Event.stop(e)},showToggle:function(minimize){this.maximizeDiv&&(this.maximizeDiv.style.display=minimize?"":"none");this.minimizeDiv&&(this.minimizeDiv.style.display=minimize?"none":"")},update:function(){this.ovmap==null&&this.createMap();(this.autoPan||!this.isSuitableOverview())&&this.updateOverview();this.updateRectToMap()},isSuitableOverview:function(){var mapExtent=this.map.getExtent(),maxExtent=this.map.maxExtent,testExtent=new OpenLayers.Bounds(Math.max(mapExtent.left,maxExtent.left),Math.max(mapExtent.bottom,maxExtent.bottom),Math.min(mapExtent.right,maxExtent.right),Math.min(mapExtent.top,maxExtent.top)),resRatio;return this.ovmap.getProjection()!=this.map.getProjection()&&(testExtent=testExtent.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())),resRatio=this.ovmap.getResolution()/this.map.getResolution(),resRatio>this.minRatio&&resRatio<=this.maxRatio&&this.ovmap.getExtent().containsBounds(testExtent)},updateOverview:function(){var mapRes=this.map.getResolution(),targetRes=this.ovmap.getResolution(),resRatio=targetRes/mapRes,center;resRatio>this.maxRatio?targetRes=this.minRatio*mapRes:resRatio<=this.minRatio&&(targetRes=this.maxRatio*mapRes);this.ovmap.getProjection()!=this.map.getProjection()?(center=this.map.center.clone(),center.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())):center=this.map.center;this.ovmap.setCenter(center,this.ovmap.getZoomForResolution(targetRes*this.resolutionFactor));this.updateRectToMap()},createMap:function(){var options=OpenLayers.Util.extend({controls:[],maxResolution:"auto",fallThrough:!1},this.mapOptions),sourceUnits,targetUnits;this.ovmap=new OpenLayers.Map(this.mapDiv,options);this.ovmap.viewPortDiv.appendChild(this.extentRectangle);OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy);this.ovmap.addLayers(this.layers);this.ovmap.zoomToMaxExtent();this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width"));this.wComp=this.wComp?this.wComp:2;this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width"));this.hComp=this.hComp?this.hComp:2;this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap});this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},{single:!0,double:!1,stopSingle:!0,stopDouble:!0,pixelTolerance:1,map:this.ovmap});this.handlers.click.activate();this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,!0);this.rectEvents.register("mouseover",this,function(){this.handlers.drag.active||this.map.dragging||this.handlers.drag.activate()});this.rectEvents.register("mouseout",this,function(){this.handlers.drag.dragging||this.handlers.drag.deactivate()});this.ovmap.getProjection()!=this.map.getProjection()&&(sourceUnits=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,targetUnits=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units,this.resolutionFactor=sourceUnits&&targetUnits?OpenLayers.INCHES_PER_UNIT[sourceUnits]/OpenLayers.INCHES_PER_UNIT[targetUnits]:1)},updateRectToMap:function(){var bounds,pxBounds;bounds=this.ovmap.getProjection()!=this.map.getProjection()?this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()):this.map.getExtent();pxBounds=this.getRectBoundsFromMapBounds(bounds);pxBounds&&this.setRectPxBounds(pxBounds)},updateMapToRect:function(){var lonLatBounds=this.getMapBoundsFromRectBounds(this.rectPxBounds);this.ovmap.getProjection()!=this.map.getProjection()&&(lonLatBounds=lonLatBounds.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject()));this.map.panTo(lonLatBounds.getCenterLonLat())},setRectPxBounds:function(pxBounds){var top=Math.max(pxBounds.top,0),left=Math.max(pxBounds.left,0),bottom=Math.min(pxBounds.top+Math.abs(pxBounds.getHeight()),this.ovmap.size.h-this.hComp),right=Math.min(pxBounds.left+pxBounds.getWidth(),this.ovmap.size.w-this.wComp),width=Math.max(right-left,0),height=Math.max(bottom-top,0),rLeft,rTop;width<this.minRectSize||height<this.minRectSize?(this.extentRectangle.className=this.displayClass+this.minRectDisplayClass,rLeft=left+width/2-this.minRectSize/2,rTop=top+height/2-this.minRectSize/2,this.extentRectangle.style.top=Math.round(rTop)+"px",this.extentRectangle.style.left=Math.round(rLeft)+"px",this.extentRectangle.style.height=this.minRectSize+"px",this.extentRectangle.style.width=this.minRectSize+"px"):(this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.extentRectangle.style.top=Math.round(top)+"px",this.extentRectangle.style.left=Math.round(left)+"px",this.extentRectangle.style.height=Math.round(height)+"px",this.extentRectangle.style.width=Math.round(width)+"px");this.rectPxBounds=new OpenLayers.Bounds(Math.round(left),Math.round(bottom),Math.round(right),Math.round(top))},getRectBoundsFromMapBounds:function(lonLatBounds){var leftBottomPx=this.getOverviewPxFromLonLat({lon:lonLatBounds.left,lat:lonLatBounds.bottom}),rightTopPx=this.getOverviewPxFromLonLat({lon:lonLatBounds.right,lat:lonLatBounds.top}),bounds=null;return leftBottomPx&&rightTopPx&&(bounds=new OpenLayers.Bounds(leftBottomPx.x,leftBottomPx.y,rightTopPx.x,rightTopPx.y)),bounds},getMapBoundsFromRectBounds:function(pxBounds){var leftBottomLonLat=this.getLonLatFromOverviewPx({x:pxBounds.left,y:pxBounds.bottom}),rightTopLonLat=this.getLonLatFromOverviewPx({x:pxBounds.right,y:pxBounds.top});return new OpenLayers.Bounds(leftBottomLonLat.lon,leftBottomLonLat.lat,rightTopLonLat.lon,rightTopLonLat.lat)},getLonLatFromOverviewPx:function(overviewMapPx){var size=this.ovmap.size,res=this.ovmap.getResolution(),center=this.ovmap.getExtent().getCenterLonLat(),deltaX=overviewMapPx.x-size.w/2,deltaY=overviewMapPx.y-size.h/2;return{lon:center.lon+deltaX*res,lat:center.lat-deltaY*res}},getOverviewPxFromLonLat:function(lonlat){var res=this.ovmap.getResolution(),extent=this.ovmap.getExtent();if(extent)return{x:Math.round(1/res*(lonlat.lon-extent.left)),y:Math.round(1/res*(extent.top-lonlat.lat))}},CLASS_NAME:"OpenLayers.Control.OverviewMap"});OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,metadata:null,initialize:function(name,options){if(this.metadata={},options=OpenLayers.Util.extend({},options),this.alwaysInRange!=null&&(options.alwaysInRange=this.alwaysInRange),this.addOptions(options),this.name=name,this.id==null&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"),this.div=OpenLayers.Util.createDiv(this.id),this.div.style.width="100%",this.div.style.height="100%",this.div.dir="ltr",this.events=new OpenLayers.Events(this,this.div),this.eventListeners instanceof Object))this.events.on(this.eventListeners)},destroy:function(setNewBaseLayer){setNewBaseLayer==null&&(setNewBaseLayer=!0);this.map!=null&&this.map.removeLayer(this,setNewBaseLayer);this.projection=null;this.map=null;this.name=null;this.div=null;this.options=null;this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy());this.eventListeners=null;this.events=null},clone:function(obj){return obj==null&&(obj=new OpenLayers.Layer(this.name,this.getOptions())),OpenLayers.Util.applyDefaults(obj,this),obj.map=null,obj},getOptions:function(){var options={};for(var o in this.options)options[o]=this[o];return options},setName:function(newName){newName!=this.name&&(this.name=newName,this.map!=null&&this.map.events.triggerEvent("changelayer",{layer:this,property:"name"}))},addOptions:function(newOptions,reinitialize){var resolution,properties,o;if(this.options==null&&(this.options={}),newOptions&&(typeof newOptions.projection=="string"&&(newOptions.projection=new OpenLayers.Projection(newOptions.projection)),newOptions.projection&&OpenLayers.Util.applyDefaults(newOptions,OpenLayers.Projection.defaults[newOptions.projection.getCode()]),!newOptions.maxExtent||newOptions.maxExtent instanceof OpenLayers.Bounds||(newOptions.maxExtent=new OpenLayers.Bounds(newOptions.maxExtent)),!newOptions.minExtent||newOptions.minExtent instanceof OpenLayers.Bounds||(newOptions.minExtent=new OpenLayers.Bounds(newOptions.minExtent))),OpenLayers.Util.extend(this.options,newOptions),OpenLayers.Util.extend(this,newOptions),this.projection&&this.projection.getUnits()&&(this.units=this.projection.getUnits()),this.map){resolution=this.map.getResolution();properties=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(o in newOptions)if(newOptions.hasOwnProperty(o)&&OpenLayers.Util.indexOf(properties,o)>=0){this.initResolutions();reinitialize&&this.map.baseLayer===this&&(this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(resolution),!1,!0),this.map.events.triggerEvent("changebaselayer",{layer:this}));break}}},onMapResize:function(){},redraw:function(){var redrawn=!1,extent,zoomChanged;return this.map&&(this.inRange=this.calculateInRange(),extent=this.getExtent(),extent&&this.inRange&&this.visibility&&(zoomChanged=!0,this.moveTo(extent,zoomChanged,!1),this.events.triggerEvent("moveend",{zoomChanged:zoomChanged}),redrawn=!0)),redrawn},moveTo:function(){var display=this.visibility;this.isBaseLayer||(display=display&&this.inRange);this.display(display)},moveByPx:function(){},setMap:function(map){if(this.map==null){if(this.map=map,this.maxExtent=this.maxExtent||this.map.maxExtent,this.minExtent=this.minExtent||this.map.minExtent,this.projection=this.projection||this.map.projection,typeof this.projection=="string"&&(this.projection=new OpenLayers.Projection(this.projection)),this.units=this.projection.getUnits()||this.units||this.map.units,this.initResolutions(),!this.isBaseLayer){this.inRange=this.calculateInRange();var show=this.visibility&&this.inRange;this.div.style.display=show?"":"none"}this.setTileSize()}},afterAdd:function(){},removeMap:function(){},getImageSize:function(){return this.imageSize||this.tileSize},setTileSize:function(size){var tileSize=size?size:this.tileSize?this.tileSize:this.map.getTileSize();this.tileSize=tileSize;this.gutter&&(this.imageSize=new OpenLayers.Size(tileSize.w+2*this.gutter,tileSize.h+2*this.gutter))},getVisibility:function(){return this.visibility},setVisibility:function(visibility){visibility!=this.visibility&&(this.visibility=visibility,this.display(visibility),this.redraw(),this.events.triggerEvent("visibilitychanged"))},display:function(display){display!=(this.div.style.display!="none")&&(this.div.style.display=display&&this.calculateInRange()?"block":"none",this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"}))},calculateInRange:function(){var inRange=!1,resolution;return this.alwaysInRange?inRange=!0:this.map&&(resolution=this.map.getResolution(),inRange=resolution>=this.minResolution&&resolution<=this.maxResolution),inRange},setIsBaseLayer:function(isBaseLayer){isBaseLayer!=this.isBaseLayer&&(this.isBaseLayer=isBaseLayer,this.map!=null&&this.map.events.triggerEvent("changebaselayer",{layer:this}))},initResolutions:function(){for(var p,props={},alwaysInRange=!0,maxResolution,minResolution,lastIdx,i=0,len=this.RESOLUTION_PROPERTIES.length;i<len;i++)p=this.RESOLUTION_PROPERTIES[i],props[p]=this.options[p],alwaysInRange&&this.options[p]&&(alwaysInRange=!1);if(this.options.alwaysInRange==null&&(this.alwaysInRange=alwaysInRange),props.resolutions==null&&(props.resolutions=this.resolutionsFromScales(props.scales)),props.resolutions==null&&(props.resolutions=this.calculateResolutions(props)),props.resolutions==null){for(i=0,len=this.RESOLUTION_PROPERTIES.length;i<len;i++)p=this.RESOLUTION_PROPERTIES[i],props[p]=this.options[p]!=null?this.options[p]:this.map[p];props.resolutions==null&&(props.resolutions=this.resolutionsFromScales(props.scales));props.resolutions==null&&(props.resolutions=this.calculateResolutions(props))}if(this.options.maxResolution&&this.options.maxResolution!=="auto"&&(maxResolution=this.options.maxResolution),this.options.minScale&&(maxResolution=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units)),this.options.minResolution&&this.options.minResolution!=="auto"&&(minResolution=this.options.minResolution),this.options.maxScale&&(minResolution=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units)),props.resolutions&&(props.resolutions.sort(function(a,b){return b-a}),maxResolution||(maxResolution=props.resolutions[0]),minResolution||(lastIdx=props.resolutions.length-1,minResolution=props.resolutions[lastIdx])),this.resolutions=props.resolutions,this.resolutions){for(len=this.resolutions.length,this.scales=new Array(len),i=0;i<len;i++)this.scales[i]=OpenLayers.Util.getScaleFromResolution(this.resolutions[i],this.units);this.numZoomLevels=len}this.minResolution=minResolution;minResolution&&(this.maxScale=OpenLayers.Util.getScaleFromResolution(minResolution,this.units));this.maxResolution=maxResolution;maxResolution&&(this.minScale=OpenLayers.Util.getScaleFromResolution(maxResolution,this.units))},resolutionsFromScales:function(scales){if(scales!=null){var resolutions,i,len;for(len=scales.length,resolutions=new Array(len),i=0;i<len;i++)resolutions[i]=OpenLayers.Util.getResolutionFromScale(scales[i],this.units);return resolutions}},calculateResolutions:function(props){var viewSize,wRes,hRes,maxResolution=props.maxResolution,minResolution,tileSize,maxZoomLevel,numZoomLevels,ratio,resolutions,base,i;if(props.minScale!=null?maxResolution=OpenLayers.Util.getResolutionFromScale(props.minScale,this.units):maxResolution=="auto"&&this.maxExtent!=null&&(viewSize=this.map.getSize(),wRes=this.maxExtent.getWidth()/viewSize.w,hRes=this.maxExtent.getHeight()/viewSize.h,maxResolution=Math.max(wRes,hRes)),minResolution=props.minResolution,props.maxScale!=null?minResolution=OpenLayers.Util.getResolutionFromScale(props.maxScale,this.units):props.minResolution=="auto"&&this.minExtent!=null&&(viewSize=this.map.getSize(),wRes=this.minExtent.getWidth()/viewSize.w,hRes=this.minExtent.getHeight()/viewSize.h,minResolution=Math.max(wRes,hRes)),typeof maxResolution!="number"&&typeof minResolution!="number"&&this.maxExtent!=null&&(tileSize=this.map.getTileSize(),maxResolution=Math.max(this.maxExtent.getWidth()/tileSize.w,this.maxExtent.getHeight()/tileSize.h)),maxZoomLevel=props.maxZoomLevel,numZoomLevels=props.numZoomLevels,typeof minResolution=="number"&&typeof maxResolution=="number"&&numZoomLevels===undefined?(ratio=maxResolution/minResolution,numZoomLevels=Math.floor(Math.log(ratio)/Math.log(2))+1):numZoomLevels===undefined&&maxZoomLevel!=null&&(numZoomLevels=maxZoomLevel+1),typeof numZoomLevels=="number"&&!(numZoomLevels<=0)&&(typeof maxResolution=="number"||typeof minResolution=="number")){if(resolutions=new Array(numZoomLevels),base=2,typeof minResolution=="number"&&typeof maxResolution=="number"&&(base=Math.pow(maxResolution/minResolution,1/(numZoomLevels-1))),typeof maxResolution=="number")for(i=0;i<numZoomLevels;i++)resolutions[i]=maxResolution/Math.pow(base,i);else for(i=0;i<numZoomLevels;i++)resolutions[numZoomLevels-1-i]=minResolution*Math.pow(base,i);return resolutions}},getResolution:function(){var zoom=this.map.getZoom();return this.getResolutionForZoom(zoom)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(extent,closest){var viewSize=this.map.getSize(),idealResolution=Math.max(extent.getWidth()/viewSize.w,extent.getHeight()/viewSize.h);return this.getZoomForResolution(idealResolution,closest)},getDataExtent:function(){},getResolutionForZoom:function(zoom){var resolution,low,high;return zoom=Math.max(0,Math.min(zoom,this.resolutions.length-1)),this.map.fractionalZoom?(low=Math.floor(zoom),high=Math.ceil(zoom),resolution=this.resolutions[low]-(zoom-low)*(this.resolutions[low]-this.resolutions[high])):resolution=this.resolutions[Math.round(zoom)],resolution},getZoomForResolution:function(resolution,closest){var zoom,i,len,dRes,diff,minDiff;if(this.map.fractionalZoom){var lowZoom=0,highZoom=this.resolutions.length-1,highRes=this.resolutions[lowZoom],lowRes=this.resolutions[highZoom],res;for(i=0,len=this.resolutions.length;i<len;++i)if(res=this.resolutions[i],res>=resolution&&(highRes=res,lowZoom=i),res<=resolution){lowRes=res;highZoom=i;break}dRes=highRes-lowRes;zoom=dRes>0?lowZoom+(highRes-resolution)/dRes:lowZoom}else{for(minDiff=Number.POSITIVE_INFINITY,i=0,len=this.resolutions.length;i<len;i++)if(closest){if(diff=Math.abs(this.resolutions[i]-resolution),diff>minDiff)break;minDiff=diff}else if(this.resolutions[i]<resolution)break;zoom=Math.max(0,i-1)}return zoom},getLonLatFromViewPortPx:function(viewPortPx){var lonlat=null,map=this.map;if(viewPortPx!=null&&map.minPx){var res=map.getResolution(),maxExtent=map.getMaxExtent({restricted:!0}),lon=(viewPortPx.x-map.minPx.x)*res+maxExtent.left,lat=(map.minPx.y-viewPortPx.y)*res+maxExtent.top;lonlat=new OpenLayers.LonLat(lon,lat);this.wrapDateLine&&(lonlat=lonlat.wrapDateLine(this.maxExtent))}return lonlat},getViewPortPxFromLonLat:function(lonlat,resolution){var px=null,extent;return lonlat!=null&&(resolution=resolution||this.map.getResolution(),extent=this.map.calculateBounds(null,resolution),px=new OpenLayers.Pixel(1/resolution*(lonlat.lon-extent.left),1/resolution*(extent.top-lonlat.lat))),px},setOpacity:function(opacity){var childNodes,i,len,element,lastChild;if(opacity!=this.opacity){for(this.opacity=opacity,childNodes=this.div.childNodes,i=0,len=childNodes.length;i<len;++i)element=childNodes[i].firstChild||childNodes[i],lastChild=childNodes[i].lastChild,lastChild&&lastChild.nodeName.toLowerCase()==="iframe"&&(element=lastChild.parentNode),OpenLayers.Util.modifyDOMElement(element,null,null,null,null,null,null,opacity);this.map!=null&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(zIndex){this.div.style.zIndex=zIndex},adjustBounds:function(bounds){var mapGutter,wrappingOptions;return this.gutter&&(mapGutter=this.gutter*this.map.getResolution(),bounds=new OpenLayers.Bounds(bounds.left-mapGutter,bounds.bottom-mapGutter,bounds.right+mapGutter,bounds.top+mapGutter)),this.wrapDateLine&&(wrappingOptions={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()},bounds=bounds.wrapDateLine(this.maxExtent,wrappingOptions)),bounds},CLASS_NAME:"OpenLayers.Layer"});OpenLayers.Layer.SphericalMercator={getExtent:function(){return this.sphericalMercator?this.map.calculateBounds():OpenLayers.Layer.FixedZoomLevels.prototype.getExtent.apply(this)},getLonLatFromViewPortPx:function(){return OpenLayers.Layer.prototype.getLonLatFromViewPortPx.apply(this,arguments)},getViewPortPxFromLonLat:function(){return OpenLayers.Layer.prototype.getViewPortPxFromLonLat.apply(this,arguments)},initMercatorParameters:function(){var maxResolution,zoom;for(this.RESOLUTIONS=[],maxResolution=156543.03390625,zoom=0;zoom<=this.MAX_ZOOM_LEVEL;++zoom)this.RESOLUTIONS[zoom]=maxResolution/Math.pow(2,zoom);this.units="m";this.projection=this.projection||"EPSG:900913"},forwardMercator:function(){var gg=new OpenLayers.Projection("EPSG:4326"),sm=new OpenLayers.Projection("EPSG:900913");return function(lon,lat){var point=OpenLayers.Projection.transform({x:lon,y:lat},gg,sm);return new OpenLayers.LonLat(point.x,point.y)}}(),inverseMercator:function(){var gg=new OpenLayers.Projection("EPSG:4326"),sm=new OpenLayers.Projection("EPSG:900913");return function(x,y){var point=OpenLayers.Projection.transform({x:x,y:y},sm,gg);return new OpenLayers.LonLat(point.x,point.y)}}()};OpenLayers.Layer.EventPane=OpenLayers.Class(OpenLayers.Layer,{smoothDragPan:!0,isBaseLayer:!0,isFixed:!0,pane:null,mapObject:null,initialize:function(){OpenLayers.Layer.prototype.initialize.apply(this,arguments);this.pane==null&&(this.pane=OpenLayers.Util.createDiv(this.div.id+"_EventPane"))},destroy:function(){this.mapObject=null;this.pane=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setMap:function(){OpenLayers.Layer.prototype.setMap.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1;this.pane.style.display=this.div.style.display;this.pane.style.width="100%";this.pane.style.height="100%";OpenLayers.BROWSER_NAME=="msie"&&(this.pane.style.background="url("+OpenLayers.Util.getImageLocation("blank.gif")+")");this.isFixed?this.map.viewPortDiv.appendChild(this.pane):this.map.layerContainerDiv.appendChild(this.pane);this.loadMapObject();this.mapObject==null&&this.loadWarningMessage()},removeMap:function(){this.pane&&this.pane.parentNode&&this.pane.parentNode.removeChild(this.pane);OpenLayers.Layer.prototype.removeMap.apply(this,arguments)},loadWarningMessage:function(){this.div.style.backgroundColor="darkblue";var viewSize=this.map.getSize(),msgW=Math.min(viewSize.w,300),msgH=Math.min(viewSize.h,200),size=new OpenLayers.Size(msgW,msgH),centerPx=new OpenLayers.Pixel(viewSize.w/2,viewSize.h/2),topLeft=centerPx.add(-size.w/2,-size.h/2),div=OpenLayers.Util.createDiv(this.name+"_warning",topLeft,size,null,null,null,"auto");div.style.padding="7px";div.style.backgroundColor="yellow";div.innerHTML=this.getWarningHTML();this.div.appendChild(div)},getWarningHTML:function(){return""},display:function(){OpenLayers.Layer.prototype.display.apply(this,arguments);this.pane.style.display=this.div.style.display},setZIndex:function(){OpenLayers.Layer.prototype.setZIndex.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1},moveByPx:function(dx,dy){OpenLayers.Layer.prototype.moveByPx.apply(this,arguments);this.dragPanMapObject?this.dragPanMapObject(dx,-dy):this.moveTo(this.map.getCachedCenter())},moveTo:function(bounds,zoomChanged,dragging){var newCenter,newZoom,oldPx,newPx,center,zoom;if(OpenLayers.Layer.prototype.moveTo.apply(this,arguments),this.mapObject!=null&&(newCenter=this.map.getCenter(),newZoom=this.map.getZoom(),newCenter!=null)){var moOldCenter=this.getMapObjectCenter(),oldCenter=this.getOLLonLatFromMapObjectLonLat(moOldCenter),moOldZoom=this.getMapObjectZoom(),oldZoom=this.getOLZoomFromMapObjectZoom(moOldZoom);newCenter.equals(oldCenter)&&newZoom==oldZoom||(!zoomChanged&&oldCenter&&this.dragPanMapObject&&this.smoothDragPan?(oldPx=this.map.getViewPortPxFromLonLat(oldCenter),newPx=this.map.getViewPortPxFromLonLat(newCenter),this.dragPanMapObject(newPx.x-oldPx.x,oldPx.y-newPx.y)):(center=this.getMapObjectLonLatFromOLLonLat(newCenter),zoom=this.getMapObjectZoomFromOLZoom(newZoom),this.setMapObjectCenter(center,zoom,dragging)))}},getLonLatFromViewPortPx:function(viewPortPx){var lonlat=null,moPixel,moLonLat;return this.mapObject!=null&&this.getMapObjectCenter()!=null&&(moPixel=this.getMapObjectPixelFromOLPixel(viewPortPx),moLonLat=this.getMapObjectLonLatFromMapObjectPixel(moPixel),lonlat=this.getOLLonLatFromMapObjectLonLat(moLonLat)),lonlat},getViewPortPxFromLonLat:function(lonlat){var viewPortPx=null,moLonLat,moPixel;return this.mapObject!=null&&this.getMapObjectCenter()!=null&&(moLonLat=this.getMapObjectLonLatFromOLLonLat(lonlat),moPixel=this.getMapObjectPixelFromMapObjectLonLat(moLonLat),viewPortPx=this.getOLPixelFromMapObjectPixel(moPixel)),viewPortPx},getOLLonLatFromMapObjectLonLat:function(moLonLat){var olLonLat=null,lon,lat;return moLonLat!=null&&(lon=this.getLongitudeFromMapObjectLonLat(moLonLat),lat=this.getLatitudeFromMapObjectLonLat(moLonLat),olLonLat=new OpenLayers.LonLat(lon,lat)),olLonLat},getMapObjectLonLatFromOLLonLat:function(olLonLat){var moLatLng=null;return olLonLat!=null&&(moLatLng=this.getMapObjectLonLatFromLonLat(olLonLat.lon,olLonLat.lat)),moLatLng},getOLPixelFromMapObjectPixel:function(moPixel){var olPixel=null,x,y;return moPixel!=null&&(x=this.getXFromMapObjectPixel(moPixel),y=this.getYFromMapObjectPixel(moPixel),olPixel=new OpenLayers.Pixel(x,y)),olPixel},getMapObjectPixelFromOLPixel:function(olPixel){var moPixel=null;return olPixel!=null&&(moPixel=this.getMapObjectPixelFromXY(olPixel.x,olPixel.y)),moPixel},CLASS_NAME:"OpenLayers.Layer.EventPane"});OpenLayers.Layer.FixedZoomLevels=OpenLayers.Class({initialize:function(){},initResolutions:function(){for(var property,desiredZoomLevels,limitZoomLevels,resolutionsIndex,props=["minZoomLevel","maxZoomLevel","numZoomLevels"],i=0,len=props.length;i<len;i++)property=props[i],this[property]=this.options[property]!=null?this.options[property]:this.map[property];if((this.minZoomLevel==null||this.minZoomLevel<this.MIN_ZOOM_LEVEL)&&(this.minZoomLevel=this.MIN_ZOOM_LEVEL),limitZoomLevels=this.MAX_ZOOM_LEVEL-this.minZoomLevel+1,desiredZoomLevels=this.options.numZoomLevels==null&&this.options.maxZoomLevel!=null||this.numZoomLevels==null&&this.maxZoomLevel!=null?this.maxZoomLevel-this.minZoomLevel+1:this.numZoomLevels,this.numZoomLevels=desiredZoomLevels!=null?Math.min(desiredZoomLevels,limitZoomLevels):limitZoomLevels,this.maxZoomLevel=this.minZoomLevel+this.numZoomLevels-1,this.RESOLUTIONS!=null){for(resolutionsIndex=0,this.resolutions=[],i=this.minZoomLevel;i<=this.maxZoomLevel;i++)this.resolutions[resolutionsIndex++]=this.RESOLUTIONS[i];this.maxResolution=this.resolutions[0];this.minResolution=this.resolutions[this.resolutions.length-1]}},getResolution:function(){if(this.resolutions!=null)return OpenLayers.Layer.prototype.getResolution.apply(this,arguments);var resolution=null,viewSize=this.map.getSize(),extent=this.getExtent();return viewSize!=null&&extent!=null&&(resolution=Math.max(extent.getWidth()/viewSize.w,extent.getHeight()/viewSize.h)),resolution},getExtent:function(){var size=this.map.getSize(),tl=this.getLonLatFromViewPortPx({x:0,y:0}),br=this.getLonLatFromViewPortPx({x:size.w,y:size.h});return tl!=null&&br!=null?new OpenLayers.Bounds(tl.lon,br.lat,br.lon,tl.lat):null},getZoomForResolution:function(){if(this.resolutions!=null)return OpenLayers.Layer.prototype.getZoomForResolution.apply(this,arguments);var extent=OpenLayers.Layer.prototype.getExtent.apply(this,[]);return this.getZoomForExtent(extent)},getOLZoomFromMapObjectZoom:function(moZoom){var zoom=null;return moZoom!=null&&(zoom=moZoom-this.minZoomLevel,this.map.baseLayer!==this&&(zoom=this.map.baseLayer.getZoomForResolution(this.getResolutionForZoom(zoom)))),zoom},getMapObjectZoomFromOLZoom:function(olZoom){var zoom=null;return olZoom!=null&&(zoom=olZoom+this.minZoomLevel,this.map.baseLayer!==this&&(zoom=this.getZoomForResolution(this.map.baseLayer.getResolutionForZoom(zoom)))),zoom},CLASS_NAME:"OpenLayers.Layer.FixedZoomLevels"});OpenLayers.Layer.Google=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:21,RESOLUTIONS:[1.40625,.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,.0006866455078125,.00034332275390625,.000171661376953125,858306884765625e-19,4291534423828125e-20,21457672119140622e-21,10728836059570311e-21,536441802978515e-20,268220901489257e-20,13411045074462891e-22,67055225372314453e-23],type:null,wrapDateLine:!0,sphericalMercator:!1,version:null,initialize:function(name,options){options=options||{};options.version||(options.version=typeof GMap2=="function"?"2":"3");var mixin=OpenLayers.Layer.Google["v"+options.version.replace(/\./g,"_")];if(mixin)OpenLayers.Util.applyDefaults(options,mixin);else throw"Unsupported Google Maps API version: "+options.version;OpenLayers.Util.applyDefaults(options,mixin.DEFAULTS);options.maxExtent&&(options.maxExtent=options.maxExtent.clone());OpenLayers.Layer.EventPane.prototype.initialize.apply(this,[name,options]);OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,[name,options]);this.sphericalMercator&&(OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator),this.initMercatorParameters())},clone:function(){return new OpenLayers.Layer.Google(this.name,this.getOptions())},setVisibility:function(){var opacity=this.opacity==null?1:this.opacity;OpenLayers.Layer.EventPane.prototype.setVisibility.apply(this,arguments);this.setOpacity(opacity)},display:function(visible){this._dragging||this.setGMapVisibility(visible);OpenLayers.Layer.EventPane.prototype.display.apply(this,arguments)},moveTo:function(bounds,zoomChanged,dragging){this._dragging=dragging;OpenLayers.Layer.EventPane.prototype.moveTo.apply(this,arguments);delete this._dragging},setOpacity:function(opacity){if(opacity!==this.opacity&&(this.map!=null&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"}),this.opacity=opacity),this.getVisibility()){var container=this.getMapContainer();OpenLayers.Util.modifyDOMElement(container,null,null,null,null,null,null,opacity)}},destroy:function(){if(this.map){this.setGMapVisibility(!1);var cache=OpenLayers.Layer.Google.cache[this.map.id];cache&&cache.count<=1&&this.removeGMapElements()}OpenLayers.Layer.EventPane.prototype.destroy.apply(this,arguments)},removeGMapElements:function(){var cache=OpenLayers.Layer.Google.cache[this.map.id],container,termsOfUse,poweredBy;cache&&(container=this.mapObject&&this.getMapContainer(),container&&container.parentNode&&container.parentNode.removeChild(container),termsOfUse=cache.termsOfUse,termsOfUse&&termsOfUse.parentNode&&termsOfUse.parentNode.removeChild(termsOfUse),poweredBy=cache.poweredBy,poweredBy&&poweredBy.parentNode&&poweredBy.parentNode.removeChild(poweredBy))},removeMap:function(map){this.visibility&&this.mapObject&&this.setGMapVisibility(!1);var cache=OpenLayers.Layer.Google.cache[map.id];cache&&(cache.count<=1?(this.removeGMapElements(),delete OpenLayers.Layer.Google.cache[map.id]):--cache.count);delete this.termsOfUse;delete this.poweredBy;delete this.mapObject;delete this.dragObject;OpenLayers.Layer.EventPane.prototype.removeMap.apply(this,arguments)},getOLBoundsFromMapObjectBounds:function(moBounds){var olBounds=null,sw,ne;return moBounds!=null&&(sw=moBounds.getSouthWest(),ne=moBounds.getNorthEast(),this.sphericalMercator?(sw=this.forwardMercator(sw.lng(),sw.lat()),ne=this.forwardMercator(ne.lng(),ne.lat())):(sw=new OpenLayers.LonLat(sw.lng(),sw.lat()),ne=new OpenLayers.LonLat(ne.lng(),ne.lat())),olBounds=new OpenLayers.Bounds(sw.lon,sw.lat,ne.lon,ne.lat)),olBounds},getWarningHTML:function(){return OpenLayers.i18n("googleWarning")},getMapObjectCenter:function(){return this.mapObject.getCenter()},getMapObjectZoom:function(){return this.mapObject.getZoom()},getLongitudeFromMapObjectLonLat:function(moLonLat){return this.sphericalMercator?this.forwardMercator(moLonLat.lng(),moLonLat.lat()).lon:moLonLat.lng()},getLatitudeFromMapObjectLonLat:function(moLonLat){return this.sphericalMercator?this.forwardMercator(moLonLat.lng(),moLonLat.lat()).lat:moLonLat.lat()},getXFromMapObjectPixel:function(moPixel){return moPixel.x},getYFromMapObjectPixel:function(moPixel){return moPixel.y},CLASS_NAME:"OpenLayers.Layer.Google"});OpenLayers.Layer.Google.cache={};OpenLayers.Layer.Google.v2={termsOfUse:null,poweredBy:null,dragObject:null,loadMapObject:function(){var mapObject,termsOfUse,poweredBy,cache,container,div;if(this.type||(this.type=G_NORMAL_MAP),cache=OpenLayers.Layer.Google.cache[this.map.id],cache)mapObject=cache.mapObject,termsOfUse=cache.termsOfUse,poweredBy=cache.poweredBy,++cache.count;else{container=this.map.viewPortDiv;div=document.createElement("div");div.id=this.map.id+"_GMap2Container";div.style.position="absolute";div.style.width="100%";div.style.height="100%";container.appendChild(div);try{mapObject=new GMap2(div);termsOfUse=div.lastChild;container.appendChild(termsOfUse);termsOfUse.style.zIndex="1100";termsOfUse.style.right="";termsOfUse.style.bottom="";termsOfUse.className="olLayerGoogleCopyright";poweredBy=div.lastChild;container.appendChild(poweredBy);poweredBy.style.zIndex="1100";poweredBy.style.right="";poweredBy.style.bottom="";poweredBy.className="olLayerGooglePoweredBy gmnoprint"}catch(e){throw e;}OpenLayers.Layer.Google.cache[this.map.id]={mapObject:mapObject,termsOfUse:termsOfUse,poweredBy:poweredBy,count:1}}this.mapObject=mapObject;this.termsOfUse=termsOfUse;this.poweredBy=poweredBy;OpenLayers.Util.indexOf(this.mapObject.getMapTypes(),this.type)===-1&&this.mapObject.addMapType(this.type);typeof mapObject.getDragObject=="function"?this.dragObject=mapObject.getDragObject():this.dragPanMapObject=null;this.isBaseLayer===!1&&this.setGMapVisibility(this.div.style.display!=="none")},onMapResize:function(){if(this.visibility&&this.mapObject.isLoaded())this.mapObject.checkResize();else{if(!this._resized)var layer=this,handle=GEvent.addListener(this.mapObject,"load",function(){GEvent.removeListener(handle);delete layer._resized;layer.mapObject.checkResize();layer.moveTo(layer.map.getCenter(),layer.map.getZoom())});this._resized=!0}},setGMapVisibility:function(visible){var cache=OpenLayers.Layer.Google.cache[this.map.id],container;cache&&(container=this.mapObject.getContainer(),visible===!0?(this.mapObject.setMapType(this.type),container.style.display="",this.termsOfUse.style.left="",this.termsOfUse.style.display="",this.poweredBy.style.display="",cache.displayed=this.id):(cache.displayed===this.id&&delete cache.displayed,cache.displayed||(container.style.display="none",this.termsOfUse.style.display="none",this.termsOfUse.style.left="-9999px",this.poweredBy.style.display="none")))},getMapContainer:function(){return this.mapObject.getContainer()},getMapObjectBoundsFromOLBounds:function(olBounds){var moBounds=null,sw,ne;return olBounds!=null&&(sw=this.sphericalMercator?this.inverseMercator(olBounds.bottom,olBounds.left):new OpenLayers.LonLat(olBounds.bottom,olBounds.left),ne=this.sphericalMercator?this.inverseMercator(olBounds.top,olBounds.right):new OpenLayers.LonLat(olBounds.top,olBounds.right),moBounds=new GLatLngBounds(new GLatLng(sw.lat,sw.lon),new GLatLng(ne.lat,ne.lon))),moBounds},setMapObjectCenter:function(center,zoom){this.mapObject.setCenter(center,zoom)},dragPanMapObject:function(dX,dY){this.dragObject.moveBy(new GSize(-dX,dY))},getMapObjectLonLatFromMapObjectPixel:function(moPixel){return this.mapObject.fromContainerPixelToLatLng(moPixel)},getMapObjectPixelFromMapObjectLonLat:function(moLonLat){return this.mapObject.fromLatLngToContainerPixel(moLonLat)},getMapObjectZoomFromMapObjectBounds:function(moBounds){return this.mapObject.getBoundsZoomLevel(moBounds)},getMapObjectLonLatFromLonLat:function(lon,lat){var gLatLng,lonlat;return this.sphericalMercator?(lonlat=this.inverseMercator(lon,lat),gLatLng=new GLatLng(lonlat.lat,lonlat.lon)):gLatLng=new GLatLng(lat,lon),gLatLng},getMapObjectPixelFromXY:function(x,y){return new GPoint(x,y)}};OpenLayers.Format.WFST=function(options){options=OpenLayers.Util.applyDefaults(options,OpenLayers.Format.WFST.DEFAULTS);var cls=OpenLayers.Format.WFST["v"+options.version.replace(/\./g,"_")];if(!cls)throw"Unsupported WFST version: "+options.version;return new cls(options)};OpenLayers.Format.WFST.DEFAULTS={version:"1.0.0"};OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:!0,xy:!0,stateName:null,initialize:function(options){this.stateName={};this.stateName[OpenLayers.State.INSERT]="wfs:Insert";this.stateName[OpenLayers.State.UPDATE]="wfs:Update";this.stateName[OpenLayers.State.DELETE]="wfs:Delete";OpenLayers.Format.XML.prototype.initialize.apply(this,[options])},getSrsName:function(feature,options){var srsName=options&&options.srsName;return srsName||(srsName=feature&&feature.layer?feature.layer.projection.getCode():this.srsName),srsName},read:function(data,options){options=options||{};OpenLayers.Util.applyDefaults(options,{output:"features"});typeof data=="string"&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data]));data&&data.nodeType==9&&(data=data.documentElement);var obj={};return data&&this.readNode(data,obj,!0),obj.features&&options.output==="features"&&(obj=obj.features),obj},readers:{wfs:{FeatureCollection:function(node,obj){obj.features=[];this.readChildNodes(node,obj)}}},write:function(features,options){var node=this.writeNode("wfs:Transaction",{features:features,options:options}),value=this.schemaLocationAttr();return value&&this.setAttributeNS(node,this.namespaces.xsi,"xsi:schemaLocation",value),OpenLayers.Format.XML.prototype.write.apply(this,[node])},writers:{wfs:{GetFeature:function(options){var node=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,handle:options&&options.handle,outputFormat:options&&options.outputFormat,maxFeatures:options&&options.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(options)}}),i,len;if(typeof this.featureType=="string")this.writeNode("Query",options,node);else for(i=0,len=this.featureType.length;i<len;i++)options.featureType=this.featureType[i],this.writeNode("Query",options,node);return node},Transaction:function(obj){var name,feature;obj=obj||{};var options=obj.options||{},node=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version,handle:options.handle}}),i,len,features=obj.features;if(features){for(options.multi===!0&&OpenLayers.Util.extend(this.geometryTypes,{"OpenLayers.Geometry.Point":"MultiPoint","OpenLayers.Geometry.LineString":this.multiCurve===!0?"MultiCurve":"MultiLineString","OpenLayers.Geometry.Polygon":this.multiSurface===!0?"MultiSurface":"MultiPolygon"}),i=0,len=features.length;i<len;++i)feature=features[i],name=this.stateName[feature.state],name&&this.writeNode(name,{feature:feature,options:options},node);options.multi===!0&&this.setGeometryTypes()}if(options.nativeElements)for(i=0,len=options.nativeElements.length;i<len;++i)this.writeNode("wfs:Native",options.nativeElements[i],node);return node},Native:function(nativeElement){return this.createElementNSPlus("wfs:Native",{attributes:{vendorId:nativeElement.vendorId,safeToIgnore:nativeElement.safeToIgnore},value:nativeElement.value})},Insert:function(obj){var feature=obj.feature,options=obj.options,node=this.createElementNSPlus("wfs:Insert",{attributes:{handle:options&&options.handle}});return this.srsName=this.getSrsName(feature),this.writeNode("feature:_typeName",feature,node),node},Update:function(obj){var feature=obj.feature,options=obj.options,node=this.createElementNSPlus("wfs:Update",{attributes:{handle:options&&options.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}}),modified,key;this.featureNS&&node.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);modified=feature.modified;this.geometryName===null||modified&&modified.geometry===undefined||(this.srsName=this.getSrsName(feature),this.writeNode("Property",{name:this.geometryName,value:feature.geometry},node));for(key in feature.attributes)feature.attributes[key]===undefined||modified&&modified.attributes&&(!modified.attributes||modified.attributes[key]===undefined)||this.writeNode("Property",{name:key,value:feature.attributes[key]},node);return this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[feature.fid]}),node),node},Property:function(obj){var node=this.createElementNSPlus("wfs:Property");return this.writeNode("Name",obj.name,node),obj.value!==null&&this.writeNode("Value",obj.value,node),node},Name:function(name){return this.createElementNSPlus("wfs:Name",{value:name})},Value:function(obj){var node,geom;return obj instanceof OpenLayers.Geometry?(node=this.createElementNSPlus("wfs:Value"),geom=this.writeNode("feature:_geometry",obj).firstChild,node.appendChild(geom)):node=this.createElementNSPlus("wfs:Value",{value:obj}),node},Delete:function(obj){var feature=obj.feature,options=obj.options,node=this.createElementNSPlus("wfs:Delete",{attributes:{handle:options&&options.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});return this.featureNS&&node.setAttribute("xmlns:"+this.featurePrefix,this.featureNS),this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[feature.fid]}),node),node}}},schemaLocationAttr:function(options){var schemaLocations,parts,uri,key;options=OpenLayers.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},options);schemaLocations=OpenLayers.Util.extend({},this.schemaLocations);options.schema&&(schemaLocations[options.featurePrefix]=options.schema);parts=[];for(key in schemaLocations)uri=this.namespaces[key],uri&&parts.push(uri+" "+schemaLocations[key]);return parts.join(" ")||undefined},setFilterProperty:function(filter){if(filter.filters)for(var i=0,len=filter.filters.length;i<len;++i)OpenLayers.Format.WFST.v1.prototype.setFilterProperty.call(this,filter.filters[i]);else filter instanceof OpenLayers.Filter.Spatial&&!filter.property&&(filter.property=this.geometryName)},CLASS_NAME:"OpenLayers.Format.WFST.v1"});OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:!1,multiCurve:!0,surface:!1,multiSurface:!0,initialize:function(options){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[options])},readers:{gml:OpenLayers.Util.applyDefaults({_inherit:function(node,obj,container){var dim=parseInt(node.getAttribute("srsDimension"),10)||container&&container.srsDimension;dim&&(obj.srsDimension=dim)},featureMembers:function(node,obj){this.readChildNodes(node,obj)},Curve:function(node,container){var obj={points:[]};this.readers.gml._inherit.apply(this,[node,obj,container]);this.readChildNodes(node,obj);container.components||(container.components=[]);container.components.push(new OpenLayers.Geometry.LineString(obj.points))},segments:function(node,obj){this.readChildNodes(node,obj)},LineStringSegment:function(node,container){var obj={};this.readChildNodes(node,obj);obj.points&&Array.prototype.push.apply(container.points,obj.points)},pos:function(node,obj){var str=this.getChildValue(node).replace(this.regExes.trimSpace,""),coords=str.split(this.regExes.splitSpace),point;point=this.xy?new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2]):new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2]);obj.points=[point]},posList:function(node,obj){for(var str=this.getChildValue(node).replace(this.regExes.trimSpace,""),coords=str.split(this.regExes.splitSpace),dim=obj.srsDimension||parseInt(node.getAttribute("srsDimension")||node.getAttribute("dimension"),10)||2,x,y,z,numPoints=coords.length/dim,points=new Array(numPoints),i=0,len=coords.length;i<len;i+=dim)x=coords[i],y=coords[i+1],z=dim==2?undefined:coords[i+2],points[i/dim]=this.xy?new OpenLayers.Geometry.Point(x,y,z):new OpenLayers.Geometry.Point(y,x,z);obj.points=points},Surface:function(node,obj){this.readChildNodes(node,obj)},patches:function(node,obj){this.readChildNodes(node,obj)},PolygonPatch:function(node,obj){this.readers.gml.Polygon.apply(this,[node,obj])},exterior:function(node,container){var obj={};this.readChildNodes(node,obj);container.outer=obj.components[0]},interior:function(node,container){var obj={};this.readChildNodes(node,obj);container.inner.push(obj.components[0])},MultiCurve:function(node,container){var obj={components:[]};this.readers.gml._inherit.apply(this,[node,obj,container]);this.readChildNodes(node,obj);obj.components.length>0&&(container.components=[new OpenLayers.Geometry.MultiLineString(obj.components)])},curveMember:function(node,obj){this.readChildNodes(node,obj)},MultiSurface:function(node,container){var obj={components:[]};this.readers.gml._inherit.apply(this,[node,obj,container]);this.readChildNodes(node,obj);obj.components.length>0&&(container.components=[new OpenLayers.Geometry.MultiPolygon(obj.components)])},surfaceMember:function(node,obj){this.readChildNodes(node,obj)},surfaceMembers:function(node,obj){this.readChildNodes(node,obj)},pointMembers:function(node,obj){this.readChildNodes(node,obj)},lineStringMembers:function(node,obj){this.readChildNodes(node,obj)},polygonMembers:function(node,obj){this.readChildNodes(node,obj)},geometryMembers:function(node,obj){this.readChildNodes(node,obj)},Envelope:function(node,container){var obj={points:new Array(2)},min,max;this.readChildNodes(node,obj);container.components||(container.components=[]);min=obj.points[0];max=obj.points[1];container.components.push(new OpenLayers.Bounds(min.x,min.y,max.x,max.y))},lowerCorner:function(node,container){var obj={};this.readers.gml.pos.apply(this,[node,obj]);container.points[0]=obj.points[0]},upperCorner:function(node,container){var obj={};this.readers.gml.pos.apply(this,[node,obj]);container.points[1]=obj.points[0]}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(features){var name,root;return name=OpenLayers.Util.isArray(features)?"featureMembers":"featureMember",root=this.writeNode("gml:"+name,features),this.setAttributeNS(root,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[root])},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(features){for(var node=this.createElementNSPlus("gml:featureMembers"),i=0,len=features.length;i<len;++i)this.writeNode("feature:_typeName",features[i],node);return node},Point:function(geometry){var node=this.createElementNSPlus("gml:Point");return this.writeNode("pos",geometry,node),node},pos:function(point){var pos=this.xy?point.x+" "+point.y:point.y+" "+point.x;return this.createElementNSPlus("gml:pos",{value:pos})},LineString:function(geometry){var node=this.createElementNSPlus("gml:LineString");return this.writeNode("posList",geometry.components,node),node},Curve:function(geometry){var node=this.createElementNSPlus("gml:Curve");return this.writeNode("segments",geometry,node),node},segments:function(geometry){var node=this.createElementNSPlus("gml:segments");return this.writeNode("LineStringSegment",geometry,node),node},LineStringSegment:function(geometry){var node=this.createElementNSPlus("gml:LineStringSegment");return this.writeNode("posList",geometry.components,node),node},posList:function(points){for(var len=points.length,parts=new Array(len),point,i=0;i<len;++i)point=points[i],parts[i]=this.xy?point.x+" "+point.y:point.y+" "+point.x;return this.createElementNSPlus("gml:posList",{value:parts.join(" ")})},Surface:function(geometry){var node=this.createElementNSPlus("gml:Surface");return this.writeNode("patches",geometry,node),node},patches:function(geometry){var node=this.createElementNSPlus("gml:patches");return this.writeNode("PolygonPatch",geometry,node),node},PolygonPatch:function(geometry){var node=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}}),i,len;for(this.writeNode("exterior",geometry.components[0],node),i=1,len=geometry.components.length;i<len;++i)this.writeNode("interior",geometry.components[i],node);return node},Polygon:function(geometry){var node=this.createElementNSPlus("gml:Polygon"),i,len;for(this.writeNode("exterior",geometry.components[0],node),i=1,len=geometry.components.length;i<len;++i)this.writeNode("interior",geometry.components[i],node);return node},exterior:function(ring){var node=this.createElementNSPlus("gml:exterior");return this.writeNode("LinearRing",ring,node),node},interior:function(ring){var node=this.createElementNSPlus("gml:interior");return this.writeNode("LinearRing",ring,node),node},LinearRing:function(ring){var node=this.createElementNSPlus("gml:LinearRing");return this.writeNode("posList",ring.components,node),node},MultiCurve:function(geometry){for(var node=this.createElementNSPlus("gml:MultiCurve"),components=geometry.components||[geometry],i=0,len=components.length;i<len;++i)this.writeNode("curveMember",components[i],node);return node},curveMember:function(geometry){var node=this.createElementNSPlus("gml:curveMember");return this.curve?this.writeNode("Curve",geometry,node):this.writeNode("LineString",geometry,node),node},MultiSurface:function(geometry){for(var node=this.createElementNSPlus("gml:MultiSurface"),components=geometry.components||[geometry],i=0,len=components.length;i<len;++i)this.writeNode("surfaceMember",components[i],node);return node},surfaceMember:function(polygon){var node=this.createElementNSPlus("gml:surfaceMember");return this.surface?this.writeNode("Surface",polygon,node):this.writeNode("Polygon",polygon,node),node},Envelope:function(bounds){var node=this.createElementNSPlus("gml:Envelope");return this.writeNode("lowerCorner",bounds,node),this.writeNode("upperCorner",bounds,node),this.srsName&&node.setAttribute("srsName",this.srsName),node},lowerCorner:function(bounds){var pos=this.xy?bounds.left+" "+bounds.bottom:bounds.bottom+" "+bounds.left;return this.createElementNSPlus("gml:lowerCorner",{value:pos})},upperCorner:function(bounds){var pos=this.xy?bounds.right+" "+bounds.top:bounds.top+" "+bounds.right;return this.createElementNSPlus("gml:upperCorner",{value:pos})}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":this.curve===!0?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":this.multiCurve===!1?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":this.surface===!0?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":this.multiSurface===!1?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.v3"});OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(options){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[options])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(node,obj){var matchCase=node.getAttribute("matchCase"),filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!(matchCase==="false"||matchCase==="0")});this.readChildNodes(node,filter);obj.filters.push(filter)},PropertyIsNotEqualTo:function(node,obj){var matchCase=node.getAttribute("matchCase"),filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!(matchCase==="false"||matchCase==="0")});this.readChildNodes(node,filter);obj.filters.push(filter)},PropertyIsLike:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(node,filter);var wildCard=node.getAttribute("wildCard"),singleChar=node.getAttribute("singleChar"),esc=node.getAttribute("escapeChar");filter.value2regex(wildCard,singleChar,esc);obj.filters.push(filter)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:filter.matchCase}});return this.writeNode("PropertyName",filter,node),this.writeOgcExpression(filter.value,node),node},PropertyIsNotEqualTo:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:filter.matchCase}});return this.writeNode("PropertyName",filter,node),this.writeOgcExpression(filter.value,node),node},PropertyIsLike:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{matchCase:filter.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"}});return this.writeNode("PropertyName",filter,node),this.writeNode("Literal",filter.regex2value(),node),node},BBOX:function(filter){var node=this.createElementNSPlus("ogc:BBOX"),box;return filter.property&&this.writeNode("PropertyName",filter,node),box=this.writeNode("gml:Envelope",filter.value),filter.projection&&box.setAttribute("srsName",filter.projection),node.appendChild(box),node},SortBy:function(sortProperties){for(var node=this.createElementNSPlus("ogc:SortBy"),i=0,l=sortProperties.length;i<l;i++)this.writeNode("ogc:SortProperty",sortProperties[i],node);return node},SortProperty:function(sortProperty){var node=this.createElementNSPlus("ogc:SortProperty");return this.writeNode("ogc:PropertyName",sortProperty,node),this.writeNode("ogc:SortOrder",sortProperty.order=="DESC"?"DESC":"ASC",node),node},SortOrder:function(value){return this.createElementNSPlus("ogc:SortOrder",{value:value})}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(filter,name){var node=this.createElementNSPlus("ogc:"+name),child;return this.writeNode("PropertyName",filter,node),filter.value instanceof OpenLayers.Filter.Function?this.writeNode("Function",filter.value,node):(child=filter.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",filter.value).firstChild:this.writeNode("gml:Envelope",filter.value),filter.projection&&child.setAttribute("srsName",filter.projection),node.appendChild(child)),node},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"});OpenLayers.Format.WFST.v1_1_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_1_0,OpenLayers.Format.WFST.v1,{version:"1.1.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(options){OpenLayers.Format.Filter.v1_1_0.prototype.initialize.apply(this,[options]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[options])},readNode:function(){return OpenLayers.Format.GML.v3.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({FeatureCollection:function(node,obj){obj.numberOfFeatures=parseInt(node.getAttribute("numberOfFeatures"));OpenLayers.Format.WFST.v1.prototype.readers.wfs.FeatureCollection.apply(this,arguments)},TransactionResponse:function(node,obj){obj.insertIds=[];obj.success=!1;this.readChildNodes(node,obj)},TransactionSummary:function(node,obj){obj.success=!0},InsertResults:function(node,obj){this.readChildNodes(node,obj)},Feature:function(node,container){var obj={fids:[]};this.readChildNodes(node,obj);container.insertIds.push(obj.fids[0])}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.readers.ogc,ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows},writers:{wfs:OpenLayers.Util.applyDefaults({GetFeature:function(options){var node=OpenLayers.Format.WFST.v1.prototype.writers.wfs.GetFeature.apply(this,arguments);return options&&this.setAttributes(node,{resultType:options.resultType,startIndex:options.startIndex,count:options.count}),node},Query:function(options){var prefix,node,i,len;if(options=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},options),prefix=options.featurePrefix,node=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(prefix?prefix+":":"")+options.featureType,srsName:options.srsName}}),options.featureNS&&node.setAttribute("xmlns:"+prefix,options.featureNS),options.propertyNames)for(i=0,len=options.propertyNames.length;i<len;i++)this.writeNode("wfs:PropertyName",{property:options.propertyNames[i]},node);return options.filter&&(OpenLayers.Format.WFST.v1_1_0.prototype.setFilterProperty.call(this,options.filter),this.writeNode("ogc:Filter",options.filter,node)),node},PropertyName:function(obj){return this.createElementNSPlus("wfs:PropertyName",{value:obj.property})}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_1_0"});OpenLayers.Format.WFSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",errorProperty:"service",CLASS_NAME:"OpenLayers.Format.WFSCapabilities"});OpenLayers.Format.WFSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wfs:"http://www.opengis.net/wfs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",read:function(data){var raw,capabilities;return typeof data=="string"&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data])),raw=data,data&&data.nodeType==9&&(data=data.documentElement),capabilities={},this.readNode(data,capabilities),capabilities},readers:{wfs:{WFS_Capabilities:function(node,obj){this.readChildNodes(node,obj)},FeatureTypeList:function(node,request){request.featureTypeList={featureTypes:[]};this.readChildNodes(node,request.featureTypeList)},FeatureType:function(node,featureTypeList){var featureType={};this.readChildNodes(node,featureType);featureTypeList.featureTypes.push(featureType)},Name:function(node,obj){var name=this.getChildValue(node),parts;name&&(parts=name.split(":"),obj.name=parts.pop(),parts.length>0&&(obj.featureNS=this.lookupNamespaceURI(node,parts[0])))},Title:function(node,obj){var title=this.getChildValue(node);title&&(obj.title=title)},Abstract:function(node,obj){var abst=this.getChildValue(node);abst&&(obj.abstract=abst)}}},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1"});OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,{controls:null,autoActivate:!0,defaultControl:null,saveState:!1,allowDepress:!1,activeState:null,initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,[options]);this.controls=[];this.activeState={}},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick);OpenLayers.Control.prototype.destroy.apply(this,arguments);for(var ctl,i=this.controls.length-1;i>=0;i--)ctl=this.controls[i],ctl.events&&ctl.events.un({activate:this.iconOn,deactivate:this.iconOff}),ctl.panel_div=null;this.activeState=null},activate:function(){var control,i,len;if(OpenLayers.Control.prototype.activate.apply(this,arguments)){for(i=0,len=this.controls.length;i<len;i++)control=this.controls[i],(control===this.defaultControl||this.saveState&&this.activeState[control.id])&&control.activate();return this.saveState===!0&&(this.defaultControl=null),this.redraw(),!0}return!1},deactivate:function(){var control,i,len;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){for(i=0,len=this.controls.length;i<len;i++)control=this.controls[i],this.activeState[control.id]=control.deactivate();return this.redraw(),!0}return!1},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick),this.addControlsToMap(this.controls),this.div},redraw:function(){for(var len,l=this.div.childNodes.length,i=l-1;i>=0;i--)this.div.removeChild(this.div.childNodes[i]);if(this.div.innerHTML="",this.active)for(i=0,len=this.controls.length;i<len;i++)this.div.appendChild(this.controls[i].panel_div)},activateControl:function(control){var c,i,len;if(!this.active)return!1;if(control.type==OpenLayers.Control.TYPE_BUTTON){control.trigger();return}if(control.type==OpenLayers.Control.TYPE_TOGGLE){control.active?control.deactivate():control.activate();return}if(this.allowDepress&&control.active)control.deactivate();else{for(i=0,len=this.controls.length;i<len;i++)c=this.controls[i],c!=control&&(c.type===OpenLayers.Control.TYPE_TOOL||c.type==null)&&c.deactivate();control.activate()}},addControls:function(controls){var i,len,control,element;for(OpenLayers.Util.isArray(controls)||(controls=[controls]),this.controls=this.controls.concat(controls),i=0,len=controls.length;i<len;i++)control=controls[i],element=this.createControlMarkup(control),OpenLayers.Element.addClass(element,control.displayClass+"ItemInactive"),OpenLayers.Element.addClass(element,"olButton"),control.title==""||element.title||(element.title=control.title),control.panel_div=element;this.map&&(this.addControlsToMap(controls),this.redraw())},createControlMarkup:function(){return document.createElement("div")},addControlsToMap:function(controls){for(var control,i=0,len=controls.length;i<len;i++){control=controls[i];control.autoActivate===!0?(control.autoActivate=!1,this.map.addControl(control),control.autoActivate=!0):(this.map.addControl(control),control.deactivate());control.events.on({activate:this.iconOn,deactivate:this.iconOff})}},iconOn:function(){var d=this.panel_div,re=new RegExp("\\b("+this.displayClass+"Item)Inactive\\b");d.className=d.className.replace(re,"$1Active")},iconOff:function(){var d=this.panel_div,re=new RegExp("\\b("+this.displayClass+"Item)Active\\b");d.className=d.className.replace(re,"$1Inactive")},onButtonClick:function(evt){for(var controls=this.controls,button=evt.buttonElement,i=controls.length-1;i>=0;--i)if(controls[i].panel_div===button){this.activateControl(controls[i]);break}},getControlsBy:function(property,match){var test=typeof match.test=="function";return OpenLayers.Array.filter(this.controls,function(item){return item[property]==match||test&&match.test(item[property])})},getControlsByName:function(match){return this.getControlsBy("name",match)},getControlsByClass:function(match){return this.getControlsBy("CLASS_NAME",match)},CLASS_NAME:"OpenLayers.Control.Panel"});OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"});OpenLayers.Control.ZoomIn=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomIn()},CLASS_NAME:"OpenLayers.Control.ZoomIn"});OpenLayers.Control.ZoomOut=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomOut()},CLASS_NAME:"OpenLayers.Control.ZoomOut"});OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomToMaxExtent()},CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"});OpenLayers.Control.ZoomPanel=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(options){OpenLayers.Control.Panel.prototype.initialize.apply(this,[options]);this.addControls([new OpenLayers.Control.ZoomIn,new OpenLayers.Control.ZoomToMaxExtent,new OpenLayers.Control.ZoomOut])},CLASS_NAME:"OpenLayers.Control.ZoomPanel"});OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:!1,initialize:function(name,url,params,options){OpenLayers.Layer.prototype.initialize.apply(this,[name,options]);this.url=url;this.params||(this.params=OpenLayers.Util.extend({},params))},destroy:function(){this.url=null;this.params=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(obj){return obj==null&&(obj=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions())),OpenLayers.Layer.prototype.clone.apply(this,[obj])},setUrl:function(newUrl){this.url=newUrl},mergeNewParams:function(newParams){this.params=OpenLayers.Util.extend(this.params,newParams);var ret=this.redraw();return this.map!=null&&this.map.events.triggerEvent("changelayer",{layer:this,property:"params"}),ret},redraw:function(force){return force?this.mergeNewParams({_olSalt:Math.random()}):OpenLayers.Layer.prototype.redraw.apply(this,[])},selectUrl:function(paramString,urls){for(var product=1,i=0,len=paramString.length;i<len;i++)product*=paramString.charCodeAt(i)*this.URL_HASH_FACTOR,product-=Math.floor(product);return urls[Math.floor(product*urls.length)]},getFullRequestString:function(newParams,altUrl){var url=altUrl||this.url,allParams=OpenLayers.Util.extend({},this.params),paramsString,urlParams,key;allParams=OpenLayers.Util.extend(allParams,newParams);paramsString=OpenLayers.Util.getParameterString(allParams);OpenLayers.Util.isArray(url)&&(url=this.selectUrl(paramsString,url));urlParams=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(url));for(key in allParams)key.toUpperCase()in urlParams&&delete allParams[key];return paramsString=OpenLayers.Util.getParameterString(allParams),OpenLayers.Util.urlAppend(url,paramsString)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"});OpenLayers.Tile=OpenLayers.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:!1,initialize:function(layer,position,bounds,url,size,options){if(this.layer=layer,this.position=position.clone(),this.setBounds(bounds),this.url=url,size&&(this.size=size.clone()),this.id=OpenLayers.Util.createUniqueID("Tile_"),OpenLayers.Util.extend(this,options),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object)this.events.on(this.eventListeners)},unload:function(){this.isLoading&&(this.isLoading=!1,this.events.triggerEvent("unload"))},destroy:function(){this.layer=null;this.bounds=null;this.size=null;this.position=null;this.eventListeners&&this.events.un(this.eventListeners);this.events.destroy();this.eventListeners=null;this.events=null},draw:function(immediately){immediately||this.clear();var draw=this.shouldDraw();return draw&&!immediately&&(draw=this.events.triggerEvent("beforedraw")!==!1),draw},shouldDraw:function(){var withinMaxExtent=!1,maxExtent=this.layer.maxExtent,map,worldBounds;return maxExtent&&(map=this.layer.map,worldBounds=map.baseLayer.wrapDateLine&&map.getMaxExtent(),this.bounds.intersectsBounds(maxExtent,{inclusive:!1,worldBounds:worldBounds})&&(withinMaxExtent=!0)),withinMaxExtent||this.layer.displayOutsideMaxExtent},setBounds:function(bounds){if(bounds=bounds.clone(),this.layer.map.baseLayer.wrapDateLine){var worldExtent=this.layer.map.getMaxExtent(),tolerance=this.layer.map.getResolution();bounds=bounds.wrapDateLine(worldExtent,{leftTolerance:tolerance,rightTolerance:tolerance})}this.bounds=bounds},moveTo:function(bounds,position,redraw){redraw==null&&(redraw=!0);this.setBounds(bounds);this.position=position.clone();redraw&&this.draw()},clear:function(){},CLASS_NAME:"OpenLayers.Tile"});OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,blankImageUrl:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7",maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(layer,position,bounds,url){OpenLayers.Tile.prototype.initialize.apply(this,arguments);this.url=url;this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack();(this.maxGetUrlLength!=null||this.layer.gutter||this.layerAlphaHack)&&(this.frame=document.createElement("div"),this.frame.style.position="absolute",this.frame.style.overflow="hidden");this.maxGetUrlLength!=null&&OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)},destroy:function(){this.imgDiv&&(this.clear(),this.imgDiv=null,this.frame=null);this.asyncRequestId=null;OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var drawn=OpenLayers.Tile.prototype.draw.apply(this,arguments);return drawn?(this.layer!=this.layer.map.baseLayer&&this.layer.reproject&&(this.bounds=this.getBoundsFromBaseLayer(this.position)),this.isLoading?this._loadEvent="reload":(this.isLoading=!0,this._loadEvent="loadstart"),this.positionTile(),this.renderTile()):this.unload(),drawn},renderTile:function(){if(this.layer.div.appendChild(this.getTile()),this.layer.async){var id=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(url){id==this.asyncRequestId&&(this.url=url,this.initImage())},this)}else this.url=this.layer.getURL(this.bounds),this.initImage()},positionTile:function(){var style=this.getTile().style,size=this.frame?this.size:this.layer.getImageSize(this.bounds),ratio=1;this.layer instanceof OpenLayers.Layer.Grid&&(ratio=this.layer.getServerResolution()/this.layer.map.getResolution());style.left=(this.position.x|0)+"px";style.top=(this.position.y|0)+"px";style.width=Math.round(ratio*size.w)+"px";style.height=Math.round(ratio*size.h)+"px"},clear:function(){var img,tile;OpenLayers.Tile.prototype.clear.apply(this,arguments);img=this.imgDiv;img&&(OpenLayers.Event.stopObservingElement(img),tile=this.getTile(),tile.parentNode===this.layer.div&&this.layer.div.removeChild(tile),this.setImgSrc(),this.layerAlphaHack===!0&&(img.style.filter=""),OpenLayers.Element.removeClass(img,"olImageLoadError"));this.canvasContext=null},getImage:function(){var style,left,top;return this.imgDiv||(this.imgDiv=document.createElement("img"),this.imgDiv.className="olTileImage",this.imgDiv.galleryImg="no",style=this.imgDiv.style,this.frame&&(left=0,top=0,this.layer.gutter&&(left=this.layer.gutter/this.layer.tileSize.w*100,top=this.layer.gutter/this.layer.tileSize.h*100),style.left=-left+"%",style.top=-top+"%",style.width=2*left+100+"%",style.height=2*top+100+"%"),style.visibility="hidden",style.opacity=0,this.layer.opacity<1&&(style.filter="alpha(opacity="+this.layer.opacity*100+")"),style.position="absolute",this.layerAlphaHack&&(style.paddingTop=style.height,style.height="0",style.width="100%"),this.frame&&this.frame.appendChild(this.imgDiv)),this.imgDiv},initImage:function(){var img,load;this.events.triggerEvent(this._loadEvent);img=this.getImage();this.url&&img.getAttribute("src")==this.url?this.onImageLoad():(load=OpenLayers.Function.bind(function(){OpenLayers.Event.stopObservingElement(img);OpenLayers.Event.observe(img,"load",OpenLayers.Function.bind(this.onImageLoad,this));OpenLayers.Event.observe(img,"error",OpenLayers.Function.bind(this.onImageError,this));this.imageReloadAttempts=0;this.setImgSrc(this.url)},this),img.getAttribute("src")==this.blankImageUrl?load():(OpenLayers.Event.stopObservingElement(img),OpenLayers.Event.observe(img,"load",load),OpenLayers.Event.observe(img,"error",load),this.crossOriginKeyword&&img.removeAttribute("crossorigin"),img.src=this.blankImageUrl))},setImgSrc:function(url){var img=this.imgDiv;url?(img.style.visibility="hidden",img.style.opacity=0,this.crossOriginKeyword&&(url.substr(0,5)!=="data:"?img.setAttribute("crossorigin",this.crossOriginKeyword):img.removeAttribute("crossorigin")),img.src=url):(this.imgDiv=null,img.parentNode&&img.parentNode.removeChild(img))},getTile:function(){return this.frame?this.frame:this.getImage()},createBackBuffer:function(){if(this.imgDiv&&!this.isLoading){var backBuffer;return this.frame?(backBuffer=this.frame.cloneNode(!1),backBuffer.appendChild(this.imgDiv)):backBuffer=this.imgDiv,this.imgDiv=null,backBuffer}},onImageLoad:function(){var img=this.imgDiv;OpenLayers.Event.stopObservingElement(img);img.style.visibility="inherit";img.style.opacity=this.layer.opacity;this.isLoading=!1;this.canvasContext=null;this.events.triggerEvent("loadend");this.layerAlphaHack===!0&&(img.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+img.src+"', sizingMethod='scale')")},onImageError:function(){var img=this.imgDiv;img.src!=null&&(this.imageReloadAttempts++,this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS?this.setImgSrc(this.layer.getURL(this.bounds)):(OpenLayers.Element.addClass(img,"olImageLoadError"),this.events.triggerEvent("loaderror"),this.onImageLoad()))},getCanvasContext:function(){if(OpenLayers.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var canvas=document.createElement("canvas");canvas.width=this.size.w;canvas.height=this.size.h;this.canvasContext=canvas.getContext("2d");this.canvasContext.drawImage(this.imgDiv,0,0)}return this.canvasContext}},CLASS_NAME:"OpenLayers.Tile.Image"});OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:OpenLayers.Tile.Image,grid:null,singleTile:!1,ratio:1.5,buffer:0,transitionEffect:null,numLoadingTiles:0,tileLoadingDelay:85,serverResolutions:null,moveTimerId:null,deferMoveGriddedTiles:null,tileQueueId:null,tileQueue:null,loading:!1,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,gridLayout:null,initialize:function(){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments);this.grid=[];this.tileQueue=[];this.removeBackBufferDelay===null&&(this.removeBackBufferDelay=this.singleTile?0:2500);this.className===null&&(this.className=this.singleTile?"olLayerGridSingleTile":"olLayerGrid");OpenLayers.Animation.isNative||(this.deferMoveGriddedTiles=OpenLayers.Function.bind(function(){this.moveGriddedTiles(!0);this.moveTimerId=null},this))},setMap:function(map){OpenLayers.Layer.HTTPRequest.prototype.setMap.call(this,map);OpenLayers.Element.addClass(this.div,this.className)},removeMap:function(){this.moveTimerId!==null&&(window.clearTimeout(this.moveTimerId),this.moveTimerId=null);this.clearTileQueue();this.backBufferTimerId!==null&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null)},destroy:function(){this.removeBackBuffer();this.clearGrid();this.grid=null;this.tileSize=null;OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){var iRow,len,row,iCol,clen,tile;if(this.clearTileQueue(),this.grid){for(iRow=0,len=this.grid.length;iRow<len;iRow++)for(row=this.grid[iRow],iCol=0,clen=row.length;iCol<clen;iCol++)tile=row[iCol],this.destroyTile(tile);this.grid=[];this.gridResolution=null;this.gridLayout=null}},clone:function(obj){return obj==null&&(obj=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions())),obj=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[obj]),this.tileSize!=null&&(obj.tileSize=this.tileSize.clone()),obj.grid=[],obj.gridResolution=null,obj.backBuffer=null,obj.backBufferTimerId=null,obj.tileQueue=[],obj.tileQueueId=null,obj.loading=!1,obj.moveTimerId=null,obj},moveTo:function(bounds,zoomChanged,dragging){if(OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments),bounds=bounds||this.map.getExtent(),bounds!=null){var forceReTile=!this.grid.length||zoomChanged,tilesBounds=this.getTilesBounds(),resolution=this.map.getResolution(),serverResolution=this.getServerResolution(resolution);this.singleTile?!forceReTile&&(dragging||tilesBounds.containsBounds(bounds))||(zoomChanged&&this.transitionEffect!=="resize"&&this.removeBackBuffer(),zoomChanged&&this.transitionEffect!=="resize"||this.applyBackBuffer(resolution),this.initSingleTile(bounds)):(forceReTile=forceReTile||!tilesBounds.intersectsBounds(bounds,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()}),forceReTile?(zoomChanged&&this.transitionEffect==="resize"&&this.applyBackBuffer(resolution),this.initGriddedTiles(bounds)):this.moveGriddedTiles())}},getTileData:function(loc){var data=null,x=loc.lon,y=loc.lat,numRows=this.grid.length,worldWidth,worldsAway,tile;if(this.map&&numRows){var res=this.map.getResolution(),tileWidth=this.tileSize.w,tileHeight=this.tileSize.h,bounds=this.grid[0][0].bounds,left=bounds.left,top=bounds.top;x<left&&this.map.baseLayer.wrapDateLine&&(worldWidth=this.map.getMaxExtent().getWidth(),worldsAway=Math.ceil((left-x)/worldWidth),x+=worldWidth*worldsAway);var dtx=(x-left)/(res*tileWidth),dty=(top-y)/(res*tileHeight),col=Math.floor(dtx),row=Math.floor(dty);row>=0&&row<numRows&&(tile=this.grid[row][col],tile&&(data={tile:tile,i:Math.floor((dtx-col)*tileWidth),j:Math.floor((dty-row)*tileHeight)}))}return data},queueTileDraw:function(evt){var tile=evt.object;return~OpenLayers.Util.indexOf(this.tileQueue,tile)||this.tileQueue.push(tile),this.tileQueueId||(this.tileQueueId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.drawTileFromQueue,this),null,this.div)),!1},drawTileFromQueue:function(){this.tileQueue.length===0?this.clearTileQueue():this.tileQueue.shift().draw(!0)},clearTileQueue:function(){OpenLayers.Animation.stop(this.tileQueueId);this.tileQueueId=null;this.tileQueue=[]},destroyTile:function(tile){this.removeTileMonitoringHooks(tile);tile.destroy()},getServerResolution:function(resolution){var distance=Number.POSITIVE_INFINITY,i,newDistance,newResolution,serverResolution;if(resolution=resolution||this.map.getResolution(),this.serverResolutions&&OpenLayers.Util.indexOf(this.serverResolutions,resolution)===-1){for(i=this.serverResolutions.length-1;i>=0;i--){if(newResolution=this.serverResolutions[i],newDistance=Math.abs(newResolution-resolution),newDistance>distance)break;distance=newDistance;serverResolution=newResolution}resolution=serverResolution}return resolution},getServerZoom:function(){var resolution=this.getServerResolution();return this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,resolution):this.map.getZoomForResolution(resolution)+(this.zoomOffset||0)},applyBackBuffer:function(resolution){var backBuffer,topLeftTileBounds,ratio,tiles,tile,i;if(this.backBufferTimerId!==null&&this.removeBackBuffer(),backBuffer=this.backBuffer,!backBuffer){if(backBuffer=this.createBackBuffer(),!backBuffer)return;this.div.insertBefore(backBuffer,this.div.firstChild);this.backBuffer=backBuffer;topLeftTileBounds=this.grid[0][0].bounds;this.backBufferLonLat={lon:topLeftTileBounds.left,lat:topLeftTileBounds.top};this.backBufferResolution=this.gridResolution}for(ratio=this.backBufferResolution/resolution,tiles=backBuffer.childNodes,i=tiles.length-1;i>=0;--i)tile=tiles[i],tile.style.top=(ratio*tile._i*tile._h|0)+"px",tile.style.left=(ratio*tile._j*tile._w|0)+"px",tile.style.width=Math.round(ratio*tile._w)+"px",tile.style.height=Math.round(ratio*tile._h)+"px";var position=this.getViewPortPxFromLonLat(this.backBufferLonLat,resolution),leftOffset=this.map.layerContainerOriginPx.x,topOffset=this.map.layerContainerOriginPx.y;backBuffer.style.left=Math.round(position.x-leftOffset)+"px";backBuffer.style.top=Math.round(position.y-topOffset)+"px"},createBackBuffer:function(){var backBuffer,i,lenI,j,lenJ,tile,markup;if(this.grid.length>0)for(backBuffer=document.createElement("div"),backBuffer.id=this.div.id+"_bb",backBuffer.className="olBackBuffer",backBuffer.style.position="absolute",i=0,lenI=this.grid.length;i<lenI;i++)for(j=0,lenJ=this.grid[i].length;j<lenJ;j++)tile=this.grid[i][j],markup=this.grid[i][j].createBackBuffer(),markup&&(markup._i=i,markup._j=j,markup._w=tile.size.w,markup._h=tile.size.h,backBuffer.appendChild(markup));return backBuffer},removeBackBuffer:function(){this.backBuffer&&(this.div.removeChild(this.backBuffer),this.backBuffer=null,this.backBufferResolution=null,this.backBufferTimerId!==null&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null))},moveByPx:function(){this.singleTile||this.moveGriddedTiles()},setTileSize:function(size){this.singleTile&&(size=this.map.getSize(),size.h=parseInt(size.h*this.ratio),size.w=parseInt(size.w*this.ratio));OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[size])},getTilesBounds:function(){var bounds=null,length=this.grid.length;if(length){var bottomLeftTileBounds=this.grid[length-1][0].bounds,width=this.grid[0].length*bottomLeftTileBounds.getWidth(),height=this.grid.length*bottomLeftTileBounds.getHeight();bounds=new OpenLayers.Bounds(bottomLeftTileBounds.left,bottomLeftTileBounds.bottom,bottomLeftTileBounds.left+width,bottomLeftTileBounds.bottom+height)}return bounds},initSingleTile:function(bounds){var tile;this.clearTileQueue();var center=bounds.getCenterLonLat(),tileWidth=bounds.getWidth()*this.ratio,tileHeight=bounds.getHeight()*this.ratio,tileBounds=new OpenLayers.Bounds(center.lon-tileWidth/2,center.lat-tileHeight/2,center.lon+tileWidth/2,center.lat+tileHeight/2),px=this.map.getLayerPxFromLonLat({lon:tileBounds.left,lat:tileBounds.top});this.grid.length||(this.grid[0]=[]);tile=this.grid[0][0];tile?tile.moveTo(tileBounds,px):(tile=this.addTile(tileBounds,px),this.addTileMonitoringHooks(tile),tile.draw(),this.grid[0][0]=tile);this.removeExcessTiles(1,1);this.gridResolution=this.getServerResolution()},calculateGridLayout:function(bounds,origin,resolution){var tilelon=resolution*this.tileSize.w,tilelat=resolution*this.tileSize.h,ratio=resolution/this.map.getResolution(),tileSize={w:Math.round(this.tileSize.w*ratio),h:Math.round(this.tileSize.h*ratio)},offsetlon=bounds.left-origin.lon,tilecol=Math.floor(offsetlon/tilelon)-this.buffer,tilecolremain=offsetlon/tilelon-tilecol,tileoffsetx=-tilecolremain*tileSize.w,rowSign=this.tileOriginCorner.substr(0,1)==="t"?1:-1,offsetlat=rowSign*(origin.lat-bounds.top+tilelat),tilerow=Math[~rowSign?"floor":"ceil"](offsetlat/tilelat)-this.buffer*rowSign,tilerowremain=tilerow-offsetlat/tilelat,tileoffsety=rowSign*tilerowremain*tileSize.h;return{tilelon:tilelon,tilelat:tilelat,tileoffsetx:tileoffsetx,tileoffsety:tileoffsety,startcol:tilecol,startrow:tilerow}},getTileOrigin:function(){var origin=this.tileOrigin,extent,edges;return origin||(extent=this.getMaxExtent(),edges={tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]}[this.tileOriginCorner],origin=new OpenLayers.LonLat(extent[edges[0]],extent[edges[1]])),origin},getTileBoundsForGridIndex:function(row,col){var origin=this.getTileOrigin(),tileLayout=this.gridLayout,tilelon=tileLayout.tilelon,tilelat=tileLayout.tilelat,rowSign=this.tileOriginCorner.substr(0,1)==="t"?1:-1,minX=origin.lon+(tileLayout.startcol+col)*tilelon,minY=origin.lat-(tileLayout.startrow+row*rowSign)*tilelat*rowSign;return new OpenLayers.Bounds(minX,minY,minX+tilelon,minY+tilelat)},initGriddedTiles:function(bounds){var row,colidx,tileCenter,resolution,immediately,i,ii;this.clearTileQueue();var viewSize=this.map.getSize(),origin=this.getTileOrigin(),resolution=this.map.getResolution(),serverResolution=this.getServerResolution(),ratio=resolution/serverResolution,tileSize={w:this.tileSize.w/ratio,h:this.tileSize.h/ratio},minRows=Math.ceil(viewSize.h/tileSize.h)+2*this.buffer+1,minCols=Math.ceil(viewSize.w/tileSize.w)+2*this.buffer+1,tileLayout=this.calculateGridLayout(bounds,origin,serverResolution);this.gridLayout=tileLayout;var startX=Math.round(tileLayout.tileoffsetx),startY=Math.round(tileLayout.tileoffsety),tilelon=tileLayout.tilelon,tilelat=tileLayout.tilelat,layerContainerDivLeft=this.map.layerContainerOriginPx.x,layerContainerDivTop=this.map.layerContainerOriginPx.y,tileData=[],center=this.map.getCenter(),rowidx=0;do{row=this.grid[rowidx];row||(row=[],this.grid.push(row));colidx=0;do{var tileBounds=this.getTileBoundsForGridIndex(rowidx,colidx),x=startX+colidx*tileSize.w-layerContainerDivLeft,y=startY+rowidx*tileSize.h-layerContainerDivTop,px=new OpenLayers.Pixel(x,y),tile=row[colidx];tile?tile.moveTo(tileBounds,px,!1):(tile=this.addTile(tileBounds,px),this.addTileMonitoringHooks(tile),row.push(tile));tileCenter=tileBounds.getCenterLonLat();tileData.push({tile:tile,distance:Math.pow(tileCenter.lon-center.lon,2)+Math.pow(tileCenter.lat-center.lat,2)});colidx+=1}while(tileBounds.right<=bounds.right+tilelon*this.buffer||colidx<minCols);rowidx+=1}while(tileBounds.bottom>=bounds.bottom-tilelat*this.buffer||rowidx<minRows);for(this.removeExcessTiles(rowidx,colidx),resolution=this.getServerResolution(),immediately=resolution===this.gridResolution,this.gridResolution=resolution,tileData.sort(function(a,b){return a.distance-b.distance}),i=0,ii=tileData.length;i<ii;++i)tileData[i].tile.draw(immediately)},getMaxExtent:function(){return this.maxExtent},addTile:function(bounds,position){var tile=new this.tileClass(this,position,bounds,null,this.tileSize,this.tileOptions);return tile.events.register("beforedraw",this,this.queueTileDraw),tile},addTileMonitoringHooks:function(tile){tile.onLoadStart=function(){this.loading===!1&&(this.loading=!0,this.events.triggerEvent("loadstart"));this.events.triggerEvent("tileloadstart",{tile:tile});this.numLoadingTiles++};tile.onLoadEnd=function(){this.numLoadingTiles--;this.events.triggerEvent("tileloaded",{tile:tile});this.tileQueue.length===0&&this.numLoadingTiles===0&&(this.loading=!1,this.events.triggerEvent("loadend"),this.backBuffer&&(this.backBufferTimerId=window.setTimeout(OpenLayers.Function.bind(this.removeBackBuffer,this),this.removeBackBufferDelay)))};tile.onLoadError=function(){this.events.triggerEvent("tileerror",{tile:tile})};tile.events.on({loadstart:tile.onLoadStart,loadend:tile.onLoadEnd,unload:tile.onLoadEnd,loaderror:tile.onLoadError,scope:this})},removeTileMonitoringHooks:function(tile){tile.unload();tile.events.un({loadstart:tile.onLoadStart,loadend:tile.onLoadEnd,unload:tile.onLoadEnd,loaderror:tile.onLoadError,scope:this})},moveGriddedTiles:function(deferred){var buffer;if(!deferred&&!OpenLayers.Animation.isNative){this.moveTimerId!=null&&window.clearTimeout(this.moveTimerId);this.moveTimerId=window.setTimeout(this.deferMoveGriddedTiles,this.tileLoadingDelay);return}for(buffer=this.buffer+1;;){var tlTile=this.grid[0][0],tlViewPort={x:tlTile.position.x+this.map.layerContainerOriginPx.x,y:tlTile.position.y+this.map.layerContainerOriginPx.y},ratio=this.getServerResolution()/this.map.getResolution(),tileSize={w:Math.round(this.tileSize.w*ratio),h:Math.round(this.tileSize.h*ratio)};if(tlViewPort.x>-tileSize.w*(buffer-1))this.shiftColumn(!0,tileSize);else if(tlViewPort.x<-tileSize.w*buffer)this.shiftColumn(!1,tileSize);else if(tlViewPort.y>-tileSize.h*(buffer-1))this.shiftRow(!0,tileSize);else if(tlViewPort.y<-tileSize.h*buffer)this.shiftRow(!1,tileSize);else break}},shiftRow:function(prepend){var grid=this.grid,rowIndex=prepend?0:grid.length-1,sign=prepend?-1:1,rowSign=this.tileOriginCorner.substr(0,1)==="t"?1:-1,tileLayout=this.gridLayout,i,len,tile,position;tileLayout.startrow+=sign*rowSign;var bounds=this.getTileBoundsForGridIndex(rowIndex,0),position=this.map.getViewPortPxFromLonLat(new OpenLayers.LonLat(bounds.left,bounds.top)),y=Math.round(position.y-this.map.layerContainerOriginPx.y),row=grid[prepend?"pop":"shift"]();for(i=0,len=row.length;i<len;i++)tile=row[i],position=tile.position.clone(),position.y=y,tile.moveTo(this.getTileBoundsForGridIndex(rowIndex,i),position);grid[prepend?"unshift":"push"](row)},shiftColumn:function(prepend){var grid=this.grid,colIndex=prepend?0:grid[0].length-1,sign=prepend?-1:1,tileLayout=this.gridLayout,i,len;tileLayout.startcol+=sign;var bounds=this.getTileBoundsForGridIndex(0,colIndex),position=this.map.getViewPortPxFromLonLat(new OpenLayers.LonLat(bounds.left,bounds.top)),x=Math.round(position.x-this.map.layerContainerOriginPx.x);for(i=0,len=grid.length;i<len;i++){var row=grid[i],tile=row[prepend?"pop":"shift"](),position=tile.position.clone();position.x=x;tile.moveTo(this.getTileBoundsForGridIndex(i,colIndex),position);row[prepend?"unshift":"push"](tile)}},removeExcessTiles:function(rows,columns){for(var i,l,row,tile;this.grid.length>rows;)for(row=this.grid.pop(),i=0,l=row.length;i<l;i++)tile=row[i],this.destroyTile(tile);for(i=0,l=this.grid.length;i<l;i++)while(this.grid[i].length>columns)row=this.grid[i],tile=row.pop(),this.destroyTile(tile)},onMapResize:function(){this.singleTile&&(this.clearGrid(),this.setTileSize())},getTileBounds:function(viewPortPx){var maxExtent=this.maxExtent,resolution=this.getResolution(),tileMapWidth=resolution*this.tileSize.w,tileMapHeight=resolution*this.tileSize.h,mapPoint=this.getLonLatFromViewPortPx(viewPortPx),tileLeft=maxExtent.left+tileMapWidth*Math.floor((mapPoint.lon-maxExtent.left)/tileMapWidth),tileBottom=maxExtent.bottom+tileMapHeight*Math.floor((mapPoint.lat-maxExtent.bottom)/tileMapHeight);return new OpenLayers.Bounds(tileLeft,tileBottom,tileLeft+tileMapWidth,tileBottom+tileMapHeight)},CLASS_NAME:"OpenLayers.Layer.Grid"});OpenLayers.Format.ArcXML=OpenLayers.Class(OpenLayers.Format.XML,{fontStyleKeys:["antialiasing","blockout","font","fontcolor","fontsize","fontstyle","glowing","interval","outline","printmode","shadow","transparency"],request:null,response:null,initialize:function(options){var qry,props;this.request=new OpenLayers.Format.ArcXML.Request;this.response=new OpenLayers.Format.ArcXML.Response;options&&(options.requesttype=="feature"?(this.request.get_image=null,qry=this.request.get_feature.query,this.addCoordSys(qry.featurecoordsys,options.featureCoordSys),this.addCoordSys(qry.filtercoordsys,options.filterCoordSys),options.polygon?(qry.isspatial=!0,qry.spatialfilter.polygon=options.polygon):options.envelope&&(qry.isspatial=!0,qry.spatialfilter.envelope={minx:0,miny:0,maxx:0,maxy:0},this.parseEnvelope(qry.spatialfilter.envelope,options.envelope))):options.requesttype=="image"?(this.request.get_feature=null,props=this.request.get_image.properties,this.parseEnvelope(props.envelope,options.envelope),this.addLayers(props.layerlist,options.layers),this.addImageSize(props.imagesize,options.tileSize),this.addCoordSys(props.featurecoordsys,options.featureCoordSys),this.addCoordSys(props.filtercoordsys,options.filterCoordSys)):this.request=null);OpenLayers.Format.XML.prototype.initialize.apply(this,[options])},parseEnvelope:function(env,arr){arr&&arr.length==4&&(env.minx=arr[0],env.miny=arr[1],env.maxx=arr[2],env.maxy=arr[3])},addLayers:function(ll,lyrs){for(var lind=0,len=lyrs.length;lind<len;lind++)ll.push(lyrs[lind])},addImageSize:function(imsize,olsize){olsize!==null&&(imsize.width=olsize.w,imsize.height=olsize.h,imsize.printwidth=olsize.w,imsize.printheight=olsize.h)},addCoordSys:function(featOrFilt,fsys){typeof fsys=="string"?(featOrFilt.id=parseInt(fsys),featOrFilt.string=fsys):typeof fsys=="object"&&fsys.proj!==null?(featOrFilt.id=fsys.proj.srsProjNumber,featOrFilt.string=fsys.proj.srsCode):featOrFilt=fsys},iserror:function(data){var ret=null,errorNodes;return data?(data=OpenLayers.Format.XML.prototype.read.apply(this,[data]),errorNodes=data.documentElement.getElementsByTagName("ERROR"),ret=errorNodes!==null&&errorNodes.length>0):ret=this.response.error!=="",ret},read:function(data){var arcNode,error,source;if(typeof data=="string"&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data])),arcNode=null,data&&data.documentElement&&(arcNode=data.documentElement.nodeName=="ARCXML"?data.documentElement:data.documentElement.getElementsByTagName("ARCXML")[0]),!arcNode||arcNode.firstChild.nodeName==="parsererror"){try{error=data.firstChild.nodeValue;source=data.firstChild.childNodes[1].firstChild.nodeValue}catch(err){}throw{message:"Error parsing the ArcXML request",error:error,source:source};}return this.parseResponse(arcNode)},write:function(request){var root,reqElem,propElem,props,feat,filt,env,imagesz,backgrnd,layerlst,ld,ldef,query,queryElem,getElem,lyrElem,fquery,qElem,fcsElem1,fcsElem2,bufElem,spfElem,envElem;if(request||(request=this.request),root=this.createElementNS("","ARCXML"),root.setAttribute("version","1.1"),reqElem=this.createElementNS("","REQUEST"),request.get_image!=null){if(getElem=this.createElementNS("","GET_IMAGE"),reqElem.appendChild(getElem),propElem=this.createElementNS("","PROPERTIES"),getElem.appendChild(propElem),props=request.get_image.properties,props.featurecoordsys!=null&&(feat=this.createElementNS("","FEATURECOORDSYS"),propElem.appendChild(feat),props.featurecoordsys.id===0?feat.setAttribute("string",props.featurecoordsys.string):feat.setAttribute("id",props.featurecoordsys.id)),props.filtercoordsys!=null&&(filt=this.createElementNS("","FILTERCOORDSYS"),propElem.appendChild(filt),props.filtercoordsys.id===0?filt.setAttribute("string",props.filtercoordsys.string):filt.setAttribute("id",props.filtercoordsys.id)),props.envelope!=null&&(env=this.createElementNS("","ENVELOPE"),propElem.appendChild(env),env.setAttribute("minx",props.envelope.minx),env.setAttribute("miny",props.envelope.miny),env.setAttribute("maxx",props.envelope.maxx),env.setAttribute("maxy",props.envelope.maxy)),imagesz=this.createElementNS("","IMAGESIZE"),propElem.appendChild(imagesz),imagesz.setAttribute("height",props.imagesize.height),imagesz.setAttribute("width",props.imagesize.width),(props.imagesize.height!=props.imagesize.printheight||props.imagesize.width!=props.imagesize.printwidth)&&(imagesz.setAttribute("printheight",props.imagesize.printheight),imagesz.setArrtibute("printwidth",props.imagesize.printwidth)),props.background!=null&&(backgrnd=this.createElementNS("","BACKGROUND"),propElem.appendChild(backgrnd),backgrnd.setAttribute("color",props.background.color.r+","+props.background.color.g+","+props.background.color.b),props.background.transcolor!==null&&backgrnd.setAttribute("transcolor",props.background.transcolor.r+","+props.background.transcolor.g+","+props.background.transcolor.b)),props.layerlist!=null&&props.layerlist.length>0)for(layerlst=this.createElementNS("","LAYERLIST"),propElem.appendChild(layerlst),ld=0;ld<props.layerlist.length;ld++){if(ldef=this.createElementNS("","LAYERDEF"),layerlst.appendChild(ldef),ldef.setAttribute("id",props.layerlist[ld].id),ldef.setAttribute("visible",props.layerlist[ld].visible),typeof props.layerlist[ld].query=="object"){if(query=props.layerlist[ld].query,query.where.length<0)continue;queryElem=null;queryElem=typeof query.spatialfilter=="boolean"&&query.spatialfilter?this.createElementNS("","SPATIALQUERY"):this.createElementNS("","QUERY");queryElem.setAttribute("where",query.where);typeof query.accuracy=="number"&&query.accuracy>0&&queryElem.setAttribute("accuracy",query.accuracy);typeof query.featurelimit=="number"&&query.featurelimit<2e3&&queryElem.setAttribute("featurelimit",query.featurelimit);typeof query.subfields=="string"&&query.subfields!="#ALL#"&&queryElem.setAttribute("subfields",query.subfields);typeof query.joinexpression=="string"&&query.joinexpression.length>0&&queryElem.setAttribute("joinexpression",query.joinexpression);typeof query.jointables=="string"&&query.jointables.length>0&&queryElem.setAttribute("jointables",query.jointables);ldef.appendChild(queryElem)}typeof props.layerlist[ld].renderer=="object"&&this.addRenderer(ldef,props.layerlist[ld].renderer)}}else request.get_feature!=null&&(getElem=this.createElementNS("","GET_FEATURES"),getElem.setAttribute("outputmode","newxml"),getElem.setAttribute("checkesc","true"),request.get_feature.geometry?getElem.setAttribute("geometry",request.get_feature.geometry):getElem.setAttribute("geometry","false"),request.get_feature.compact&&getElem.setAttribute("compact",request.get_feature.compact),request.get_feature.featurelimit=="number"&&getElem.setAttribute("featurelimit",request.get_feature.featurelimit),getElem.setAttribute("globalenvelope","true"),reqElem.appendChild(getElem),request.get_feature.layer!=null&&request.get_feature.layer.length>0&&(lyrElem=this.createElementNS("","LAYER"),lyrElem.setAttribute("id",request.get_feature.layer),getElem.appendChild(lyrElem)),fquery=request.get_feature.query,fquery!=null&&(qElem=null,qElem=fquery.isspatial?this.createElementNS("","SPATIALQUERY"):this.createElementNS("","QUERY"),getElem.appendChild(qElem),typeof fquery.accuracy=="number"&&qElem.setAttribute("accuracy",fquery.accuracy),fquery.featurecoordsys!=null&&(fcsElem1=this.createElementNS("","FEATURECOORDSYS"),fquery.featurecoordsys.id==0?fcsElem1.setAttribute("string",fquery.featurecoordsys.string):fcsElem1.setAttribute("id",fquery.featurecoordsys.id),qElem.appendChild(fcsElem1)),fquery.filtercoordsys!=null&&(fcsElem2=this.createElementNS("","FILTERCOORDSYS"),fquery.filtercoordsys.id===0?fcsElem2.setAttribute("string",fquery.filtercoordsys.string):fcsElem2.setAttribute("id",fquery.filtercoordsys.id),qElem.appendChild(fcsElem2)),fquery.buffer>0&&(bufElem=this.createElementNS("","BUFFER"),bufElem.setAttribute("distance",fquery.buffer),qElem.appendChild(bufElem)),fquery.isspatial&&(spfElem=this.createElementNS("","SPATIALFILTER"),spfElem.setAttribute("relation",fquery.spatialfilter.relation),qElem.appendChild(spfElem),fquery.spatialfilter.envelope?(envElem=this.createElementNS("","ENVELOPE"),envElem.setAttribute("minx",fquery.spatialfilter.envelope.minx),envElem.setAttribute("miny",fquery.spatialfilter.envelope.miny),envElem.setAttribute("maxx",fquery.spatialfilter.envelope.maxx),envElem.setAttribute("maxy",fquery.spatialfilter.envelope.maxy),spfElem.appendChild(envElem)):typeof fquery.spatialfilter.polygon=="object"&&spfElem.appendChild(this.writePolygonGeometry(fquery.spatialfilter.polygon))),fquery.where!=null&&fquery.where.length>0&&qElem.setAttribute("where",fquery.where)));return root.appendChild(reqElem),OpenLayers.Format.XML.prototype.write.apply(this,[root])},addGroupRenderer:function(ldef,toprenderer){var topRelem=this.createElementNS("","GROUPRENDERER"),rind,renderer;for(ldef.appendChild(topRelem),rind=0;rind<toprenderer.length;rind++)renderer=toprenderer[rind],this.addRenderer(topRelem,renderer)},addRenderer:function(topRelem,renderer){if(OpenLayers.Util.isArray(renderer))this.addGroupRenderer(topRelem,renderer);else{var renderElem=this.createElementNS("",renderer.type.toUpperCase()+"RENDERER");topRelem.appendChild(renderElem);renderElem.tagName=="VALUEMAPRENDERER"?this.addValueMapRenderer(renderElem,renderer):renderElem.tagName=="VALUEMAPLABELRENDERER"?this.addValueMapLabelRenderer(renderElem,renderer):renderElem.tagName=="SIMPLELABELRENDERER"?this.addSimpleLabelRenderer(renderElem,renderer):renderElem.tagName=="SCALEDEPENDENTRENDERER"&&this.addScaleDependentRenderer(renderElem,renderer)}},addScaleDependentRenderer:function(renderElem,renderer){(typeof renderer.lower=="string"||typeof renderer.lower=="number")&&renderElem.setAttribute("lower",renderer.lower);(typeof renderer.upper=="string"||typeof renderer.upper=="number")&&renderElem.setAttribute("upper",renderer.upper);this.addRenderer(renderElem,renderer.renderer)},addValueMapLabelRenderer:function(renderElem,renderer){var ext,extlen,exact,eelem,selem,keys,i,len,key;if(renderElem.setAttribute("lookupfield",renderer.lookupfield),renderElem.setAttribute("labelfield",renderer.labelfield),typeof renderer.exacts=="object")for(ext=0,extlen=renderer.exacts.length;ext<extlen;ext++)if(exact=renderer.exacts[ext],eelem=this.createElementNS("","EXACT"),typeof exact.value=="string"&&eelem.setAttribute("value",exact.value),typeof exact.label=="string"&&eelem.setAttribute("label",exact.label),typeof exact.method=="string"&&eelem.setAttribute("method",exact.method),renderElem.appendChild(eelem),typeof exact.symbol=="object"&&(selem=null,exact.symbol.type=="text"&&(selem=this.createElementNS("","TEXTSYMBOL")),selem!=null)){for(keys=this.fontStyleKeys,i=0,len=keys.length;i<len;i++)key=keys[i],exact.symbol[key]&&selem.setAttribute(key,exact.symbol[key]);eelem.appendChild(selem)}},addValueMapRenderer:function(renderElem,renderer){var rng,rnglen,range,relem,ext,extlen,exact,eelem,selem;if(renderElem.setAttribute("lookupfield",renderer.lookupfield),typeof renderer.ranges=="object")for(rng=0,rnglen=renderer.ranges.length;rng<rnglen;rng++)range=renderer.ranges[rng],relem=this.createElementNS("","RANGE"),relem.setAttribute("lower",range.lower),relem.setAttribute("upper",range.upper),renderElem.appendChild(relem),typeof range.symbol=="object"&&(selem=null,range.symbol.type=="simplepolygon"&&(selem=this.createElementNS("","SIMPLEPOLYGONSYMBOL")),selem!=null&&(typeof range.symbol.boundarycolor=="string"&&selem.setAttribute("boundarycolor",range.symbol.boundarycolor),typeof range.symbol.fillcolor=="string"&&selem.setAttribute("fillcolor",range.symbol.fillcolor),typeof range.symbol.filltransparency=="number"&&selem.setAttribute("filltransparency",range.symbol.filltransparency),relem.appendChild(selem)));else if(typeof renderer.exacts=="object")for(ext=0,extlen=renderer.exacts.length;ext<extlen;ext++)exact=renderer.exacts[ext],eelem=this.createElementNS("","EXACT"),typeof exact.value=="string"&&eelem.setAttribute("value",exact.value),typeof exact.label=="string"&&eelem.setAttribute("label",exact.label),typeof exact.method=="string"&&eelem.setAttribute("method",exact.method),renderElem.appendChild(eelem),typeof exact.symbol=="object"&&(selem=null,exact.symbol.type=="simplemarker"&&(selem=this.createElementNS("","SIMPLEMARKERSYMBOL")),selem!=null&&(typeof exact.symbol.antialiasing=="string"&&selem.setAttribute("antialiasing",exact.symbol.antialiasing),typeof exact.symbol.color=="string"&&selem.setAttribute("color",exact.symbol.color),typeof exact.symbol.outline=="string"&&selem.setAttribute("outline",exact.symbol.outline),typeof exact.symbol.overlap=="string"&&selem.setAttribute("overlap",exact.symbol.overlap),typeof exact.symbol.shadow=="string"&&selem.setAttribute("shadow",exact.symbol.shadow),typeof exact.symbol.transparency=="number"&&selem.setAttribute("transparency",exact.symbol.transparency),typeof exact.symbol.usecentroid=="string"&&selem.setAttribute("usecentroid",exact.symbol.usecentroid),typeof exact.symbol.width=="number"&&selem.setAttribute("width",exact.symbol.width),eelem.appendChild(selem)))},addSimpleLabelRenderer:function(renderElem,renderer){var symbol,selem,keys,i,len,key;for(renderElem.setAttribute("field",renderer.field),keys=["featureweight","howmanylabels","labelbufferratio","labelpriorities","labelweight","linelabelposition","rotationalangles"],i=0,len=keys.length;i<len;i++)key=keys[i],renderer[key]&&renderElem.setAttribute(key,renderer[key]);if(renderer.symbol.type=="text")for(symbol=renderer.symbol,selem=this.createElementNS("","TEXTSYMBOL"),renderElem.appendChild(selem),keys=this.fontStyleKeys,i=0,len=keys.length;i<len;i++)key=keys[i],symbol[key]&&selem.setAttribute(key,renderer[key])},writePolygonGeometry:function(polygon){var polyElem,ln,lnlen,ring,ringElem,rn,rnlen,point,pointElem;if(!(polygon instanceof OpenLayers.Geometry.Polygon))throw{message:"Cannot write polygon geometry to ArcXML with an "+polygon.CLASS_NAME+" object.",geometry:polygon};for(polyElem=this.createElementNS("","POLYGON"),ln=0,lnlen=polygon.components.length;ln<lnlen;ln++){for(ring=polygon.components[ln],ringElem=this.createElementNS("","RING"),rn=0,rnlen=ring.components.length;rn<rnlen;rn++)point=ring.components[rn],pointElem=this.createElementNS("","POINT"),pointElem.setAttribute("x",point.x),pointElem.setAttribute("y",point.y),ringElem.appendChild(pointElem);polyElem.appendChild(ringElem)}return polyElem},parseResponse:function(data){var newData,response,errorNode,responseNode,rtype,envelopeNode,outputNode,envAttr,outputAttr,features,featureCount,envelope,featureList,fn,feature,fields,fdn,fieldName,fieldValue,geom,ring,polys,rn,linearRings,holes,hn;if(typeof data=="string"&&(newData=new OpenLayers.Format.XML,data=newData.read(data)),response=new OpenLayers.Format.ArcXML.Response,errorNode=data.getElementsByTagName("ERROR"),errorNode!=null&&errorNode.length>0)response.error=this.getChildValue(errorNode,"Unknown error.");else{if(responseNode=data.getElementsByTagName("RESPONSE"),responseNode==null||responseNode.length==0)return response.error="No RESPONSE tag found in ArcXML response.",response;if(rtype=responseNode[0].firstChild.nodeName,rtype=="#text"&&(rtype=responseNode[0].firstChild.nextSibling.nodeName),rtype=="IMAGE")envelopeNode=data.getElementsByTagName("ENVELOPE"),outputNode=data.getElementsByTagName("OUTPUT"),envelopeNode==null||envelopeNode.length==0?response.error="No ENVELOPE tag found in ArcXML response.":outputNode==null||outputNode.length==0?response.error="No OUTPUT tag found in ArcXML response.":(envAttr=this.parseAttributes(envelopeNode[0]),outputAttr=this.parseAttributes(outputNode[0]),response.image=typeof outputAttr.type=="string"?{envelope:envAttr,output:{type:outputAttr.type,data:this.getChildValue(outputNode[0])}}:{envelope:envAttr,output:outputAttr});else if(rtype=="FEATURES"){if(features=responseNode[0].getElementsByTagName("FEATURES"),featureCount=features[0].getElementsByTagName("FEATURECOUNT"),response.features.featurecount=featureCount[0].getAttribute("count"),response.features.featurecount>0)for(envelope=features[0].getElementsByTagName("ENVELOPE"),response.features.envelope=this.parseAttributes(envelope[0],"number"),featureList=features[0].getElementsByTagName("FEATURE"),fn=0;fn<featureList.length;fn++){for(feature=new OpenLayers.Feature.Vector,fields=featureList[fn].getElementsByTagName("FIELD"),fdn=0;fdn<fields.length;fdn++)fieldName=fields[fdn].getAttribute("name"),fieldValue=fields[fdn].getAttribute("value"),feature.attributes[fieldName]=fieldValue;if(geom=featureList[fn].getElementsByTagName("POLYGON"),geom.length>0){for(ring=geom[0].getElementsByTagName("RING"),polys=[],rn=0;rn<ring.length;rn++){for(linearRings=[],linearRings.push(this.parsePointGeometry(ring[rn])),holes=ring[rn].getElementsByTagName("HOLE"),hn=0;hn<holes.length;hn++)linearRings.push(this.parsePointGeometry(holes[hn]));holes=null;polys.push(new OpenLayers.Geometry.Polygon(linearRings));linearRings=null}ring=null;feature.geometry=polys.length==1?polys[0]:new OpenLayers.Geometry.MultiPolygon(polys)}response.features.feature.push(feature)}}else response.error="Unidentified response type."}return response},parseAttributes:function(node,type){for(var attributes={},attr=0;attr<node.attributes.length;attr++)attributes[node.attributes[attr].nodeName]=type=="number"?parseFloat(node.attributes[attr].nodeValue):node.attributes[attr].nodeValue;return attributes},parsePointGeometry:function(node){var ringPoints=[],coords=node.getElementsByTagName("COORDS"),coordArr,cn,coordItems,point,pn;if(coords.length>0){for(coordArr=this.getChildValue(coords[0]),coordArr=coordArr.split(/;/),cn=0;cn<coordArr.length;cn++)coordItems=coordArr[cn].split(/ /),ringPoints.push(new OpenLayers.Geometry.Point(coordItems[0],coordItems[1]));coords=null}else{if(point=node.getElementsByTagName("POINT"),point.length>0)for(pn=0;pn<point.length;pn++)ringPoints.push(new OpenLayers.Geometry.Point(parseFloat(point[pn].getAttribute("x")),parseFloat(point[pn].getAttribute("y"))));point=null}return new OpenLayers.Geometry.LinearRing(ringPoints)},CLASS_NAME:"OpenLayers.Format.ArcXML"});OpenLayers.Format.ArcXML.Request=OpenLayers.Class({initialize:function(){return OpenLayers.Util.extend(this,{get_image:{properties:{background:null,draw:!0,envelope:{minx:0,miny:0,maxx:0,maxy:0},featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},imagesize:{height:0,width:0,dpi:96,printheight:0,printwidth:0,scalesymbols:!1},layerlist:[],output:{baseurl:"",legendbaseurl:"",legendname:"",legendpath:"",legendurl:"",name:"",path:"",type:"jpg",url:""}}},get_feature:{layer:"",query:{isspatial:!1,featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},buffer:0,where:"",spatialfilter:{relation:"envelope_intersection",envelope:null}}},environment:{separators:{cs:" ",ts:";"}},layer:[],workspaces:[]})},CLASS_NAME:"OpenLayers.Format.ArcXML.Request"});OpenLayers.Format.ArcXML.Response=OpenLayers.Class({initialize:function(){return OpenLayers.Util.extend(this,{image:{envelope:null,output:""},features:{featurecount:0,envelope:null,feature:[]},error:""})},CLASS_NAME:"OpenLayers.Format.ArcXML.Response"});OpenLayers.Layer.ArcIMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{ClientVersion:"9.2",ServiceName:""},featureCoordSys:"4326",filterCoordSys:"4326",layers:null,async:!0,name:"ArcIMS",isBaseLayer:!0,DEFAULT_OPTIONS:{tileSize:new OpenLayers.Size(512,512),featureCoordSys:"4326",filterCoordSys:"4326",layers:null,isBaseLayer:!0,async:!0,name:"ArcIMS"},initialize:function(name,url,options){this.tileSize=new OpenLayers.Size(512,512);this.params=OpenLayers.Util.applyDefaults({ServiceName:options.serviceName},this.DEFAULT_PARAMS);this.options=OpenLayers.Util.applyDefaults(options,this.DEFAULT_OPTIONS);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[name,url,this.params,options]);this.transparent&&(this.isBaseLayer||(this.isBaseLayer=!1),this.format=="image/jpeg"&&(this.format=OpenLayers.Util.alphaHack()?"image/gif":"image/png"));this.options.layers===null&&(this.options.layers=[])},getURL:function(bounds){var url="",axlReq,req,doc,axlResp,arcxml;return bounds=this.adjustBounds(bounds),axlReq=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:bounds.toArray(),tileSize:this.tileSize})),req=new OpenLayers.Request.POST({url:this.getFullRequestString(),data:axlReq.write(),async:!1}),req!=null&&(doc=req.responseXML,doc&&doc.documentElement||(doc=req.responseText),axlResp=new OpenLayers.Format.ArcXML,arcxml=axlResp.read(doc),url=this.getUrlOrImage(arcxml.image.output)),url},getURLasync:function(bounds,callback,scope){bounds=this.adjustBounds(bounds);var axlReq=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:bounds.toArray(),tileSize:this.tileSize}));OpenLayers.Request.POST({url:this.getFullRequestString(),async:!0,data:axlReq.write(),callback:function(req){var doc=req.responseXML,axlResp,arcxml;doc&&doc.documentElement||(doc=req.responseText);axlResp=new OpenLayers.Format.ArcXML;arcxml=axlResp.read(doc);callback.call(scope,this.getUrlOrImage(arcxml.image.output))},scope:this})},getUrlOrImage:function(output){var ret="";return output.url?ret=output.url:output.data&&(ret="data:image/"+output.type+";base64,"+output.data),ret},setLayerQuery:function(id,querydef){for(var lyr=0;lyr<this.options.layers.length;lyr++)if(id==this.options.layers[lyr].id){this.options.layers[lyr].query=querydef;return}this.options.layers.push({id:id,visible:!0,query:querydef})},getFeatureInfo:function(geometry,layer,options){var buffer=options.buffer||1,callback=options.callback||function(){},scope=options.scope||window,requestOptions={},arcxml,mapCenter,viewPx,mapOffCenter;OpenLayers.Util.extend(requestOptions,this.options);requestOptions.requesttype="feature";geometry instanceof OpenLayers.LonLat?(requestOptions.polygon=null,requestOptions.envelope=[geometry.lon-buffer,geometry.lat-buffer,geometry.lon+buffer,geometry.lat+buffer]):geometry instanceof OpenLayers.Geometry.Polygon&&(requestOptions.envelope=null,requestOptions.polygon=geometry);arcxml=new OpenLayers.Format.ArcXML(requestOptions);OpenLayers.Util.extend(arcxml.request.get_feature,options);arcxml.request.get_feature.layer=layer.id;typeof layer.query.accuracy=="number"?arcxml.request.get_feature.query.accuracy=layer.query.accuracy:(mapCenter=this.map.getCenter(),viewPx=this.map.getViewPortPxFromLonLat(mapCenter),viewPx.x++,mapOffCenter=this.map.getLonLatFromPixel(viewPx),arcxml.request.get_feature.query.accuracy=mapOffCenter.lon-mapCenter.lon);arcxml.request.get_feature.query.where=layer.query.where;arcxml.request.get_feature.query.spatialfilter.relation="area_intersection";OpenLayers.Request.POST({url:this.getFullRequestString({CustomService:"Query"}),data:arcxml.write(),callback:function(request){var response=arcxml.parseResponse(request.responseText);arcxml.iserror()?callback.call(scope,null):callback.call(scope,response.features)}})},clone:function(obj){return obj==null&&(obj=new OpenLayers.Layer.ArcIMS(this.name,this.url,this.getOptions())),OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj])},CLASS_NAME:"OpenLayers.Layer.ArcIMS"});OpenLayers.Format.OWSCommon.v1_1_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(node,obj){obj.exceptionReport={version:node.getAttribute("version"),language:node.getAttribute("xml:lang"),exceptions:[]};this.readChildNodes(node,obj.exceptionReport)},AllowedValues:function(node,parameter){parameter.allowedValues={};this.readChildNodes(node,parameter.allowedValues)},AnyValue:function(node,parameter){parameter.anyValue=!0},DataType:function(node,parameter){parameter.dataType=this.getChildValue(node)},Range:function(node,allowedValues){allowedValues.range={};this.readChildNodes(node,allowedValues.range)},MinimumValue:function(node,range){range.minValue=this.getChildValue(node)},MaximumValue:function(node,range){range.maxValue=this.getChildValue(node)},Identifier:function(node,obj){obj.identifier=this.getChildValue(node)},SupportedCRS:function(node,obj){obj.supportedCRS=this.getChildValue(node)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Util.applyDefaults({Range:function(range){var node=this.createElementNSPlus("ows:Range",{attributes:{"ows:rangeClosure":range.closure}});return this.writeNode("ows:MinimumValue",range.minValue,node),this.writeNode("ows:MaximumValue",range.maxValue,node),node},MinimumValue:function(minValue){return this.createElementNSPlus("ows:MinimumValue",{value:minValue})},MaximumValue:function(maxValue){return this.createElementNSPlus("ows:MaximumValue",{value:maxValue})},Value:function(value){return this.createElementNSPlus("ows:Value",{value:value})}},OpenLayers.Format.OWSCommon.v1.prototype.writers.ows)},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"});OpenLayers.Format.WCSGetCoverage=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.1.2",schemaLocation:"http://www.opengis.net/wcs/1.1 http://schemas.opengis.net/wcs/1.1/wcsGetCoverage.xsd",write:function(options){var node=this.writeNode("wcs:GetCoverage",options);return this.setAttributeNS(node,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[node])},writers:{wcs:{GetCoverage:function(options){var node=this.createElementNSPlus("wcs:GetCoverage",{attributes:{version:options.version||this.VERSION,service:"WCS"}});return this.writeNode("ows:Identifier",options.identifier,node),this.writeNode("wcs:DomainSubset",options.domainSubset,node),this.writeNode("wcs:Output",options.output,node),node},DomainSubset:function(domainSubset){var node=this.createElementNSPlus("wcs:DomainSubset",{});return this.writeNode("ows:BoundingBox",domainSubset.boundingBox,node),domainSubset.temporalSubset&&this.writeNode("wcs:TemporalSubset",domainSubset.temporalSubset,node),node},TemporalSubset:function(temporalSubset){for(var node=this.createElementNSPlus("wcs:TemporalSubset",{}),i=0,len=temporalSubset.timePeriods.length;i<len;++i)this.writeNode("wcs:TimePeriod",temporalSubset.timePeriods[i],node);return node},TimePeriod:function(timePeriod){var node=this.createElementNSPlus("wcs:TimePeriod",{});return this.writeNode("wcs:BeginPosition",timePeriod.begin,node),this.writeNode("wcs:EndPosition",timePeriod.end,node),timePeriod.resolution&&this.writeNode("wcs:TimeResolution",timePeriod.resolution,node),node},BeginPosition:function(begin){return this.createElementNSPlus("wcs:BeginPosition",{value:begin})},EndPosition:function(end){return this.createElementNSPlus("wcs:EndPosition",{value:end})},TimeResolution:function(resolution){return this.createElementNSPlus("wcs:TimeResolution",{value:resolution})},Output:function(output){var node=this.createElementNSPlus("wcs:Output",{attributes:{format:output.format,store:output.store}});return output.gridCRS&&this.writeNode("wcs:GridCRS",output.gridCRS,node),node},GridCRS:function(gridCRS){var node=this.createElementNSPlus("wcs:GridCRS",{});return this.writeNode("wcs:GridBaseCRS",gridCRS.baseCRS,node),gridCRS.type&&this.writeNode("wcs:GridType",gridCRS.type,node),gridCRS.origin&&this.writeNode("wcs:GridOrigin",gridCRS.origin,node),this.writeNode("wcs:GridOffsets",gridCRS.offsets,node),gridCRS.CS&&this.writeNode("wcs:GridCS",gridCRS.CS,node),node},GridBaseCRS:function(baseCRS){return this.createElementNSPlus("wcs:GridBaseCRS",{value:baseCRS})},GridOrigin:function(origin){return this.createElementNSPlus("wcs:GridOrigin",{value:origin})},GridType:function(type){return this.createElementNSPlus("wcs:GridType",{value:type})},GridOffsets:function(offsets){return this.createElementNSPlus("wcs:GridOffsets",{value:offsets})},GridCS:function(CS){return this.createElementNSPlus("wcs:GridCS",{value:CS})}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.WCSGetCoverage"});OpenLayers.Format.WPSExecute=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",gml:"http://www.opengis.net/gml",wps:"http://www.opengis.net/wps/1.0.0",wfs:"http://www.opengis.net/wfs",ogc:"http://www.opengis.net/ogc",wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",schemaLocationAttr:function(){return undefined},write:function(options){var doc,node;return window.ActiveXObject?(doc=new ActiveXObject("Microsoft.XMLDOM"),this.xmldom=doc):doc=document.implementation.createDocument("","",null),node=this.writeNode("wps:Execute",options,doc),this.setAttributeNS(node,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[node])},read:function(data){typeof data=="string"&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data]));data&&data.nodeType==9&&(data=data.documentElement);var info={};return this.readNode(data,info),info},writers:{wps:{Execute:function(options){var node=this.createElementNSPlus("wps:Execute",{attributes:{version:this.VERSION,service:"WPS"}});return this.writeNode("ows:Identifier",options.identifier,node),this.writeNode("wps:DataInputs",options.dataInputs,node),this.writeNode("wps:ResponseForm",options.responseForm,node),node},ResponseForm:function(responseForm){var node=this.createElementNSPlus("wps:ResponseForm",{});return responseForm.rawDataOutput&&this.writeNode("wps:RawDataOutput",responseForm.rawDataOutput,node),responseForm.responseDocument&&this.writeNode("wps:ResponseDocument",responseForm.responseDocument,node),node},ResponseDocument:function(responseDocument){var node=this.createElementNSPlus("wps:ResponseDocument",{attributes:{storeExecuteResponse:responseDocument.storeExecuteResponse,lineage:responseDocument.lineage,status:responseDocument.status}}),i,len;if(responseDocument.outputs)for(i=0,len=responseDocument.outputs.length;i<len;i++)this.writeNode("wps:Output",responseDocument.outputs[i],node);return node},Output:function(output){var node=this.createElementNSPlus("wps:Output",{attributes:{asReference:output.asReference,mimeType:output.mimeType,encoding:output.encoding,schema:output.schema}});return this.writeNode("ows:Identifier",output.identifier,node),this.writeNode("ows:Title",output.title,node),this.writeNode("ows:Abstract",output.abstract,node),node},RawDataOutput:function(rawDataOutput){var node=this.createElementNSPlus("wps:RawDataOutput",{attributes:{mimeType:rawDataOutput.mimeType,encoding:rawDataOutput.encoding,schema:rawDataOutput.schema}});return this.writeNode("ows:Identifier",rawDataOutput.identifier,node),node},DataInputs:function(dataInputs){for(var node=this.createElementNSPlus("wps:DataInputs",{}),i=0,ii=dataInputs.length;i<ii;++i)this.writeNode("wps:Input",dataInputs[i],node);return node},Input:function(input){var node=this.createElementNSPlus("wps:Input",{});return this.writeNode("ows:Identifier",input.identifier,node),input.title&&this.writeNode("ows:Title",input.title,node),input.data&&this.writeNode("wps:Data",input.data,node),input.reference&&this.writeNode("wps:Reference",input.reference,node),input.boundingBoxData&&this.writeNode("wps:BoundingBoxData",input.boundingBoxData,node),node},Data:function(data){var node=this.createElementNSPlus("wps:Data",{});return data.literalData?this.writeNode("wps:LiteralData",data.literalData,node):data.complexData?this.writeNode("wps:ComplexData",data.complexData,node):data.boundingBoxData&&this.writeNode("ows:BoundingBox",data.boundingBoxData,node),node},LiteralData:function(literalData){return this.createElementNSPlus("wps:LiteralData",{attributes:{uom:literalData.uom},value:literalData.value})},ComplexData:function(complexData){var node=this.createElementNSPlus("wps:ComplexData",{attributes:{mimeType:complexData.mimeType,encoding:complexData.encoding,schema:complexData.schema}}),data=complexData.value;return typeof data=="string"?node.appendChild(this.getXMLDoc().createCDATASection(complexData.value)):node.appendChild(data),node},Reference:function(reference){var node=this.createElementNSPlus("wps:Reference",{attributes:{mimeType:reference.mimeType,"xlink:href":reference.href,method:reference.method,encoding:reference.encoding,schema:reference.schema}});return reference.body&&this.writeNode("wps:Body",reference.body,node),node},BoundingBoxData:function(node,obj){this.writers.ows.BoundingBox.apply(this,[node,obj,"wps:BoundingBoxData"])},Body:function(body){var node=this.createElementNSPlus("wps:Body",{});return body.wcs?this.writeNode("wcs:GetCoverage",body.wcs,node):body.wfs?(this.featureType=body.wfs.featureType,this.version=body.wfs.version,this.writeNode("wfs:GetFeature",body.wfs,node)):this.writeNode("wps:Execute",body,node),node}},wcs:OpenLayers.Format.WCSGetCoverage.prototype.writers.wcs,wfs:OpenLayers.Format.WFST.v1_1_0.prototype.writers.wfs,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc,ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},readers:{wps:{ExecuteResponse:function(node,obj){obj.executeResponse={lang:node.getAttribute("lang"),statusLocation:node.getAttribute("statusLocation"),serviceInstance:node.getAttribute("serviceInstance"),service:node.getAttribute("service")};this.readChildNodes(node,obj.executeResponse)},Process:function(node,obj){obj.process={};this.readChildNodes(node,obj.process)},Status:function(node,obj){obj.status={creationTime:node.getAttribute("creationTime")};this.readChildNodes(node,obj.status)},ProcessSucceeded:function(node,obj){obj.processSucceeded=!0},ProcessOutputs:function(node,processDescription){processDescription.processOutputs=[];this.readChildNodes(node,processDescription.processOutputs)},Output:function(node,processOutputs){var output={};this.readChildNodes(node,output);processOutputs.push(output)},Reference:function(node,output){output.reference={href:node.getAttribute("href"),mimeType:node.getAttribute("mimeType"),encoding:node.getAttribute("encoding"),schema:node.getAttribute("schema")}},Data:function(node,output){output.data={};this.readChildNodes(node,output)},LiteralData:function(node,output){output.literalData={dataType:node.getAttribute("dataType"),uom:node.getAttribute("uom"),value:this.getChildValue(node)}},ComplexData:function(node,output){if(output.complexData={mimeType:node.getAttribute("mimeType"),schema:node.getAttribute("schema"),encoding:node.getAttribute("encoding"),value:""},this.isSimpleContent(node))for(var child=node.firstChild;child;child=child.nextSibling)switch(child.nodeType){case 3:case 4:output.complexData.value+=child.nodeValue}else for(child=node.firstChild;child;child=child.nextSibling)child.nodeType==1&&(output.complexData.value=child)},BoundingBox:function(node,output){output.boundingBoxData={dimensions:node.getAttribute("dimensions"),crs:node.getAttribute("crs")};this.readChildNodes(node,output.boundingBoxData)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSExecute"});OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(){this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y);OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick);this.removeButtons();this.buttons=null;this.position=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(px){OpenLayers.Control.prototype.draw.apply(this,arguments);px=this.position;this.buttons=[];var sz={w:18,h:18},centered=new OpenLayers.Pixel(px.x+sz.w/2,px.y);return this._addButton("panup","north-mini.png",centered,sz),px.y=centered.y+sz.h,this._addButton("panleft","west-mini.png",px,sz),this._addButton("panright","east-mini.png",px.add(sz.w,0),sz),this._addButton("pandown","south-mini.png",centered.add(0,sz.h*2),sz),this._addButton("zoomin","zoom-plus-mini.png",centered.add(0,sz.h*3+5),sz),this._addButton("zoomworld","zoom-world-mini.png",centered.add(0,sz.h*4+5),sz),this._addButton("zoomout","zoom-minus-mini.png",centered.add(0,sz.h*5+5),sz),this.div},_addButton:function(id,img,xy,sz){var imgLocation=OpenLayers.Util.getImageLocation(img),btn=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+id,xy,sz,imgLocation,"absolute");return btn.style.cursor="pointer",this.div.appendChild(btn),btn.action=id,btn.className="olButton",this.buttons.push(btn),btn},_removeButton:function(btn){this.div.removeChild(btn);OpenLayers.Util.removeItem(this.buttons,btn)},removeButtons:function(){for(var i=this.buttons.length-1;i>=0;--i)this._removeButton(this.buttons[i])},onButtonClick:function(evt){var btn=evt.buttonElement;switch(btn.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":this.map.zoomToMaxExtent()}},getSlideFactor:function(dim){return this.slideRatio?this.map.getSize()[dim]*this.slideRatio:this.slideFactor},CLASS_NAME:"OpenLayers.Control.PanZoom"});OpenLayers.Control.PanZoom.X=4;OpenLayers.Control.PanZoom.Y=4;OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,zoomWorldIcon:!1,panIcons:!0,forceFixedZoomLevel:!1,mouseDragStart:null,deltaY:null,zoomStart:null,destroy:function(){this._removeZoomBar();this.map.events.un({changebaselayer:this.redraw,updatesize:this.redraw,scope:this});OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments);delete this.mouseDragStart;delete this.zoomStart},setMap:function(){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments);this.map.events.on({changebaselayer:this.redraw,updatesize:this.redraw,scope:this})},redraw:function(){this.div!=null&&(this.removeButtons(),this._removeZoomBar());this.draw()},draw:function(px){var sz,centered,wposition;return OpenLayers.Control.prototype.draw.apply(this,arguments),px=this.position.clone(),this.buttons=[],sz={w:18,h:18},this.panIcons?(centered=new OpenLayers.Pixel(px.x+sz.w/2,px.y),wposition=sz.w,this.zoomWorldIcon&&(centered=new OpenLayers.Pixel(px.x+sz.w,px.y)),this._addButton("panup","north-mini.png",centered,sz),px.y=centered.y+sz.h,this._addButton("panleft","west-mini.png",px,sz),this.zoomWorldIcon&&(this._addButton("zoomworld","zoom-world-mini.png",px.add(sz.w,0),sz),wposition*=2),this._addButton("panright","east-mini.png",px.add(wposition,0),sz),this._addButton("pandown","south-mini.png",centered.add(0,sz.h*2),sz),this._addButton("zoomin","zoom-plus-mini.png",centered.add(0,sz.h*3+5),sz),centered=this._addZoomBar(centered.add(0,sz.h*4+5)),this._addButton("zoomout","zoom-minus-mini.png",centered,sz)):(this._addButton("zoomin","zoom-plus-mini.png",px,sz),centered=this._addZoomBar(px.add(0,sz.h)),this._addButton("zoomout","zoom-minus-mini.png",centered,sz),this.zoomWorldIcon&&(centered=centered.add(0,sz.h+3),this._addButton("zoomworld","zoom-world-mini.png",centered,sz))),this.div},_addZoomBar:function(centered){var imgLocation=OpenLayers.Util.getImageLocation("slider.png"),id=this.id+"_"+this.map.id,minZoom=this.map.getMinZoom(),zoomsToEnd=this.map.getNumZoomLevels()-1-this.map.getZoom(),slider=OpenLayers.Util.createAlphaImageDiv(id,centered.add(-1,zoomsToEnd*this.zoomStopHeight),{w:20,h:9},imgLocation,"absolute");slider.style.cursor="move";this.slider=slider;this.sliderEvents=new OpenLayers.Events(this,slider,null,!0,{includeXY:!0});this.sliderEvents.on({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});var sz={w:this.zoomStopWidth,h:this.zoomStopHeight*(this.map.getNumZoomLevels()-minZoom)},imgLocation=OpenLayers.Util.getImageLocation("zoombar.png"),div=null;return OpenLayers.Util.alphaHack()?(id=this.id+"_"+this.map.id,div=OpenLayers.Util.createAlphaImageDiv(id,centered,{w:sz.w,h:this.zoomStopHeight},imgLocation,"absolute",null,"crop"),div.style.height=sz.h+"px"):div=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,centered,sz,imgLocation),div.style.cursor="pointer",div.className="olButton",this.zoombarDiv=div,this.div.appendChild(div),this.startTop=parseInt(div.style.top),this.div.appendChild(slider),this.map.events.register("zoomend",this,this.moveZoomBar),centered.add(0,this.zoomStopHeight*(this.map.getNumZoomLevels()-minZoom))},_removeZoomBar:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});this.sliderEvents.destroy();this.div.removeChild(this.zoombarDiv);this.zoombarDiv=null;this.div.removeChild(this.slider);this.slider=null;this.map.events.unregister("zoomend",this,this.moveZoomBar)},onButtonClick:function(evt){var levels,zoom;OpenLayers.Control.PanZoom.prototype.onButtonClick.apply(this,arguments);evt.buttonElement===this.zoombarDiv&&(levels=evt.buttonXY.y/this.zoomStopHeight,(this.forceFixedZoomLevel||!this.map.fractionalZoom)&&(levels=Math.floor(levels)),zoom=this.map.getNumZoomLevels()-1-levels,zoom=Math.min(Math.max(zoom,0),this.map.getNumZoomLevels()-1),this.map.zoomTo(zoom))},passEventToSlider:function(evt){this.sliderEvents.handleBrowserEvent(evt)},zoomBarDown:function(evt){if(OpenLayers.Event.isLeftClick(evt)||OpenLayers.Event.isSingleTouch(evt)){this.map.events.on({touchmove:this.passEventToSlider,mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this});this.mouseDragStart=evt.xy.clone();this.zoomStart=evt.xy.clone();this.div.style.cursor="move";this.zoombarDiv.offsets=null;OpenLayers.Event.stop(evt)}},zoomBarDrag:function(evt){var deltaY,offsets,newTop;this.mouseDragStart!=null&&(deltaY=this.mouseDragStart.y-evt.xy.y,offsets=OpenLayers.Util.pagePosition(this.zoombarDiv),evt.clientY-offsets[1]>0&&evt.clientY-offsets[1]<parseInt(this.zoombarDiv.style.height)-2&&(newTop=parseInt(this.slider.style.top)-deltaY,this.slider.style.top=newTop+"px",this.mouseDragStart=evt.xy.clone()),this.deltaY=this.zoomStart.y-evt.xy.y,OpenLayers.Event.stop(evt))},zoomBarUp:function(evt){if((OpenLayers.Event.isLeftClick(evt)||evt.type==="touchend")&&this.mouseDragStart){this.div.style.cursor="";this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var zoomLevel=this.map.zoom;!this.forceFixedZoomLevel&&this.map.fractionalZoom?(zoomLevel+=this.deltaY/this.zoomStopHeight,zoomLevel=Math.min(Math.max(zoomLevel,0),this.map.getNumZoomLevels()-1)):(zoomLevel+=this.deltaY/this.zoomStopHeight,zoomLevel=Math.max(Math.round(zoomLevel),0));this.map.zoomTo(zoomLevel);this.mouseDragStart=null;this.zoomStart=null;this.deltaY=0;OpenLayers.Event.stop(evt)}},moveZoomBar:function(){var newTop=(this.map.getNumZoomLevels()-1-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=newTop+"px"},CLASS_NAME:"OpenLayers.Control.PanZoomBar"});OpenLayers.Format.WFSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},readers:{wfs:OpenLayers.Util.applyDefaults({DefaultSRS:function(node,obj){var defaultSRS=this.getChildValue(node);defaultSRS&&(obj.srs=defaultSRS)}},OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs),ows:OpenLayers.Format.OWSCommon.v1.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_1_0"});OpenLayers.Layer.Image=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!0,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(name,url,extent,size,options){this.url=url;this.extent=extent;this.maxExtent=extent;this.size=size;OpenLayers.Layer.prototype.initialize.apply(this,[name,options]);this.aspectRatio=this.extent.getHeight()/this.size.h/(this.extent.getWidth()/this.size.w)},destroy:function(){this.tile&&(this.removeTileMonitoringHooks(this.tile),this.tile.destroy(),this.tile=null);OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(obj){return obj==null&&(obj=new OpenLayers.Layer.Image(this.name,this.url,this.extent,this.size,this.getOptions())),OpenLayers.Layer.prototype.clone.apply(this,[obj])},setMap:function(){this.options.maxResolution==null&&(this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w);OpenLayers.Layer.prototype.setMap.apply(this,arguments)},moveTo:function(bounds,zoomChanged){var firstRendering,ulPx;OpenLayers.Layer.prototype.moveTo.apply(this,arguments);firstRendering=this.tile==null;(zoomChanged||firstRendering)&&(this.setTileSize(),ulPx=this.map.getLayerPxFromLonLat({lon:this.extent.left,lat:this.extent.top}),firstRendering?(this.tile=new OpenLayers.Tile.Image(this,ulPx,this.extent,null,this.tileSize),this.addTileMonitoringHooks(this.tile)):(this.tile.size=this.tileSize.clone(),this.tile.position=ulPx.clone()),this.tile.draw())},setTileSize:function(){var tileWidth=this.extent.getWidth()/this.map.getResolution(),tileHeight=this.extent.getHeight()/this.map.getResolution();this.tileSize=new OpenLayers.Size(tileWidth,tileHeight)},addTileMonitoringHooks:function(tile){tile.onLoadStart=function(){this.events.triggerEvent("loadstart")};tile.events.register("loadstart",this,tile.onLoadStart);tile.onLoadEnd=function(){this.events.triggerEvent("loadend")};tile.events.register("loadend",this,tile.onLoadEnd);tile.events.register("unload",this,tile.onLoadEnd)},removeTileMonitoringHooks:function(tile){tile.unload();tile.events.un({loadstart:tile.onLoadStart,loadend:tile.onLoadEnd,unload:tile.onLoadEnd,scope:this})},setUrl:function(newUrl){this.url=newUrl;this.tile.draw()},getURL:function(){return this.url},CLASS_NAME:"OpenLayers.Layer.Image"});OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:!0,autoDestroy:!0,initialize:function(options){OpenLayers.Util.extend(this,options);this.options=options;this.active=!1},destroy:function(){this.deactivate();this.layer=null;this.options=null},setLayer:function(layer){this.layer=layer},activate:function(){return this.active?!1:(this.active=!0,!0)},deactivate:function(){return this.active?(this.active=!1,!0):!1},CLASS_NAME:"OpenLayers.Strategy"});OpenLayers.Strategy.Save=OpenLayers.Class(OpenLayers.Strategy,{events:null,auto:!1,timer:null,initialize:function(options){OpenLayers.Strategy.prototype.initialize.apply(this,[options]);this.events=new OpenLayers.Events(this)},activate:function(){var activated=OpenLayers.Strategy.prototype.activate.call(this);if(activated&&this.auto)if(typeof this.auto=="number")this.timer=window.setInterval(OpenLayers.Function.bind(this.save,this),this.auto*1e3);else this.layer.events.on({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this});return activated},deactivate:function(){var deactivated=OpenLayers.Strategy.prototype.deactivate.call(this);return deactivated&&this.auto&&(typeof this.auto=="number"?window.clearInterval(this.timer):this.layer.events.un({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})),deactivated},triggerSave:function(event){var feature=event.feature;(feature.state===OpenLayers.State.INSERT||feature.state===OpenLayers.State.UPDATE||feature.state===OpenLayers.State.DELETE)&&this.save([event.feature])},save:function(features){var remote,local,len,clones,orig,clone,i;if(features||(features=this.layer.features),this.events.triggerEvent("start",{features:features}),remote=this.layer.projection,local=this.layer.map.getProjectionObject(),!local.equals(remote)){for(len=features.length,clones=new Array(len),i=0;i<len;++i)orig=features[i],clone=orig.clone(),clone.fid=orig.fid,clone.state=orig.state,orig.url&&(clone.url=orig.url),clone._original=orig,clone.geometry.transform(local,remote),clones[i]=clone;features=clones}this.layer.protocol.commit(features,{callback:this.onCommit,scope:this})},onCommit:function(response){var evt={response:response},i,len;if(response.success()){var features=response.reqFeatures,state,feature,destroys=[],insertIds=response.insertIds||[],j=0;for(i=0,len=features.length;i<len;++i)feature=features[i],feature=feature._original||feature,state=feature.state,state&&(state==OpenLayers.State.DELETE?destroys.push(feature):state==OpenLayers.State.INSERT&&(feature.fid=insertIds[j],++j),feature.state=null);destroys.length>0&&this.layer.destroyFeatures(destroys);this.events.triggerEvent("success",evt)}else this.events.triggerEvent("fail",evt)},CLASS_NAME:"OpenLayers.Strategy.Save"});OpenLayers.Format.GPX=OpenLayers.Class(OpenLayers.Format.XML,{defaultDesc:"No description available",extractWaypoints:!0,extractTracks:!0,extractRoutes:!0,extractAttributes:!0,namespaces:{gpx:"http://www.topografix.com/GPX/1/1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",creator:"OpenLayers",initialize:function(options){this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,[options])},read:function(doc){var features,tracks,i,segs,j,seglen,track,routes,k,klen,route,waypoints,l,len,attrs,wpt,g,featLength;if(typeof doc=="string"&&(doc=OpenLayers.Format.XML.prototype.read.apply(this,[doc])),features=[],this.extractTracks)for(tracks=doc.getElementsByTagName("trk"),i=0,len=tracks.length;i<len;i++)for(attrs={},this.extractAttributes&&(attrs=this.parseAttributes(tracks[i])),segs=this.getElementsByTagNameNS(tracks[i],tracks[i].namespaceURI,"trkseg"),j=0,seglen=segs.length;j<seglen;j++)track=this.extractSegment(segs[j],"trkpt"),features.push(new OpenLayers.Feature.Vector(track,attrs));if(this.extractRoutes)for(routes=doc.getElementsByTagName("rte"),k=0,klen=routes.length;k<klen;k++)attrs={},this.extractAttributes&&(attrs=this.parseAttributes(routes[k])),route=this.extractSegment(routes[k],"rtept"),features.push(new OpenLayers.Feature.Vector(route,attrs));if(this.extractWaypoints)for(waypoints=doc.getElementsByTagName("wpt"),l=0,len=waypoints.length;l<len;l++)attrs={},this.extractAttributes&&(attrs=this.parseAttributes(waypoints[l])),wpt=new OpenLayers.Geometry.Point(waypoints[l].getAttribute("lon"),waypoints[l].getAttribute("lat")),features.push(new OpenLayers.Feature.Vector(wpt,attrs));if(this.internalProjection&&this.externalProjection)for(g=0,featLength=features.length;g<featLength;g++)features[g].geometry.transform(this.externalProjection,this.internalProjection);return features},extractSegment:function(segment,segmentType){for(var points=this.getElementsByTagNameNS(segment,segment.namespaceURI,segmentType),point_features=[],i=0,len=points.length;i<len;i++)point_features.push(new OpenLayers.Geometry.Point(points[i].getAttribute("lon"),points[i].getAttribute("lat")));return new OpenLayers.Geometry.LineString(point_features)},parseAttributes:function(node){for(var attributes={},attrNode=node.firstChild,value,name;attrNode;)attrNode.nodeType==1&&attrNode.firstChild&&(value=attrNode.firstChild,(value.nodeType==3||value.nodeType==4)&&(name=attrNode.prefix?attrNode.nodeName.split(":")[1]:attrNode.nodeName,name!="trkseg"&&name!="rtept"&&(attributes[name]=value.nodeValue))),attrNode=attrNode.nextSibling;return attributes},write:function(features,metadata){var gpx,i,len;for(features=OpenLayers.Util.isArray(features)?features:[features],gpx=this.createElementNS(this.namespaces.gpx,"gpx"),gpx.setAttribute("version","1.1"),gpx.setAttribute("creator",this.creator),this.setAttributes(gpx,{"xsi:schemaLocation":this.schemaLocation}),metadata&&typeof metadata=="object"&&gpx.appendChild(this.buildMetadataNode(metadata)),i=0,len=features.length;i<len;i++)gpx.appendChild(this.buildFeatureNode(features[i]));return OpenLayers.Format.XML.prototype.write.apply(this,[gpx])},buildMetadataNode:function(metadata){for(var type,n,types=["name","desc","author"],node=this.createElementNSPlus("gpx:metadata"),i=0;i<types.length;i++)type=types[i],metadata[type]&&(n=this.createElementNSPlus("gpx:"+type),n.appendChild(this.createTextNode(metadata[type])),node.appendChild(n));return node},buildFeatureNode:function(feature){var geometry=feature.geometry,wpt,trkNode,trkSegNodes,i,len;if(geometry=geometry.clone(),this.internalProjection&&this.externalProjection&&geometry.transform(this.internalProjection,this.externalProjection),geometry.CLASS_NAME=="OpenLayers.Geometry.Point")return wpt=this.buildWptNode(geometry),this.appendAttributesNode(wpt,feature),wpt;for(trkNode=this.createElementNSPlus("gpx:trk"),this.appendAttributesNode(trkNode,feature),trkSegNodes=this.buildTrkSegNode(geometry),trkSegNodes=OpenLayers.Util.isArray(trkSegNodes)?trkSegNodes:[trkSegNodes],i=0,len=trkSegNodes.length;i<len;i++)trkNode.appendChild(trkSegNodes[i]);return trkNode},buildTrkSegNode:function(geometry){var node,i,len,point,nodes;if(geometry.CLASS_NAME=="OpenLayers.Geometry.LineString"||geometry.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){for(node=this.createElementNSPlus("gpx:trkseg"),i=0,len=geometry.components.length;i<len;i++)point=geometry.components[i],node.appendChild(this.buildTrkPtNode(point));return node}for(nodes=[],i=0,len=geometry.components.length;i<len;i++)nodes.push(this.buildTrkSegNode(geometry.components[i]));return nodes},buildTrkPtNode:function(point){var node=this.createElementNSPlus("gpx:trkpt");return node.setAttribute("lon",point.x),node.setAttribute("lat",point.y),node},buildWptNode:function(geometry){var node=this.createElementNSPlus("gpx:wpt");return node.setAttribute("lon",geometry.x),node.setAttribute("lat",geometry.y),node},appendAttributesNode:function(node,feature){var name=this.createElementNSPlus("gpx:name"),desc;name.appendChild(this.createTextNode(feature.attributes.name||feature.id));node.appendChild(name);desc=this.createElementNSPlus("gpx:desc");desc.appendChild(this.createTextNode(feature.attributes.description||this.defaultDesc));node.appendChild(desc)},CLASS_NAME:"OpenLayers.Format.GPX"});OpenLayers.Format.WFSDescribeFeatureType=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xsd:"http://www.w3.org/2001/XMLSchema"},readers:{xsd:{schema:function(node,obj){var complexTypes=[],customTypes={},schema={complexTypes:complexTypes,customTypes:customTypes},attributes,attr,name,complexType,customType,i,len;for(this.readChildNodes(node,schema),attributes=node.attributes,i=0,len=attributes.length;i<len;++i)attr=attributes[i],name=attr.name,name.indexOf("xmlns")==0?this.setNamespace(name.split(":")[1]||"",attr.value):obj[name]=attr.value;for(obj.featureTypes=complexTypes,obj.targetPrefix=this.namespaceAlias[obj.targetNamespace],i=0,len=complexTypes.length;i<len;++i)complexType=complexTypes[i],customType=customTypes[complexType.typeName],customTypes[complexType.typeName]&&(complexType.typeName=customType.name)},complexType:function(node,obj){var complexType={typeName:node.getAttribute("name")};this.readChildNodes(node,complexType);obj.complexTypes.push(complexType)},complexContent:function(node,obj){this.readChildNodes(node,obj)},extension:function(node,obj){this.readChildNodes(node,obj)},sequence:function(node,obj){var sequence={elements:[]};this.readChildNodes(node,sequence);obj.properties=sequence.elements},element:function(node,obj){var element,attributes,attr,i,len,fullType,type,localType;if(obj.elements){for(element={},attributes=node.attributes,i=0,len=attributes.length;i<len;++i)attr=attributes[i],element[attr.name]=attr.value;type=element.type;type||(type={},this.readChildNodes(node,type),element.restriction=type,element.type=type.base);fullType=type.base||type;element.localType=fullType.split(":").pop();obj.elements.push(element)}obj.complexTypes&&(type=node.getAttribute("type"),localType=type.split(":").pop(),obj.customTypes[localType]={name:node.getAttribute("name"),type:type})},simpleType:function(node,obj){this.readChildNodes(node,obj)},restriction:function(node,obj){obj.base=node.getAttribute("base");this.readRestriction(node,obj)}}},readRestriction:function(node,obj){for(var children=node.childNodes,child,nodeName,value,i=0,len=children.length;i<len;++i)child=children[i],child.nodeType==1&&(nodeName=child.nodeName.split(":").pop(),value=child.getAttribute("value"),obj[nodeName]?(typeof obj[nodeName]=="string"&&(obj[nodeName]=[obj[nodeName]]),obj[nodeName].push(value)):obj[nodeName]=value)},read:function(data){var schema,parser;return typeof data=="string"&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data])),data&&data.nodeType==9&&(data=data.documentElement),schema={},data.nodeName.split(":").pop()==="ExceptionReport"?(parser=new OpenLayers.Format.OGCExceptionReport,schema.error=parser.read(data)):this.readNode(data,schema),schema},CLASS_NAME:"OpenLayers.Format.WFSDescribeFeatureType"});OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:!1,size:null,resolution:null,map:null,featureDx:0,initialize:function(containerID,options){this.container=OpenLayers.Util.getElement(containerID);OpenLayers.Util.extend(this,options)},destroy:function(){this.container=null;this.extent=null;this.size=null;this.resolution=null;this.map=null},supported:function(){return!1},setExtent:function(extent,resolutionChanged){if(this.extent=extent.clone(),this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var ratio=extent.getWidth()/this.map.getExtent().getWidth(),extent=extent.scale(1/ratio);this.extent=extent.wrapDateLine(this.map.getMaxExtent()).scale(ratio)}return resolutionChanged&&(this.resolution=null),!0},setSize:function(size){this.size=size.clone();this.resolution=null},getResolution:function(){return this.resolution=this.resolution||this.map.getResolution(),this.resolution},drawFeature:function(feature,style){var bounds,worldBounds,rendered,location;if(style==null&&(style=feature.style),feature.geometry&&(bounds=feature.geometry.getBounds(),bounds)){if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(worldBounds=this.map.getMaxExtent()),bounds.intersectsBounds(this.extent,{worldBounds:worldBounds})?this.calculateFeatureDx(bounds,worldBounds):style={display:"none"},rendered=this.drawGeometry(feature.geometry,style,feature.id),style.display!="none"&&style.label&&rendered!==!1){if(location=feature.geometry.getCentroid(),style.labelXOffset||style.labelYOffset){var xOffset=isNaN(style.labelXOffset)?0:style.labelXOffset,yOffset=isNaN(style.labelYOffset)?0:style.labelYOffset,res=this.getResolution();location.move(xOffset*res,yOffset*res)}this.drawText(feature.id,style,location)}else this.removeText(feature.id);return rendered}},calculateFeatureDx:function(bounds,worldBounds){if(this.featureDx=0,worldBounds){var worldWidth=worldBounds.getWidth(),rendererCenterX=(this.extent.left+this.extent.right)/2,featureCenterX=(bounds.left+bounds.right)/2,worldsAway=Math.round((featureCenterX-rendererCenterX)/worldWidth);this.featureDx=worldsAway*worldWidth}},drawGeometry:function(){},drawText:function(){},removeText:function(){},clear:function(){},getFeatureIdFromEvent:function(){},eraseFeatures:function(features){var i,len,feature;for(OpenLayers.Util.isArray(features)||(features=[features]),i=0,len=features.length;i<len;++i)feature=features[i],this.eraseGeometry(feature.geometry,feature.id),this.removeText(feature.id)},eraseGeometry:function(){},moveRoot:function(){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(symbolizer){var result=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);return symbolizer.stroke===!1&&(delete result.strokeWidth,delete result.strokeColor),symbolizer.fill===!1&&delete result.fillColor,OpenLayers.Util.extend(result,symbolizer),result},CLASS_NAME:"OpenLayers.Renderer"});OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"};OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]};OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:!0,hitOverflow:0,canvas:null,features:null,pendingRedraw:!1,cachedSymbolBounds:{},initialize:function(){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.root=document.createElement("canvas");this.container.appendChild(this.root);this.canvas=this.root.getContext("2d");this.features={};this.hitDetection&&(this.hitCanvas=document.createElement("canvas"),this.hitContext=this.hitCanvas.getContext("2d"))},setExtent:function(){return OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),!1},eraseGeometry:function(geometry,featureId){this.eraseFeatures(this.features[featureId][0])},supported:function(){return OpenLayers.CANVAS_SUPPORTED},setSize:function(size){var root,hitCanvas;this.size=size.clone();root=this.root;root.style.width=size.w+"px";root.style.height=size.h+"px";root.width=size.w;root.height=size.h;this.resolution=null;this.hitDetection&&(hitCanvas=this.hitCanvas,hitCanvas.style.width=size.w+"px",hitCanvas.style.height=size.h+"px",hitCanvas.width=size.w,hitCanvas.height=size.h)},drawFeature:function(feature,style){var rendered,bounds,worldBounds,intersects;return feature.geometry&&(style=this.applyDefaultSymbolizer(style||feature.style),bounds=feature.geometry.getBounds(),this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(worldBounds=this.map.getMaxExtent()),intersects=bounds&&bounds.intersectsBounds(this.extent,{worldBounds:worldBounds}),rendered=style.display!=="none"&&!!bounds&&intersects,rendered?this.features[feature.id]=[feature,style]:delete this.features[feature.id],this.pendingRedraw=!0),this.pendingRedraw&&!this.locked&&(this.redraw(),this.pendingRedraw=!1),rendered},drawGeometry:function(geometry,style,featureId){var className=geometry.CLASS_NAME,i;if(className=="OpenLayers.Geometry.Collection"||className=="OpenLayers.Geometry.MultiPoint"||className=="OpenLayers.Geometry.MultiLineString"||className=="OpenLayers.Geometry.MultiPolygon"){for(i=0;i<geometry.components.length;i++)this.drawGeometry(geometry.components[i],style,featureId);return}switch(geometry.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(geometry,style,featureId);break;case"OpenLayers.Geometry.LineString":this.drawLineString(geometry,style,featureId);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(geometry,style,featureId);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(geometry,style,featureId)}},drawExternalGraphic:function(geometry,style,featureId){var img=new Image,title=style.title||style.graphicTitle,width,height;title&&(img.title=title);width=style.graphicWidth||style.graphicHeight;height=style.graphicHeight||style.graphicWidth;width=width?width:style.pointRadius*2;height=height?height:style.pointRadius*2;var xOffset=style.graphicXOffset!=undefined?style.graphicXOffset:-(.5*width),yOffset=style.graphicYOffset!=undefined?style.graphicYOffset:-(.5*height),opacity=style.graphicOpacity||style.fillOpacity,onLoad=function(){var factor;if(this.features[featureId]){var pt=this.getLocalXY(geometry),p0=pt[0],p1=pt[1];if(!isNaN(p0)&&!isNaN(p1)){var x=p0+xOffset|0,y=p1+yOffset|0,canvas=this.canvas;canvas.globalAlpha=opacity;factor=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);canvas.drawImage(img,x*factor,y*factor,width*factor,height*factor);this.hitDetection&&(this.setHitContextStyle("fill",featureId),this.hitContext.fillRect(x,y,width,height))}}};img.onload=OpenLayers.Function.bind(onLoad,this);img.src=style.externalGraphic},drawNamedSymbol:function(geometry,style,featureId){var x,y,cx,cy,i,symbolBounds,scaling,angle,unscaledStrokeWidth,deg2rad=Math.PI/180,symbol=OpenLayers.Renderer.symbol[style.graphicName];if(!symbol)throw new Error(style.graphicName+" is not a valid symbol name");if(symbol.length&&!(symbol.length<2)){var pt=this.getLocalXY(geometry),p0=pt[0],p1=pt[1];if(!isNaN(p0)&&!isNaN(p1)){if(this.canvas.lineCap="round",this.canvas.lineJoin="round",this.hitDetection&&(this.hitContext.lineCap="round",this.hitContext.lineJoin="round"),style.graphicName in this.cachedSymbolBounds)symbolBounds=this.cachedSymbolBounds[style.graphicName];else{for(symbolBounds=new OpenLayers.Bounds,i=0;i<symbol.length;i+=2)symbolBounds.extend(new OpenLayers.LonLat(symbol[i],symbol[i+1]));this.cachedSymbolBounds[style.graphicName]=symbolBounds}if(this.canvas.save(),this.hitDetection&&this.hitContext.save(),this.canvas.translate(p0,p1),this.hitDetection&&this.hitContext.translate(p0,p1),angle=deg2rad*style.rotation,isNaN(angle)||(this.canvas.rotate(angle),this.hitDetection&&this.hitContext.rotate(angle)),scaling=2*style.pointRadius/Math.max(symbolBounds.getWidth(),symbolBounds.getHeight()),this.canvas.scale(scaling,scaling),this.hitDetection&&this.hitContext.scale(scaling,scaling),cx=symbolBounds.getCenterLonLat().lon,cy=symbolBounds.getCenterLonLat().lat,this.canvas.translate(-cx,-cy),this.hitDetection&&this.hitContext.translate(-cx,-cy),unscaledStrokeWidth=style.strokeWidth,style.strokeWidth=unscaledStrokeWidth/scaling,style.fill!==!1){for(this.setCanvasStyle("fill",style),this.canvas.beginPath(),i=0;i<symbol.length;i=i+2)x=symbol[i],y=symbol[i+1],i==0&&this.canvas.moveTo(x,y),this.canvas.lineTo(x,y);if(this.canvas.closePath(),this.canvas.fill(),this.hitDetection){for(this.setHitContextStyle("fill",featureId,style),this.hitContext.beginPath(),i=0;i<symbol.length;i=i+2)x=symbol[i],y=symbol[i+1],i==0&&this.canvas.moveTo(x,y),this.hitContext.lineTo(x,y);this.hitContext.closePath();this.hitContext.fill()}}if(style.stroke!==!1){for(this.setCanvasStyle("stroke",style),this.canvas.beginPath(),i=0;i<symbol.length;i=i+2)x=symbol[i],y=symbol[i+1],i==0&&this.canvas.moveTo(x,y),this.canvas.lineTo(x,y);if(this.canvas.closePath(),this.canvas.stroke(),this.hitDetection){for(this.setHitContextStyle("stroke",featureId,style,scaling),this.hitContext.beginPath(),i=0;i<symbol.length;i=i+2)x=symbol[i],y=symbol[i+1],i==0&&this.hitContext.moveTo(x,y),this.hitContext.lineTo(x,y);this.hitContext.closePath();this.hitContext.stroke()}}style.strokeWidth=unscaledStrokeWidth;this.canvas.restore();this.hitDetection&&this.hitContext.restore();this.setCanvasStyle("reset")}}},setCanvasStyle:function(type,style){type==="fill"?(this.canvas.globalAlpha=style.fillOpacity,this.canvas.fillStyle=style.fillColor):type==="stroke"?(this.canvas.globalAlpha=style.strokeOpacity,this.canvas.strokeStyle=style.strokeColor,this.canvas.lineWidth=style.strokeWidth):(this.canvas.globalAlpha=0,this.canvas.lineWidth=1)},featureIdToHex:function(featureId){var id=Number(featureId.split("_").pop())+1,hex,len;return id>=16777216&&(this.hitOverflow=id-16777215,id=id%16777216+1),hex="000000"+id.toString(16),len=hex.length,"#"+hex.substring(len-6,len)},setHitContextStyle:function(type,featureId,symbolizer,strokeScaling){var hex=this.featureIdToHex(featureId);type=="fill"?(this.hitContext.globalAlpha=1,this.hitContext.fillStyle=hex):type=="stroke"?(this.hitContext.globalAlpha=1,this.hitContext.strokeStyle=hex,typeof strokeScaling=="undefined"?this.hitContext.lineWidth=symbolizer.strokeWidth+2:isNaN(strokeScaling)||(this.hitContext.lineWidth=symbolizer.strokeWidth+2/strokeScaling)):(this.hitContext.globalAlpha=0,this.hitContext.lineWidth=1)},drawPoint:function(geometry,style,featureId){var twoPi,radius;if(style.graphic!==!1)if(style.externalGraphic)this.drawExternalGraphic(geometry,style,featureId);else if(style.graphicName&&style.graphicName!="circle")this.drawNamedSymbol(geometry,style,featureId);else{var pt=this.getLocalXY(geometry),p0=pt[0],p1=pt[1];isNaN(p0)||isNaN(p1)||(twoPi=Math.PI*2,radius=style.pointRadius,style.fill!==!1&&(this.setCanvasStyle("fill",style),this.canvas.beginPath(),this.canvas.arc(p0,p1,radius,0,twoPi,!0),this.canvas.fill(),this.hitDetection&&(this.setHitContextStyle("fill",featureId,style),this.hitContext.beginPath(),this.hitContext.arc(p0,p1,radius,0,twoPi,!0),this.hitContext.fill())),style.stroke!==!1&&(this.setCanvasStyle("stroke",style),this.canvas.beginPath(),this.canvas.arc(p0,p1,radius,0,twoPi,!0),this.canvas.stroke(),this.hitDetection&&(this.setHitContextStyle("stroke",featureId,style),this.hitContext.beginPath(),this.hitContext.arc(p0,p1,radius,0,twoPi,!0),this.hitContext.stroke()),this.setCanvasStyle("reset")))}},drawLineString:function(geometry,style,featureId){style=OpenLayers.Util.applyDefaults({fill:!1},style);this.drawLinearRing(geometry,style,featureId)},drawLinearRing:function(geometry,style,featureId){style.fill!==!1&&(this.setCanvasStyle("fill",style),this.renderPath(this.canvas,geometry,style,featureId,"fill"),this.hitDetection&&(this.setHitContextStyle("fill",featureId,style),this.renderPath(this.hitContext,geometry,style,featureId,"fill")));style.stroke!==!1&&(this.setCanvasStyle("stroke",style),this.renderPath(this.canvas,geometry,style,featureId,"stroke"),this.hitDetection&&(this.setHitContextStyle("stroke",featureId,style),this.renderPath(this.hitContext,geometry,style,featureId,"stroke")));this.setCanvasStyle("reset")},renderPath:function(context,geometry,style,featureId,type){var components=geometry.components,len=components.length,i,pt;context.beginPath();var start=this.getLocalXY(components[0]),x=start[0],y=start[1];if(!isNaN(x)&&!isNaN(y)){for(context.moveTo(start[0],start[1]),i=1;i<len;++i)pt=this.getLocalXY(components[i]),context.lineTo(pt[0],pt[1]);type==="fill"?context.fill():context.stroke()}},drawPolygon:function(geometry,style,featureId){var components=geometry.components,len=components.length,i;for(this.drawLinearRing(components[0],style,featureId),i=1;i<len;++i)this.canvas.globalCompositeOperation="destination-out",this.hitDetection&&(this.hitContext.globalCompositeOperation="destination-out"),this.drawLinearRing(components[i],OpenLayers.Util.applyDefaults({stroke:!1,fillOpacity:1},style),featureId),this.canvas.globalCompositeOperation="source-over",this.hitDetection&&(this.hitContext.globalCompositeOperation="source-over"),this.drawLinearRing(components[i],OpenLayers.Util.applyDefaults({fill:!1},style),featureId)},drawText:function(location,style){var pt=this.getLocalXY(location),hfactor,vfactor,lineHeight,i,x,y;this.setCanvasStyle("reset");this.canvas.fillStyle=style.fontColor;this.canvas.globalAlpha=style.fontOpacity||1;var fontStyle=[style.fontStyle?style.fontStyle:"normal","normal",style.fontWeight?style.fontWeight:"normal",style.fontSize?style.fontSize:"1em",style.fontFamily?style.fontFamily:"sans-serif"].join(" "),labelRows=style.label.split("\n"),numRows=labelRows.length;if(this.canvas.fillText)for(this.canvas.font=fontStyle,this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[style.labelAlign[0]]||"center",this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[style.labelAlign[1]]||"middle",vfactor=OpenLayers.Renderer.Canvas.LABEL_FACTOR[style.labelAlign[1]],vfactor==null&&(vfactor=-.5),lineHeight=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width,pt[1]+=lineHeight*vfactor*(numRows-1),i=0;i<numRows;i++)style.labelOutlineWidth&&(this.canvas.save(),this.canvas.strokeStyle=style.labelOutlineColor,this.canvas.lineWidth=style.labelOutlineWidth,this.canvas.strokeText(labelRows[i],pt[0],pt[1]+lineHeight*i+1),this.canvas.restore()),this.canvas.fillText(labelRows[i],pt[0],pt[1]+lineHeight*i);else if(this.canvas.mozDrawText)for(this.canvas.mozTextStyle=fontStyle,hfactor=OpenLayers.Renderer.Canvas.LABEL_FACTOR[style.labelAlign[0]],hfactor==null&&(hfactor=-.5),vfactor=OpenLayers.Renderer.Canvas.LABEL_FACTOR[style.labelAlign[1]],vfactor==null&&(vfactor=-.5),lineHeight=this.canvas.mozMeasureText("xx"),pt[1]+=lineHeight*(1+vfactor*numRows),i=0;i<numRows;i++)x=pt[0]+hfactor*this.canvas.mozMeasureText(labelRows[i]),y=pt[1]+i*lineHeight,this.canvas.translate(x,y),this.canvas.mozDrawText(labelRows[i]),this.canvas.translate(-x,-y);this.setCanvasStyle("reset")},getLocalXY:function(point){var resolution=this.getResolution(),extent=this.extent,x=(point.x-this.featureDx)/resolution+-extent.left/resolution,y=extent.top/resolution-point.y/resolution;return[x,y]},clear:function(){var height=this.root.height,width=this.root.width;this.canvas.clearRect(0,0,width,height);this.features={};this.hitDetection&&this.hitContext.clearRect(0,0,width,height)},getFeatureIdFromEvent:function(evt){var featureId,feature,id;if(this.hitDetection&&this.root.style.display!=="none"&&!this.map.dragging){var xy=evt.xy,x=xy.x|0,y=xy.y|0,data=this.hitContext.getImageData(x,y,1,1).data;if(data[3]===255&&(id=data[2]+256*(data[1]+256*data[0]),id)){featureId="OpenLayers_Feature_Vector_"+(id-1+this.hitOverflow);try{feature=this.features[featureId][0]}catch(err){}}}return feature},eraseFeatures:function(features){OpenLayers.Util.isArray(features)||(features=[features]);for(var i=0;i<features.length;++i)delete this.features[features[i].id];this.redraw()},redraw:function(){var height,width,labelMap,feature,geometry,style,worldBounds,id,item,i,len;if(!this.locked){height=this.root.height;width=this.root.width;this.canvas.clearRect(0,0,width,height);this.hitDetection&&this.hitContext.clearRect(0,0,width,height);labelMap=[];worldBounds=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent();for(id in this.features)this.features.hasOwnProperty(id)&&(feature=this.features[id][0],geometry=feature.geometry,this.calculateFeatureDx(geometry.getBounds(),worldBounds),style=this.features[id][1],this.drawGeometry(geometry,style,feature.id),style.label&&labelMap.push([feature,style]));for(i=0,len=labelMap.length;i<len;++i)item=labelMap[i],this.drawText(item[0].geometry.getCentroid(),item[1])}},CLASS_NAME:"OpenLayers.Renderer.Canvas"});OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"};OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1};OpenLayers.Renderer.Canvas.drawImageScaleFactor=null;OpenLayers.Format.OSM=OpenLayers.Class(OpenLayers.Format.XML,{checkTags:!1,interestingTagsExclude:null,areaTags:null,initialize:function(options){var layer_defaults={interestingTagsExclude:["source","source_ref","source:ref","history","attribution","created_by"],areaTags:["area","building","leisure","tourism","ruins","historic","landuse","military","natural","sport"]},interesting,area,i;for(layer_defaults=OpenLayers.Util.extend(layer_defaults,options),interesting={},i=0;i<layer_defaults.interestingTagsExclude.length;i++)interesting[layer_defaults.interestingTagsExclude[i]]=!0;for(layer_defaults.interestingTagsExclude=interesting,area={},i=0;i<layer_defaults.areaTags.length;i++)area[layer_defaults.areaTags[i]]=!0;layer_defaults.areaTags=area;this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,[layer_defaults])},read:function(doc){var i,point_list,poly,j,point,geometry,node_id,node,tags,result,feat;typeof doc=="string"&&(doc=OpenLayers.Format.XML.prototype.read.apply(this,[doc]));var nodes=this.getNodes(doc),ways=this.getWays(doc),feat_list=new Array(ways.length);for(i=0;i<ways.length;i++){for(point_list=new Array(ways[i].nodes.length),poly=this.isWayArea(ways[i])?1:0,j=0;j<ways[i].nodes.length;j++)node=nodes[ways[i].nodes[j]],point=new OpenLayers.Geometry.Point(node.lon,node.lat),point.osm_id=parseInt(ways[i].nodes[j]),point_list[j]=point,node.used=!0;geometry=null;geometry=poly?new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.LinearRing(point_list)):new OpenLayers.Geometry.LineString(point_list);this.internalProjection&&this.externalProjection&&geometry.transform(this.externalProjection,this.internalProjection);feat=new OpenLayers.Feature.Vector(geometry,ways[i].tags);feat.osm_id=parseInt(ways[i].id);feat.fid="way."+feat.osm_id;feat_list[i]=feat}for(node_id in nodes){if(node=nodes[node_id],!node.used||this.checkTags){if(tags=null,this.checkTags){if(result=this.getTags(node.node,!0),node.used&&!result[1])continue;tags=result[0]}else tags=this.getTags(node.node);feat=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(node.lon,node.lat),tags);this.internalProjection&&this.externalProjection&&feat.geometry.transform(this.externalProjection,this.internalProjection);feat.osm_id=parseInt(node_id);feat.fid="node."+feat.osm_id;feat_list.push(feat)}node.node=null}return feat_list},getNodes:function(doc){for(var node,id,node_list=doc.getElementsByTagName("node"),nodes={},i=0;i<node_list.length;i++)node=node_list[i],id=node.getAttribute("id"),nodes[id]={lat:node.getAttribute("lat"),lon:node.getAttribute("lon"),node:node};return nodes},getWays:function(doc){for(var way,way_object,node_list,j,way_list=doc.getElementsByTagName("way"),return_ways=[],i=0;i<way_list.length;i++){for(way=way_list[i],way_object={id:way.getAttribute("id")},way_object.tags=this.getTags(way),node_list=way.getElementsByTagName("nd"),way_object.nodes=new Array(node_list.length),j=0;j<node_list.length;j++)way_object.nodes[j]=node_list[j].getAttribute("ref");return_ways.push(way_object)}return return_ways},getTags:function(dom_node,interesting_tags){for(var key,tag_list=dom_node.getElementsByTagName("tag"),tags={},interesting=!1,j=0;j<tag_list.length;j++)key=tag_list[j].getAttribute("k"),tags[key]=tag_list[j].getAttribute("v"),interesting_tags&&(this.interestingTagsExclude[key]||(interesting=!0));return interesting_tags?[tags,interesting]:tags},isWayArea:function(way){var poly_shaped=!1,poly_tags=!1,key;if(way.nodes[0]==way.nodes[way.nodes.length-1]&&(poly_shaped=!0),this.checkTags)for(key in way.tags)if(this.areaTags[key]){poly_tags=!0;break}return poly_shaped&&(this.checkTags?poly_tags:!0)},write:function(features){var root_node,i,nodes,j;for(OpenLayers.Util.isArray(features)||(features=[features]),this.osm_id=1,this.created_nodes={},root_node=this.createElementNS(null,"osm"),root_node.setAttribute("version","0.5"),root_node.setAttribute("generator","OpenLayers "+OpenLayers.VERSION_NUMBER),i=features.length-1;i>=0;i--)for(nodes=this.createFeatureNodes(features[i]),j=0;j<nodes.length;j++)root_node.appendChild(nodes[j]);return OpenLayers.Format.XML.prototype.write.apply(this,[root_node])},createFeatureNodes:function(feature){var nodes=[],className=feature.geometry.CLASS_NAME,type=className.substring(className.lastIndexOf(".")+1),builder;return type=type.toLowerCase(),builder=this.createXML[type],builder&&(nodes=builder.apply(this,[feature])),nodes},createXML:{point:function(point){var id=null,geometry=point.geometry?point.geometry:point,already_exists,node;return this.internalProjection&&this.externalProjection&&(geometry=geometry.clone(),geometry.transform(this.internalProjection,this.externalProjection)),already_exists=!1,point.osm_id?(id=point.osm_id,this.created_nodes[id]&&(already_exists=!0)):(id=-this.osm_id,this.osm_id++),node=already_exists?this.created_nodes[id]:this.createElementNS(null,"node"),this.created_nodes[id]=node,node.setAttribute("id",id),node.setAttribute("lon",geometry.x),node.setAttribute("lat",geometry.y),point.attributes&&this.serializeTags(point,node),this.setState(point,node),already_exists?[]:[node]},linestring:function(feature){var id,nodes=[],geometry=feature.geometry,way,i,node,node_ref,nd_dom;for(feature.osm_id?id=feature.osm_id:(id=-this.osm_id,this.osm_id++),way=this.createElementNS(null,"way"),way.setAttribute("id",id),i=0;i<geometry.components.length;i++)node=this.createXML.point.apply(this,[geometry.components[i]]),node.length?(node=node[0],node_ref=node.getAttribute("id"),nodes.push(node)):(node_ref=geometry.components[i].osm_id,node=this.created_nodes[node_ref]),this.setState(feature,node),nd_dom=this.createElementNS(null,"nd"),nd_dom.setAttribute("ref",node_ref),way.appendChild(nd_dom);return this.serializeTags(feature,way),nodes.push(way),nodes},polygon:function(feature){var attrs=OpenLayers.Util.extend({area:"yes"},feature.attributes),feat=new OpenLayers.Feature.Vector(feature.geometry.components[0],attrs);return feat.osm_id=feature.osm_id,this.createXML.linestring.apply(this,[feat])}},serializeTags:function(feature,node){var key,tag;for(key in feature.attributes)tag=this.createElementNS(null,"tag"),tag.setAttribute("k",key),tag.setAttribute("v",feature.attributes[key]),node.appendChild(tag)},setState:function(feature,node){if(feature.state){var state=null;switch(feature.state){case OpenLayers.State.UPDATE:state="modify";case OpenLayers.State.DELETE:state="delete"}state&&node.setAttribute("action",state)}},CLASS_NAME:"OpenLayers.Format.OSM"});OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null},touchstart:{"in":"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,touch:!1,clickTolerance:4,geometryTypes:null,stopClick:!0,stopDown:!0,stopUp:!1,initialize:function(control,layer,callbacks,options){OpenLayers.Handler.prototype.initialize.apply(this,[control,callbacks,options]);this.layer=layer},touchstart:function(evt){return this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),OpenLayers.Event.isMultiTouch(evt)?!0:this.mousedown(evt)},touchmove:function(evt){OpenLayers.Event.stop(evt)},mousedown:function(evt){return(OpenLayers.Event.isLeftClick(evt)||OpenLayers.Event.isSingleTouch(evt))&&(this.down=evt.xy),this.handle(evt)?!this.stopDown:!0},mouseup:function(evt){return this.up=evt.xy,this.handle(evt)?!this.stopUp:!0},click:function(evt){return this.handle(evt)?!this.stopClick:!0},mousemove:function(evt){return!this.callbacks.over&&!this.callbacks.out?!0:(this.handle(evt),!0)},dblclick:function(evt){return!this.handle(evt)},geometryTypeMatches:function(feature){return this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,feature.geometry.CLASS_NAME)>-1},handle:function(evt){var inNew;this.feature&&!this.feature.layer&&(this.feature=null);var type=evt.type,handled=!1,previouslyIn=!!this.feature,click=type=="click"||type=="dblclick"||type=="touchstart";return this.feature=this.layer.getFeatureFromEvent(evt),this.feature&&!this.feature.layer&&(this.feature=null),this.lastFeature&&!this.lastFeature.layer&&(this.lastFeature=null),this.feature?(type==="touchstart"&&OpenLayers.Event.stop(evt),inNew=this.feature!=this.lastFeature,this.geometryTypeMatches(this.feature)?(previouslyIn&&inNew?(this.lastFeature&&this.triggerCallback(type,"out",[this.lastFeature]),this.triggerCallback(type,"in",[this.feature])):(!previouslyIn||click)&&this.triggerCallback(type,"in",[this.feature]),this.lastFeature=this.feature,handled=!0):(this.lastFeature&&(previouslyIn&&inNew||click)&&this.triggerCallback(type,"out",[this.lastFeature]),this.feature=null)):this.lastFeature&&(previouslyIn||click)&&this.triggerCallback(type,"out",[this.lastFeature]),handled},triggerCallback:function(type,mode,args){var key=this.EVENTMAP[type][mode],dpx;key&&(type=="click"&&this.up&&this.down?(dpx=Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2)),dpx<=this.clickTolerance&&this.callback(key,args)):this.callback(key,args))},activate:function(){var activated=!1;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.moveLayerToTop();this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});activated=!0}return activated},deactivate:function(){var deactivated=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.moveLayerBack(),this.feature=null,this.lastFeature=null,this.down=null,this.up=null,this.touch=!1,this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),deactivated=!0),deactivated},handleMapEvents:function(evt){(evt.type=="removelayer"||evt.property=="order")&&this.moveLayerToTop()},moveLayerToTop:function(){var index=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(index)},moveLayerBack:function(){var index=this.layer.getZIndex()-1;index>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(index):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Handler.Feature"});OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(){},onDrag:function(){},onComplete:function(){},onEnter:function(){},onLeave:function(){},documentDrag:!1,layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(layer,options){OpenLayers.Control.prototype.initialize.apply(this,[options]);this.layer=layer;this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks),{documentDrag:this.documentDrag}),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},clickFeature:function(feature){this.handlers.feature.touch&&!this.over&&this.overFeature(feature)&&(this.handlers.drag.dragstart(this.handlers.feature.evt),this.handlers.drag.stopDown=!1)},clickoutFeature:function(feature){this.handlers.feature.touch&&this.over&&(this.outFeature(feature),this.handlers.drag.stopDown=!0)},destroy:function(){this.layer=null;OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.handlers.drag.deactivate(),this.handlers.feature.deactivate(),this.feature=null,this.dragging=!1,this.lastPixel=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(feature){var activated=!1;if(this.handlers.drag.dragging)this.over=this.feature.id==feature.id?!0:!1;else{this.feature=feature;this.handlers.drag.activate();activated=!0;this.over=!0;OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over");this.onEnter(feature)}return activated},downFeature:function(pixel){this.lastPixel=pixel;this.onStart(this.feature,pixel)},moveFeature:function(pixel){var res=this.map.getResolution();this.feature.geometry.move(res*(pixel.x-this.lastPixel.x),res*(this.lastPixel.y-pixel.y));this.layer.drawFeature(this.feature);this.lastPixel=pixel;this.onDrag(this.feature,pixel)},upFeature:function(){this.over||this.handlers.drag.deactivate()},doneDragging:function(pixel){this.onComplete(this.feature,pixel)},outFeature:function(feature){if(this.handlers.drag.dragging)this.feature.id==feature.id&&(this.over=!1);else{this.over=!1;this.handlers.drag.deactivate();OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");this.onLeave(feature);this.feature=null}},cancel:function(){this.handlers.drag.deactivate();this.over=!1},setMap:function(map){this.handlers.drag.setMap(map);this.handlers.feature.setMap(map);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragFeature"});OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:!0,initialize:function(style,options){if(this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])},style instanceof OpenLayers.Style)this.styles["default"]=style,this.styles.select=style,this.styles.temporary=style,this.styles["delete"]=style;else if(typeof style=="object")for(var key in style)if(style[key]instanceof OpenLayers.Style)this.styles[key]=style[key];else if(typeof style[key]=="object")this.styles[key]=new OpenLayers.Style(style[key]);else{this.styles["default"]=new OpenLayers.Style(style);this.styles.select=new OpenLayers.Style(style);this.styles.temporary=new OpenLayers.Style(style);this.styles["delete"]=new OpenLayers.Style(style);break}OpenLayers.Util.extend(this,options)},destroy:function(){for(var key in this.styles)this.styles[key].destroy();this.styles=null},createSymbolizer:function(feature,intent){feature||(feature=new OpenLayers.Feature.Vector);this.styles[intent]||(intent="default");feature.renderIntent=intent;var defaultSymbolizer={};return this.extendDefault&&intent!="default"&&(defaultSymbolizer=this.styles["default"].createSymbolizer(feature)),OpenLayers.Util.extend(defaultSymbolizer,this.styles[intent].createSymbolizer(feature))},addUniqueValueRules:function(renderIntent,property,symbolizers,context){var rules=[];for(var value in symbolizers)rules.push(new OpenLayers.Rule({symbolizer:symbolizers[value],context:context,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:property,value:value})}));this.styles[renderIntent].addRules(rules)},CLASS_NAME:"OpenLayers.StyleMap"});OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,isFixed:!1,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:!0,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:!1,ratio:1,initialize:function(){if(OpenLayers.Layer.prototype.initialize.apply(this,arguments),this.renderer&&this.renderer.supported()||this.assignRenderer(),this.renderer&&this.renderer.supported()||(this.renderer=null,this.displayError()),this.styleMap||(this.styleMap=new OpenLayers.StyleMap),this.features=[],this.selectedFeatures=[],this.unrenderedFeatures={},this.strategies)for(var i=0,len=this.strategies.length;i<len;i++)this.strategies[i].setLayer(this)},destroy:function(){if(this.strategies){for(var strategy,i=0,len=this.strategies.length;i<len;i++)strategy=this.strategies[i],strategy.autoDestroy&&strategy.destroy();this.strategies=null}this.protocol&&(this.protocol.autoDestroy&&this.protocol.destroy(),this.protocol=null);this.destroyFeatures();this.features=null;this.selectedFeatures=null;this.unrenderedFeatures=null;this.renderer&&this.renderer.destroy();this.renderer=null;this.geometryType=null;this.drawn=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(obj){var i;obj==null&&(obj=new OpenLayers.Layer.Vector(this.name,this.getOptions()));obj=OpenLayers.Layer.prototype.clone.apply(this,[obj]);var features=this.features,len=features.length,clonedFeatures=new Array(len);for(i=0;i<len;++i)clonedFeatures[i]=features[i].clone();return obj.features=clonedFeatures,obj},refresh:function(obj){this.calculateInRange()&&this.visibility&&this.events.triggerEvent("refresh",obj)},assignRenderer:function(){for(var rendererClass,renderer,i=0,len=this.renderers.length;i<len;i++)if(rendererClass=this.renderers[i],renderer=typeof rendererClass=="function"?rendererClass:OpenLayers.Renderer[rendererClass],renderer&&renderer.prototype.supported()){this.renderer=new renderer(this.div,this.rendererOptions);break}},displayError:function(){this.reportError&&OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))},setMap:function(){if(OpenLayers.Layer.prototype.setMap.apply(this,arguments),this.renderer){this.renderer.map=this.map;var newSize=this.map.getSize();newSize.w=newSize.w*this.ratio;newSize.h=newSize.h*this.ratio;this.renderer.setSize(newSize)}else this.map.removeLayer(this)},afterAdd:function(){if(this.strategies)for(var strategy,i=0,len=this.strategies.length;i<len;i++)strategy=this.strategies[i],strategy.autoActivate&&strategy.activate()},removeMap:function(){if(this.drawn=!1,this.strategies)for(var strategy,i=0,len=this.strategies.length;i<len;i++)strategy=this.strategies[i],strategy.autoActivate&&strategy.deactivate()},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);var newSize=this.map.getSize();newSize.w=newSize.w*this.ratio;newSize.h=newSize.h*this.ratio;this.renderer.setSize(newSize)},moveTo:function(bounds,zoomChanged,dragging){var coordSysUnchanged,extent,feature,i,len;if(OpenLayers.Layer.prototype.moveTo.apply(this,arguments),coordSysUnchanged=!0,!dragging){this.renderer.root.style.visibility="hidden";var viewSize=this.map.getSize(),viewWidth=viewSize.w,viewHeight=viewSize.h,offsetLeft=viewWidth/2*this.ratio-viewWidth/2,offsetTop=viewHeight/2*this.ratio-viewHeight/2;if(offsetLeft+=this.map.layerContainerOriginPx.x,offsetLeft=-Math.round(offsetLeft),offsetTop+=this.map.layerContainerOriginPx.y,offsetTop=-Math.round(offsetTop),this.div.style.left=offsetLeft+"px",this.div.style.top=offsetTop+"px",extent=this.map.getExtent().scale(this.ratio),coordSysUnchanged=this.renderer.setExtent(extent,zoomChanged),this.renderer.root.style.visibility="visible",OpenLayers.IS_GECKO===!0&&(this.div.scrollLeft=this.div.scrollLeft),!zoomChanged&&coordSysUnchanged)for(i in this.unrenderedFeatures)feature=this.unrenderedFeatures[i],this.drawFeature(feature)}if(!this.drawn||zoomChanged||!coordSysUnchanged)for(this.drawn=!0,i=0,len=this.features.length;i<len;i++)this.renderer.locked=i!==len-1,feature=this.features[i],this.drawFeature(feature)},display:function(){OpenLayers.Layer.prototype.display.apply(this,arguments);var currentDisplay=this.div.style.display;currentDisplay!=this.renderer.root.style.display&&(this.renderer.root.style.display=currentDisplay)},addFeatures:function(features,options){var notify,event,ret,featuresAdded,i,len,feature;if(OpenLayers.Util.isArray(features)||(features=[features]),notify=!options||!options.silent,notify){if(event={features:features},ret=this.events.triggerEvent("beforefeaturesadded",event),ret===!1)return;features=event.features}for(featuresAdded=[],i=0,len=features.length;i<len;i++){if(this.renderer.locked=i!=features.length-1?!0:!1,feature=features[i],this.geometryType&&!(feature.geometry instanceof this.geometryType))throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME);if(feature.layer=this,!feature.style&&this.style&&(feature.style=OpenLayers.Util.extend({},this.style)),notify){if(this.events.triggerEvent("beforefeatureadded",{feature:feature})===!1)continue;this.preFeatureInsert(feature)}if(featuresAdded.push(feature),this.features.push(feature),this.drawFeature(feature),notify){this.events.triggerEvent("featureadded",{feature:feature});this.onFeatureInsert(feature)}}notify&&this.events.triggerEvent("featuresadded",{features:featuresAdded})},removeFeatures:function(features,options){var notify,i,feature;if(features&&features.length!==0){if(features===this.features)return this.removeAllFeatures(options);for(OpenLayers.Util.isArray(features)||(features=[features]),features===this.selectedFeatures&&(features=features.slice()),notify=!options||!options.silent,notify&&this.events.triggerEvent("beforefeaturesremoved",{features:features}),i=features.length-1;i>=0;i--)this.renderer.locked=i!=0&&features[i-1].geometry?!0:!1,feature=features[i],delete this.unrenderedFeatures[feature.id],notify&&this.events.triggerEvent("beforefeatureremoved",{feature:feature}),this.features=OpenLayers.Util.removeItem(this.features,feature),feature.layer=null,feature.geometry&&this.renderer.eraseFeatures(feature),OpenLayers.Util.indexOf(this.selectedFeatures,feature)!=-1&&OpenLayers.Util.removeItem(this.selectedFeatures,feature),notify&&this.events.triggerEvent("featureremoved",{feature:feature});notify&&this.events.triggerEvent("featuresremoved",{features:features})}},removeAllFeatures:function(options){var notify=!options||!options.silent,features=this.features,feature,i;for(notify&&this.events.triggerEvent("beforefeaturesremoved",{features:features}),i=features.length-1;i>=0;i--)feature=features[i],notify&&this.events.triggerEvent("beforefeatureremoved",{feature:feature}),feature.layer=null,notify&&this.events.triggerEvent("featureremoved",{feature:feature});this.renderer.clear();this.features=[];this.unrenderedFeatures={};this.selectedFeatures=[];notify&&this.events.triggerEvent("featuresremoved",{features:features})},destroyFeatures:function(features,options){var all=features==undefined,i;if(all&&(features=this.features),features)for(this.removeFeatures(features,options),i=features.length-1;i>=0;i--)features[i].destroy()},drawFeature:function(feature,style){var renderIntent,drawn;this.drawn&&(typeof style!="object"&&(style||feature.state!==OpenLayers.State.DELETE||(style="delete"),renderIntent=style||feature.renderIntent,style=feature.style||this.style,style||(style=this.styleMap.createSymbolizer(feature,renderIntent))),drawn=this.renderer.drawFeature(feature,style),drawn===!1||drawn===null?this.unrenderedFeatures[feature.id]=feature:delete this.unrenderedFeatures[feature.id])},eraseFeatures:function(features){this.renderer.eraseFeatures(features)},getFeatureFromEvent:function(evt){if(!this.renderer)throw new Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.");var feature=null,featureId=this.renderer.getFeatureIdFromEvent(evt);return featureId&&(feature=typeof featureId=="string"?this.getFeatureById(featureId):featureId),feature},getFeatureBy:function(property,value){for(var feature=null,i=0,len=this.features.length;i<len;++i)if(this.features[i][property]==value){feature=this.features[i];break}return feature},getFeatureById:function(featureId){return this.getFeatureBy("id",featureId)},getFeatureByFid:function(featureFid){return this.getFeatureBy("fid",featureFid)},getFeaturesByAttribute:function(attrName,attrValue){for(var feature,len=this.features.length,foundFeatures=[],i=0;i<len;i++)feature=this.features[i],feature&&feature.attributes&&feature.attributes[attrName]===attrValue&&foundFeatures.push(feature);return foundFeatures},onFeatureInsert:function(){},preFeatureInsert:function(){},getDataExtent:function(){var maxExtent=null,features=this.features,geometry,i,len;if(features&&features.length>0)for(geometry=null,i=0,len=features.length;i<len;i++)geometry=features[i].geometry,geometry&&(maxExtent===null&&(maxExtent=new OpenLayers.Bounds),maxExtent.extend(geometry.getBounds()));return maxExtent},CLASS_NAME:"OpenLayers.Layer.Vector"});OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:!1,layers:null,display:function(){},getFeatureFromEvent:function(evt){for(var layers=this.layers,feature,i=0;i<layers.length;i++)if(feature=layers[i].getFeatureFromEvent(evt),feature)return feature},setMap:function(map){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);this.collectRoots();map.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(map){map.events.unregister("changelayer",this,this.handleChangeLayer);this.resetRoots();OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){for(var layer,i=0;i<this.map.layers.length;++i)layer=this.map.layers[i],OpenLayers.Util.indexOf(this.layers,layer)!=-1&&layer.renderer.moveRoot(this.renderer)},resetRoots:function(){for(var layer,i=0;i<this.layers.length;++i)layer=this.layers[i],this.renderer&&layer.renderer.getRenderLayerId()==this.id&&this.renderer.moveRoot(layer.renderer)},handleChangeLayer:function(evt){var layer=evt.layer;evt.property=="order"&&OpenLayers.Util.indexOf(this.layers,layer)!=-1&&(this.resetRoots(),this.collectRoots())},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"});OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{multipleKey:null,toggleKey:null,multiple:!1,clickout:!0,toggle:!1,hover:!1,highlightOnly:!1,box:!1,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(layers,options){OpenLayers.Control.prototype.initialize.apply(this,[options]);this.scope===null&&(this.scope=this);this.initLayer(layers);var callbacks={click:this.clickFeature,clickout:this.clickoutFeature};this.hover&&(callbacks.over=this.overFeature,callbacks.out=this.outFeature);this.callbacks=OpenLayers.Util.extend(callbacks,this.callbacks);this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})};this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"}))},initLayer:function(layers){OpenLayers.Util.isArray(layers)?(this.layers=layers,this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:layers})):this.layer=layers},destroy:function(){this.active&&this.layers&&this.map.removeLayer(this.layer);OpenLayers.Control.prototype.destroy.apply(this,arguments);this.layers&&this.layer.destroy()},activate:function(){return this.active||(this.layers&&this.map.addLayer(this.layer),this.handlers.feature.activate(),this.box&&this.handlers.box&&this.handlers.box.activate()),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.active&&(this.handlers.feature.deactivate(),this.handlers.box&&this.handlers.box.deactivate(),this.layers&&this.map.removeLayer(this.layer)),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(options){for(var layers=this.layers||[this.layer],layer,feature,numExcept,l=0;l<layers.length;++l)for(layer=layers[l],numExcept=0;layer.selectedFeatures.length>numExcept;)feature=layer.selectedFeatures[numExcept],options&&options.except==feature?++numExcept:this.unselect(feature)},clickFeature:function(feature){if(!this.hover){var selected=OpenLayers.Util.indexOf(feature.layer.selectedFeatures,feature)>-1;selected?this.toggleSelect()?this.unselect(feature):this.multipleSelect()||this.unselectAll({except:feature}):(this.multipleSelect()||this.unselectAll({except:feature}),this.select(feature))}},multipleSelect:function(){return this.multiple||this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]},toggleSelect:function(){return this.toggle||this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(){!this.hover&&this.clickout&&this.unselectAll()},overFeature:function(feature){var layer=feature.layer;this.hover&&(this.highlightOnly?this.highlight(feature):OpenLayers.Util.indexOf(layer.selectedFeatures,feature)==-1&&this.select(feature))},outFeature:function(feature){if(this.hover)if(this.highlightOnly){if(feature._lastHighlighter==this.id)if(feature._prevHighlighter&&feature._prevHighlighter!=this.id){delete feature._lastHighlighter;var control=this.map.getControl(feature._prevHighlighter);control&&control.highlight(feature)}else this.unhighlight(feature)}else this.unselect(feature)},highlight:function(feature){var layer=feature.layer,cont=this.events.triggerEvent("beforefeaturehighlighted",{feature:feature}),style;cont!==!1&&(feature._prevHighlighter=feature._lastHighlighter,feature._lastHighlighter=this.id,style=this.selectStyle||this.renderIntent,layer.drawFeature(feature,style),this.events.triggerEvent("featurehighlighted",{feature:feature}))},unhighlight:function(feature){var layer=feature.layer;feature._prevHighlighter==undefined?delete feature._lastHighlighter:feature._prevHighlighter==this.id?delete feature._prevHighlighter:(feature._lastHighlighter=feature._prevHighlighter,delete feature._prevHighlighter);layer.drawFeature(feature,feature.style||feature.layer.style||"default");this.events.triggerEvent("featureunhighlighted",{feature:feature})},select:function(feature){var cont=this.onBeforeSelect.call(this.scope,feature),layer=feature.layer;cont!==!1&&(cont=layer.events.triggerEvent("beforefeatureselected",{feature:feature}),cont!==!1&&(layer.selectedFeatures.push(feature),this.highlight(feature),this.handlers.feature.lastFeature||(this.handlers.feature.lastFeature=layer.selectedFeatures[0]),layer.events.triggerEvent("featureselected",{feature:feature}),this.onSelect.call(this.scope,feature)))},unselect:function(feature){var layer=feature.layer;this.unhighlight(feature);OpenLayers.Util.removeItem(layer.selectedFeatures,feature);layer.events.triggerEvent("featureunselected",{feature:feature});this.onUnselect.call(this.scope,feature)},selectBox:function(position){var prevMultiple,layers,layer,l,i,len,feature;if(position instanceof OpenLayers.Bounds){var minXY=this.map.getLonLatFromPixel({x:position.left,y:position.bottom}),maxXY=this.map.getLonLatFromPixel({x:position.right,y:position.top}),bounds=new OpenLayers.Bounds(minXY.lon,minXY.lat,maxXY.lon,maxXY.lat);for(this.multipleSelect()||this.unselectAll(),prevMultiple=this.multiple,this.multiple=!0,layers=this.layers||[this.layer],this.events.triggerEvent("boxselectionstart",{layers:layers}),l=0;l<layers.length;++l)for(layer=layers[l],i=0,len=layer.features.length;i<len;++i)(feature=layer.features[i],feature.getVisibility())&&(this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,feature.geometry.CLASS_NAME)>-1)&&bounds.toGeometry().intersects(feature.geometry)&&OpenLayers.Util.indexOf(layer.selectedFeatures,feature)==-1&&this.select(feature);this.multiple=prevMultiple;this.events.triggerEvent("boxselectionend",{layers:layers})}},setMap:function(map){this.handlers.feature.setMap(map);this.box&&this.handlers.box.setMap(map);OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(layers){var isActive=this.active;this.unselectAll();this.deactivate();this.layers&&(this.layer.destroy(),this.layers=null);this.initLayer(layers);this.handlers.feature.layer=this.layer;isActive&&this.activate()},CLASS_NAME:"OpenLayers.Control.SelectFeature"});OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,observeElement:null,initialize:function(){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate();this.eventListener=null;OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.observeElement=this.observeElement||document;for(var i=0,len=this.KEY_EVENTS.length;i<len;i++)OpenLayers.Event.observe(this.observeElement,this.KEY_EVENTS[i],this.eventListener);return!0}return!1},deactivate:function(){var deactivated=!1,i,len;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(i=0,len=this.KEY_EVENTS.length;i<len;i++)OpenLayers.Event.stopObserving(this.observeElement,this.KEY_EVENTS[i],this.eventListener);deactivated=!0}return deactivated},handleKeyEvent:function(evt){this.checkModifiers(evt)&&this.callback(evt.type,[evt])},CLASS_NAME:"OpenLayers.Handler.Keyboard"});OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{documentDrag:!1,geometryTypes:null,clickout:!0,toggle:!0,standalone:!1,layer:null,feature:null,vertices:null,virtualVertices:null,selectControl:null,dragControl:null,handlers:null,deleteCodes:null,virtualStyle:null,vertexRenderIntent:null,mode:null,createVertices:!0,modified:!1,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(layer,options){var control,selectOptions,dragOptions,keyboardOptions;options=options||{};this.layer=layer;this.vertices=[];this.virtualVertices=[];this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer(null,options.vertexRenderIntent));this.virtualStyle.fillOpacity=.3;this.virtualStyle.strokeOpacity=.3;this.deleteCodes=[46,68];this.mode=OpenLayers.Control.ModifyFeature.RESHAPE;OpenLayers.Control.prototype.initialize.apply(this,[options]);OpenLayers.Util.isArray(this.deleteCodes)||(this.deleteCodes=[this.deleteCodes]);control=this;selectOptions={geometryTypes:this.geometryTypes,clickout:this.clickout,toggle:this.toggle,onBeforeSelect:this.beforeSelectFeature,onSelect:this.selectFeature,onUnselect:this.unselectFeature,scope:this};this.standalone===!1&&(this.selectControl=new OpenLayers.Control.SelectFeature(layer,selectOptions));dragOptions={documentDrag:this.documentDrag,geometryTypes:["OpenLayers.Geometry.Point"],onStart:function(feature,pixel){control.dragStart.apply(control,[feature,pixel])},onDrag:function(feature,pixel){control.dragVertex.apply(control,[feature,pixel])},onComplete:function(feature){control.dragComplete.apply(control,[feature])},featureCallbacks:{over:function(feature){(control.standalone!==!0||feature._sketch||control.feature===feature)&&control.dragControl.overFeature.apply(control.dragControl,[feature])}}};this.dragControl=new OpenLayers.Control.DragFeature(layer,dragOptions);keyboardOptions={keydown:this.handleKeypress};this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,keyboardOptions)}},destroy:function(){this.layer=null;this.standalone||this.selectControl.destroy();this.dragControl.destroy();OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return(this.standalone||this.selectControl.activate())&&this.handlers.keyboard.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){var deactivated=!1,feature,valid;return OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.layer.removeFeatures(this.vertices,{silent:!0}),this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.vertices=[],this.dragControl.deactivate(),feature=this.feature,valid=feature&&feature.geometry&&feature.layer,this.standalone===!1?(valid&&this.selectControl.unselect.apply(this.selectControl,[feature]),this.selectControl.deactivate()):valid&&this.unselectFeature(feature),this.handlers.keyboard.deactivate(),deactivated=!0),deactivated},beforeSelectFeature:function(feature){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:feature})},selectFeature:function(feature){if(!this.standalone||this.beforeSelectFeature(feature)!==!1){this.feature=feature;this.modified=!1;this.resetVertices();this.dragControl.activate();this.onModificationStart(this.feature)}var modified=feature.modified;!feature.geometry||modified&&modified.geometry||(this._originalGeometry=feature.geometry.clone())},unselectFeature:function(feature){this.layer.removeFeatures(this.vertices,{silent:!0});this.vertices=[];this.layer.destroyFeatures(this.virtualVertices,{silent:!0});this.virtualVertices=[];this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),delete this.dragHandle);this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),delete this.radiusHandle);this.feature=null;this.dragControl.deactivate();this.onModificationEnd(feature);this.layer.events.triggerEvent("afterfeaturemodified",{feature:feature,modified:this.modified});this.modified=!1},dragStart:function(feature,pixel){feature==this.feature||feature.geometry.parent||feature==this.dragHandle||feature==this.radiusHandle||(this.standalone===!1&&this.feature&&this.selectControl.clickFeature.apply(this.selectControl,[this.feature]),(this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,feature.geometry.CLASS_NAME)!=-1)&&(this.standalone||this.selectControl.clickFeature.apply(this.selectControl,[feature]),this.dragControl.overFeature.apply(this.dragControl,[feature]),this.dragControl.lastPixel=pixel,this.dragControl.handlers.drag.started=!0,this.dragControl.handlers.drag.start=pixel,this.dragControl.handlers.drag.last=pixel))},dragVertex:function(vertex,pixel){this.modified=!0;this.feature.geometry.CLASS_NAME=="OpenLayers.Geometry.Point"?(this.feature!=vertex&&(this.feature=vertex),this.layer.events.triggerEvent("vertexmodified",{vertex:vertex.geometry,feature:this.feature,pixel:pixel})):(vertex._index?(vertex.geometry.parent.addComponent(vertex.geometry,vertex._index),delete vertex._index,OpenLayers.Util.removeItem(this.virtualVertices,vertex),this.vertices.push(vertex)):vertex==this.dragHandle?(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null)):vertex!==this.radiusHandle&&this.layer.events.triggerEvent("vertexmodified",{vertex:vertex.geometry,feature:this.feature,pixel:pixel}),this.virtualVertices.length>0&&(this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.layer.drawFeature(this.feature,this.standalone?undefined:this.selectControl.renderIntent));this.layer.drawFeature(vertex)},dragComplete:function(){this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=OpenLayers.State.INSERT&&this.feature.state!=OpenLayers.State.DELETE&&(this.feature.state=OpenLayers.State.UPDATE,this.modified&&this._originalGeometry)){var feature=this.feature;feature.modified=OpenLayers.Util.extend(feature.modified,{geometry:this._originalGeometry});delete this._originalGeometry}},resetVertices:function(){this.dragControl.feature&&this.dragControl.outFeature(this.dragControl.feature);this.vertices.length>0&&(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[]);this.virtualVertices.length>0&&(this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]);this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),this.dragHandle=null);this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null);this.feature&&this.feature.geometry.CLASS_NAME!="OpenLayers.Geometry.Point"&&(this.mode&OpenLayers.Control.ModifyFeature.DRAG&&this.collectDragHandle(),this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE)&&this.collectRadiusHandle(),this.mode&OpenLayers.Control.ModifyFeature.RESHAPE&&(this.mode&OpenLayers.Control.ModifyFeature.RESIZE||this.collectVertices()))},handleKeypress:function(evt){var code=evt.keyCode,vertex;if(this.feature&&OpenLayers.Util.indexOf(this.deleteCodes,code)!=-1&&(vertex=this.dragControl.feature,vertex&&OpenLayers.Util.indexOf(this.vertices,vertex)!=-1&&!this.dragControl.handlers.drag.dragging&&vertex.geometry.parent)){vertex.geometry.parent.removeComponent(vertex.geometry);this.layer.events.triggerEvent("vertexremoved",{vertex:vertex.geometry,feature:this.feature,pixel:evt.xy});this.layer.drawFeature(this.feature,this.standalone?undefined:this.selectControl.renderIntent);this.modified=!0;this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",{feature:this.feature})}},collectVertices:function(){function collectComponentVertices(geometry){var i,vertex,component,len,numVert,prevVertex,nextVertex;if(geometry.CLASS_NAME=="OpenLayers.Geometry.Point")vertex=new OpenLayers.Feature.Vector(geometry),vertex._sketch=!0,vertex.renderIntent=control.vertexRenderIntent,control.vertices.push(vertex);else{for(numVert=geometry.components.length,geometry.CLASS_NAME=="OpenLayers.Geometry.LinearRing"&&(numVert-=1),i=0;i<numVert;++i)component=geometry.components[i],component.CLASS_NAME=="OpenLayers.Geometry.Point"?(vertex=new OpenLayers.Feature.Vector(component),vertex._sketch=!0,vertex.renderIntent=control.vertexRenderIntent,control.vertices.push(vertex)):collectComponentVertices(component);if(control.createVertices&&geometry.CLASS_NAME!="OpenLayers.Geometry.MultiPoint")for(i=0,len=geometry.components.length;i<len-1;++i)if(prevVertex=geometry.components[i],nextVertex=geometry.components[i+1],prevVertex.CLASS_NAME=="OpenLayers.Geometry.Point"&&nextVertex.CLASS_NAME=="OpenLayers.Geometry.Point"){var x=(prevVertex.x+nextVertex.x)/2,y=(prevVertex.y+nextVertex.y)/2,point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(x,y),null,control.virtualStyle);point.geometry.parent=geometry;point._index=i+1;point._sketch=!0;control.virtualVertices.push(point)}}}this.vertices=[];this.virtualVertices=[];var control=this;collectComponentVertices.call(this,this.feature.geometry);this.layer.addFeatures(this.virtualVertices,{silent:!0});this.layer.addFeatures(this.vertices,{silent:!0})},collectDragHandle:function(){var geometry=this.feature.geometry,center=geometry.getBounds().getCenterLonLat(),originGeometry=new OpenLayers.Geometry.Point(center.lon,center.lat),origin=new OpenLayers.Feature.Vector(originGeometry);originGeometry.move=function(x,y){OpenLayers.Geometry.Point.prototype.move.call(this,x,y);geometry.move(x,y)};origin._sketch=!0;this.dragHandle=origin;this.dragHandle.renderIntent=this.vertexRenderIntent;this.layer.addFeatures([this.dragHandle],{silent:!0})},collectRadiusHandle:function(){var geometry=this.feature.geometry,bounds=geometry.getBounds(),center=bounds.getCenterLonLat(),originGeometry=new OpenLayers.Geometry.Point(center.lon,center.lat),radiusGeometry=new OpenLayers.Geometry.Point(bounds.right,bounds.bottom),radius=new OpenLayers.Feature.Vector(radiusGeometry),resize=this.mode&OpenLayers.Control.ModifyFeature.RESIZE,reshape=this.mode&OpenLayers.Control.ModifyFeature.RESHAPE,rotate=this.mode&OpenLayers.Control.ModifyFeature.ROTATE;radiusGeometry.move=function(x,y){var scale,ratio,l0,l1;OpenLayers.Geometry.Point.prototype.move.call(this,x,y);var dx1=this.x-originGeometry.x,dy1=this.y-originGeometry.y,dx0=dx1-x,dy0=dy1-y;if(rotate){var a0=Math.atan2(dy0,dx0),a1=Math.atan2(dy1,dx1),angle=a1-a0;angle*=180/Math.PI;geometry.rotate(angle,originGeometry)}resize&&(reshape?(scale=dy1/dy0,ratio=dx1/dx0/scale):(l0=Math.sqrt(dx0*dx0+dy0*dy0),l1=Math.sqrt(dx1*dx1+dy1*dy1),scale=l1/l0),geometry.resize(scale,originGeometry,ratio))};radius._sketch=!0;this.radiusHandle=radius;this.radiusHandle.renderIntent=this.vertexRenderIntent;this.layer.addFeatures([this.radiusHandle],{silent:!0})},setMap:function(map){this.standalone||this.selectControl.setMap(map);this.dragControl.setMap(map);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.ModifyFeature"});OpenLayers.Control.ModifyFeature.RESHAPE=1;OpenLayers.Control.ModifyFeature.RESIZE=2;OpenLayers.Control.ModifyFeature.ROTATE=4;OpenLayers.Control.ModifyFeature.DRAG=8;OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,sphericalMercator:!1,zoomOffset:0,serverResolutions:null,initialize:function(name,url,options){(options&&options.sphericalMercator||this.sphericalMercator)&&(options=OpenLayers.Util.extend({projection:"EPSG:900913",numZoomLevels:19},options));OpenLayers.Layer.Grid.prototype.initialize.apply(this,[name||this.name,url||this.url,{},options])},clone:function(obj){return obj==null&&(obj=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions())),OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj])},getURL:function(bounds){var xyz=this.getXYZ(bounds),url=this.url,s;return OpenLayers.Util.isArray(url)&&(s=""+xyz.x+xyz.y+xyz.z,url=this.selectUrl(s,url)),OpenLayers.String.format(url,xyz)},getXYZ:function(bounds){var res=this.getServerResolution(),x=Math.round((bounds.left-this.maxExtent.left)/(res*this.tileSize.w)),y=Math.round((this.maxExtent.top-bounds.top)/(res*this.tileSize.h)),z=this.getServerZoom(),limit;return this.wrapDateLine&&(limit=Math.pow(2,z),x=(x%limit+limit)%limit),{x:x,y:y,z:z}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.XYZ"});OpenLayers.Layer.Bing=OpenLayers.Class(OpenLayers.Layer.XYZ,{key:null,serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.9396191406249,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.49622619628906,305.74811309814453,152.87405654907226,76.437028274536132,38.218514137268066,19.109257068634033,9.5546285343170165,4.7773142671585083,2.3886571335792541,1.1943285667896271,.59716428339481353,.29858214169740677,.14929107084870338,.074645535424351692],attributionTemplate:'<span class="olBingAttribution ${type}"><div><a target="_blank" href="http://www.bing.com/maps/"><img src="${logo}" /><\/a><\/div>${copyrights}<a style="white-space: nowrap" target="_blank" href="http://www.microsoft.com/maps/product/terms.html">Terms of Use<\/a><\/span>',metadata:null,type:"Road",culture:"en-US",metadataParams:null,tileOptions:null,initialize:function(options){options=OpenLayers.Util.applyDefaults({sphericalMercator:!0},options);var name=options.name||"Bing "+(options.type||this.type),newArgs=[name,null,options];OpenLayers.Layer.XYZ.prototype.initialize.apply(this,newArgs);this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options.tileOptions);this.loadMetadata()},loadMetadata:function(){this._callbackId="_callback_"+this.id.replace(/\./g,"_");window[this._callbackId]=OpenLayers.Function.bind(OpenLayers.Layer.Bing.processMetadata,this);var params=OpenLayers.Util.applyDefaults({key:this.key,jsonp:this._callbackId,include:"ImageryProviders"},this.metadataParams),url="//dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.type+"?"+OpenLayers.Util.getParameterString(params),script=document.createElement("script");script.type="text/javascript";script.src=url;script.id=this._callbackId;document.getElementsByTagName("head")[0].appendChild(script)},initLayer:function(){var res=this.metadata.resourceSets[0].resources[0],url=res.imageUrl.replace("{quadkey}","${quadkey}"),i;for(url=url.replace("{culture}",this.culture),this.url=[],i=0;i<res.imageUrlSubdomains.length;++i)this.url.push(url.replace("{subdomain}",res.imageUrlSubdomains[i]));this.addOptions({maxResolution:Math.min(this.serverResolutions[res.zoomMin],this.maxResolution||Number.POSITIVE_INFINITY),numZoomLevels:Math.min(res.zoomMax+1-res.zoomMin,this.numZoomLevels)},!0);this.updateAttribution()},drawTileFromQueue:function(){this.url&&OpenLayers.Layer.XYZ.prototype.drawTileFromQueue.apply(this,arguments)},getURL:function(bounds){for(var digit,mask,quadKey,url,xyz=this.getXYZ(bounds),x=xyz.x,y=xyz.y,z=xyz.z,quadDigits=[],i=z;i>0;--i)digit="0",mask=1<<i-1,(x&mask)!=0&&digit++,(y&mask)!=0&&(digit++,digit++),quadDigits.push(digit);return quadKey=quadDigits.join(""),url=this.selectUrl(""+x+y+z,this.url),OpenLayers.String.format(url,{quadkey:quadKey})},updateAttribution:function(){var metadata=this.metadata;if(metadata.resourceSets&&this.map&&this.map.center){for(var res=metadata.resourceSets[0].resources[0],extent=this.map.getExtent().transform(this.map.getProjectionObject(),new OpenLayers.Projection("EPSG:4326")),providers=res.imageryProviders,zoom=OpenLayers.Util.indexOf(this.serverResolutions,this.getServerResolution()),copyrights="",provider,j,jj,bbox,coverage,i=0,ii=providers.length;i<ii;++i)for(provider=providers[i],j=0,jj=provider.coverageAreas.length;j<jj;++j)coverage=provider.coverageAreas[j],bbox=OpenLayers.Bounds.fromArray(coverage.bbox,!0),extent.intersectsBounds(bbox)&&zoom<=coverage.zoomMax&&zoom>=coverage.zoomMin&&(copyrights+=provider.attribution+" ");this.attribution=OpenLayers.String.format(this.attributionTemplate,{type:this.type.toLowerCase(),logo:metadata.brandLogoUri,copyrights:copyrights});this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"attribution"})}},setMap:function(){OpenLayers.Layer.XYZ.prototype.setMap.apply(this,arguments);this.map.events.register("moveend",this,this.updateAttribution)},clone:function(obj){return obj==null&&(obj=new OpenLayers.Layer.Bing(this.options)),OpenLayers.Layer.XYZ.prototype.clone.apply(this,[obj])},destroy:function(){this.map&&this.map.events.unregister("moveend",this,this.updateAttribution);OpenLayers.Layer.XYZ.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.Bing"});OpenLayers.Layer.Bing.processMetadata=function(metadata){this.metadata=metadata;this.initLayer();var script=document.getElementById(this._callbackId);script.parentNode.removeChild(script);window[this._callbackId]=undefined;delete this._callbackId};OpenLayers.Format.SOSGetFeatureOfInterest=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",sa:"http://www.opengis.net/sampling/1.0",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosAll.xsd",defaultPrefix:"sos",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(data){var info,features,i,len,container,feature;for(typeof data=="string"&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data])),data&&data.nodeType==9&&(data=data.documentElement),info={features:[]},this.readNode(data,info),features=[],i=0,len=info.features.length;i<len;i++)container=info.features[i],this.internalProjection&&this.externalProjection&&container.components[0]&&container.components[0].transform(this.externalProjection,this.internalProjection),feature=new OpenLayers.Feature.Vector(container.components[0],container.attributes),features.push(feature);return features},readers:{sa:{SamplingPoint:function(node,obj){if(!obj.attributes){var feature={attributes:{}};obj.features.push(feature);obj=feature}obj.attributes.id=this.getAttributeNS(node,this.namespaces.gml,"id");this.readChildNodes(node,obj)},position:function(node,obj){this.readChildNodes(node,obj)}},gml:OpenLayers.Util.applyDefaults({FeatureCollection:function(node,obj){this.readChildNodes(node,obj)},featureMember:function(node,obj){var feature={attributes:{}};obj.features.push(feature);this.readChildNodes(node,feature)},name:function(node,obj){obj.attributes.name=this.getChildValue(node)},pos:function(node,obj){this.externalProjection||(this.externalProjection=new OpenLayers.Projection(node.getAttribute("srsName")));OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[node,obj])}},OpenLayers.Format.GML.v3.prototype.readers.gml)},writers:{sos:{GetFeatureOfInterest:function(options){for(var node=this.createElementNSPlus("GetFeatureOfInterest",{attributes:{version:this.VERSION,service:"SOS","xsi:schemaLocation":this.schemaLocation}}),i=0,len=options.fois.length;i<len;i++)this.writeNode("FeatureOfInterestId",{foi:options.fois[i]},node);return node},FeatureOfInterestId:function(options){return this.createElementNSPlus("FeatureOfInterestId",{value:options.foi})}}},CLASS_NAME:"OpenLayers.Format.SOSGetFeatureOfInterest"});OpenLayers.Format.SOSGetObservation=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows",gml:"http://www.opengis.net/gml",sos:"http://www.opengis.net/sos/1.0",ogc:"http://www.opengis.net/ogc",om:"http://www.opengis.net/om/1.0",sa:"http://www.opengis.net/sampling/1.0",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosGetObservation.xsd",defaultPrefix:"sos",read:function(data){typeof data=="string"&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data]));data&&data.nodeType==9&&(data=data.documentElement);var info={measurements:[],observations:[]};return this.readNode(data,info),info},write:function(options){var node=this.writeNode("sos:GetObservation",options);return node.setAttribute("xmlns:om",this.namespaces.om),node.setAttribute("xmlns:ogc",this.namespaces.ogc),this.setAttributeNS(node,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[node])},readers:{om:{ObservationCollection:function(node,obj){obj.id=this.getAttributeNS(node,this.namespaces.gml,"id");this.readChildNodes(node,obj)},member:function(node,observationCollection){this.readChildNodes(node,observationCollection)},Measurement:function(node,observationCollection){var measurement={};observationCollection.measurements.push(measurement);this.readChildNodes(node,measurement)},Observation:function(node,observationCollection){var observation={};observationCollection.observations.push(observation);this.readChildNodes(node,observation)},samplingTime:function(node,measurement){var samplingTime={};measurement.samplingTime=samplingTime;this.readChildNodes(node,samplingTime)},observedProperty:function(node,measurement){measurement.observedProperty=this.getAttributeNS(node,this.namespaces.xlink,"href");this.readChildNodes(node,measurement)},procedure:function(node,measurement){measurement.procedure=this.getAttributeNS(node,this.namespaces.xlink,"href");this.readChildNodes(node,measurement)},featureOfInterest:function(node,observation){var foi={features:[]},features,i,len,feature;for(observation.fois=[],observation.fois.push(foi),this.readChildNodes(node,foi),features=[],i=0,len=foi.features.length;i<len;i++)feature=foi.features[i],features.push(new OpenLayers.Feature.Vector(feature.components[0],feature.attributes));foi.features=features},result:function(node,measurement){var result={};measurement.result=result;this.getChildValue(node)!==""?(result.value=this.getChildValue(node),result.uom=node.getAttribute("uom")):this.readChildNodes(node,result)}},sa:OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.sa,gml:OpenLayers.Util.applyDefaults({TimeInstant:function(node,samplingTime){var timeInstant={};samplingTime.timeInstant=timeInstant;this.readChildNodes(node,timeInstant)},timePosition:function(node,timeInstant){timeInstant.timePosition=this.getChildValue(node)}},OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.gml)},writers:{sos:{GetObservation:function(options){var node=this.createElementNSPlus("GetObservation",{attributes:{version:this.VERSION,service:"SOS"}}),procedure,observedProperty;this.writeNode("offering",options,node);options.eventTime&&this.writeNode("eventTime",options,node);for(procedure in options.procedures)this.writeNode("procedure",options.procedures[procedure],node);for(observedProperty in options.observedProperties)this.writeNode("observedProperty",options.observedProperties[observedProperty],node);return options.foi&&this.writeNode("featureOfInterest",options.foi,node),this.writeNode("responseFormat",options,node),options.resultModel&&this.writeNode("resultModel",options,node),options.responseMode&&this.writeNode("responseMode",options,node),node},featureOfInterest:function(foi){var node=this.createElementNSPlus("featureOfInterest");return this.writeNode("ObjectID",foi.objectId,node),node},ObjectID:function(options){return this.createElementNSPlus("ObjectID",{value:options})},responseFormat:function(options){return this.createElementNSPlus("responseFormat",{value:options.responseFormat})},procedure:function(procedure){return this.createElementNSPlus("procedure",{value:procedure})},offering:function(options){return this.createElementNSPlus("offering",{value:options.offering})},observedProperty:function(observedProperty){return this.createElementNSPlus("observedProperty",{value:observedProperty})},eventTime:function(options){var node=this.createElementNSPlus("eventTime");return options.eventTime==="latest"&&this.writeNode("ogc:TM_Equals",options,node),node},resultModel:function(options){return this.createElementNSPlus("resultModel",{value:options.resultModel})},responseMode:function(options){return this.createElementNSPlus("responseMode",{value:options.responseMode})}},ogc:{TM_Equals:function(options){var node=this.createElementNSPlus("ogc:TM_Equals");return this.writeNode("ogc:PropertyName",{property:"urn:ogc:data:time:iso8601"},node),options.eventTime==="latest"&&this.writeNode("gml:TimeInstant",{value:"latest"},node),node},PropertyName:function(options){return this.createElementNSPlus("ogc:PropertyName",{value:options.property})}},gml:{TimeInstant:function(options){var node=this.createElementNSPlus("gml:TimeInstant");return this.writeNode("gml:timePosition",options,node),node},timePosition:function(options){return this.createElementNSPlus("gml:timePosition",{value:options.value})}}},CLASS_NAME:"OpenLayers.Format.SOSGetObservation"});OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,interval:0,delta:0,cumulative:!0,initialize:function(){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);this.wheelListener=null},onWheelEvent:function(e){var overflow,style,i,len,layer,delta;if(this.map&&this.checkModifiers(e)){for(var overScrollableDiv=!1,allowScroll=!1,overMapDiv=!1,elem=OpenLayers.Event.element(e);elem!=null&&!overMapDiv&&!overScrollableDiv;){if(!overScrollableDiv)try{elem.currentStyle?overflow=elem.currentStyle.overflow:(style=document.defaultView.getComputedStyle(elem,null),overflow=style.getPropertyValue("overflow"));overScrollableDiv=overflow&&overflow=="auto"||overflow=="scroll"}catch(err){}if(!allowScroll&&(allowScroll=OpenLayers.Element.hasClass(elem,"olScrollable"),!allowScroll))for(i=0,len=this.map.layers.length;i<len;i++)if(layer=this.map.layers[i],elem==layer.div||elem==layer.pane){allowScroll=!0;break}overMapDiv=elem==this.map.div;elem=elem.parentNode}!overScrollableDiv&&overMapDiv&&(allowScroll&&(delta=0,e||(e=window.event),e.wheelDelta?(delta=e.wheelDelta,delta%160==0&&(delta=delta*.75),delta=delta/120):e.detail&&(delta=-(e.detail/Math.abs(e.detail))),this.delta=this.delta+delta,this.interval?(window.clearTimeout(this._timeoutId),this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(e)},this),this.interval)):this.wheelZoom(e)),OpenLayers.Event.stop(e))}},wheelZoom:function(e){var delta=this.delta;this.delta=0;delta&&(e.xy=this.map.events.getMousePosition(e),delta<0?this.callback("down",[e,this.cumulative?delta:-1]):this.callback("up",[e,this.cumulative?delta:1]))},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var wheelListener=this.wheelListener;return OpenLayers.Event.observe(window,"DOMMouseScroll",wheelListener),OpenLayers.Event.observe(window,"mousewheel",wheelListener),OpenLayers.Event.observe(document,"mousewheel",wheelListener),!0}return!1},deactivate:function(){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var wheelListener=this.wheelListener;return OpenLayers.Event.stopObserving(window,"DOMMouseScroll",wheelListener),OpenLayers.Event.stopObserving(window,"mousewheel",wheelListener),OpenLayers.Event.stopObserving(document,"mousewheel",wheelListener),!0}return!1},CLASS_NAME:"OpenLayers.Handler.MouseWheel"});OpenLayers.Format.WFST.v1_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,OpenLayers.Format.WFST.v1,{version:"1.0.0",srsNameInQuery:!1,schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(options){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[options]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[options])},readNode:function(){return OpenLayers.Format.GML.v2.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({WFS_TransactionResponse:function(node,obj){obj.insertIds=[];obj.success=!1;this.readChildNodes(node,obj)},InsertResult:function(node,container){var obj={fids:[]};this.readChildNodes(node,obj);container.insertIds.push(obj.fids[0])},TransactionResult:function(node,obj){this.readChildNodes(node,obj)},Status:function(node,obj){this.readChildNodes(node,obj)},SUCCESS:function(node,obj){obj.success=!0}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.readers.ogc},writers:{wfs:OpenLayers.Util.applyDefaults({Query:function(options){var prefix,node,i,len;if(options=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery},options),prefix=options.featurePrefix,node=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(prefix?prefix+":":"")+options.featureType}}),options.srsNameInQuery&&options.srsName&&node.setAttribute("srsName",options.srsName),options.featureNS&&node.setAttribute("xmlns:"+prefix,options.featureNS),options.propertyNames)for(i=0,len=options.propertyNames.length;i<len;i++)this.writeNode("ogc:PropertyName",{property:options.propertyNames[i]},node);return options.filter&&(this.setFilterProperty(options.filter),this.writeNode("ogc:Filter",options.filter,node)),node}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_0_0"});OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(yOrdering){this.compare=yOrdering?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER;this.clear()},insert:function(newNode){var nodeId,leftIndex,rightIndex,middle,placement;for(this.exists(newNode)&&this.remove(newNode),nodeId=newNode.id,this.determineZIndex(newNode),leftIndex=-1,rightIndex=this.order.length;rightIndex-leftIndex>1;)middle=parseInt((leftIndex+rightIndex)/2),placement=this.compare(this,newNode,OpenLayers.Util.getElement(this.order[middle])),placement>0?leftIndex=middle:rightIndex=middle;return this.order.splice(rightIndex,0,nodeId),this.indices[nodeId]=this.getZIndex(newNode),this.getNextElement(rightIndex)},remove:function(node){var nodeId=node.id,arrayIndex=OpenLayers.Util.indexOf(this.order,nodeId),lastId;arrayIndex>=0&&(this.order.splice(arrayIndex,1),delete this.indices[nodeId],this.order.length>0?(lastId=this.order[this.order.length-1],this.maxZIndex=this.indices[lastId]):this.maxZIndex=0)},clear:function(){this.order=[];this.indices={};this.maxZIndex=0},exists:function(node){return this.indices[node.id]!=null},getZIndex:function(node){return node._style.graphicZIndex},determineZIndex:function(node){var zIndex=node._style.graphicZIndex;zIndex==null?(zIndex=this.maxZIndex,node._style.graphicZIndex=zIndex):zIndex>this.maxZIndex&&(this.maxZIndex=zIndex)},getNextElement:function(index){var nextIndex=index+1,nextElement;return nextIndex<this.order.length?(nextElement=OpenLayers.Util.getElement(this.order[nextIndex]),nextElement==undefined&&(nextElement=this.getNextElement(nextIndex)),nextElement):null},CLASS_NAME:"OpenLayers.ElementsIndexer"});OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(indexer,newNode,nextNode){var newZIndex=indexer.getZIndex(newNode),returnVal=0,nextZIndex;return nextNode&&(nextZIndex=indexer.getZIndex(nextNode),returnVal=newZIndex-nextZIndex),returnVal},Z_ORDER_DRAWING_ORDER:function(indexer,newNode,nextNode){var returnVal=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(indexer,newNode,nextNode);return nextNode&&returnVal==0&&(returnVal=1),returnVal},Z_ORDER_Y_ORDER:function(indexer,newNode,nextNode){var returnVal=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(indexer,newNode,nextNode),result;return nextNode&&returnVal===0&&(result=nextNode._boundsBottom-newNode._boundsBottom,returnVal=result===0?1:result),returnVal}};OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(containerID,options){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.rendererRoot=this.createRenderRoot();this.root=this.createRoot("_root");this.vectorRoot=this.createRoot("_vroot");this.textRoot=this.createRoot("_troot");this.root.appendChild(this.vectorRoot);this.root.appendChild(this.textRoot);this.rendererRoot.appendChild(this.root);this.container.appendChild(this.rendererRoot);options&&(options.zIndexing||options.yOrdering)&&(this.indexer=new OpenLayers.ElementsIndexer(options.yOrdering))},destroy:function(){this.clear();this.rendererRoot=null;this.root=null;this.xmlns=null;OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var child,root=this.vectorRoot;if(root)while(child=root.firstChild)root.removeChild(child);if(root=this.textRoot,root)while(child=root.firstChild)root.removeChild(child);this.indexer&&this.indexer.clear()},setExtent:function(extent,resolutionChanged){var coordSysUnchanged=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),resolution=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var rightOfDateLine,ratio=extent.getWidth()/this.map.getExtent().getWidth(),extent=extent.scale(1/ratio),world=this.map.getMaxExtent();world.right>extent.left&&world.right<extent.right?rightOfDateLine=!0:world.left>extent.left&&world.left<extent.right&&(rightOfDateLine=!1);(rightOfDateLine!==this.rightOfDateLine||resolutionChanged)&&(coordSysUnchanged=!1,this.xOffset=rightOfDateLine===!0?world.getWidth()/resolution:0);this.rightOfDateLine=rightOfDateLine}return coordSysUnchanged},getNodeType:function(){},drawGeometry:function(geometry,style,featureId){var className=geometry.CLASS_NAME,rendered=!0,i,len,removeBackground,node;if(className=="OpenLayers.Geometry.Collection"||className=="OpenLayers.Geometry.MultiPoint"||className=="OpenLayers.Geometry.MultiLineString"||className=="OpenLayers.Geometry.MultiPolygon"){for(i=0,len=geometry.components.length;i<len;i++)rendered=this.drawGeometry(geometry.components[i],style,featureId)&&rendered;return rendered}return rendered=!1,removeBackground=!1,style.display!="none"&&(style.backgroundGraphic?this.redrawBackgroundNode(geometry.id,geometry,style,featureId):removeBackground=!0,rendered=this.redrawNode(geometry.id,geometry,style,featureId)),rendered==!1&&(node=document.getElementById(geometry.id),node&&(node._style.backgroundGraphic&&(removeBackground=!0),node.parentNode.removeChild(node))),removeBackground&&(node=document.getElementById(geometry.id+this.BACKGROUND_ID_SUFFIX),node&&node.parentNode.removeChild(node)),rendered},redrawNode:function(id,geometry,style,featureId){var node,drawResult,insert;return(style=this.applyDefaultSymbolizer(style),node=this.nodeFactory(id,this.getNodeType(geometry,style)),node._featureId=featureId,node._boundsBottom=geometry.getBounds().bottom,node._geometryClass=geometry.CLASS_NAME,node._style=style,drawResult=this.drawGeometryNode(node,geometry,style),drawResult===!1)?!1:(node=drawResult.node,this.indexer?(insert=this.indexer.insert(node),insert?this.vectorRoot.insertBefore(node,insert):this.vectorRoot.appendChild(node)):node.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(node),this.postDraw(node),drawResult.complete)},redrawBackgroundNode:function(id,geometry,style){var backgroundStyle=OpenLayers.Util.extend({},style);return backgroundStyle.externalGraphic=backgroundStyle.backgroundGraphic,backgroundStyle.graphicXOffset=backgroundStyle.backgroundXOffset,backgroundStyle.graphicYOffset=backgroundStyle.backgroundYOffset,backgroundStyle.graphicZIndex=backgroundStyle.backgroundGraphicZIndex,backgroundStyle.graphicWidth=backgroundStyle.backgroundWidth||backgroundStyle.graphicWidth,backgroundStyle.graphicHeight=backgroundStyle.backgroundHeight||backgroundStyle.graphicHeight,backgroundStyle.backgroundGraphic=null,backgroundStyle.backgroundXOffset=null,backgroundStyle.backgroundYOffset=null,backgroundStyle.backgroundGraphicZIndex=null,this.redrawNode(id+this.BACKGROUND_ID_SUFFIX,geometry,backgroundStyle,null)},drawGeometryNode:function(node,geometry,style){style=style||node._style;var options={isFilled:style.fill===undefined?!0:style.fill,isStroked:style.stroke===undefined?!!style.strokeWidth:style.stroke},drawn;switch(geometry.CLASS_NAME){case"OpenLayers.Geometry.Point":style.graphic===!1&&(options.isFilled=!1,options.isStroked=!1);drawn=this.drawPoint(node,geometry);break;case"OpenLayers.Geometry.LineString":options.isFilled=!1;drawn=this.drawLineString(node,geometry);break;case"OpenLayers.Geometry.LinearRing":drawn=this.drawLinearRing(node,geometry);break;case"OpenLayers.Geometry.Polygon":drawn=this.drawPolygon(node,geometry);break;case"OpenLayers.Geometry.Rectangle":drawn=this.drawRectangle(node,geometry)}return node._options=options,drawn!=!1?{node:this.setStyle(node,style,options,geometry),complete:drawn}:!1},postDraw:function(){},drawPoint:function(){},drawLineString:function(){},drawLinearRing:function(){},drawPolygon:function(){},drawRectangle:function(){},drawCircle:function(){},removeText:function(featureId){var label=document.getElementById(featureId+this.LABEL_ID_SUFFIX),outline;label&&this.textRoot.removeChild(label);outline=document.getElementById(featureId+this.LABEL_OUTLINE_SUFFIX);outline&&this.textRoot.removeChild(outline)},getFeatureIdFromEvent:function(evt){var target=evt.target,useElement=target&&target.correspondingUseElement,node=useElement?useElement:target||evt.srcElement;return node._featureId},eraseGeometry:function(geometry,featureId){var i,len,element,backgroundId,bElem;if(geometry.CLASS_NAME=="OpenLayers.Geometry.MultiPoint"||geometry.CLASS_NAME=="OpenLayers.Geometry.MultiLineString"||geometry.CLASS_NAME=="OpenLayers.Geometry.MultiPolygon"||geometry.CLASS_NAME=="OpenLayers.Geometry.Collection")for(i=0,len=geometry.components.length;i<len;i++)this.eraseGeometry(geometry.components[i],featureId);else element=OpenLayers.Util.getElement(geometry.id),element&&element.parentNode&&(element.geometry&&(element.geometry.destroy(),element.geometry=null),element.parentNode.removeChild(element),this.indexer&&this.indexer.remove(element),element._style.backgroundGraphic&&(backgroundId=geometry.id+this.BACKGROUND_ID_SUFFIX,bElem=OpenLayers.Util.getElement(backgroundId),bElem&&bElem.parentNode&&bElem.parentNode.removeChild(bElem)))},nodeFactory:function(id,type){var node=OpenLayers.Util.getElement(id);return node?this.nodeTypeCompare(node,type)||(node.parentNode.removeChild(node),node=this.nodeFactory(id,type)):node=this.createNode(type,id),node},nodeTypeCompare:function(){},createNode:function(){},moveRoot:function(renderer){var root=this.root;renderer.root.parentNode==this.rendererRoot&&(root=renderer.root);root.parentNode.removeChild(root);renderer.rendererRoot.appendChild(root)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(graphicName){return graphicName!="circle"&&!!graphicName},CLASS_NAME:"OpenLayers.Renderer.Elements"});OpenLayers.Control.ArgParser=OpenLayers.Class(OpenLayers.Control,{center:null,zoom:null,layers:null,displayProjection:null,getParameters:function(url){url=url||window.location.href;var parameters=OpenLayers.Util.getParameters(url),index=url.indexOf("#");return index>0&&(url="?"+url.substring(index+1,url.length),OpenLayers.Util.extend(parameters,OpenLayers.Util.getParameters(url))),parameters},setMap:function(){var i,len,control,args;for(OpenLayers.Control.prototype.setMap.apply(this,arguments),i=0,len=this.map.controls.length;i<len;i++)if(control=this.map.controls[i],control!=this&&control.CLASS_NAME=="OpenLayers.Control.ArgParser"){control.displayProjection!=this.displayProjection&&(this.displayProjection=control.displayProjection);break}i==this.map.controls.length&&(args=this.getParameters(),args.layers&&(this.layers=args.layers,this.map.events.register("addlayer",this,this.configureLayers),this.configureLayers()),args.lat&&args.lon&&(this.center=new OpenLayers.LonLat(parseFloat(args.lon),parseFloat(args.lat)),args.zoom&&(this.zoom=parseFloat(args.zoom)),this.map.events.register("changebaselayer",this,this.setCenter),this.setCenter()))},setCenter:function(){this.map.baseLayer&&(this.map.events.unregister("changebaselayer",this,this.setCenter),this.displayProjection&&this.center.transform(this.displayProjection,this.map.getProjectionObject()),this.map.setCenter(this.center,this.zoom))},configureLayers:function(){var i,len,layer,c;if(this.layers.length==this.map.layers.length)for(this.map.events.unregister("addlayer",this,this.configureLayers),i=0,len=this.layers.length;i<len;i++)layer=this.map.layers[i],c=this.layers.charAt(i),c=="B"?this.map.setBaseLayer(layer):(c=="T"||c=="F")&&layer.setVisibility(c=="T")},CLASS_NAME:"OpenLayers.Control.ArgParser"});OpenLayers.Control.Permalink=OpenLayers.Class(OpenLayers.Control,{argParserClass:OpenLayers.Control.ArgParser,element:null,anchor:!1,base:"",displayProjection:null,initialize:function(element,base,options){element===null||typeof element!="object"||OpenLayers.Util.isElement(element)?(OpenLayers.Control.prototype.initialize.apply(this,[options]),this.element=OpenLayers.Util.getElement(element),this.base=base||document.location.href):(options=element,this.base=document.location.href,OpenLayers.Control.prototype.initialize.apply(this,[options]),this.element!=null&&(this.element=OpenLayers.Util.getElement(this.element)))},destroy:function(){this.element&&this.element.parentNode==this.div&&(this.div.removeChild(this.element),this.element=null);this.map&&this.map.events.unregister("moveend",this,this.updateLink);OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(){var i,len,control;for(OpenLayers.Control.prototype.setMap.apply(this,arguments),i=0,len=this.map.controls.length;i<len;i++)if(control=this.map.controls[i],control.CLASS_NAME==this.argParserClass.CLASS_NAME){control.displayProjection!=this.displayProjection&&(this.displayProjection=control.displayProjection);break}i==this.map.controls.length&&this.map.addControl(new this.argParserClass({displayProjection:this.displayProjection}))},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.element||this.anchor||(this.element=document.createElement("a"),this.element.innerHTML=OpenLayers.i18n("Permalink"),this.element.href="",this.div.appendChild(this.element));this.map.events.on({moveend:this.updateLink,changelayer:this.updateLink,changebaselayer:this.updateLink,scope:this});return this.updateLink(),this.div},updateLink:function(){var separator=this.anchor?"#":"?",href=this.base,anchor=null,splits;href.indexOf("#")!=-1&&this.anchor==!1&&(anchor=href.substring(href.indexOf("#"),href.length));href.indexOf(separator)!=-1&&(href=href.substring(0,href.indexOf(separator)));splits=href.split("#");href=splits[0]+separator+OpenLayers.Util.getParameterString(this.createParams());anchor&&(href+=anchor);this.anchor&&!this.element?window.location.href=href:this.element.href=href},createParams:function(center,zoom,layers){var params,lat,lon,mapPosition,i,len,layer;if(center=center||this.map.getCenter(),params=OpenLayers.Util.getParameters(this.base),center)for(params.zoom=zoom||this.map.getZoom(),lat=center.lat,lon=center.lon,this.displayProjection&&(mapPosition=OpenLayers.Projection.transform({x:lon,y:lat},this.map.getProjectionObject(),this.displayProjection),lon=mapPosition.x,lat=mapPosition.y),params.lat=Math.round(lat*1e5)/1e5,params.lon=Math.round(lon*1e5)/1e5,layers=layers||this.map.layers,params.layers="",i=0,len=layers.length;i<len;i++)layer=layers[i],params.layers+=layer.isBaseLayer?layer==this.map.baseLayer?"B":"0":layer.getVisibility()?"T":"F";return params},CLASS_NAME:"OpenLayers.Control.Permalink"});OpenLayers.Layer.TMS=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:"1.0.0",layername:null,type:null,isBaseLayer:!0,tileOrigin:null,serverResolutions:null,zoomOffset:0,initialize:function(name,url,options){var newArguments=[];newArguments.push(name,url,{},options);OpenLayers.Layer.Grid.prototype.initialize.apply(this,newArguments)},clone:function(obj){return obj==null&&(obj=new OpenLayers.Layer.TMS(this.name,this.url,this.getOptions())),OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj])},getURL:function(bounds){bounds=this.adjustBounds(bounds);var res=this.getServerResolution(),x=Math.round((bounds.left-this.tileOrigin.lon)/(res*this.tileSize.w)),y=Math.round((bounds.bottom-this.tileOrigin.lat)/(res*this.tileSize.h)),z=this.getServerZoom(),path=this.serviceVersion+"/"+this.layername+"/"+z+"/"+x+"/"+y+"."+this.type,url=this.url;return OpenLayers.Util.isArray(url)&&(url=this.selectUrl(path,url)),url+path},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.TMS"});OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:!1,activate:function(){if(OpenLayers.Strategy.prototype.activate.apply(this,arguments)){this.layer.events.on({refresh:this.load,scope:this});if(this.layer.visibility==!0||this.preload)this.load();else this.layer.events.on({visibilitychanged:this.load,scope:this});return!0}return!1},deactivate:function(){var deactivated=OpenLayers.Strategy.prototype.deactivate.call(this);return deactivated&&this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this}),deactivated},load:function(options){var layer=this.layer;layer.events.triggerEvent("loadstart");layer.protocol.read(OpenLayers.Util.applyDefaults({callback:OpenLayers.Function.bind(this.merge,this,layer.map.getProjectionObject()),filter:layer.filter},options));layer.events.un({visibilitychanged:this.load,scope:this})},merge:function(mapProjection,resp){var layer=this.layer,features,geom,i,len;if(layer.destroyFeatures(),features=resp.features,features&&features.length>0){if(!mapProjection.equals(layer.projection))for(i=0,len=features.length;i<len;++i)geom=features[i].geometry,geom&&geom.transform(layer.projection,mapProjection);layer.addFeatures(features)}layer.events.triggerEvent("loadend",{response:resp})},CLASS_NAME:"OpenLayers.Strategy.Fixed"});OpenLayers.Control.Zoom=OpenLayers.Class(OpenLayers.Control,{zoomInText:"+",zoomInId:"olZoomInLink",zoomOutText:"",zoomOutId:"olZoomOutLink",draw:function(){var div=OpenLayers.Control.prototype.draw.apply(this),links=this.getOrCreateLinks(div),zoomIn=links.zoomIn,zoomOut=links.zoomOut,eventsInstance=this.map.events;return zoomOut.parentNode!==div&&(eventsInstance=this.events,eventsInstance.attachToElement(zoomOut.parentNode)),eventsInstance.register("buttonclick",this,this.onZoomClick),this.zoomInLink=zoomIn,this.zoomOutLink=zoomOut,div},getOrCreateLinks:function(el){var zoomIn=document.getElementById(this.zoomInId),zoomOut=document.getElementById(this.zoomOutId);return zoomIn||(zoomIn=document.createElement("a"),zoomIn.href="#zoomIn",zoomIn.appendChild(document.createTextNode(this.zoomInText)),zoomIn.className="olControlZoomIn",el.appendChild(zoomIn)),OpenLayers.Element.addClass(zoomIn,"olButton"),zoomOut||(zoomOut=document.createElement("a"),zoomOut.href="#zoomOut",zoomOut.appendChild(document.createTextNode(this.zoomOutText)),zoomOut.className="olControlZoomOut",el.appendChild(zoomOut)),OpenLayers.Element.addClass(zoomOut,"olButton"),{zoomIn:zoomIn,zoomOut:zoomOut}},onZoomClick:function(evt){var button=evt.buttonElement;button===this.zoomInLink?this.map.zoomIn():button===this.zoomOutLink&&this.map.zoomOut()},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onZoomClick);delete this.zoomInLink;delete this.zoomOutLink;OpenLayers.Control.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Control.Zoom"});OpenLayers.Layer.PointTrack=OpenLayers.Class(OpenLayers.Layer.Vector,{dataFrom:null,styleFrom:null,addNodes:function(pointFeatures,options){var lines,pointFeature,startPoint,endPoint,i,len,lonlat;if(pointFeatures.length<2)throw new Error("At least two point features have to be added to create a line from");for(lines=new Array(pointFeatures.length-1),i=0,len=pointFeatures.length;i<len;i++){if(pointFeature=pointFeatures[i],endPoint=pointFeature.geometry,endPoint){if(endPoint.CLASS_NAME!="OpenLayers.Geometry.Point")throw new TypeError("Only features with point geometries are supported.");}else lonlat=pointFeature.lonlat,endPoint=new OpenLayers.Geometry.Point(lonlat.lon,lonlat.lat);if(i>0){var attributes=this.dataFrom!=null?pointFeatures[i+this.dataFrom].data||pointFeatures[i+this.dataFrom].attributes:null,style=this.styleFrom!=null?pointFeatures[i+this.styleFrom].style:null,line=new OpenLayers.Geometry.LineString([startPoint,endPoint]);lines[i-1]=new OpenLayers.Feature.Vector(line,attributes,style)}startPoint=endPoint}this.addFeatures(lines,options)},CLASS_NAME:"OpenLayers.Layer.PointTrack"});OpenLayers.Layer.PointTrack.SOURCE_NODE=-1;OpenLayers.Layer.PointTrack.TARGET_NODE=0;OpenLayers.Layer.PointTrack.dataFrom={SOURCE_NODE:-1,TARGET_NODE:0};OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:!0,defaultFilter:null,initialize:function(options){options=options||{};OpenLayers.Util.extend(this,options);this.options=options},mergeWithDefaultFilter:function(filter){return filter&&this.defaultFilter?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,filter]}):filter||this.defaultFilter||undefined},destroy:function(){this.options=null;this.format=null},read:function(options){options=options||{};options.filter=this.mergeWithDefaultFilter(options.filter)},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(){},createCallback:function(method,response,options){return OpenLayers.Function.bind(function(){method.apply(this,[response,options])},this)},CLASS_NAME:"OpenLayers.Protocol"});OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:!0,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(options){OpenLayers.Util.extend(this,options)},success:function(){return this.code>0},CLASS_NAME:"OpenLayers.Protocol.Response"});OpenLayers.Protocol.Response.SUCCESS=1;OpenLayers.Protocol.Response.FAILURE=0;OpenLayers.Protocol.WFS=function(options){options=OpenLayers.Util.applyDefaults(options,OpenLayers.Protocol.WFS.DEFAULTS);var cls=OpenLayers.Protocol.WFS["v"+options.version.replace(/\./g,"_")];if(!cls)throw"Unsupported WFS version: "+options.version;return new cls(options)};OpenLayers.Protocol.WFS.fromWMSLayer=function(layer,options){var typeName,featurePrefix,param=layer.params.LAYERS,parts=(OpenLayers.Util.isArray(param)?param[0]:param).split(":"),protocolOptions;return parts.length>1&&(featurePrefix=parts[0]),typeName=parts.pop(),protocolOptions={url:layer.url,featureType:typeName,featurePrefix:featurePrefix,srsName:layer.projection&&layer.projection.getCode()||layer.map&&layer.map.getProjectionObject().getCode(),version:"1.1.0"},new OpenLayers.Protocol.WFS(OpenLayers.Util.applyDefaults(options,protocolOptions))};OpenLayers.Protocol.WFS.DEFAULTS={version:"1.0.0"};OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,markers:null,drawn:!1,initialize:function(){OpenLayers.Layer.prototype.initialize.apply(this,arguments);this.markers=[]},destroy:function(){this.clearMarkers();this.markers=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(opacity){if(opacity!=this.opacity){this.opacity=opacity;for(var i=0,len=this.markers.length;i<len;i++)this.markers[i].setOpacity(this.opacity)}},moveTo:function(bounds,zoomChanged){if(OpenLayers.Layer.prototype.moveTo.apply(this,arguments),zoomChanged||!this.drawn){for(var i=0,len=this.markers.length;i<len;i++)this.drawMarker(this.markers[i]);this.drawn=!0}},addMarker:function(marker){this.markers.push(marker);this.opacity<1&&marker.setOpacity(this.opacity);this.map&&this.map.getExtent()&&(marker.map=this.map,this.drawMarker(marker))},removeMarker:function(marker){this.markers&&this.markers.length&&(OpenLayers.Util.removeItem(this.markers,marker),marker.erase())},clearMarkers:function(){if(this.markers!=null)while(this.markers.length>0)this.removeMarker(this.markers[0])},drawMarker:function(marker){var px=this.map.getLayerPxFromLonLat(marker.lonlat),markerImg;px==null?marker.display(!1):marker.isDrawn()?marker.icon&&marker.icon.moveTo(px):(markerImg=marker.draw(px),this.div.appendChild(markerImg))},getDataExtent:function(){var maxExtent=null,i,len,marker;if(this.markers&&this.markers.length>0)for(maxExtent=new OpenLayers.Bounds,i=0,len=this.markers.length;i<len;i++)marker=this.markers[i],maxExtent.extend(marker.lonlat);return maxExtent},CLASS_NAME:"OpenLayers.Layer.Markers"});OpenLayers.Control.Pan=OpenLayers.Class(OpenLayers.Control.Button,{slideFactor:50,slideRatio:null,direction:null,initialize:function(direction,options){this.direction=direction;this.CLASS_NAME+=this.direction;OpenLayers.Control.prototype.initialize.apply(this,[options])},trigger:function(){if(this.map){var getSlideFactor=OpenLayers.Function.bind(function(dim){return this.slideRatio?this.map.getSize()[dim]*this.slideRatio:this.slideFactor},this);switch(this.direction){case OpenLayers.Control.Pan.NORTH:this.map.pan(0,-getSlideFactor("h"));break;case OpenLayers.Control.Pan.SOUTH:this.map.pan(0,getSlideFactor("h"));break;case OpenLayers.Control.Pan.WEST:this.map.pan(-getSlideFactor("w"),0);break;case OpenLayers.Control.Pan.EAST:this.map.pan(getSlideFactor("w"),0)}}},CLASS_NAME:"OpenLayers.Control.Pan"});OpenLayers.Control.Pan.NORTH="North";OpenLayers.Control.Pan.SOUTH="South";OpenLayers.Control.Pan.EAST="East";OpenLayers.Control.Pan.WEST="West";OpenLayers.Format.CSWGetDomain=function(options){options=OpenLayers.Util.applyDefaults(options,OpenLayers.Format.CSWGetDomain.DEFAULTS);var cls=OpenLayers.Format.CSWGetDomain["v"+options.version.replace(/\./g,"_")];if(!cls)throw"Unsupported CSWGetDomain version: "+options.version;return new cls(options)};OpenLayers.Format.CSWGetDomain.DEFAULTS={version:"2.0.2"};OpenLayers.Format.CSWGetDomain.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw/2.0.2"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",PropertyName:null,ParameterName:null,read:function(data){typeof data=="string"&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data]));data&&data.nodeType==9&&(data=data.documentElement);var obj={};return this.readNode(data,obj),obj},readers:{csw:{GetDomainResponse:function(node,obj){this.readChildNodes(node,obj)},DomainValues:function(node,obj){var attrs,domainValue,i,len;for(OpenLayers.Util.isArray(obj.DomainValues)||(obj.DomainValues=[]),attrs=node.attributes,domainValue={},i=0,len=attrs.length;i<len;++i)domainValue[attrs[i].name]=attrs[i].nodeValue;this.readChildNodes(node,domainValue);obj.DomainValues.push(domainValue)},PropertyName:function(node,obj){obj.PropertyName=this.getChildValue(node)},ParameterName:function(node,obj){obj.ParameterName=this.getChildValue(node)},ListOfValues:function(node,obj){OpenLayers.Util.isArray(obj.ListOfValues)||(obj.ListOfValues=[]);this.readChildNodes(node,obj.ListOfValues)},Value:function(node,obj){for(var attrs=node.attributes,value={},i=0,len=attrs.length;i<len;++i)value[attrs[i].name]=attrs[i].nodeValue;value.value=this.getChildValue(node);obj.push({Value:value})},ConceptualScheme:function(node,obj){obj.ConceptualScheme={};this.readChildNodes(node,obj.ConceptualScheme)},Name:function(node,obj){obj.Name=this.getChildValue(node)},Document:function(node,obj){obj.Document=this.getChildValue(node)},Authority:function(node,obj){obj.Authority=this.getChildValue(node)},RangeOfValues:function(node,obj){obj.RangeOfValues={};this.readChildNodes(node,obj.RangeOfValues)},MinValue:function(node,obj){for(var attrs=node.attributes,value={},i=0,len=attrs.length;i<len;++i)value[attrs[i].name]=attrs[i].nodeValue;value.value=this.getChildValue(node);obj.MinValue=value},MaxValue:function(node,obj){for(var attrs=node.attributes,value={},i=0,len=attrs.length;i<len;++i)value[attrs[i].name]=attrs[i].nodeValue;value.value=this.getChildValue(node);obj.MaxValue=value}}},write:function(options){var node=this.writeNode("csw:GetDomain",options);return OpenLayers.Format.XML.prototype.write.apply(this,[node])},writers:{csw:{GetDomain:function(options){var node=this.createElementNSPlus("csw:GetDomain",{attributes:{service:"CSW",version:this.version}});return options.PropertyName||this.PropertyName?this.writeNode("csw:PropertyName",options.PropertyName||this.PropertyName,node):(options.ParameterName||this.ParameterName)&&this.writeNode("csw:ParameterName",options.ParameterName||this.ParameterName,node),this.readChildNodes(node,options),node},PropertyName:function(value){return this.createElementNSPlus("csw:PropertyName",{value:value})},ParameterName:function(value){return this.createElementNSPlus("csw:ParameterName",{value:value})}}},CLASS_NAME:"OpenLayers.Format.CSWGetDomain.v2_0_2"});OpenLayers.Format.ArcXML.Features=OpenLayers.Class(OpenLayers.Format.XML,{read:function(data){var axl=new OpenLayers.Format.ArcXML,parsed=axl.read(data);return parsed.features.feature}});OpenLayers.Control.Snapping=OpenLayers.Class(OpenLayers.Control,{DEFAULTS:{tolerance:10,node:!0,edge:!0,vertex:!0},greedy:!0,precedence:["node","vertex","edge"],resolution:null,geoToleranceCache:null,layer:null,feature:null,point:null,initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,[options]);this.options=options||{};this.options.layer&&this.setLayer(this.options.layer);var defaults=OpenLayers.Util.extend({},this.options.defaults);this.defaults=OpenLayers.Util.applyDefaults(defaults,this.DEFAULTS);this.setTargets(this.options.targets);this.targets.length===0&&this.layer&&this.addTargetLayer(this.layer);this.geoToleranceCache={}},setLayer:function(layer){this.active?(this.deactivate(),this.layer=layer,this.activate()):this.layer=layer},setTargets:function(targets){var target,i,len;if(this.targets=[],targets&&targets.length)for(i=0,len=targets.length;i<len;++i)target=targets[i],target instanceof OpenLayers.Layer.Vector?this.addTargetLayer(target):this.addTarget(target)},addTargetLayer:function(layer){this.addTarget({layer:layer})},addTarget:function(target){target=OpenLayers.Util.applyDefaults(target,this.defaults);target.nodeTolerance=target.nodeTolerance||target.tolerance;target.vertexTolerance=target.vertexTolerance||target.tolerance;target.edgeTolerance=target.edgeTolerance||target.tolerance;this.targets.push(target)},removeTargetLayer:function(layer){for(var target,i=this.targets.length-1;i>=0;--i)target=this.targets[i],target.layer===layer&&this.removeTarget(target)},removeTarget:function(target){return OpenLayers.Util.removeItem(this.targets,target)},activate:function(){var activated=OpenLayers.Control.prototype.activate.call(this);if(activated&&this.layer&&this.layer.events)this.layer.events.on({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this});return activated},deactivate:function(){var deactivated=OpenLayers.Control.prototype.deactivate.call(this);return deactivated&&this.layer&&this.layer.events&&this.layer.events.un({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this}),this.feature=null,this.point=null,deactivated},onSketchModified:function(event){this.feature=event.feature;this.considerSnapping(event.vertex,event.vertex)},onVertexModified:function(event){this.feature=event.feature;var loc=this.layer.map.getLonLatFromViewPortPx(event.pixel);this.considerSnapping(event.vertex,new OpenLayers.Geometry.Point(loc.lon,loc.lat))},considerSnapping:function(point,loc){for(var proceed,best={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY,x:null,y:null},snapped=!1,result,target,i=0,len=this.targets.length;i<len;++i)if(target=this.targets[i],result=this.testTarget(target,loc),result)if(this.greedy){best=result;best.target=target;snapped=!0;break}else(result.rank<best.rank||result.rank===best.rank&&result.dist<best.dist)&&(best=result,best.target=target,snapped=!0);snapped&&(proceed=this.events.triggerEvent("beforesnap",{point:point,x:best.x,y:best.y,distance:best.dist,layer:best.target.layer,snapType:this.precedence[best.rank]}),proceed!==!1?(point.x=best.x,point.y=best.y,this.point=point,this.events.triggerEvent("snap",{point:point,snapType:this.precedence[best.rank],layer:best.target.layer,distance:best.dist})):snapped=!1);this.point&&!snapped&&(point.x=loc.x,point.y=loc.y,this.point=null,this.events.triggerEvent("unsnap",{point:point}))},testTarget:function(target,loc){var resolution=this.layer.map.getResolution(),i,len,j,stop,k,klen;if("minResolution"in target&&resolution<target.minResolution||"maxResolution"in target&&resolution>=target.maxResolution)return null;var tolerance={node:this.getGeoTolerance(target.nodeTolerance,resolution),vertex:this.getGeoTolerance(target.vertexTolerance,resolution),edge:this.getGeoTolerance(target.edgeTolerance,resolution)},maxTolerance=Math.max(tolerance.node,tolerance.vertex,tolerance.edge),result={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY},eligible=!1,features=target.layer.features,feature,type,vertices,vertex,closest,dist,found,numTypes=this.precedence.length,ll=new OpenLayers.LonLat(loc.x,loc.y);for(i=0,len=features.length;i<len;++i)if(feature=features[i],feature!==this.feature&&!feature._sketch&&feature.state!==OpenLayers.State.DELETE&&(!target.filter||target.filter.evaluate(feature))&&feature.atPoint(ll,maxTolerance,maxTolerance))for(j=0,stop=Math.min(result.rank+1,numTypes);j<stop;++j)if(type=this.precedence[j],target[type])if(type==="edge"){if(closest=feature.geometry.distanceTo(loc,{details:!0}),dist=closest.distance,dist<=tolerance[type]&&dist<result.dist){result={rank:j,dist:dist,x:closest.x0,y:closest.y0};eligible=!0;break}}else{for(vertices=feature.geometry.getVertices(type==="node"),found=!1,k=0,klen=vertices.length;k<klen;++k)vertex=vertices[k],dist=vertex.distanceTo(loc),dist<=tolerance[type]&&(j<result.rank||j===result.rank&&dist<result.dist)&&(result={rank:j,dist:dist,x:vertex.x,y:vertex.y},eligible=!0,found=!0);if(found)break}return eligible?result:null},getGeoTolerance:function(tolerance,resolution){resolution!==this.resolution&&(this.resolution=resolution,this.geoToleranceCache={});var geoTolerance=this.geoToleranceCache[tolerance];return geoTolerance===undefined&&(geoTolerance=tolerance*resolution,this.geoToleranceCache[tolerance]=geoTolerance),geoTolerance},destroy:function(){this.active&&this.deactivate();delete this.layer;delete this.targets;OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Snapping"});OpenLayers.Format.WMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",profile:null,CLASS_NAME:"OpenLayers.Format.WMSCapabilities"});OpenLayers.Format.WMSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",read:function(data){var raw,capabilities,parser;return typeof data=="string"&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data])),raw=data,data&&data.nodeType==9&&(data=data.documentElement),capabilities={},this.readNode(data,capabilities),capabilities.service===undefined&&(parser=new OpenLayers.Format.OGCExceptionReport,capabilities.error=parser.read(raw)),capabilities},readers:{wms:{Service:function(node,obj){obj.service={};this.readChildNodes(node,obj.service)},Name:function(node,obj){obj.name=this.getChildValue(node)},Title:function(node,obj){obj.title=this.getChildValue(node)},Abstract:function(node,obj){obj.abstract=this.getChildValue(node)},BoundingBox:function(node){var bbox={},res;return bbox.bbox=[parseFloat(node.getAttribute("minx")),parseFloat(node.getAttribute("miny")),parseFloat(node.getAttribute("maxx")),parseFloat(node.getAttribute("maxy"))],res={x:parseFloat(node.getAttribute("resx")),y:parseFloat(node.getAttribute("resy"))},isNaN(res.x)&&isNaN(res.y)||(bbox.res=res),bbox},OnlineResource:function(node,obj){obj.href=this.getAttributeNS(node,this.namespaces.xlink,"href")},ContactInformation:function(node,obj){obj.contactInformation={};this.readChildNodes(node,obj.contactInformation)},ContactPersonPrimary:function(node,obj){obj.personPrimary={};this.readChildNodes(node,obj.personPrimary)},ContactPerson:function(node,obj){obj.person=this.getChildValue(node)},ContactOrganization:function(node,obj){obj.organization=this.getChildValue(node)},ContactPosition:function(node,obj){obj.position=this.getChildValue(node)},ContactAddress:function(node,obj){obj.contactAddress={};this.readChildNodes(node,obj.contactAddress)},AddressType:function(node,obj){obj.type=this.getChildValue(node)},Address:function(node,obj){obj.address=this.getChildValue(node)},City:function(node,obj){obj.city=this.getChildValue(node)},StateOrProvince:function(node,obj){obj.stateOrProvince=this.getChildValue(node)},PostCode:function(node,obj){obj.postcode=this.getChildValue(node)},Country:function(node,obj){obj.country=this.getChildValue(node)},ContactVoiceTelephone:function(node,obj){obj.phone=this.getChildValue(node)},ContactFacsimileTelephone:function(node,obj){obj.fax=this.getChildValue(node)},ContactElectronicMailAddress:function(node,obj){obj.email=this.getChildValue(node)},Fees:function(node,obj){var fees=this.getChildValue(node);fees&&fees.toLowerCase()!="none"&&(obj.fees=fees)},AccessConstraints:function(node,obj){var constraints=this.getChildValue(node);constraints&&constraints.toLowerCase()!="none"&&(obj.accessConstraints=constraints)},Capability:function(node,obj){obj.capability={nestedLayers:[],layers:[]};this.readChildNodes(node,obj.capability)},Request:function(node,obj){obj.request={};this.readChildNodes(node,obj.request)},GetCapabilities:function(node,obj){obj.getcapabilities={formats:[]};this.readChildNodes(node,obj.getcapabilities)},Format:function(node,obj){OpenLayers.Util.isArray(obj.formats)?obj.formats.push(this.getChildValue(node)):obj.format=this.getChildValue(node)},DCPType:function(node,obj){this.readChildNodes(node,obj)},HTTP:function(node,obj){this.readChildNodes(node,obj)},Get:function(node,obj){obj.get={};this.readChildNodes(node,obj.get);obj.href||(obj.href=obj.get.href)},Post:function(node,obj){obj.post={};this.readChildNodes(node,obj.post);obj.href||(obj.href=obj.get.href)},GetMap:function(node,obj){obj.getmap={formats:[]};this.readChildNodes(node,obj.getmap)},GetFeatureInfo:function(node,obj){obj.getfeatureinfo={formats:[]};this.readChildNodes(node,obj.getfeatureinfo)},Exception:function(node,obj){obj.exception={formats:[]};this.readChildNodes(node,obj.exception)},Layer:function(node,obj){var parentLayer,capability,attrNode,queryable,cascaded;obj.capability?(capability=obj.capability,parentLayer=obj):capability=obj;attrNode=node.getAttributeNode("queryable");queryable=attrNode&&attrNode.specified?node.getAttribute("queryable"):null;attrNode=node.getAttributeNode("cascaded");cascaded=attrNode&&attrNode.specified?node.getAttribute("cascaded"):null;attrNode=node.getAttributeNode("opaque");var opaque=attrNode&&attrNode.specified?node.getAttribute("opaque"):null,noSubsets=node.getAttribute("noSubsets"),fixedWidth=node.getAttribute("fixedWidth"),fixedHeight=node.getAttribute("fixedHeight"),parent=parentLayer||{},extend=OpenLayers.Util.extend,layer={nestedLayers:[],styles:parentLayer?[].concat(parentLayer.styles):[],srs:parentLayer?extend({},parent.srs):{},metadataURLs:[],bbox:parentLayer?extend({},parent.bbox):{},llbbox:parent.llbbox,dimensions:parentLayer?extend({},parent.dimensions):{},authorityURLs:parentLayer?extend({},parent.authorityURLs):{},identifiers:{},keywords:[],queryable:queryable&&queryable!==""?queryable==="1"||queryable==="true":parent.queryable||!1,cascaded:cascaded!==null?parseInt(cascaded):parent.cascaded||0,opaque:opaque?opaque==="1"||opaque==="true":parent.opaque||!1,noSubsets:noSubsets!==null?noSubsets==="1"||noSubsets==="true":parent.noSubsets||!1,fixedWidth:fixedWidth!=null?parseInt(fixedWidth):parent.fixedWidth||0,fixedHeight:fixedHeight!=null?parseInt(fixedHeight):parent.fixedHeight||0,minScale:parent.minScale,maxScale:parent.maxScale,attribution:parent.attribution};if(obj.nestedLayers.push(layer),layer.capability=capability,this.readChildNodes(node,layer),delete layer.capability,layer.name){var parts=layer.name.split(":"),request=capability.request,gfi=request.getfeatureinfo;parts.length>0&&(layer.prefix=parts[0]);capability.layers.push(layer);layer.formats===undefined&&(layer.formats=request.getmap.formats);layer.infoFormats===undefined&&gfi&&(layer.infoFormats=gfi.formats)}},Attribution:function(node,obj){obj.attribution={};this.readChildNodes(node,obj.attribution)},LogoURL:function(node,obj){obj.logo={width:node.getAttribute("width"),height:node.getAttribute("height")};this.readChildNodes(node,obj.logo)},Style:function(node,obj){var style={};obj.styles.push(style);this.readChildNodes(node,style)},LegendURL:function(node,obj){var legend={width:node.getAttribute("width"),height:node.getAttribute("height")};obj.legend=legend;this.readChildNodes(node,legend)},MetadataURL:function(node,obj){var metadataURL={type:node.getAttribute("type")};obj.metadataURLs.push(metadataURL);this.readChildNodes(node,metadataURL)},DataURL:function(node,obj){obj.dataURL={};this.readChildNodes(node,obj.dataURL)},FeatureListURL:function(node,obj){obj.featureListURL={};this.readChildNodes(node,obj.featureListURL)},AuthorityURL:function(node,obj){var name=node.getAttribute("name"),authority={};this.readChildNodes(node,authority);obj.authorityURLs[name]=authority.href},Identifier:function(node,obj){var authority=node.getAttribute("authority");obj.identifiers[authority]=this.getChildValue(node)},KeywordList:function(node,obj){this.readChildNodes(node,obj)},SRS:function(node,obj){obj.srs[this.getChildValue(node)]=!0}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1"});OpenLayers.Format.WMSCapabilities.v1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMT_MS_Capabilities:function(node,obj){this.readChildNodes(node,obj)},Keyword:function(node,obj){obj.keywords&&obj.keywords.push(this.getChildValue(node))},DescribeLayer:function(node,obj){obj.describelayer={formats:[]};this.readChildNodes(node,obj.describelayer)},GetLegendGraphic:function(node,obj){obj.getlegendgraphic={formats:[]};this.readChildNodes(node,obj.getlegendgraphic)},GetStyles:function(node,obj){obj.getstyles={formats:[]};this.readChildNodes(node,obj.getstyles)},PutStyles:function(node,obj){obj.putstyles={formats:[]};this.readChildNodes(node,obj.putstyles)},UserDefinedSymbolization:function(node,obj){var userSymbols={supportSLD:parseInt(node.getAttribute("SupportSLD"))==1,userLayer:parseInt(node.getAttribute("UserLayer"))==1,userStyle:parseInt(node.getAttribute("UserStyle"))==1,remoteWFS:parseInt(node.getAttribute("RemoteWFS"))==1};obj.userSymbols=userSymbols},LatLonBoundingBox:function(node,obj){obj.llbbox=[parseFloat(node.getAttribute("minx")),parseFloat(node.getAttribute("miny")),parseFloat(node.getAttribute("maxx")),parseFloat(node.getAttribute("maxy"))]},BoundingBox:function(node,obj){var bbox=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[node,obj]);bbox.srs=node.getAttribute("SRS");obj.bbox[bbox.srs]=bbox},ScaleHint:function(node,obj){var min=node.getAttribute("min"),max=node.getAttribute("max"),rad2=Math.pow(2,.5),ipm=OpenLayers.INCHES_PER_UNIT.m;obj.maxScale=parseFloat((min/rad2*ipm*OpenLayers.DOTS_PER_INCH).toPrecision(13));obj.minScale=parseFloat((max/rad2*ipm*OpenLayers.DOTS_PER_INCH).toPrecision(13))},Dimension:function(node,obj){var name=node.getAttribute("name").toLowerCase(),dim={name:name,units:node.getAttribute("units"),unitsymbol:node.getAttribute("unitSymbol")};obj.dimensions[dim.name]=dim},Extent:function(node,obj){var name=node.getAttribute("name").toLowerCase(),extent,values;name in obj.dimensions&&(extent=obj.dimensions[name],extent.nearestVal=node.getAttribute("nearestValue")==="1",extent.multipleVal=node.getAttribute("multipleValues")==="1",extent.current=node.getAttribute("current")==="1",extent["default"]=node.getAttribute("default")||"",values=this.getChildValue(node),extent.values=values.split(","))}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1"});OpenLayers.Format.WMSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.0",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(node,obj){for(var srs=this.getChildValue(node),values=srs.split(/ +/),i=0,len=values.length;i<len;i++)obj.srs[values[i]]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_0"});OpenLayers.Protocol.WFS.v1=OpenLayers.Class(OpenLayers.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,readOptions:null,initialize:function(options){OpenLayers.Protocol.prototype.initialize.apply(this,[options]);options.format||(this.format=OpenLayers.Format.WFST(OpenLayers.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions)));!options.geometryName&&parseFloat(this.format.version)>1&&this.setGeometryName(null)},destroy:function(){this.options&&!this.options.format&&this.format.destroy();this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(options){OpenLayers.Protocol.prototype.read.apply(this,arguments);options=OpenLayers.Util.extend({},options);OpenLayers.Util.applyDefaults(options,this.options||{});var response=new OpenLayers.Protocol.Response({requestType:"read"}),data=OpenLayers.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",options)]);return response.priv=OpenLayers.Request.POST({url:options.url,callback:this.createCallback(this.handleRead,response,options),params:options.params,headers:options.headers,data:data}),response},setFeatureType:function(featureType){this.featureType=featureType;this.format.featureType=featureType},setGeometryName:function(geometryName){this.geometryName=geometryName;this.format.geometryName=geometryName},handleRead:function(response,options){var request,result;options=OpenLayers.Util.extend({},options);OpenLayers.Util.applyDefaults(options,this.options);options.callback&&(request=response.priv,request.status>=200&&request.status<300?(result=this.parseResponse(request,options.readOptions),result&&result.success!==!1?(options.readOptions&&options.readOptions.output=="object"?OpenLayers.Util.extend(response,result):response.features=result,response.code=OpenLayers.Protocol.Response.SUCCESS):(response.code=OpenLayers.Protocol.Response.FAILURE,response.error=result)):response.code=OpenLayers.Protocol.Response.FAILURE,options.callback.call(options.scope,response))},parseResponse:function(request,options){var doc=request.responseXML,result,format;return(doc&&doc.documentElement||(doc=request.responseText),!doc||doc.length<=0)?null:(result=this.readFormat!==null?this.readFormat.read(doc):this.format.read(doc,options),this.featureNS||(format=this.readFormat||this.format,this.featureNS=format.featureNS,format.autoConfig=!1,this.geometryName||this.setGeometryName(format.geometryName)),result)},commit:function(features,options){options=OpenLayers.Util.extend({},options);OpenLayers.Util.applyDefaults(options,this.options);var response=new OpenLayers.Protocol.Response({requestType:"commit",reqFeatures:features});return response.priv=OpenLayers.Request.POST({url:options.url,headers:options.headers,data:this.format.write(features,options),callback:this.createCallback(this.handleCommit,response,options)}),response},handleCommit:function(response,options){var request,data,obj;options.callback&&(request=response.priv,data=request.responseXML,data&&data.documentElement||(data=request.responseText),obj=this.format.read(data)||{},response.insertIds=obj.insertIds||[],obj.success?response.code=OpenLayers.Protocol.Response.SUCCESS:(response.code=OpenLayers.Protocol.Response.FAILURE,response.error=obj),options.callback.call(options.scope,response))},filterDelete:function(filter,options){var filterNode,data;options=OpenLayers.Util.extend({},options);OpenLayers.Util.applyDefaults(options,this.options);var response=new OpenLayers.Protocol.Response({requestType:"commit"}),root=this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}}),deleteNode=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(options.featureNS?this.featurePrefix+":":"")+options.featureType}});return options.featureNS&&deleteNode.setAttribute("xmlns:"+this.featurePrefix,options.featureNS),filterNode=this.format.writeNode("ogc:Filter",filter),deleteNode.appendChild(filterNode),root.appendChild(deleteNode),data=OpenLayers.Format.XML.prototype.write.apply(this.format,[root]),OpenLayers.Request.POST({url:this.url,callback:options.callback||function(){},data:data})},abort:function(response){response&&response.priv.abort()},CLASS_NAME:"OpenLayers.Protocol.WFS.v1"});OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:!1,citeCompliant:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,layerOptions:null,pixelTolerance:5,touch:!1,lastTouchPx:null,initialize:function(control,callbacks,options){options&&options.layerOptions&&options.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{}));OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments))return!1;var options=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);return this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,options),this.map.addLayer(this.layer),!0},createFeature:function(pixel){var lonlat=this.layer.getLonLatFromViewPortPx(pixel),geometry=new OpenLayers.Geometry.Point(lonlat.lon,lonlat.lat);this.point=new OpenLayers.Feature.Vector(geometry);this.callback("create",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)?(this.cancel(),this.layer.map!=null&&(this.destroyFeature(!0),this.layer.destroy(!1)),this.layer=null,this.touch=!1,!0):!1},destroyFeature:function(force){this.layer&&(force||!this.persist)&&this.layer.destroyFeatures();this.point=null},destroyPersistedFeature:function(){var layer=this.layer;layer&&layer.features.length>1&&this.layer.features[0].destroy()},finalize:function(cancel){var key=cancel?"cancel":"done";this.mouseDown=!1;this.lastDown=null;this.lastUp=null;this.lastTouchPx=null;this.callback(key,[this.geometryClone()]);this.destroyFeature(cancel)},cancel:function(){this.finalize(!0)},click:function(evt){return OpenLayers.Event.stop(evt),!1},dblclick:function(evt){return OpenLayers.Event.stop(evt),!1},modifyFeature:function(pixel){this.point||this.createFeature(pixel);var lonlat=this.layer.getLonLatFromViewPortPx(pixel);this.point.geometry.x=lonlat.lon;this.point.geometry.y=lonlat.lat;this.callback("modify",[this.point.geometry,this.point,!1]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var geometry=this.point&&this.point.geometry;return geometry&&this.multi&&(geometry=new OpenLayers.Geometry.MultiPoint([geometry])),geometry},geometryClone:function(){var geom=this.getGeometry();return geom&&geom.clone()},mousedown:function(evt){return this.down(evt)},touchstart:function(evt){return this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.lastTouchPx=evt.xy,this.down(evt)},mousemove:function(evt){return this.move(evt)},touchmove:function(evt){return this.lastTouchPx=evt.xy,this.move(evt)},mouseup:function(evt){return this.up(evt)},touchend:function(evt){return evt.xy=this.lastTouchPx,this.up(evt)},down:function(evt){return this.mouseDown=!0,this.lastDown=evt.xy,this.touch||this.modifyFeature(evt.xy),this.stoppedDown=this.stopDown,!this.stopDown},move:function(evt){return this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(evt.xy),!0},up:function(evt){return(this.mouseDown=!1,this.stoppedDown=this.stopDown,!this.checkModifiers(evt))?!0:this.lastUp&&this.lastUp.equals(evt.xy)?!0:this.lastDown&&this.passesTolerance(this.lastDown,evt.xy,this.pixelTolerance)?(this.touch&&this.modifyFeature(evt.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=evt.xy,this.finalize(),!this.stopUp):!0},mouseout:function(evt){OpenLayers.Util.mouseLeft(evt,this.map.viewPortDiv)&&(this.stoppedDown=this.stopDown,this.mouseDown=!1)},passesTolerance:function(pixel1,pixel2,tolerance){var passes=!0,dist;return tolerance!=null&&pixel1&&pixel2&&(dist=pixel1.distanceTo(pixel2),dist>tolerance&&(passes=!1)),passes},CLASS_NAME:"OpenLayers.Handler.Point"});OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:!1,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(pixel){var lonlat=this.layer.getLonLatFromViewPortPx(pixel),geometry=new OpenLayers.Geometry.Point(lonlat.lon,lonlat.lat);this.point=new OpenLayers.Feature.Vector(geometry);this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.line,this.point],{silent:!0})},destroyFeature:function(force){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,force);this.line=null},destroyPersistedFeature:function(){var layer=this.layer;layer&&layer.features.length>2&&this.layer.features[0].destroy()},removePoint:function(){this.point&&this.layer.removeFeatures([this.point])},addPoint:function(pixel){this.layer.removeFeatures([this.point]);var lonlat=this.layer.getLonLatFromViewPortPx(pixel);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(lonlat.lon,lonlat.lat));this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length);this.layer.addFeatures([this.point]);this.callback("point",[this.point.geometry,this.getGeometry()]);this.callback("modify",[this.point.geometry,this.getSketch()]);this.drawFeature();delete this.redoStack},insertXY:function(x,y){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(x,y),this.getCurrentPointIndex());this.drawFeature();delete this.redoStack},insertDeltaXY:function(dx,dy){var previousIndex=this.getCurrentPointIndex()-1,p0=this.line.geometry.components[previousIndex];!p0||isNaN(p0.x)||isNaN(p0.y)||this.insertXY(p0.x+dx,p0.y+dy)},insertDirectionLength:function(direction,length){direction*=Math.PI/180;var dx=length*Math.cos(direction),dy=length*Math.sin(direction);this.insertDeltaXY(dx,dy)},insertDeflectionLength:function(deflection,length){var previousIndex=this.getCurrentPointIndex()-1;if(previousIndex>0){var p1=this.line.geometry.components[previousIndex],p0=this.line.geometry.components[previousIndex-1],theta=Math.atan2(p1.y-p0.y,p1.x-p0.x);this.insertDirectionLength(theta*180/Math.PI+deflection,length)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var geometry=this.line.geometry,components=geometry.components,index=this.getCurrentPointIndex()-1,target=components[index],undone=geometry.removeComponent(target);return undone&&(this.redoStack||(this.redoStack=[]),this.redoStack.push(target),this.drawFeature()),undone},redo:function(){var target=this.redoStack&&this.redoStack.pop();return target&&(this.line.geometry.addComponent(target,this.getCurrentPointIndex()),this.drawFeature()),!!target},freehandMode:function(evt){return this.freehandToggle&&evt[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(pixel,drawing){this.line||this.createFeature(pixel);var lonlat=this.layer.getLonLatFromViewPortPx(pixel);this.point.geometry.x=lonlat.lon;this.point.geometry.y=lonlat.lat;this.callback("modify",[this.point.geometry,this.getSketch(),drawing]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var geometry=this.line&&this.line.geometry;return geometry&&this.multi&&(geometry=new OpenLayers.Geometry.MultiLineString([geometry])),geometry},touchstart:function(evt){return this.timerId&&this.passesTolerance(this.lastTouchPx,evt.xy,this.doubleTouchTolerance)?(this.finishGeometry(),window.clearTimeout(this.timerId),this.timerId=null,!1):(this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300),OpenLayers.Handler.Point.prototype.touchstart.call(this,evt))},down:function(evt){var stopDown=this.stopDown;return this.freehandMode(evt)&&(stopDown=!0,this.touch&&(this.modifyFeature(evt.xy,!!this.lastUp),OpenLayers.Event.stop(evt))),this.touch||this.lastDown&&this.passesTolerance(this.lastDown,evt.xy,this.pixelTolerance)||this.modifyFeature(evt.xy,!!this.lastUp),this.mouseDown=!0,this.lastDown=evt.xy,this.stoppedDown=stopDown,!stopDown},move:function(evt){return this.stoppedDown&&this.freehandMode(evt)?(this.persist&&this.destroyPersistedFeature(),this.maxVertices&&this.line&&this.line.geometry.components.length===this.maxVertices?(this.removePoint(),this.finalize()):this.addPoint(evt.xy),!1):(this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(evt.xy,!!this.lastUp),!0)},up:function(evt){return!this.mouseDown||this.lastUp&&this.lastUp.equals(evt.xy)||(this.stoppedDown&&this.freehandMode(evt)?(this.persist&&this.destroyPersistedFeature(),this.removePoint(),this.finalize()):this.passesTolerance(this.lastDown,evt.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(evt.xy),this.lastUp==null&&this.persist&&this.destroyPersistedFeature(),this.addPoint(evt.xy),this.lastUp=evt.xy,this.line.geometry.components.length===this.maxVertices+1&&this.finishGeometry())),this.stoppedDown=this.stopDown,this.mouseDown=!1,!this.stopUp},finishGeometry:function(){var index=this.line.geometry.components.length-1;this.line.geometry.removeComponent(this.line.geometry.components[index]);this.removePoint();this.finalize()},dblclick:function(evt){return this.freehandMode(evt)||this.finishGeometry(),!1},CLASS_NAME:"OpenLayers.Handler.Path"});OpenLayers.Spherical=OpenLayers.Spherical||{};OpenLayers.Spherical.DEFAULT_RADIUS=6378137;OpenLayers.Spherical.computeDistanceBetween=function(from,to,radius){var R=radius||OpenLayers.Spherical.DEFAULT_RADIUS,sinHalfDeltaLon=Math.sin(Math.PI*(to.lon-from.lon)/360),sinHalfDeltaLat=Math.sin(Math.PI*(to.lat-from.lat)/360),a=sinHalfDeltaLat*sinHalfDeltaLat+sinHalfDeltaLon*sinHalfDeltaLon*Math.cos(Math.PI*from.lat/180)*Math.cos(Math.PI*to.lat/180);return 2*R*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))};OpenLayers.Spherical.computeHeading=function(from,to){var y=Math.sin(Math.PI*(from.lon-to.lon)/180)*Math.cos(Math.PI*to.lat/180),x=Math.cos(Math.PI*from.lat/180)*Math.sin(Math.PI*to.lat/180)-Math.sin(Math.PI*from.lat/180)*Math.cos(Math.PI*to.lat/180)*Math.cos(Math.PI*(from.lon-to.lon)/180);return 180*Math.atan2(y,x)/Math.PI};OpenLayers.Control.CacheWrite=OpenLayers.Class(OpenLayers.Control,{layers:null,imageFormat:"image/png",quotaRegEx:/quota/i,setMap:function(map){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var layers=this.layers||map.layers,i=layers.length-1;i>=0;--i)this.addLayer({layer:layers[i]});if(!this.layers)map.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})},addLayer:function(evt){evt.layer.events.on({tileloadstart:this.makeSameOrigin,tileloaded:this.cache,scope:this})},removeLayer:function(evt){evt.layer.events.un({tileloadstart:this.makeSameOrigin,tileloaded:this.cache,scope:this})},makeSameOrigin:function(evt){var tile,sameOriginUrl;this.active&&(tile=evt.tile,tile instanceof OpenLayers.Tile.Image&&!tile.crossOriginKeyword&&tile.url.substr(0,5)!=="data:"&&(sameOriginUrl=OpenLayers.Request.makeSameOrigin(tile.url,OpenLayers.ProxyHost),OpenLayers.Control.CacheWrite.urlMap[sameOriginUrl]=tile.url,tile.url=sameOriginUrl))},cache:function(obj){var tile,canvasContext,urlMap,url,reason;if(this.active&&window.localStorage&&(tile=obj.tile,tile instanceof OpenLayers.Tile.Image&&tile.url.substr(0,5)!=="data:"))try{canvasContext=tile.getCanvasContext();canvasContext&&(urlMap=OpenLayers.Control.CacheWrite.urlMap,url=urlMap[tile.url]||tile.url,window.localStorage.setItem("olCache_"+url,canvasContext.canvas.toDataURL(this.imageFormat)),delete urlMap[tile.url])}catch(e){reason=e.name||e.message;reason&&this.quotaRegEx.test(reason)?this.events.triggerEvent("cachefull",{tile:tile}):OpenLayers.Console.error(e.toString())}},destroy:function(){if(this.layers||this.map)for(var layers=this.layers||this.map.layers,i=layers.length-1;i>=0;--i)this.removeLayer({layer:layers[i]});this.map&&this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.CacheWrite"});OpenLayers.Control.CacheWrite.clearCache=function(){if(window.localStorage)for(var key,i=window.localStorage.length-1;i>=0;--i)key=window.localStorage.key(i),key.substr(0,8)==="olCache_"&&window.localStorage.removeItem(key)};OpenLayers.Control.CacheWrite.urlMap={};OpenLayers.Control.PanPanel=OpenLayers.Class(OpenLayers.Control.Panel,{slideFactor:50,slideRatio:null,initialize:function(options){OpenLayers.Control.Panel.prototype.initialize.apply(this,[options]);var options={slideFactor:this.slideFactor,slideRatio:this.slideRatio};this.addControls([new OpenLayers.Control.Pan(OpenLayers.Control.Pan.NORTH,options),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.SOUTH,options),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.EAST,options),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.WEST,options)])},CLASS_NAME:"OpenLayers.Control.PanPanel"});OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",template:"${layers}",destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this});return this.updateAttribution(),this.div},updateAttribution:function(){var attributions=[],i,len,layer;if(this.map&&this.map.layers){for(i=0,len=this.map.layers.length;i<len;i++)layer=this.map.layers[i],layer.attribution&&layer.getVisibility()&&OpenLayers.Util.indexOf(attributions,layer.attribution)===-1&&attributions.push(layer.attribution);this.div.innerHTML=OpenLayers.String.format(this.template,{layers:attributions.join(this.separator)})}},CLASS_NAME:"OpenLayers.Control.Attribution"});OpenLayers.Kinetic=OpenLayers.Class({threshold:0,deceleration:.0035,nbPoints:100,delay:200,points:undefined,timerId:undefined,initialize:function(options){OpenLayers.Util.extend(this,options)},begin:function(){OpenLayers.Animation.stop(this.timerId);this.timerId=undefined;this.points=[]},update:function(xy){this.points.unshift({xy:xy,tick:(new Date).getTime()});this.points.length>this.nbPoints&&this.points.pop()},end:function(xy){for(var theta,last,now=(new Date).getTime(),i=0,l=this.points.length,point;i<l;i++){if(point=this.points[i],now-point.tick>this.delay)break;last=point}if(last){var time=(new Date).getTime()-last.tick,dist=Math.sqrt(Math.pow(xy.x-last.xy.x,2)+Math.pow(xy.y-last.xy.y,2)),speed=dist/time;if(speed!=0&&!(speed<this.threshold))return theta=Math.asin((xy.y-last.xy.y)/dist),last.xy.x<=xy.x&&(theta=Math.PI-theta),{speed:speed,theta:theta}}},move:function(info,callback){var v0=info.speed,fx=Math.cos(info.theta),fy=-Math.sin(info.theta),initialTime=(new Date).getTime(),lastX=0,lastY=0,timerCallback=function(){var v;if(this.timerId!=null){var t=(new Date).getTime()-initialTime,p=-this.deceleration*Math.pow(t,2)/2+v0*t,x=p*fx,y=p*fy,args={};args.end=!1;v=-this.deceleration*t+v0;v<=0&&(OpenLayers.Animation.stop(this.timerId),this.timerId=null,args.end=!0);args.x=x-lastX;args.y=y-lastY;lastX=x;lastY=y;callback(args.x,args.y,args.end)}};this.timerId=OpenLayers.Animation.start(OpenLayers.Function.bind(timerCallback,this))},CLASS_NAME:"OpenLayers.Kinetic"});OpenLayers.Layer.GeoRSS=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,icon:null,popupSize:null,useFeedTitle:!0,initialize:function(name,location,options){OpenLayers.Layer.Markers.prototype.initialize.apply(this,[name,options]);this.location=location;this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments);this.clearFeatures();this.features=null},loadRSS:function(){this.loaded||(this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.location,success:this.parseData,scope:this}),this.loaded=!0)},moveTo:function(){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);this.visibility&&!this.loaded&&this.loadRSS()},parseData:function(ajaxRequest){var doc=ajaxRequest.responseXML,name,options,format,features,i,len,data,contentHTML,feature,marker;if(doc&&doc.documentElement||(doc=OpenLayers.Format.XML.prototype.read(ajaxRequest.responseText)),this.useFeedTitle){name=null;try{name=doc.getElementsByTagNameNS("*","title")[0].firstChild.nodeValue}catch(e){name=doc.getElementsByTagName("title")[0].firstChild.nodeValue}name&&this.setName(name)}for(options={},OpenLayers.Util.extend(options,this.formatOptions),this.map&&!this.projection.equals(this.map.getProjectionObject())&&(options.externalProjection=this.projection,options.internalProjection=this.map.getProjectionObject()),format=new OpenLayers.Format.GeoRSS(options),features=format.read(doc),i=0,len=features.length;i<len;i++)if(data={},feature=features[i],feature.geometry){var title=feature.attributes.title?feature.attributes.title:"Untitled",description=feature.attributes.description?feature.attributes.description:"No description.",link=feature.attributes.link?feature.attributes.link:"",location=feature.geometry.getBounds().getCenterLonLat();data.icon=this.icon==null?OpenLayers.Marker.defaultIcon():this.icon.clone();data.popupSize=this.popupSize?this.popupSize.clone():new OpenLayers.Size(250,120);(title||description)&&(data.title=title,data.description=description,contentHTML='<div class="olLayerGeoRSSClose">[x]<\/div>',contentHTML+='<div class="olLayerGeoRSSTitle">',link&&(contentHTML+='<a class="link" href="'+link+'" target="_blank">'),contentHTML+=title,link&&(contentHTML+="<\/a>"),contentHTML+="<\/div>",contentHTML+='<div style="" class="olLayerGeoRSSDescription">',contentHTML+=description,contentHTML+="<\/div>",data.popupContentHTML=contentHTML);feature=new OpenLayers.Feature(this,location,data);this.features.push(feature);marker=feature.createMarker();marker.events.register("click",feature,this.markerClick);this.addMarker(marker)}this.events.triggerEvent("loadend")},markerClick:function(evt){var sameMarkerClicked=this==this.layer.selectedFeature,i,len,popup;for(this.layer.selectedFeature=sameMarkerClicked?null:this,i=0,len=this.layer.map.popups.length;i<len;i++)this.layer.map.removePopup(this.layer.map.popups[i]);sameMarkerClicked||(popup=this.createPopup(),OpenLayers.Event.observe(popup.div,"click",OpenLayers.Function.bind(function(){for(var i=0,len=this.layer.map.popups.length;i<len;i++)this.layer.map.removePopup(this.layer.map.popups[i])},this)),this.layer.map.addPopup(popup));OpenLayers.Event.stop(evt)},clearFeatures:function(){if(this.features!=null)while(this.features.length>0){var feature=this.features[0];OpenLayers.Util.removeItem(this.features,feature);feature.destroy()}},CLASS_NAME:"OpenLayers.Layer.GeoRSS"});OpenLayers.Format.WMSCapabilities.v1_3=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMS_Capabilities:function(node,obj){this.readChildNodes(node,obj)},LayerLimit:function(node,obj){obj.layerLimit=parseInt(this.getChildValue(node))},MaxWidth:function(node,obj){obj.maxWidth=parseInt(this.getChildValue(node))},MaxHeight:function(node,obj){obj.maxHeight=parseInt(this.getChildValue(node))},BoundingBox:function(node,obj){var bbox=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[node,obj]);bbox.srs=node.getAttribute("CRS");obj.bbox[bbox.srs]=bbox},CRS:function(node,obj){this.readers.wms.SRS.apply(this,[node,obj])},EX_GeographicBoundingBox:function(node,obj){obj.llbbox=[];this.readChildNodes(node,obj.llbbox)},westBoundLongitude:function(node,obj){obj[0]=this.getChildValue(node)},eastBoundLongitude:function(node,obj){obj[2]=this.getChildValue(node)},southBoundLatitude:function(node,obj){obj[1]=this.getChildValue(node)},northBoundLatitude:function(node,obj){obj[3]=this.getChildValue(node)},MinScaleDenominator:function(node,obj){obj.maxScale=parseFloat(this.getChildValue(node)).toPrecision(16)},MaxScaleDenominator:function(node,obj){obj.minScale=parseFloat(this.getChildValue(node)).toPrecision(16)},Dimension:function(node,obj){var name=node.getAttribute("name").toLowerCase(),dim={name:name,units:node.getAttribute("units"),unitsymbol:node.getAttribute("unitSymbol"),nearestVal:node.getAttribute("nearestValue")==="1",multipleVal:node.getAttribute("multipleValues")==="1","default":node.getAttribute("default")||"",current:node.getAttribute("current")==="1",values:this.getChildValue(node).split(",")};obj.dimensions[dim.name]=dim},Keyword:function(node,obj){var keyword={value:this.getChildValue(node),vocabulary:node.getAttribute("vocabulary")};obj.keywords&&obj.keywords.push(keyword)}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms),sld:{UserDefinedSymbolization:function(node,obj){this.readers.wms.UserDefinedSymbolization.apply(this,[node,obj]);obj.userSymbols.inlineFeature=parseInt(node.getAttribute("InlineFeature"))==1;obj.userSymbols.remoteWCS=parseInt(node.getAttribute("RemoteWCS"))==1},DescribeLayer:function(node,obj){this.readers.wms.DescribeLayer.apply(this,[node,obj])},GetLegendGraphic:function(node,obj){this.readers.wms.GetLegendGraphic.apply(this,[node,obj])}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3"});OpenLayers.Format.SOSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.SOSCapabilities"});OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},isBaseLayer:!0,encodeBBOX:!1,noMagic:!1,yx:{},initialize:function(name,url,params,options){var newArguments=[];params=OpenLayers.Util.upperCaseObject(params);parseFloat(params.VERSION)>=1.3&&!params.EXCEPTIONS&&(params.EXCEPTIONS="INIMAGE");newArguments.push(name,url,params,options);OpenLayers.Layer.Grid.prototype.initialize.apply(this,newArguments);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));!this.noMagic&&this.params.TRANSPARENT&&this.params.TRANSPARENT.toString().toLowerCase()=="true"&&(options!=null&&options.isBaseLayer||(this.isBaseLayer=!1),this.params.FORMAT=="image/jpeg"&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"))},clone:function(obj){return obj==null&&(obj=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions())),OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj])},reverseAxisOrder:function(){var projCode=this.projection.getCode();return parseFloat(this.params.VERSION)>=1.3&&!!(this.yx[projCode]||OpenLayers.Projection.defaults[projCode].yx)},getURL:function(bounds){bounds=this.adjustBounds(bounds);var imageSize=this.getImageSize(),newParams={},reverseAxisOrder=this.reverseAxisOrder();return newParams.BBOX=this.encodeBBOX?bounds.toBBOX(null,reverseAxisOrder):bounds.toArray(reverseAxisOrder),newParams.WIDTH=imageSize.w,newParams.HEIGHT=imageSize.h,this.getFullRequestString(newParams)},mergeNewParams:function(newParams){var upperParams=OpenLayers.Util.upperCaseObject(newParams),newArguments=[upperParams];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,newArguments)},getFullRequestString:function(newParams){var mapProjection=this.map.getProjectionObject(),projectionCode=this.projection&&this.projection.equals(mapProjection)?this.projection.getCode():mapProjection.getCode(),value=projectionCode=="none"?null:projectionCode;return parseFloat(this.params.VERSION)>=1.3?this.params.CRS=value:this.params.SRS=value,typeof this.params.TRANSPARENT=="boolean"&&(newParams.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE"),OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"});OpenLayers.Layer.KaMap=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,DEFAULT_PARAMS:{i:"jpeg",map:""},initialize:function(){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getURL:function(bounds){bounds=this.adjustBounds(bounds);var mapRes=this.map.getResolution(),scale=Math.round(this.map.getScale()*1e4)/1e4,pX=Math.round(bounds.left/mapRes),pY=-Math.round(bounds.top/mapRes);return this.getFullRequestString({t:pY,l:pX,s:scale})},calculateGridLayout:function(bounds,origin,resolution){var tilelon=resolution*this.tileSize.w,tilelat=resolution*this.tileSize.h,offsetlon=bounds.left,tilecol=Math.floor(offsetlon/tilelon)-this.buffer,tilecolremain=offsetlon/tilelon-tilecol,tileoffsetx=-tilecolremain*this.tileSize.w,tileoffsetlon=tilecol*tilelon,offsetlat=bounds.top,tilerow=Math.ceil(offsetlat/tilelat)+this.buffer,tilerowremain=tilerow-offsetlat/tilelat,tileoffsety=-(tilerowremain+1)*this.tileSize.h,tileoffsetlat=tilerow*tilelat;return{tilelon:tilelon,tilelat:tilelat,tileoffsetlon:tileoffsetlon,tileoffsetlat:tileoffsetlat,tileoffsetx:tileoffsetx,tileoffsety:tileoffsety,startcol:tilecol,startrow:tilerow}},clone:function(obj){return obj==null&&(obj=new OpenLayers.Layer.KaMap(this.name,this.url,this.params,this.getOptions())),obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj]),this.tileSize!=null&&(obj.tileSize=this.tileSize.clone()),obj.grid=[],obj},getTileBounds:function(viewPortPx){var resolution=this.getResolution(),tileMapWidth=resolution*this.tileSize.w,tileMapHeight=resolution*this.tileSize.h,mapPoint=this.getLonLatFromViewPortPx(viewPortPx),tileLeft=tileMapWidth*Math.floor(mapPoint.lon/tileMapWidth),tileBottom=tileMapHeight*Math.floor(mapPoint.lat/tileMapHeight);return new OpenLayers.Bounds(tileLeft,tileBottom,tileLeft+tileMapWidth,tileBottom+tileMapHeight)},CLASS_NAME:"OpenLayers.Layer.KaMap"});OpenLayers.Format.WMC=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"1.1.0",layerToContext:function(layer){var parser=this.getParser(),layerContext={queryable:layer.queryable,visibility:layer.visibility,name:layer.params.LAYERS,title:layer.name,abstract:layer.metadata.abstract,dataURL:layer.metadata.dataURL,metadataURL:layer.metadataURL,server:{version:layer.params.VERSION,url:layer.url},maxExtent:layer.maxExtent,transparent:layer.params.TRANSPARENT,numZoomLevels:layer.numZoomLevels,units:layer.units,isBaseLayer:layer.isBaseLayer,opacity:layer.opacity==1?undefined:layer.opacity,displayInLayerSwitcher:layer.displayInLayerSwitcher,singleTile:layer.singleTile,tileSize:layer.singleTile||!layer.tileSize?undefined:{width:layer.tileSize.w,height:layer.tileSize.h},minScale:layer.options.resolutions||layer.options.scales||layer.options.maxResolution||layer.options.minScale?layer.minScale:undefined,maxScale:layer.options.resolutions||layer.options.scales||layer.options.minResolution||layer.options.maxScale?layer.maxScale:undefined,formats:[],styles:[],srs:layer.srs,dimensions:layer.dimensions},format,i,len,style;if(layer.metadata.servertitle&&(layerContext.server.title=layer.metadata.servertitle),layer.metadata.formats&&layer.metadata.formats.length>0)for(i=0,len=layer.metadata.formats.length;i<len;i++)format=layer.metadata.formats[i],layerContext.formats.push({value:format.value,current:format.value==layer.params.FORMAT});else layerContext.formats.push({value:layer.params.FORMAT,current:!0});if(layer.metadata.styles&&layer.metadata.styles.length>0)for(i=0,len=layer.metadata.styles.length;i<len;i++)style=layer.metadata.styles[i],style.current=style.href==layer.params.SLD||style.body==layer.params.SLD_BODY||style.name==layer.params.STYLES?!0:!1,layerContext.styles.push(style);else layerContext.styles.push({href:layer.params.SLD,body:layer.params.SLD_BODY,name:layer.params.STYLES||parser.defaultStyleName,title:parser.defaultStyleTitle,current:!0});return layerContext},toContext:function(obj){var context={},layers=obj.layers,metadata,i,len,layer;if(obj.CLASS_NAME=="OpenLayers.Map"?(metadata=obj.metadata||{},context.size=obj.getSize(),context.bounds=obj.getExtent(),context.projection=obj.projection,context.title=obj.title,context.keywords=metadata.keywords,context.abstract=metadata.abstract,context.logo=metadata.logo,context.descriptionURL=metadata.descriptionURL,context.contactInformation=metadata.contactInformation,context.maxExtent=obj.maxExtent):(OpenLayers.Util.applyDefaults(context,obj),context.layers!=undefined&&delete context.layers),context.layersContext==undefined&&(context.layersContext=[]),layers!=undefined&&OpenLayers.Util.isArray(layers))for(i=0,len=layers.length;i<len;i++)layer=layers[i],layer instanceof OpenLayers.Layer.WMS&&context.layersContext.push(this.layerToContext(layer));return context},CLASS_NAME:"OpenLayers.Format.WMC"});OpenLayers.Format.WMC.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ol:"http://openlayers.org/context",wmc:"http://www.opengis.net/context",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"",getNamespacePrefix:function(uri){var prefix=null;if(uri==null)prefix=this.namespaces[this.defaultPrefix];else for(prefix in this.namespaces)if(this.namespaces[prefix]==uri)break;return prefix},defaultPrefix:"wmc",rootPrefix:null,defaultStyleName:"",defaultStyleTitle:"Default",initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options])},read:function(data){var root,context;return typeof data=="string"&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data])),root=data.documentElement,this.rootPrefix=root.prefix,context={version:root.getAttribute("version")},this.runChildNodes(context,root),context},runChildNodes:function(obj,node){for(var children=node.childNodes,childNode,processor,prefix,local,i=0,len=children.length;i<len;++i)childNode=children[i],childNode.nodeType==1&&(prefix=this.getNamespacePrefix(childNode.namespaceURI),local=childNode.nodeName.split(":").pop(),processor=this["read_"+prefix+"_"+local],processor&&processor.apply(this,[obj,childNode]))},read_wmc_General:function(context,node){this.runChildNodes(context,node)},read_wmc_BoundingBox:function(context,node){context.projection=node.getAttribute("SRS");context.bounds=new OpenLayers.Bounds(node.getAttribute("minx"),node.getAttribute("miny"),node.getAttribute("maxx"),node.getAttribute("maxy"))},read_wmc_LayerList:function(context,node){context.layersContext=[];this.runChildNodes(context,node)},read_wmc_Layer:function(context,node){var layerContext={visibility:node.getAttribute("hidden")!="1",queryable:node.getAttribute("queryable")=="1",formats:[],styles:[],metadata:{}};this.runChildNodes(layerContext,node);context.layersContext.push(layerContext)},read_wmc_Extension:function(obj,node){this.runChildNodes(obj,node)},read_ol_units:function(layerContext,node){layerContext.units=this.getChildValue(node)},read_ol_maxExtent:function(obj,node){var bounds=new OpenLayers.Bounds(node.getAttribute("minx"),node.getAttribute("miny"),node.getAttribute("maxx"),node.getAttribute("maxy"));obj.maxExtent=bounds},read_ol_transparent:function(layerContext,node){layerContext.transparent=this.getChildValue(node)},read_ol_numZoomLevels:function(layerContext,node){layerContext.numZoomLevels=parseInt(this.getChildValue(node))},read_ol_opacity:function(layerContext,node){layerContext.opacity=parseFloat(this.getChildValue(node))},read_ol_singleTile:function(layerContext,node){layerContext.singleTile=this.getChildValue(node)=="true"},read_ol_tileSize:function(layerContext,node){var obj={width:node.getAttribute("width"),height:node.getAttribute("height")};layerContext.tileSize=obj},read_ol_isBaseLayer:function(layerContext,node){layerContext.isBaseLayer=this.getChildValue(node)=="true"},read_ol_displayInLayerSwitcher:function(layerContext,node){layerContext.displayInLayerSwitcher=this.getChildValue(node)=="true"},read_wmc_Server:function(layerContext,node){layerContext.version=node.getAttribute("version");layerContext.url=this.getOnlineResource_href(node);layerContext.metadata.servertitle=node.getAttribute("title")},read_wmc_FormatList:function(layerContext,node){this.runChildNodes(layerContext,node)},read_wmc_Format:function(layerContext,node){var format={value:this.getChildValue(node)};node.getAttribute("current")=="1"&&(format.current=!0);layerContext.formats.push(format)},read_wmc_StyleList:function(layerContext,node){this.runChildNodes(layerContext,node)},read_wmc_Style:function(layerContext,node){var style={};this.runChildNodes(style,node);node.getAttribute("current")=="1"&&(style.current=!0);layerContext.styles.push(style)},read_wmc_SLD:function(style,node){this.runChildNodes(style,node)},read_sld_StyledLayerDescriptor:function(sld,node){var xml=OpenLayers.Format.XML.prototype.write.apply(this,[node]);sld.body=xml},read_sld_FeatureTypeStyle:function(sld,node){var xml=OpenLayers.Format.XML.prototype.write.apply(this,[node]);sld.body=xml},read_wmc_OnlineResource:function(obj,node){obj.href=this.getAttributeNS(node,this.namespaces.xlink,"href")},read_wmc_Name:function(obj,node){var name=this.getChildValue(node);name&&(obj.name=name)},read_wmc_Title:function(obj,node){var title=this.getChildValue(node);title&&(obj.title=title)},read_wmc_MetadataURL:function(layerContext,node){layerContext.metadataURL=this.getOnlineResource_href(node)},read_wmc_KeywordList:function(context,node){context.keywords=[];this.runChildNodes(context.keywords,node)},read_wmc_Keyword:function(keywords,node){keywords.push(this.getChildValue(node))},read_wmc_Abstract:function(obj,node){var abst=this.getChildValue(node);abst&&(obj.abstract=abst)},read_wmc_LogoURL:function(context,node){context.logo={width:node.getAttribute("width"),height:node.getAttribute("height"),format:node.getAttribute("format"),href:this.getOnlineResource_href(node)}},read_wmc_DescriptionURL:function(context,node){context.descriptionURL=this.getOnlineResource_href(node)},read_wmc_ContactInformation:function(obj,node){var contact={};this.runChildNodes(contact,node);obj.contactInformation=contact},read_wmc_ContactPersonPrimary:function(contact,node){var personPrimary={};this.runChildNodes(personPrimary,node);contact.personPrimary=personPrimary},read_wmc_ContactPerson:function(primaryPerson,node){var person=this.getChildValue(node);person&&(primaryPerson.person=person)},read_wmc_ContactOrganization:function(primaryPerson,node){var organization=this.getChildValue(node);organization&&(primaryPerson.organization=organization)},read_wmc_ContactPosition:function(contact,node){var position=this.getChildValue(node);position&&(contact.position=position)},read_wmc_ContactAddress:function(contact,node){var contactAddress={};this.runChildNodes(contactAddress,node);contact.contactAddress=contactAddress},read_wmc_AddressType:function(contactAddress,node){var type=this.getChildValue(node);type&&(contactAddress.type=type)},read_wmc_Address:function(contactAddress,node){var address=this.getChildValue(node);address&&(contactAddress.address=address)},read_wmc_City:function(contactAddress,node){var city=this.getChildValue(node);city&&(contactAddress.city=city)},read_wmc_StateOrProvince:function(contactAddress,node){var stateOrProvince=this.getChildValue(node);stateOrProvince&&(contactAddress.stateOrProvince=stateOrProvince)},read_wmc_PostCode:function(contactAddress,node){var postcode=this.getChildValue(node);postcode&&(contactAddress.postcode=postcode)},read_wmc_Country:function(contactAddress,node){var country=this.getChildValue(node);country&&(contactAddress.country=country)},read_wmc_ContactVoiceTelephone:function(contact,node){var phone=this.getChildValue(node);phone&&(contact.phone=phone)},read_wmc_ContactFacsimileTelephone:function(contact,node){var fax=this.getChildValue(node);fax&&(contact.fax=fax)},read_wmc_ContactElectronicMailAddress:function(contact,node){var email=this.getChildValue(node);email&&(contact.email=email)},read_wmc_DataURL:function(layerContext,node){layerContext.dataURL=this.getOnlineResource_href(node)},read_wmc_LegendURL:function(style,node){var legend={width:node.getAttribute("width"),height:node.getAttribute("height"),format:node.getAttribute("format"),href:this.getOnlineResource_href(node)};style.legend=legend},read_wmc_DimensionList:function(layerContext,node){layerContext.dimensions={};this.runChildNodes(layerContext.dimensions,node)},read_wmc_Dimension:function(dimensions,node){var name=node.getAttribute("name").toLowerCase(),dim={name:name,units:node.getAttribute("units")||"",unitSymbol:node.getAttribute("unitSymbol")||"",userValue:node.getAttribute("userValue")||"",nearestValue:node.getAttribute("nearestValue")==="1",multipleValues:node.getAttribute("multipleValues")==="1",current:node.getAttribute("current")==="1","default":node.getAttribute("default")||""},values=this.getChildValue(node);dim.values=values.split(",");dimensions[dim.name]=dim},write:function(context,options){var root=this.createElementDefaultNS("ViewContext");return this.setAttributes(root,{version:this.VERSION,id:options&&typeof options.id=="string"?options.id:OpenLayers.Util.createUniqueID("OpenLayers_Context_")}),this.setAttributeNS(root,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),root.appendChild(this.write_wmc_General(context)),root.appendChild(this.write_wmc_LayerList(context)),OpenLayers.Format.XML.prototype.write.apply(this,[root])},createElementDefaultNS:function(name,childValue,attributes){var node=this.createElementNS(this.namespaces[this.defaultPrefix],name);return childValue&&node.appendChild(this.createTextNode(childValue)),attributes&&this.setAttributes(node,attributes),node},setAttributes:function(node,obj){var value;for(var name in obj)value=obj[name].toString(),value.match(/[A-Z]/)?this.setAttributeNS(node,null,name,value):node.setAttribute(name,value)},write_wmc_General:function(context){var node=this.createElementDefaultNS("General"),bounds;return context.size&&node.appendChild(this.createElementDefaultNS("Window",null,{width:context.size.w,height:context.size.h})),bounds=context.bounds,node.appendChild(this.createElementDefaultNS("BoundingBox",null,{minx:bounds.left.toPrecision(18),miny:bounds.bottom.toPrecision(18),maxx:bounds.right.toPrecision(18),maxy:bounds.top.toPrecision(18),SRS:context.projection})),node.appendChild(this.createElementDefaultNS("Title",context.title)),context.keywords&&node.appendChild(this.write_wmc_KeywordList(context.keywords)),context.abstract&&node.appendChild(this.createElementDefaultNS("Abstract",context.abstract)),context.logo&&node.appendChild(this.write_wmc_URLType("LogoURL",context.logo.href,context.logo)),context.descriptionURL&&node.appendChild(this.write_wmc_URLType("DescriptionURL",context.descriptionURL)),context.contactInformation&&node.appendChild(this.write_wmc_ContactInformation(context.contactInformation)),node.appendChild(this.write_ol_MapExtension(context)),node},write_wmc_KeywordList:function(keywords){for(var node=this.createElementDefaultNS("KeywordList"),i=0,len=keywords.length;i<len;i++)node.appendChild(this.createElementDefaultNS("Keyword",keywords[i]));return node},write_wmc_ContactInformation:function(contact){var node=this.createElementDefaultNS("ContactInformation");return contact.personPrimary&&node.appendChild(this.write_wmc_ContactPersonPrimary(contact.personPrimary)),contact.position&&node.appendChild(this.createElementDefaultNS("ContactPosition",contact.position)),contact.contactAddress&&node.appendChild(this.write_wmc_ContactAddress(contact.contactAddress)),contact.phone&&node.appendChild(this.createElementDefaultNS("ContactVoiceTelephone",contact.phone)),contact.fax&&node.appendChild(this.createElementDefaultNS("ContactFacsimileTelephone",contact.fax)),contact.email&&node.appendChild(this.createElementDefaultNS("ContactElectronicMailAddress",contact.email)),node},write_wmc_ContactPersonPrimary:function(personPrimary){var node=this.createElementDefaultNS("ContactPersonPrimary");return personPrimary.person&&node.appendChild(this.createElementDefaultNS("ContactPerson",personPrimary.person)),personPrimary.organization&&node.appendChild(this.createElementDefaultNS("ContactOrganization",personPrimary.organization)),node},write_wmc_ContactAddress:function(contactAddress){var node=this.createElementDefaultNS("ContactAddress");return contactAddress.type&&node.appendChild(this.createElementDefaultNS("AddressType",contactAddress.type)),contactAddress.address&&node.appendChild(this.createElementDefaultNS("Address",contactAddress.address)),contactAddress.city&&node.appendChild(this.createElementDefaultNS("City",contactAddress.city)),contactAddress.stateOrProvince&&node.appendChild(this.createElementDefaultNS("StateOrProvince",contactAddress.stateOrProvince)),contactAddress.postcode&&node.appendChild(this.createElementDefaultNS("PostCode",contactAddress.postcode)),contactAddress.country&&node.appendChild(this.createElementDefaultNS("Country",contactAddress.country)),node},write_ol_MapExtension:function(context){var node=this.createElementDefaultNS("Extension"),bounds=context.maxExtent,maxExtent;return bounds&&(maxExtent=this.createElementNS(this.namespaces.ol,"ol:maxExtent"),this.setAttributes(maxExtent,{minx:bounds.left.toPrecision(18),miny:bounds.bottom.toPrecision(18),maxx:bounds.right.toPrecision(18),maxy:bounds.top.toPrecision(18)}),node.appendChild(maxExtent)),node},write_wmc_LayerList:function(context){for(var list=this.createElementDefaultNS("LayerList"),i=0,len=context.layersContext.length;i<len;++i)list.appendChild(this.write_wmc_Layer(context.layersContext[i]));return list},write_wmc_Layer:function(context){var node=this.createElementDefaultNS("Layer",null,{queryable:context.queryable?"1":"0",hidden:context.visibility?"0":"1"});return node.appendChild(this.write_wmc_Server(context)),node.appendChild(this.createElementDefaultNS("Name",context.name)),node.appendChild(this.createElementDefaultNS("Title",context.title)),context.abstract&&node.appendChild(this.createElementDefaultNS("Abstract",context.abstract)),context.dataURL&&node.appendChild(this.write_wmc_URLType("DataURL",context.dataURL)),context.metadataURL&&node.appendChild(this.write_wmc_URLType("MetadataURL",context.metadataURL)),node},write_wmc_LayerExtension:function(context){var node=this.createElementDefaultNS("Extension"),bounds=context.maxExtent,maxExtent=this.createElementNS(this.namespaces.ol,"ol:maxExtent"),size,properties,child,i,len;for(this.setAttributes(maxExtent,{minx:bounds.left.toPrecision(18),miny:bounds.bottom.toPrecision(18),maxx:bounds.right.toPrecision(18),maxy:bounds.top.toPrecision(18)}),node.appendChild(maxExtent),context.tileSize&&!context.singleTile&&(size=this.createElementNS(this.namespaces.ol,"ol:tileSize"),this.setAttributes(size,context.tileSize),node.appendChild(size)),properties=["transparent","numZoomLevels","units","isBaseLayer","opacity","displayInLayerSwitcher","singleTile"],i=0,len=properties.length;i<len;++i)child=this.createOLPropertyNode(context,properties[i]),child&&node.appendChild(child);return node},createOLPropertyNode:function(obj,prop){var node=null;return obj[prop]!=null&&(node=this.createElementNS(this.namespaces.ol,"ol:"+prop),node.appendChild(this.createTextNode(obj[prop].toString()))),node},write_wmc_Server:function(context){var server=context.server,node=this.createElementDefaultNS("Server"),attributes={service:"OGC:WMS",version:server.version};return server.title&&(attributes.title=server.title),this.setAttributes(node,attributes),node.appendChild(this.write_wmc_OnlineResource(server.url)),node},write_wmc_URLType:function(elName,url,attr){var node=this.createElementDefaultNS(elName),optionalAttributes,i;if(node.appendChild(this.write_wmc_OnlineResource(url)),attr)for(optionalAttributes=["width","height","format"],i=0;i<optionalAttributes.length;i++)optionalAttributes[i]in attr&&node.setAttribute(optionalAttributes[i],attr[optionalAttributes[i]]);return node},write_wmc_DimensionList:function(context){var node=this.createElementDefaultNS("DimensionList"),dim,attributes,dimension,name,values;for(dim in context.dimensions){attributes={};dimension=context.dimensions[dim];for(name in dimension)attributes[name]=typeof dimension[name]=="boolean"?Number(dimension[name]):dimension[name];values="";attributes.values&&(values=attributes.values.join(","),delete attributes.values);node.appendChild(this.createElementDefaultNS("Dimension",values,attributes))}return node},write_wmc_FormatList:function(context){for(var format,node=this.createElementDefaultNS("FormatList"),i=0,len=context.formats.length;i<len;i++)format=context.formats[i],node.appendChild(this.createElementDefaultNS("Format",format.value,format.current&&format.current==!0?{current:"1"}:null));return node},write_wmc_StyleList:function(layer){var node=this.createElementDefaultNS("StyleList"),styles=layer.styles,sld,i,len,s,style,link,doc,imported;if(styles&&OpenLayers.Util.isArray(styles))for(i=0,len=styles.length;i<len;i++)s=styles[i],style=this.createElementDefaultNS("Style",null,s.current&&s.current==!0?{current:"1"}:null),s.href?(sld=this.createElementDefaultNS("SLD"),s.name&&sld.appendChild(this.createElementDefaultNS("Name",s.name)),s.title&&sld.appendChild(this.createElementDefaultNS("Title",s.title)),s.legend&&sld.appendChild(this.write_wmc_URLType("LegendURL",s.legend.href,s.legend)),link=this.write_wmc_OnlineResource(s.href),sld.appendChild(link),style.appendChild(sld)):s.body?(sld=this.createElementDefaultNS("SLD"),s.name&&sld.appendChild(this.createElementDefaultNS("Name",s.name)),s.title&&sld.appendChild(this.createElementDefaultNS("Title",s.title)),s.legend&&sld.appendChild(this.write_wmc_URLType("LegendURL",s.legend.href,s.legend)),doc=OpenLayers.Format.XML.prototype.read.apply(this,[s.body]),imported=doc.documentElement,sld.ownerDocument&&sld.ownerDocument.importNode&&(imported=sld.ownerDocument.importNode(imported,!0)),sld.appendChild(imported),style.appendChild(sld)):(style.appendChild(this.createElementDefaultNS("Name",s.name)),style.appendChild(this.createElementDefaultNS("Title",s.title)),s.abstract&&style.appendChild(this.createElementDefaultNS("Abstract",s.abstract)),s.legend&&style.appendChild(this.write_wmc_URLType("LegendURL",s.legend.href,s.legend))),node.appendChild(style);return node},write_wmc_OnlineResource:function(href){var node=this.createElementDefaultNS("OnlineResource");return this.setAttributeNS(node,this.namespaces.xlink,"xlink:type","simple"),this.setAttributeNS(node,this.namespaces.xlink,"xlink:href",href),node},getOnlineResource_href:function(node){var object={},links=node.getElementsByTagName("OnlineResource");return links.length>0&&this.read_wmc_OnlineResource(object,links[0]),object.href},CLASS_NAME:"OpenLayers.Format.WMC.v1"});OpenLayers.Format.WMC.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.1.0/context.xsd",initialize:function(options){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[options])},read_sld_MinScaleDenominator:function(layerContext,node){var minScaleDenominator=parseFloat(this.getChildValue(node));minScaleDenominator>0&&(layerContext.maxScale=minScaleDenominator)},read_sld_MaxScaleDenominator:function(layerContext,node){layerContext.minScale=parseFloat(this.getChildValue(node))},read_wmc_SRS:function(layerContext,node){"srs"in layerContext||(layerContext.srs={});layerContext.srs[this.getChildValue(node)]=!0},write_wmc_Layer:function(context){var node=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[context]),minSD,maxSD,name;if(context.maxScale&&(minSD=this.createElementNS(this.namespaces.sld,"sld:MinScaleDenominator"),minSD.appendChild(this.createTextNode(context.maxScale.toPrecision(16))),node.appendChild(minSD)),context.minScale&&(maxSD=this.createElementNS(this.namespaces.sld,"sld:MaxScaleDenominator"),maxSD.appendChild(this.createTextNode(context.minScale.toPrecision(16))),node.appendChild(maxSD)),context.srs)for(name in context.srs)node.appendChild(this.createElementDefaultNS("SRS",name));return node.appendChild(this.write_wmc_FormatList(context)),node.appendChild(this.write_wmc_StyleList(context)),context.dimensions&&node.appendChild(this.write_wmc_DimensionList(context)),node.appendChild(this.write_wmc_LayerExtension(context)),node},CLASS_NAME:"OpenLayers.Format.WMC.v1_1_0"});OpenLayers.Format.XLS=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",stringifyOutput:!0,CLASS_NAME:"OpenLayers.Format.XLS"});OpenLayers.Format.XLS.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xls:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},xy:!0,defaultPrefix:"xls",schemaLocation:null,read:function(data,options){options=OpenLayers.Util.applyDefaults(options,this.options);var xls={};return this.readChildNodes(data,xls),xls},readers:{xls:{XLS:function(node,xls){xls.version=node.getAttribute("version");this.readChildNodes(node,xls)},Response:function(node,xls){this.readChildNodes(node,xls)},GeocodeResponse:function(node,xls){xls.responseLists=[];this.readChildNodes(node,xls)},GeocodeResponseList:function(node,xls){var responseList={features:[],numberOfGeocodedAddresses:parseInt(node.getAttribute("numberOfGeocodedAddresses"))};xls.responseLists.push(responseList);this.readChildNodes(node,responseList)},GeocodedAddress:function(node,responseList){var feature=new OpenLayers.Feature.Vector;responseList.features.push(feature);this.readChildNodes(node,feature);feature.geometry=feature.components[0]},GeocodeMatchCode:function(node,feature){feature.attributes.matchCode={accuracy:parseFloat(node.getAttribute("accuracy")),matchType:node.getAttribute("matchType")}},Address:function(node,feature){var address={countryCode:node.getAttribute("countryCode"),addressee:node.getAttribute("addressee"),street:[],place:[]};feature.attributes.address=address;this.readChildNodes(node,address)},freeFormAddress:function(node,address){address.freeFormAddress=this.getChildValue(node)},StreetAddress:function(node,address){this.readChildNodes(node,address)},Building:function(node,address){address.building={number:node.getAttribute("number"),subdivision:node.getAttribute("subdivision"),buildingName:node.getAttribute("buildingName")}},Street:function(node,address){address.street.push(this.getChildValue(node))},Place:function(node,address){address.place[node.getAttribute("type")]=this.getChildValue(node)},PostalCode:function(node,address){address.postalCode=this.getChildValue(node)}},gml:OpenLayers.Format.GML.v3.prototype.readers.gml},write:function(request){return this.writers.xls.XLS.apply(this,[request])},writers:{xls:{XLS:function(request){var root=this.createElementNSPlus("xls:XLS",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});return this.writeNode("RequestHeader",request.header,root),this.writeNode("Request",request,root),root},RequestHeader:function(){return this.createElementNSPlus("xls:RequestHeader")},Request:function(request){var node=this.createElementNSPlus("xls:Request",{attributes:{methodName:"GeocodeRequest",requestID:request.requestID||"",version:this.VERSION}});return this.writeNode("GeocodeRequest",request.addresses,node),node},GeocodeRequest:function(addresses){for(var node=this.createElementNSPlus("xls:GeocodeRequest"),i=0,len=addresses.length;i<len;i++)this.writeNode("Address",addresses[i],node);return node},Address:function(address){var node=this.createElementNSPlus("xls:Address",{attributes:{countryCode:address.countryCode}});return address.freeFormAddress?this.writeNode("freeFormAddress",address.freeFormAddress,node):(address.street&&this.writeNode("StreetAddress",address,node),address.municipality&&this.writeNode("Municipality",address.municipality,node),address.countrySubdivision&&this.writeNode("CountrySubdivision",address.countrySubdivision,node),address.postalCode&&this.writeNode("PostalCode",address.postalCode,node)),node},freeFormAddress:function(freeFormAddress){return this.createElementNSPlus("freeFormAddress",{value:freeFormAddress})},StreetAddress:function(address){var node=this.createElementNSPlus("xls:StreetAddress"),street,i,len;for(address.building&&this.writeNode(node,"Building",address.building),street=address.street,OpenLayers.Util.isArray(street)||(street=[street]),i=0,len=street.length;i<len;i++)this.writeNode("Street",street[i],node);return node},Building:function(building){return this.createElementNSPlus("xls:Building",{attributes:{number:building.number,subdivision:building.subdivision,buildingName:building.buildingName}})},Street:function(street){return this.createElementNSPlus("xls:Street",{value:street})},Municipality:function(municipality){return this.createElementNSPlus("xls:Place",{attributes:{type:"Municipality"},value:municipality})},CountrySubdivision:function(countrySubdivision){return this.createElementNSPlus("xls:Place",{attributes:{type:"CountrySubdivision"},value:countrySubdivision})},PostalCode:function(postalCode){return this.createElementNSPlus("xls:PostalCode",{value:postalCode})}}},CLASS_NAME:"OpenLayers.Format.XLS.v1"});OpenLayers.Format.XLS.v1_1_0=OpenLayers.Class(OpenLayers.Format.XLS.v1,{VERSION:"1.1",schemaLocation:"http://www.opengis.net/xls http://schemas.opengis.net/ols/1.1.0/LocationUtilityService.xsd",CLASS_NAME:"OpenLayers.Format.XLS.v1_1_0"});OpenLayers.Format.XLS.v1_1=OpenLayers.Format.XLS.v1_1_0;OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15e3,translationParameters:null,symbolMetrics:null,initialize:function(){this.supported()&&(OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments),this.translationParameters={x:0,y:0},this.symbolMetrics={})},supported:function(){var svgFeature="http://www.w3.org/TR/SVG11/feature#";return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(svgFeature+"SVG","1.1")||document.implementation.hasFeature(svgFeature+"BasicStructure","1.1"))},inValidRange:function(x,y,xyOnly){var left=x+(xyOnly?0:this.translationParameters.x),top=y+(xyOnly?0:this.translationParameters.y);return left>=-this.MAX_PIXEL&&left<=this.MAX_PIXEL&&top>=-this.MAX_PIXEL&&top<=this.MAX_PIXEL},setExtent:function(extent,resolutionChanged){var coordSysUnchanged=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),resolution=this.getResolution(),left=-extent.left/resolution,top=extent.top/resolution,extentString,inRange;return resolutionChanged?(this.left=left,this.top=top,extentString="0 0 "+this.size.w+" "+this.size.h,this.rendererRoot.setAttributeNS(null,"viewBox",extentString),this.translate(this.xOffset,0),!0):(inRange=this.translate(left-this.left+this.xOffset,top-this.top),inRange||this.setExtent(extent,!0),coordSysUnchanged&&inRange)},translate:function(x,y){if(this.inValidRange(x,y,!0)){var transformString="";return(x||y)&&(transformString="translate("+x+","+y+")"),this.root.setAttributeNS(null,"transform",transformString),this.translationParameters={x:x,y:y},!0}return!1},setSize:function(){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);this.rendererRoot.setAttributeNS(null,"width",this.size.w);this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(geometry,style){var nodeType=null;switch(geometry.CLASS_NAME){case"OpenLayers.Geometry.Point":nodeType=style.externalGraphic?"image":this.isComplexSymbol(style.graphicName)?"svg":"circle";break;case"OpenLayers.Geometry.Rectangle":nodeType="rect";break;case"OpenLayers.Geometry.LineString":nodeType="polyline";break;case"OpenLayers.Geometry.LinearRing":nodeType="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":nodeType="path"}return nodeType},setStyle:function(node,style,options){var title,titleNode,label,r,widthFactor,pos,width,height,parent,nextSibling,rotation,metrics,pid;if(style=style||node._style,options=options||node._options,title=style.title||style.graphicTitle,title&&(node.setAttributeNS(null,"title",title),titleNode=node.getElementsByTagName("title"),titleNode.length>0?titleNode[0].firstChild.textContent=title:(label=this.nodeFactory(null,"title"),label.textContent=title,node.appendChild(label))),r=parseFloat(node.getAttributeNS(null,"r")),widthFactor=1,node._geometryClass=="OpenLayers.Geometry.Point"&&r){if(node.style.visibility="",style.graphic===!1)node.style.visibility="hidden";else if(style.externalGraphic){pos=this.getPosition(node);style.graphicWidth&&style.graphicHeight&&node.setAttributeNS(null,"preserveAspectRatio","none");width=style.graphicWidth||style.graphicHeight;height=style.graphicHeight||style.graphicWidth;width=width?width:style.pointRadius*2;height=height?height:style.pointRadius*2;var xOffset=style.graphicXOffset!=undefined?style.graphicXOffset:-(.5*width),yOffset=style.graphicYOffset!=undefined?style.graphicYOffset:-(.5*height),opacity=style.graphicOpacity||style.fillOpacity;node.setAttributeNS(null,"x",(pos.x+xOffset).toFixed());node.setAttributeNS(null,"y",(pos.y+yOffset).toFixed());node.setAttributeNS(null,"width",width);node.setAttributeNS(null,"height",height);node.setAttributeNS(this.xlinkns,"xlink:href",style.externalGraphic);node.setAttributeNS(null,"style","opacity: "+opacity);node.onclick=OpenLayers.Event.preventDefault}else if(this.isComplexSymbol(style.graphicName)){var offset=style.pointRadius*3,size=offset*2,src=this.importSymbol(style.graphicName);pos=this.getPosition(node);widthFactor=this.symbolMetrics[src.id][0]*3/size;parent=node.parentNode;nextSibling=node.nextSibling;parent&&parent.removeChild(node);node.firstChild&&node.removeChild(node.firstChild);node.appendChild(src.firstChild.cloneNode(!0));node.setAttributeNS(null,"viewBox",src.getAttributeNS(null,"viewBox"));node.setAttributeNS(null,"width",size);node.setAttributeNS(null,"height",size);node.setAttributeNS(null,"x",pos.x-offset);node.setAttributeNS(null,"y",pos.y-offset);nextSibling?parent.insertBefore(node,nextSibling):parent&&parent.appendChild(node)}else node.setAttributeNS(null,"r",style.pointRadius);rotation=style.rotation;(rotation!==undefined||node._rotation!==undefined)&&pos&&(node._rotation=rotation,rotation|=0,node.nodeName!=="svg"?node.setAttributeNS(null,"transform","rotate("+rotation+" "+pos.x+" "+pos.y+")"):(metrics=this.symbolMetrics[src.id],node.firstChild.setAttributeNS(null,"transform","rotate("+rotation+" "+metrics[1]+" "+metrics[2]+")")))}return options.isFilled?style.externalGraphic?(pid=this.createImagePattern(style),node.setAttributeNS(null,"fill","url(#"+pid+")"),node.setAttributeNS(null,"fill-opacity",1)):style.graphicName&&node._geometryClass!=="OpenLayers.Geometry.Point"?OpenLayers.Console.error("WellKnownName is not yet supported as GraphicFill by the SVG renderer!"):(node.setAttributeNS(null,"fill",style.fillColor),node.setAttributeNS(null,"fill-opacity",style.fillOpacity)):node.setAttributeNS(null,"fill","none"),options.isStroked?(node.setAttributeNS(null,"stroke",style.strokeColor),node.setAttributeNS(null,"stroke-opacity",style.strokeOpacity),node.setAttributeNS(null,"stroke-width",style.strokeWidth*widthFactor),node.setAttributeNS(null,"stroke-linecap",style.strokeLinecap||"round"),node.setAttributeNS(null,"stroke-linejoin","round"),style.strokeDashstyle&&node.setAttributeNS(null,"stroke-dasharray",this.dashStyle(style,widthFactor))):node.setAttributeNS(null,"stroke","none"),style.pointerEvents&&node.setAttributeNS(null,"pointer-events",style.pointerEvents),style.cursor!=null&&node.setAttributeNS(null,"cursor",style.cursor),node},dashStyle:function(style,widthFactor){var w=style.strokeWidth*widthFactor,str=style.strokeDashstyle;switch(str){case"solid":return"none";case"dot":return[1,4*w].join();case"dash":return[4*w,4*w].join();case"dashdot":return[4*w,4*w,1,4*w].join();case"longdash":return[8*w,4*w].join();case"longdashdot":return[8*w,4*w,1,4*w].join();default:return OpenLayers.String.trim(str).replace(/\s+/g,",")}},createNode:function(type,id){var node=document.createElementNS(this.xmlns,type);return id&&node.setAttributeNS(null,"id",id),node},nodeTypeCompare:function(node,type){return type==node.nodeName},createRenderRoot:function(){var svg=this.nodeFactory(this.container.id+"_svgRoot","svg");return svg.style.display="block",svg},createRoot:function(suffix){return this.nodeFactory(this.container.id+suffix,"g")},createDefs:function(){var defs=this.nodeFactory(this.container.id+"_defs","defs");return this.rendererRoot.appendChild(defs),defs},createImagePattern:function(style){var id=this.container.id+"-"+style.externalGraphic+(style.pointRadius?"-"+style.pointRadius:""),patternNode=OpenLayers.Util.getElement(id),img;return patternNode||(img=new Image,img.onload=OpenLayers.Function.bind(function(){var height,width,aspect,imageNode,rotation;this.defs||(this.defs=this.createDefs());height=img.height*72/96;width=img.width*72/96;style.pointRadius&&(aspect=width/height,height=style.pointRadius*144/96,width=height*aspect);height=height+"pt";width=width+"pt";patternNode=this.nodeFactory(id,"pattern");patternNode.setAttributeNS(null,"x","0");patternNode.setAttributeNS(null,"y","0");patternNode.setAttributeNS(null,"height",height);patternNode.setAttributeNS(null,"width",width);patternNode.setAttributeNS(null,"patternUnits","userSpaceOnUse");imageNode=this.nodeFactory(null,"image");patternNode.appendChild(imageNode);imageNode.setAttributeNS(this.xlinkns,"href",style.externalGraphic);imageNode.setAttributeNS(null,"height",height);imageNode.setAttributeNS(null,"width",width);imageNode.setAttributeNS(null,"style","opacity: "+(style.graphicOpacity||style.fillOpacity||1));typeof style.rotation!="undefined"&&(rotation=OpenLayers.String.format("rotate(${0})",[style.rotation]),imageNode.setAttributeNS(null,"transform",rotation));this.defs.appendChild(patternNode)},this),img.src=style.externalGraphic),id},drawPoint:function(node,geometry){return this.drawCircle(node,geometry,1)},drawCircle:function(node,geometry,radius){var resolution=this.getResolution(),x=(geometry.x-this.featureDx)/resolution+this.left,y=this.top-geometry.y/resolution;return this.inValidRange(x,y)?(node.setAttributeNS(null,"cx",x),node.setAttributeNS(null,"cy",y),node.setAttributeNS(null,"r",radius),node):!1},drawLineString:function(node,geometry){var componentsResult=this.getComponentsString(geometry.components);return componentsResult.path?(node.setAttributeNS(null,"points",componentsResult.path),componentsResult.complete?node:null):!1},drawLinearRing:function(node,geometry){var componentsResult=this.getComponentsString(geometry.components);return componentsResult.path?(node.setAttributeNS(null,"points",componentsResult.path),componentsResult.complete?node:null):!1},drawPolygon:function(node,geometry){for(var d="",draw=!0,complete=!0,linearRingResult,path,j=0,len=geometry.components.length;j<len;j++)d+=" M",linearRingResult=this.getComponentsString(geometry.components[j].components," "),path=linearRingResult.path,path?(d+=" "+path,complete=linearRingResult.complete&&complete):draw=!1;return d+=" z",draw?(node.setAttributeNS(null,"d",d),node.setAttributeNS(null,"fill-rule","evenodd"),complete?node:null):!1},drawRectangle:function(node,geometry){var resolution=this.getResolution(),x=(geometry.x-this.featureDx)/resolution+this.left,y=this.top-geometry.y/resolution;return this.inValidRange(x,y)?(node.setAttributeNS(null,"x",x),node.setAttributeNS(null,"y",y),node.setAttributeNS(null,"width",geometry.width/resolution),node.setAttributeNS(null,"height",geometry.height/resolution),node):!1},drawText:function(featureId,style,location){var drawOutline=!!style.labelOutlineWidth,outlineStyle,align,labelRows,numRows,i,tspan,vfactor;drawOutline&&(outlineStyle=OpenLayers.Util.extend({},style),outlineStyle.fontColor=outlineStyle.labelOutlineColor,outlineStyle.fontStrokeColor=outlineStyle.labelOutlineColor,outlineStyle.fontStrokeWidth=style.labelOutlineWidth,delete outlineStyle.labelOutlineWidth,this.drawText(featureId,outlineStyle,location));var resolution=this.getResolution(),x=(location.x-this.featureDx)/resolution+this.left,y=location.y/resolution-this.top,suffix=drawOutline?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,label=this.nodeFactory(featureId+suffix,"text");for(label.setAttributeNS(null,"x",x),label.setAttributeNS(null,"y",-y),style.fontColor&&label.setAttributeNS(null,"fill",style.fontColor),style.fontStrokeColor&&label.setAttributeNS(null,"stroke",style.fontStrokeColor),style.fontStrokeWidth&&label.setAttributeNS(null,"stroke-width",style.fontStrokeWidth),style.fontOpacity&&label.setAttributeNS(null,"opacity",style.fontOpacity),style.fontFamily&&label.setAttributeNS(null,"font-family",style.fontFamily),style.fontSize&&label.setAttributeNS(null,"font-size",style.fontSize),style.fontWeight&&label.setAttributeNS(null,"font-weight",style.fontWeight),style.fontStyle&&label.setAttributeNS(null,"font-style",style.fontStyle),style.labelSelect===!0?(label.setAttributeNS(null,"pointer-events","visible"),label._featureId=featureId):label.setAttributeNS(null,"pointer-events","none"),align=style.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign,label.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[align[0]]||"middle"),OpenLayers.IS_GECKO===!0&&label.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[align[1]]||"central"),labelRows=style.label.split("\n"),numRows=labelRows.length;label.childNodes.length>numRows;)label.removeChild(label.lastChild);for(i=0;i<numRows;i++)tspan=this.nodeFactory(featureId+suffix+"_tspan_"+i,"tspan"),style.labelSelect===!0&&(tspan._featureId=featureId,tspan._geometry=location,tspan._geometryClass=location.CLASS_NAME),OpenLayers.IS_GECKO===!1&&tspan.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[align[1]]||"-35%"),tspan.setAttribute("x",x),i==0?(vfactor=OpenLayers.Renderer.SVG.LABEL_VFACTOR[align[1]],vfactor==null&&(vfactor=-.5),tspan.setAttribute("dy",vfactor*(numRows-1)+"em")):tspan.setAttribute("dy","1em"),tspan.textContent=labelRows[i]===""?" ":labelRows[i],tspan.parentNode||label.appendChild(tspan);label.parentNode||this.textRoot.appendChild(label)},getComponentsString:function(components,separator){for(var renderCmp=[],complete=!0,len=components.length,strings=[],str,component,i=0;i<len;i++)component=components[i],renderCmp.push(component),str=this.getShortString(component),str?strings.push(str):(i>0&&this.getShortString(components[i-1])&&strings.push(this.clipLine(components[i],components[i-1])),i<len-1&&this.getShortString(components[i+1])&&strings.push(this.clipLine(components[i],components[i+1])),complete=!1);return{path:strings.join(separator||","),complete:complete}},clipLine:function(badComponent,goodComponent){if(goodComponent.equals(badComponent))return"";var resolution=this.getResolution(),maxX=this.MAX_PIXEL-this.translationParameters.x,maxY=this.MAX_PIXEL-this.translationParameters.y,x1=(goodComponent.x-this.featureDx)/resolution+this.left,y1=this.top-goodComponent.y/resolution,x2=(badComponent.x-this.featureDx)/resolution+this.left,y2=this.top-badComponent.y/resolution,k;return(x2<-maxX||x2>maxX)&&(k=(y2-y1)/(x2-x1),x2=x2<0?-maxX:maxX,y2=y1+(x2-x1)*k),(y2<-maxY||y2>maxY)&&(k=(x2-x1)/(y2-y1),y2=y2<0?-maxY:maxY,x2=x1+(y2-y1)*k),x2+","+y2},getShortString:function(point){var resolution=this.getResolution(),x=(point.x-this.featureDx)/resolution+this.left,y=this.top-point.y/resolution;return this.inValidRange(x,y)?x+","+y:!1},getPosition:function(node){return{x:parseFloat(node.getAttributeNS(null,"cx")),y:parseFloat(node.getAttributeNS(null,"cy"))}},importSymbol:function(graphicName){var id,existing,symbol,symbolNode,node,symbolExtent,points,x,y,i;if(this.defs||(this.defs=this.createDefs()),id=this.container.id+"-"+graphicName,existing=document.getElementById(id),existing!=null)return existing;if(symbol=OpenLayers.Renderer.symbol[graphicName],!symbol)throw new Error(graphicName+" is not a valid symbol name");for(symbolNode=this.nodeFactory(id,"symbol"),node=this.nodeFactory(null,"polygon"),symbolNode.appendChild(node),symbolExtent=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),points=[],i=0;i<symbol.length;i=i+2)x=symbol[i],y=symbol[i+1],symbolExtent.left=Math.min(symbolExtent.left,x),symbolExtent.bottom=Math.min(symbolExtent.bottom,y),symbolExtent.right=Math.max(symbolExtent.right,x),symbolExtent.top=Math.max(symbolExtent.top,y),points.push(x,",",y);node.setAttributeNS(null,"points",points.join(" "));var width=symbolExtent.getWidth(),height=symbolExtent.getHeight(),viewBox=[symbolExtent.left-width,symbolExtent.bottom-height,width*3,height*3];return symbolNode.setAttributeNS(null,"viewBox",viewBox.join(" ")),this.symbolMetrics[id]=[Math.max(width,height),symbolExtent.getCenterLonLat().lon,symbolExtent.getCenterLonLat().lat],this.defs.appendChild(symbolNode),symbolNode},getFeatureIdFromEvent:function(evt){var featureId=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments),target;return featureId||(target=evt.target,featureId=target.parentNode&&target!=this.rendererRoot?target.parentNode._featureId:undefined),featureId},CLASS_NAME:"OpenLayers.Renderer.SVG"});OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"};OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"};OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1};OpenLayers.Renderer.SVG.preventDefault=function(e){OpenLayers.Event.preventDefault(e)};OpenLayers.Format.WMSDescribeLayer=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer"});OpenLayers.Format.WMSDescribeLayer.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSDescribeLayer,{initialize:function(options){OpenLayers.Format.WMSDescribeLayer.prototype.initialize.apply(this,[options])},read:function(data){var i,query,layerDescription,parser;typeof data=="string"&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data]));var root=data.documentElement,children=root.childNodes,describelayer={layerDescriptions:[]},childNode,nodeName;for(i=0;i<children.length;++i)if(childNode=children[i],nodeName=childNode.nodeName,nodeName=="LayerDescription"){var layerName=childNode.getAttribute("name"),owsType="",owsURL="",typeName="";childNode.getAttribute("owsType")?(owsType=childNode.getAttribute("owsType"),owsURL=childNode.getAttribute("owsURL")):childNode.getAttribute("wfs")!=""?(owsType="WFS",owsURL=childNode.getAttribute("wfs")):childNode.getAttribute("wcs")!=""&&(owsType="WCS",owsURL=childNode.getAttribute("wcs"));query=childNode.getElementsByTagName("Query");query.length>0&&(typeName=query[0].getAttribute("typeName"),typeName||(typeName=query[0].getAttribute("typename")));layerDescription={layerName:layerName,owsType:owsType,owsURL:owsURL,typeName:typeName};describelayer.layerDescriptions.push(layerDescription);describelayer.length=describelayer.layerDescriptions.length;describelayer[describelayer.length-1]=layerDescription}else if(nodeName=="ServiceException")return parser=new OpenLayers.Format.OGCExceptionReport,{error:parser.read(data)};return describelayer},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer.v1_1_1"});OpenLayers.Format.WMSDescribeLayer.v1_1_0=OpenLayers.Format.WMSDescribeLayer.v1_1_1;OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:!1,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:!1,fixPadding:function(){typeof this.padding=="number"&&(this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding))},panMapIfOutOfView:!1,keepInMap:!1,closeOnMove:!1,map:null,initialize:function(id,lonlat,contentSize,contentHTML,closeBox,closeBoxCallback){var groupDivId,id;id==null&&(id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"));this.id=id;this.lonlat=lonlat;this.contentSize=contentSize!=null?contentSize:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT);contentHTML!=null&&(this.contentHTML=contentHTML);this.backgroundColor=OpenLayers.Popup.COLOR;this.opacity=OpenLayers.Popup.OPACITY;this.border=OpenLayers.Popup.BORDER;this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden");this.div.className=this.displayClass;groupDivId=this.id+"_GroupDiv";this.groupDiv=OpenLayers.Util.createDiv(groupDivId,null,null,null,"relative",null,"hidden");id=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(id,null,this.contentSize.clone(),null,"relative");this.contentDiv.className=this.contentDisplayClass;this.groupDiv.appendChild(this.contentDiv);this.div.appendChild(this.groupDiv);closeBox&&this.addCloseBox(closeBoxCallback);this.registerEvents()},destroy:function(){this.id=null;this.lonlat=null;this.size=null;this.contentHTML=null;this.backgroundColor=null;this.opacity=null;this.border=null;this.closeOnMove&&this.map&&this.map.events.unregister("movestart",this,this.hide);this.events.destroy();this.events=null;this.closeDiv&&(OpenLayers.Event.stopObservingElement(this.closeDiv),this.groupDiv.removeChild(this.closeDiv));this.closeDiv=null;this.div.removeChild(this.groupDiv);this.groupDiv=null;this.map!=null&&this.map.removePopup(this);this.map=null;this.div=null;this.autoSize=null;this.minSize=null;this.maxSize=null;this.padding=null;this.panMapIfOutOfView=null},draw:function(px){return px==null&&this.lonlat!=null&&this.map!=null&&(px=this.map.getLayerPxFromLonLat(this.lonlat)),this.closeOnMove&&this.map.events.register("movestart",this,this.hide),this.disableFirefoxOverflowHack||OpenLayers.BROWSER_NAME!="firefox"||(this.map.events.register("movestart",this,function(){var style=document.defaultView.getComputedStyle(this.contentDiv,null),currentOverflow=style.getPropertyValue("overflow");currentOverflow!="hidden"&&(this.contentDiv._oldOverflow=currentOverflow,this.contentDiv.style.overflow="hidden")}),this.map.events.register("moveend",this,function(){var oldOverflow=this.contentDiv._oldOverflow;oldOverflow&&(this.contentDiv.style.overflow=oldOverflow,this.contentDiv._oldOverflow=null)})),this.moveTo(px),this.autoSize||this.size||this.setSize(this.contentSize),this.setBackgroundColor(),this.setOpacity(),this.setBorder(),this.setContentHTML(),this.panMapIfOutOfView&&this.panIntoView(),this.div},updatePosition:function(){if(this.lonlat&&this.map){var px=this.map.getLayerPxFromLonLat(this.lonlat);px&&this.moveTo(px)}},moveTo:function(px){px!=null&&this.div!=null&&(this.div.style.left=px.x+"px",this.div.style.top=px.y+"px")},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){this.visible()?this.hide():this.show()},show:function(){this.div.style.display="";this.panMapIfOutOfView&&this.panIntoView()},hide:function(){this.div.style.display="none"},setSize:function(contentSize){var closeDivWidth;this.size=contentSize.clone();var contentDivPadding=this.getContentDivPadding(),wPadding=contentDivPadding.left+contentDivPadding.right,hPadding=contentDivPadding.top+contentDivPadding.bottom;this.fixPadding();wPadding+=this.padding.left+this.padding.right;hPadding+=this.padding.top+this.padding.bottom;this.closeDiv&&(closeDivWidth=parseInt(this.closeDiv.style.width),wPadding+=closeDivWidth+contentDivPadding.right);this.size.w+=wPadding;this.size.h+=hPadding;OpenLayers.BROWSER_NAME=="msie"&&(this.contentSize.w+=contentDivPadding.left+contentDivPadding.right,this.contentSize.h+=contentDivPadding.bottom+contentDivPadding.top);this.div!=null&&(this.div.style.width=this.size.w+"px",this.div.style.height=this.size.h+"px");this.contentDiv!=null&&(this.contentDiv.style.width=contentSize.w+"px",this.contentDiv.style.height=contentSize.h+"px")},updateSize:function(){var preparedHTML="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"<\/div>",containerElement=this.map?this.map.div:document.body,realSize=OpenLayers.Util.getRenderedDimensions(preparedHTML,null,{displayClass:this.displayClass,containerElement:containerElement}),safeSize=this.getSafeContentSize(realSize),newSize=null,fixedSize,clippedSize,currentOverflow,scrollBar;safeSize.equals(realSize)?newSize=realSize:(fixedSize={w:safeSize.w<realSize.w?safeSize.w:null,h:safeSize.h<realSize.h?safeSize.h:null},fixedSize.w&&fixedSize.h?newSize=safeSize:(clippedSize=OpenLayers.Util.getRenderedDimensions(preparedHTML,fixedSize,{displayClass:this.contentDisplayClass,containerElement:containerElement}),currentOverflow=OpenLayers.Element.getStyle(this.contentDiv,"overflow"),currentOverflow!="hidden"&&clippedSize.equals(safeSize)&&(scrollBar=OpenLayers.Util.getScrollbarWidth(),fixedSize.w?clippedSize.h+=scrollBar:clippedSize.w+=scrollBar),newSize=this.getSafeContentSize(clippedSize)));this.setSize(newSize)},setBackgroundColor:function(color){color!=undefined&&(this.backgroundColor=color);this.div!=null&&(this.div.style.backgroundColor=this.backgroundColor)},setOpacity:function(opacity){opacity!=undefined&&(this.opacity=opacity);this.div!=null&&(this.div.style.opacity=this.opacity,this.div.style.filter="alpha(opacity="+this.opacity*100+")")},setBorder:function(border){border!=undefined&&(this.border=border);this.div!=null&&(this.div.style.border=this.border)},setContentHTML:function(contentHTML){contentHTML!=null&&(this.contentHTML=contentHTML);this.contentDiv!=null&&this.contentHTML!=null&&this.contentHTML!=this.contentDiv.innerHTML&&(this.contentDiv.innerHTML=this.contentHTML,this.autoSize&&(this.registerImageListeners(),this.updateSize()))},registerImageListeners:function(){for(var img,context,onImgLoad=function(){this.popup.id!==null&&(this.popup.updateSize(),this.popup.visible()&&this.popup.panMapIfOutOfView&&this.popup.panIntoView(),OpenLayers.Event.stopObserving(this.img,"load",this.img._onImgLoad))},images=this.contentDiv.getElementsByTagName("img"),i=0,len=images.length;i<len;i++)img=images[i],(img.width==0||img.height==0)&&(context={popup:this,img:img},img._onImgLoad=OpenLayers.Function.bind(onImgLoad,context),OpenLayers.Event.observe(img,"load",img._onImgLoad))},getSafeContentSize:function(size){var safeContentSize=size.clone(),contentDivPadding=this.getContentDivPadding(),wPadding=contentDivPadding.left+contentDivPadding.right,hPadding=contentDivPadding.top+contentDivPadding.bottom,closeDivWidth,extraX,extraY,px,maxY,maxX;if(this.fixPadding(),wPadding+=this.padding.left+this.padding.right,hPadding+=this.padding.top+this.padding.bottom,this.closeDiv&&(closeDivWidth=parseInt(this.closeDiv.style.width),wPadding+=closeDivWidth+contentDivPadding.right),this.minSize&&(safeContentSize.w=Math.max(safeContentSize.w,this.minSize.w-wPadding),safeContentSize.h=Math.max(safeContentSize.h,this.minSize.h-hPadding)),this.maxSize&&(safeContentSize.w=Math.min(safeContentSize.w,this.maxSize.w-wPadding),safeContentSize.h=Math.min(safeContentSize.h,this.maxSize.h-hPadding)),this.map&&this.map.size){if(extraX=0,extraY=0,this.keepInMap&&!this.panMapIfOutOfView){px=this.map.getPixelFromLonLat(this.lonlat);switch(this.relativePosition){case"tr":extraX=px.x;extraY=this.map.size.h-px.y;break;case"tl":extraX=this.map.size.w-px.x;extraY=this.map.size.h-px.y;break;case"bl":extraX=this.map.size.w-px.x;extraY=px.y;break;case"br":extraX=px.x;extraY=px.y;break;default:extraX=px.x;extraY=this.map.size.h-px.y}}maxY=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-hPadding-extraY;maxX=this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-wPadding-extraX;safeContentSize.w=Math.min(safeContentSize.w,maxX);safeContentSize.h=Math.min(safeContentSize.h,maxY)}return safeContentSize},getContentDivPadding:function(){var contentDivPadding=this._contentDivPadding;return contentDivPadding||(this.div.parentNode==null&&(this.div.style.display="none",document.body.appendChild(this.div)),contentDivPadding=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top")),this._contentDivPadding=contentDivPadding,this.div.parentNode==document.body&&(document.body.removeChild(this.div),this.div.style.display="")),contentDivPadding},addCloseBox:function(callback){var contentDivPadding,closePopup;this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,{w:17,h:17});this.closeDiv.className="olPopupCloseBox";contentDivPadding=this.getContentDivPadding();this.closeDiv.style.right=contentDivPadding.right+"px";this.closeDiv.style.top=contentDivPadding.top+"px";this.groupDiv.appendChild(this.closeDiv);closePopup=callback||function(e){this.hide();OpenLayers.Event.stop(e)};OpenLayers.Event.observe(this.closeDiv,"touchend",OpenLayers.Function.bindAsEventListener(closePopup,this));OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(closePopup,this))},panIntoView:function(){var mapSize=this.map.getSize(),origTL=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top))),newTL=origTL.clone(),dx,dy;origTL.x<this.map.paddingForPopups.left?newTL.x=this.map.paddingForPopups.left:origTL.x+this.size.w>mapSize.w-this.map.paddingForPopups.right&&(newTL.x=mapSize.w-this.map.paddingForPopups.right-this.size.w);origTL.y<this.map.paddingForPopups.top?newTL.y=this.map.paddingForPopups.top:origTL.y+this.size.h>mapSize.h-this.map.paddingForPopups.bottom&&(newTL.y=mapSize.h-this.map.paddingForPopups.bottom-this.size.h);dx=origTL.x-newTL.x;dy=origTL.y-newTL.y;this.map.pan(dx,dy)},registerEvents:function(){function onTouchstart(evt){OpenLayers.Event.stop(evt,!0)}this.events=new OpenLayers.Events(this,this.div,null,!0);this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,touchstart:onTouchstart,scope:this})},onmousedown:function(evt){this.mousedown=!0;OpenLayers.Event.stop(evt,!0)},onmousemove:function(evt){this.mousedown&&OpenLayers.Event.stop(evt,!0)},onmouseup:function(evt){this.mousedown&&(this.mousedown=!1,OpenLayers.Event.stop(evt,!0))},onclick:function(evt){OpenLayers.Event.stop(evt,!0)},onmouseout:function(){this.mousedown=!1},ondblclick:function(evt){OpenLayers.Event.stop(evt,!0)},CLASS_NAME:"OpenLayers.Popup"});OpenLayers.Popup.WIDTH=200;OpenLayers.Popup.HEIGHT=200;OpenLayers.Popup.COLOR="white";OpenLayers.Popup.OPACITY=1;OpenLayers.Popup.BORDER="0px";OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:!1,draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),!this.eTop){this.eTop=document.createElement("div");this.eTop.className=this.displayClass+"Top";var theLen=this.topInUnits.length;this.div.appendChild(this.eTop);this.eTop.style.visibility=this.topOutUnits==""||this.topInUnits==""?"hidden":"visible";this.eBottom=document.createElement("div");this.eBottom.className=this.displayClass+"Bottom";this.div.appendChild(this.eBottom);this.eBottom.style.visibility=this.bottomOutUnits==""||this.bottomInUnits==""?"hidden":"visible"}return this.map.events.register("moveend",this,this.update),this.update(),this.div},getBarLen:function(maxLen){var digits=parseInt(Math.log(maxLen)/Math.log(10)),pow10=Math.pow(10,digits),firstChar=parseInt(maxLen/pow10),barLen;return barLen=firstChar>5?5:firstChar>2?2:1,barLen*pow10},update:function(){var res=this.map.getResolution(),maxSizeGeodesic,maxSizeKilometers,topUnits,bottomUnits,topPx,bottomPx;if(res){var curMapUnits=this.map.getUnits(),inches=OpenLayers.INCHES_PER_UNIT,maxSizeData=this.maxWidth*res*inches[curMapUnits],geodesicRatio=1;this.geodesic===!0&&(maxSizeGeodesic=(this.map.getGeodesicPixelSize().w||1e-6)*this.maxWidth,maxSizeKilometers=maxSizeData/inches.km,geodesicRatio=maxSizeGeodesic/maxSizeKilometers,maxSizeData*=geodesicRatio);maxSizeData>1e5?(topUnits=this.topOutUnits,bottomUnits=this.bottomOutUnits):(topUnits=this.topInUnits,bottomUnits=this.bottomInUnits);var topMax=maxSizeData/inches[topUnits],bottomMax=maxSizeData/inches[bottomUnits],topRounded=this.getBarLen(topMax),bottomRounded=this.getBarLen(bottomMax);topMax=topRounded/inches[curMapUnits]*inches[topUnits];bottomMax=bottomRounded/inches[curMapUnits]*inches[bottomUnits];topPx=topMax/res/geodesicRatio;bottomPx=bottomMax/res/geodesicRatio;this.eBottom.style.visibility=="visible"&&(this.eBottom.style.width=Math.round(bottomPx)+"px",this.eBottom.innerHTML=bottomRounded+" "+bottomUnits);this.eTop.style.visibility=="visible"&&(this.eTop.style.width=Math.round(topPx)+"px",this.eTop.innerHTML=topRounded+" "+topUnits)}},CLASS_NAME:"OpenLayers.Control.ScaleLine"});OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(url,size,offset,calculateOffset){this.url=url;this.size=size||{w:20,h:20};this.offset=offset||{x:-(this.size.w/2),y:-(this.size.h/2)};this.calculateOffset=calculateOffset;var id=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(id)},destroy:function(){this.erase();OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild);this.imageDiv.innerHTML="";this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(size){size!=null&&(this.size=size);this.draw()},setUrl:function(url){url!=null&&(this.url=url);this.draw()},draw:function(px){return OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute"),this.moveTo(px),this.imageDiv},erase:function(){this.imageDiv!=null&&this.imageDiv.parentNode!=null&&OpenLayers.Element.remove(this.imageDiv)},setOpacity:function(opacity){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,opacity)},moveTo:function(px){px!=null&&(this.px=px);this.imageDiv!=null&&(this.px==null?this.display(!1):(this.calculateOffset&&(this.offset=this.calculateOffset(this.size)),OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,{x:this.px.x+this.offset.x,y:this.px.y+this.offset.y})))},display:function(display){this.imageDiv.style.display=display?"":"none"},isDrawn:function(){return this.imageDiv&&this.imageDiv.parentNode&&this.imageDiv.parentNode.nodeType!=11},CLASS_NAME:"OpenLayers.Icon"});OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(lonlat,icon){this.lonlat=lonlat;var newIcon=icon?icon:OpenLayers.Marker.defaultIcon();this.icon==null?this.icon=newIcon:(this.icon.url=newIcon.url,this.icon.size=newIcon.size,this.icon.offset=newIcon.offset,this.icon.calculateOffset=newIcon.calculateOffset);this.events=new OpenLayers.Events(this,this.icon.imageDiv)},destroy:function(){this.erase();this.map=null;this.events.destroy();this.events=null;this.icon!=null&&(this.icon.destroy(),this.icon=null)},draw:function(px){return this.icon.draw(px)},erase:function(){this.icon!=null&&this.icon.erase()},moveTo:function(px){px!=null&&this.icon!=null&&this.icon.moveTo(px);this.lonlat=this.map.getLonLatFromLayerPx(px)},isDrawn:function(){return this.icon&&this.icon.isDrawn()},onScreen:function(){var onScreen=!1,screenBounds;return this.map&&(screenBounds=this.map.getExtent(),onScreen=screenBounds.containsLonLat(this.lonlat)),onScreen},inflate:function(inflate){this.icon&&this.icon.setSize({w:this.icon.size.w*inflate,h:this.icon.size.h*inflate})},setOpacity:function(opacity){this.icon.setOpacity(opacity)},setUrl:function(url){this.icon.setUrl(url)},display:function(display){this.icon.display(display)},CLASS_NAME:"OpenLayers.Marker"});OpenLayers.Marker.defaultIcon=function(){return new OpenLayers.Icon(OpenLayers.Util.getImageLocation("marker.png"),{w:21,h:25},{x:-10.5,y:-25})};OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:function(){return!!(window.JSON&&typeof JSON.parse=="function"&&typeof JSON.stringify=="function")}(),read:function(json,filter){var object;if(this.nativeJSON)object=JSON.parse(json,filter);else try{if(/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))&&(object=eval("("+json+")"),typeof filter=="function")){function walk(k,v){if(v&&typeof v=="object")for(var i in v)v.hasOwnProperty(i)&&(v[i]=walk(i,v[i]));return filter(k,v)}object=walk("",object)}}catch(e){}return this.keepData&&(this.data=object),object},write:function(value,pretty){this.pretty=!!pretty;var json=null,type=typeof value;if(this.serialize[type])try{json=!this.pretty&&this.nativeJSON?JSON.stringify(value):this.serialize[type].apply(this,[value])}catch(err){OpenLayers.Console.error("Trouble serializing: "+err)}return json},writeIndent:function(){var pieces=[],i;if(this.pretty)for(i=0;i<this.level;++i)pieces.push(this.indent);return pieces.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(object){var pieces,key,keyJSON,valueJSON,addComma;if(object==null)return"null";if(object.constructor==Date)return this.serialize.date.apply(this,[object]);if(object.constructor==Array)return this.serialize.array.apply(this,[object]);pieces=["{"];this.level+=1;addComma=!1;for(key in object)object.hasOwnProperty(key)&&(keyJSON=OpenLayers.Format.JSON.prototype.write.apply(this,[key,this.pretty]),valueJSON=OpenLayers.Format.JSON.prototype.write.apply(this,[object[key],this.pretty]),keyJSON!=null&&valueJSON!=null&&(addComma&&pieces.push(","),pieces.push(this.writeNewline(),this.writeIndent(),keyJSON,":",this.writeSpace(),valueJSON),addComma=!0));return this.level-=1,pieces.push(this.writeNewline(),this.writeIndent(),"}"),pieces.join("")},array:function(array){var json,pieces=["["],i,len;for(this.level+=1,i=0,len=array.length;i<len;++i)json=OpenLayers.Format.JSON.prototype.write.apply(this,[array[i],this.pretty]),json!=null&&(i>0&&pieces.push(","),pieces.push(this.writeNewline(),this.writeIndent(),json));return this.level-=1,pieces.push(this.writeNewline(),this.writeIndent(),"]"),pieces.join("")},string:function(string){var m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(string)?'"'+string.replace(/([\x00-\x1f\\"])/g,function(a,b){var c=m[b];return c?c:(c=b.charCodeAt(),"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16))})+'"':'"'+string+'"'},number:function(number){return isFinite(number)?String(number):"null"},boolean:function(bool){return String(bool)},date:function(date){function format(number){return number<10?"0"+number:number}return'"'+date.getFullYear()+"-"+format(date.getMonth()+1)+"-"+format(date.getDate())+"T"+format(date.getHours())+":"+format(date.getMinutes())+":"+format(date.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"});OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:!1,read:function(json,type,filter){var results,obj,i,len,geom;if(type=type?type:"FeatureCollection",results=null,obj=null,obj=typeof json=="string"?OpenLayers.Format.JSON.prototype.read.apply(this,[json,filter]):json,obj){if(typeof obj.type!="string")OpenLayers.Console.error("Bad GeoJSON - no type: "+json);else if(this.isValidType(obj,type))switch(type){case"Geometry":try{results=this.parseGeometry(obj)}catch(err){OpenLayers.Console.error(err)}break;case"Feature":try{results=this.parseFeature(obj);results.type="Feature"}catch(err){OpenLayers.Console.error(err)}break;case"FeatureCollection":results=[];switch(obj.type){case"Feature":try{results.push(this.parseFeature(obj))}catch(err){results=null;OpenLayers.Console.error(err)}break;case"FeatureCollection":for(i=0,len=obj.features.length;i<len;++i)try{results.push(this.parseFeature(obj.features[i]))}catch(err){results=null;OpenLayers.Console.error(err)}break;default:try{geom=this.parseGeometry(obj);results.push(new OpenLayers.Feature.Vector(geom))}catch(err){results=null;OpenLayers.Console.error(err)}}}}else OpenLayers.Console.error("Bad JSON: "+json);return results},isValidType:function(obj,type){var valid=!1;switch(type){case"Geometry":OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],obj.type)==-1?OpenLayers.Console.error("Unsupported geometry type: "+obj.type):valid=!0;break;case"FeatureCollection":valid=!0;break;default:obj.type==type?valid=!0:OpenLayers.Console.error("Cannot convert types from "+obj.type+" to "+type)}return valid},parseFeature:function(obj){var feature,geometry,attributes,bbox;attributes=obj.properties?obj.properties:{};bbox=obj.geometry&&obj.geometry.bbox||obj.bbox;try{geometry=this.parseGeometry(obj.geometry)}catch(err){throw err;}return feature=new OpenLayers.Feature.Vector(geometry,attributes),bbox&&(feature.bounds=OpenLayers.Bounds.fromArray(bbox)),obj.id&&(feature.fid=obj.id),feature},parseGeometry:function(obj){var geometry,collection,numGeom,components,i;if(obj==null)return null;if(collection=!1,obj.type=="GeometryCollection"){if(!OpenLayers.Util.isArray(obj.geometries))throw"GeometryCollection must have geometries array: "+obj;for(numGeom=obj.geometries.length,components=new Array(numGeom),i=0;i<numGeom;++i)components[i]=this.parseGeometry.apply(this,[obj.geometries[i]]);geometry=new OpenLayers.Geometry.Collection(components);collection=!0}else{if(!OpenLayers.Util.isArray(obj.coordinates))throw"Geometry must have coordinates array: "+obj;if(!this.parseCoords[obj.type.toLowerCase()])throw"Unsupported geometry type: "+obj.type;try{geometry=this.parseCoords[obj.type.toLowerCase()].apply(this,[obj.coordinates])}catch(err){throw err;}}return this.internalProjection&&this.externalProjection&&!collection&&geometry.transform(this.externalProjection,this.internalProjection),geometry},parseCoords:{point:function(array){if(this.ignoreExtraDims==!1&&array.length!=2)throw"Only 2D points are supported: "+array;return new OpenLayers.Geometry.Point(array[0],array[1])},multipoint:function(array){for(var points=[],p=null,i=0,len=array.length;i<len;++i){try{p=this.parseCoords.point.apply(this,[array[i]])}catch(err){throw err;}points.push(p)}return new OpenLayers.Geometry.MultiPoint(points)},linestring:function(array){for(var points=[],p=null,i=0,len=array.length;i<len;++i){try{p=this.parseCoords.point.apply(this,[array[i]])}catch(err){throw err;}points.push(p)}return new OpenLayers.Geometry.LineString(points)},multilinestring:function(array){for(var lines=[],l=null,i=0,len=array.length;i<len;++i){try{l=this.parseCoords.linestring.apply(this,[array[i]])}catch(err){throw err;}lines.push(l)}return new OpenLayers.Geometry.MultiLineString(lines)},polygon:function(array){for(var rings=[],r,l,i=0,len=array.length;i<len;++i){try{l=this.parseCoords.linestring.apply(this,[array[i]])}catch(err){throw err;}r=new OpenLayers.Geometry.LinearRing(l.components);rings.push(r)}return new OpenLayers.Geometry.Polygon(rings)},multipolygon:function(array){for(var polys=[],p=null,i=0,len=array.length;i<len;++i){try{p=this.parseCoords.polygon.apply(this,[array[i]])}catch(err){throw err;}polys.push(p)}return new OpenLayers.Geometry.MultiPolygon(polys)},box:function(array){if(array.length!=2)throw"GeoJSON box coordinates must have 2 elements";return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(array[0][0],array[0][1]),new OpenLayers.Geometry.Point(array[1][0],array[0][1]),new OpenLayers.Geometry.Point(array[1][0],array[1][1]),new OpenLayers.Geometry.Point(array[0][0],array[1][1]),new OpenLayers.Geometry.Point(array[0][0],array[0][1])])])}},write:function(obj,pretty){var geojson={type:null},numFeatures,i,element,msg;if(OpenLayers.Util.isArray(obj))for(geojson.type="FeatureCollection",numFeatures=obj.length,geojson.features=new Array(numFeatures),i=0;i<numFeatures;++i){if(element=obj[i],!element instanceof OpenLayers.Feature.Vector){msg="FeatureCollection only supports collections of features: "+element;throw msg;}geojson.features[i]=this.extract.feature.apply(this,[element])}else obj.CLASS_NAME.indexOf("OpenLayers.Geometry")==0?geojson=this.extract.geometry.apply(this,[obj]):obj instanceof OpenLayers.Feature.Vector&&(geojson=this.extract.feature.apply(this,[obj]),obj.layer&&obj.layer.projection&&(geojson.crs=this.createCRSObject(obj)));return OpenLayers.Format.JSON.prototype.write.apply(this,[geojson,pretty])},createCRSObject:function(object){var proj=object.layer.projection.toString(),crs={},code;return proj.match(/epsg:/i)&&(code=parseInt(proj.substring(proj.indexOf(":")+1)),crs=code==4326?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+code}}),crs},extract:{feature:function(feature){var geom=this.extract.geometry.apply(this,[feature.geometry]),json={type:"Feature",properties:feature.attributes,geometry:geom};return feature.fid!=null&&(json.id=feature.fid),json},geometry:function(geometry){if(geometry==null)return null;this.internalProjection&&this.externalProjection&&(geometry=geometry.clone(),geometry.transform(this.internalProjection,this.externalProjection));var geometryType=geometry.CLASS_NAME.split(".")[2],data=this.extract[geometryType.toLowerCase()].apply(this,[geometry]);return geometryType=="Collection"?{type:"GeometryCollection",geometries:data}:{type:geometryType,coordinates:data}},point:function(point){return[point.x,point.y]},multipoint:function(multipoint){for(var array=[],i=0,len=multipoint.components.length;i<len;++i)array.push(this.extract.point.apply(this,[multipoint.components[i]]));return array},linestring:function(linestring){for(var array=[],i=0,len=linestring.components.length;i<len;++i)array.push(this.extract.point.apply(this,[linestring.components[i]]));return array},multilinestring:function(multilinestring){for(var array=[],i=0,len=multilinestring.components.length;i<len;++i)array.push(this.extract.linestring.apply(this,[multilinestring.components[i]]));return array},polygon:function(polygon){for(var array=[],i=0,len=polygon.components.length;i<len;++i)array.push(this.extract.linestring.apply(this,[polygon.components[i]]));return array},multipolygon:function(multipolygon){for(var array=[],i=0,len=multipolygon.components.length;i<len;++i)array.push(this.extract.polygon.apply(this,[multipolygon.components[i]]));return array},collection:function(collection){for(var len=collection.components.length,array=new Array(len),i=0;i<len;++i)array[i]=this.extract.geometry.apply(this,[collection.components[i]]);return array}},CLASS_NAME:"OpenLayers.Format.GeoJSON"});OpenLayers.Strategy.Paging=OpenLayers.Class(OpenLayers.Strategy,{features:null,length:10,num:null,paging:!1,activate:function(){var activated=OpenLayers.Strategy.prototype.activate.call(this);if(activated)this.layer.events.on({beforefeaturesadded:this.cacheFeatures,scope:this});return activated},deactivate:function(){var deactivated=OpenLayers.Strategy.prototype.deactivate.call(this);return deactivated&&(this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,scope:this})),deactivated},cacheFeatures:function(event){this.paging||(this.clearCache(),this.features=event.features,this.pageNext(event))},clearCache:function(){if(this.features)for(var i=0;i<this.features.length;++i)this.features[i].destroy();this.features=null;this.num=null},pageCount:function(){var numFeatures=this.features?this.features.length:0;return Math.ceil(numFeatures/this.length)},pageNum:function(){return this.num},pageLength:function(newLength){return newLength&&newLength>0&&(this.length=newLength),this.length},pageNext:function(event){var changed=!1,start;return this.features&&(this.num===null&&(this.num=-1),start=(this.num+1)*this.length,changed=this.page(start,event)),changed},pagePrevious:function(){var changed=!1,start;return this.features&&(this.num===null&&(this.num=this.pageCount()),start=(this.num-1)*this.length,changed=this.page(start)),changed},page:function(start,event){var changed=!1,num,features;return this.features&&start>=0&&start<this.features.length&&(num=Math.floor(start/this.length),num!=this.num&&(this.paging=!0,features=this.features.slice(start,start+this.length),this.layer.removeFeatures(this.layer.features),this.num=num,event&&event.features?event.features=features:this.layer.addFeatures(features),this.paging=!1,changed=!0)),changed},CLASS_NAME:"OpenLayers.Strategy.Paging"});OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:!0,anchor:null,initialize:function(id,lonlat,contentSize,contentHTML,anchor,closeBox,closeBoxCallback){var newArguments=[id,lonlat,contentSize,contentHTML,closeBox,closeBoxCallback];OpenLayers.Popup.prototype.initialize.apply(this,newArguments);this.anchor=anchor!=null?anchor:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}},destroy:function(){this.anchor=null;this.relativePosition=null;OpenLayers.Popup.prototype.destroy.apply(this,arguments)},show:function(){this.updatePosition();OpenLayers.Popup.prototype.show.apply(this,arguments)},moveTo:function(px){var oldRelativePosition=this.relativePosition;this.relativePosition=this.calculateRelativePosition(px);OpenLayers.Popup.prototype.moveTo.call(this,this.calculateNewPx(px));this.relativePosition!=oldRelativePosition&&this.updateRelativePosition()},setSize:function(){if(OpenLayers.Popup.prototype.setSize.apply(this,arguments),this.lonlat&&this.map){var px=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(px)}},calculateRelativePosition:function(px){var lonlat=this.map.getLonLatFromLayerPx(px),extent=this.map.getExtent(),quadrant=extent.determineQuadrant(lonlat);return OpenLayers.Bounds.oppositeQuadrant(quadrant)},updateRelativePosition:function(){},calculateNewPx:function(px){var newPx=px.offset(this.anchor.offset),size=this.size||this.contentSize,top=this.relativePosition.charAt(0)=="t",left;return newPx.y+=top?-size.h:this.anchor.size.h,left=this.relativePosition.charAt(1)=="l",newPx.x+=left?-size.w:this.anchor.size.w,newPx},CLASS_NAME:"OpenLayers.Popup.Anchored"});OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:!1,positionBlocks:null,blocks:null,fixedRelativePosition:!1,initialize:function(id,lonlat,contentSize,contentHTML,anchor,closeBox){OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments);this.fixedRelativePosition&&(this.updateRelativePosition(),this.calculateRelativePosition=function(){return this.relativePosition});this.contentDiv.style.position="absolute";this.contentDiv.style.zIndex=1;closeBox&&(this.closeDiv.style.zIndex=1);this.groupDiv.style.position="absolute";this.groupDiv.style.top="0px";this.groupDiv.style.left="0px";this.groupDiv.style.height="100%";this.groupDiv.style.width="100%"},destroy:function(){var i,block;for(this.imageSrc=null,this.imageSize=null,this.isAlphaImage=null,this.fixedRelativePosition=!1,this.positionBlocks=null,i=0;i<this.blocks.length;i++)block=this.blocks[i],block.image&&block.div.removeChild(block.image),block.image=null,block.div&&this.groupDiv.removeChild(block.div),block.div=null;this.blocks=null;OpenLayers.Popup.Anchored.prototype.destroy.apply(this,arguments)},setBackgroundColor:function(){},setBorder:function(){},setOpacity:function(){},setSize:function(){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);this.updateBlocks()},updateRelativePosition:function(){if(this.padding=this.positionBlocks[this.relativePosition].padding,this.closeDiv){var contentDivPadding=this.getContentDivPadding();this.closeDiv.style.right=contentDivPadding.right+this.padding.right+"px";this.closeDiv.style.top=contentDivPadding.top+this.padding.top+"px"}this.updateBlocks()},calculateNewPx:function(){var newPx=OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);return newPx.offset(this.positionBlocks[this.relativePosition].offset)},createBlocks:function(){var firstPosition,key,position,i,block,divId,imgId,imageCreator;this.blocks=[];firstPosition=null;for(key in this.positionBlocks){firstPosition=key;break}for(position=this.positionBlocks[firstPosition],i=0;i<position.blocks.length;i++)block={},this.blocks.push(block),divId=this.id+"_FrameDecorationDiv_"+i,block.div=OpenLayers.Util.createDiv(divId,null,null,null,"absolute",null,"hidden",null),imgId=this.id+"_FrameDecorationImg_"+i,imageCreator=this.isAlphaImage?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage,block.image=imageCreator(imgId,null,this.imageSize,this.imageSrc,"absolute",null,null,null),block.div.appendChild(block.image),this.groupDiv.appendChild(block.div)},updateBlocks:function(){var position,i;if(this.blocks||this.createBlocks(),this.size&&this.relativePosition){for(position=this.positionBlocks[this.relativePosition],i=0;i<position.blocks.length;i++){var positionBlock=position.blocks[i],block=this.blocks[i],l=positionBlock.anchor.left,b=positionBlock.anchor.bottom,r=positionBlock.anchor.right,t=positionBlock.anchor.top,w=isNaN(positionBlock.size.w)?this.size.w-(r+l):positionBlock.size.w,h=isNaN(positionBlock.size.h)?this.size.h-(b+t):positionBlock.size.h;block.div.style.width=(w<0?0:w)+"px";block.div.style.height=(h<0?0:h)+"px";block.div.style.left=l!=null?l+"px":"";block.div.style.bottom=b!=null?b+"px":"";block.div.style.right=r!=null?r+"px":"";block.div.style.top=t!=null?t+"px":"";block.image.style.left=positionBlock.position.x+"px";block.image.style.top=positionBlock.position.y+"px"}this.contentDiv.style.left=this.padding.left+"px";this.contentDiv.style.top=this.padding.top+"px"}},CLASS_NAME:"OpenLayers.Popup.Framed"});OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.dragHandler=new OpenLayers.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox},{keyMask:this.keyMask})},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);this.dragHandler&&(this.dragHandler.destroy(),this.dragHandler=null)},setMap:function(map){OpenLayers.Handler.prototype.setMap.apply(this,arguments);this.dragHandler&&this.dragHandler.setMap(map)},startBox:function(){this.callback("start",[]);this.zoomBox=OpenLayers.Util.createDiv("zoomBox",{x:-9999,y:-9999});this.zoomBox.className=this.boxDivClassName;this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox);OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")},moveBox:function(xy){var startX=this.dragHandler.start.x,startY=this.dragHandler.start.y,deltaX=Math.abs(startX-xy.x),deltaY=Math.abs(startY-xy.y),offset=this.getBoxOffsets();this.zoomBox.style.width=deltaX+offset.width+1+"px";this.zoomBox.style.height=deltaY+offset.height+1+"px";this.zoomBox.style.left=(xy.x<startX?startX-deltaX-offset.left:startX-offset.left)+"px";this.zoomBox.style.top=(xy.y<startY?startY-deltaY-offset.top:startY-offset.top)+"px"},endBox:function(end){var result;if(Math.abs(this.dragHandler.start.x-end.x)>5||Math.abs(this.dragHandler.start.y-end.y)>5){var start=this.dragHandler.start,top=Math.min(start.y,end.y),bottom=Math.max(start.y,end.y),left=Math.min(start.x,end.x),right=Math.max(start.x,end.x);result=new OpenLayers.Bounds(left,bottom,right,top)}else result=this.dragHandler.start.clone();this.removeBox();this.callback("done",[result])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.zoomBox=null;this.boxOffsets=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){return OpenLayers.Handler.prototype.activate.apply(this,arguments)?(this.dragHandler.activate(),!0):!1},deactivate:function(){return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)?(this.dragHandler.deactivate()&&this.zoomBox&&this.removeBox(),!0):!1},getBoxOffsets:function(){var testDiv,w3cBoxModel;if(!this.boxOffsets){testDiv=document.createElement("div");testDiv.style.position="absolute";testDiv.style.border="1px solid black";testDiv.style.width="3px";document.body.appendChild(testDiv);w3cBoxModel=testDiv.clientWidth==3;document.body.removeChild(testDiv);var left=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width")),right=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width")),top=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width")),bottom=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"));this.boxOffsets={left:left,right:right,top:top,bottom:bottom,width:w3cBoxModel===!1?left+right:0,height:w3cBoxModel===!1?top+bottom:0}}return this.boxOffsets},CLASS_NAME:"OpenLayers.Handler.Box"});OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:!1,keyMask:null,alwaysZoom:!1,zoomOnClick:!0,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(position){var bounds,minXY,maxXY,lastZoom;if(position instanceof OpenLayers.Bounds){if(this.out){var pixWidth=Math.abs(position.right-position.left),pixHeight=Math.abs(position.top-position.bottom),zoomFactor=Math.min(this.map.size.h/pixHeight,this.map.size.w/pixWidth),extent=this.map.getExtent(),center=this.map.getLonLatFromPixel(position.getCenterPixel()),xmin=center.lon-extent.getWidth()/2*zoomFactor,xmax=center.lon+extent.getWidth()/2*zoomFactor,ymin=center.lat-extent.getHeight()/2*zoomFactor,ymax=center.lat+extent.getHeight()/2*zoomFactor;bounds=new OpenLayers.Bounds(xmin,ymin,xmax,ymax)}else minXY=this.map.getLonLatFromPixel({x:position.left,y:position.bottom}),maxXY=this.map.getLonLatFromPixel({x:position.right,y:position.top}),bounds=new OpenLayers.Bounds(minXY.lon,minXY.lat,maxXY.lon,maxXY.lat);lastZoom=this.map.getZoom();this.map.zoomToExtent(bounds);lastZoom==this.map.getZoom()&&this.alwaysZoom==!0&&this.map.zoomTo(lastZoom+(this.out?-1:1))}else this.zoomOnClick&&(this.out?this.map.setCenter(this.map.getLonLatFromPixel(position),this.map.getZoom()-1):this.map.setCenter(this.map.getLonLatFromPixel(position),this.map.getZoom()+1))},CLASS_NAME:"OpenLayers.Control.ZoomBox"});OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:1,documentDrag:!1,kinetic:null,enableKinetic:!1,kineticInterval:10,draw:function(){if(this.enableKinetic){var config={interval:this.kineticInterval};typeof this.enableKinetic=="object"&&(config=OpenLayers.Util.extend(config,this.enableKinetic));this.kinetic=new OpenLayers.Kinetic(config)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){this.kinetic&&this.kinetic.begin()},panMap:function(xy){this.kinetic&&this.kinetic.update(xy);this.panned=!0;this.map.pan(this.handler.last.x-xy.x,this.handler.last.y-xy.y,{dragging:!0,animate:!1})},panMapDone:function(xy){var res,self;this.panned&&(res=null,this.kinetic&&(res=this.kinetic.end(xy)),this.map.pan(this.handler.last.x-xy.x,this.handler.last.y-xy.y,{dragging:!!res,animate:!1}),res&&(self=this,this.kinetic.move(res,function(x,y,end){self.map.pan(x,y,{dragging:!end,animate:!1})})),this.panned=!1)},CLASS_NAME:"OpenLayers.Control.DragPan"});OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:!1,zoomBox:null,zoomBoxEnabled:!0,zoomWheelEnabled:!0,mouseWheelOptions:null,handleRightClicks:!1,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:!0,initialize:function(){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();this.dragPan&&this.dragPan.destroy();this.dragPan=null;this.zoomBox&&this.zoomBox.destroy();this.zoomBox=null;this.pinchZoom&&this.pinchZoom.destroy();this.pinchZoom=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.dragPan.activate(),this.zoomWheelEnabled&&this.handlers.wheel.activate(),this.handlers.click.activate(),this.zoomBoxEnabled&&this.zoomBox.activate(),this.pinchZoom&&this.pinchZoom.activate(),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.pinchZoom&&this.pinchZoom.deactivate(),this.zoomBox.deactivate(),this.dragPan.deactivate(),this.handlers.click.deactivate(),this.handlers.wheel.deactivate(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){this.handleRightClicks&&(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False);var clickCallbacks={click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick};this.handlers.click=new OpenLayers.Handler.Click(this,clickCallbacks,{double:!0,stopDouble:!0});this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask});this.dragPan.draw();this.zoomBox.draw();this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},this.mouseWheelOptions);OpenLayers.Control.PinchZoom&&(this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions)))},defaultClick:function(evt){evt.lastTouches&&evt.lastTouches.length==2&&this.map.zoomOut()},defaultDblClick:function(evt){var newCenter=this.map.getLonLatFromViewPortPx(evt.xy);this.map.setCenter(newCenter,this.map.zoom+1)},defaultDblRightClick:function(evt){var newCenter=this.map.getLonLatFromViewPortPx(evt.xy);this.map.setCenter(newCenter,this.map.zoom-1)},wheelChange:function(evt,deltaZ){var currentZoom,newZoom;if(this.map.fractionalZoom||(deltaZ=Math.round(deltaZ)),currentZoom=this.map.getZoom(),newZoom=this.map.getZoom()+deltaZ,newZoom=Math.max(newZoom,0),newZoom=Math.min(newZoom,this.map.getNumZoomLevels()),newZoom!==currentZoom){var size=this.map.getSize(),deltaX=size.w/2-evt.xy.x,deltaY=evt.xy.y-size.h/2,newRes=this.map.baseLayer.getResolutionForZoom(newZoom),zoomPoint=this.map.getLonLatFromPixel(evt.xy),newCenter=new OpenLayers.LonLat(zoomPoint.lon+deltaX*newRes,zoomPoint.lat+deltaY*newRes);this.map.setCenter(newCenter,newZoom)}},wheelUp:function(evt,delta){this.wheelChange(evt,delta||1)},wheelDown:function(evt,delta){this.wheelChange(evt,delta||-1)},disableZoomBox:function(){this.zoomBoxEnabled=!1;this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=!0;this.active&&this.zoomBox.activate()},disableZoomWheel:function(){this.zoomWheelEnabled=!1;this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=!0;this.active&&this.handlers.wheel.activate()},CLASS_NAME:"OpenLayers.Control.Navigation"});OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,multi:!1,featureAdded:function(){},initialize:function(layer,handler,options){OpenLayers.Control.prototype.initialize.apply(this,[options]);this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(vertex,feature){this.layer.events.triggerEvent("sketchmodified",{vertex:vertex,feature:feature})},create:function(vertex,feature){this.layer.events.triggerEvent("sketchstarted",{vertex:vertex,feature:feature})}},this.callbacks);this.layer=layer;this.handlerOptions=this.handlerOptions||{};this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{renderers:layer.renderers,rendererOptions:layer.rendererOptions});"multi"in this.handlerOptions||(this.handlerOptions.multi=this.multi);var sketchStyle=this.layer.styleMap&&this.layer.styleMap.styles.temporary;sketchStyle&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":sketchStyle})}));this.handler=new handler(this,this.callbacks,this.handlerOptions)},drawFeature:function(geometry){var feature=new OpenLayers.Feature.Vector(geometry),proceed=this.layer.events.triggerEvent("sketchcomplete",{feature:feature});proceed!==!1&&(feature.state=OpenLayers.State.INSERT,this.layer.addFeatures([feature]),this.featureAdded(feature),this.events.triggerEvent("featureadded",{feature:feature}))},insertXY:function(x,y){this.handler&&this.handler.line&&this.handler.insertXY(x,y)},insertDeltaXY:function(dx,dy){this.handler&&this.handler.line&&this.handler.insertDeltaXY(dx,dy)},insertDirectionLength:function(direction,length){this.handler&&this.handler.line&&this.handler.insertDirectionLength(direction,length)},insertDeflectionLength:function(deflection,length){this.handler&&this.handler.line&&this.handler.insertDeflectionLength(deflection,length)},undo:function(){return this.handler.undo&&this.handler.undo()},redo:function(){return this.handler.redo&&this.handler.redo()},finishSketch:function(){this.handler.finishGeometry()},cancel:function(){this.handler.cancel()},CLASS_NAME:"OpenLayers.Control.DrawFeature"});OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:!1,polygon:null,createFeature:function(pixel){var lonlat=this.layer.getLonLatFromViewPortPx(pixel),geometry=new OpenLayers.Geometry.Point(lonlat.lon,lonlat.lat);this.point=new OpenLayers.Feature.Vector(geometry);this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry]));this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.polygon,this.point],{silent:!0})},addPoint:function(){var geometry,features,candidate,polygon,i;if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier])for(geometry=this.point.geometry,features=this.control.layer.features,i=features.length-1;i>=0;--i)if(candidate=features[i].geometry,(candidate instanceof OpenLayers.Geometry.Polygon||candidate instanceof OpenLayers.Geometry.MultiPolygon)&&candidate.intersects(geometry)){polygon=features[i];this.control.layer.removeFeatures([polygon],{silent:!0});this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing);this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology);polygon.geometry.addComponent(this.line.geometry);this.polygon=polygon;this.drawingHole=!0;break}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(event){var point=event.vertex,components=this.line.geometry.components,last;this.polygon.geometry.intersects(point)||(last=components[components.length-3],point.x=last.x,point.y=last.y)},finishGeometry:function(){var index=this.line.geometry.components.length-2;this.line.geometry.removeComponent(this.line.geometry.components[index]);this.removePoint();this.finalize()},finalizeInteriorRing:function(){var ring=this.line.geometry,modified=ring.getArea()!==0,rings,i,points,j,jj;if(modified){for(rings=this.polygon.geometry.components,i=rings.length-2;i>=0;--i)if(ring.intersects(rings[i])){modified=!1;break}if(modified)outer:for(i=rings.length-2;i>0;--i)for(points=rings[i].components,j=0,jj=points.length;j<jj;++j)if(ring.containsPoint(points[j])){modified=!1;break outer}}return modified?this.polygon.state!==OpenLayers.State.INSERT&&(this.polygon.state=OpenLayers.State.UPDATE):this.polygon.geometry.removeComponent(ring),this.restoreFeature(),!1},cancel:function(){return this.drawingHole&&(this.polygon.geometry.removeComponent(this.line.geometry),this.restoreFeature(!0)),OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(cancel){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing);this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology);this.layer.removeFeatures([this.polygon],{silent:!0});this.control.layer.addFeatures([this.polygon],{silent:!0});this.drawingHole=!1;cancel||this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})},destroyFeature:function(force){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,force);this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var geometry=this.polygon&&this.polygon.geometry;return geometry&&this.multi&&(geometry=new OpenLayers.Geometry.MultiPolygon([geometry])),geometry},CLASS_NAME:"OpenLayers.Handler.Polygon"});OpenLayers.Control.EditingToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{citeCompliant:!1,initialize:function(layer,options){OpenLayers.Control.Panel.prototype.initialize.apply(this,[options]);this.addControls([new OpenLayers.Control.Navigation]);var controls=[new OpenLayers.Control.DrawFeature(layer,OpenLayers.Handler.Point,{displayClass:"olControlDrawFeaturePoint",handlerOptions:{citeCompliant:this.citeCompliant}}),new OpenLayers.Control.DrawFeature(layer,OpenLayers.Handler.Path,{displayClass:"olControlDrawFeaturePath",handlerOptions:{citeCompliant:this.citeCompliant}}),new OpenLayers.Control.DrawFeature(layer,OpenLayers.Handler.Polygon,{displayClass:"olControlDrawFeaturePolygon",handlerOptions:{citeCompliant:this.citeCompliant}})];this.addControls(controls)},draw:function(){var div=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);return this.defaultControl===null&&(this.defaultControl=this.controls[0]),div},CLASS_NAME:"OpenLayers.Control.EditingToolbar"});OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},gmlFormat:null,read:function(data){var result,root,scope,read;return typeof data=="string"&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data])),root=data.documentElement,root?(scope=this,read=this["read_"+root.nodeName],result=read?read.call(this,root):new OpenLayers.Format.GML(this.options?this.options:{}).read(data)):result=data,result},read_msGMLOutput:function(data){var response=[],layerNodes=this.getSiblingNodesByTagCriteria(data,this.layerIdentifier),i,len,node,layerName,featureNodes,j;if(layerNodes)for(i=0,len=layerNodes.length;i<len;++i)if(node=layerNodes[i],layerName=node.nodeName,node.prefix&&(layerName=layerName.split(":")[1]),layerName=layerName.replace(this.layerIdentifier,""),featureNodes=this.getSiblingNodesByTagCriteria(node,this.featureIdentifier),featureNodes)for(j=0;j<featureNodes.length;j++){var featureNode=featureNodes[j],geomInfo=this.parseGeometry(featureNode),attributes=this.parseAttributes(featureNode),feature=new OpenLayers.Feature.Vector(geomInfo.geometry,attributes,null);feature.bounds=geomInfo.bounds;feature.type=layerName;response.push(feature)}return response},read_FeatureInfoResponse:function(data){for(var attribute,nodes,node,response=[],featureNodes=this.getElementsByTagNameNS(data,"*","FIELDS"),i=0,len=featureNodes.length;i<len;i++){var featureNode=featureNodes[i],attributes={},j,jlen=featureNode.attributes.length;if(jlen>0)for(j=0;j<jlen;j++)attribute=featureNode.attributes[j],attributes[attribute.nodeName]=attribute.nodeValue;else for(nodes=featureNode.childNodes,j=0,jlen=nodes.length;j<jlen;++j)node=nodes[j],node.nodeType!=3&&(attributes[node.getAttribute("name")]=node.getAttribute("value"));response.push(new OpenLayers.Feature.Vector(null,attributes,null))}return response},getSiblingNodesByTagCriteria:function(node,criteria){var nodes=[],children,tagName,n,matchNodes,child,k;if(node&&node.hasChildNodes())for(children=node.childNodes,n=children.length,k=0;k<n;k++){for(child=children[k];child&&child.nodeType!=1;)child=child.nextSibling,k++;tagName=child?child.nodeName:"";tagName.length>0&&tagName.indexOf(criteria)>-1?nodes.push(child):(matchNodes=this.getSiblingNodesByTagCriteria(child,criteria),matchNodes.length>0&&(nodes.length==0?nodes=matchNodes:nodes.push(matchNodes)))}return nodes},parseAttributes:function(node){var attributes={},children,n,i,child,grandchildren,name,grandchild,value;if(node.nodeType==1)for(children=node.childNodes,n=children.length,i=0;i<n;++i)child=children[i],child.nodeType==1&&(grandchildren=child.childNodes,name=child.prefix?child.nodeName.split(":")[1]:child.nodeName,grandchildren.length==0?attributes[name]=null:grandchildren.length==1&&(grandchild=grandchildren[0],(grandchild.nodeType==3||grandchild.nodeType==4)&&(value=grandchild.nodeValue.replace(this.regExes.trimSpace,""),attributes[name]=value)));return attributes},parseGeometry:function(node){this.gmlFormat||(this.gmlFormat=new OpenLayers.Format.GML);var feature=this.gmlFormat.parseFeature(node),geometry,bounds=null;return feature&&(geometry=feature.geometry&&feature.geometry.clone(),bounds=feature.bounds&&feature.bounds.clone(),feature.destroy()),{geometry:geometry,bounds:bounds}},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"});OpenLayers.Console.warn("OpenLayers.Rico is deprecated");OpenLayers.Rico=OpenLayers.Rico||{};OpenLayers.Rico.Color=OpenLayers.Class({initialize:function(red,green,blue){this.rgb={r:red,g:green,b:blue}},setRed:function(r){this.rgb.r=r},setGreen:function(g){this.rgb.g=g},setBlue:function(b){this.rgb.b=b},setHue:function(h){var hsb=this.asHSB();hsb.h=h;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(hsb.h,hsb.s,hsb.b)},setSaturation:function(s){var hsb=this.asHSB();hsb.s=s;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(hsb.h,hsb.s,hsb.b)},setBrightness:function(b){var hsb=this.asHSB();hsb.b=b;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(hsb.h,hsb.s,hsb.b)},darken:function(percent){var hsb=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(hsb.h,hsb.s,Math.max(hsb.b-percent,0))},brighten:function(percent){var hsb=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(hsb.h,hsb.s,Math.min(hsb.b+percent,1))},blend:function(other){this.rgb.r=Math.floor((this.rgb.r+other.rgb.r)/2);this.rgb.g=Math.floor((this.rgb.g+other.rgb.g)/2);this.rgb.b=Math.floor((this.rgb.b+other.rgb.b)/2)},isBright:function(){var hsb=this.asHSB();return this.asHSB().b>.5},isDark:function(){return!this.isBright()},asRGB:function(){return"rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+")"},asHex:function(){return"#"+this.rgb.r.toColorPart()+this.rgb.g.toColorPart()+this.rgb.b.toColorPart()},asHSB:function(){return OpenLayers.Rico.Color.RGBtoHSB(this.rgb.r,this.rgb.g,this.rgb.b)},toString:function(){return this.asHex()}});OpenLayers.Rico.Color.createFromHex=function(hexCode){var shortHexCode,hexCode,i;if(hexCode.length==4)for(shortHexCode=hexCode,hexCode="#",i=1;i<4;i++)hexCode+=shortHexCode.charAt(i)+shortHexCode.charAt(i);hexCode.indexOf("#")==0&&(hexCode=hexCode.substring(1));var red=hexCode.substring(0,2),green=hexCode.substring(2,4),blue=hexCode.substring(4,6);return new OpenLayers.Rico.Color(parseInt(red,16),parseInt(green,16),parseInt(blue,16))};OpenLayers.Rico.Color.createColorFromBackground=function(elem){var actualColor=OpenLayers.Element.getStyle(OpenLayers.Util.getElement(elem),"backgroundColor"),colors,colorArray;return actualColor=="transparent"&&elem.parentNode?OpenLayers.Rico.Color.createColorFromBackground(elem.parentNode):actualColor==null?new OpenLayers.Rico.Color(255,255,255):actualColor.indexOf("rgb(")==0?(colors=actualColor.substring(4,actualColor.length-1),colorArray=colors.split(","),new OpenLayers.Rico.Color(parseInt(colorArray[0]),parseInt(colorArray[1]),parseInt(colorArray[2]))):actualColor.indexOf("#")==0?OpenLayers.Rico.Color.createFromHex(actualColor):new OpenLayers.Rico.Color(255,255,255)};OpenLayers.Rico.Color.HSBtoRGB=function(hue,saturation,brightness){var red=0,green=0,blue=0;if(saturation==0)red=parseInt(brightness*255+.5),green=red,blue=red;else{var h=(hue-Math.floor(hue))*6,f=h-Math.floor(h),p=brightness*(1-saturation),q=brightness*(1-saturation*f),t=brightness*(1-saturation*(1-f));switch(parseInt(h)){case 0:red=brightness*255+.5;green=t*255+.5;blue=p*255+.5;break;case 1:red=q*255+.5;green=brightness*255+.5;blue=p*255+.5;break;case 2:red=p*255+.5;green=brightness*255+.5;blue=t*255+.5;break;case 3:red=p*255+.5;green=q*255+.5;blue=brightness*255+.5;break;case 4:red=t*255+.5;green=p*255+.5;blue=brightness*255+.5;break;case 5:red=brightness*255+.5;green=p*255+.5;blue=q*255+.5}}return{r:parseInt(red),g:parseInt(green),b:parseInt(blue)}};OpenLayers.Rico.Color.RGBtoHSB=function(r,g,b){var hue,saturation,brightness,cmax=r>g?r:g,cmin;if(b>cmax&&(cmax=b),cmin=r<g?r:g,b<cmin&&(cmin=b),brightness=cmax/255,saturation=cmax!=0?(cmax-cmin)/cmax:0,saturation==0)hue=0;else{var redc=(cmax-r)/(cmax-cmin),greenc=(cmax-g)/(cmax-cmin),bluec=(cmax-b)/(cmax-cmin);hue=r==cmax?bluec-greenc:g==cmax?2+redc-bluec:4+greenc-redc;hue=hue/6;hue<0&&(hue=hue+1)}return{h:hue,s:saturation,b:brightness}};OpenLayers.Console.warn("OpenLayers.Rico is deprecated");OpenLayers.Rico=OpenLayers.Rico||{};OpenLayers.Rico.Corner={round:function(e,options){var color,bgColor;e=OpenLayers.Util.getElement(e);this._setOptions(options);color=this.options.color;this.options.color=="fromElement"&&(color=this._background(e));bgColor=this.options.bgColor;this.options.bgColor=="fromParent"&&(bgColor=this._background(e.offsetParent));this._roundCornersImpl(e,color,bgColor)},changeColor:function(theDiv,newColor){var spanElements,currIdx;for(theDiv.style.backgroundColor=newColor,spanElements=theDiv.parentNode.getElementsByTagName("span"),currIdx=0;currIdx<spanElements.length;currIdx++)spanElements[currIdx].style.backgroundColor=newColor},changeOpacity:function(theDiv,newOpacity){var mozillaOpacity=newOpacity,ieOpacity="alpha(opacity="+newOpacity*100+")",spanElements,currIdx;for(theDiv.style.opacity=mozillaOpacity,theDiv.style.filter=ieOpacity,spanElements=theDiv.parentNode.getElementsByTagName("span"),currIdx=0;currIdx<spanElements.length;currIdx++)spanElements[currIdx].style.opacity=mozillaOpacity,spanElements[currIdx].style.filter=ieOpacity},reRound:function(theDiv,options){var topRico=theDiv.parentNode.childNodes[0],bottomRico=theDiv.parentNode.childNodes[2];theDiv.parentNode.removeChild(topRico);theDiv.parentNode.removeChild(bottomRico);this.round(theDiv.parentNode,options)},_roundCornersImpl:function(e,color,bgColor){this.options.border&&this._renderBorder(e,bgColor);this._isTopRounded()&&this._roundTopCorners(e,color,bgColor);this._isBottomRounded()&&this._roundBottomCorners(e,color,bgColor)},_renderBorder:function(el,bgColor){var borderValue="1px solid "+this._borderColor(bgColor),borderL="border-left: "+borderValue,borderR="border-right: "+borderValue,style="style='"+borderL+";"+borderR+"'";el.innerHTML="<div "+style+">"+el.innerHTML+"<\/div>"},_roundTopCorners:function(el,color,bgColor){for(var corner=this._createCorner(bgColor),i=0;i<this.options.numSlices;i++)corner.appendChild(this._createCornerSlice(color,bgColor,i,"top"));el.style.paddingTop=0;el.insertBefore(corner,el.firstChild)},_roundBottomCorners:function(el,color,bgColor){for(var corner=this._createCorner(bgColor),i=this.options.numSlices-1;i>=0;i--)corner.appendChild(this._createCornerSlice(color,bgColor,i,"bottom"));el.style.paddingBottom=0;el.appendChild(corner)},_createCorner:function(bgColor){var corner=document.createElement("div");return corner.style.backgroundColor=this._isTransparent()?"transparent":bgColor,corner},_createCornerSlice:function(color,bgColor,n,position){var slice=document.createElement("span"),inStyle=slice.style,borderColor;return inStyle.backgroundColor=color,inStyle.display="block",inStyle.height="1px",inStyle.overflow="hidden",inStyle.fontSize="1px",borderColor=this._borderColor(color,bgColor),this.options.border&&n==0?(inStyle.borderTopStyle="solid",inStyle.borderTopWidth="1px",inStyle.borderLeftWidth="0px",inStyle.borderRightWidth="0px",inStyle.borderBottomWidth="0px",inStyle.height="0px",inStyle.borderColor=borderColor):borderColor&&(inStyle.borderColor=borderColor,inStyle.borderStyle="solid",inStyle.borderWidth="0px 1px"),this.options.compact||n!=this.options.numSlices-1||(inStyle.height="2px"),this._setMargin(slice,n,position),this._setBorder(slice,n,position),slice},_setOptions:function(options){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:!0,border:!1,compact:!1};OpenLayers.Util.extend(this.options,options||{});this.options.numSlices=this.options.compact?2:4;this._isTransparent()&&(this.options.blend=!1)},_whichSideTop:function(){return this._hasString(this.options.corners,"all","top")?"":this.options.corners.indexOf("tl")>=0&&this.options.corners.indexOf("tr")>=0?"":this.options.corners.indexOf("tl")>=0?"left":this.options.corners.indexOf("tr")>=0?"right":""},_whichSideBottom:function(){return this._hasString(this.options.corners,"all","bottom")?"":this.options.corners.indexOf("bl")>=0&&this.options.corners.indexOf("br")>=0?"":this.options.corners.indexOf("bl")>=0?"left":this.options.corners.indexOf("br")>=0?"right":""},_borderColor:function(color,bgColor){return color=="transparent"?bgColor:this.options.border?this.options.border:this.options.blend?this._blend(bgColor,color):""},_setMargin:function(el,n,corners){var marginSize=this._marginSize(n),whichSide=corners=="top"?this._whichSideTop():this._whichSideBottom();whichSide=="left"?(el.style.marginLeft=marginSize+"px",el.style.marginRight="0px"):whichSide=="right"?(el.style.marginRight=marginSize+"px",el.style.marginLeft="0px"):(el.style.marginLeft=marginSize+"px",el.style.marginRight=marginSize+"px")},_setBorder:function(el,n,corners){var borderSize=this._borderSize(n),whichSide=corners=="top"?this._whichSideTop():this._whichSideBottom();whichSide=="left"?(el.style.borderLeftWidth=borderSize+"px",el.style.borderRightWidth="0px"):whichSide=="right"?(el.style.borderRightWidth=borderSize+"px",el.style.borderLeftWidth="0px"):(el.style.borderLeftWidth=borderSize+"px",el.style.borderRightWidth=borderSize+"px");this.options.border!=!1&&(el.style.borderLeftWidth=borderSize+"px",el.style.borderRightWidth=borderSize+"px")},_marginSize:function(n){if(this._isTransparent())return 0;return this.options.compact&&this.options.blend?[1,0][n]:this.options.compact?[2,1][n]:this.options.blend?[3,2,1,0][n]:[5,3,2,1][n]},_borderSize:function(n){return this.options.compact&&(this.options.blend||this._isTransparent())?1:this.options.compact?[1,0][n]:this.options.blend?[2,1,1,1][n]:this.options.border?[0,2,0,0][n]:this._isTransparent()?[5,3,2,1][n]:0},_hasString:function(str){for(var i=1;i<arguments.length;i++)if(str.indexOf(arguments[i])>=0)return!0;return!1},_blend:function(c1,c2){var cc1=OpenLayers.Rico.Color.createFromHex(c1);return cc1.blend(OpenLayers.Rico.Color.createFromHex(c2)),cc1},_background:function(el){try{return OpenLayers.Rico.Color.createColorFromBackground(el).asHex()}catch(err){return"#ffffff"}},_isTransparent:function(){return this.options.color=="transparent"},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr")},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br")},_hasSingleTextChild:function(el){return el.childNodes.length==1&&el.childNodes[0].nodeType==3}};OpenLayers.Popup.AnchoredBubble=OpenLayers.Class(OpenLayers.Popup.Anchored,{rounded:!1,initialize:function(){OpenLayers.Console.warn("AnchoredBubble is deprecated");this.padding=new OpenLayers.Bounds(0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE,0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE);OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments)},draw:function(){return OpenLayers.Popup.Anchored.prototype.draw.apply(this,arguments),this.setContentHTML(),this.setBackgroundColor(),this.setOpacity(),this.div},updateRelativePosition:function(){this.setRicoCorners()},setSize:function(){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);this.setRicoCorners()},setBackgroundColor:function(color){color!=undefined&&(this.backgroundColor=color);this.div!=null&&this.contentDiv!=null&&(this.div.style.background="transparent",OpenLayers.Rico.Corner.changeColor(this.groupDiv,this.backgroundColor))},setOpacity:function(opacity){OpenLayers.Popup.Anchored.prototype.setOpacity.call(this,opacity);this.div!=null&&this.groupDiv!=null&&OpenLayers.Rico.Corner.changeOpacity(this.groupDiv,this.opacity)},setBorder:function(){this.border=0},setRicoCorners:function(){var corners=this.getCornersToRound(this.relativePosition),options={corners:corners,color:this.backgroundColor,bgColor:"transparent",blend:!1};this.rounded?(OpenLayers.Rico.Corner.reRound(this.groupDiv,options),this.setBackgroundColor(),this.setOpacity()):(OpenLayers.Rico.Corner.round(this.div,options),this.rounded=!0)},getCornersToRound:function(){var corners=["tl","tr","bl","br"],corner=OpenLayers.Bounds.oppositeQuadrant(this.relativePosition);return OpenLayers.Util.removeItem(corners,corner),corners.join(" ")},CLASS_NAME:"OpenLayers.Popup.AnchoredBubble"});OpenLayers.Popup.AnchoredBubble.CORNER_SIZE=5;OpenLayers.Strategy.BBOX=OpenLayers.Class(OpenLayers.Strategy,{bounds:null,resolution:null,ratio:2,resFactor:null,response:null,activate:function(){var activated=OpenLayers.Strategy.prototype.activate.call(this);if(activated){this.layer.events.on({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this});this.update()}return activated},deactivate:function(){var deactivated=OpenLayers.Strategy.prototype.deactivate.call(this);return deactivated&&this.layer.events.un({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this}),deactivated},update:function(options){var mapBounds=this.getMapBounds();mapBounds!==null&&(options&&options.force||this.layer.visibility&&this.layer.calculateInRange()&&this.invalidBounds(mapBounds))&&(this.calculateBounds(mapBounds),this.resolution=this.layer.map.getResolution(),this.triggerRead(options))},getMapBounds:function(){if(this.layer.map===null)return null;var bounds=this.layer.map.getExtent();return bounds&&!this.layer.projection.equals(this.layer.map.getProjectionObject())&&(bounds=bounds.clone().transform(this.layer.map.getProjectionObject(),this.layer.projection)),bounds},invalidBounds:function(mapBounds){var invalid,ratio;return mapBounds||(mapBounds=this.getMapBounds()),invalid=!this.bounds||!this.bounds.containsBounds(mapBounds),!invalid&&this.resFactor&&(ratio=this.resolution/this.layer.map.getResolution(),invalid=ratio>=this.resFactor||ratio<=1/this.resFactor),invalid},calculateBounds:function(mapBounds){mapBounds||(mapBounds=this.getMapBounds());var center=mapBounds.getCenterLonLat(),dataWidth=mapBounds.getWidth()*this.ratio,dataHeight=mapBounds.getHeight()*this.ratio;this.bounds=new OpenLayers.Bounds(center.lon-dataWidth/2,center.lat-dataHeight/2,center.lon+dataWidth/2,center.lat+dataHeight/2)},triggerRead:function(options){!this.response||options&&options.noAbort===!0||(this.layer.protocol.abort(this.response),this.layer.events.triggerEvent("loadend"));this.layer.events.triggerEvent("loadstart");this.response=this.layer.protocol.read(OpenLayers.Util.applyDefaults({filter:this.createFilter(),callback:this.merge,scope:this},options))},createFilter:function(){var filter=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection});return this.layer.filter&&(filter=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.layer.filter,filter]})),filter},merge:function(resp){var features,remote,local,geom,i,len;if(this.layer.destroyFeatures(),features=resp.features,features&&features.length>0){if(remote=this.layer.projection,local=this.layer.map.getProjectionObject(),!local.equals(remote))for(i=0,len=features.length;i<len;++i)geom=features[i].geometry,geom&&geom.transform(remote,local);this.layer.addFeatures(features)}this.response=null;this.layer.events.triggerEvent("loadend",{response:resp})},CLASS_NAME:"OpenLayers.Strategy.BBOX"});OpenLayers.Format.SLD.v1_0_0_GeoServer=OpenLayers.Class(OpenLayers.Format.SLD.v1_0_0,{version:"1.0.0",profile:"GeoServer",readers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(node,obj){var value=this.readers.ogc._expression.call(this,node);value&&(obj.priority=value)},VendorOption:function(node,obj){obj.vendorOptions||(obj.vendorOptions={});obj.vendorOptions[node.getAttribute("name")]=this.getChildValue(node)},TextSymbolizer:function(node,rule){OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld.TextSymbolizer.apply(this,arguments);var symbolizer=this.multipleSymbolizers?rule.symbolizers[rule.symbolizers.length-1]:rule.symbolizer.Text;symbolizer.graphic===undefined&&(symbolizer.graphic=!1)}},OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.readers),writers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(priority){return this.writers.sld._OGCExpression.call(this,"sld:Priority",priority)},VendorOption:function(option){return this.createElementNSPlus("sld:VendorOption",{attributes:{name:option.name},value:option.value})},TextSymbolizer:function(symbolizer){var writers=OpenLayers.Format.SLD.v1_0_0.prototype.writers,node=writers.sld.TextSymbolizer.apply(this,arguments);return symbolizer.graphic!==!1&&(symbolizer.externalGraphic||symbolizer.graphicName)&&this.writeNode("Graphic",symbolizer,node),"priority"in symbolizer&&this.writeNode("Priority",symbolizer.priority,node),this.addVendorOptions(node,symbolizer)},PointSymbolizer:function(symbolizer){var writers=OpenLayers.Format.SLD.v1_0_0.prototype.writers,node=writers.sld.PointSymbolizer.apply(this,arguments);return this.addVendorOptions(node,symbolizer)},LineSymbolizer:function(symbolizer){var writers=OpenLayers.Format.SLD.v1_0_0.prototype.writers,node=writers.sld.LineSymbolizer.apply(this,arguments);return this.addVendorOptions(node,symbolizer)},PolygonSymbolizer:function(symbolizer){var writers=OpenLayers.Format.SLD.v1_0_0.prototype.writers,node=writers.sld.PolygonSymbolizer.apply(this,arguments);return this.addVendorOptions(node,symbolizer)}},OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.writers),addVendorOptions:function(node,symbolizer){var options=symbolizer.vendorOptions,key;if(options)for(key in symbolizer.vendorOptions)this.writeNode("VendorOption",{name:key,value:symbolizer.vendorOptions[key]},node);return node},CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0_GeoServer"});OpenLayers.Protocol.CSW=function(options){options=OpenLayers.Util.applyDefaults(options,OpenLayers.Protocol.CSW.DEFAULTS);var cls=OpenLayers.Protocol.CSW["v"+options.version.replace(/\./g,"_")];if(!cls)throw"Unsupported CSW version: "+options.version;return new cls(options)};OpenLayers.Protocol.CSW.DEFAULTS={version:"2.0.2"};OpenLayers.Protocol.WFS.v1_1_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.1.0",initialize:function(){OpenLayers.Protocol.WFS.v1.prototype.initialize.apply(this,arguments);this.outputFormat&&!this.readFormat&&(this.outputFormat.toLowerCase()=="gml2"?this.readFormat=new OpenLayers.Format.GML.v2({featureType:this.featureType,featureNS:this.featureNS,geometryName:this.geometryName}):this.outputFormat.toLowerCase()=="json"&&(this.readFormat=new OpenLayers.Format.GeoJSON))},CLASS_NAME:"OpenLayers.Protocol.WFS.v1_1_0"});OpenLayers.Format.WMTSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",yx:{"urn:ogc:def:crs:EPSG::4326":!0},createLayer:function(capabilities,config){var contents,layers,layerDef,format,matrixSet,style,requestEncoding,http,constraints,dimensions,params,id,ld,dimension,mid,url,resourceUrls,resourceUrl,t,tt,httpGet,constraint,i,ii;if(!("layer"in config))throw new Error("Missing property 'layer' in configuration.");for(contents=capabilities.contents,layers=contents.layers,i=0,ii=contents.layers.length;i<ii;++i)if(contents.layers[i].identifier===config.layer){layerDef=contents.layers[i];break}if(!layerDef)throw new Error("Layer not found");if(format=config.format,!format&&layerDef.formats&&layerDef.formats.length&&(format=layerDef.formats[0]),config.matrixSet?matrixSet=contents.tileMatrixSets[config.matrixSet]:layerDef.tileMatrixSetLinks.length>=1&&(matrixSet=contents.tileMatrixSets[layerDef.tileMatrixSetLinks[0].tileMatrixSet]),!matrixSet)throw new Error("matrixSet not found");for(i=0,ii=layerDef.styles.length;i<ii;++i)if(style=layerDef.styles[i],style.isDefault)break;for(requestEncoding=config.requestEncoding,requestEncoding||(requestEncoding="KVP",capabilities.operationsMetadata.GetTile.dcp.http&&(http=capabilities.operationsMetadata.GetTile.dcp.http,http.get[0].constraints&&(constraints=http.get[0].constraints,!constraints.GetEncoding.allowedValues.KVP&&constraints.GetEncoding.allowedValues.REST&&(requestEncoding="REST")))),dimensions=[],params=config.params||{},delete config.params,id=0,ld=layerDef.dimensions.length;id<ld;id++)dimension=layerDef.dimensions[id],dimensions.push(dimension.identifier),params.hasOwnProperty(dimension.identifier)||(params[dimension.identifier]=dimension["default"]);var projection=config.projection||matrixSet.supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"),units=config.units||(projection==="EPSG:4326"?"degrees":"m"),resolutions=[];if(config.isBaseLayer!==!1)for(mid in matrixSet.matrixIds)matrixSet.matrixIds.hasOwnProperty(mid)&&resolutions.push(matrixSet.matrixIds[mid].scaleDenominator*.00028/OpenLayers.METERS_PER_INCH/OpenLayers.INCHES_PER_UNIT[units]);if(requestEncoding==="REST"&&layerDef.resourceUrls)for(url=[],resourceUrls=layerDef.resourceUrls,t=0,tt=layerDef.resourceUrls.length;t<tt;++t)resourceUrl=layerDef.resourceUrls[t],resourceUrl.format===format&&resourceUrl.resourceType==="tile"&&url.push(resourceUrl.template);else for(httpGet=capabilities.operationsMetadata.GetTile.dcp.http.get,url=[],i=0,ii=httpGet.length;i<ii;i++)constraint=httpGet[i].constraints,(!constraint||constraint&&constraint.GetEncoding.allowedValues[requestEncoding])&&url.push(httpGet[i].url);return new OpenLayers.Layer.WMTS(OpenLayers.Util.applyDefaults(config,{url:url,requestEncoding:requestEncoding,name:layerDef.title,style:style.identifier,format:format,matrixIds:matrixSet.matrixIds,matrixSet:matrixSet.identifier,projection:projection,units:units,resolutions:config.isBaseLayer===!1?undefined:resolutions,tileFullExtent:matrixSet.bounds,dimensions:dimensions,params:params}))},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities"});OpenLayers.Layer.Google.v3={DEFAULTS:{sphericalMercator:!0,projection:"EPSG:900913"},animationEnabled:!0,loadMapObject:function(){var mapObject,cache,container,div,center;this.type||(this.type=google.maps.MapTypeId.ROADMAP);cache=OpenLayers.Layer.Google.cache[this.map.id];cache?(mapObject=cache.mapObject,++cache.count):(container=this.map.viewPortDiv,div=document.createElement("div"),div.id=this.map.id+"_GMapContainer",div.style.position="absolute",div.style.width="100%",div.style.height="100%",container.appendChild(div),center=this.map.getCenter(),mapObject=new google.maps.Map(div,{center:center?new google.maps.LatLng(center.lat,center.lon):new google.maps.LatLng(0,0),zoom:this.map.getZoom()||0,mapTypeId:this.type,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1}),cache={mapObject:mapObject,count:1},OpenLayers.Layer.Google.cache[this.map.id]=cache,this.repositionListener=google.maps.event.addListenerOnce(mapObject,"center_changed",OpenLayers.Function.bind(this.repositionMapElements,this)));this.mapObject=mapObject;this.setGMapVisibility(this.visibility)},repositionMapElements:function(){var div,cache,container,i,termsOfUse,poweredBy;if(google.maps.event.trigger(this.mapObject,"resize"),div=this.mapObject.getDiv().firstChild,!div||div.childNodes.length<3)return this.repositionTimer=window.setTimeout(OpenLayers.Function.bind(this.repositionMapElements,this),250),!1;for(cache=OpenLayers.Layer.Google.cache[this.map.id],container=this.map.viewPortDiv,i=div.children.length-1;i>=0;--i)div.children[i].style.zIndex==1000001&&(termsOfUse=div.children[i],container.appendChild(termsOfUse),termsOfUse.style.zIndex="1100",termsOfUse.style.bottom="",termsOfUse.className="olLayerGoogleCopyright olLayerGoogleV3",termsOfUse.style.display="",cache.termsOfUse=termsOfUse),div.children[i].style.zIndex==1e6&&(poweredBy=div.children[i],container.appendChild(poweredBy),poweredBy.style.zIndex="1100",poweredBy.style.bottom="",poweredBy.className="olLayerGooglePoweredBy olLayerGoogleV3 gmnoprint",poweredBy.style.display="",cache.poweredBy=poweredBy),div.children[i].style.zIndex==10000002&&container.appendChild(div.children[i]);this.setGMapVisibility(this.visibility)},onMapResize:function(){var cache,layer;this.visibility?google.maps.event.trigger(this.mapObject,"resize"):(cache=OpenLayers.Layer.Google.cache[this.map.id],cache.resized||(layer=this,google.maps.event.addListenerOnce(this.mapObject,"tilesloaded",function(){google.maps.event.trigger(layer.mapObject,"resize");layer.moveTo(layer.map.getCenter(),layer.map.getZoom());delete cache.resized})),cache.resized=!0)},setGMapVisibility:function(visible){var cache=OpenLayers.Layer.Google.cache[this.map.id],type,layers,layer,i,container;if(cache){for(type=this.type,layers=this.map.layers,i=layers.length-1;i>=0;--i)if(layer=layers[i],layer instanceof OpenLayers.Layer.Google&&layer.visibility===!0&&layer.inRange===!0){type=layer.type;visible=!0;break}container=this.mapObject.getDiv();visible===!0?(this.mapObject.setMapTypeId(type),container.style.left="",cache.termsOfUse&&cache.termsOfUse.style&&(cache.termsOfUse.style.left="",cache.termsOfUse.style.display="",cache.poweredBy.style.display=""),cache.displayed=this.id):(delete cache.displayed,container.style.left="-9999px",cache.termsOfUse&&cache.termsOfUse.style&&(cache.termsOfUse.style.display="none",cache.termsOfUse.style.left="-9999px",cache.poweredBy.style.display="none"))}},getMapContainer:function(){return this.mapObject.getDiv()},getMapObjectBoundsFromOLBounds:function(olBounds){var moBounds=null,sw,ne;return olBounds!=null&&(sw=this.sphericalMercator?this.inverseMercator(olBounds.bottom,olBounds.left):new OpenLayers.LonLat(olBounds.bottom,olBounds.left),ne=this.sphericalMercator?this.inverseMercator(olBounds.top,olBounds.right):new OpenLayers.LonLat(olBounds.top,olBounds.right),moBounds=new google.maps.LatLngBounds(new google.maps.LatLng(sw.lat,sw.lon),new google.maps.LatLng(ne.lat,ne.lon))),moBounds},getMapObjectLonLatFromMapObjectPixel:function(moPixel){var size=this.map.getSize(),lon=this.getLongitudeFromMapObjectLonLat(this.mapObject.center),lat=this.getLatitudeFromMapObjectLonLat(this.mapObject.center),res=this.map.getResolution(),delta_x=moPixel.x-size.w/2,delta_y=moPixel.y-size.h/2,lonlat=new OpenLayers.LonLat(lon+delta_x*res,lat-delta_y*res);return this.wrapDateLine&&(lonlat=lonlat.wrapDateLine(this.maxExtent)),this.getMapObjectLonLatFromLonLat(lonlat.lon,lonlat.lat)},getMapObjectPixelFromMapObjectLonLat:function(moLonLat){var lon=this.getLongitudeFromMapObjectLonLat(moLonLat),lat=this.getLatitudeFromMapObjectLonLat(moLonLat),res=this.map.getResolution(),extent=this.map.getExtent();return this.getMapObjectPixelFromXY(1/res*(lon-extent.left),1/res*(extent.top-lat))},setMapObjectCenter:function(center,zoom){if(this.animationEnabled===!1&&zoom!=this.mapObject.zoom){var mapContainer=this.getMapContainer();google.maps.event.addListenerOnce(this.mapObject,"idle",function(){mapContainer.style.visibility=""});mapContainer.style.visibility="hidden"}this.mapObject.setOptions({center:center,zoom:zoom})},getMapObjectZoomFromMapObjectBounds:function(moBounds){return this.mapObject.getBoundsZoomLevel(moBounds)},getMapObjectLonLatFromLonLat:function(lon,lat){var gLatLng,lonlat;return this.sphericalMercator?(lonlat=this.inverseMercator(lon,lat),gLatLng=new google.maps.LatLng(lonlat.lat,lonlat.lon)):gLatLng=new google.maps.LatLng(lat,lon),gLatLng},getMapObjectPixelFromXY:function(x,y){return new google.maps.Point(x,y)},destroy:function(){this.repositionListener&&google.maps.event.removeListener(this.repositionListener);this.repositionTimer&&window.clearTimeout(this.repositionTimer);OpenLayers.Layer.Google.prototype.destroy.apply(this,arguments)}};OpenLayers.Format.WPSDescribeProcess=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{wps:"http://www.opengis.net/wps/1.0.0",ows:"http://www.opengis.net/ows/1.1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",defaultPrefix:"wps",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(data){typeof data=="string"&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data]));data&&data.nodeType==9&&(data=data.documentElement);var info={};return this.readNode(data,info),info},readers:{wps:{ProcessDescriptions:function(node,obj){obj.processDescriptions={};this.readChildNodes(node,obj.processDescriptions)},ProcessDescription:function(node,processDescriptions){var processVersion=this.getAttributeNS(node,this.namespaces.wps,"processVersion"),processDescription={processVersion:processVersion,statusSupported:node.getAttribute("statusSupported")==="true",storeSupported:node.getAttribute("storeSupported")==="true"};this.readChildNodes(node,processDescription);processDescriptions[processDescription.identifier]=processDescription},DataInputs:function(node,processDescription){processDescription.dataInputs=[];this.readChildNodes(node,processDescription.dataInputs)},ProcessOutputs:function(node,processDescription){processDescription.processOutputs=[];this.readChildNodes(node,processDescription.processOutputs)},Output:function(node,processOutputs){var output={};this.readChildNodes(node,output);processOutputs.push(output)},ComplexOutput:function(node,output){output.complexOutput={};this.readChildNodes(node,output.complexOutput)},LiteralOutput:function(node,output){output.literalOutput={};this.readChildNodes(node,output.literalOutput)},Input:function(node,dataInputs){var input={maxOccurs:parseInt(node.getAttribute("maxOccurs")),minOccurs:parseInt(node.getAttribute("minOccurs"))};this.readChildNodes(node,input);dataInputs.push(input)},BoundingBoxData:function(node,input){input.boundingBoxData={};this.readChildNodes(node,input.boundingBoxData)},CRS:function(node,obj){obj.CRSs||(obj.CRSs={});obj.CRSs[this.getChildValue(node)]=!0},LiteralData:function(node,input){input.literalData={};this.readChildNodes(node,input.literalData)},ComplexData:function(node,input){input.complexData={};this.readChildNodes(node,input.complexData)},Default:function(node,complexData){complexData["default"]={};this.readChildNodes(node,complexData["default"])},Supported:function(node,complexData){complexData.supported={};this.readChildNodes(node,complexData.supported)},Format:function(node,obj){var format={};this.readChildNodes(node,format);obj.formats||(obj.formats={});obj.formats[format.mimeType]=!0},MimeType:function(node,format){format.mimeType=this.getChildValue(node)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSDescribeProcess"});OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(options){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/};OpenLayers.Format.prototype.initialize.apply(this,[options])},read:function(wkt){var features,type,str,matches,i,len,component;if(wkt=wkt.replace(/[\n\r]/g," "),matches=this.regExes.typeStr.exec(wkt),matches&&(type=matches[1].toLowerCase(),str=matches[2],this.parse[type]&&(features=this.parse[type].apply(this,[str])),this.internalProjection&&this.externalProjection))if(features&&features.CLASS_NAME=="OpenLayers.Feature.Vector")features.geometry.transform(this.externalProjection,this.internalProjection);else if(features&&type!="geometrycollection"&&typeof features=="object")for(i=0,len=features.length;i<len;i++)component=features[i],component.geometry.transform(this.externalProjection,this.internalProjection);return features},write:function(features){var collection,geometry,isCollection,pieces,i,len;for(features.constructor==Array?(collection=features,isCollection=!0):(collection=[features],isCollection=!1),pieces=[],isCollection&&pieces.push("GEOMETRYCOLLECTION("),i=0,len=collection.length;i<len;++i)isCollection&&i>0&&pieces.push(","),geometry=collection[i].geometry,pieces.push(this.extractGeometry(geometry));return isCollection&&pieces.push(")"),pieces.join("")},extractGeometry:function(geometry){var type=geometry.CLASS_NAME.split(".")[2].toLowerCase(),wktType,data;return this.extract[type]?(this.internalProjection&&this.externalProjection&&(geometry=geometry.clone(),geometry.transform(this.internalProjection,this.externalProjection)),wktType=type=="collection"?"GEOMETRYCOLLECTION":type.toUpperCase(),data=wktType+"("+this.extract[type].apply(this,[geometry])+")",data):null},extract:{point:function(point){return point.x+" "+point.y},multipoint:function(multipoint){for(var array=[],i=0,len=multipoint.components.length;i<len;++i)array.push("("+this.extract.point.apply(this,[multipoint.components[i]])+")");return array.join(",")},linestring:function(linestring){for(var array=[],i=0,len=linestring.components.length;i<len;++i)array.push(this.extract.point.apply(this,[linestring.components[i]]));return array.join(",")},multilinestring:function(multilinestring){for(var array=[],i=0,len=multilinestring.components.length;i<len;++i)array.push("("+this.extract.linestring.apply(this,[multilinestring.components[i]])+")");return array.join(",")},polygon:function(polygon){for(var array=[],i=0,len=polygon.components.length;i<len;++i)array.push("("+this.extract.linestring.apply(this,[polygon.components[i]])+")");return array.join(",")},multipolygon:function(multipolygon){for(var array=[],i=0,len=multipolygon.components.length;i<len;++i)array.push("("+this.extract.polygon.apply(this,[multipolygon.components[i]])+")");return array.join(",")},collection:function(collection){for(var array=[],i=0,len=collection.components.length;i<len;++i)array.push(this.extractGeometry.apply(this,[collection.components[i]]));return array.join(",")}},parse:{point:function(str){var coords=OpenLayers.String.trim(str).split(this.regExes.spaces);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(coords[0],coords[1]))},multipoint:function(str){for(var point,points=OpenLayers.String.trim(str).split(","),components=[],i=0,len=points.length;i<len;++i)point=points[i].replace(this.regExes.trimParens,"$1"),components.push(this.parse.point.apply(this,[point]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(components))},linestring:function(str){for(var points=OpenLayers.String.trim(str).split(","),components=[],i=0,len=points.length;i<len;++i)components.push(this.parse.point.apply(this,[points[i]]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(components))},multilinestring:function(str){for(var line,lines=OpenLayers.String.trim(str).split(this.regExes.parenComma),components=[],i=0,len=lines.length;i<len;++i)line=lines[i].replace(this.regExes.trimParens,"$1"),components.push(this.parse.linestring.apply(this,[line]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(components))},polygon:function(str){for(var ring,linestring,linearring,rings=OpenLayers.String.trim(str).split(this.regExes.parenComma),components=[],i=0,len=rings.length;i<len;++i)ring=rings[i].replace(this.regExes.trimParens,"$1"),linestring=this.parse.linestring.apply(this,[ring]).geometry,linearring=new OpenLayers.Geometry.LinearRing(linestring.components),components.push(linearring);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(components))},multipolygon:function(str){for(var polygon,polygons=OpenLayers.String.trim(str).split(this.regExes.doubleParenComma),components=[],i=0,len=polygons.length;i<len;++i)polygon=polygons[i].replace(this.regExes.trimParens,"$1"),components.push(this.parse.polygon.apply(this,[polygon]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(components))},geometrycollection:function(str){var wktArray,components,i,len;for(str=str.replace(/,\s*([A-Za-z])/g,"|$1"),wktArray=OpenLayers.String.trim(str).split("|"),components=[],i=0,len=wktArray.length;i<len;++i)components.push(OpenLayers.Format.WKT.prototype.read.apply(this,[wktArray[i]]));return components}},CLASS_NAME:"OpenLayers.Format.WKT"});OpenLayers.WPSProcess=OpenLayers.Class({client:null,server:null,identifier:null,description:null,localWPS:"http://geoserver/wps",formats:null,chained:0,executeCallbacks:null,initialize:function(options){OpenLayers.Util.extend(this,options);this.executeCallbacks=[];this.formats={"application/wkt":new OpenLayers.Format.WKT,"application/json":new OpenLayers.Format.GeoJSON}},describe:function(options){if(options=options||{},this.description){if(options.callback){var description=this.description;window.setTimeout(function(){options.callback.call(options.scope,description)},0)}}else this.client.describeProcess(this.server,this.identifier,function(description){this.description||this.parseDescription(description);options.callback&&options.callback.call(options.scope,this.description)},this)},configure:function(options){return this.describe({callback:function(){for(var description=this.description,inputs=options.inputs,input,i=0,ii=description.dataInputs.length;i<ii;++i)input=description.dataInputs[i],this.setInputData(input,inputs[input.identifier]);options.callback&&options.callback.call(options.scope)},scope:this}),this},execute:function(options){this.configure({inputs:options.inputs,callback:function(){var me=this,outputIndex=this.getOutputIndex(me.description.processOutputs,options.output);me.setResponseForm({outputIndex:outputIndex}),function callback(){if(OpenLayers.Util.removeItem(me.executeCallbacks,callback),me.chained!==0){me.executeCallbacks.push(callback);return}OpenLayers.Request.POST({url:me.client.servers[me.server].url,data:(new OpenLayers.Format.WPSExecute).write(me.description),success:function(response){var output=me.description.processOutputs[outputIndex],mimeType=me.findMimeType(output.complexOutput.supported.formats),features=me.formats[mimeType].read(response.responseText),outputs;features instanceof OpenLayers.Feature.Vector&&(features=[features]);options.success&&(outputs={},outputs[options.output||"result"]=features,options.success.call(options.scope,outputs))},scope:me})}()},scope:this})},output:function(identifier){return new OpenLayers.WPSProcess.ChainLink({process:this,output:identifier})},parseDescription:function(){var server=this.client.servers[this.server];this.description=(new OpenLayers.Format.WPSDescribeProcess).read(server.processDescription[this.identifier]).processDescriptions[this.identifier]},setInputData:function(input,data){var complexData,format;delete input.data;delete input.reference;data instanceof OpenLayers.WPSProcess.ChainLink?(++this.chained,input.reference={method:"POST",href:data.process.server===this.server?this.localWPS:this.client.servers[data.process.server].url},data.process.describe({callback:function(){--this.chained;this.chainProcess(input,data)},scope:this})):(input.data={},complexData=input.complexData,complexData?(format=this.findMimeType(complexData.supported.formats),input.data.complexData={mimeType:format,value:this.formats[format].write(this.toFeatures(data))}):input.data.literalData={value:data})},setResponseForm:function(options){options=options||{};var output=this.description.processOutputs[options.outputIndex||0];this.description.responseForm={rawDataOutput:{identifier:output.identifier,mimeType:this.findMimeType(output.complexOutput.supported.formats,options.supportedFormats)}}},getOutputIndex:function(outputs,identifier){var output,i;if(identifier){for(i=outputs.length-1;i>=0;--i)if(outputs[i].identifier===identifier){output=i;break}}else output=0;return output},chainProcess:function(input,chainLink){var output=this.getOutputIndex(chainLink.process.description.processOutputs,chainLink.output),formats;for(input.reference.mimeType=this.findMimeType(input.complexData.supported.formats,chainLink.process.description.processOutputs[output].complexOutput.supported.formats),formats={},formats[input.reference.mimeType]=!0,chainLink.process.setResponseForm({outputIndex:output,supportedFormats:formats}),input.reference.body=chainLink.process.description;this.executeCallbacks.length>0;)this.executeCallbacks[0]()},toFeatures:function(source){var isArray=OpenLayers.Util.isArray(source),target,current,i,ii;for(isArray||(source=[source]),target=new Array(source.length),i=0,ii=source.length;i<ii;++i)current=source[i],target[i]=current instanceof OpenLayers.Feature.Vector?current:new OpenLayers.Feature.Vector(current);return isArray?target:target[0]},findMimeType:function(sourceFormats,targetFormats){targetFormats=targetFormats||this.formats;for(var f in sourceFormats)if(f in targetFormats)return f},CLASS_NAME:"OpenLayers.WPSProcess"});OpenLayers.WPSProcess.ChainLink=OpenLayers.Class({process:null,output:null,initialize:function(options){OpenLayers.Util.extend(this,options)},CLASS_NAME:"OpenLayers.WPSProcess.ChainLink"});OpenLayers.WPSClient=OpenLayers.Class({servers:null,version:"1.0.0",lazy:!1,events:null,initialize:function(options){OpenLayers.Util.extend(this,options);this.events=new OpenLayers.Events(this);this.servers={};for(var s in options.servers)this.servers[s]=typeof options.servers[s]=="string"?{url:options.servers[s],version:this.version,processDescription:{}}:options.servers[s]},execute:function(options){var process=this.getProcess(options.server,options.process);process.execute({inputs:options.inputs,success:options.success,scope:options.scope})},getProcess:function(serverID,processID){var process=new OpenLayers.WPSProcess({client:this,server:serverID,identifier:processID});return this.lazy||process.describe(),process},describeProcess:function(serverID,processID,callback,scope){var server=this.servers[serverID];server.processDescription[processID]?window.setTimeout(function(){callback.call(scope,server.processDescription[processID])},0):processID in server.processDescription?this.events.register("describeprocess",this,function describe(evt){evt.identifier===processID&&(this.events.unregister("describeprocess",this,describe),callback.call(scope,evt.raw))}):(server.processDescription[processID]=null,OpenLayers.Request.GET({url:server.url,params:{SERVICE:"WPS",VERSION:server.version,REQUEST:"DescribeProcess",IDENTIFIER:processID},success:function(response){server.processDescription[processID]=response.responseText;this.events.triggerEvent("describeprocess",{identifier:processID,raw:response.responseText})},scope:this}))},destroy:function(){this.events.destroy();this.events=null;this.servers=null},CLASS_NAME:"OpenLayers.WPSClient"});OpenLayers.Format.CSWGetRecords.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",gmd:"http://www.isotc211.org/2005/gmd",geonet:"http://www.fao.org/geonetwork",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",requestId:null,resultType:null,outputFormat:null,outputSchema:null,startPosition:null,maxRecords:null,DistributedSearch:null,ResponseHandler:null,Query:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options])},read:function(data){typeof data=="string"&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data]));data&&data.nodeType==9&&(data=data.documentElement);var obj={};return this.readNode(data,obj),obj},readers:{csw:{GetRecordsResponse:function(node,obj){obj.records=[];this.readChildNodes(node,obj);var version=this.getAttributeNS(node,"","version");version!=""&&(obj.version=version)},RequestId:function(node,obj){obj.RequestId=this.getChildValue(node)},SearchStatus:function(node,obj){obj.SearchStatus={};var timestamp=this.getAttributeNS(node,"","timestamp");timestamp!=""&&(obj.SearchStatus.timestamp=timestamp)},SearchResults:function(node,obj){var attrs,SearchResults,i,len;for(this.readChildNodes(node,obj),attrs=node.attributes,SearchResults={},i=0,len=attrs.length;i<len;++i)SearchResults[attrs[i].name]=attrs[i].name=="numberOfRecordsMatched"||attrs[i].name=="numberOfRecordsReturned"||attrs[i].name=="nextRecord"?parseInt(attrs[i].nodeValue):attrs[i].nodeValue;obj.SearchResults=SearchResults},SummaryRecord:function(node,obj){var record={type:"SummaryRecord"};this.readChildNodes(node,record);obj.records.push(record)},BriefRecord:function(node,obj){var record={type:"BriefRecord"};this.readChildNodes(node,record);obj.records.push(record)},DCMIRecord:function(node,obj){var record={type:"DCMIRecord"};this.readChildNodes(node,record);obj.records.push(record)},Record:function(node,obj){var record={type:"Record"};this.readChildNodes(node,record);obj.records.push(record)},"*":function(node,obj){var name=node.localName||node.nodeName.split(":").pop();obj[name]=this.getChildValue(node)}},geonet:{info:function(node,obj){var gninfo={};this.readChildNodes(node,gninfo);obj.gninfo=gninfo}},dc:{"*":function(node,obj){var name=node.localName||node.nodeName.split(":").pop(),dc_element,attrs,i,len;for(OpenLayers.Util.isArray(obj[name])||(obj[name]=[]),dc_element={},attrs=node.attributes,i=0,len=attrs.length;i<len;++i)dc_element[attrs[i].name]=attrs[i].nodeValue;dc_element.value=this.getChildValue(node);dc_element.value!=""&&obj[name].push(dc_element)}},dct:{"*":function(node,obj){var name=node.localName||node.nodeName.split(":").pop();OpenLayers.Util.isArray(obj[name])||(obj[name]=[]);obj[name].push(this.getChildValue(node))}},ows:OpenLayers.Util.applyDefaults({BoundingBox:function(node,obj){obj.bounds&&(obj.BoundingBox=[{crs:obj.projection,value:[obj.bounds.left,obj.bounds.bottom,obj.bounds.right,obj.bounds.top]}],delete obj.projection,delete obj.bounds);OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows.BoundingBox.apply(this,arguments)}},OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows)},write:function(options){var node=this.writeNode("csw:GetRecords",options);return node.setAttribute("xmlns:gmd",this.namespaces.gmd),OpenLayers.Format.XML.prototype.write.apply(this,[node])},writers:{csw:{GetRecords:function(options){var node,ResponseHandler,i,len;if(options||(options={}),node=this.createElementNSPlus("csw:GetRecords",{attributes:{service:"CSW",version:this.version,requestId:options.requestId||this.requestId,resultType:options.resultType||this.resultType,outputFormat:options.outputFormat||this.outputFormat,outputSchema:options.outputSchema||this.outputSchema,startPosition:options.startPosition||this.startPosition,maxRecords:options.maxRecords||this.maxRecords}}),(options.DistributedSearch||this.DistributedSearch)&&this.writeNode("csw:DistributedSearch",options.DistributedSearch||this.DistributedSearch,node),ResponseHandler=options.ResponseHandler||this.ResponseHandler,OpenLayers.Util.isArray(ResponseHandler)&&ResponseHandler.length>0)for(i=0,len=ResponseHandler.length;i<len;i++)this.writeNode("csw:ResponseHandler",ResponseHandler[i],node);return this.writeNode("Query",options.Query||this.Query,node),node},DistributedSearch:function(options){return this.createElementNSPlus("csw:DistributedSearch",{attributes:{hopCount:options.hopCount}})},ResponseHandler:function(options){return this.createElementNSPlus("csw:ResponseHandler",{value:options.value})},Query:function(options){var node,ElementName,i,len;if(options||(options={}),node=this.createElementNSPlus("csw:Query",{attributes:{typeNames:options.typeNames||"csw:Record"}}),ElementName=options.ElementName,OpenLayers.Util.isArray(ElementName)&&ElementName.length>0)for(i=0,len=ElementName.length;i<len;i++)this.writeNode("csw:ElementName",ElementName[i],node);else this.writeNode("csw:ElementSetName",options.ElementSetName||{value:"summary"},node);return options.Constraint&&this.writeNode("csw:Constraint",options.Constraint,node),options.SortBy&&this.writeNode("ogc:SortBy",options.SortBy,node),node},ElementName:function(options){return this.createElementNSPlus("csw:ElementName",{value:options.value})},ElementSetName:function(options){return this.createElementNSPlus("csw:ElementSetName",{attributes:{typeNames:options.typeNames},value:options.value})},Constraint:function(options){var node=this.createElementNSPlus("csw:Constraint",{attributes:{version:options.version}}),format,child;return options.Filter?(format=new OpenLayers.Format.Filter({version:options.version}),node.appendChild(format.write(options.Filter))):options.CqlText&&(child=this.createElementNSPlus("CqlText",{value:options.CqlText.value}),node.appendChild(child)),node}},ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_2"});OpenLayers.Marker.Box=OpenLayers.Class(OpenLayers.Marker,{bounds:null,div:null,initialize:function(bounds,borderColor,borderWidth){this.bounds=bounds;this.div=OpenLayers.Util.createDiv();this.div.style.overflow="hidden";this.events=new OpenLayers.Events(this,this.div);this.setBorder(borderColor,borderWidth)},destroy:function(){this.bounds=null;this.div=null;OpenLayers.Marker.prototype.destroy.apply(this,arguments)},setBorder:function(color,width){color||(color="red");width||(width=2);this.div.style.border=width+"px solid "+color},draw:function(px,sz){return OpenLayers.Util.modifyDOMElement(this.div,null,px,sz),this.div},onScreen:function(){var onScreen=!1,screenBounds;return this.map&&(screenBounds=this.map.getExtent(),onScreen=screenBounds.containsBounds(this.bounds,!0,!0)),onScreen},display:function(display){this.div.style.display=display?"":"none"},CLASS_NAME:"OpenLayers.Marker.Box"});OpenLayers.Format.Text=OpenLayers.Class(OpenLayers.Format,{defaultStyle:null,extractStyles:!0,initialize:function(options){options=options||{};options.extractStyles!==!1&&(options.defaultStyle={externalGraphic:OpenLayers.Util.getImageLocation("marker.png"),graphicWidth:21,graphicHeight:25,graphicXOffset:-10.5,graphicYOffset:-12.5});OpenLayers.Format.prototype.initialize.apply(this,[options])},read:function(text){for(var currLine,valIndex,coords,size,offset,feature,lines=text.split("\n"),columns,features=[],lcv=0;lcv<lines.length-1;lcv++)if(currLine=lines[lcv].replace(/^\s*/,"").replace(/\s*$/,""),currLine.charAt(0)!="#")if(columns){var vals=currLine.split("\t"),geometry=new OpenLayers.Geometry.Point(0,0),attributes={},style=this.defaultStyle?OpenLayers.Util.applyDefaults({},this.defaultStyle):null,set=!1;for(valIndex=0;valIndex<vals.length;valIndex++)vals[valIndex]&&(columns[valIndex]=="point"?(coords=vals[valIndex].split(","),geometry.y=parseFloat(coords[0]),geometry.x=parseFloat(coords[1]),set=!0):columns[valIndex]=="lat"?(geometry.y=parseFloat(vals[valIndex]),set=!0):columns[valIndex]=="lon"?(geometry.x=parseFloat(vals[valIndex]),set=!0):columns[valIndex]=="title"?attributes.title=vals[valIndex]:columns[valIndex]=="image"||columns[valIndex]=="icon"&&style?style.externalGraphic=vals[valIndex]:columns[valIndex]=="iconSize"&&style?(size=vals[valIndex].split(","),style.graphicWidth=parseFloat(size[0]),style.graphicHeight=parseFloat(size[1])):columns[valIndex]=="iconOffset"&&style?(offset=vals[valIndex].split(","),style.graphicXOffset=parseFloat(offset[0]),style.graphicYOffset=parseFloat(offset[1])):columns[valIndex]=="description"?attributes.description=vals[valIndex]:columns[valIndex]=="overflow"?attributes.overflow=vals[valIndex]:attributes[columns[valIndex]]=vals[valIndex]);set&&(this.internalProjection&&this.externalProjection&&geometry.transform(this.externalProjection,this.internalProjection),feature=new OpenLayers.Feature.Vector(geometry,attributes,style),features.push(feature))}else columns=currLine.split("\t");return features},CLASS_NAME:"OpenLayers.Format.Text"});OpenLayers.Layer.Text=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,initialize:function(){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments);this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments);this.clearFeatures();this.features=null},loadText:function(){if(!this.loaded&&this.location!=null){var onFail=function(){this.events.triggerEvent("loadend")};this.events.triggerEvent("loadstart");OpenLayers.Request.GET({url:this.location,success:this.parseData,failure:onFail,scope:this});this.loaded=!0}},moveTo:function(){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);this.visibility&&!this.loaded&&this.loadText()},parseData:function(ajaxRequest){var text=ajaxRequest.responseText,options={},parser,features,i,len,data,feature,location,iconSize,iconOffset,markerFeature,marker;for(OpenLayers.Util.extend(options,this.formatOptions),this.map&&!this.projection.equals(this.map.getProjectionObject())&&(options.externalProjection=this.projection,options.internalProjection=this.map.getProjectionObject()),parser=new OpenLayers.Format.Text(options),features=parser.read(text),i=0,len=features.length;i<len;i++)data={},feature=features[i],location=new OpenLayers.LonLat(feature.geometry.x,feature.geometry.y),feature.style.graphicWidth&&feature.style.graphicHeight&&(iconSize=new OpenLayers.Size(feature.style.graphicWidth,feature.style.graphicHeight)),feature.style.graphicXOffset!==undefined&&feature.style.graphicYOffset!==undefined&&(iconOffset=new OpenLayers.Pixel(feature.style.graphicXOffset,feature.style.graphicYOffset)),feature.style.externalGraphic!=null?data.icon=new OpenLayers.Icon(feature.style.externalGraphic,iconSize,iconOffset):(data.icon=OpenLayers.Marker.defaultIcon(),iconSize!=null&&data.icon.setSize(iconSize)),feature.attributes.title!=null&&feature.attributes.description!=null&&(data.popupContentHTML="<h2>"+feature.attributes.title+"<\/h2><p>"+feature.attributes.description+"<\/p>"),data.overflow=feature.attributes.overflow||"auto",markerFeature=new OpenLayers.Feature(this,location,data),this.features.push(markerFeature),marker=markerFeature.createMarker(),feature.attributes.title!=null&&feature.attributes.description!=null&&marker.events.register("click",markerFeature,this.markerClick),this.addMarker(marker);this.events.triggerEvent("loadend")},markerClick:function(evt){var sameMarkerClicked=this==this.layer.selectedFeature,i,len;for(this.layer.selectedFeature=sameMarkerClicked?null:this,i=0,len=this.layer.map.popups.length;i<len;i++)this.layer.map.removePopup(this.layer.map.popups[i]);sameMarkerClicked||this.layer.map.addPopup(this.createPopup());OpenLayers.Event.stop(evt)},clearFeatures:function(){if(this.features!=null)while(this.features.length>0){var feature=this.features[0];OpenLayers.Util.removeItem(this.features,feature);feature.destroy()}},CLASS_NAME:"OpenLayers.Layer.Text"});OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",layerOptions:null,persist:!1,irregular:!1,citeCompliant:!1,angle:null,fixedRadius:!1,feature:null,layer:null,origin:null,initialize:function(control,callbacks,options){options&&options.layerOptions&&options.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{}));OpenLayers.Handler.Drag.prototype.initialize.apply(this,[control,callbacks,options]);this.options=options?options:{}},setOptions:function(newOptions){OpenLayers.Util.extend(this.options,newOptions);OpenLayers.Util.extend(this,newOptions)},activate:function(){var activated=!1,options;return OpenLayers.Handler.Drag.prototype.activate.apply(this,arguments)&&(options=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions),this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,options),this.map.addLayer(this.layer),activated=!0),activated},deactivate:function(){var deactivated=!1;return OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)&&(this.dragging&&this.cancel(),this.layer.map!=null&&(this.layer.destroy(!1),this.feature&&this.feature.destroy()),this.layer=null,this.feature=null,deactivated=!0),deactivated},down:function(evt){this.fixedRadius=!!this.radius;var maploc=this.layer.getLonLatFromViewPortPx(evt.xy);this.origin=new OpenLayers.Geometry.Point(maploc.lon,maploc.lat);(!this.fixedRadius||this.irregular)&&(this.radius=this.map.getResolution());this.persist&&this.clear();this.feature=new OpenLayers.Feature.Vector;this.createGeometry();this.callback("create",[this.origin,this.feature]);this.layer.addFeatures([this.feature],{silent:!0});this.layer.drawFeature(this.feature,this.style)},move:function(evt){var maploc=this.layer.getLonLatFromViewPortPx(evt.xy),point=new OpenLayers.Geometry.Point(maploc.lon,maploc.lat),ry,dx,dy,ratio;this.irregular?(ry=Math.sqrt(2)*Math.abs(point.y-this.origin.y)/2,this.radius=Math.max(this.map.getResolution()/2,ry)):this.fixedRadius?this.origin=point:(this.calculateAngle(point,evt),this.radius=Math.max(this.map.getResolution()/2,point.distanceTo(this.origin)));this.modifyGeometry();this.irregular&&(dx=point.x-this.origin.x,dy=point.y-this.origin.y,ratio=dy==0?dx/(this.radius*Math.sqrt(2)):dx/dy,this.feature.geometry.resize(1,this.origin,ratio),this.feature.geometry.move(dx/2,dy/2));this.layer.drawFeature(this.feature,this.style)},up:function(evt){this.finalize();this.start==this.last&&this.callback("done",[evt.xy])},out:function(){this.finalize()},createGeometry:function(){this.angle=Math.PI*(1/this.sides-1/2);this.snapAngle&&(this.angle+=this.snapAngle*(Math.PI/180));this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle)},modifyGeometry:function(){var angle,point,ring=this.feature.geometry.components[0],i;for(ring.components.length!=this.sides+1&&(this.createGeometry(),ring=this.feature.geometry.components[0]),i=0;i<this.sides;++i)point=ring.components[i],angle=this.angle+i*2*Math.PI/this.sides,point.x=this.origin.x+this.radius*Math.cos(angle),point.y=this.origin.y+this.radius*Math.sin(angle),point.clearBounds()},calculateAngle:function(point,evt){var alpha=Math.atan2(point.y-this.origin.y,point.x-this.origin.x),snapAngleRad;this.snapAngle&&this.snapToggle&&!evt[this.snapToggle]?(snapAngleRad=Math.PI/180*this.snapAngle,this.angle=Math.round(alpha/snapAngleRad)*snapAngleRad):this.angle=alpha},cancel:function(){this.callback("cancel",null);this.finalize()},finalize:function(){this.origin=null;this.radius=this.options.radius},clear:function(){this.layer&&(this.layer.renderer.clear(),this.layer.destroyFeatures())},callback:function(name){this.callbacks[name]&&this.callbacks[name].apply(this.control,[this.feature.geometry.clone()]);this.persist||name!="done"&&name!="cancel"||this.clear()},CLASS_NAME:"OpenLayers.Handler.RegularPolygon"});OpenLayers.Control.SLDSelect=OpenLayers.Class(OpenLayers.Control,{clearOnDeactivate:!1,layers:null,callbacks:null,selectionSymbolizer:{Polygon:{fillColor:"#FF0000",stroke:!1},Line:{strokeColor:"#FF0000",strokeWidth:2},Point:{graphicName:"square",fillColor:"#FF0000",pointRadius:5}},layerOptions:null,sketchStyle:null,wfsCache:{},layerCache:{},initialize:function(handler,options){OpenLayers.Control.prototype.initialize.apply(this,[options]);this.callbacks=OpenLayers.Util.extend({done:this.select,click:this.select},this.callbacks);this.handlerOptions=this.handlerOptions||{};this.layerOptions=OpenLayers.Util.applyDefaults(this.layerOptions,{displayInLayerSwitcher:!1,tileOptions:{maxGetUrlLength:2048}});this.sketchStyle&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":this.sketchStyle})}));this.handler=new handler(this,this.callbacks,this.handlerOptions)},destroy:function(){for(var key in this.layerCache)delete this.layerCache[key];for(key in this.wfsCache)delete this.wfsCache[key];OpenLayers.Control.prototype.destroy.apply(this,arguments)},coupleLayerVisiblity:function(evt){this.setVisibility(evt.object.getVisibility())},createSelectionLayer:function(source){var selectionLayer;if(this.layerCache[source.id])selectionLayer=this.layerCache[source.id];else{if(selectionLayer=new OpenLayers.Layer.WMS(source.name,source.url,source.params,OpenLayers.Util.applyDefaults(this.layerOptions,source.getOptions())),this.layerCache[source.id]=selectionLayer,this.layerOptions.displayInLayerSwitcher===!1)source.events.on({visibilitychanged:this.coupleLayerVisiblity,scope:selectionLayer});this.map.addLayer(selectionLayer)}return selectionLayer},createSLD:function(layer,filters,geometryAttributes){for(var name,symbolizer,geometryAttribute,filter,sld={version:"1.0.0",namedLayers:{}},layerNames=[layer.params.LAYERS].join(",").split(","),i=0,len=layerNames.length;i<len;i++)name=layerNames[i],sld.namedLayers[name]={name:name,userStyles:[]},symbolizer=this.selectionSymbolizer,geometryAttribute=geometryAttributes[i],geometryAttribute.type.indexOf("Polygon")>=0?symbolizer={Polygon:this.selectionSymbolizer.Polygon}:geometryAttribute.type.indexOf("LineString")>=0?symbolizer={Line:this.selectionSymbolizer.Line}:geometryAttribute.type.indexOf("Point")>=0&&(symbolizer={Point:this.selectionSymbolizer.Point}),filter=filters[i],sld.namedLayers[name].userStyles.push({name:"default",rules:[new OpenLayers.Rule({symbolizer:symbolizer,filter:filter,maxScaleDenominator:layer.options.minScale})]});return new OpenLayers.Format.SLD({srsName:this.map.getProjection()}).write(sld)},parseDescribeLayer:function(request){var format=new OpenLayers.Format.WMSDescribeLayer,doc=request.responseXML,i,len,options;doc&&doc.documentElement||(doc=request.responseText);var describeLayer=format.read(doc),typeNames=[],url=null;for(i=0,len=describeLayer.length;i<len;i++)describeLayer[i].owsType=="WFS"&&(typeNames.push(describeLayer[i].typeName),url=describeLayer[i].owsURL);options={url:url,params:{SERVICE:"WFS",TYPENAME:typeNames.toString(),REQUEST:"DescribeFeatureType",VERSION:"1.0.0"},callback:function(request){var format=new OpenLayers.Format.WFSDescribeFeatureType,doc=request.responseXML,describeFeatureType;doc&&doc.documentElement||(doc=request.responseText);describeFeatureType=format.read(doc);this.control.wfsCache[this.layer.id]=describeFeatureType;this.control._queue&&this.control.applySelection()},scope:this};OpenLayers.Request.GET(options)},getGeometryAttributes:function(layer){for(var typeName,properties,j,lenj,property,type,result=[],cache=this.wfsCache[layer.id],i=0,len=cache.featureTypes.length;i<len;i++)for(typeName=cache.featureTypes[i],properties=typeName.properties,j=0,lenj=properties.length;j<lenj;j++)property=properties[j],type=property.type,(type.indexOf("LineString")>=0||type.indexOf("GeometryAssociationType")>=0||type.indexOf("GeometryPropertyType")>=0||type.indexOf("Point")>=0||type.indexOf("Polygon")>=0)&&result.push(property);return result},activate:function(){var activated=OpenLayers.Control.prototype.activate.call(this),i,len,layer,options;if(activated)for(i=0,len=this.layers.length;i<len;i++)layer=this.layers[i],layer&&!this.wfsCache[layer.id]&&(options={url:layer.url,params:{SERVICE:"WMS",VERSION:layer.params.VERSION,LAYERS:layer.params.LAYERS,REQUEST:"DescribeLayer"},callback:this.parseDescribeLayer,scope:{layer:layer,control:this}},OpenLayers.Request.GET(options));return activated},deactivate:function(){var deactivated=OpenLayers.Control.prototype.deactivate.call(this),i,len,layer,layerCache,selectionLayer;if(deactivated)for(i=0,len=this.layers.length;i<len;i++)layer=this.layers[i],layer&&this.clearOnDeactivate===!0&&(layerCache=this.layerCache,selectionLayer=layerCache[layer.id],selectionLayer&&(layer.events.un({visibilitychanged:this.coupleLayerVisiblity,scope:selectionLayer}),selectionLayer.destroy(),delete layerCache[layer.id]));return deactivated},setLayers:function(layers){this.active?(this.deactivate(),this.layers=layers,this.activate()):this.layers=layers},createFilter:function(geometryAttribute,geometry){var filter=null;return this.handler instanceof OpenLayers.Handler.RegularPolygon?filter=this.handler.irregular===!0?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:geometryAttribute.name,value:geometry.getBounds()}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:geometryAttribute.name,value:geometry}):this.handler instanceof OpenLayers.Handler.Polygon?filter=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:geometryAttribute.name,value:geometry}):this.handler instanceof OpenLayers.Handler.Path?filter=geometryAttribute.type.indexOf("Point")>=0?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,property:geometryAttribute.name,distance:this.map.getExtent().getWidth()*.01,distanceUnits:this.map.getUnits(),value:geometry}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:geometryAttribute.name,value:geometry}):this.handler instanceof OpenLayers.Handler.Click&&(filter=geometryAttribute.type.indexOf("Polygon")>=0?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:geometryAttribute.name,value:geometry}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,property:geometryAttribute.name,distance:this.map.getExtent().getWidth()*.01,distanceUnits:this.map.getUnits(),value:geometry})),filter},select:function(geometry){this._queue=function(){for(var j,lenj,geometryAttribute,point,filter,selectionLayer,sld,i=0,len=this.layers.length;i<len;i++){var layer=this.layers[i],geometryAttributes=this.getGeometryAttributes(layer),filters=[];for(j=0,lenj=geometryAttributes.length;j<lenj;j++)geometryAttribute=geometryAttributes[j],geometryAttribute!==null&&(geometry instanceof OpenLayers.Geometry||(point=this.map.getLonLatFromPixel(geometry.xy),geometry=new OpenLayers.Geometry.Point(point.lon,point.lat)),filter=this.createFilter(geometryAttribute,geometry),filter!==null&&filters.push(filter));selectionLayer=this.createSelectionLayer(layer);this.events.triggerEvent("selected",{layer:layer,filters:filters});sld=this.createSLD(layer,filters,geometryAttributes);selectionLayer.mergeNewParams({SLD_BODY:sld});delete this._queue}};this.applySelection()},applySelection:function(){for(var canApply=!0,i=0,len=this.layers.length;i<len;i++)if(!this.wfsCache[this.layers[i].id]){canApply=!1;break}canApply&&this._queue.call(this)},CLASS_NAME:"OpenLayers.Control.SLDSelect"});OpenLayers.Control.Scale=OpenLayers.Class(OpenLayers.Control,{element:null,geodesic:!1,initialize:function(element,options){OpenLayers.Control.prototype.initialize.apply(this,[options]);this.element=OpenLayers.Util.getElement(element)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(this.element=document.createElement("div"),this.div.appendChild(this.element)),this.map.events.register("moveend",this,this.updateScale),this.updateScale(),this.div},updateScale:function(){var scale,units,inches;if(this.geodesic===!0){if(units=this.map.getUnits(),!units)return;inches=OpenLayers.INCHES_PER_UNIT;scale=(this.map.getGeodesicPixelSize().w||1e-6)*inches.km*OpenLayers.DOTS_PER_INCH}else scale=this.map.getScale();scale&&(scale=scale>=9500&&scale<=95e4?Math.round(scale/1e3)+"K":scale>=95e4?Math.round(scale/1e6)+"M":Math.round(scale),this.element.innerHTML=OpenLayers.i18n("Scale = 1 : ${scaleDenom}",{scaleDenom:scale}))},CLASS_NAME:"OpenLayers.Control.Scale"});OpenLayers.Layer.MapGuide=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,useHttpTile:!1,singleTile:!1,useOverlay:!1,useAsyncOverlay:!0,TILE_PARAMS:{operation:"GETTILEIMAGE",version:"1.2.0"},SINGLE_TILE_PARAMS:{operation:"GETMAPIMAGE",format:"PNG",locale:"en",clip:"1",version:"1.0.0"},OVERLAY_PARAMS:{operation:"GETDYNAMICMAPOVERLAYIMAGE",format:"PNG",locale:"en",clip:"1",version:"2.0.0"},FOLDER_PARAMS:{tileColumnsPerFolder:30,tileRowsPerFolder:30,format:"png",querystring:null},defaultSize:new OpenLayers.Size(300,300),tileOriginCorner:"tl",initialize:function(name,url,params,options){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);(options==null||options.isBaseLayer==null)&&(this.isBaseLayer=this.transparent!="true"&&this.transparent!=!0);options&&options.useOverlay!=null&&(this.useOverlay=options.useOverlay);this.singleTile?this.useOverlay?(OpenLayers.Util.applyDefaults(this.params,this.OVERLAY_PARAMS),this.useAsyncOverlay||(this.params.version="1.0.0")):OpenLayers.Util.applyDefaults(this.params,this.SINGLE_TILE_PARAMS):(this.useHttpTile?OpenLayers.Util.applyDefaults(this.params,this.FOLDER_PARAMS):OpenLayers.Util.applyDefaults(this.params,this.TILE_PARAMS),this.setTileSize(this.defaultSize))},clone:function(obj){return obj==null&&(obj=new OpenLayers.Layer.MapGuide(this.name,this.url,this.params,this.getOptions())),OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj])},getURL:function(bounds){var url,center=bounds.getCenterLonLat(),mapSize=this.map.getSize(),params,getVisParams,currentRes,colidx,rowidx;return this.singleTile?(params={setdisplaydpi:OpenLayers.DOTS_PER_INCH,setdisplayheight:mapSize.h*this.ratio,setdisplaywidth:mapSize.w*this.ratio,setviewcenterx:center.lon,setviewcentery:center.lat,setviewscale:this.map.getScale()},this.useOverlay&&!this.useAsyncOverlay&&(getVisParams={},getVisParams=OpenLayers.Util.extend(getVisParams,params),getVisParams.operation="GETVISIBLEMAPEXTENT",getVisParams.version="1.0.0",getVisParams.session=this.params.session,getVisParams.mapName=this.params.mapName,getVisParams.format="text/xml",url=this.getFullRequestString(getVisParams),OpenLayers.Request.GET({url:url,async:!1})),url=this.getFullRequestString(params)):(currentRes=this.map.getResolution(),colidx=Math.floor((bounds.left-this.maxExtent.left)/currentRes),colidx=Math.round(colidx/this.tileSize.w),rowidx=Math.floor((this.maxExtent.top-bounds.top)/currentRes),rowidx=Math.round(rowidx/this.tileSize.h),url=this.useHttpTile?this.getImageFilePath({tilecol:colidx,tilerow:rowidx,scaleindex:this.resolutions.length-this.map.zoom-1}):this.getFullRequestString({tilecol:colidx,tilerow:rowidx,scaleindex:this.resolutions.length-this.map.zoom-1})),url},getFullRequestString:function(newParams,altUrl){var url=altUrl==null?this.url:altUrl,requestString,allParams,urlParams,key,paramsString,lastServerChar;typeof url=="object"&&(url=url[Math.floor(Math.random()*url.length)]);requestString=url;allParams=OpenLayers.Util.extend({},this.params);allParams=OpenLayers.Util.extend(allParams,newParams);urlParams=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(url));for(key in allParams)key.toUpperCase()in urlParams&&delete allParams[key];return paramsString=OpenLayers.Util.getParameterString(allParams),paramsString=paramsString.replace(/,/g,"+"),paramsString!=""&&(lastServerChar=url.charAt(url.length-1),requestString+=lastServerChar=="&"||lastServerChar=="?"?paramsString:url.indexOf("?")==-1?"?"+paramsString:"&"+paramsString),requestString},getImageFilePath:function(newParams,altUrl){var url=altUrl==null?this.url:altUrl,tilePath;typeof url=="object"&&(url=url[Math.floor(Math.random()*url.length)]);var requestString=url,tileRowGroup="",tileColGroup="";return newParams.tilerow<0&&(tileRowGroup="-"),tileRowGroup+=newParams.tilerow==0?"0":Math.floor(Math.abs(newParams.tilerow/this.params.tileRowsPerFolder))*this.params.tileRowsPerFolder,newParams.tilecol<0&&(tileColGroup="-"),tileColGroup+=newParams.tilecol==0?"0":Math.floor(Math.abs(newParams.tilecol/this.params.tileColumnsPerFolder))*this.params.tileColumnsPerFolder,tilePath="/S"+Math.floor(newParams.scaleindex)+"/"+this.params.basemaplayergroupname+"/R"+tileRowGroup+"/C"+tileColGroup+"/"+newParams.tilerow%this.params.tileRowsPerFolder+"_"+newParams.tilecol%this.params.tileColumnsPerFolder+"."+this.params.format,this.params.querystring&&(tilePath+="?"+this.params.querystring),requestString+tilePath},CLASS_NAME:"OpenLayers.Layer.MapGuide"});OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{callbacks:null,displaySystem:"metric",geodesic:!1,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:!1,immediate:!1,initialize:function(handler,options){OpenLayers.Control.prototype.initialize.apply(this,[options]);var callbacks={done:this.measureComplete,point:this.measurePartial};this.immediate&&(callbacks.modify=this.measureImmediate);this.callbacks=OpenLayers.Util.extend(callbacks,this.callbacks);this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions);this.handler=new handler(this,this.callbacks,this.handlerOptions)},deactivate:function(){return this.cancelDelay(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},cancel:function(){this.cancelDelay();this.handler.cancel()},setImmediate:function(immediate){this.immediate=immediate;this.immediate?this.callbacks.modify=this.measureImmediate:delete this.callbacks.modify},updateHandler:function(handler,options){var active=this.active;active&&this.deactivate();this.handler=new handler(this,this.callbacks,options);active&&this.activate()},measureComplete:function(geometry){this.cancelDelay();this.measure(geometry,"measure")},measurePartial:function(point,geometry){this.cancelDelay();geometry=geometry.clone();this.handler.freehandMode(this.handler.evt)?this.measure(geometry,"measurepartial"):this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.delayedTrigger=null;this.measure(geometry,"measurepartial")},this),this.partialDelay)},measureImmediate:function(point,feature,drawing){drawing&&!this.handler.freehandMode(this.handler.evt)&&(this.cancelDelay(),this.measure(feature.geometry,"measurepartial"))},cancelDelay:function(){this.delayedTrigger!==null&&(window.clearTimeout(this.delayedTrigger),this.delayedTrigger=null)},measure:function(geometry,eventType){var stat,order;geometry.CLASS_NAME.indexOf("LineString")>-1?(stat=this.getBestLength(geometry),order=1):(stat=this.getBestArea(geometry),order=2);this.events.triggerEvent(eventType,{measure:stat[0],units:stat[1],order:order,geometry:geometry})},getBestArea:function(geometry){for(var units=this.displaySystemUnits[this.displaySystem],unit,area,i=0,len=units.length;i<len;++i)if(unit=units[i],area=this.getArea(geometry,unit),area>1)break;return[area,unit]},getArea:function(geometry,units){var area,geomUnits,inPerDisplayUnit,inPerMapUnit;return this.geodesic?(area=geometry.getGeodesicArea(this.map.getProjectionObject()),geomUnits="m"):(area=geometry.getArea(),geomUnits=this.map.getUnits()),inPerDisplayUnit=OpenLayers.INCHES_PER_UNIT[units],inPerDisplayUnit&&(inPerMapUnit=OpenLayers.INCHES_PER_UNIT[geomUnits],area*=Math.pow(inPerMapUnit/inPerDisplayUnit,2)),area},getBestLength:function(geometry){for(var units=this.displaySystemUnits[this.displaySystem],unit,length,i=0,len=units.length;i<len;++i)if(unit=units[i],length=this.getLength(geometry,unit),length>1)break;return[length,unit]},getLength:function(geometry,units){var length,geomUnits,inPerDisplayUnit,inPerMapUnit;return this.geodesic?(length=geometry.getGeodesicLength(this.map.getProjectionObject()),geomUnits="m"):(length=geometry.getLength(),geomUnits=this.map.getUnits()),inPerDisplayUnit=OpenLayers.INCHES_PER_UNIT[units],inPerDisplayUnit&&(inPerMapUnit=OpenLayers.INCHES_PER_UNIT[geomUnits],length*=inPerMapUnit/inPerDisplayUnit),length},CLASS_NAME:"OpenLayers.Control.Measure"});OpenLayers.Format.WMC.v1_0_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.0.0/context.xsd",initialize:function(options){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[options])},read_wmc_SRS:function(layerContext,node){var srs=this.getChildValue(node),values,i,len;for(typeof layerContext.projections!="object"&&(layerContext.projections={}),values=srs.split(/ +/),i=0,len=values.length;i<len;i++)layerContext.projections[values[i]]=!0},write_wmc_Layer:function(context){var node=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[context]),projections,name;if(context.srs){projections=[];for(name in context.srs)projections.push(name);node.appendChild(this.createElementDefaultNS("SRS",projections.join(" ")))}node.appendChild(this.write_wmc_FormatList(context));node.appendChild(this.write_wmc_StyleList(context));context.dimensions&&node.appendChild(this.write_wmc_DimensionList(context));node.appendChild(this.write_wmc_LayerExtension(context))},CLASS_NAME:"OpenLayers.Format.WMC.v1_0_0"});OpenLayers.Format.WMTSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options]);this.options=options;var yx=OpenLayers.Util.extend({},OpenLayers.Format.WMTSCapabilities.prototype.yx);this.yx=OpenLayers.Util.extend(yx,this.yx)},read:function(data){typeof data=="string"&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data]));data&&data.nodeType==9&&(data=data.documentElement);var capabilities={};return this.readNode(data,capabilities),capabilities.version=this.version,capabilities},readers:{wmts:{Capabilities:function(node,obj){this.readChildNodes(node,obj)},Contents:function(node,obj){obj.contents={};obj.contents.layers=[];obj.contents.tileMatrixSets={};this.readChildNodes(node,obj.contents)},Layer:function(node,obj){var layer={styles:[],formats:[],dimensions:[],tileMatrixSetLinks:[]};layer.layers=[];this.readChildNodes(node,layer);obj.layers.push(layer)},Style:function(node,obj){var style={};style.isDefault=node.getAttribute("isDefault")==="true";this.readChildNodes(node,style);obj.styles.push(style)},Format:function(node,obj){obj.formats.push(this.getChildValue(node))},TileMatrixSetLink:function(node,obj){var tileMatrixSetLink={};this.readChildNodes(node,tileMatrixSetLink);obj.tileMatrixSetLinks.push(tileMatrixSetLink)},TileMatrixSet:function(node,obj){if(obj.layers){var tileMatrixSet={matrixIds:[]};this.readChildNodes(node,tileMatrixSet);obj.tileMatrixSets[tileMatrixSet.identifier]=tileMatrixSet}else obj.tileMatrixSet=this.getChildValue(node)},TileMatrix:function(node,obj){var tileMatrix={supportedCRS:obj.supportedCRS};this.readChildNodes(node,tileMatrix);obj.matrixIds.push(tileMatrix)},ScaleDenominator:function(node,obj){obj.scaleDenominator=parseFloat(this.getChildValue(node))},TopLeftCorner:function(node,obj){var topLeftCorner=this.getChildValue(node),coords=topLeftCorner.split(" "),yx,crs;obj.supportedCRS&&(crs=obj.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2"),yx=!!this.yx[crs]);obj.topLeftCorner=yx?new OpenLayers.LonLat(coords[1],coords[0]):new OpenLayers.LonLat(coords[0],coords[1])},TileWidth:function(node,obj){obj.tileWidth=parseInt(this.getChildValue(node))},TileHeight:function(node,obj){obj.tileHeight=parseInt(this.getChildValue(node))},MatrixWidth:function(node,obj){obj.matrixWidth=parseInt(this.getChildValue(node))},MatrixHeight:function(node,obj){obj.matrixHeight=parseInt(this.getChildValue(node))},ResourceURL:function(node,obj){var resourceType,resourceUrl;obj.resourceUrl=obj.resourceUrl||{};resourceType=node.getAttribute("resourceType");obj.resourceUrls||(obj.resourceUrls=[]);resourceUrl=obj.resourceUrl[resourceType]={format:node.getAttribute("format"),template:node.getAttribute("template"),resourceType:resourceType};obj.resourceUrls.push(resourceUrl)},WSDL:function(node,obj){obj.wsdl={};obj.wsdl.href=node.getAttribute("xlink:href")},ServiceMetadataURL:function(node,obj){obj.serviceMetadataUrl={};obj.serviceMetadataUrl.href=node.getAttribute("xlink:href")},LegendURL:function(node,obj){obj.legend={};obj.legend.href=node.getAttribute("xlink:href");obj.legend.format=node.getAttribute("format")},Dimension:function(node,obj){var dimension={values:[]};this.readChildNodes(node,dimension);obj.dimensions.push(dimension)},Default:function(node,obj){obj["default"]=this.getChildValue(node)},Value:function(node,obj){obj.values.push(this.getChildValue(node))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities.v1_0_0"});OpenLayers.Layer.WorldWind=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{},isBaseLayer:!0,lzd:null,zoomLevels:null,initialize:function(name,url,lzd,zoomLevels,params,options){this.lzd=lzd;this.zoomLevels=zoomLevels;var newArguments=[];newArguments.push(name,url,params,options);OpenLayers.Layer.Grid.prototype.initialize.apply(this,newArguments);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getZoom:function(){var zoom=this.map.getZoom(),extent=this.map.getMaxExtent();return zoom-Math.log(this.maxResolution/(this.lzd/512))/Math.log(2)},getURL:function(bounds){bounds=this.adjustBounds(bounds);var zoom=this.getZoom(),extent=this.map.getMaxExtent(),deg=this.lzd/Math.pow(2,this.getZoom()),x=Math.floor((bounds.left-extent.left)/deg),y=Math.floor((bounds.bottom-extent.bottom)/deg);return this.map.getResolution()<=this.lzd/512&&this.getZoom()<=this.zoomLevels?this.getFullRequestString({L:zoom,X:x,Y:y}):OpenLayers.Util.getImageLocation("blank.gif")},CLASS_NAME:"OpenLayers.Layer.WorldWind"});OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:!0,panMapIfOutOfView:!0,imageSize:new OpenLayers.Size(1276,736),isAlphaImage:!1,fixedRelativePosition:!1,positionBlocks:{tl:{offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,18),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-632)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-688)}]},tr:{offset:new OpenLayers.Pixel(-45,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,19),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-631)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel(-215,-687)}]},bl:{offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)}]},br:{offset:new OpenLayers.Pixel(-44,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)}]}},minSize:new OpenLayers.Size(105,10),maxSize:new OpenLayers.Size(1200,660),initialize:function(){this.imageSrc=OpenLayers.Util.getImageLocation("cloud-popup-relative.png");OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments);this.contentDiv.className=this.contentDisplayClass},CLASS_NAME:"OpenLayers.Popup.FramedCloud"});OpenLayers.Format.SOSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.SOSCapabilities,{namespaces:{ows:"http://www.opengis.net/ows/1.1",sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options]);this.options=options},read:function(data){typeof data=="string"&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data]));data&&data.nodeType==9&&(data=data.documentElement);var capabilities={};return this.readNode(data,capabilities),capabilities},readers:{gml:OpenLayers.Util.applyDefaults({name:function(node,obj){obj.name=this.getChildValue(node)},TimePeriod:function(node,obj){obj.timePeriod={};this.readChildNodes(node,obj.timePeriod)},beginPosition:function(node,timePeriod){timePeriod.beginPosition=this.getChildValue(node)},endPosition:function(node,timePeriod){timePeriod.endPosition=this.getChildValue(node)}},OpenLayers.Format.GML.v3.prototype.readers.gml),sos:{Capabilities:function(node,obj){this.readChildNodes(node,obj)},Contents:function(node,obj){obj.contents={};this.readChildNodes(node,obj.contents)},ObservationOfferingList:function(node,contents){contents.offeringList={};this.readChildNodes(node,contents.offeringList)},ObservationOffering:function(node,offeringList){var id=this.getAttributeNS(node,this.namespaces.gml,"id");offeringList[id]={procedures:[],observedProperties:[],featureOfInterestIds:[],responseFormats:[],resultModels:[],responseModes:[]};this.readChildNodes(node,offeringList[id])},time:function(node,offering){offering.time={};this.readChildNodes(node,offering.time)},procedure:function(node,offering){offering.procedures.push(this.getAttributeNS(node,this.namespaces.xlink,"href"))},observedProperty:function(node,offering){offering.observedProperties.push(this.getAttributeNS(node,this.namespaces.xlink,"href"))},featureOfInterest:function(node,offering){offering.featureOfInterestIds.push(this.getAttributeNS(node,this.namespaces.xlink,"href"))},responseFormat:function(node,offering){offering.responseFormats.push(this.getChildValue(node))},resultModel:function(node,offering){offering.resultModels.push(this.getChildValue(node))},responseMode:function(node,offering){offering.responseModes.push(this.getChildValue(node))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.SOSCapabilities.v1_0_0"});OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!1,pinching:!1,last:null,start:null,touchstart:function(evt){var propagate=!0;return this.pinching=!1,OpenLayers.Event.isMultiTouch(evt)?(this.started=!0,this.last=this.start={distance:this.getDistance(evt.touches),delta:0,scale:1},this.callback("start",[evt,this.start]),propagate=!this.stopDown):(this.started=!1,this.start=null,this.last=null),OpenLayers.Event.preventDefault(evt),propagate},touchmove:function(evt){if(this.started&&OpenLayers.Event.isMultiTouch(evt)){this.pinching=!0;var current=this.getPinchData(evt);this.callback("move",[evt,current]);this.last=current;OpenLayers.Event.stop(evt)}return!0},touchend:function(evt){return this.started&&(this.started=!1,this.pinching=!1,this.callback("done",[evt,this.start,this.last]),this.start=null,this.last=null),!0},activate:function(){var activated=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.pinching=!1,activated=!0),activated},deactivate:function(){var deactivated=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.started=!1,this.pinching=!1,this.start=null,this.last=null,deactivated=!0),deactivated},getDistance:function(touches){var t0=touches[0],t1=touches[1];return Math.sqrt(Math.pow(t0.clientX-t1.clientX,2)+Math.pow(t0.clientY-t1.clientY,2))},getPinchData:function(evt){var distance=this.getDistance(evt.touches),scale=distance/this.start.distance;return{distance:distance,delta:this.last.distance-distance,scale:scale}},CLASS_NAME:"OpenLayers.Handler.Pinch"});OpenLayers.Control.NavToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(options){OpenLayers.Control.Panel.prototype.initialize.apply(this,[options]);this.addControls([new OpenLayers.Control.Navigation,new OpenLayers.Control.ZoomBox])},draw:function(){var div=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);return this.defaultControl===null&&(this.defaultControl=this.controls[0]),div},CLASS_NAME:"OpenLayers.Control.NavToolbar"});OpenLayers.Control.PinchZoom=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,pinchOrigin:null,currentCenter:null,autoActivate:!0,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)},pinchStart:function(evt){this.pinchOrigin=evt.xy;this.currentCenter=evt.xy},pinchMove:function(evt,pinchData){var scale=pinchData.scale,containerOrigin=this.map.layerContainerOriginPx,pinchOrigin=this.pinchOrigin,current=evt.xy,dx=Math.round(current.x-pinchOrigin.x+(scale-1)*(containerOrigin.x-pinchOrigin.x)),dy=Math.round(current.y-pinchOrigin.y+(scale-1)*(containerOrigin.y-pinchOrigin.y));this.applyTransform("translate("+dx+"px, "+dy+"px) scale("+scale+")");this.currentCenter=current},applyTransform:function(transform){var style=this.map.layerContainerDiv.style,transformProperty=OpenLayers.Util.vendorPrefix.style("transform");transformProperty&&(style[transformProperty]=transform)},pinchDone:function(evt,start,last){var zoom;if(this.applyTransform(""),zoom=this.map.getZoomForResolution(this.map.getResolution()/last.scale,!0),zoom!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){var resolution=this.map.getResolutionForZoom(zoom),location=this.map.getLonLatFromPixel(this.pinchOrigin),zoomPixel=this.currentCenter,size=this.map.getSize();location.lon+=resolution*(size.w/2-zoomPixel.x);location.lat-=resolution*(size.h/2-zoomPixel.y);this.map.div.clientWidth=this.map.div.clientWidth;this.map.setCenter(location,zoom)}},CLASS_NAME:"OpenLayers.Control.PinchZoom"});OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",url:["http://a.tile.openstreetmap.org/${z}/${x}/${y}.png","http://b.tile.openstreetmap.org/${z}/${x}/${y}.png","http://c.tile.openstreetmap.org/${z}/${x}/${y}.png"],attribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap<\/a> contributors",sphericalMercator:!0,wrapDateLine:!0,tileOptions:null,initialize:function(){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments);this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options&&this.options.tileOptions)},clone:function(obj){return obj==null&&(obj=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions())),OpenLayers.Layer.XYZ.prototype.clone.apply(this,[obj])},CLASS_NAME:"OpenLayers.Layer.OSM"});OpenLayers.Strategy.Refresh=OpenLayers.Class(OpenLayers.Strategy,{force:!1,interval:0,timer:null,activate:function(){var activated=OpenLayers.Strategy.prototype.activate.call(this);if(activated){this.layer.visibility===!0&&this.start();this.layer.events.on({visibilitychanged:this.reset,scope:this})}return activated},deactivate:function(){var deactivated=OpenLayers.Strategy.prototype.deactivate.call(this);return deactivated&&this.stop(),deactivated},reset:function(){this.layer.visibility===!0?this.start():this.stop()},start:function(){this.interval&&typeof this.interval=="number"&&this.interval>0&&(this.timer=window.setInterval(OpenLayers.Function.bind(this.refresh,this),this.interval))},refresh:function(){this.layer&&this.layer.refresh&&typeof this.layer.refresh=="function"&&this.layer.refresh({force:this.force})},stop:function(){this.timer!==null&&(window.clearInterval(this.timer),this.timer=null)},CLASS_NAME:"OpenLayers.Strategy.Refresh"});OpenLayers.Control.Geolocate=OpenLayers.Class(OpenLayers.Control,{geolocation:navigator.geolocation,bind:!0,watch:!1,geolocationOptions:null,destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.geolocation?OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.watch?this.watchId=this.geolocation.watchPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions):this.getCurrentLocation(),!0):!1:(this.events.triggerEvent("locationuncapable"),!1)},deactivate:function(){return this.active&&this.watchId!==null&&this.geolocation.clearWatch(this.watchId),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},geolocate:function(position){var center=new OpenLayers.LonLat(position.coords.longitude,position.coords.latitude).transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());this.bind&&this.map.setCenter(center);this.events.triggerEvent("locationupdated",{position:position,point:new OpenLayers.Geometry.Point(center.lon,center.lat)})},getCurrentLocation:function(){return!this.active||this.watch?!1:(this.geolocation.getCurrentPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions),!0)},failure:function(error){this.events.triggerEvent("locationfailed",{error:error})},CLASS_NAME:"OpenLayers.Control.Geolocate"});OpenLayers.Layer.ArcGIS93Rest=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{format:"png"},isBaseLayer:!0,initialize:function(name,url,params,options){var newArguments=[];params=OpenLayers.Util.upperCaseObject(params);newArguments.push(name,url,params,options);OpenLayers.Layer.Grid.prototype.initialize.apply(this,newArguments);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));this.params.TRANSPARENT&&this.params.TRANSPARENT.toString().toLowerCase()=="true"&&(options!=null&&options.isBaseLayer||(this.isBaseLayer=!1),this.params.FORMAT=="jpg"&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"gif":"png"))},clone:function(obj){return obj==null&&(obj=new OpenLayers.Layer.ArcGIS93Rest(this.name,this.url,this.params,this.getOptions())),OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj])},getURL:function(bounds){var layerDefStrList,layerID;bounds=this.adjustBounds(bounds);var projWords=this.projection.getCode().split(":"),srid=projWords[projWords.length-1],imageSize=this.getImageSize(),newParams={BBOX:bounds.toBBOX(),SIZE:imageSize.w+","+imageSize.h,F:"image",BBOXSR:srid,IMAGESR:srid};if(this.layerDefs){layerDefStrList=[];for(layerID in this.layerDefs)this.layerDefs.hasOwnProperty(layerID)&&this.layerDefs[layerID]&&(layerDefStrList.push(layerID),layerDefStrList.push(":"),layerDefStrList.push(this.layerDefs[layerID]),layerDefStrList.push(";"));layerDefStrList.length>0&&(newParams.LAYERDEFS=layerDefStrList.join(""))}return this.getFullRequestString(newParams)},setLayerFilter:function(id,queryDef){this.layerDefs||(this.layerDefs={});queryDef?this.layerDefs[id]=queryDef:delete this.layerDefs[id]},clearLayerFilter:function(id){id?delete this.layerDefs[id]:delete this.layerDefs},mergeNewParams:function(newParams){var upperParams=OpenLayers.Util.upperCaseObject(newParams),newArguments=[upperParams];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,newArguments)},CLASS_NAME:"OpenLayers.Layer.ArcGIS93Rest"});OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:!1,px:null,timerId:null,mousemove:function(evt){return this.passesTolerance(evt.xy)&&(this.clearTimer(),this.callback("move",[evt]),this.px=evt.xy,evt=OpenLayers.Util.extend({},evt),this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,evt),this.delay)),!this.stopMove},mouseout:function(evt){return OpenLayers.Util.mouseLeft(evt,this.map.viewPortDiv)&&(this.clearTimer(),this.callback("move",[evt])),!0},passesTolerance:function(px){var passes=!0,dpx;return this.pixelTolerance&&this.px&&(dpx=Math.sqrt(Math.pow(this.px.x-px.x,2)+Math.pow(this.px.y-px.y,2)),dpx<this.pixelTolerance&&(passes=!1)),passes},clearTimer:function(){this.timerId!=null&&(window.clearTimeout(this.timerId),this.timerId=null)},delayedCall:function(evt){this.callback("pause",[evt])},deactivate:function(){var deactivated=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),deactivated=!0),deactivated},CLASS_NAME:"OpenLayers.Handler.Hover"});OpenLayers.Control.GetFeature=OpenLayers.Class(OpenLayers.Control,{protocol:null,multipleKey:null,toggleKey:null,modifiers:null,multiple:!1,click:!0,single:!0,clickout:!0,toggle:!1,clickTolerance:5,hover:!1,box:!1,maxFeatures:10,features:null,hoverFeature:null,handlers:null,hoverResponse:null,filterType:OpenLayers.Filter.Spatial.BBOX,initialize:function(options){options.handlerOptions=options.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[options]);this.features={};this.handlers={};this.click&&(this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.selectClick},this.handlerOptions.click||{}));this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},OpenLayers.Util.extend(this.handlerOptions.box,{boxDivClassName:"olHandlerBoxSelectFeature"})));this.hover&&(this.handlers.hover=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.selectHover},OpenLayers.Util.extend(this.handlerOptions.hover,{delay:250,pixelTolerance:2})))},activate:function(){if(!this.active)for(var i in this.handlers)this.handlers[i].activate();return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active)for(var i in this.handlers)this.handlers[i].deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},selectClick:function(evt){var bounds=this.pixelToBounds(evt.xy);this.setModifiers(evt);this.request(bounds,{single:this.single})},selectBox:function(position){var bounds,minXY,maxXY;if(position instanceof OpenLayers.Bounds)minXY=this.map.getLonLatFromPixel({x:position.left,y:position.bottom}),maxXY=this.map.getLonLatFromPixel({x:position.right,y:position.top}),bounds=new OpenLayers.Bounds(minXY.lon,minXY.lat,maxXY.lon,maxXY.lat);else{if(this.click)return;bounds=this.pixelToBounds(position)}this.setModifiers(this.handlers.box.dragHandler.evt);this.request(bounds)},selectHover:function(evt){var bounds=this.pixelToBounds(evt.xy);this.request(bounds,{single:!0,hover:!0})},cancelHover:function(){this.hoverResponse&&(this.protocol.abort(this.hoverResponse),this.hoverResponse=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"))},request:function(bounds,options){var filter,response;options=options||{};filter=new OpenLayers.Filter.Spatial({type:this.filterType,value:bounds});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");response=this.protocol.read({maxFeatures:options.single==!0?this.maxFeatures:undefined,filter:filter,callback:function(result){result.success()&&(result.features.length?options.single==!0?this.selectBestFeature(result.features,bounds.getCenterLonLat(),options):this.select(result.features):options.hover?this.hoverSelect():(this.events.triggerEvent("clickout"),this.clickout&&this.unselectAll()));OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},scope:this});options.hover==!0&&(this.hoverResponse=response)},selectBestFeature:function(features,clickPosition,options){var point,feature,resultFeature,dist,minDist,i;if(options=options||{},features.length){for(point=new OpenLayers.Geometry.Point(clickPosition.lon,clickPosition.lat),minDist=Number.MAX_VALUE,i=0;i<features.length;++i)if(feature=features[i],feature.geometry&&(dist=point.distanceTo(feature.geometry,{edge:!1}),dist<minDist&&(minDist=dist,resultFeature=feature,minDist==0)))break;options.hover==!0?this.hoverSelect(resultFeature):this.select(resultFeature||features)}},setModifiers:function(evt){this.modifiers={multiple:this.multiple||this.multipleKey&&evt[this.multipleKey],toggle:this.toggle||this.toggleKey&&evt[this.toggleKey]}},select:function(features){var cont,selectedFeatures,feature,i,len;if(this.modifiers.multiple||this.modifiers.toggle||this.unselectAll(),OpenLayers.Util.isArray(features)||(features=[features]),cont=this.events.triggerEvent("beforefeaturesselected",{features:features}),cont!==!1){for(selectedFeatures=[],i=0,len=features.length;i<len;++i)feature=features[i],this.features[feature.fid||feature.id]?this.modifiers.toggle&&this.unselect(this.features[feature.fid||feature.id]):(cont=this.events.triggerEvent("beforefeatureselected",{feature:feature}),cont!==!1&&(this.features[feature.fid||feature.id]=feature,selectedFeatures.push(feature),this.events.triggerEvent("featureselected",{feature:feature})));this.events.triggerEvent("featuresselected",{features:selectedFeatures})}},hoverSelect:function(feature){var fid=feature?feature.fid||feature.id:null,hfid=this.hoverFeature?this.hoverFeature.fid||this.hoverFeature.id:null;hfid&&hfid!=fid&&(this.events.triggerEvent("outfeature",{feature:this.hoverFeature}),this.hoverFeature=null);fid&&fid!=hfid&&(this.events.triggerEvent("hoverfeature",{feature:feature}),this.hoverFeature=feature)},unselect:function(feature){delete this.features[feature.fid||feature.id];this.events.triggerEvent("featureunselected",{feature:feature})},unselectAll:function(){for(var fid in this.features)this.unselect(this.features[fid])},setMap:function(map){for(var i in this.handlers)this.handlers[i].setMap(map);OpenLayers.Control.prototype.setMap.apply(this,arguments)},pixelToBounds:function(pixel){var llPx=pixel.add(-this.clickTolerance/2,this.clickTolerance/2),urPx=pixel.add(this.clickTolerance/2,-this.clickTolerance/2),ll=this.map.getLonLatFromPixel(llPx),ur=this.map.getLonLatFromPixel(urPx);return new OpenLayers.Bounds(ll.lon,ll.lat,ur.lon,ur.lat)},CLASS_NAME:"OpenLayers.Control.GetFeature"});OpenLayers.Format.QueryStringFilter=function(){function regex2value(value){return value=value.replace(/%/g,"\\%"),value=value.replace(/\\\\\.(\*)?/g,function($0,$1){return $1?$0:"\\\\_"}),value=value.replace(/\\\\\.\*/g,"\\\\%"),value=value.replace(/(\\)?\.(\*)?/g,function($0,$1,$2){return $1||$2?$0:"_"}),value=value.replace(/(\\)?\.\*/g,function($0,$1){return $1?$0:"%"}),value=value.replace(/\\\./g,"."),value.replace(/(\\)?\\\*/g,function($0,$1){return $1?$0:"*"})}var cmpToStr={};return cmpToStr[OpenLayers.Filter.Comparison.EQUAL_TO]="eq",cmpToStr[OpenLayers.Filter.Comparison.NOT_EQUAL_TO]="ne",cmpToStr[OpenLayers.Filter.Comparison.LESS_THAN]="lt",cmpToStr[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte",cmpToStr[OpenLayers.Filter.Comparison.GREATER_THAN]="gt",cmpToStr[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte",cmpToStr[OpenLayers.Filter.Comparison.LIKE]="ilike",OpenLayers.Class(OpenLayers.Format,{wildcarded:!1,srsInBBOX:!1,write:function(filter,params){var className,filterType,op,value,i,len;params=params||{};className=filter.CLASS_NAME;filterType=className.substring(className.lastIndexOf(".")+1);switch(filterType){case"Spatial":switch(filter.type){case OpenLayers.Filter.Spatial.BBOX:params.bbox=filter.value.toArray();this.srsInBBOX&&filter.projection&&params.bbox.push(filter.projection.getCode());break;case OpenLayers.Filter.Spatial.DWITHIN:params.tolerance=filter.distance;case OpenLayers.Filter.Spatial.WITHIN:params.lon=filter.value.x;params.lat=filter.value.y;break;default:OpenLayers.Console.warn("Unknown spatial filter type "+filter.type)}break;case"Comparison":op=cmpToStr[filter.type];op!==undefined?(value=filter.value,filter.type==OpenLayers.Filter.Comparison.LIKE&&(value=regex2value(value),this.wildcarded&&(value="%"+value+"%")),params[filter.property+"__"+op]=value,params.queryable=params.queryable||[],params.queryable.push(filter.property)):OpenLayers.Console.warn("Unknown comparison filter type "+filter.type);break;case"Logical":if(filter.type===OpenLayers.Filter.Logical.AND)for(i=0,len=filter.filters.length;i<len;i++)params=this.write(filter.filters[i],params);else OpenLayers.Console.warn("Unsupported logical filter type "+filter.type);break;default:OpenLayers.Console.warn("Unknown filter type "+filterType)}return params},CLASS_NAME:"OpenLayers.Format.QueryStringFilter"})}();OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,emptyString:null,lastXy:null,displayProjection:null,destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.map.events.register("mousemove",this,this.redraw),this.map.events.register("mouseout",this,this.reset),this.redraw(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.map.events.unregister("mousemove",this,this.redraw),this.map.events.unregister("mouseout",this,this.reset),this.element.innerHTML="",!0):!1},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(this.div.left="",this.div.top="",this.element=this.div),this.div},redraw:function(evt){var lonLat,newHtml;if(evt==null){this.reset();return}if(this.lastXy==null||Math.abs(evt.xy.x-this.lastXy.x)>this.granularity||Math.abs(evt.xy.y-this.lastXy.y)>this.granularity){this.lastXy=evt.xy;return}(lonLat=this.map.getLonLatFromPixel(evt.xy),lonLat)&&(this.displayProjection&&lonLat.transform(this.map.getProjectionObject(),this.displayProjection),this.lastXy=evt.xy,newHtml=this.formatOutput(lonLat),newHtml!=this.element.innerHTML&&(this.element.innerHTML=newHtml))},reset:function(){this.emptyString!=null&&(this.element.innerHTML=this.emptyString)},formatOutput:function(lonLat){var digits=parseInt(this.numDigits);return this.prefix+lonLat.lon.toFixed(digits)+this.separator+lonLat.lat.toFixed(digits)+this.suffix},CLASS_NAME:"OpenLayers.Control.MousePosition"});OpenLayers.Tile.UTFGrid=OpenLayers.Class(OpenLayers.Tile,{url:null,utfgridResolution:2,json:null,format:null,destroy:function(){this.clear();OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var drawn=OpenLayers.Tile.prototype.draw.apply(this,arguments),ols;return drawn?(this.isLoading?(this.abortLoading(),this.events.triggerEvent("reload")):(this.isLoading=!0,this.events.triggerEvent("loadstart")),this.url=this.layer.getURL(this.bounds),this.layer.useJSONP?(ols=new OpenLayers.Protocol.Script({url:this.url,callback:function(response){this.isLoading=!1;this.events.triggerEvent("loadend");this.json=response.data},scope:this}),ols.read(),this.request=ols):this.request=OpenLayers.Request.GET({url:this.url,callback:function(response){this.isLoading=!1;this.events.triggerEvent("loadend");response.status===200&&this.parseData(response.responseText)},scope:this})):this.unload(),drawn},abortLoading:function(){this.request&&(this.request.abort(),delete this.request);this.isLoading=!1},getFeatureInfo:function(i,j){var info=null,id;return this.json&&(id=this.getFeatureId(i,j),id!==null&&(info={id:id,data:this.json.data[id]})),info},getFeatureId:function(i,j){var id=null;if(this.json){var resolution=this.utfgridResolution,row=Math.floor(j/resolution),col=Math.floor(i/resolution),charCode=this.json.grid[row].charCodeAt(col),index=this.indexFromCharCode(charCode),keys=this.json.keys;!isNaN(index)&&index in keys&&(id=keys[index])}return id},indexFromCharCode:function(charCode){return charCode>=93&&charCode--,charCode>=35&&charCode--,charCode-32},parseData:function(str){this.format||(this.format=new OpenLayers.Format.JSON);this.json=this.format.read(str)},clear:function(){this.json=null},CLASS_NAME:"OpenLayers.Tile.UTFGrid"});OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:!0,clearOnDeactivate:!1,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:!1,initialize:function(options){var previousOptions,nextOptions;OpenLayers.Control.prototype.initialize.apply(this,[options]);this.registry=OpenLayers.Util.extend({moveend:this.getState},this.registry);previousOptions={trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};OpenLayers.Util.extend(previousOptions,this.previousOptions);this.previous=new OpenLayers.Control.Button(previousOptions);nextOptions={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};OpenLayers.Util.extend(nextOptions,this.nextOptions);this.next=new OpenLayers.Control.Button(nextOptions);this.clear()},onPreviousChange:function(state){state&&!this.previous.active?this.previous.activate():!state&&this.previous.active&&this.previous.deactivate()},onNextChange:function(state){state&&!this.next.active?this.next.activate():!state&&this.next.active&&this.next.deactivate()},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this);this.previous.destroy();this.next.destroy();this.deactivate();for(var prop in this)this[prop]=null},setMap:function(map){this.map=map;this.next.setMap(map);this.previous.setMap(map)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.next.draw();this.previous.draw()},previousTrigger:function(){var current=this.previousStack.shift(),state=this.previousStack.shift();if(state!=undefined){this.nextStack.unshift(current);this.previousStack.unshift(state);this.restoring=!0;this.restore(state);this.restoring=!1;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}else this.previousStack.unshift(current);return state},nextTrigger:function(){var state=this.nextStack.shift();if(state!=undefined){this.previousStack.unshift(state);this.restoring=!0;this.restore(state);this.restoring=!1;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}return state},clear:function(){this.previousStack=[];this.previous.deactivate();this.nextStack=[];this.next.deactivate()},getState:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units}},restore:function(state){var center,zoom;if(this.map.getProjectionObject()==state.projection)zoom=this.map.getZoomForResolution(state.resolution),center=state.center;else{center=state.center.clone();center.transform(state.projection,this.map.getProjectionObject());var sourceUnits=state.units,targetUnits=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,resolutionFactor=sourceUnits&&targetUnits?OpenLayers.INCHES_PER_UNIT[sourceUnits]/OpenLayers.INCHES_PER_UNIT[targetUnits]:1;zoom=this.map.getZoomForResolution(resolutionFactor*state.resolution)}this.map.setCenter(center,zoom)},setListeners:function(){this.listeners={};for(var type in this.registry)this.listeners[type]=OpenLayers.Function.bind(function(){if(!this.restoring){var state=this.registry[type].apply(this,arguments);if(this.previousStack.unshift(state),this.previousStack.length>1)this.onPreviousChange(this.previousStack[1],this.previousStack.length-1);if(this.previousStack.length>this.limit+1&&this.previousStack.pop(),this.nextStack.length>0){this.nextStack=[];this.onNextChange(null,0)}}return!0},this)},activate:function(){var activated=!1,type;if(this.map&&OpenLayers.Control.prototype.activate.apply(this)){this.listeners==null&&this.setListeners();for(type in this.listeners)this.map.events.register(type,this,this.listeners[type]);activated=!0;this.previousStack.length==0&&this.initStack()}return activated},initStack:function(){this.map.getCenter()&&this.listeners.moveend()},deactivate:function(){var deactivated=!1,type;if(this.map&&OpenLayers.Control.prototype.deactivate.apply(this)){for(type in this.listeners)this.map.events.unregister(type,this,this.listeners[type]);this.clearOnDeactivate&&this.clear();deactivated=!0}return deactivated},CLASS_NAME:"OpenLayers.Control.NavigationHistory"});OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:!1,updateWithPOST:!1,deleteWithPOST:!1,wildcarded:!1,srsInBBOX:!1,initialize:function(options){if(options=options||{},this.params={},this.headers={},OpenLayers.Protocol.prototype.initialize.apply(this,arguments),!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var format=new OpenLayers.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(filter,params){return format.write(filter,params)}}},destroy:function(){this.params=null;this.headers=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(options){var readWithPOST,resp,headers;return OpenLayers.Protocol.prototype.read.apply(this,arguments),options=options||{},options.params=OpenLayers.Util.applyDefaults(options.params,this.options.params),options=OpenLayers.Util.applyDefaults(options,this.options),options.filter&&this.filterToParams&&(options.params=this.filterToParams(options.filter,options.params)),readWithPOST=options.readWithPOST!==undefined?options.readWithPOST:this.readWithPOST,resp=new OpenLayers.Protocol.Response({requestType:"read"}),readWithPOST?(headers=options.headers||{},headers["Content-Type"]="application/x-www-form-urlencoded",resp.priv=OpenLayers.Request.POST({url:options.url,callback:this.createCallback(this.handleRead,resp,options),data:OpenLayers.Util.getParameterString(options.params),headers:headers})):resp.priv=OpenLayers.Request.GET({url:options.url,callback:this.createCallback(this.handleRead,resp,options),params:options.params,headers:options.headers}),resp},handleRead:function(resp,options){this.handleResponse(resp,options)},create:function(features,options){options=OpenLayers.Util.applyDefaults(options,this.options);var resp=new OpenLayers.Protocol.Response({reqFeatures:features,requestType:"create"});return resp.priv=OpenLayers.Request.POST({url:options.url,callback:this.createCallback(this.handleCreate,resp,options),headers:options.headers,data:this.format.write(features)}),resp},handleCreate:function(resp,options){this.handleResponse(resp,options)},update:function(feature,options){var url,resp,method;return options=options||{},url=options.url||feature.url||this.options.url+"/"+feature.fid,options=OpenLayers.Util.applyDefaults(options,this.options),resp=new OpenLayers.Protocol.Response({reqFeatures:feature,requestType:"update"}),method=this.updateWithPOST?"POST":"PUT",resp.priv=OpenLayers.Request[method]({url:url,callback:this.createCallback(this.handleUpdate,resp,options),headers:options.headers,data:this.format.write(feature)}),resp},handleUpdate:function(resp,options){this.handleResponse(resp,options)},"delete":function(feature,options){var url;options=options||{};url=options.url||feature.url||this.options.url+"/"+feature.fid;options=OpenLayers.Util.applyDefaults(options,this.options);var resp=new OpenLayers.Protocol.Response({reqFeatures:feature,requestType:"delete"}),method=this.deleteWithPOST?"POST":"DELETE",requestOptions={url:url,callback:this.createCallback(this.handleDelete,resp,options),headers:options.headers};return this.deleteWithPOST&&(requestOptions.data=this.format.write(feature)),resp.priv=OpenLayers.Request[method](requestOptions),resp},handleDelete:function(resp,options){this.handleResponse(resp,options)},handleResponse:function(resp,options){var request=resp.priv;options.callback&&(request.status>=200&&request.status<300?(resp.requestType!="delete"&&(resp.features=this.parseFeatures(request)),resp.code=OpenLayers.Protocol.Response.SUCCESS):resp.code=OpenLayers.Protocol.Response.FAILURE,options.callback.call(options.scope,resp))},parseFeatures:function(request){var doc=request.responseXML;return(doc&&doc.documentElement||(doc=request.responseText),!doc||doc.length<=0)?null:this.format.read(doc)},commit:function(features,options){function insertCallback(response){for(var len=response.features?response.features.length:0,fids=new Array(len),i=0;i<len;++i)fids[i]=response.features[i].fid;finalResponse.insertIds=fids;callback.apply(this,[response])}function callback(response){this.callUserCallback(response,options);success=success&&response.success();nResponses++;nResponses>=nRequests&&options.callback&&(finalResponse.code=success?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE,options.callback.apply(options.scope,[finalResponse]))}var feature,list,requestFeatures,len,queue,i;options=OpenLayers.Util.applyDefaults(options,this.options);var resp=[],nResponses=0,types={};for(types[OpenLayers.State.INSERT]=[],types[OpenLayers.State.UPDATE]=[],types[OpenLayers.State.DELETE]=[],requestFeatures=[],i=0,len=features.length;i<len;++i)feature=features[i],list=types[feature.state],list&&(list.push(feature),requestFeatures.push(feature));var nRequests=(types[OpenLayers.State.INSERT].length>0?1:0)+types[OpenLayers.State.UPDATE].length+types[OpenLayers.State.DELETE].length,success=!0,finalResponse=new OpenLayers.Protocol.Response({reqFeatures:requestFeatures});for(queue=types[OpenLayers.State.INSERT],queue.length>0&&resp.push(this.create(queue,OpenLayers.Util.applyDefaults({callback:insertCallback,scope:this},options.create))),queue=types[OpenLayers.State.UPDATE],i=queue.length-1;i>=0;--i)resp.push(this.update(queue[i],OpenLayers.Util.applyDefaults({callback:callback,scope:this},options.update)));for(queue=types[OpenLayers.State.DELETE],i=queue.length-1;i>=0;--i)resp.push(this["delete"](queue[i],OpenLayers.Util.applyDefaults({callback:callback,scope:this},options["delete"])));return resp},abort:function(response){response&&response.priv.abort()},callUserCallback:function(resp,options){var opt=options[resp.requestType];opt&&opt.callback&&opt.callback.call(opt.scope,resp)},CLASS_NAME:"OpenLayers.Protocol.HTTP"});OpenLayers.Strategy.Cluster=OpenLayers.Class(OpenLayers.Strategy,{distance:20,threshold:null,features:null,clusters:null,clustering:!1,resolution:null,activate:function(){var activated=OpenLayers.Strategy.prototype.activate.call(this);if(activated)this.layer.events.on({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,scope:this});return activated},deactivate:function(){var deactivated=OpenLayers.Strategy.prototype.deactivate.call(this);return deactivated&&(this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,scope:this})),deactivated},cacheFeatures:function(event){var propagate=!0;return this.clustering||(this.clearCache(),this.features=event.features,this.cluster(),propagate=!1),propagate},clearCache:function(){this.features=null},cluster:function(event){var resolution,clusters,feature,clustered,cluster,j,clone,candidate,i,len;if((!event||event.zoomChanged)&&this.features&&(resolution=this.layer.map.getResolution(),resolution!=this.resolution||!this.clustersExist())){for(this.resolution=resolution,clusters=[],i=0;i<this.features.length;++i)if(feature=this.features[i],feature.geometry){for(clustered=!1,j=clusters.length-1;j>=0;--j)if(cluster=clusters[j],this.shouldCluster(cluster,feature)){this.addToCluster(cluster,feature);clustered=!0;break}clustered||clusters.push(this.createCluster(this.features[i]))}if(this.layer.removeAllFeatures(),clusters.length>0){if(this.threshold>1)for(clone=clusters.slice(),clusters=[],i=0,len=clone.length;i<len;++i)candidate=clone[i],candidate.attributes.count<this.threshold?Array.prototype.push.apply(clusters,candidate.cluster):clusters.push(candidate);this.clustering=!0;this.layer.addFeatures(clusters);this.clustering=!1}this.clusters=clusters}},clustersExist:function(){var exist=!1,i;if(this.clusters&&this.clusters.length>0&&this.clusters.length==this.layer.features.length)for(exist=!0,i=0;i<this.clusters.length;++i)if(this.clusters[i]!=this.layer.features[i]){exist=!1;break}return exist},shouldCluster:function(cluster,feature){var cc=cluster.geometry.getBounds().getCenterLonLat(),fc=feature.geometry.getBounds().getCenterLonLat(),distance=Math.sqrt(Math.pow(cc.lon-fc.lon,2)+Math.pow(cc.lat-fc.lat,2))/this.resolution;return distance<=this.distance},addToCluster:function(cluster,feature){cluster.cluster.push(feature);cluster.attributes.count+=1},createCluster:function(feature){var center=feature.geometry.getBounds().getCenterLonLat(),cluster=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(center.lon,center.lat),{count:1});return cluster.cluster=[feature],cluster},CLASS_NAME:"OpenLayers.Strategy.Cluster"});OpenLayers.Strategy.Filter=OpenLayers.Class(OpenLayers.Strategy,{filter:null,cache:null,caching:!1,activate:function(){var activated=OpenLayers.Strategy.prototype.activate.apply(this,arguments);if(activated){this.cache=[];this.layer.events.on({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this})}return activated},deactivate:function(){return this.cache=null,this.layer&&this.layer.events&&this.layer.events.un({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this}),OpenLayers.Strategy.prototype.deactivate.apply(this,arguments)},handleAdd:function(event){var features,feature,i,ii;if(!this.caching&&this.filter)for(features=event.features,event.features=[],i=0,ii=features.length;i<ii;++i)feature=features[i],this.filter.evaluate(feature)?event.features.push(feature):this.cache.push(feature)},handleRemove:function(){this.caching||(this.cache=[])},setFilter:function(filter){var previousCache,event;this.filter=filter;previousCache=this.cache;this.cache=[];this.handleAdd({features:this.layer.features});this.cache.length>0&&(this.caching=!0,this.layer.removeFeatures(this.cache.slice()),this.caching=!1);previousCache.length>0&&(event={features:previousCache},this.handleAdd(event),event.features.length>0&&(this.caching=!0,this.layer.addFeatures(event.features),this.caching=!1))},CLASS_NAME:"OpenLayers.Strategy.Filter"});OpenLayers.Protocol.SOS=function(options){options=OpenLayers.Util.applyDefaults(options,OpenLayers.Protocol.SOS.DEFAULTS);var cls=OpenLayers.Protocol.SOS["v"+options.version.replace(/\./g,"_")];if(!cls)throw"Unsupported SOS version: "+options.version;return new cls(options)};OpenLayers.Protocol.SOS.DEFAULTS={version:"1.0.0"};OpenLayers.Format.GeoRSS=OpenLayers.Class(OpenLayers.Format.XML,{rssns:"http://backend.userland.com/rss2",featureNS:"http://mapserver.gis.umn.edu/mapserver",georssns:"http://www.georss.org/georss",geons:"http://www.w3.org/2003/01/geo/wgs84_pos#",featureTitle:"Untitled",featureDescription:"No Description",gmlParser:null,xy:!1,createGeometryFromItem:function(item){var point=this.getElementsByTagNameNS(item,this.georssns,"point"),lat=this.getElementsByTagNameNS(item,this.geons,"lat"),lon=this.getElementsByTagNameNS(item,this.geons,"long"),line=this.getElementsByTagNameNS(item,this.georssns,"line"),polygon=this.getElementsByTagNameNS(item,this.georssns,"polygon"),where=this.getElementsByTagNameNS(item,this.georssns,"where"),box=this.getElementsByTagNameNS(item,this.georssns,"box"),location,geometry,i,len,feature,coords,components;if(point.length>0||lat.length>0&&lon.length>0)point.length>0?(location=OpenLayers.String.trim(point[0].firstChild.nodeValue).split(/\s+/),location.length!=2&&(location=OpenLayers.String.trim(point[0].firstChild.nodeValue).split(/\s*,\s*/))):location=[parseFloat(lat[0].firstChild.nodeValue),parseFloat(lon[0].firstChild.nodeValue)],geometry=new OpenLayers.Geometry.Point(location[1],location[0]);else if(line.length>0){for(coords=OpenLayers.String.trim(this.getChildValue(line[0])).split(/\s+/),components=[],i=0,len=coords.length;i<len;i+=2)point=new OpenLayers.Geometry.Point(coords[i+1],coords[i]),components.push(point);geometry=new OpenLayers.Geometry.LineString(components)}else if(polygon.length>0){for(coords=OpenLayers.String.trim(this.getChildValue(polygon[0])).split(/\s+/),components=[],i=0,len=coords.length;i<len;i+=2)point=new OpenLayers.Geometry.Point(coords[i+1],coords[i]),components.push(point);geometry=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(components)])}else where.length>0?(this.gmlParser||(this.gmlParser=new OpenLayers.Format.GML({xy:this.xy})),feature=this.gmlParser.parseFeature(where[0]),geometry=feature.geometry):box.length>0&&(coords=OpenLayers.String.trim(box[0].firstChild.nodeValue).split(/\s+/),components=[],coords.length>3&&(point=new OpenLayers.Geometry.Point(coords[1],coords[0]),components.push(point),point=new OpenLayers.Geometry.Point(coords[1],coords[2]),components.push(point),point=new OpenLayers.Geometry.Point(coords[3],coords[2]),components.push(point),point=new OpenLayers.Geometry.Point(coords[3],coords[0]),components.push(point),point=new OpenLayers.Geometry.Point(coords[1],coords[0]),components.push(point)),geometry=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(components)]));return geometry&&this.internalProjection&&this.externalProjection&&geometry.transform(this.externalProjection,this.internalProjection),geometry},createFeatureFromItem:function(item){var geometry=this.createGeometryFromItem(item),title=this._getChildValue(item,"*","title",this.featureTitle),description=this._getChildValue(item,"*","description",this._getChildValue(item,"*","content",this._getChildValue(item,"*","summary",this.featureDescription))),link=this._getChildValue(item,"*","link");if(!link)try{link=this.getElementsByTagNameNS(item,"*","link")[0].getAttribute("href")}catch(e){link=null}var id=this._getChildValue(item,"*","id",null),data={title:title,description:description,link:link},feature=new OpenLayers.Feature.Vector(geometry,data);return feature.fid=id,feature},_getChildValue:function(node,nsuri,name,def){var eles=this.getElementsByTagNameNS(node,nsuri,name);return eles&&eles[0]&&eles[0].firstChild&&eles[0].firstChild.nodeValue?this.getChildValue(eles[0]):def==undefined?"":def},read:function(doc){var itemlist,numItems,features,i;for(typeof doc=="string"&&(doc=OpenLayers.Format.XML.prototype.read.apply(this,[doc])),itemlist=null,itemlist=this.getElementsByTagNameNS(doc,"*","item"),itemlist.length==0&&(itemlist=this.getElementsByTagNameNS(doc,"*","entry")),numItems=itemlist.length,features=new Array(numItems),i=0;i<numItems;i++)features[i]=this.createFeatureFromItem(itemlist[i]);return features},write:function(features){var georss,i,len;if(OpenLayers.Util.isArray(features))for(georss=this.createElementNS(this.rssns,"rss"),i=0,len=features.length;i<len;i++)georss.appendChild(this.createFeatureXML(features[i]));else georss=this.createFeatureXML(features);return OpenLayers.Format.XML.prototype.write.apply(this,[georss])},createFeatureXML:function(feature){var geometryNode=this.buildGeometryNode(feature.geometry),featureNode=this.createElementNS(this.rssns,"item"),titleNode=this.createElementNS(this.rssns,"title"),descNode,linkNode,attr,attrText,nodename,attrContainer;titleNode.appendChild(this.createTextNode(feature.attributes.title?feature.attributes.title:""));descNode=this.createElementNS(this.rssns,"description");descNode.appendChild(this.createTextNode(feature.attributes.description?feature.attributes.description:""));featureNode.appendChild(titleNode);featureNode.appendChild(descNode);feature.attributes.link&&(linkNode=this.createElementNS(this.rssns,"link"),linkNode.appendChild(this.createTextNode(feature.attributes.link)),featureNode.appendChild(linkNode));for(attr in feature.attributes)attr!="link"&&attr!="title"&&attr!="description"&&(attrText=this.createTextNode(feature.attributes[attr]),nodename=attr,attr.search(":")!=-1&&(nodename=attr.split(":")[1]),attrContainer=this.createElementNS(this.featureNS,"feature:"+nodename),attrContainer.appendChild(attrText),featureNode.appendChild(attrContainer));return featureNode.appendChild(geometryNode),featureNode},buildGeometryNode:function(geometry){this.internalProjection&&this.externalProjection&&(geometry=geometry.clone(),geometry.transform(this.internalProjection,this.externalProjection));var node;if(geometry.CLASS_NAME=="OpenLayers.Geometry.Polygon")node=this.createElementNS(this.georssns,"georss:polygon"),node.appendChild(this.buildCoordinatesNode(geometry.components[0]));else if(geometry.CLASS_NAME=="OpenLayers.Geometry.LineString")node=this.createElementNS(this.georssns,"georss:line"),node.appendChild(this.buildCoordinatesNode(geometry));else if(geometry.CLASS_NAME=="OpenLayers.Geometry.Point")node=this.createElementNS(this.georssns,"georss:point"),node.appendChild(this.buildCoordinatesNode(geometry));else throw"Couldn't parse "+geometry.CLASS_NAME;return node},buildCoordinatesNode:function(geometry){var points=null,path,numPoints,parts,i;if(geometry.components&&(points=geometry.components),points){for(numPoints=points.length,parts=new Array(numPoints),i=0;i<numPoints;i++)parts[i]=points[i].y+" "+points[i].x;path=parts.join(" ")}else path=geometry.y+" "+geometry.x;return this.createTextNode(path)},CLASS_NAME:"OpenLayers.Format.GeoRSS"});OpenLayers.Format.WPSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.WPSCapabilities"});OpenLayers.Format.WPSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wps:"http://www.opengis.net/wps/1.0.0",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options])},read:function(data){typeof data=="string"&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data]));data&&data.nodeType==9&&(data=data.documentElement);var capabilities={};return this.readNode(data,capabilities),capabilities},readers:{wps:{Capabilities:function(node,obj){this.readChildNodes(node,obj)},ProcessOfferings:function(node,obj){obj.processOfferings={};this.readChildNodes(node,obj.processOfferings)},Process:function(node,processOfferings){var processVersion=this.getAttributeNS(node,this.namespaces.wps,"processVersion"),process={processVersion:processVersion};this.readChildNodes(node,process);processOfferings[process.identifier]=process},Languages:function(node,obj){obj.languages=[];this.readChildNodes(node,obj.languages)},Default:function(node,languages){var language={isDefault:!0};this.readChildNodes(node,language);languages.push(language)},Supported:function(node,languages){var language={};this.readChildNodes(node,language);languages.push(language)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSCapabilities.v1_0_0"});OpenLayers.Control.TouchNavigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,clickHandlerOptions:null,documentDrag:!1,autoActivate:!0,initialize:function(){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();this.dragPan&&this.dragPan.destroy();this.dragPan=null;this.pinchZoom&&(this.pinchZoom.destroy(),delete this.pinchZoom);OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.dragPan.activate(),this.handlers.click.activate(),this.pinchZoom.activate(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.dragPan.deactivate(),this.handlers.click.deactivate(),this.pinchZoom.deactivate(),!0):!1},draw:function(){var clickCallbacks={click:this.defaultClick,dblclick:this.defaultDblClick},clickOptions=OpenLayers.Util.extend({double:!0,stopDouble:!0,pixelTolerance:2},this.clickHandlerOptions);this.handlers.click=new OpenLayers.Handler.Click(this,clickCallbacks,clickOptions);this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));this.dragPan.draw();this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions))},defaultClick:function(evt){evt.lastTouches&&evt.lastTouches.length==2&&this.map.zoomOut()},defaultDblClick:function(evt){var newCenter=this.map.getLonLatFromViewPortPx(evt.xy);this.map.setCenter(newCenter,this.map.zoom+1)},CLASS_NAME:"OpenLayers.Control.TouchNavigation"});OpenLayers.Style2=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,initialize:function(config){OpenLayers.Util.extend(this,config);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var i=0,len=this.rules.length;i<len;i++)this.rules[i].destroy();delete this.rules},clone:function(){var config=OpenLayers.Util.extend({},this),i,len;if(this.rules)for(config.rules=[],i=0,len=this.rules.length;i<len;++i)config.rules.push(this.rules[i].clone());return new OpenLayers.Style2(config)},CLASS_NAME:"OpenLayers.Style2"});OpenLayers.Layer.Boxes=OpenLayers.Class(OpenLayers.Layer.Markers,{drawMarker:function(marker){var topleft=this.map.getLayerPxFromLonLat({lon:marker.bounds.left,lat:marker.bounds.top}),botright=this.map.getLayerPxFromLonLat({lon:marker.bounds.right,lat:marker.bounds.bottom}),markerDiv;botright==null||topleft==null?marker.display(!1):(markerDiv=marker.draw(topleft,{w:Math.max(1,botright.x-topleft.x),h:Math.max(1,botright.y-topleft.y)}),marker.drawn||(this.div.appendChild(markerDiv),marker.drawn=!0))},removeMarker:function(marker){OpenLayers.Util.removeItem(this.markers,marker);marker.div!=null&&marker.div.parentNode==this.div&&this.div.removeChild(marker.div)},CLASS_NAME:"OpenLayers.Layer.Boxes"});OpenLayers.Format.WFSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{readers:{wfs:OpenLayers.Util.applyDefaults({Service:function(node,capabilities){capabilities.service={};this.readChildNodes(node,capabilities.service)},Fees:function(node,service){var fees=this.getChildValue(node);fees&&fees.toLowerCase()!="none"&&(service.fees=fees)},AccessConstraints:function(node,service){var constraints=this.getChildValue(node);constraints&&constraints.toLowerCase()!="none"&&(service.accessConstraints=constraints)},OnlineResource:function(node,service){var onlineResource=this.getChildValue(node);onlineResource&&onlineResource.toLowerCase()!="none"&&(service.onlineResource=onlineResource)},Keywords:function(node,service){var keywords=this.getChildValue(node);keywords&&keywords.toLowerCase()!="none"&&(service.keywords=keywords.split(", "))},Capability:function(node,capabilities){capabilities.capability={};this.readChildNodes(node,capabilities.capability)},Request:function(node,obj){obj.request={};this.readChildNodes(node,obj.request)},GetFeature:function(node,request){request.getfeature={href:{},formats:[]};this.readChildNodes(node,request.getfeature)},ResultFormat:function(node,obj){for(var children=node.childNodes,childNode,i=0;i<children.length;i++)childNode=children[i],childNode.nodeType==1&&obj.formats.push(childNode.nodeName)},DCPType:function(node,obj){this.readChildNodes(node,obj)},HTTP:function(node,obj){this.readChildNodes(node,obj.href)},Get:function(node,obj){obj.get=node.getAttribute("onlineResource")},Post:function(node,obj){obj.post=node.getAttribute("onlineResource")},SRS:function(node,obj){var srs=this.getChildValue(node);srs&&(obj.srs=srs)}},OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs)},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_0_0"});OpenLayers.Layer.PointGrid=OpenLayers.Class(OpenLayers.Layer.Vector,{dx:null,dy:null,ratio:1.5,maxFeatures:250,rotation:0,origin:null,gridBounds:null,initialize:function(config){config=config||{};OpenLayers.Layer.Vector.prototype.initialize.apply(this,[config.name,config])},setMap:function(map){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);map.events.register("moveend",this,this.onMoveEnd)},removeMap:function(map){map.events.unregister("moveend",this,this.onMoveEnd);OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},setRatio:function(ratio){this.ratio=ratio;this.updateGrid(!0)},setMaxFeatures:function(maxFeatures){this.maxFeatures=maxFeatures;this.updateGrid(!0)},setSpacing:function(dx,dy){this.dx=dx;this.dy=dy||dx;this.updateGrid(!0)},setOrigin:function(origin){this.origin=origin;this.updateGrid(!0)},getOrigin:function(){return this.origin||(this.origin=this.map.getExtent().getCenterLonLat()),this.origin},setRotation:function(rotation){this.rotation=rotation;this.updateGrid(!0)},onMoveEnd:function(){this.updateGrid()},getViewBounds:function(){var bounds=this.map.getExtent();if(this.rotation){var origin=this.getOrigin(),rotationOrigin=new OpenLayers.Geometry.Point(origin.lon,origin.lat),rect=bounds.toGeometry();rect.rotate(-this.rotation,rotationOrigin);bounds=rect.getBounds()}return bounds},updateGrid:function(force){var i,j;if(force||this.invalidBounds()){var viewBounds=this.getViewBounds(),origin=this.getOrigin(),rotationOrigin=new OpenLayers.Geometry.Point(origin.lon,origin.lat),viewBoundsWidth=viewBounds.getWidth(),viewBoundsHeight=viewBounds.getHeight(),aspectRatio=viewBoundsWidth/viewBoundsHeight,maxHeight=Math.sqrt(this.dx*this.dy*this.maxFeatures/aspectRatio),maxWidth=maxHeight*aspectRatio,gridWidth=Math.min(viewBoundsWidth*this.ratio,maxWidth),gridHeight=Math.min(viewBoundsHeight*this.ratio,maxHeight),center=viewBounds.getCenterLonLat();this.gridBounds=new OpenLayers.Bounds(center.lon-gridWidth/2,center.lat-gridHeight/2,center.lon+gridWidth/2,center.lat+gridHeight/2);var rows=Math.floor(gridHeight/this.dy),cols=Math.floor(gridWidth/this.dx),gridLeft=origin.lon+this.dx*Math.ceil((this.gridBounds.left-origin.lon)/this.dx),gridBottom=origin.lat+this.dy*Math.ceil((this.gridBounds.bottom-origin.lat)/this.dy),features=new Array(rows*cols),x,y,point;for(i=0;i<cols;++i)for(x=gridLeft+i*this.dx,j=0;j<rows;++j)y=gridBottom+j*this.dy,point=new OpenLayers.Geometry.Point(x,y),this.rotation&&point.rotate(this.rotation,rotationOrigin),features[i*rows+j]=new OpenLayers.Feature.Vector(point);this.destroyFeatures(this.features,{silent:!0});this.addFeatures(features,{silent:!0})}},invalidBounds:function(){return!this.gridBounds||!this.gridBounds.containsBounds(this.getViewBounds())},CLASS_NAME:"OpenLayers.Layer.PointGrid"});OpenLayers.Layer.Zoomify=OpenLayers.Class(OpenLayers.Layer.Grid,{size:null,isBaseLayer:!0,standardTileSize:256,tileOriginCorner:"tl",numberOfTiers:0,tileCountUpToTier:null,tierSizeInTiles:null,tierImageSize:null,initialize:function(name,url,size,options){this.initializeZoomify(size);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[name,url,size,{},options])},initializeZoomify:function(size){var imageSize=size.clone(),tiles,resolutions,i;for(this.size=size.clone(),tiles=new OpenLayers.Size(Math.ceil(imageSize.w/this.standardTileSize),Math.ceil(imageSize.h/this.standardTileSize)),this.tierSizeInTiles=[tiles],this.tierImageSize=[imageSize];imageSize.w>this.standardTileSize||imageSize.h>this.standardTileSize;)imageSize=new OpenLayers.Size(Math.floor(imageSize.w/2),Math.floor(imageSize.h/2)),tiles=new OpenLayers.Size(Math.ceil(imageSize.w/this.standardTileSize),Math.ceil(imageSize.h/this.standardTileSize)),this.tierSizeInTiles.push(tiles),this.tierImageSize.push(imageSize);for(this.tierSizeInTiles.reverse(),this.tierImageSize.reverse(),this.numberOfTiers=this.tierSizeInTiles.length,resolutions=[1],this.tileCountUpToTier=[0],i=1;i<this.numberOfTiers;i++)resolutions.unshift(Math.pow(2,i)),this.tileCountUpToTier.push(this.tierSizeInTiles[i-1].w*this.tierSizeInTiles[i-1].h+this.tileCountUpToTier[i-1]);this.serverResolutions||(this.serverResolutions=resolutions)},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments);this.tileCountUpToTier.length=0;this.tierSizeInTiles.length=0;this.tierImageSize.length=0},clone:function(obj){return obj==null&&(obj=new OpenLayers.Layer.Zoomify(this.name,this.url,this.size,this.options)),OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj])},getURL:function(bounds){bounds=this.adjustBounds(bounds);var res=this.getServerResolution(),x=Math.round((bounds.left-this.tileOrigin.lon)/(res*this.tileSize.w)),y=Math.round((this.tileOrigin.lat-bounds.top)/(res*this.tileSize.h)),z=this.getZoomForResolution(res),tileIndex=x+y*this.tierSizeInTiles[z].w+this.tileCountUpToTier[z],path="TileGroup"+Math.floor(tileIndex/256)+"/"+z+"-"+x+"-"+y+".jpg",url=this.url;return OpenLayers.Util.isArray(url)&&(url=this.selectUrl(path,url)),url+path},getImageSize:function(){var w,h;if(arguments.length>0){var bounds=this.adjustBounds(arguments[0]),res=this.getServerResolution(),x=Math.round((bounds.left-this.tileOrigin.lon)/(res*this.tileSize.w)),y=Math.round((this.tileOrigin.lat-bounds.top)/(res*this.tileSize.h)),z=this.getZoomForResolution(res),w=this.standardTileSize,h=this.standardTileSize;return x==this.tierSizeInTiles[z].w-1&&(w=this.tierImageSize[z].w%this.standardTileSize),y==this.tierSizeInTiles[z].h-1&&(h=this.tierImageSize[z].h%this.standardTileSize),new OpenLayers.Size(w,h)}return this.tileSize},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.top)},CLASS_NAME:"OpenLayers.Layer.Zoomify"});OpenLayers.Layer.WMTS=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,serverResolutions:null,formatSuffixMap:{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"},matrix:null,initialize:function(config){var prop,args,len,ids,i;for(prop in{url:!0,layer:!0,style:!0,matrixSet:!0})if(!(prop in config))throw new Error("Missing property '"+prop+"' in layer configuration.");if(config.params=OpenLayers.Util.upperCaseObject(config.params),args=[config.name,config.url,config.params,config],OpenLayers.Layer.Grid.prototype.initialize.apply(this,args),this.formatSuffix||(this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop()),this.matrixIds&&(len=this.matrixIds.length,len&&typeof this.matrixIds[0]=="string"))for(ids=this.matrixIds,this.matrixIds=new Array(len),i=0;i<len;++i)this.matrixIds[i]={identifier:ids[i]}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.updateMatrixProperties()},updateMatrixProperties:function(){this.matrix=this.getMatrix();this.matrix&&(this.matrix.topLeftCorner&&(this.tileOrigin=this.matrix.topLeftCorner),this.matrix.tileWidth&&this.matrix.tileHeight&&(this.tileSize=new OpenLayers.Size(this.matrix.tileWidth,this.matrix.tileHeight)),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top)),this.tileFullExtent||(this.tileFullExtent=this.maxExtent))},moveTo:function(bounds,zoomChanged){return(zoomChanged||!this.matrix)&&this.updateMatrixProperties(),OpenLayers.Layer.Grid.prototype.moveTo.apply(this,arguments)},clone:function(obj){return obj==null&&(obj=new OpenLayers.Layer.WMTS(this.options)),OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj])},getIdentifier:function(){return this.getServerZoom()},getMatrix:function(){var matrix,denom,diff,delta,i,ii;if(this.matrixIds&&this.matrixIds.length!==0)if("scaleDenominator"in this.matrixIds[0])for(denom=OpenLayers.METERS_PER_INCH*OpenLayers.INCHES_PER_UNIT[this.units]*this.getServerResolution()/.00028,diff=Number.POSITIVE_INFINITY,i=0,ii=this.matrixIds.length;i<ii;++i)delta=Math.abs(1-this.matrixIds[i].scaleDenominator/denom),delta<diff&&(diff=delta,matrix=this.matrixIds[i]);else matrix=this.matrixIds[this.getIdentifier()];else matrix={identifier:this.getIdentifier()};return matrix},getTileInfo:function(loc){var res=this.getServerResolution(),fx=(loc.lon-this.tileOrigin.lon)/(res*this.tileSize.w),fy=(this.tileOrigin.lat-loc.lat)/(res*this.tileSize.h),col=Math.floor(fx),row=Math.floor(fy);return{col:col,row:row,i:Math.floor((fx-col)*this.tileSize.w),j:Math.floor((fy-row)*this.tileSize.h)}},getURL:function(bounds){var url,template,context,dimension,path,i;if(bounds=this.adjustBounds(bounds),url="",!this.tileFullExtent||this.tileFullExtent.intersectsBounds(bounds)){var center=bounds.getCenterLonLat(),info=this.getTileInfo(center),matrixId=this.matrix.identifier,dimensions=this.dimensions,params;if(url=OpenLayers.Util.isArray(this.url)?this.selectUrl([this.version,this.style,this.matrixSet,this.matrix.identifier,info.row,info.col].join(","),this.url):this.url,this.requestEncoding.toUpperCase()==="REST")if(params=this.params,url.indexOf("{")!==-1){if(template=url.replace(/\{/g,"${"),context={style:this.style,Style:this.style,TileMatrixSet:this.matrixSet,TileMatrix:this.matrix.identifier,TileRow:info.row,TileCol:info.col},dimensions)for(i=dimensions.length-1;i>=0;--i)dimension=dimensions[i],context[dimension]=params[dimension.toUpperCase()];url=OpenLayers.String.format(template,context)}else{if(path=this.version+"/"+this.layer+"/"+this.style+"/",dimensions)for(i=0;i<dimensions.length;i++)params[dimensions[i]]&&(path=path+params[dimensions[i]]+"/");path=path+this.matrixSet+"/"+this.matrix.identifier+"/"+info.row+"/"+info.col+"."+this.formatSuffix;url.match(/\/$/)||(url=url+"/");url=url+path}else this.requestEncoding.toUpperCase()==="KVP"&&(params={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:info.row,TILECOL:info.col,FORMAT:this.format},url=OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,[params]))}return url},mergeNewParams:function(newParams){if(this.requestEncoding.toUpperCase()==="KVP")return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,[OpenLayers.Util.upperCaseObject(newParams)])},CLASS_NAME:"OpenLayers.Layer.WMTS"});OpenLayers.Layer.MapServer=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{mode:"map",map_imagetype:"png"},initialize:function(name,url,params,options){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS);(options==null||options.isBaseLayer==null)&&(this.isBaseLayer=this.params.transparent!="true"&&this.params.transparent!=!0)},clone:function(obj){return obj==null&&(obj=new OpenLayers.Layer.MapServer(this.name,this.url,this.params,this.getOptions())),OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj])},getURL:function(bounds){bounds=this.adjustBounds(bounds);var extent=[bounds.left,bounds.bottom,bounds.right,bounds.top],imageSize=this.getImageSize();return this.getFullRequestString({mapext:extent,imgext:extent,map_size:[imageSize.w,imageSize.h],imgx:imageSize.w/2,imgy:imageSize.h/2,imgxy:[imageSize.w,imageSize.h]})},getFullRequestString:function(newParams,altUrl){var url=altUrl==null?this.url:altUrl,allParams=OpenLayers.Util.extend({},this.params),paramsString,urlParams,key,requestString,lastServerChar;allParams=OpenLayers.Util.extend(allParams,newParams);paramsString=OpenLayers.Util.getParameterString(allParams);OpenLayers.Util.isArray(url)&&(url=this.selectUrl(paramsString,url));urlParams=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(url));for(key in allParams)key.toUpperCase()in urlParams&&delete allParams[key];return paramsString=OpenLayers.Util.getParameterString(allParams),requestString=url,paramsString=paramsString.replace(/,/g,"+"),paramsString!=""&&(lastServerChar=url.charAt(url.length-1),requestString+=lastServerChar=="&"||lastServerChar=="?"?paramsString:url.indexOf("?")==-1?"?"+paramsString:"&"+paramsString),requestString},CLASS_NAME:"OpenLayers.Layer.MapServer"});OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(){var style,shapes,i,len;if(this.supported()){if(!document.namespaces.olv)for(document.namespaces.add("olv",this.xmlns),style=document.createStyleSheet(),shapes=["shape","rect","oval","fill","stroke","imagedata","group","textbox"],i=0,len=shapes.length;i<len;i++)style.addRule("olv\\:"+shapes[i],"behavior: url(#default#VML); position: absolute; display: inline-block;");OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments)}},supported:function(){return!!document.namespaces},setExtent:function(extent,resolutionChanged){var coordSysUnchanged=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),resolution=this.getResolution(),left=extent.left/resolution|0,top=extent.top/resolution-this.size.h|0,org,roots,root,i,len,size;for(resolutionChanged||!this.offset?(this.offset={x:left,y:top},left=0,top=0):(left=left-this.offset.x,top=top-this.offset.y),org=left-this.xOffset+" "+top,this.root.coordorigin=org,roots=[this.root,this.vectorRoot,this.textRoot],i=0,len=roots.length;i<len;++i)root=roots[i],size=this.size.w+" "+this.size.h,root.coordsize=size;return this.root.style.flip="y",coordSysUnchanged},setSize:function(){var i,len;OpenLayers.Renderer.prototype.setSize.apply(this,arguments);var roots=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot],w=this.size.w+"px",h=this.size.h+"px",root;for(i=0,len=roots.length;i<len;++i)root=roots[i],root.style.width=w,root.style.height=h},getNodeType:function(geometry,style){var nodeType=null;switch(geometry.CLASS_NAME){case"OpenLayers.Geometry.Point":nodeType=style.externalGraphic?"olv:rect":this.isComplexSymbol(style.graphicName)?"olv:shape":"olv:oval";break;case"OpenLayers.Geometry.Rectangle":nodeType="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":nodeType="olv:shape"}return nodeType},setStyle:function(node,style,options,geometry){var fillColor,title,width,height,cache,size,fills,fill,img,rotation,strokes,stroke;if(style=style||node._style,options=options||node._options,fillColor=style.fillColor,title=style.title||style.graphicTitle,title&&(node.title=title),node._geometryClass==="OpenLayers.Geometry.Point")if(style.externalGraphic){options.isFilled=!0;width=style.graphicWidth||style.graphicHeight;height=style.graphicHeight||style.graphicWidth;width=width?width:style.pointRadius*2;height=height?height:style.pointRadius*2;var resolution=this.getResolution(),xOffset=style.graphicXOffset!=undefined?style.graphicXOffset:-(.5*width),yOffset=style.graphicYOffset!=undefined?style.graphicYOffset:-(.5*height);node.style.left=((geometry.x-this.featureDx)/resolution-this.offset.x+xOffset|0)+"px";node.style.top=(geometry.y/resolution-this.offset.y-(yOffset+height)|0)+"px";node.style.width=width+"px";node.style.height=height+"px";node.style.flip="y";fillColor="none";options.isStroked=!1}else this.isComplexSymbol(style.graphicName)?(cache=this.importSymbol(style.graphicName),node.path=cache.path,node.coordorigin=cache.left+","+cache.bottom,size=cache.size,node.coordsize=size+","+size,this.drawCircle(node,geometry,style.pointRadius),node.style.flip="y"):this.drawCircle(node,geometry,style.pointRadius);return options.isFilled?node.fillcolor=style.externalGraphic?"none":fillColor:node.filled="false",fills=node.getElementsByTagName("fill"),fill=fills.length==0?null:fills[0],options.isFilled?(fill||(fill=this.createNode("olv:fill",node.id+"_fill")),fill.opacity=style.fillOpacity,style.externalGraphic?(fill.src!=style.externalGraphic||(fill.size?parseFloat(fill.size.value.split(",")[1]):0)!=style.pointRadius*144/96)&&(style.graphicOpacity&&(fill.opacity=style.graphicOpacity),fill.src=style.externalGraphic,fill.type=node._geometryClass==="OpenLayers.Geometry.Point"?"frame":"tile",img=new Image,img.onload=OpenLayers.Function.bind(function(){var height=img.height*72/96,width=img.width*72/96,aspect;style.pointRadius&&(aspect=width/height,height=style.pointRadius*144/96,width=height*aspect);fill.size=width+"pt,"+height+"pt"}),img.src=style.externalGraphic,style.graphicWidth&&style.graphicHeight||(fill.aspect="atmost")):style.graphicName&&node._geometryClass!=="OpenLayers.Geometry.Point"&&OpenLayers.Console.error("WellKnownName is not yet supported as GraphicFill by the VML renderer!"),fill.parentNode!=node&&node.appendChild(fill)):fill&&node.removeChild(fill),rotation=style.rotation,(rotation!==undefined||node._rotation!==undefined)&&(node._rotation=rotation,style.externalGraphic?(this.graphicRotate(node,xOffset,yOffset,style),fill.opacity=0):node._geometryClass==="OpenLayers.Geometry.Point"&&(node.style.rotation=rotation||0)),strokes=node.getElementsByTagName("stroke"),stroke=strokes.length==0?null:strokes[0],options.isStroked?(stroke||(stroke=this.createNode("olv:stroke",node.id+"_stroke"),node.appendChild(stroke)),stroke.on=!0,stroke.color=style.strokeColor,stroke.weight=style.strokeWidth+"px",stroke.opacity=style.strokeOpacity,stroke.endcap=style.strokeLinecap=="butt"?"flat":style.strokeLinecap||"round",style.strokeDashstyle&&(stroke.dashstyle=this.dashStyle(style))):(node.stroked=!1,stroke&&(stroke.on=!1)),style.cursor!="inherit"&&style.cursor!=null&&(node.style.cursor=style.cursor),node},graphicRotate:function(node,xOffset,yOffset,style){var style=style||node._style,rotation=style.rotation||0,aspectRatio,size,img,width,height,image,centerPoint,imgBox,imgBounds;if(style.graphicWidth&&style.graphicHeight)size=Math.max(style.graphicWidth,style.graphicHeight),aspectRatio=style.graphicWidth/style.graphicHeight;else{img=new Image;img.onreadystatechange=OpenLayers.Function.bind(function(){(img.readyState=="complete"||img.readyState=="interactive")&&(aspectRatio=img.width/img.height,size=Math.max(style.pointRadius*2,style.graphicWidth||0,style.graphicHeight||0),xOffset=xOffset*aspectRatio,style.graphicWidth=size*aspectRatio,style.graphicHeight=size,this.graphicRotate(node,xOffset,yOffset,style))},this);img.src=style.externalGraphic;return}width=Math.round(style.graphicWidth||size*aspectRatio);height=Math.round(style.graphicHeight||size);node.style.width=width+"px";node.style.height=height+"px";image=document.getElementById(node.id+"_image");image||(image=this.createNode("olv:imagedata",node.id+"_image"),node.appendChild(image));image.style.width=width+"px";image.style.height=height+"px";image.src=style.externalGraphic;image.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";var rot=rotation*Math.PI/180,sintheta=Math.sin(rot),costheta=Math.cos(rot),filter="progid:DXImageTransform.Microsoft.Matrix(M11="+costheta+",M12="+-sintheta+",M21="+sintheta+",M22="+costheta+",SizingMethod='auto expand')\n",opacity=style.graphicOpacity||style.fillOpacity;opacity&&opacity!=1&&(filter+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+opacity+")\n");node.style.filter=filter;centerPoint=new OpenLayers.Geometry.Point(-xOffset,-yOffset);imgBox=new OpenLayers.Bounds(0,0,width,height).toGeometry();imgBox.rotate(style.rotation,centerPoint);imgBounds=imgBox.getBounds();node.style.left=Math.round(parseInt(node.style.left)+imgBounds.left)+"px";node.style.top=Math.round(parseInt(node.style.top)-imgBounds.bottom)+"px"},postDraw:function(node){node.style.visibility="visible";var fillColor=node._style.fillColor,strokeColor=node._style.strokeColor;fillColor=="none"&&node.fillcolor!=fillColor&&(node.fillcolor=fillColor);strokeColor=="none"&&node.strokecolor!=strokeColor&&(node.strokecolor=strokeColor)},setNodeDimension:function(node,geometry){var bbox=geometry.getBounds(),resolution,scaledBox;bbox&&(resolution=this.getResolution(),scaledBox=new OpenLayers.Bounds((bbox.left-this.featureDx)/resolution-this.offset.x|0,bbox.bottom/resolution-this.offset.y|0,(bbox.right-this.featureDx)/resolution-this.offset.x|0,bbox.top/resolution-this.offset.y|0),node.style.left=scaledBox.left+"px",node.style.top=scaledBox.top+"px",node.style.width=scaledBox.getWidth()+"px",node.style.height=scaledBox.getHeight()+"px",node.coordorigin=scaledBox.left+" "+scaledBox.top,node.coordsize=scaledBox.getWidth()+" "+scaledBox.getHeight())},dashStyle:function(style){var dash=style.strokeDashstyle,parts;switch(dash){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return dash;default:return(parts=dash.split(/[ ,]/),parts.length==2)?1*parts[0]>=2*parts[1]?"longdash":parts[0]==1||parts[1]==1?"dot":"dash":parts.length==4?1*parts[0]>=2*parts[1]?"longdashdot":"dashdot":"solid"}},createNode:function(type,id){var node=document.createElement(type);return id&&(node.id=id),node.unselectable="on",node.onselectstart=OpenLayers.Function.False,node},nodeTypeCompare:function(node,type){var subType=type,splitIndex=subType.indexOf(":"),nodeName;return splitIndex!=-1&&(subType=subType.substr(splitIndex+1)),nodeName=node.nodeName,splitIndex=nodeName.indexOf(":"),splitIndex!=-1&&(nodeName=nodeName.substr(splitIndex+1)),subType==nodeName},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(suffix){return this.nodeFactory(this.container.id+suffix,"olv:group")},drawPoint:function(node,geometry){return this.drawCircle(node,geometry,1)},drawCircle:function(node,geometry,radius){var resolution,diameter;return!isNaN(geometry.x)&&!isNaN(geometry.y)?(resolution=this.getResolution(),node.style.left=((geometry.x-this.featureDx)/resolution-this.offset.x|0)-radius+"px",node.style.top=(geometry.y/resolution-this.offset.y|0)-radius+"px",diameter=radius*2,node.style.width=diameter+"px",node.style.height=diameter+"px",node):!1},drawLineString:function(node,geometry){return this.drawLine(node,geometry,!1)},drawLinearRing:function(node,geometry){return this.drawLine(node,geometry,!0)},drawLine:function(node,geometry,closeLine){var i,end;this.setNodeDimension(node,geometry);var resolution=this.getResolution(),numComponents=geometry.components.length,parts=new Array(numComponents),comp,x,y;for(i=0;i<numComponents;i++)comp=geometry.components[i],x=(comp.x-this.featureDx)/resolution-this.offset.x|0,y=comp.y/resolution-this.offset.y|0,parts[i]=" "+x+","+y+" l ";return end=closeLine?" x e":" e",node.path="m"+parts.join("")+end,node},drawPolygon:function(node,geometry){this.setNodeDimension(node,geometry);for(var resolution=this.getResolution(),path=[],points,area,first,second,i,ii,comp,pathComp,x,y,j=0,jj=geometry.components.length;j<jj;j++){for(path.push("m"),points=geometry.components[j].components,area=j===0,first=null,second=null,i=0,ii=points.length;i<ii;i++)comp=points[i],x=(comp.x-this.featureDx)/resolution-this.offset.x|0,y=comp.y/resolution-this.offset.y|0,pathComp=" "+x+","+y,path.push(pathComp),i==0&&path.push(" l"),area||(first?first!=pathComp&&(second?second!=pathComp&&(area=!0):second=pathComp):first=pathComp);path.push(area?" x ":" ")}return path.push("e"),node.path=path.join(""),node},drawRectangle:function(node,geometry){var resolution=this.getResolution();return node.style.left=((geometry.x-this.featureDx)/resolution-this.offset.x|0)+"px",node.style.top=(geometry.y/resolution-this.offset.y|0)+"px",node.style.width=(geometry.width/resolution|0)+"px",node.style.height=(geometry.height/resolution|0)+"px",node},drawText:function(featureId,style,location){var label=this.nodeFactory(featureId+this.LABEL_ID_SUFFIX,"olv:rect"),textbox=this.nodeFactory(featureId+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox"),resolution=this.getResolution(),align,xshift,yshift;label.style.left=((location.x-this.featureDx)/resolution-this.offset.x|0)+"px";label.style.top=(location.y/resolution-this.offset.y|0)+"px";label.style.flip="y";textbox.innerText=style.label;style.cursor!="inherit"&&style.cursor!=null&&(textbox.style.cursor=style.cursor);style.fontColor&&(textbox.style.color=style.fontColor);style.fontOpacity&&(textbox.style.filter="alpha(opacity="+style.fontOpacity*100+")");style.fontFamily&&(textbox.style.fontFamily=style.fontFamily);style.fontSize&&(textbox.style.fontSize=style.fontSize);style.fontWeight&&(textbox.style.fontWeight=style.fontWeight);style.fontStyle&&(textbox.style.fontStyle=style.fontStyle);style.labelSelect===!0&&(label._featureId=featureId,textbox._featureId=featureId,textbox._geometry=location,textbox._geometryClass=location.CLASS_NAME);textbox.style.whiteSpace="nowrap";textbox.inset="1px,0px,0px,0px";label.parentNode||(label.appendChild(textbox),this.textRoot.appendChild(label));align=style.labelAlign||"cm";align.length==1&&(align+="m");xshift=textbox.clientWidth*OpenLayers.Renderer.VML.LABEL_SHIFT[align.substr(0,1)];yshift=textbox.clientHeight*OpenLayers.Renderer.VML.LABEL_SHIFT[align.substr(1,1)];label.style.left=parseInt(label.style.left)-xshift-1+"px";label.style.top=parseInt(label.style.top)+yshift+"px"},moveRoot:function(renderer){var layer=this.map.getLayer(renderer.container.id);layer instanceof OpenLayers.Layer.Vector.RootContainer&&(layer=this.map.getLayer(this.container.id));layer&&layer.renderer.clear();OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments);layer&&layer.redraw()},importSymbol:function(graphicName){var id=this.container.id+"-"+graphicName,cache=this.symbolCache[id],symbol,symbolExtent,pathitems,i,x,y,path,diff;if(cache)return cache;if(symbol=OpenLayers.Renderer.symbol[graphicName],!symbol)throw new Error(graphicName+" is not a valid symbol name");for(symbolExtent=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),pathitems=["m"],i=0;i<symbol.length;i=i+2)x=symbol[i],y=symbol[i+1],symbolExtent.left=Math.min(symbolExtent.left,x),symbolExtent.bottom=Math.min(symbolExtent.bottom,y),symbolExtent.right=Math.max(symbolExtent.right,x),symbolExtent.top=Math.max(symbolExtent.top,y),pathitems.push(x),pathitems.push(y),i==0&&pathitems.push("l");return pathitems.push("x e"),path=pathitems.join(" "),diff=(symbolExtent.getWidth()-symbolExtent.getHeight())/2,diff>0?(symbolExtent.bottom=symbolExtent.bottom-diff,symbolExtent.top=symbolExtent.top+diff):(symbolExtent.left=symbolExtent.left+diff,symbolExtent.right=symbolExtent.right-diff),cache={path:path,size:symbolExtent.getWidth(),left:symbolExtent.left,bottom:symbolExtent.bottom},this.symbolCache[id]=cache,cache},CLASS_NAME:"OpenLayers.Renderer.VML"});OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:.5,r:1,t:0,m:.5,b:1};OpenLayers.Control.CacheRead=OpenLayers.Class(OpenLayers.Control,{fetchEvent:"tileloadstart",layers:null,autoActivate:!0,setMap:function(map){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var layers=this.layers||map.layers,i=layers.length-1;i>=0;--i)this.addLayer({layer:layers[i]});if(!this.layers)map.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})},addLayer:function(evt){evt.layer.events.register(this.fetchEvent,this,this.fetch)},removeLayer:function(evt){evt.layer.events.unregister(this.fetchEvent,this,this.fetch)},fetch:function(evt){var tile,url,dataURI;this.active&&window.localStorage&&evt.tile instanceof OpenLayers.Tile.Image&&(tile=evt.tile,url=tile.url,!tile.layer.crossOriginKeyword&&OpenLayers.ProxyHost&&url.indexOf(OpenLayers.ProxyHost)===0&&(url=OpenLayers.Control.CacheWrite.urlMap[url]),dataURI=window.localStorage.getItem("olCache_"+url),dataURI&&(tile.url=dataURI,evt.type==="tileerror"&&tile.setImgSrc(dataURI)))},destroy:function(){if(this.layers||this.map)for(var layers=this.layers||this.map.layers,i=layers.length-1;i>=0;--i)this.removeLayer({layer:layers[i]});this.map&&this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.CacheRead"});OpenLayers.Protocol.WFS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.0.0",CLASS_NAME:"OpenLayers.Protocol.WFS.v1_0_0"});OpenLayers.Control.WMTSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,requestEncoding:"KVP",drillDown:!1,maxFeatures:10,clickCallback:"click",layers:null,queryVisible:!0,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,pending:0,initialize:function(options){if(options=options||{},options.handlerOptions=options.handlerOptions||{},OpenLayers.Control.prototype.initialize.apply(this,[options]),this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(options.formatOptions)),this.drillDown===!0&&(this.hover=!1),this.hover)this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}));else{var callbacks={};callbacks[this.clickCallback]=this.getInfoForClick;this.handler=new OpenLayers.Handler.Click(this,callbacks,this.handlerOptions.click||{})}},getInfoForClick:function(evt){this.request(evt.xy,{})},getInfoForHover:function(evt){this.request(evt.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(--this.pending,this.pending<=0&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),this.pending=0),this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var candidates=this.layers||this.map.layers,layers=[],layer,i=candidates.length-1;i>=0;--i)if(layer=candidates[i],layer instanceof OpenLayers.Layer.WMTS&&layer.requestEncoding===this.requestEncoding&&(!this.queryVisible||layer.getVisibility())&&(layers.push(layer),!this.drillDown||this.hover))break;return layers},buildRequestOptions:function(layer,xy){var loc=this.map.getLonLatFromPixel(xy),getTileUrl=layer.getURL(new OpenLayers.Bounds(loc.lon,loc.lat,loc.lon,loc.lat)),params=OpenLayers.Util.getParameters(getTileUrl),tileInfo=layer.getTileInfo(loc);return OpenLayers.Util.extend(params,{service:"WMTS",version:layer.version,request:"GetFeatureInfo",infoFormat:this.infoFormat,i:tileInfo.i,j:tileInfo.j}),OpenLayers.Util.applyDefaults(params,this.vendorParams),{url:OpenLayers.Util.isArray(layer.url)?layer.url[0]:layer.url,params:OpenLayers.Util.upperCaseObject(params),callback:function(request){this.handleResponse(xy,request,layer)},scope:this}},request:function(xy,options){var layers,issue,layer,i,len,requestOptions,request;if(options=options||{},layers=this.findLayers(),layers.length>0){for(i=0,len=layers.length;i<len;i++)layer=layers[i],issue=this.events.triggerEvent("beforegetfeatureinfo",{xy:xy,layer:layer}),issue!==!1&&(++this.pending,requestOptions=this.buildRequestOptions(layer,xy),request=OpenLayers.Request.GET(requestOptions),options.hover===!0&&(this.hoverRequest=request));this.pending>0&&OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait")}},handleResponse:function(xy,request,layer){var doc,features,except;if(--this.pending,this.pending<=0&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),this.pending=0),request.status&&(request.status<200||request.status>=300))this.events.triggerEvent("exception",{xy:xy,request:request,layer:layer});else{doc=request.responseXML;doc&&doc.documentElement||(doc=request.responseText);try{features=this.format.read(doc)}catch(error){except=!0;this.events.triggerEvent("exception",{xy:xy,request:request,error:error,layer:layer})}except||this.events.triggerEvent("getfeatureinfo",{text:request.responseText,features:features,request:request,xy:xy,layer:layer})}},CLASS_NAME:"OpenLayers.Control.WMTSGetFeatureInfo"});OpenLayers.Protocol.CSW.v2_0_2=OpenLayers.Class(OpenLayers.Protocol,{formatOptions:null,initialize:function(options){OpenLayers.Protocol.prototype.initialize.apply(this,[options]);options.format||(this.format=new OpenLayers.Format.CSWGetRecords.v2_0_2(OpenLayers.Util.extend({},this.formatOptions)))},destroy:function(){this.options&&!this.options.format&&this.format.destroy();this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(options){options=OpenLayers.Util.extend({},options);OpenLayers.Util.applyDefaults(options,this.options||{});var response=new OpenLayers.Protocol.Response({requestType:"read"}),data=this.format.write(options.params||options);return response.priv=OpenLayers.Request.POST({url:options.url,callback:this.createCallback(this.handleRead,response,options),params:options.params,headers:options.headers,data:data}),response},handleRead:function(response,options){if(options.callback){var request=response.priv;request.status>=200&&request.status<300?(response.data=this.parseData(request),response.code=OpenLayers.Protocol.Response.SUCCESS):response.code=OpenLayers.Protocol.Response.FAILURE;options.callback.call(options.scope,response)}},parseData:function(request){var doc=request.responseXML;return(doc&&doc.documentElement||(doc=request.responseText),!doc||doc.length<=0)?null:this.format.read(doc)},CLASS_NAME:"OpenLayers.Protocol.CSW.v2_0_2"});OpenLayers.Control.Graticule=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,intervals:[45,30,20,10,5,2,1,.5,.2,.1,.05,.01,.005,.002,.001],displayInLayerSwitcher:!0,visible:!0,numPoints:50,targetSize:200,layerName:null,labelled:!0,labelFormat:"dm",lineSymbolizer:{strokeColor:"#333",strokeWidth:1,strokeOpacity:.5},labelSymbolizer:{},gratLayer:null,initialize:function(options){options=options||{};options.layerName=options.layerName||OpenLayers.i18n("Graticule");OpenLayers.Control.prototype.initialize.apply(this,[options]);this.labelSymbolizer.stroke=!1;this.labelSymbolizer.fill=!1;this.labelSymbolizer.label="${label}";this.labelSymbolizer.labelAlign="${labelAlign}";this.labelSymbolizer.labelXOffset="${xOffset}";this.labelSymbolizer.labelYOffset="${yOffset}"},destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments);this.gratLayer&&(this.gratLayer.destroy(),this.gratLayer=null)},draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),!this.gratLayer){var gratStyle=new OpenLayers.Style({},{rules:[new OpenLayers.Rule({symbolizer:{Point:this.labelSymbolizer,Line:this.lineSymbolizer}})]});this.gratLayer=new OpenLayers.Layer.Vector(this.layerName,{styleMap:new OpenLayers.StyleMap({"default":gratStyle}),visibility:this.visible,displayInLayerSwitcher:this.displayInLayerSwitcher})}return this.div},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.map.addLayer(this.gratLayer),this.map.events.register("moveend",this,this.update),this.update(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.map.events.unregister("moveend",this,this.update),this.map.removeLayer(this.gratLayer),!0):!1},update:function(){var mapBounds=this.map.getExtent(),mapCenter,mapCenterLL,testSq,llInterval,distSq,centerLatPoints,lines,j,i,gridPoint,labelPos,labelAttrs,geom;if(mapBounds){this.gratLayer.destroyFeatures();var llProj=new OpenLayers.Projection("EPSG:4326"),mapProj=this.map.getProjectionObject(),mapRes=this.map.getResolution();for(mapProj.proj&&mapProj.proj.projName=="longlat"&&(this.numPoints=1),mapCenter=this.map.getCenter(),mapCenterLL=new OpenLayers.Pixel(mapCenter.lon,mapCenter.lat),OpenLayers.Projection.transform(mapCenterLL,mapProj,llProj),testSq=this.targetSize*mapRes,testSq*=testSq,i=0;i<this.intervals.length;++i){llInterval=this.intervals[i];var delta=llInterval/2,p1=mapCenterLL.offset({x:-delta,y:-delta}),p2=mapCenterLL.offset({x:delta,y:delta});if(OpenLayers.Projection.transform(p1,llProj,mapProj),OpenLayers.Projection.transform(p2,llProj,mapProj),distSq=(p1.x-p2.x)*(p1.x-p2.x)+(p1.y-p2.y)*(p1.y-p2.y),distSq<=testSq)break}mapCenterLL.x=Math.floor(mapCenterLL.x/llInterval)*llInterval;mapCenterLL.y=Math.floor(mapCenterLL.y/llInterval)*llInterval;var iter=0,centerLonPoints=[mapCenterLL.clone()],newPoint=mapCenterLL.clone(),mapXY;do newPoint=newPoint.offset({x:0,y:llInterval}),mapXY=OpenLayers.Projection.transform(newPoint.clone(),llProj,mapProj),centerLonPoints.unshift(newPoint);while(mapBounds.containsPixel(mapXY)&&++iter<1e3);newPoint=mapCenterLL.clone();do newPoint=newPoint.offset({x:0,y:-llInterval}),mapXY=OpenLayers.Projection.transform(newPoint.clone(),llProj,mapProj),centerLonPoints.push(newPoint);while(mapBounds.containsPixel(mapXY)&&++iter<1e3);iter=0;centerLatPoints=[mapCenterLL.clone()];newPoint=mapCenterLL.clone();do newPoint=newPoint.offset({x:-llInterval,y:0}),mapXY=OpenLayers.Projection.transform(newPoint.clone(),llProj,mapProj),centerLatPoints.unshift(newPoint);while(mapBounds.containsPixel(mapXY)&&++iter<1e3);newPoint=mapCenterLL.clone();do newPoint=newPoint.offset({x:llInterval,y:0}),mapXY=OpenLayers.Projection.transform(newPoint.clone(),llProj,mapProj),centerLatPoints.push(newPoint);while(mapBounds.containsPixel(mapXY)&&++iter<1e3);for(lines=[],i=0;i<centerLatPoints.length;++i){var lon=centerLatPoints[i].x,pointList=[],labelPoint=null,latEnd=Math.min(centerLonPoints[0].y,90),latStart=Math.max(centerLonPoints[centerLonPoints.length-1].y,-90),latDelta=(latEnd-latStart)/this.numPoints,lat=latStart;for(j=0;j<=this.numPoints;++j)gridPoint=new OpenLayers.Geometry.Point(lon,lat),gridPoint.transform(llProj,mapProj),pointList.push(gridPoint),lat+=latDelta,gridPoint.y>=mapBounds.bottom&&!labelPoint&&(labelPoint=gridPoint);this.labelled&&(labelPos=new OpenLayers.Geometry.Point(labelPoint.x,mapBounds.bottom),labelAttrs={value:lon,label:this.labelled?OpenLayers.Util.getFormattedLonLat(lon,"lon",this.labelFormat):"",labelAlign:"cb",xOffset:0,yOffset:2},this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(labelPos,labelAttrs)));geom=new OpenLayers.Geometry.LineString(pointList);lines.push(new OpenLayers.Feature.Vector(geom))}for(j=0;j<centerLonPoints.length;++j)if(lat=centerLonPoints[j].y,!(lat<-90)&&!(lat>90)){var pointList=[],lonStart=centerLatPoints[0].x,lonEnd=centerLatPoints[centerLatPoints.length-1].x,lonDelta=(lonEnd-lonStart)/this.numPoints,lon=lonStart,labelPoint=null;for(i=0;i<=this.numPoints;++i)gridPoint=new OpenLayers.Geometry.Point(lon,lat),gridPoint.transform(llProj,mapProj),pointList.push(gridPoint),lon+=lonDelta,gridPoint.x<mapBounds.right&&(labelPoint=gridPoint);this.labelled&&(labelPos=new OpenLayers.Geometry.Point(mapBounds.right,labelPoint.y),labelAttrs={value:lat,label:this.labelled?OpenLayers.Util.getFormattedLonLat(lat,"lat",this.labelFormat):"",labelAlign:"rb",xOffset:-2,yOffset:2},this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(labelPos,labelAttrs)));geom=new OpenLayers.Geometry.LineString(pointList);lines.push(new OpenLayers.Feature.Vector(geom))}this.gratLayer.addFeatures(lines)}},CLASS_NAME:"OpenLayers.Control.Graticule"});OpenLayers.Layer.UTFGrid=OpenLayers.Class(OpenLayers.Layer.XYZ,{isBaseLayer:!1,projection:new OpenLayers.Projection("EPSG:900913"),useJSONP:!1,tileClass:OpenLayers.Tile.UTFGrid,initialize:function(options){OpenLayers.Layer.Grid.prototype.initialize.apply(this,[options.name,options.url,{},options]);this.tileOptions=OpenLayers.Util.extend({utfgridResolution:this.utfgridResolution},this.tileOptions)},clone:function(obj){return obj==null&&(obj=new OpenLayers.Layer.UTFGrid(this.getOptions())),OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj])},getFeatureInfo:function(location){var info=null,tileInfo=this.getTileData(location);return tileInfo.tile&&(info=tileInfo.tile.getFeatureInfo(tileInfo.i,tileInfo.j)),info},getFeatureId:function(location){var id=null,info=this.getTileData(location);return info.tile&&(id=info.tile.getFeatureId(info.i,info.j)),id},CLASS_NAME:"OpenLayers.Layer.UTFGrid"});OpenLayers.Protocol.Script=OpenLayers.Class(OpenLayers.Protocol,{url:null,params:null,callback:null,callbackTemplate:"OpenLayers.Protocol.Script.registry.${id}",callbackKey:"callback",callbackPrefix:"",scope:null,format:null,pendingRequests:null,srsInBBOX:!1,initialize:function(options){if(options=options||{},this.params={},this.pendingRequests={},OpenLayers.Protocol.prototype.initialize.apply(this,arguments),this.format||(this.format=new OpenLayers.Format.GeoJSON),!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var format=new OpenLayers.Format.QueryStringFilter({srsInBBOX:this.srsInBBOX});this.filterToParams=function(filter,params){return format.write(filter,params)}}},read:function(options){OpenLayers.Protocol.prototype.read.apply(this,arguments);options=OpenLayers.Util.applyDefaults(options,this.options);options.params=OpenLayers.Util.applyDefaults(options.params,this.options.params);options.filter&&this.filterToParams&&(options.params=this.filterToParams(options.filter,options.params));var response=new OpenLayers.Protocol.Response({requestType:"read"}),request=this.createRequest(options.url,options.params,OpenLayers.Function.bind(function(data){response.data=data;this.handleRead(response,options)},this));return response.priv=request,response},createRequest:function(url,params,callback){var id=OpenLayers.Protocol.Script.register(callback),name=OpenLayers.String.format(this.callbackTemplate,{id:id}),script,head;return params=OpenLayers.Util.extend({},params),params[this.callbackKey]=this.callbackPrefix+name,url=OpenLayers.Util.urlAppend(url,OpenLayers.Util.getParameterString(params)),script=document.createElement("script"),script.type="text/javascript",script.src=url,script.id="OpenLayers_Protocol_Script_"+id,this.pendingRequests[script.id]=script,head=document.getElementsByTagName("head")[0],head.appendChild(script),script},destroyRequest:function(script){OpenLayers.Protocol.Script.unregister(script.id.split("_").pop());delete this.pendingRequests[script.id];script.parentNode&&script.parentNode.removeChild(script)},handleRead:function(response,options){this.handleResponse(response,options)},handleResponse:function(response,options){options.callback&&(response.data?(response.features=this.parseFeatures(response.data),response.code=OpenLayers.Protocol.Response.SUCCESS):response.code=OpenLayers.Protocol.Response.FAILURE,this.destroyRequest(response.priv),options.callback.call(options.scope,response))},parseFeatures:function(data){return this.format.read(data)},abort:function(response){if(response)this.destroyRequest(response.priv);else for(var key in this.pendingRequests)this.destroyRequest(this.pendingRequests[key])},destroy:function(){this.abort();delete this.params;delete this.format;OpenLayers.Protocol.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Protocol.Script"}),function(){var o=OpenLayers.Protocol.Script,counter=0;o.registry={};o.register=function(callback){var id="c"+ ++counter;return o.registry[id]=function(){callback.apply(this,arguments)},id};o.unregister=function(id){delete o.registry[id]}}();OpenLayers.Control.TransformFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,layer:null,preserveAspectRatio:!1,rotate:!0,feature:null,renderIntent:"temporary",rotationHandleSymbolizer:null,box:null,center:null,scale:1,ratio:1,rotation:0,handles:null,rotationHandles:null,dragControl:null,irregular:!1,initialize:function(layer,options){OpenLayers.Control.prototype.initialize.apply(this,[options]);this.layer=layer;this.rotationHandleSymbolizer||(this.rotationHandleSymbolizer={stroke:!1,pointRadius:10,fillOpacity:0,cursor:"pointer"});this.createBox();this.createControl()},activate:function(){var activated=!1;return OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.dragControl.activate(),this.layer.addFeatures([this.box]),this.rotate&&this.layer.addFeatures(this.rotationHandles),this.layer.addFeatures(this.handles),activated=!0),activated},deactivate:function(){var deactivated=!1;return OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.layer.removeFeatures(this.handles),this.rotate&&this.layer.removeFeatures(this.rotationHandles),this.layer.removeFeatures([this.box]),this.dragControl.deactivate(),deactivated=!0),deactivated},setMap:function(map){this.dragControl.setMap(map);OpenLayers.Control.prototype.setMap.apply(this,arguments)},setFeature:function(feature,initialParams){var oldRotation,oldCenter,cont,featureBounds,ll,geom,box,llGeom;(initialParams=OpenLayers.Util.applyDefaults(initialParams,{rotation:0,scale:1,ratio:1}),oldRotation=this.rotation,oldCenter=this.center,OpenLayers.Util.extend(this,initialParams),cont=this.events.triggerEvent("beforesetfeature",{feature:feature}),cont!==!1)&&(this.feature=feature,this.activate(),this._setfeature=!0,featureBounds=this.feature.geometry.getBounds(),this.box.move(featureBounds.getCenterLonLat()),this.box.geometry.rotate(-oldRotation,oldCenter),this._angle=0,this.rotation?(geom=feature.geometry.clone(),geom.rotate(-this.rotation,this.center),box=new OpenLayers.Feature.Vector(geom.getBounds().toGeometry()),box.geometry.rotate(this.rotation,this.center),this.box.geometry.rotate(this.rotation,this.center),this.box.move(box.geometry.getBounds().getCenterLonLat()),llGeom=box.geometry.components[0].components[0],ll=llGeom.getBounds().getCenterLonLat()):ll=new OpenLayers.LonLat(featureBounds.left,featureBounds.bottom),this.handles[0].move(ll),delete this._setfeature,this.events.triggerEvent("setfeature",{feature:feature}))},unsetFeature:function(){this.active?this.deactivate():(this.feature=null,this.rotation=0,this.scale=1,this.ratio=1)},createBox:function(){var control=this,i;this.center=new OpenLayers.Geometry.Point(0,0);this.box=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(-1,-1),new OpenLayers.Geometry.Point(0,-1),new OpenLayers.Geometry.Point(1,-1),new OpenLayers.Geometry.Point(1,0),new OpenLayers.Geometry.Point(1,1),new OpenLayers.Geometry.Point(0,1),new OpenLayers.Geometry.Point(-1,1),new OpenLayers.Geometry.Point(-1,0),new OpenLayers.Geometry.Point(-1,-1)]),null,typeof this.renderIntent=="string"?null:this.renderIntent);this.box.geometry.move=function(x,y){control._moving=!0;OpenLayers.Geometry.LineString.prototype.move.apply(this,arguments);control.center.move(x,y);delete control._moving};var vertexMoveFn=function(x,y){OpenLayers.Geometry.Point.prototype.move.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.move(x,y);this._handle.geometry.move(x,y)},vertexResizeFn=function(scale,center,ratio){OpenLayers.Geometry.Point.prototype.resize.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.resize(scale,center,ratio);this._handle.geometry.resize(scale,center,ratio)},vertexRotateFn=function(angle,center){OpenLayers.Geometry.Point.prototype.rotate.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.rotate(angle,center);this._handle.geometry.rotate(angle,center)},handleMoveFn=function(x,y){var oldX=this.x,oldY=this.y,scale,ratio,l0,l1,newCenter;if(OpenLayers.Geometry.Point.prototype.move.call(this,x,y),!control._moving){var evt=control.dragControl.handlers.drag.evt,preserveAspectRatio=!control._setfeature&&control.preserveAspectRatio,reshape=!preserveAspectRatio&&!(evt&&evt.shiftKey),oldGeom=new OpenLayers.Geometry.Point(oldX,oldY),centerGeometry=control.center;this.rotate(-control.rotation,centerGeometry);oldGeom.rotate(-control.rotation,centerGeometry);var dx1=this.x-centerGeometry.x,dy1=this.y-centerGeometry.y,dx0=dx1-(this.x-oldGeom.x),dy0=dy1-(this.y-oldGeom.y);control.irregular&&!control._setfeature&&(dx1-=(this.x-oldGeom.x)/2,dy1-=(this.y-oldGeom.y)/2);this.x=oldX;this.y=oldY;ratio=1;reshape?(scale=Math.abs(dy0)<1e-5?1:dy1/dy0,ratio=(Math.abs(dx0)<1e-5?1:dx1/dx0)/scale):(l0=Math.sqrt(dx0*dx0+dy0*dy0),l1=Math.sqrt(dx1*dx1+dy1*dy1),scale=l1/l0);control._moving=!0;control.box.geometry.rotate(-control.rotation,centerGeometry);delete control._moving;control.box.geometry.resize(scale,centerGeometry,ratio);control.box.geometry.rotate(control.rotation,centerGeometry);control.transformFeature({scale:scale,ratio:ratio});control.irregular&&!control._setfeature&&(newCenter=centerGeometry.clone(),newCenter.x+=Math.abs(oldX-centerGeometry.x)<1e-5?0:this.x-oldX,newCenter.y+=Math.abs(oldY-centerGeometry.y)<1e-5?0:this.y-oldY,control.box.geometry.move(this.x-oldX,this.y-oldY),control.transformFeature({center:newCenter}))}},rotationHandleMoveFn=function(x,y){var oldX=this.x,oldY=this.y,diff;if(OpenLayers.Geometry.Point.prototype.move.call(this,x,y),!control._moving){var evt=control.dragControl.handlers.drag.evt,constrain=evt&&evt.shiftKey?45:1,centerGeometry=control.center,dx1=this.x-centerGeometry.x,dy1=this.y-centerGeometry.y,dx0=dx1-x,dy0=dy1-y;this.x=oldX;this.y=oldY;var a0=Math.atan2(dy0,dx0),a1=Math.atan2(dy1,dx1),angle=a1-a0;angle*=180/Math.PI;control._angle=(control._angle+angle)%360;diff=control.rotation%constrain;(Math.abs(control._angle)>=constrain||diff!==0)&&(angle=Math.round(control._angle/constrain)*constrain-diff,control._angle=0,control.box.geometry.rotate(angle,centerGeometry),control.transformFeature({rotation:angle}))}},handles=new Array(8),rotationHandles=new Array(4),geom,handle,rotationHandle,positions=["sw","s","se","e","ne","n","nw","w"];for(i=0;i<8;++i)geom=this.box.geometry.components[i],handle=new OpenLayers.Feature.Vector(geom.clone(),{role:positions[i]+"-resize"},typeof this.renderIntent=="string"?null:this.renderIntent),i%2==0&&(rotationHandle=new OpenLayers.Feature.Vector(geom.clone(),{role:positions[i]+"-rotate"},typeof this.rotationHandleSymbolizer=="string"?null:this.rotationHandleSymbolizer),rotationHandle.geometry.move=rotationHandleMoveFn,geom._rotationHandle=rotationHandle,rotationHandles[i/2]=rotationHandle),geom.move=vertexMoveFn,geom.resize=vertexResizeFn,geom.rotate=vertexRotateFn,handle.geometry.move=handleMoveFn,geom._handle=handle,handles[i]=handle;this.rotationHandles=rotationHandles;this.handles=handles},createControl:function(){var control=this;this.dragControl=new OpenLayers.Control.DragFeature(this.layer,{documentDrag:!0,moveFeature:function(){this.feature===control.feature&&(this.feature=control.box);OpenLayers.Control.DragFeature.prototype.moveFeature.apply(this,arguments)},onDrag:function(feature){feature===control.box&&control.transformFeature({center:control.center})},onStart:function(feature){var eligible=!control.geometryTypes||OpenLayers.Util.indexOf(control.geometryTypes,feature.geometry.CLASS_NAME)!==-1,i=OpenLayers.Util.indexOf(control.handles,feature);i+=OpenLayers.Util.indexOf(control.rotationHandles,feature);feature!==control.feature&&feature!==control.box&&i==-2&&eligible&&control.setFeature(feature)},onComplete:function(){control.events.triggerEvent("transformcomplete",{feature:control.feature})}})},drawHandles:function(){for(var layer=this.layer,i=0;i<8;++i)this.rotate&&i%2==0&&layer.drawFeature(this.rotationHandles[i/2],this.rotationHandleSymbolizer),layer.drawFeature(this.handles[i],this.renderIntent)},transformFeature:function(mods){var oldRotation;if(!this._setfeature&&(this.scale*=mods.scale||1,this.ratio*=mods.ratio||1,oldRotation=this.rotation,this.rotation=(this.rotation+(mods.rotation||0))%360,this.events.triggerEvent("beforetransform",mods)!==!1)){var feature=this.feature,geom=feature.geometry,center=this.center;geom.rotate(-oldRotation,center);mods.scale||mods.ratio?geom.resize(mods.scale,center,mods.ratio):mods.center&&feature.move(mods.center.getBounds().getCenterLonLat());geom.rotate(this.rotation,center);this.layer.drawFeature(feature);feature.toState(OpenLayers.State.UPDATE);this.events.triggerEvent("transform",mods)}this.layer.drawFeature(this.box,this.renderIntent);this.drawHandles()},destroy:function(){for(var geom,i=0;i<8;++i)geom=this.box.geometry.components[i],geom._handle.destroy(),geom._handle=null,geom._rotationHandle&&geom._rotationHandle.destroy(),geom._rotationHandle=null;this.center=null;this.feature=null;this.handles=null;this.rotationHandleSymbolizer=null;this.rotationHandles=null;this.box.destroy();this.box=null;this.layer=null;this.dragControl.destroy();this.dragControl=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.TransformFeature"});OpenLayers.Layer.ArcGISCache=OpenLayers.Class(OpenLayers.Layer.XYZ,{url:null,tileOrigin:null,tileSize:new OpenLayers.Size(256,256),useArcGISServer:!0,type:"png",useScales:!1,overrideDPI:!1,initialize:function(){var info,startingTileExtent,upperLeft,bottomRight,key,lod,start,end;if(OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.resolutions&&(this.serverResolutions=this.resolutions,this.maxExtent=this.getMaxExtentForResolution(this.resolutions[0])),this.layerInfo&&(info=this.layerInfo,startingTileExtent=new OpenLayers.Bounds(info.fullExtent.xmin,info.fullExtent.ymin,info.fullExtent.xmax,info.fullExtent.ymax),this.projection="EPSG:"+info.spatialReference.wkid,this.sphericalMercator=info.spatialReference.wkid==102100,this.units=info.units=="esriFeet"?"ft":"m",!!info.tileInfo)){this.tileSize=new OpenLayers.Size(info.tileInfo.width||info.tileInfo.cols,info.tileInfo.height||info.tileInfo.rows);this.tileOrigin=new OpenLayers.LonLat(info.tileInfo.origin.x,info.tileInfo.origin.y);upperLeft=new OpenLayers.Geometry.Point(startingTileExtent.left,startingTileExtent.top);bottomRight=new OpenLayers.Geometry.Point(startingTileExtent.right,startingTileExtent.bottom);this.useScales?this.scales=[]:this.resolutions=[];this.lods=[];for(key in info.tileInfo.lods)info.tileInfo.lods.hasOwnProperty(key)&&(lod=info.tileInfo.lods[key],this.useScales?this.scales.push(lod.scale):this.resolutions.push(lod.resolution),start=this.getContainingTileCoords(upperLeft,lod.resolution),lod.startTileCol=start.x,lod.startTileRow=start.y,end=this.getContainingTileCoords(bottomRight,lod.resolution),lod.endTileCol=end.x,lod.endTileRow=end.y,this.lods.push(lod));this.maxExtent=this.calculateMaxExtentWithLOD(this.lods[0]);this.serverResolutions=this.resolutions;this.overrideDPI&&info.tileInfo.dpi&&(OpenLayers.DOTS_PER_INCH=info.tileInfo.dpi)}},getContainingTileCoords:function(point,res){return new OpenLayers.Pixel(Math.max(Math.floor((point.x-this.tileOrigin.lon)/(this.tileSize.w*res)),0),Math.max(Math.floor((this.tileOrigin.lat-point.y)/(this.tileSize.h*res)),0))},calculateMaxExtentWithLOD:function(lod){var numTileCols=lod.endTileCol-lod.startTileCol+1,numTileRows=lod.endTileRow-lod.startTileRow+1,minX=this.tileOrigin.lon+lod.startTileCol*this.tileSize.w*lod.resolution,maxX=minX+numTileCols*this.tileSize.w*lod.resolution,maxY=this.tileOrigin.lat-lod.startTileRow*this.tileSize.h*lod.resolution,minY=maxY-numTileRows*this.tileSize.h*lod.resolution;return new OpenLayers.Bounds(minX,minY,maxX,maxY)},calculateMaxExtentWithExtent:function(extent,res){var upperLeft=new OpenLayers.Geometry.Point(extent.left,extent.top),bottomRight=new OpenLayers.Geometry.Point(extent.right,extent.bottom),start=this.getContainingTileCoords(upperLeft,res),end=this.getContainingTileCoords(bottomRight,res),lod={resolution:res,startTileCol:start.x,startTileRow:start.y,endTileCol:end.x,endTileRow:end.y};return this.calculateMaxExtentWithLOD(lod)},getUpperLeftTileCoord:function(res){var upperLeft=new OpenLayers.Geometry.Point(this.maxExtent.left,this.maxExtent.top);return this.getContainingTileCoords(upperLeft,res)},getLowerRightTileCoord:function(res){var bottomRight=new OpenLayers.Geometry.Point(this.maxExtent.right,this.maxExtent.bottom);return this.getContainingTileCoords(bottomRight,res)},getMaxExtentForResolution:function(res){var start=this.getUpperLeftTileCoord(res),end=this.getLowerRightTileCoord(res),numTileCols=end.x-start.x+1,numTileRows=end.y-start.y+1,minX=this.tileOrigin.lon+start.x*this.tileSize.w*res,maxX=minX+numTileCols*this.tileSize.w*res,maxY=this.tileOrigin.lat-start.y*this.tileSize.h*res,minY=maxY-numTileRows*this.tileSize.h*res;return new OpenLayers.Bounds(minX,minY,maxX,maxY)},clone:function(obj){return obj==null&&(obj=new OpenLayers.Layer.ArcGISCache(this.name,this.url,this.options)),OpenLayers.Layer.XYZ.prototype.clone.apply(this,[obj])},getMaxExtent:function(){var resolution=this.map.getResolution();return this.maxExtent=this.getMaxExtentForResolution(resolution)},getTileOrigin:function(){var extent=this.getMaxExtent();return new OpenLayers.LonLat(extent.left,extent.bottom)},getURL:function(bounds){var res=this.getResolution(),originTileX=this.tileOrigin.lon+res*this.tileSize.w/2,originTileY=this.tileOrigin.lat-res*this.tileSize.h/2,center=bounds.getCenterLonLat(),point={x:center.lon,y:center.lat},x=Math.round(Math.abs((center.lon-originTileX)/(res*this.tileSize.w))),y=Math.round(Math.abs((originTileY-center.lat)/(res*this.tileSize.h))),z=this.map.getZoom(),lod,start,end,url,s;if(this.lods){if(lod=this.lods[this.map.getZoom()],x<lod.startTileCol||x>lod.endTileCol||y<lod.startTileRow||y>lod.endTileRow)return null}else if(start=this.getUpperLeftTileCoord(res),end=this.getLowerRightTileCoord(res),x<start.x||x>=end.x||y<start.y||y>=end.y)return null;return url=this.url,s=""+x+y+z,OpenLayers.Util.isArray(url)&&(url=this.selectUrl(s,url)),this.useArcGISServer?url=url+"/tile/${z}/${y}/${x}":(x="C"+this.zeroPad(x,8,16),y="R"+this.zeroPad(y,8,16),z="L"+this.zeroPad(z,2,16),url=url+"/${z}/${y}/${x}."+this.type),url=OpenLayers.String.format(url,{x:x,y:y,z:z}),OpenLayers.Util.urlAppend(url,OpenLayers.Util.getParameterString(this.params))},zeroPad:function(num,len,radix){for(var str=num.toString(radix||10);str.length<len;)str="0"+str;return str},CLASS_NAME:"OpenLayers.Layer.ArcGISCache"});OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,drillDown:!1,maxFeatures:10,clickCallback:"click",output:"features",layers:null,queryVisible:!1,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,initialize:function(options){if(options=options||{},options.handlerOptions=options.handlerOptions||{},OpenLayers.Control.prototype.initialize.apply(this,[options]),this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(options.formatOptions)),this.drillDown===!0&&(this.hover=!1),this.hover)this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}));else{var callbacks={};callbacks[this.clickCallback]=this.getInfoForClick;this.handler=new OpenLayers.Handler.Click(this,callbacks,this.handlerOptions.click||{})}},getInfoForClick:function(evt){this.events.triggerEvent("beforegetfeatureinfo",{xy:evt.xy});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");this.request(evt.xy,{})},getInfoForHover:function(evt){this.events.triggerEvent("beforegetfeatureinfo",{xy:evt.xy});this.request(evt.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var candidates=this.layers||this.map.layers,layers=[],layer,url,i=candidates.length-1;i>=0;--i)layer=candidates[i],layer instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||layer.getVisibility())&&(url=OpenLayers.Util.isArray(layer.url)?layer.url[0]:layer.url,this.drillDown!==!1||this.url||(this.url=url),(this.drillDown===!0||this.urlMatches(url))&&layers.push(layer));return layers},urlMatches:function(url){var matches=OpenLayers.Util.isEquivalentUrl(this.url,url),i,len;if(!matches&&this.layerUrls)for(i=0,len=this.layerUrls.length;i<len;++i)if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[i],url)){matches=!0;break}return matches},buildWMSOptions:function(url,layers,clickPosition,format){for(var params,layerNames=[],styleNames=[],i=0,len=layers.length;i<len;i++)layers[i].params.LAYERS!=null&&(layerNames=layerNames.concat(layers[i].params.LAYERS),styleNames=styleNames.concat(this.getStyleNames(layers[i])));var firstLayer=layers[0],projection=this.map.getProjection(),layerProj=firstLayer.projection;return layerProj&&layerProj.equals(this.map.getProjectionObject())&&(projection=layerProj.getCode()),params=OpenLayers.Util.extend({service:"WMS",version:firstLayer.params.VERSION,request:"GetFeatureInfo",exceptions:firstLayer.params.EXCEPTIONS,bbox:this.map.getExtent().toBBOX(null,firstLayer.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:format,info_format:firstLayer.params.INFO_FORMAT||this.infoFormat},parseFloat(firstLayer.params.VERSION)>=1.3?{crs:projection,i:parseInt(clickPosition.x),j:parseInt(clickPosition.y)}:{srs:projection,x:parseInt(clickPosition.x),y:parseInt(clickPosition.y)}),layerNames.length!=0&&(params=OpenLayers.Util.extend({layers:layerNames,query_layers:layerNames,styles:styleNames},params)),OpenLayers.Util.applyDefaults(params,this.vendorParams),{url:url,params:OpenLayers.Util.upperCaseObject(params),callback:function(request){this.handleResponse(clickPosition,request,url)},scope:this}},getStyleNames:function(layer){return layer.params.STYLES?layer.params.STYLES:OpenLayers.Util.isArray(layer.params.LAYERS)?new Array(layer.params.LAYERS.length):layer.params.LAYERS.replace(/[^,]/g,"")},request:function(clickPosition,options){var layers=this.findLayers(),request,services,i,len,layer,found,url,wmsOptions;if(layers.length==0){this.events.triggerEvent("nogetfeatureinfo");OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");return}if(options=options||{},this.drillDown===!1)wmsOptions=this.buildWMSOptions(this.url,layers,clickPosition,layers[0].params.FORMAT),request=OpenLayers.Request.GET(wmsOptions),options.hover===!0&&(this.hoverRequest=request);else{for(this._requestCount=0,this._numRequests=0,this.features=[],services={},i=0,len=layers.length;i<len;i++)layer=layers[i],found=!1,url=OpenLayers.Util.isArray(layer.url)?layer.url[0]:layer.url,url in services?services[url].push(layer):(this._numRequests++,services[url]=[layer]);for(url in services)layers=services[url],wmsOptions=this.buildWMSOptions(url,layers,clickPosition,layers[0].params.FORMAT),OpenLayers.Request.GET(wmsOptions)}},triggerGetFeatureInfo:function(request,xy,features){this.events.triggerEvent("getfeatureinfo",{text:request.responseText,features:features,request:request,xy:xy});OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},handleResponse:function(xy,request,url){var doc=request.responseXML,features;doc&&doc.documentElement||(doc=request.responseText);features=this.format.read(doc);this.drillDown===!1?this.triggerGetFeatureInfo(request,xy,features):(this._requestCount++,this._features=this.output==="object"?(this._features||[]).concat({url:url,features:features}):(this._features||[]).concat(features),this._requestCount===this._numRequests&&(this.triggerGetFeatureInfo(request,xy,this._features.concat()),delete this._features,delete this._requestCount,delete this._numRequests))},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"});OpenLayers.Format.WMSCapabilities.v1_3_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_3,{version:"1.3.0",CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3_0"});OpenLayers.Format.WFS=OpenLayers.Class(OpenLayers.Format.GML,{layer:null,wfsns:"http://www.opengis.net/wfs",ogcns:"http://www.opengis.net/ogc",initialize:function(options,layer){OpenLayers.Format.GML.prototype.initialize.apply(this,[options]);this.layer=layer;this.layer.featureNS&&(this.featureNS=this.layer.featureNS);this.layer.options.geometry_column&&(this.geometryName=this.layer.options.geometry_column);this.layer.options.typename&&(this.featureName=this.layer.options.typename)},write:function(features){var transaction=this.createElementNS(this.wfsns,"wfs:Transaction"),i;for(transaction.setAttribute("version","1.0.0"),transaction.setAttribute("service","WFS"),i=0;i<features.length;i++)switch(features[i].state){case OpenLayers.State.INSERT:transaction.appendChild(this.insert(features[i]));break;case OpenLayers.State.UPDATE:transaction.appendChild(this.update(features[i]));break;case OpenLayers.State.DELETE:transaction.appendChild(this.remove(features[i]))}return OpenLayers.Format.XML.prototype.write.apply(this,[transaction])},createFeatureXML:function(feature){var geometryNode=this.buildGeometryNode(feature.geometry),geomContainer=this.createElementNS(this.featureNS,"feature:"+this.geometryName),featureContainer,attr,attrText,nodename,attrContainer;geomContainer.appendChild(geometryNode);featureContainer=this.createElementNS(this.featureNS,"feature:"+this.featureName);featureContainer.appendChild(geomContainer);for(attr in feature.attributes)attrText=this.createTextNode(feature.attributes[attr]),nodename=attr,attr.search(":")!=-1&&(nodename=attr.split(":")[1]),attrContainer=this.createElementNS(this.featureNS,"feature:"+nodename),attrContainer.appendChild(attrText),featureContainer.appendChild(attrContainer);return featureContainer},insert:function(feature){var insertNode=this.createElementNS(this.wfsns,"wfs:Insert");return insertNode.appendChild(this.createFeatureXML(feature)),insertNode},update:function(feature){var updateNode,valueNode,geometryNode,propName,filterNode,filterIdNode;feature.fid||OpenLayers.Console.userError(OpenLayers.i18n("noFID"));updateNode=this.createElementNS(this.wfsns,"wfs:Update");updateNode.setAttribute("typeName",this.featurePrefix+":"+this.featureName);updateNode.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var propertyNode=this.createElementNS(this.wfsns,"wfs:Property"),nameNode=this.createElementNS(this.wfsns,"wfs:Name"),txtNode=this.createTextNode(this.geometryName);nameNode.appendChild(txtNode);propertyNode.appendChild(nameNode);valueNode=this.createElementNS(this.wfsns,"wfs:Value");geometryNode=this.buildGeometryNode(feature.geometry);feature.layer&&geometryNode.setAttribute("srsName",feature.layer.projection.getCode());valueNode.appendChild(geometryNode);propertyNode.appendChild(valueNode);updateNode.appendChild(propertyNode);for(propName in feature.attributes)propertyNode=this.createElementNS(this.wfsns,"wfs:Property"),nameNode=this.createElementNS(this.wfsns,"wfs:Name"),nameNode.appendChild(this.createTextNode(propName)),propertyNode.appendChild(nameNode),valueNode=this.createElementNS(this.wfsns,"wfs:Value"),valueNode.appendChild(this.createTextNode(feature.attributes[propName])),propertyNode.appendChild(valueNode),updateNode.appendChild(propertyNode);return filterNode=this.createElementNS(this.ogcns,"ogc:Filter"),filterIdNode=this.createElementNS(this.ogcns,"ogc:FeatureId"),filterIdNode.setAttribute("fid",feature.fid),filterNode.appendChild(filterIdNode),updateNode.appendChild(filterNode),updateNode},remove:function(feature){var deleteNode,filterNode,filterIdNode;return feature.fid?(deleteNode=this.createElementNS(this.wfsns,"wfs:Delete"),deleteNode.setAttribute("typeName",this.featurePrefix+":"+this.featureName),deleteNode.setAttribute("xmlns:"+this.featurePrefix,this.featureNS),filterNode=this.createElementNS(this.ogcns,"ogc:Filter"),filterIdNode=this.createElementNS(this.ogcns,"ogc:FeatureId"),filterIdNode.setAttribute("fid",feature.fid),filterNode.appendChild(filterIdNode),deleteNode.appendChild(filterNode),deleteNode):(OpenLayers.Console.userError(OpenLayers.i18n("noFID")),!1)},destroy:function(){this.layer=null},CLASS_NAME:"OpenLayers.Format.WFS"});OpenLayers.Control.UTFGrid=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,layers:null,defaultHandlerOptions:{delay:300,pixelTolerance:4,stopMove:!1,single:!0,double:!1,stopSingle:!1,stopDouble:!1},handlerMode:"click",setHandler:function(hm){this.handlerMode=hm;this.resetHandler()},resetHandler:function(){return this.handler&&(this.handler.deactivate(),this.handler.destroy(),this.handler=null),this.handlerMode=="hover"?this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.reset},this.handlerOptions):this.handlerMode=="click"?this.handler=new OpenLayers.Handler.Click(this,{click:this.handleEvent},this.handlerOptions):this.handlerMode=="move"&&(this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.handleEvent},this.handlerOptions)),this.handler?!0:!1},initialize:function(options){options=options||{};options.handlerOptions=options.handlerOptions||this.defaultHandlerOptions;OpenLayers.Control.prototype.initialize.apply(this,[options]);this.resetHandler()},handleEvent:function(evt){var lonLat,layers,infoLookup,layer,idx,i,len;if(evt==null){this.reset();return}if((lonLat=this.map.getLonLatFromPixel(evt.xy),lonLat)&&(layers=this.findLayers(),layers.length>0)){for(infoLookup={},i=0,len=layers.length;i<len;i++)layer=layers[i],idx=OpenLayers.Util.indexOf(this.map.layers,layer),infoLookup[idx]=layer.getFeatureInfo(lonLat);this.callback(infoLookup,lonLat,evt.xy)}},callback:function(){},reset:function(){this.callback(null)},findLayers:function(){for(var candidates=this.layers||this.map.layers,layers=[],layer,i=candidates.length-1;i>=0;--i)layer=candidates[i],layer instanceof OpenLayers.Layer.UTFGrid&&layers.push(layer);return layers},CLASS_NAME:"OpenLayers.Control.UTFGrid"});OpenLayers.Format.CQL=function(){function tryToken(text,pattern){return pattern instanceof RegExp?pattern.exec(text):pattern(text)}function nextToken(text,tokens){for(var token,len=tokens.length,pat,matches,match,remainder,msg,i=0;i<len;i++)if(token=tokens[i],pat=patterns[token],matches=tryToken(text,pat),matches)return match=matches[0],remainder=text.substr(match.length).replace(/^\s*/,""),{type:token,text:match,remainder:remainder};for(msg="ERROR: In parsing: ["+text+"], expected one of: ",i=0;i<len;i++)token=tokens[i],msg+="\n    "+token+": "+patterns[token];throw new Error(msg);}function tokenize(text){var results=[],token,expect=["NOT","GEOMETRY","SPATIAL","PROPERTY","LPAREN"];do{if(token=nextToken(text,expect),text=token.remainder,expect=follows[token.type],token.type!="END"&&!expect)throw new Error("No follows list for "+token.type);results.push(token)}while(token.type!="END");return results}function buildAst(tokens){function buildTree(){var tok=postfix.pop(),rhs,lhs,operand,min,max,value,property;switch(tok.type){case"LOGICAL":return rhs=buildTree(),lhs=buildTree(),new OpenLayers.Filter.Logical({filters:[lhs,rhs],type:logicals[tok.text.toUpperCase()]});case"NOT":return operand=buildTree(),new OpenLayers.Filter.Logical({filters:[operand],type:OpenLayers.Filter.Logical.NOT});case"BETWEEN":return postfix.pop(),max=buildTree(),min=buildTree(),property=buildTree(),new OpenLayers.Filter.Comparison({property:property,lowerBoundary:min,upperBoundary:max,type:OpenLayers.Filter.Comparison.BETWEEN});case"COMPARISON":return value=buildTree(),property=buildTree(),new OpenLayers.Filter.Comparison({property:property,value:value,type:operators[tok.text.toUpperCase()]});case"VALUE":return/^'.*'$/.test(tok.text)?tok.text.substr(1,tok.text.length-2):Number(tok.text);case"SPATIAL":switch(tok.text.toUpperCase()){case"BBOX":var maxy=buildTree(),maxx=buildTree(),miny=buildTree(),minx=buildTree(),prop=buildTree();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:prop,value:OpenLayers.Bounds.fromArray([minx,miny,maxx,maxy])});case"INTERSECTS":return value=buildTree(),property=buildTree(),new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:property,value:value});case"WITHIN":return value=buildTree(),property=buildTree(),new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.WITHIN,property:property,value:value});case"CONTAINS":return value=buildTree(),property=buildTree(),new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.CONTAINS,property:property,value:value});case"DWITHIN":var distance=buildTree(),value=buildTree(),property=buildTree();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,value:value,property:property,distance:Number(distance)})}case"GEOMETRY":return OpenLayers.Geometry.fromWKT(tok.text);default:return tok.text}}for(var operatorStack=[],postfix=[],tok,p,result,msg,i;tokens.length;){tok=tokens.shift();switch(tok.type){case"PROPERTY":case"GEOMETRY":case"VALUE":postfix.push(tok);break;case"COMPARISON":case"BETWEEN":case"LOGICAL":for(p=precedence[tok.type];operatorStack.length>0&&precedence[operatorStack[operatorStack.length-1].type]<=p;)postfix.push(operatorStack.pop());operatorStack.push(tok);break;case"SPATIAL":case"NOT":case"LPAREN":operatorStack.push(tok);break;case"RPAREN":while(operatorStack.length>0&&operatorStack[operatorStack.length-1].type!="LPAREN")postfix.push(operatorStack.pop());operatorStack.pop();operatorStack.length>0&&operatorStack[operatorStack.length-1].type=="SPATIAL"&&postfix.push(operatorStack.pop());case"COMMA":case"END":break;default:throw new Error("Unknown token type "+tok.type);}}while(operatorStack.length>0)postfix.push(operatorStack.pop());if(result=buildTree(),postfix.length>0){for(msg="Remaining tokens after building AST: \n",i=postfix.length-1;i>=0;i--)msg+=postfix[i].type+": "+postfix[i].text+"\n";throw new Error(msg);}return result}var patterns={PROPERTY:/^[_a-zA-Z]\w*/,COMPARISON:/^(=|<>|<=|<|>=|>|LIKE)/i,COMMA:/^,/,LOGICAL:/^(AND|OR)/i,VALUE:/^('\w+'|\d+(\.\d*)?|\.\d+)/,LPAREN:/^\(/,RPAREN:/^\)/,SPATIAL:/^(BBOX|INTERSECTS|DWITHIN|WITHIN|CONTAINS)/i,NOT:/^NOT/i,BETWEEN:/^BETWEEN/i,GEOMETRY:function(text){var type=/^(POINT|LINESTRING|POLYGON|MULTIPOINT|MULTILINESTRING|MULTIPOLYGON|GEOMETRYCOLLECTION)/.exec(text),len,idx,depth;if(type){if(len=text.length,idx=text.indexOf("(",type[0].length),idx>-1)for(depth=1;idx<len&&depth>0;){idx++;switch(text.charAt(idx)){case"(":depth++;break;case")":depth--}}return[text.substr(0,idx+1)]}},END:/^$/},follows={LPAREN:["GEOMETRY","SPATIAL","PROPERTY","VALUE","LPAREN"],RPAREN:["NOT","LOGICAL","END","RPAREN"],PROPERTY:["COMPARISON","BETWEEN","COMMA"],BETWEEN:["VALUE"],COMPARISON:["VALUE"],COMMA:["GEOMETRY","VALUE","PROPERTY"],VALUE:["LOGICAL","COMMA","RPAREN","END"],SPATIAL:["LPAREN"],LOGICAL:["NOT","VALUE","SPATIAL","PROPERTY","LPAREN"],NOT:["PROPERTY","LPAREN"],GEOMETRY:["COMMA","RPAREN"]},operators={"=":OpenLayers.Filter.Comparison.EQUAL_TO,"<>":OpenLayers.Filter.Comparison.NOT_EQUAL_TO,"<":OpenLayers.Filter.Comparison.LESS_THAN,"<=":OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,">":OpenLayers.Filter.Comparison.GREATER_THAN,">=":OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,LIKE:OpenLayers.Filter.Comparison.LIKE,BETWEEN:OpenLayers.Filter.Comparison.BETWEEN},operatorReverse={},logicals={AND:OpenLayers.Filter.Logical.AND,OR:OpenLayers.Filter.Logical.OR},logicalReverse={},precedence={RPAREN:3,LOGICAL:2,COMPARISON:1};for(var i in operators)operators.hasOwnProperty(i)&&(operatorReverse[operators[i]]=i);for(i in logicals)logicals.hasOwnProperty(i)&&(logicalReverse[logicals[i]]=i);return OpenLayers.Class(OpenLayers.Format,{read:function(text){var result=buildAst(tokenize(text));return this.keepData&&(this.data=result),result},write:function(filter){var res,first,i;if(filter instanceof OpenLayers.Geometry)return filter.toString();switch(filter.CLASS_NAME){case"OpenLayers.Filter.Spatial":switch(filter.type){case OpenLayers.Filter.Spatial.BBOX:return"BBOX("+filter.property+","+filter.value.toBBOX()+")";case OpenLayers.Filter.Spatial.DWITHIN:return"DWITHIN("+filter.property+", "+this.write(filter.value)+", "+filter.distance+")";case OpenLayers.Filter.Spatial.WITHIN:return"WITHIN("+filter.property+", "+this.write(filter.value)+")";case OpenLayers.Filter.Spatial.INTERSECTS:return"INTERSECTS("+filter.property+", "+this.write(filter.value)+")";case OpenLayers.Filter.Spatial.CONTAINS:return"CONTAINS("+filter.property+", "+this.write(filter.value)+")";default:throw new Error("Unknown spatial filter type: "+filter.type);}case"OpenLayers.Filter.Logical":if(filter.type==OpenLayers.Filter.Logical.NOT)return"NOT ("+this.write(filter.filters[0])+")";for(res="(",first=!0,i=0;i<filter.filters.length;i++)first?first=!1:res+=") "+logicalReverse[filter.type]+" (",res+=this.write(filter.filters[i]);return res+")";case"OpenLayers.Filter.Comparison":return filter.type==OpenLayers.Filter.Comparison.BETWEEN?filter.property+" BETWEEN "+this.write(filter.lowerBoundary)+" AND "+this.write(filter.upperBoundary):filter.property+" "+operatorReverse[filter.type]+" "+this.write(filter.value);case undefined:if(typeof filter=="string")return"'"+filter+"'";if(typeof filter=="number")return String(filter);default:throw new Error("Can't encode: "+filter.CLASS_NAME+" "+filter);}},CLASS_NAME:"OpenLayers.Format.CQL"})}();OpenLayers.Control.Split=OpenLayers.Class(OpenLayers.Control,{layer:null,source:null,sourceOptions:null,tolerance:null,edge:!0,deferDelete:!1,mutual:!0,targetFilter:null,sourceFilter:null,handler:null,initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,[options]);this.options=options||{};this.options.source&&this.setSource(this.options.source)},setSource:function(layer){this.active?(this.deactivate(),this.handler&&(this.handler.destroy(),delete this.handler),this.source=layer,this.activate()):this.source=layer},activate:function(){var activated=OpenLayers.Control.prototype.activate.call(this);if(activated)if(this.source){if(this.source.events)this.source.events.on({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this})}else this.handler||(this.handler=new OpenLayers.Handler.Path(this,{done:function(geometry){this.onSketchComplete({feature:new OpenLayers.Feature.Vector(geometry)})}},{layerOptions:this.sourceOptions})),this.handler.activate();return activated},deactivate:function(){var deactivated=OpenLayers.Control.prototype.deactivate.call(this);return deactivated&&this.source&&this.source.events&&this.source.events.un({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this}),deactivated},onSketchComplete:function(event){return this.feature=null,!this.considerSplit(event.feature)},afterFeatureModified:function(event){if(event.modified){var feature=event.feature;typeof feature.geometry.split=="function"&&(this.feature=event.feature,this.considerSplit(event.feature))}},removeByGeometry:function(features,geometry){for(var i=0,len=features.length;i<len;++i)if(features[i].geometry===geometry){features.splice(i,1);break}},isEligible:function(target){return target.geometry?target.state!==OpenLayers.State.DELETE&&typeof target.geometry.split=="function"&&this.feature!==target&&(!this.targetFilter||this.targetFilter.evaluate(target.attributes)):!1},considerSplit:function(feature){var sourceSplit=!1,targetSplit=!1,j,k,feat,destroys,i,len;if(!this.sourceFilter||this.sourceFilter.evaluate(feature.attributes)){var features=this.layer&&this.layer.features||[],target,results,proceed,additions=[],removals=[],mutual=this.layer===this.source&&this.mutual,options={edge:this.edge,tolerance:this.tolerance,mutual:mutual},sourceParts=[feature.geometry],targetFeature,targetParts,source,parts;for(i=0,len=features.length;i<len;++i)if(targetFeature=features[i],this.isEligible(targetFeature)){for(targetParts=[targetFeature.geometry],j=0;j<sourceParts.length;++j)for(source=sourceParts[j],k=0;k<targetParts.length;++k)target=targetParts[k],source.getBounds().intersectsBounds(target.getBounds())&&(results=source.split(target,options),results&&(proceed=this.events.triggerEvent("beforesplit",{source:feature,target:targetFeature}),proceed!==!1&&(mutual&&(parts=results[0],parts.length>1&&(parts.unshift(j,1),Array.prototype.splice.apply(sourceParts,parts),j+=parts.length-3),results=results[1]),results.length>1&&(results.unshift(k,1),Array.prototype.splice.apply(targetParts,results),k+=results.length-3))));targetParts&&targetParts.length>1&&(this.geomsToFeatures(targetFeature,targetParts),this.events.triggerEvent("split",{original:targetFeature,features:targetParts}),Array.prototype.push.apply(additions,targetParts),removals.push(targetFeature),targetSplit=!0)}if(sourceParts&&sourceParts.length>1&&(this.geomsToFeatures(feature,sourceParts),this.events.triggerEvent("split",{original:feature,features:sourceParts}),Array.prototype.push.apply(additions,sourceParts),removals.push(feature),sourceSplit=!0),sourceSplit||targetSplit){if(this.deferDelete){for(destroys=[],i=0,len=removals.length;i<len;++i)feat=removals[i],feat.state===OpenLayers.State.INSERT?destroys.push(feat):(feat.state=OpenLayers.State.DELETE,this.layer.drawFeature(feat));for(this.layer.destroyFeatures(destroys,{silent:!0}),i=0,len=additions.length;i<len;++i)additions[i].state=OpenLayers.State.INSERT}else this.layer.destroyFeatures(removals,{silent:!0});this.layer.addFeatures(additions,{silent:!0});this.events.triggerEvent("aftersplit",{source:feature,features:additions})}}return sourceSplit},geomsToFeatures:function(feature,geoms){var clone=feature.clone(),newFeature,i,len;for(delete clone.geometry,i=0,len=geoms.length;i<len;++i)newFeature=clone.clone(),newFeature.geometry=geoms[i],newFeature.state=OpenLayers.State.INSERT,geoms[i]=newFeature},destroy:function(){this.active&&this.deactivate();OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Split"});OpenLayers.Protocol.SOS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol,{fois:null,formatOptions:null,initialize:function(options){OpenLayers.Protocol.prototype.initialize.apply(this,[options]);options.format||(this.format=new OpenLayers.Format.SOSGetFeatureOfInterest(this.formatOptions))},destroy:function(){this.options&&!this.options.format&&this.format.destroy();this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(options){options=OpenLayers.Util.extend({},options);OpenLayers.Util.applyDefaults(options,this.options||{});var response=new OpenLayers.Protocol.Response({requestType:"read"}),format=this.format,data=OpenLayers.Format.XML.prototype.write.apply(format,[format.writeNode("sos:GetFeatureOfInterest",{fois:this.fois})]);return response.priv=OpenLayers.Request.POST({url:options.url,callback:this.createCallback(this.handleRead,response,options),data:data}),response},handleRead:function(response,options){if(options.callback){var request=response.priv;request.status>=200&&request.status<300?(response.features=this.parseFeatures(request),response.code=OpenLayers.Protocol.Response.SUCCESS):response.code=OpenLayers.Protocol.Response.FAILURE;options.callback.call(options.scope,response)}},parseFeatures:function(request){var doc=request.responseXML;return(doc&&doc.documentElement||(doc=request.responseText),!doc||doc.length<=0)?null:this.format.read(doc)},CLASS_NAME:"OpenLayers.Protocol.SOS.v1_0_0"});OpenLayers.Layer.KaMapCache=OpenLayers.Class(OpenLayers.Layer.KaMap,{IMAGE_EXTENSIONS:{jpeg:"jpg",gif:"gif",png:"png",png8:"png",png24:"png",dithered:"png"},DEFAULT_FORMAT:"jpeg",initialize:function(){OpenLayers.Layer.KaMap.prototype.initialize.apply(this,arguments);this.extension=this.IMAGE_EXTENSIONS[this.params.i.toLowerCase()||this.DEFAULT_FORMAT]},getURL:function(bounds){bounds=this.adjustBounds(bounds);var mapRes=this.map.getResolution(),scale=Math.round(this.map.getScale()*1e4)/1e4,pX=Math.round(bounds.left/mapRes),pY=-Math.round(bounds.top/mapRes),metaX=Math.floor(pX/this.tileSize.w/this.params.metaTileSize.w)*this.tileSize.w*this.params.metaTileSize.w,metaY=Math.floor(pY/this.tileSize.h/this.params.metaTileSize.h)*this.tileSize.h*this.params.metaTileSize.h,components=["/",this.params.map,"/",scale,"/",this.params.g.replace(/\s/g,"_"),"/def/t",metaY,"/l",metaX,"/t",pY,"l",pX,".",this.extension],url=this.url;return OpenLayers.Util.isArray(url)&&(url=this.selectUrl(components.join(""),url)),url+components.join("")},CLASS_NAME:"OpenLayers.Layer.KaMapCache"});OpenLayers.Layer.TileCache=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,format:"image/png",serverResolutions:null,initialize:function(name,url,layername,options){this.layername=layername;OpenLayers.Layer.Grid.prototype.initialize.apply(this,[name,url,{},options]);this.extension=this.format.split("/")[1].toLowerCase();this.extension=this.extension=="jpg"?"jpeg":this.extension},clone:function(obj){return obj==null&&(obj=new OpenLayers.Layer.TileCache(this.name,this.url,this.layername,this.getOptions())),OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj])},getURL:function(bounds){function zeroPad(number,length){var zeros,i;for(number=String(number),zeros=[],i=0;i<length;++i)zeros.push("0");return zeros.join("").substring(0,length-number.length)+number}var res=this.getServerResolution(),bbox=this.maxExtent,size=this.tileSize,tileX=Math.round((bounds.left-bbox.left)/(res*size.w)),tileY=Math.round((bounds.bottom-bbox.bottom)/(res*size.h)),tileZ=this.serverResolutions!=null?OpenLayers.Util.indexOf(this.serverResolutions,res):this.map.getZoom(),components=[this.layername,zeroPad(tileZ,2),zeroPad(parseInt(tileX/1e6),3),zeroPad(parseInt(tileX/1e3)%1e3,3),zeroPad(parseInt(tileX)%1e3,3),zeroPad(parseInt(tileY/1e6),3),zeroPad(parseInt(tileY/1e3)%1e3,3),zeroPad(parseInt(tileY)%1e3,3)+"."+this.extension],path=components.join("/"),url=this.url;return OpenLayers.Util.isArray(url)&&(url=this.selectUrl(path,url)),url=url.charAt(url.length-1)=="/"?url:url+"/",url+path},CLASS_NAME:"OpenLayers.Layer.TileCache"});OpenLayers.Format.WMSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.1",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(node,obj){obj.srs[this.getChildValue(node)]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1"});OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1_1,{version:"1.1.1",profile:"WMSC",readers:{wms:OpenLayers.Util.applyDefaults({VendorSpecificCapabilities:function(node,obj){obj.vendorSpecific={tileSets:[]};this.readChildNodes(node,obj.vendorSpecific)},TileSet:function(node,vendorSpecific){var tileset={srs:{},bbox:{},resolutions:[]};this.readChildNodes(node,tileset);vendorSpecific.tileSets.push(tileset)},Resolutions:function(node,tileset){for(var res=this.getChildValue(node).split(" "),i=0,len=res.length;i<len;i++)res[i]!=""&&tileset.resolutions.push(parseFloat(res[i]))},Width:function(node,tileset){tileset.width=parseInt(this.getChildValue(node))},Height:function(node,tileset){tileset.height=parseInt(this.getChildValue(node))},Layers:function(node,tileset){tileset.layers=this.getChildValue(node)},Styles:function(node,tileset){tileset.styles=this.getChildValue(node)}},OpenLayers.Format.WMSCapabilities.v1_1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC"});OpenLayers.Control.LayerSwitcher=OpenLayers.Class(OpenLayers.Control,{roundedCorner:!1,roundedCornerColor:"darkblue",layerStates:null,layersDiv:null,baseLayersDiv:null,baseLayers:null,dataLbl:null,dataLayersDiv:null,dataLayers:null,minimizeDiv:null,maximizeDiv:null,ascending:!0,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments);this.layerStates=[];this.roundedCorner&&OpenLayers.Console.warn("roundedCorner option is deprecated")},destroy:function(){this.clearLayersArray("base");this.clearLayersArray("data");this.map.events.un({buttonclick:this.onButtonClick,addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this});this.events.unregister("buttonclick",this,this.onButtonClick);OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.on({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this});this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this),this.loadContents(),this.outsideViewport||this.minimizeControl(),this.redraw(),this.div},onButtonClick:function(evt){var button=evt.buttonElement;button===this.minimizeDiv?this.minimizeControl():button===this.maximizeDiv?this.maximizeControl():button._layerSwitcher===this.id&&(button["for"]&&(button=document.getElementById(button["for"])),button.disabled||(button.type=="radio"?(button.checked=!0,this.map.setBaseLayer(this.map.getLayer(button._layer))):(button.checked=!button.checked,this.updateMap())))},clearLayersArray:function(layersType){this[layersType+"LayersDiv"].innerHTML="";this[layersType+"Layers"]=[]},checkRedraw:function(){var redraw=!1,i,len,layerState,layer;if(this.layerStates.length&&this.map.layers.length==this.layerStates.length){for(i=0,len=this.layerStates.length;i<len;i++)if(layerState=this.layerStates[i],layer=this.map.layers[i],layerState.name!=layer.name||layerState.inRange!=layer.inRange||layerState.id!=layer.id||layerState.visibility!=layer.visibility){redraw=!0;break}}else redraw=!0;return redraw},redraw:function(){var layers,i,len,layer,baseLayer,checked,inputElem,labelSpan,br,groupArray,groupDiv;if(!this.checkRedraw())return this.div;this.clearLayersArray("base");this.clearLayersArray("data");var containsOverlays=!1,containsBaseLayers=!1,len=this.map.layers.length;for(this.layerStates=new Array(len),i=0;i<len;i++)layer=this.map.layers[i],this.layerStates[i]={name:layer.name,visibility:layer.visibility,inRange:layer.inRange,id:layer.id};for(layers=this.map.layers.slice(),this.ascending||layers.reverse(),i=0,len=layers.length;i<len;i++)layer=layers[i],baseLayer=layer.isBaseLayer,layer.displayInLayerSwitcher&&(baseLayer?containsBaseLayers=!0:containsOverlays=!0,checked=baseLayer?layer==this.map.baseLayer:layer.getVisibility(),inputElem=document.createElement("input"),inputElem.id=this.id+"_input_"+layer.name,inputElem.name=baseLayer?this.id+"_baseLayers":layer.name,inputElem.type=baseLayer?"radio":"checkbox",inputElem.value=layer.name,inputElem.checked=checked,inputElem.defaultChecked=checked,inputElem.className="olButton",inputElem._layer=layer.id,inputElem._layerSwitcher=this.id,baseLayer||layer.inRange||(inputElem.disabled=!0),labelSpan=document.createElement("label"),labelSpan["for"]=inputElem.id,OpenLayers.Element.addClass(labelSpan,"labelSpan olButton"),labelSpan._layer=layer.id,labelSpan._layerSwitcher=this.id,baseLayer||layer.inRange||(labelSpan.style.color="gray"),labelSpan.innerHTML=layer.name,labelSpan.style.verticalAlign=baseLayer?"bottom":"baseline",br=document.createElement("br"),groupArray=baseLayer?this.baseLayers:this.dataLayers,groupArray.push({layer:layer,inputElem:inputElem,labelSpan:labelSpan}),groupDiv=baseLayer?this.baseLayersDiv:this.dataLayersDiv,groupDiv.appendChild(inputElem),groupDiv.appendChild(labelSpan),groupDiv.appendChild(br));return this.dataLbl.style.display=containsOverlays?"":"none",this.baseLbl.style.display=containsBaseLayers?"":"none",this.div},updateMap:function(){for(var layerEntry,i=0,len=this.baseLayers.length;i<len;i++)layerEntry=this.baseLayers[i],layerEntry.inputElem.checked&&this.map.setBaseLayer(layerEntry.layer,!1);for(i=0,len=this.dataLayers.length;i<len;i++)layerEntry=this.dataLayers[i],layerEntry.layer.setVisibility(layerEntry.inputElem.checked)},maximizeControl:function(e){this.div.style.width="";this.div.style.height="";this.showControls(!1);e!=null&&OpenLayers.Event.stop(e)},minimizeControl:function(e){this.div.style.width="0px";this.div.style.height="0px";this.showControls(!0);e!=null&&OpenLayers.Event.stop(e)},showControls:function(minimize){this.maximizeDiv.style.display=minimize?"":"none";this.minimizeDiv.style.display=minimize?"none":"";this.layersDiv.style.display=minimize?"none":""},loadContents:function(){var img;this.layersDiv=document.createElement("div");this.layersDiv.id=this.id+"_layersDiv";OpenLayers.Element.addClass(this.layersDiv,"layersDiv");this.baseLbl=document.createElement("div");this.baseLbl.innerHTML=OpenLayers.i18n("Base Layer");OpenLayers.Element.addClass(this.baseLbl,"baseLbl");this.baseLayersDiv=document.createElement("div");OpenLayers.Element.addClass(this.baseLayersDiv,"baseLayersDiv");this.dataLbl=document.createElement("div");this.dataLbl.innerHTML=OpenLayers.i18n("Overlays");OpenLayers.Element.addClass(this.dataLbl,"dataLbl");this.dataLayersDiv=document.createElement("div");OpenLayers.Element.addClass(this.dataLayersDiv,"dataLayersDiv");this.ascending?(this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv),this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv)):(this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv),this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv));this.div.appendChild(this.layersDiv);this.roundedCorner&&(OpenLayers.Rico.Corner.round(this.div,{corners:"tl bl",bgColor:"transparent",color:this.roundedCornerColor,blend:!1}),OpenLayers.Rico.Corner.changeOpacity(this.layersDiv,.75));img=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MaximizeDiv",null,null,img,"absolute");OpenLayers.Element.addClass(this.maximizeDiv,"maximizeDiv olButton");this.maximizeDiv.style.display="none";this.div.appendChild(this.maximizeDiv);img=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png");this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MinimizeDiv",null,null,img,"absolute");OpenLayers.Element.addClass(this.minimizeDiv,"minimizeDiv olButton");this.minimizeDiv.style.display="none";this.div.appendChild(this.minimizeDiv)},CLASS_NAME:"OpenLayers.Control.LayerSwitcher"});OpenLayers.Tile.Image.IFrame={useIFrame:null,draw:function(){var draw=OpenLayers.Tile.Image.prototype.shouldDraw.call(this),url,usedIFrame,fromIFrame,toIFrame;return draw&&(url=this.layer.getURL(this.bounds),usedIFrame=this.useIFrame,this.useIFrame=this.maxGetUrlLength!==null&&!this.layer.async&&url.length>this.maxGetUrlLength,fromIFrame=usedIFrame&&!this.useIFrame,toIFrame=!usedIFrame&&this.useIFrame,(fromIFrame||toIFrame)&&(this.imgDiv&&this.imgDiv.parentNode===this.frame&&this.frame.removeChild(this.imgDiv),this.imgDiv=null,fromIFrame?(this.blankImageUrl=this._blankImageUrl,this.frame.removeChild(this.frame.firstChild)):(this._blankImageUrl=this.blankImageUrl,this.blankImageUrl="about:blank"))),OpenLayers.Tile.Image.prototype.draw.apply(this,arguments)},getImage:function(){var eventPane,style,id,iframe;return this.useIFrame===!0?(this.frame.childNodes.length||(eventPane=document.createElement("div"),style=eventPane.style,style.position="absolute",style.width="100%",style.height="100%",style.zIndex=1,style.backgroundImage="url("+this._blankImageUrl+")",this.frame.appendChild(eventPane)),id=this.id+"_iFrame",parseFloat(navigator.appVersion.split("MSIE")[1])<9?(iframe=document.createElement('<iframe name="'+id+'">'),iframe.style.backgroundColor="#FFFFFF",iframe.style.filter="chroma(color=#FFFFFF)"):(iframe=document.createElement("iframe"),iframe.style.backgroundColor="transparent",iframe.name=id),iframe.scrolling="no",iframe.marginWidth="0px",iframe.marginHeight="0px",iframe.frameBorder="0",iframe.style.position="absolute",iframe.style.width="100%",iframe.style.height="100%",this.layer.opacity<1&&OpenLayers.Util.modifyDOMElement(iframe,null,null,null,null,null,null,this.layer.opacity),this.frame.appendChild(iframe),this.imgDiv=iframe,iframe):OpenLayers.Tile.Image.prototype.getImage.apply(this,arguments)},createRequestForm:function(){var form=document.createElement("form"),cacheId,imageSize,params,field,par;form.method="POST";cacheId=this.layer.params._OLSALT;cacheId=(cacheId?cacheId+"_":"")+this.bounds.toBBOX();form.action=OpenLayers.Util.urlAppend(this.layer.url,cacheId);form.target=this.id+"_iFrame";imageSize=this.layer.getImageSize();params=OpenLayers.Util.getParameters(this.url);for(par in params)field=document.createElement("input"),field.type="hidden",field.name=par,field.value=params[par],form.appendChild(field);return form},setImgSrc:function(url){if(this.useIFrame===!0)if(url){var form=this.createRequestForm();this.frame.appendChild(form);form.submit();this.frame.removeChild(form)}else this.imgDiv.parentNode===this.frame&&(this.frame.removeChild(this.imgDiv),this.imgDiv=null);else OpenLayers.Tile.Image.prototype.setImgSrc.apply(this,arguments)},onImageLoad:function(){OpenLayers.Tile.Image.prototype.onImageLoad.apply(this,arguments);this.useIFrame===!0&&(this.imgDiv.style.opacity=1,this.frame.style.opacity=this.layer.opacity)},createBackBuffer:function(){var backBuffer;return this.useIFrame===!1&&(backBuffer=OpenLayers.Tile.Image.prototype.createBackBuffer.call(this)),backBuffer}};OpenLayers.Format.Atom=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{atom:"http://www.w3.org/2005/Atom",georss:"http://www.georss.org/georss"},feedTitle:"untitled",defaultEntryTitle:"untitled",gmlParser:null,xy:!1,read:function(doc){return typeof doc=="string"&&(doc=OpenLayers.Format.XML.prototype.read.apply(this,[doc])),this.parseFeatures(doc)},write:function(features){var doc,i,ii;if(OpenLayers.Util.isArray(features))for(doc=this.createElementNSPlus("atom:feed"),doc.appendChild(this.createElementNSPlus("atom:title",{value:this.feedTitle})),i=0,ii=features.length;i<ii;i++)doc.appendChild(this.buildEntryNode(features[i]));else doc=this.buildEntryNode(features);return OpenLayers.Format.XML.prototype.write.apply(this,[doc])},buildContentNode:function(content){var node=this.createElementNSPlus("atom:content",{attributes:{type:content.type||null}});if(content.src)node.setAttribute("src",content.src);else if(content.type=="text"||content.type==null)node.appendChild(this.createTextNode(content.value));else if(content.type=="html"){if(typeof content.value!="string")throw"HTML content must be in form of an escaped string";node.appendChild(this.createTextNode(content.value))}else content.type=="xhtml"?node.appendChild(content.value):content.type=="xhtml"||content.type.match(/(\+|\/)xml$/)?node.appendChild(content.value):node.appendChild(this.createTextNode(content.value));return node},buildEntryNode:function(feature){var attrib=feature.attributes,atomAttrib=attrib.atom||{},entryNode=this.createElementNSPlus("atom:entry"),authors,categories,category,contributors,links,link,i,ii,whereNode;if(atomAttrib.authors)for(authors=OpenLayers.Util.isArray(atomAttrib.authors)?atomAttrib.authors:[atomAttrib.authors],i=0,ii=authors.length;i<ii;i++)entryNode.appendChild(this.buildPersonConstructNode("author",authors[i]));if(atomAttrib.categories)for(categories=OpenLayers.Util.isArray(atomAttrib.categories)?atomAttrib.categories:[atomAttrib.categories],i=0,ii=categories.length;i<ii;i++)category=categories[i],entryNode.appendChild(this.createElementNSPlus("atom:category",{attributes:{term:category.term,scheme:category.scheme||null,label:category.label||null}}));if(atomAttrib.content&&entryNode.appendChild(this.buildContentNode(atomAttrib.content)),atomAttrib.contributors)for(contributors=OpenLayers.Util.isArray(atomAttrib.contributors)?atomAttrib.contributors:[atomAttrib.contributors],i=0,ii=contributors.length;i<ii;i++)entryNode.appendChild(this.buildPersonConstructNode("contributor",contributors[i]));if(feature.fid&&entryNode.appendChild(this.createElementNSPlus("atom:id",{value:feature.fid})),atomAttrib.links)for(links=OpenLayers.Util.isArray(atomAttrib.links)?atomAttrib.links:[atomAttrib.links],i=0,ii=links.length;i<ii;i++)link=links[i],entryNode.appendChild(this.createElementNSPlus("atom:link",{attributes:{href:link.href,rel:link.rel||null,type:link.type||null,hreflang:link.hreflang||null,title:link.title||null,length:link.length||null}}));return atomAttrib.published&&entryNode.appendChild(this.createElementNSPlus("atom:published",{value:atomAttrib.published})),atomAttrib.rights&&entryNode.appendChild(this.createElementNSPlus("atom:rights",{value:atomAttrib.rights})),(atomAttrib.summary||attrib.description)&&entryNode.appendChild(this.createElementNSPlus("atom:summary",{value:atomAttrib.summary||attrib.description})),entryNode.appendChild(this.createElementNSPlus("atom:title",{value:atomAttrib.title||attrib.title||this.defaultEntryTitle})),atomAttrib.updated&&entryNode.appendChild(this.createElementNSPlus("atom:updated",{value:atomAttrib.updated})),feature.geometry&&(whereNode=this.createElementNSPlus("georss:where"),whereNode.appendChild(this.buildGeometryNode(feature.geometry)),entryNode.appendChild(whereNode)),entryNode},initGmlParser:function(){this.gmlParser=new OpenLayers.Format.GML.v3({xy:this.xy,featureNS:"http://example.com#feature",internalProjection:this.internalProjection,externalProjection:this.externalProjection})},buildGeometryNode:function(geometry){this.gmlParser||this.initGmlParser();var node=this.gmlParser.writeNode("feature:_geometry",geometry);return node.firstChild},buildPersonConstructNode:function(name,value){var oNames=["uri","email"],personNode=this.createElementNSPlus("atom:"+name),i,ii;for(personNode.appendChild(this.createElementNSPlus("atom:name",{value:value.name})),i=0,ii=oNames.length;i<ii;i++)value[oNames[i]]&&personNode.appendChild(this.createElementNSPlus("atom:"+oNames[i],{value:value[oNames[i]]}));return personNode},getFirstChildValue:function(node,nsuri,name,def){var nodes=this.getElementsByTagNameNS(node,nsuri,name);return nodes&&nodes.length>0?this.getChildValue(nodes[0],def):def},parseFeature:function(node){var atomAttrib={},value=null,nodes=null,attval=null,atomns=this.namespaces.atom,oAtts,i,ii,j,jj;for(this.parsePersonConstructs(node,"author",atomAttrib),nodes=this.getElementsByTagNameNS(node,atomns,"category"),nodes.length>0&&(atomAttrib.categories=[]),i=0,ii=nodes.length;i<ii;i++)value={},value.term=nodes[i].getAttribute("term"),attval=nodes[i].getAttribute("scheme"),attval&&(value.scheme=attval),attval=nodes[i].getAttribute("label"),attval&&(value.label=attval),atomAttrib.categories.push(value);for(nodes=this.getElementsByTagNameNS(node,atomns,"content"),nodes.length>0&&(value={},attval=nodes[0].getAttribute("type"),attval&&(value.type=attval),attval=nodes[0].getAttribute("src"),attval?value.src=attval:(value.value=value.type=="text"||value.type=="html"||value.type==null?this.getFirstChildValue(node,atomns,"content",null):value.type=="xhtml"||value.type.match(/(\+|\/)xml$/)?this.getChildEl(nodes[0]):this.getFirstChildValue(node,atomns,"content",null),atomAttrib.content=value)),this.parsePersonConstructs(node,"contributor",atomAttrib),atomAttrib.id=this.getFirstChildValue(node,atomns,"id",null),nodes=this.getElementsByTagNameNS(node,atomns,"link"),nodes.length>0&&(atomAttrib.links=new Array(nodes.length)),oAtts=["rel","type","hreflang","title","length"],i=0,ii=nodes.length;i<ii;i++){for(value={},value.href=nodes[i].getAttribute("href"),j=0,jj=oAtts.length;j<jj;j++)attval=nodes[i].getAttribute(oAtts[j]),attval&&(value[oAtts[j]]=attval);atomAttrib.links[i]=value}value=this.getFirstChildValue(node,atomns,"published",null);value&&(atomAttrib.published=value);value=this.getFirstChildValue(node,atomns,"rights",null);value&&(atomAttrib.rights=value);value=this.getFirstChildValue(node,atomns,"summary",null);value&&(atomAttrib.summary=value);atomAttrib.title=this.getFirstChildValue(node,atomns,"title",null);atomAttrib.updated=this.getFirstChildValue(node,atomns,"updated",null);var featureAttrib={title:atomAttrib.title,description:atomAttrib.summary,atom:atomAttrib},geometry=this.parseLocations(node)[0],feature=new OpenLayers.Feature.Vector(geometry,featureAttrib);return feature.fid=atomAttrib.id,feature},parseFeatures:function(node){var features=[],entries=this.getElementsByTagNameNS(node,this.namespaces.atom,"entry"),i,ii;for(entries.length==0&&(entries=[node]),i=0,ii=entries.length;i<ii;i++)features.push(this.parseFeature(entries[i]));return features},parseLocations:function(node){var georssns=this.namespaces.georss,locations={components:[]},where=this.getElementsByTagNameNS(node,georssns,"where"),components,point,xy,line,polygon,coords,p,points,j,jj,i,ii;if(where&&where.length>0)for(this.gmlParser||this.initGmlParser(),i=0,ii=where.length;i<ii;i++)this.gmlParser.readChildNodes(where[i],locations);if(components=locations.components,point=this.getElementsByTagNameNS(node,georssns,"point"),point&&point.length>0)for(i=0,ii=point.length;i<ii;i++)xy=OpenLayers.String.trim(point[i].firstChild.nodeValue).split(/\s+/),xy.length!=2&&(xy=OpenLayers.String.trim(point[i].firstChild.nodeValue).split(/\s*,\s*/)),components.push(new OpenLayers.Geometry.Point(xy[1],xy[0]));if(line=this.getElementsByTagNameNS(node,georssns,"line"),line&&line.length>0)for(i=0,ii=line.length;i<ii;i++){for(coords=OpenLayers.String.trim(line[i].firstChild.nodeValue).split(/\s+/),points=[],j=0,jj=coords.length;j<jj;j+=2)p=new OpenLayers.Geometry.Point(coords[j+1],coords[j]),points.push(p);components.push(new OpenLayers.Geometry.LineString(points))}if(polygon=this.getElementsByTagNameNS(node,georssns,"polygon"),polygon&&polygon.length>0)for(i=0,ii=polygon.length;i<ii;i++){for(coords=OpenLayers.String.trim(polygon[i].firstChild.nodeValue).split(/\s+/),points=[],j=0,jj=coords.length;j<jj;j+=2)p=new OpenLayers.Geometry.Point(coords[j+1],coords[j]),points.push(p);components.push(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(components)]))}if(this.internalProjection&&this.externalProjection)for(i=0,ii=components.length;i<ii;i++)components[i]&&components[i].transform(this.externalProjection,this.internalProjection);return components},parsePersonConstructs:function(node,name,data){for(var value,j,jj,attval,persons=[],atomns=this.namespaces.atom,nodes=this.getElementsByTagNameNS(node,atomns,name),oAtts=["uri","email"],i=0,ii=nodes.length;i<ii;i++){for(value={},value.name=this.getFirstChildValue(nodes[i],atomns,"name",null),j=0,jj=oAtts.length;j<jj;j++)attval=this.getFirstChildValue(nodes[i],atomns,oAtts[j],null),attval&&(value[oAtts[j]]=attval);persons.push(value)}persons.length>0&&(data[name+"s"]=persons)},CLASS_NAME:"OpenLayers.Format.Atom"});OpenLayers.Control.KeyboardDefaults=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,slideFactor:75,observeElement:null,draw:function(){var observeElement=this.observeElement||document;this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyPress},{observeElement:observeElement})},defaultKeyPress:function(evt){var size,handled=!0;if(typeof evt.target=="undefined"||evt.target.tagName!="INPUT"&&evt.target.tagName!="TEXTAREA"&&evt.target.tagName!="SELECT"){switch(evt.keyCode){case OpenLayers.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Event.KEY_RIGHT:this.map.pan(this.slideFactor,0);break;case OpenLayers.Event.KEY_UP:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);break;case 33:size=this.map.getSize();this.map.pan(0,-.75*size.h);break;case 34:size=this.map.getSize();this.map.pan(0,.75*size.h);break;case 35:size=this.map.getSize();this.map.pan(.75*size.w,0);break;case 36:size=this.map.getSize();this.map.pan(-.75*size.w,0);break;case 43:case 61:case 187:case 107:this.map.zoomIn();break;case 45:case 109:case 189:case 95:this.map.zoomOut();break;default:handled=!1}handled&&OpenLayers.Event.stop(evt)}},CLASS_NAME:"OpenLayers.Control.KeyboardDefaults"});Oskari.clazz.define("Oskari.mapframework.openlayers.theme.default.Bundle",function(){},{create:function(){return this},update:function(){},start:function(){var bundlePath=this.mediator.manager.stateForBundleDefinitions["openlayers-default-theme"].bundlePath;OpenLayers.ImgPath=bundlePath+"/img/"},stop:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.bundle.BundleInstance"],source:{scripts:[{type:"text/css",src:"../../../../resources/openlayers/theme/default/style.css"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"openlayers-default-theme","Bundle-Name":"mapframework.openlayers-default-theme.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:[{Part:"OpenLayers","License-Name":"BSD","License-Online-Resource":"http://svn.openlayers.org/trunk/openlayers/license.txt"},{Part:"Proj4JS","License-Name":"LGPL/BSD","License-Online-Resource":""}]}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.core.Bundle",Title:" mapframework.core.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}});Oskari.bundle_manager.installBundleClass("openlayers-default-theme","Oskari.mapframework.openlayers.theme.default.Bundle");Oskari.clazz.define("Oskari.mapframework.service.map.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/service/map-layer-service.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"service-map","Bundle-Name":"mapframework.service.map.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.service.Bundle",Title:" mapframework.service.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}});Oskari.bundle_manager.installBundleClass("service-map","Oskari.mapframework.service.map.Bundle");Oskari.clazz.define("Oskari.mapframework.service.MapLayerService",function(mapLayerUrl,sandbox){this._mapLayerUrl=mapLayerUrl;this._sandbox=sandbox;this._allLayersAjaxLoaded=!1;this._loadedLayersList=[];this._reservedLayerIds={};this._stickyLayerIds={};this.typeMapping={wmslayer:"Oskari.mapframework.domain.WmsLayer",vectorlayer:"Oskari.mapframework.domain.VectorLayer"};this.modelBuilderMapping={};this._localization=Oskari.getLocalization("Generic")},{__qname:"Oskari.mapframework.service.MapLayerService",getQName:function(){return this.__qname},__name:"MapLayerService",getName:function(){return this.__name},addLayer:function(layerModel,suppressEvent){if(layerModel.getParentId()!=-1){this.addSubLayer(layerModel.getParentId(),layerModel,suppressEvent);return}if(this.checkForDuplicateId(layerModel.getId(),layerModel.getName()),this._reservedLayerIds[layerModel.getId()]=!0,this._loadedLayersList.push(layerModel),suppressEvent!==!0){var event=this._sandbox.getEventBuilder("MapLayerEvent")(layerModel.getId(),"add");this._sandbox.notifyAll(event)}},addSubLayer:function(parentLayerId,layerModel,suppressEvent){var parentLayer=this.findMapLayer(parentLayerId),subLayers,evt;if(parentLayer&&(parentLayer.isBaseLayer()||parentLayer.isGroupLayer())){if(layerModel.setParentId(parentLayerId),subLayers=parentLayer.getSubLayers(),!parentLayer.addSubLayer(layerModel))return;suppressEvent!==!0&&(evt=this._sandbox.getEventBuilder("MapLayerEvent")(layerModel.getId(),"update"),this._sandbox.notifyAll(evt))}},removeLayer:function(layerId,suppressEvent){var layer=this.findMapLayer(layerId),parentLayer=null,evt=null,layerList,i;if(layer){if(this._sandbox.removeMapLayer(layerId),layerList=this._loadedLayersList,layer.getParentId()!=-1){if(parentLayer=this.findMapLayer(layer.getParentId()),!parentLayer)return;layerList=parentLayer.getSubLayers()}for(i=0;i<layerList.length;i++)if(layerList[i].getId()+""==layerId+""){layerList.splice(i,1);break}layer&&suppressEvent!==!0&&(parentLayer?evt=this._sandbox.getEventBuilder("MapLayerEvent")(parentLayer.getId(),"update"):(evt=this._sandbox.getEventBuilder("MapLayerEvent")(layer.getId(),"remove"),this._reservedLayerIds[layerId]=!1),this._sandbox.notifyAll(evt))}},updateLayer:function(layerId,newLayerConf){var layer=this.findMapLayer(layerId),i,evt;if(layer){newLayerConf.dataUrl&&layer.setDataUrl(newLayerConf.dataUrl);newLayerConf.legendImage&&layer.setLegendImage(newLayerConf.legendImage);newLayerConf.minScale&&layer.setMinScale(newLayerConf.minScale);newLayerConf.maxScale&&layer.setMaxScale(newLayerConf.maxScale);newLayerConf.name&&layer.setName(newLayerConf.name);newLayerConf.subtitle&&layer.setDescription(newLayerConf.subtitle);newLayerConf.orgName&&layer.setOrganizationName(newLayerConf.orgName);newLayerConf.inspire&&layer.setInspireName(newLayerConf.inspire);newLayerConf.realtime&&layer.setRealtime(newLayerConf.realtime);newLayerConf.refreshRate&&layer.setRefreshRate(newLayerConf.refreshRate);newLayerConf.type==="wmslayer"&&this._populateWmsMapLayerAdditionalData(layer,newLayerConf);for(i in newLayerConf.admin)newLayerConf.admin.hasOwnProperty(i)&&newLayerConf.admin[i]&&(layer.admin[i]=newLayerConf.admin[i]);evt=this._sandbox.getEventBuilder("MapLayerEvent")(layer.getId(),"update");this._sandbox.notifyAll(evt)}},makeLayerSticky:function(layerId,isSticky){var layer=this.findMapLayer(layerId),evt;this._stickyLayerIds[layerId]=isSticky===!0;layer&&(layer.setSticky(isSticky),evt=this._sandbox.getEventBuilder("MapLayerEvent")(layer.getId(),"sticky"),this._sandbox.notifyAll(evt))},loadAllLayersAjax:function(callbackSuccess,callbackFailure){var me=this,timeStamp=(new Date).getTime();jQuery.ajax({type:"GET",dataType:"json",beforeSend:function(x){x&&x.overrideMimeType&&x.overrideMimeType("application/j-son;charset=UTF-8")},url:this._mapLayerUrl+"&timestamp="+timeStamp+"&",success:function(pResp){me._loadAllLayersAjaxCallBack(pResp,callbackSuccess)},error:function(jqXHR){callbackFailure&&jqXHR.status!==0&&callbackFailure()}})},_loadAllLayersAjaxCallBack:function(pResp,callbackSuccess){for(var allLayers=pResp.layers,mapLayer,existingLayer,exSubLayers,mapSubLayers,subI,existingSubLayer,evt,i=0;i<allLayers.length;i++)if(mapLayer=this.createMapLayer(allLayers[i]),mapLayer)if(this._reservedLayerIds[mapLayer.getId()]!==!0)this.addLayer(mapLayer,!0);else if(existingLayer=this.findMapLayer(mapLayer.getId()),allLayers[i].admin!==null&&allLayers[i].admin!==undefined&&(existingLayer.admin=allLayers[i].admin),allLayers[i].names&&(existingLayer.names=allLayers[i].names),existingLayer.getSubLayers()!==null&&existingLayer.getSubLayers()!==undefined)for(exSubLayers=existingLayer.getSubLayers(),mapSubLayers=mapLayer.getSubLayers(),subI=0;subI<exSubLayers.length;subI++)existingSubLayer=exSubLayers[subI],exSubLayers[subI].admin!==null&&exSubLayers[subI].admin!==undefined&&(existingSubLayer.admin=mapSubLayers[subI].admin),exSubLayers[subI].names&&(existingSubLayer.names=mapSubLayers[subI].names);this._allLayersAjaxLoaded=!0;evt=this._sandbox.getEventBuilder("MapLayerEvent")(null,"add");this._sandbox.notifyAll(evt);callbackSuccess&&callbackSuccess()},isAllLayersLoaded:function(){return this._allLayersAjaxLoaded},getAllLayers:function(){return this._loadedLayersList},getAllLayersByMetaType:function(type){for(var list=[],layer,i=0;i<this._loadedLayersList.length;++i)layer=this._loadedLayersList[i],layer.getMetaType&&layer.getMetaType()===type&&list.push(layer);return list},getLayersOfType:function(type){for(var list=[],layer,i=0;i<this._loadedLayersList.length;++i)layer=this._loadedLayersList[i],layer.isLayerOfType(type)&&list.push(layer);return list},getLayersByMetadataId:function(metadataIdentifier){for(var list=[],layer,i=0;i<this._loadedLayersList.length;++i)layer=this._loadedLayersList[i],layer.getMetadataIdentifier()===metadataIdentifier&&list.push(layer);return list},registerLayerModel:function(type,modelName){this.typeMapping[type]=modelName},unregisterLayerModel:function(type){this.typeMapping[type]=undefined},registerLayerModelBuilder:function(type,specHandlerClsInstance){this._sandbox.printDebug("[MapLayerService] registering handler for type "+type);this.modelBuilderMapping[type]=specHandlerClsInstance},unregisterLayerModelBuilder:function(type){this.modelBuilderMapping[type]=undefined},createMapLayer:function(mapLayerJson){var mapLayer=null;return mapLayer=mapLayerJson.type==="base"?this._createGroupMapLayer(mapLayerJson,!0):mapLayerJson.type==="groupMap"?this._createGroupMapLayer(mapLayerJson,!1):this._createActualMapLayer(mapLayerJson),mapLayer&&mapLayerJson.admin!==null&&mapLayerJson.admin!==undefined&&(mapLayer.admin=mapLayerJson.admin),mapLayer&&mapLayerJson.names!==null&&mapLayerJson.names!==undefined&&(mapLayer.names=mapLayerJson.names),mapLayer&&this._stickyLayerIds[mapLayer.getId()]&&mapLayer.setSticky(!0),mapLayer},_createGroupMapLayer:function(baseMapJson,isBase){var baseLayer=this.createLayerTypeInstance("wmslayer"),tempPartsForMetadata,perm,i,subLayer,subLayerOpacity;if(isBase?baseLayer.setAsBaseLayer():baseLayer.setAsGroupLayer(),baseLayer.setVisible(!0),baseLayer.setId(baseMapJson.id),baseLayer.setName(baseMapJson.name),baseLayer.setMaxScale(baseMapJson.maxScale),baseLayer.setMinScale(baseMapJson.minScale),baseLayer.setRealtime(baseMapJson.realtime),baseLayer.setRefreshRate(baseMapJson.refreshRate),baseLayer.setDataUrl(baseMapJson.dataUrl),baseLayer.setMetadataIdentifier(baseMapJson.dataUrl_uuid),!baseLayer.getMetadataIdentifier()&&baseLayer.getDataUrl()&&(tempPartsForMetadata=baseLayer.getDataUrl().split("uuid="),tempPartsForMetadata.length===2&&baseLayer.setMetadataIdentifier(tempPartsForMetadata[1])),baseMapJson.orgName?baseLayer.setOrganizationName(baseMapJson.orgName):baseLayer.setOrganizationName(""),baseMapJson.inspire?baseLayer.setInspireName(baseMapJson.inspire):baseLayer.setInspireName(""),baseLayer.setLegendImage(baseMapJson.legendImage),baseLayer.setDescription(baseMapJson.info),baseLayer.setQueryable(!1),baseMapJson.permissions)for(perm in baseMapJson.permissions)baseMapJson.permissions.hasOwnProperty(perm)&&baseLayer.addPermission(perm,baseMapJson.permissions[perm]);if(baseMapJson.subLayer)for(i=0;i<baseMapJson.subLayer.length;i++)subLayer=this._createActualMapLayer(baseMapJson.subLayer[i]),subLayer.setParentId(baseMapJson.id),subLayer.admin=baseMapJson.subLayer[i].admin||{},baseLayer.getSubLayers().push(subLayer);return baseMapJson.opacity!==null&&baseMapJson.opacity!==undefined?baseLayer.setOpacity(baseMapJson.opacity):baseLayer.getSubLayers().length>0?(subLayerOpacity=baseLayer.getSubLayers()[0].getOpacity(),subLayerOpacity!==null&&subLayerOpacity!==undefined?baseLayer.setOpacity(subLayerOpacity):baseLayer.setOpacity(100)):baseLayer.setOpacity(100),baseLayer},createLayerTypeInstance:function(type,params,options){var clazz=this.typeMapping[type];return clazz?Oskari.clazz.create(clazz,params,options):null},_createActualMapLayer:function(mapLayerJson){var layer,tempPartsForMetadata,perm,builder;if(!mapLayerJson)return null;if(layer=this.createLayerTypeInstance(mapLayerJson.type,mapLayerJson.params,mapLayerJson.options),!layer)return console.log("disabled map layer error throwing. Unknown layer type",mapLayerJson.type),null;if(mapLayerJson.type==="wmslayer"?this._populateWmsMapLayerAdditionalData(layer,mapLayerJson):mapLayerJson.type==="vectorlayer"&&layer.setStyledLayerDescriptor(mapLayerJson.styledLayerDescriptor),mapLayerJson.metaType&&layer.setMetaType&&layer.setMetaType(mapLayerJson.metaType),layer.setAsNormalLayer(),layer.setId(mapLayerJson.id),layer.setName(mapLayerJson.name),mapLayerJson.opacity!==null&&mapLayerJson.opacity!==undefined?layer.setOpacity(mapLayerJson.opacity):layer.setOpacity(100),layer.setMaxScale(mapLayerJson.maxScale),layer.setMinScale(mapLayerJson.minScale),layer.setDescription(mapLayerJson.subtitle),layer.setQueryable(mapLayerJson.isQueryable==="true"||mapLayerJson.isQueryable===!0),layer.setRealtime(mapLayerJson.realtime),layer.setRefreshRate(mapLayerJson.refreshRate),layer.setDataUrl(mapLayerJson.dataUrl),layer.setMetadataIdentifier(mapLayerJson.dataUrl_uuid),!layer.getMetadataIdentifier()&&layer.getDataUrl()&&(tempPartsForMetadata=layer.getDataUrl().split("uuid="),tempPartsForMetadata.length===2&&layer.setMetadataIdentifier(tempPartsForMetadata[1])),mapLayerJson.backendStatus&&layer.setBackendStatus&&layer.setBackendStatus(mapLayerJson.backendStatus),mapLayerJson.orgName?layer.setOrganizationName(mapLayerJson.orgName):layer.setOrganizationName(""),mapLayerJson.inspire?layer.setInspireName(mapLayerJson.inspire):layer.setInspireName(""),layer.setVisible(!0),mapLayerJson.geom&&layer.setGeometryWKT&&layer.setGeometryWKT(mapLayerJson.geom),mapLayerJson.permissions)for(perm in mapLayerJson.permissions)mapLayerJson.permissions.hasOwnProperty(perm)&&layer.addPermission(perm,mapLayerJson.permissions[perm]);return mapLayerJson.url&&layer.addLayerUrl(mapLayerJson.url),layer.setLegendImage(mapLayerJson.legendImage),mapLayerJson.localization&&layer.setLocalization(mapLayerJson.localization),builder=this.modelBuilderMapping[mapLayerJson.type],builder&&builder.parseLayerData(layer,mapLayerJson,this),layer},_populateWmsMapLayerAdditionalData:function(layer,jsonLayer){var wmsUrls,i,locDefaultStyle,defaultStyle;if(layer.setWmsName(jsonLayer.wmsName),jsonLayer.wmsUrl)for(wmsUrls=jsonLayer.wmsUrl.split(","),i=0;i<wmsUrls.length;i++)layer.addWmsUrl(wmsUrls[i]);return layer.setFeatureInfoEnabled(jsonLayer.gfi!=="disabled"),layer.setVersion(jsonLayer.version),jsonLayer.formats&&(layer.setQueryFormat(jsonLayer.formats.value),layer.setAvailableQueryFormats(jsonLayer.formats.available)),locDefaultStyle=this._localization["default-style"],defaultStyle=Oskari.clazz.create("Oskari.mapframework.domain.Style"),defaultStyle.setName(""),defaultStyle.setTitle(locDefaultStyle),defaultStyle.setLegend(""),this.populateStyles(layer,jsonLayer,defaultStyle)},populateStyles:function(layer,jsonLayer,defaultStyle){var styleBuilder=Oskari.clazz.builder("Oskari.mapframework.domain.Style"),i,styleJson,blnMultipleStyles,style;if(jsonLayer.styles){for(i=0;i<jsonLayer.styles.length;i++)if(styleJson=jsonLayer.styles,blnMultipleStyles=!isNaN(i),blnMultipleStyles&&(styleJson=jsonLayer.styles[i]),style=styleBuilder(),style.setName(styleJson.name),style.setTitle(styleJson.title),style.setLegend(styleJson.legend),layer.addStyle(style),!blnMultipleStyles)break;layer.selectStyle(jsonLayer.style)}return defaultStyle?(layer.addStyle(defaultStyle),layer.selectStyle(defaultStyle.getName())):(style=styleBuilder(),style.setName(""),style.setTitle(""),style.setLegend(""),layer.addStyle(style),layer.selectStyle("")),layer},checkForDuplicateId:function(id,name){if(this._reservedLayerIds[id]===!0){var foundLayer=this.findMapLayer(id);throw"Trying to add map layer with id '"+id+" ("+name+")' but that id is already reserved for '"+foundLayer.getName()+"'";}},findMapLayer:function(id,layerList){var i,layer,subLayers,subLayer;for(layerList||(layerList=this._loadedLayersList),i=0;i<layerList.length;i++)if(layer=layerList[i],layer&&layer.getId()+""==id+"")return layer;for(i=0;i<layerList.length;i++)if(layer=layerList[i],layer&&(subLayers=layer.getSubLayers(),subLayer=this.findMapLayer(id,subLayers),subLayer!==null&&subLayer!==undefined))return subLayer;return null}},{protocol:["Oskari.mapframework.service.Service"]});Oskari.clazz.define("Oskari.mapframework.service.base.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/service/service.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"service-base","Bundle-Name":"mapframework.service.base.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.service.Bundle",Title:" mapframework.service.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}});Oskari.bundle_manager.installBundleClass("service-base","Oskari.mapframework.service.base.Bundle");Oskari.clazz.define("Oskari.mapframework.service.Service",function(){throw"mapframework.service.Service should not be used";},{getName:function(){throw"Running default implementation of Service.getName(). implement your own!";}});Oskari.clazz.define("Oskari.mapframework.sandbox.map.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/sandbox/sandbox-map-layer-methods.js"},{type:"text/javascript",src:"../../../../sources/framework/sandbox/sandbox-map-methods.js"},{type:"text/javascript",src:"../../../../sources/framework/sandbox/sandbox-abstraction-methods.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"sandbox-map","Bundle-Name":"mapframework.sandbox.map.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.sandbox.Bundle",Title:" mapframework.sandbox.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}});Oskari.bundle_manager.installBundleClass("sandbox-map","Oskari.mapframework.sandbox.map.Bundle");Oskari.clazz.category("Oskari.mapframework.sandbox.Sandbox","map-layer-methods",{findMapLayerFromAllAvailable:function(id){return this._core.findMapLayerFromAllAvailable(id)},findAllSelectedMapLayers:function(){var layersList=this._core.getAllSelectedLayers();return layersList.slice(0)},findMapLayerFromSelectedMapLayers:function(layerId){return this._core.findMapLayerFromSelectedMapLayers(layerId)},isLayerAlreadySelected:function(id){return this._core.isLayerAlreadySelected(id)},findAllHighlightedLayers:function(){return this._core.getAllHighlightedMapLayers()},isMapLayerHighLighted:function(id){for(var highlighted=this.findAllHighlightedLayers(),i=0;i<highlighted.length;i++)if(highlighted[i].getId()+""==id+"")return!0;return!1},allowMultipleHighlightLayers:function(allow){this._core.allowMultipleHighlightLayers(allow)},removeMapLayer:function(layerId){this._core._handleRemoveMapLayerRequest({getMapLayerId:function(){return layerId}})}});Oskari.clazz.category("Oskari.mapframework.sandbox.Sandbox","map-methods",{getMap:function(){return this._core.getMap()},syncMapState:function(blnInitialMove){var mapDomain=this._core.getMap(),zoom=mapDomain.getZoom(),marker=mapDomain.isMarkerVisible();blnInitialMove===!0&&zoom==12&&this._core.processRequest(this._core.getRequestBuilder("MapMoveRequest")(mapDomain.getX(),mapDomain.getY(),0,!1));this._core.processRequest(this._core.getRequestBuilder("MapMoveRequest")(mapDomain.getX(),mapDomain.getY(),zoom,marker))},generateMapLinkParameters:function(options){var components=this.getStatefulComponents(),iterator=null,component=null,optionsLinkParameterArray=[],componentLinkParameterArray=[];for(iterator in components)components.hasOwnProperty(iterator)&&(component=components[iterator],component.getStateParameters&&typeof component.getStateParameters=="function"&&componentLinkParameterArray.push(component.getStateParameters()));options=options||{showMarker:!1,forceCache:!1,noSavedState:!1};for(iterator in options)options.hasOwnProperty(iterator)&&optionsLinkParameterArray.push(iterator+"="+(options[iterator]!==!1));return componentLinkParameterArray.concat(optionsLinkParameterArray).join("&")||null}});Oskari.clazz.category("Oskari.mapframework.sandbox.Sandbox","abstraction-methods",{domSelector:function(arg){return jQuery(arg)},ajax:function(url,success,failure,data){if(jQuery&&jQuery.ajax){var type="GET";data&&(type="POST");jQuery.ajax({type:type,url:url,beforeSend:function(x){x&&x.overrideMimeType&&x.overrideMimeType("application/j-son;charset=UTF-8")},data:data,success:success,error:failure})}else failure()},getDefer:function(){return window.Q&&window.Q.defer?window.Q.defer():undefined}});Oskari.clazz.define("Oskari.mapframework.sandbox.base.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/sandbox/sandbox.js"},{type:"text/javascript",src:"../../../../sources/framework/sandbox/sandbox-key-listener-methods.js"},{type:"text/javascript",src:"../../../../sources/framework/sandbox/sandbox-state-methods.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"sandbox-base","Bundle-Name":"mapframework.sandbox.base.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.sandbox.Bundle",Title:" mapframework.sandbox.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}});Oskari.bundle_manager.installBundleClass("sandbox-base","Oskari.mapframework.sandbox.base.Bundle");Oskari.clazz.define("Oskari.mapframework.sandbox.Sandbox",function(core){this._core=core;this._listeners=[];this._modules=[];this._modulesByName={};this._statefuls={};this.debugRequests=!1;this.debugEvents=!1;this.requestEventLog=[];this.requestEventStack=[];this.gatherDebugRequests=!1;this.maxGatheredRequestsAndEvents=4096;this.requestAndEventGather=[];this._eventLoopGuard=0;this._user=null;this._ajaxUrl=null},{disableDebug:function(){this.debugRequests=!1;this.debugEvents=!1;this.gatherDebugRequests=!1;this._core&&this._core.disableDebug()},enableDebug:function(){this.debugRequests=!0;this.debugEvents=!0;this.gatherDebugRequests=!0;this._core&&this._core.enableDebug()},printDebug:function(text){this._core.printDebug(text)},printWarn:function(text){this._core.printWarn(text)},setUser:function(userData){this._user=Oskari.clazz.create("Oskari.mapframework.domain.User",userData)},getUser:function(){return this._user||this.setUser(),this._user},setAjaxUrl:function(pUrl){this._ajaxUrl=pUrl},getAjaxUrl:function(){return this._ajaxUrl},registerService:function(service){this._core.registerService(service)},getService:function(type){return this._core.getService(type)},registerAsStateful:function(pBundleId,pInstance){this._statefuls[pBundleId]=pInstance},unregisterStateful:function(pBundleId){this._statefuls[pBundleId]=null;delete this._statefuls[pBundleId]},getStatefulComponents:function(){return this._statefuls},register:function(module){return this._modules.push(module),this._modulesByName[module.getName()]=module,module.init(this)},unregister:function(module){for(var me=this,remainingModules=[],m=0;m<me._modules.length;m++)module!==me._modules[m]&&remainingModules.push(me._modules[m]);me._modules=remainingModules;me._modulesByName[module.getName()]=undefined;delete me._modulesByName[module.getName()]},registerForEventByName:function(module,eventName){this._core.printDebug("#*#*#* Sandbox is registering module '"+module.getName()+"' to event '"+eventName+"'");var oldListeners=this._listeners[eventName];(oldListeners===null||oldListeners===undefined)&&(oldListeners=[],this._listeners[eventName]=oldListeners);oldListeners.push(module);this._core.printDebug("There are currently "+oldListeners.length+" listeners for event '"+eventName+"'")},unregisterFromEventByName:function(module,eventName){this._core.printDebug("Sandbox is unregistering module '"+module.getName()+"' from event '"+eventName+"'");var oldListeners=this._listeners[eventName],deleteIndex=-1,d;if(oldListeners===null||oldListeners===undefined){this._core.printDebug("Module does not listen to that event, skipping.");return}for(d=0;d<oldListeners.length;d++)if(oldListeners[d]===module){deleteIndex=d;break}deleteIndex>-1?(oldListeners.splice(deleteIndex,1),this._core.printDebug("Module unregistered successfully from event")):this._core.printDebug("Module does not listen to that event, skipping.")},getRequestBuilder:function(name){return this._core.getRequestBuilder(name)},getEventBuilder:function(name){return this._core.getEventBuilder(name)},request:function(creator,request){var creatorName=null,creatorComponent,rv=null;if(creatorName=creator.getName!==null&&creator.getName!==undefined?creator.getName():creator,creatorComponent=this.findRegisteredModuleInstance(creatorName),creatorComponent===null||creatorComponent===undefined)throw"Attempt to create request with unknown component '"+creator+"' as creator";return this._core.setObjectCreator(request,creatorName),this.printDebug("Module '"+creatorName+"' is requesting for '"+this.getObjectName(request)+"'..."),this.gatherDebugRequests&&this._pushRequestAndEventGather(creatorName+"->Sandbox: ",this.getObjectName(request)),this._debugPushRequest(creatorName,request),rv=this._core.processRequest(request),this._debugPopRequest(),rv},requestByName:function(creator,requestName,requestArgs){this.printDebug("#!#!#! --------------> requestByName "+requestName);var requestBuilder=this.getRequestBuilder(requestName),request=requestBuilder.apply(this,requestArgs||[]);return this.request(creator,request)},postMasterComponent:"postmaster",postRequestByName:function(requestName,requestArgs){var me=this,requestBuilder=me.getRequestBuilder(requestName);requestBuilder&&window.setTimeout(function(){var request=requestBuilder.apply(me,requestArgs||[]),creatorComponent=this.postMasterComponent,rv=null;me._core.setObjectCreator(request,creatorComponent);me.gatherDebugRequests&&me._pushRequestAndEventGather(creatorComponent+"->Sandbox: ",me.getObjectName(request));this.debugRequests&&me._debugPushRequest(creatorComponent,request);rv=me._core.processRequest(request);this.debugRequests&&me._debugPopRequest()},0)},_findModulesInterestedIn:function(event){var eventName=event.getName(),currentListeners=this._listeners[eventName];return currentListeners?currentListeners:[]},notifyAll:function(event,retainEvent){var eventName,modules,i,module;for(retainEvent||(eventName=event.getName(),this._core.printDebug("Sandbox received notifyall for event '"+eventName+"'")),modules=this._findModulesInterestedIn(event),retainEvent||this._core.printDebug("Found "+modules.length+" interested modules"),i=0;i<modules.length;i++){module=modules[i];retainEvent||(this._core.printDebug("Notifying module '"+module.getName()+"'."),this.gatherDebugRequests&&this._pushRequestAndEventGather("Sandbox->"+module.getName()+":",eventName));this._debugPushEvent(this.getObjectCreator(event),module,event);module.onEvent(event);this._debugPopEvent()}retainEvent||delete event},findRegisteredModuleInstance:function(name){return this._modulesByName[name]},getRequestParameter:function(name){return this._core.getRequestParameter(name)},getBrowserWindowSize:function(){var height,width,size;return jQuery.browser.opera&&window.innerHeight!==null&&window.innerHeight!==undefined&&(height=window.innerHeight),width=jQuery(window).width(),size={},size.height=jQuery(window).height(),size.width=width,this.printDebug("Got browser window size is: width: "+size.width+" px, height:"+size.height+" px."),size},getObjectName:function(obj){return this._core.getObjectName(obj)},getObjectCreator:function(obj){return this._core.getObjectCreator(obj)},setObjectCreator:function(obj,creator){return this._core.setObjectCreator(obj,creator)},copyObjectCreatorToFrom:function(objTo,objFrom){return this._core.copyObjectCreatorToFrom(objTo,objFrom)},addRequestHandler:function(requestName,handlerClsInstance){return this._core.addRequestHandler(requestName,handlerClsInstance)},removeRequestHandler:function(requestName,handlerInstance){return this._core.removeRequestHandler(requestName,handlerInstance)},_debugPushRequest:function(creator,req){if(this.debugRequests){var reqLog={from:creator,reqName:req.getName()};this.requestEventStack.push(reqLog);this.requestEventLog.push(reqLog);this.requestEventLog.length>64&&this.requestEventLog.shift()}},_debugPopRequest:function(){this.debugRequests&&this.requestEventStack.pop()},_debugPushEvent:function(creator,target,evt){if(this.debugEvents){if(this._eventLoopGuard++,this._eventLoopGuard>64)throw"Events Looped?";var evtLog={from:creator,to:target.getName(),evtName:evt.getName()};this.requestEventStack.push(evtLog);this.requestEventLog.push(evtLog);this.requestEventLog.length>64&&this.requestEventLog.shift()}},_debugPopEvent:function(){this.debugEvents&&(this._eventLoopGuard--,this.requestEventStack.pop())},_pushRequestAndEventGather:function(name,request){var module={};module.name=name;module.request=request;this.requestAndEventGather.push(module);this.requestAndEventGather.length>this.maxGatheredRequestsAndEvents&&this.requestAndEventGather.shift()},popUpSeqDiagram:function(){var seq_html='<html><head><\/head><body><div class="wsd" wsd_style="modern-blue"><pre>',seq_commands="",openedWindow;for(var x in this.requestAndEventGather)this.requestAndEventGather.hasOwnProperty(x)&&(seq_commands+=this.requestAndEventGather[x].name+this.requestAndEventGather[x].request+"\n");seq_commands!==""?(seq_html+=seq_commands+'<\/pre><\/div><script type="text/javascript" src="http://www.websequencediagrams.com/service.js"><\/script><\/body><\/html>',openedWindow=window.open(),openedWindow.document.write(seq_html),this.requestAndEventGather=[]):alert("No requests in queue")},getLocalizedProperty:function(property,lang){var ret,supportedLocales,i,language=lang||Oskari.getLang();if(property===null||property===undefined)return null;if(typeof property=="object"){if(ret=property[language],ret===null)for(supportedLocales=Oskari.getSupportedLocales(),i=0;i<supportedLocales.length;i+=1)if(ret=property[supportedLocales[i]],ret)break;return ret}return property}});Oskari.clazz.category("Oskari.mapframework.sandbox.Sandbox","key-listener-methods",{isCtrlKeyDown:function(){return this._core.isCtrlKeyDown()}});Oskari.clazz.category("Oskari.mapframework.sandbox.Sandbox","state-methods",{registerAsStateful:function(pBundleId,pInstance){this._statefuls[pBundleId]=pInstance},unregisterStateful:function(pBundleId){this._statefuls[pBundleId]=null;delete this._statefuls[pBundleId]},getStatefulComponents:function(){return this._statefuls},resetState:function(){var initialConf=Oskari.app.getConfiguration(),statefuls=this.getStatefulComponents(),initialState,bundle;for(var b in statefuls)statefuls.hasOwnProperty(b)&&(bundle=statefuls[b],initialState=initialConf[b].state,bundle.setState&&(jQuery.isEmptyObject(initialState)?bundle.setState():bundle.setState(initialState)))}});Oskari.clazz.define("Oskari.mapframework.request.map.layer.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/request/common/rearrange-selected-map-layer-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/change-map-layer-opacity-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/change-map-layer-style-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/highlight-map-layer-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/dim-map-layer-request.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"request-map-layer","Bundle-Name":"mapframework.request.map.layer.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.request.Bundle",Title:" mapframework.request.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}});Oskari.bundle_manager.installBundleClass("request-map-layer","Oskari.mapframework.request.map.layer.Bundle");Oskari.clazz.define("Oskari.mapframework.request.common.RearrangeSelectedMapLayerRequest",function(mapLayerId,toPosition){this._mapLayerId=mapLayerId;this._toPosition=toPosition},{__name:"RearrangeSelectedMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId},getToPosition:function(){return this._toPosition}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.request.common.ChangeMapLayerOpacityRequest",function(mapLayerId,opacity){this._creator=null;this._mapLayerId=mapLayerId;this._opacity=opacity},{__name:"ChangeMapLayerOpacityRequest",getName:function(){return this.__name},getOpacity:function(){return this._opacity},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.request.common.ChangeMapLayerStyleRequest",function(mapLayerId,style){this._creator=null;this._mapLayerId=mapLayerId;this._style=style},{__name:"ChangeMapLayerStyleRequest",getName:function(){return this.__name},getStyle:function(){return this._style},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.request.common.HighlightMapLayerRequest",function(mapLayerId){this._creator=null;this._mapLayerId=mapLayerId},{__name:"HighlightMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.request.common.DimMapLayerRequest",function(mapLayerId){this._creator=null;this._mapLayerId=mapLayerId},{__name:"DimMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.request.map.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/request/common/add-map-layer-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/remove-map-layer-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/map-move-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/show-map-layer-info-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/hide-map-marker-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/ctrl-key-down-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/ctrl-key-up-request.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"request-map","Bundle-Name":"mapframework.request.map.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.request.Bundle",Title:" mapframework.request.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}});Oskari.bundle_manager.installBundleClass("request-map","Oskari.mapframework.request.map.Bundle");Oskari.clazz.define("Oskari.mapframework.request.common.AddMapLayerRequest",function(mapLayerId,keepLayersOrder,isBasemap,isExternal){this._creator=null;this._mapLayerId=mapLayerId;this._keepLayersOrder=keepLayersOrder==!0;this._isExternal=isExternal==!0;this._isBasemap=isBasemap==!0},{__name:"AddMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId},getKeepLayersOrder:function(){return this._keepLayersOrder},isBasemap:function(){return this._isBasemap},isExternal:function(){return this._isExternal}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.request.common.RemoveMapLayerRequest",function(mapLayerId){this._creator=null;this._mapLayerId=mapLayerId},{__name:"RemoveMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.request.common.MapMoveRequest",function(centerX,centerY,zoom,marker,srsName){this._creator=null;this._centerX=centerX;this._centerY=centerY;this._zoom=zoom;this._marker=marker;this._projectionCode=srsName},{__name:"MapMoveRequest",getName:function(){return this.__name},getCenterX:function(){return this._centerX},getCenterY:function(){return this._centerY},getZoom:function(){return this._zoom},getMarker:function(){return this._marker},getSrsName:function(){return this._projectionCode}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.request.common.ShowMapLayerInfoRequest",function(mapLayerId){this._creator=null;this._mapLayerId=mapLayerId},{__name:"ShowMapLayerInfoRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.request.common.HideMapMarkerRequest",function(){this._creator=null},{__name:"HideMapMarkerRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.request.common.CtrlKeyDownRequest",function(){},{__name:"CtrlKeyDownRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.request.common.CtrlKeyUpRequest",function(){},{__name:"CtrlKeyUpRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.request.base.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/request/request.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"request-base","Bundle-Name":"mapframework.request.base.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.request.Bundle",Title:" mapframework.request.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}});Oskari.bundle_manager.installBundleClass("request-base","Oskari.mapframework.request.base.Bundle");Oskari.clazz.define("Oskari.mapframework.request.Request",function(){this._creator=null;throw"mapframework.request.Request should not be used";},{getName:function(){throw"Running default implementation of Request.getName(). implement your own!";},setCreator:function(creator){this._creator=creator},getCreator:function(){return this._creator}});Oskari.clazz.define("Oskari.mapframework.bundle.MapWmtsBundle",function(){},{create:function(){return Oskari.clazz.create("Oskari.mapframework.bundle.MapWmtsBundleInstance")},update:function(manager,bundle,bi,info){manager.alert("RECEIVED update notification "+info)}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwmts/plugin/wmtslayer/WmtsLayerPlugin.js"},{type:"text/javascript",src:"../../../../sources/framework/domain/AbstractLayer.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwmts/domain/WmtsLayer.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwmts/service/WmtsLayerService.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwmts/service/WmtsLayerModelBuilder.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwmts/instance.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"mapwmts","Bundle-Name":"mapwmts","Bundle-Tag":{mapframework:!0},"Bundle-Icon":{href:"icon.png"},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:"WMTS",Title:"WMTS"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","Ext"]}}});Oskari.bundle_manager.installBundleClass("mapwmts","Oskari.mapframework.bundle.MapWmtsBundle");Oskari.clazz.define("Oskari.mapframework.wmts.mapmodule.plugin.WmtsLayerPlugin",function(config){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null;this._supportedFormats={};this.config=config},{__name:"WmtsLayerPlugin",getName:function(){return this.pluginName},getMap:function(){return this._map},getMapModule:function(){return this.mapModule},setMapModule:function(mapModule){this.mapModule=mapModule;this.pluginName=mapModule.getName()+this.__name},register:function(){this.getMapModule().setLayerPlugin("WmtsLayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("WmtsLayer",null)},init:function(){var sandboxName=(this.config?this.config.sandbox:null)||"sandbox",sbx=Oskari.getSandbox(sandboxName),mapLayerService=sbx.getService("Oskari.mapframework.service.MapLayerService"),layerModelBuilder;mapLayerService&&(mapLayerService.registerLayerModel("wmtslayer","Oskari.mapframework.wmts.domain.WmtsLayer"),layerModelBuilder=Oskari.clazz.create("Oskari.mapframework.wmts.service.WmtsLayerModelBuilder"),mapLayerService.registerLayerModelBuilder("wmtslayer",layerModelBuilder))},startPlugin:function(sandbox){this._sandbox=sandbox;this._map=this.getMapModule().getMap();sandbox.register(this);for(var p in this.eventHandlers)this.eventHandlers.hasOwnProperty(p)&&sandbox.registerForEventByName(this,p)},stopPlugin:function(sandbox){for(var p in this.eventHandlers)this.eventHandlers.hasOwnProperty(p)&&sandbox.unregisterFromEventByName(this,p);sandbox.unregister(this);this._map=null;this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{AfterMapLayerRemoveEvent:function(event){this.afterMapLayerRemoveEvent(event)},AfterChangeMapLayerOpacityEvent:function(event){this.afterChangeMapLayerOpacityEvent(event)},AfterChangeMapLayerStyleEvent:function(event){this.afterChangeMapLayerStyleEvent(event)}},onEvent:function(event){return this.eventHandlers[event.getName()].apply(this,[event])},preselectLayers:function(layers){for(var sandbox=this._sandbox,layer,layerId,i=0;i<layers.length;i++)layer=layers[i],layerId=layer.getId(),layer.isLayerOfType("WMTS")&&(sandbox.printDebug("preselecting "+layerId),this.addMapLayerToMap(layer,!0,layer.isBaseLayer()))},addMapLayerToMap:function(layer){var matrixSet,resolutions,serverResolutions,n,scaleDenom,res,wmtsLayerConfig,wmtsLayer;if(layer.isLayerOfType("WMTS")){var me=this,map=me.getMap(),matrixIds=layer.getWmtsMatrixSet().matrixIds,layerDef=layer.getWmtsLayerDef(),layerName=layer.isBaseLayer()||layer.isGroupLayer()?"basemap_"+layer.getId():"layer_"+layer.getId();var sandbox=this._sandbox,reqEnc="KVP",wmtsUrl=layerDef.resourceUrl?layerDef.resourceUrl.tile?layerDef.resourceUrl.tile.template:undefined:undefined;for(wmtsUrl?reqEnc="REST":wmtsUrl=layer.getWmtsUrls()[0],matrixSet=layer.getWmtsMatrixSet(),matrixIds=[],resolutions=[],serverResolutions=[],n=0;n<matrixSet.matrixIds.length;n++)matrixIds.push(matrixSet.matrixIds[n]),scaleDenom=matrixSet.matrixIds[n].scaleDenominator,res=scaleDenom/90.71446714322*OpenLayers.METERS_PER_INCH,resolutions.push(res),serverResolutions.push(res);wmtsLayerConfig={name:layerName.split(".").join(""),url:wmtsUrl,requestEncoding:reqEnc,layer:layer.getWmtsName(),matrixSet:matrixSet.identifier,format:"image/png",style:layer.getCurrentStyle().getName(),transparent:!0,matrixIds:matrixIds,isBaseLayer:layer.isBaseLayer(),buffer:0,serverResolutions:serverResolutions,visibility:layer.isInScale(sandbox.getMap().getScale()),layerDef:layerDef};sandbox.printDebug("[WmtsLayerPlugin] creating WMTS Layer "+matrixSet.identifier+" / "+wmtsLayerConfig.id+"/"+wmtsLayerConfig.layer+"/"+wmtsLayerConfig.url);wmtsLayer=new OpenLayers.Layer.WMTS(wmtsLayerConfig);wmtsLayer.opacity=layer.getOpacity()/100;sandbox.printDebug("[WmtsLayerPlugin] created WMTS layer "+wmtsLayer);map.addLayers([wmtsLayer])}},getOLMapLayers:function(layer){return layer.isLayerOfType("WMTS")?layer.isBaseLayer()||layer.isGroupLayer()?this._map.getLayersByName("basemap_"+layer.getId()):this._map.getLayersByName("layer_"+layer.getId()):null},afterMapLayerRemoveEvent:function(event){var layer=event.getMapLayer();this.removeMapLayerFromMap(layer)},removeMapLayerFromMap:function(layer){var oLayer=this.getOLMapLayers(layer);oLayer&&oLayer[0]&&oLayer[0].destroy()},afterChangeMapLayerOpacityEvent:function(event){var layer=event.getMapLayer(),oLayer=this.getOLMapLayers(layer),newOpacity=layer.getOpacity()/100;oLayer&&oLayer[0]&&oLayer[0].setOpacity(newOpacity)},afterChangeMapLayerStyleEvent:function(event){var layer=event.getMapLayer(),oLayer=this.getOLMapLayers(layer),newStyle=layer.getCurrentStyle().getName();oLayer&&oLayer[0]&&oLayer[0].mergeNewParams({styles:newStyle})}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.wmts.domain.WmtsLayer",function(){this._WmtsName=null;this._WmtsMatrixSet=null;this._WmtsLayerDef=null;this._WmtsUrls=[];this._layerType="WMTS"},{setWmtsName:function(WmtsName){this._WmtsName=WmtsName},getWmtsName:function(){return this._WmtsName},setWmtsMatrixSet:function(matrixSet){this._WmtsMatrixSet=matrixSet},getWmtsMatrixSet:function(){return this._WmtsMatrixSet},setWmtsLayerDef:function(def){this._WmtsLayerDef=def},getWmtsLayerDef:function(){return this._WmtsLayerDef},addWmtsUrl:function(WmtsUrl){this._WmtsUrls.push(WmtsUrl)},getWmtsUrls:function(){return this._WmtsUrls}},{extend:["Oskari.mapframework.domain.AbstractLayer"]});Oskari.clazz.define("Oskari.mapframework.wmts.service.WMTSLayerService",function(mapLayerService){this.mapLayerService=mapLayerService;this.capabilities={}},{setCapabilities:function(name,caps){this.capabilities[name]=caps},getCapabilities:function(name){return this.capabilities[name]},readWMTSCapabilites:function(wmtsName,capsPath,matrixSet,cb,conf){var me=this,format=new OpenLayers.Format.WMTSCapabilities,httpGetConf=OpenLayers.Util.extend({url:capsPath,params:{SERVICE:"WMTS",VERSION:"1.0.0",REQUEST:"GetCapabilities"},success:function(request){var doc=request.responseXML,caps,layersCreated;doc&&doc.documentElement||(doc=request.responseText);caps=format.read(doc);me.setCapabilities(wmtsName,caps);layersCreated=me.parseCapabilitiesToLayers(wmtsName,caps,matrixSet);cb&&cb.apply(this,[layersCreated,caps])},failure:function(){alert("Trouble getting capabilities doc");OpenLayers.Console.error.apply(OpenLayers.Console,arguments)}},conf||{});OpenLayers.Request.GET(httpGetConf)},parseCapabilitiesToLayers:function(wmtsName,caps,matrixSet){for(var me=this,mapLayerService=this.mapLayerService,getTileUrl=caps.operationsMetadata.GetTile.dcp.http.getArray?caps.operationsMetadata.GetTile.dcp.http.getArray:caps.operationsMetadata.GetTile.dcp.http.get,capsLayers=caps.contents.layers,contents=caps.contents,ms=contents.tileMatrixSets[matrixSet],layersCreated=[],spec,mapLayerId,mapLayerName,mapLayerJson,layer,styleBuilder,styleSpec,style,i,ii,n=0;n<capsLayers.length;n++){for(spec=capsLayers[n],mapLayerId=spec.identifier,mapLayerName=spec.identifier,mapLayerJson={wmtsName:mapLayerId,descriptionLink:"",orgName:wmtsName,type:"wmtslayer",legendImage:"",formats:{value:"text/html"},isQueryable:!0,style:"",dataUrl:"",name:mapLayerId,opacity:100,inspire:wmtsName,maxScale:1},layer=Oskari.clazz.create("Oskari.mapframework.wmts.domain.WmtsLayer"),layer.setAsNormalLayer(),layer.setId(mapLayerId.split(".").join("_")),layer.setName(mapLayerJson.name),layer.setWmtsName(mapLayerJson.wmtsName),layer.setOpacity(mapLayerJson.opacity),layer.setMaxScale(mapLayerJson.maxScale),layer.setMinScale(mapLayerJson.minScale),layer.setDescription(mapLayerJson.info),layer.setDataUrl(mapLayerJson.dataUrl),layer.setOrganizationName(mapLayerJson.orgName),layer.setInspireName(mapLayerJson.inspire),layer.setWmtsMatrixSet(ms),layer.setWmtsLayerDef(spec),layer.setVisible(!0),layer.addWmtsUrl(getTileUrl),styleBuilder=Oskari.clazz.builder("Oskari.mapframework.domain.Style"),i=0,ii=spec.styles.length;i<ii;++i)if(styleSpec=spec.styles[i],style=styleBuilder(),style.setName(styleSpec.identifier),style.setTitle(styleSpec.identifier),layer.addStyle(style),styleSpec.isDefault){layer.selectStyle(styleSpec.identifier);break}mapLayerService.addLayer(layer,!1);layersCreated.push(layer)}return layersCreated}});Oskari.clazz.define("Oskari.mapframework.wmts.service.WmtsLayerModelBuilder",function(){},{parseLayerData:function(layer,mapLayerJson){var i,ii,style,wmsUrls,styleBuilder,styleSpec,tileMatrixSetId,tileMatrixSet,wmtsLayerName,wmtsLayersArr,n;if(layer.setWmtsName(mapLayerJson.wmsName),mapLayerJson.wmsUrl)for(wmsUrls=mapLayerJson.wmsUrl.split(","),i=0;i<wmsUrls.length;i++)layer.addWmtsUrl(wmsUrls[i]);for(styleBuilder=Oskari.clazz.builder("Oskari.mapframework.domain.Style"),i=0,ii=mapLayerJson.styles.length;i<ii;++i)if(styleSpec=mapLayerJson.styles[i],style=styleBuilder(),style.setName(styleSpec.identifier),style.setTitle(styleSpec.identifier),layer.addStyle(style),styleSpec.isDefault){layer.selectStyle(styleSpec.identifier);break}if(layer.setFeatureInfoEnabled(!0),mapLayerJson.tileMatrixSetData&&mapLayerJson.tileLayerData)layer.setWmtsMatrixSet(mapLayerJson.tileMatrixSetData),layer.setWmtsLayerDef(mapLayerJson.tileLayerData);else if(mapLayerJson.tileMatrixSetData&&mapLayerJson.tileMatrixSetId)for(tileMatrixSetId=mapLayerJson.tileMatrixSetId,mapLayerJson.tileMatrixSetData.contents&&mapLayerJson.tileMatrixSetData.contents.tileMatrixSets&&(tileMatrixSet=mapLayerJson.tileMatrixSetData.contents.tileMatrixSets[tileMatrixSetId],layer.setWmtsMatrixSet(tileMatrixSet)),wmtsLayerName=layer.getWmtsName(),wmtsLayersArr=mapLayerJson.tileMatrixSetData.contents.layers,n=0;n<wmtsLayersArr.length;n++)if(wmtsLayersArr[n].identifier===wmtsLayerName){layer.setWmtsLayerDef(wmtsLayersArr[n]);break}}});Oskari.clazz.define("Oskari.mapframework.bundle.MapWmtsBundleInstance",function(){this.name="MapWmts";this.mediator=null;this.sandbox=null;this.service=null;this.ui=null},{start:function(){var mapLayerService,layerModelBuilder,service;if(this.mediator.getState()!=="started"){var me=this,conf=me.conf,sandboxName=(conf?conf.sandbox:null)||"sandbox",sandbox=Oskari.getSandbox(sandboxName);return this.sandbox=sandbox,mapLayerService=sandbox.getService("Oskari.mapframework.service.MapLayerService"),mapLayerService.registerLayerModel("wmtslayer","Oskari.mapframework.wmts.domain.WmtsLayer"),layerModelBuilder=Oskari.clazz.create("Oskari.mapframework.wmts.service.WmtsLayerModelBuilder"),mapLayerService.registerLayerModelBuilder("wmtslayer",layerModelBuilder),service=Oskari.clazz.create("Oskari.mapframework.wmts.service.WMTSLayerService",mapLayerService),this.service=service,this.mediator.setState("started"),this}},update:function(manager,b,bi,info){manager.alert("RECEIVED update notification @BUNDLE_INSTANCE: "+info)},stop:function(){return this.mediator.setState("stopped"),this},getName:function(){return this.__name},__name:"Oskari.mapframework.bundle.MapWmtsBundleInstance"},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.bundle.extension.Extension"]});Oskari.clazz.define("Oskari.mapframework.core.base.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/core/core.js"},{type:"text/javascript",src:"../../../../sources/framework/core/core-enhancement-methods.js"},{type:"text/javascript",src:"../../../../sources/framework/core/core-key-listener-methods.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"core-base","Bundle-Name":"mapframework.core.base.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.core.Bundle",Title:" mapframework.core.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}});Oskari.bundle_manager.installBundleClass("core-base","Oskari.mapframework.core.base.Bundle");Oskari.clazz.define("Oskari.mapframework.core.Core",function(){this._selectedLayers=[];this._mapLayersHighlighted=[];this._map=null;this._sandbox=Oskari.clazz.create("Oskari.mapframework.sandbox.Sandbox",this);Oskari.$("sandbox")||Oskari.$("sandbox",this._sandbox);this._services=[];this._servicesByQName={};this._debug=!1;this._ctrlKeyDown=!1;this._allowMultipleHighlightLayers=!1;this._availableRequestsByName={};this._availableEventsByName={};this.externalHandlerCls={}},{init:function(services,enhancements){this.printDebug("Initializing core...");var sandbox=this._sandbox,s;if(this._services=services,services)for(s=0;s<services.length;s++)this.registerService(services[s]);this.printDebug("Sandbox ready, building up domain...");this._map=Oskari.clazz.create("Oskari.mapframework.domain.Map");this.enhancements=enhancements;this._doEnhancements(this.enhancements);this.printDebug("Modules started. Core ready.")},dispatch:function(event){this._sandbox.notifyAll(event)},defaultRequestHandlers:{AddMapLayerRequest:function(request){return this._handleAddMapLayerRequest(request),!0},RemoveMapLayerRequest:function(request){return this._handleRemoveMapLayerRequest(request),!0},ShowMapLayerInfoRequest:function(request){return this._handleShowMapLayerInfoRequest(request),!0},RearrangeSelectedMapLayerRequest:function(request){return this._handleRearrangeSelectedMapLayerRequest(request),!0},ChangeMapLayerOpacityRequest:function(request){return this._handleChangeMapLayerOpacityRequest(request),!0},ChangeMapLayerStyleRequest:function(request){return this._handleChangeMapLayerStyleRequest(request),!0},HighlightMapLayerRequest:function(request){return this._handleHighlightMapLayerRequest(request),!0},HighlightWFSFeatureRequest:function(request){return this.handleHighlightWFSFeatureRequest(request),!0},HideMapMarkerRequest:function(request){return this._handleHideMapMarkerRequest(request),!0},DimMapLayerRequest:function(request){return this._handleDimMapLayerRequest(request.getMapLayerId()),!0},CtrlKeyDownRequest:function(){return this._handleCtrlKeyDownRequest(),!0},CtrlKeyUpRequest:function(){return this._handleCtrlKeyUpRequest(),!0},__default:function(request){return this.printWarn("!!!"),this.printWarn("  There is no handler for"),this.printWarn("  '"+request.getName()+"'"),!1}},processRequest:function(request){var requestName=request.getName(),handlerFunc=this.defaultRequestHandlers[requestName],rv,handlerClsInstance;return handlerFunc?rv=handlerFunc.apply(this,[request]):(handlerClsInstance=this.externalHandlerCls[requestName],handlerClsInstance?rv=handlerClsInstance.handleRequest(this,request):(handlerFunc=this.defaultRequestHandlers.__default,rv=handlerFunc.apply(this,[request]))),delete request,rv},addRequestHandler:function(requestName,handlerClsInstance){this.externalHandlerCls[requestName]=handlerClsInstance},removeRequestHandler:function(requestName,handlerInstance){this.externalHandlerCls[requestName]===handlerInstance&&(this.externalHandlerCls[requestName]=null)},_getQNameForRequest:function(name){var qname=this._availableRequestsByName[name],p,allRequests,pdefsp,reqname;if(!qname){this.printDebug("#!#!# ! Updating request metadata...");allRequests=Oskari.clazz.protocol("Oskari.mapframework.request.Request");for(p in allRequests)allRequests.hasOwnProperty(p)&&(pdefsp=allRequests[p],reqname=pdefsp._class.prototype.getName(),this._availableRequestsByName[reqname]=p);this.printDebug("#!#!# ! Finished Updating request metadata...");qname=this._availableRequestsByName[name]}return qname},getRequestBuilder:function(requestName){var qname=this._getQNameForRequest(requestName);return qname?Oskari.clazz.builder(qname):undefined},_getQNameForEvent:function(name){var qname=this._availableEventsByName[name],allRequests,p,pdefsp,reqname;if(!qname){this.printDebug("#!#!# ! Updating event metadata...");allRequests=Oskari.clazz.protocol("Oskari.mapframework.event.Event");for(p in allRequests)allRequests.hasOwnProperty(p)&&(pdefsp=allRequests[p],reqname=pdefsp._class.prototype.getName(),this._availableEventsByName[reqname]=p);this.printDebug("#!#!# ! Finished Updating event metadata...");qname=this._availableEventsByName[name]}return qname},getEventBuilder:function(eventName){var qname=this._getQNameForEvent(eventName);return qname?Oskari.clazz.builder(qname):undefined},disableDebug:function(){this._debug=!1},enableDebug:function(){this._debug=!0},printDebug:function(text){this._debug&&window.console!==null&&window.console!==undefined&&(window.console.debug!==null&&window.console.debug!==undefined?console.debug(text):window.console.log!==null&&window.console.log!==undefined&&console.log(text))},printWarn:function(text){window.console!==null&&window.console!==undefined&&console.warn(text)},registerService:function(service){this._servicesByQName[service.getQName()]=service},getService:function(type){return this._servicesByQName[type]},getMap:function(){return this._map},getSandbox:function(){return this._sandbox},getRequestParameter:function(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regexS="[\\?&]"+name+"=([^&#]*)",regex=new RegExp(regexS),results=regex.exec(window.location.href);return results===null||results===undefined?null:results[1]},getObjectName:function(obj){return obj.__name},getObjectCreator:function(obj){return obj._creator},setObjectCreator:function(obj,creator){obj._creator=creator},copyObjectCreatorToFrom:function(objTo,objFrom){objTo._creator=objFrom._creator}});Oskari.clazz.category("Oskari.mapframework.core.Core","enhancement-methods",{_doEnhancements:function(enhancements){for(var i=0;i<enhancements.length;i++)enhancements[i].enhance(this)}});Oskari.clazz.category("Oskari.mapframework.core.Core","feature-key-listener-methods",{_handleCtrlKeyDownRequest:function(){this._ctrlKeyDown=!0},_handleCtrlKeyUpRequest:function(){this._ctrlKeyDown=!1},isCtrlKeyDown:function(){return this._ctrlKeyDown}});Oskari.clazz.define("Oskari.mapframework.bundle.mapfull.MapFullBundle",function(){},{create:function(){return Oskari.clazz.create("Oskari.mapframework.bundle.mapfull.MapFullBundleInstance")},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapfull/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapfull/enhancement/start-map-with-link-enhancement.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapfull/request/MapResizeEnabledRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapfull/request/MapResizeEnabledRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapfull/request/MapWindowFullScreenRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapfull/request/MapWindowFullScreenRequestHandler.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapfull/css/style.css"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/mapfull/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/mapfull/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/mapfull/locale/en.js"}]},bundle:{manifest:{"Bundle-Identifier":"mapfull","Bundle-Name":"mapframework.mapfull.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:"mapframework.mapfull.Bundle",Title:"mapframework.mapfull.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}});Oskari.bundle_manager.installBundleClass("mapfull","Oskari.mapframework.bundle.mapfull.MapFullBundle");Oskari.clazz.define("Oskari.mapframework.bundle.mapfull.MapFullBundleInstance",function(){this.__name="mapfull";this.map=null;this.core=null;this.sandbox=null;this.mapmodule=null;this.state;this.mapDivId="mapdiv";this.contentMapDivId="contentMap"},{getName:function(){return this.__name},getMapModule:function(){return this.mapmodule},getSandbox:function(){return this.sandbox},_createUi:function(){var me=this,module=Oskari.clazz.create("Oskari.mapframework.ui.module.common.MapModule","Main",me.conf.imageLocation,me.conf.mapOptions),map,adjustMapSize,resizeTimer,resizeDelayed,plugins,i;if(me.mapmodule=module,map=me.sandbox.register(module),me.conf.size?(jQuery("#"+me.mapDivId).width(me.conf.size.width),jQuery("#"+me.mapDivId).height(me.conf.size.height)):(adjustMapSize=function(){var toolbar;if(me.resizeEnabled===null||me.resizeEnabled===undefined||me.resizeEnabled){var contentMap=jQuery("#"+me.contentMapDivId),mapDiv=jQuery("#"+me.mapDivId),windowHeight=jQuery(window).height();contentMap.height(windowHeight);toolbar=contentMap.find(".oskariui-menutoolbar");toolbar.length>0&&toolbar.is(":visible")?mapDiv.height(windowHeight-toolbar.height()):mapDiv.height(windowHeight);module.updateSize()}},jQuery(window).resize(function(){clearTimeout(resizeTimer);resizeTimer=setTimeout(adjustMapSize,100)}),adjustMapSize(),resizeDelayed=window.setTimeout(adjustMapSize,1e3)),module.start(me.sandbox),me.nomaprender||map.render(me.mapDivId),me.conf.plugins)for(plugins=this.conf.plugins,i=0;i<plugins.length;i++)try{plugins[i].instance=Oskari.clazz.create(plugins[i].id,plugins[i].config);module.registerPlugin(plugins[i].instance);module.startPlugin(plugins[i].instance)}catch(e){me.sandbox.printWarn("Unable to start plugin: "+plugins[i].id)}me.map=map},start:function(){var me,conf,userInterfaceLanguage,core,sandbox,sandboxName,services,enhancements,mapLayerService,initialLayers,i,mapLayer,skipLocation,plugin;if(Proj4js.defs={"EPSG:3067":"+proj=utm +zone=35 +ellps=GRS80 +units=m +no_defs","EPSG:4326":"+title=WGS 84 +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"},me=this,conf=me.conf,me.conf.projectionDefs&&(Proj4js.defs=me.conf.projectionDefs),userInterfaceLanguage=Oskari.getLang(),core=Oskari.clazz.create("Oskari.mapframework.core.Core"),me.core=core,sandbox=core.getSandbox(),me.sandbox=sandbox,sandboxName=(conf?conf.sandbox:null)||"sandbox",Oskari.setSandbox(sandboxName,sandbox),conf&&(conf.mapElement&&(me.mapDivId=conf.mapElement),conf.mapContainer&&(me.contentMapDivId=conf.mapContainer)),sandbox.setUser(conf.user),sandbox.setAjaxUrl(conf.globalMapAjaxUrl),services=me._createServices(conf),enhancements=[],enhancements.push(Oskari.clazz.create("Oskari.mapframework.enhancement.mapfull.StartMapWithLinkEnhancement")),core.init(services,enhancements),me._createUi(),mapLayerService=sandbox.getService("Oskari.mapframework.service.MapLayerService"),initialLayers=conf.layers,initialLayers)for(i=0;i<initialLayers.length;i++)mapLayer=mapLayerService.createMapLayer(initialLayers[i]),mapLayerService.addLayer(mapLayer,!0);sandbox.registerAsStateful(me.mediator.bundleId,this);skipLocation=!1;me.mapmodule.isPluginActivated("GeoLocationPlugin")&&(plugin=me.mapmodule.getPluginInstance("GeoLocationPlugin"),skipLocation=plugin.hasSetLocation());me.setState(me.state,skipLocation);me.mapResizeEnabledRequestHandler=Oskari.clazz.create("Oskari.mapframework.bundle.mapfull.request.MapResizeEnabledRequestHandler",me);me.mapWindowFullScreenRequestHandler=Oskari.clazz.create("Oskari.mapframework.bundle.mapfull.request.MapWindowFullScreenRequestHandler",me);sandbox.addRequestHandler("MapFull.MapResizeEnabledRequest",me.mapResizeEnabledRequestHandler);sandbox.addRequestHandler("MapFull.MapWindowFullScreenRequest",me.mapWindowFullScreenRequestHandler)},_teardownState:function(module){for(var selectedLayers=this.sandbox.findAllSelectedMapLayers(),rbRemove=this.sandbox.getRequestBuilder("RemoveMapLayerRequest"),i=0;i<selectedLayers.length;i++)this.sandbox.request(module.getName(),rbRemove(selectedLayers[i].getId()))},_createServices:function(conf){var me=this,services=[],mapLayerService=Oskari.clazz.create("Oskari.mapframework.service.MapLayerService",conf.globalMapAjaxUrl+"action_route=GetMapLayers&lang="+Oskari.getLang(),me.core.getSandbox());return services.push(mapLayerService),conf.disableDevelopmentMode=="true"&&me.core.disableDebug(),services},update:function(){},stop:function(){this.sandbox.unregisterStateful(this.mediator.bundleId);alert("Stopped!")},setState:function(state,ignoreLocation){var me=this,mapmodule=me.sandbox.findRegisteredModuleInstance("MainMapModule"),rbAdd,rbOpacity,visibilityRequestBuilder,styleReqBuilder,len,i,layer;if(me._teardownState(mapmodule),state.east&&ignoreLocation!==!0&&me.sandbox.getMap().moveTo(state.east,state.north,state.zoom),me.sandbox.syncMapState(!0),state.selectedLayers)for(rbAdd=me.sandbox.getRequestBuilder("AddMapLayerRequest"),rbOpacity=me.sandbox.getRequestBuilder("ChangeMapLayerOpacityRequest"),visibilityRequestBuilder=me.sandbox.getRequestBuilder("MapModulePlugin.MapLayerVisibilityRequest"),styleReqBuilder=me.sandbox.getRequestBuilder("ChangeMapLayerStyleRequest"),len=state.selectedLayers.length,i=0;i<len;++i)layer=state.selectedLayers[i],me.sandbox.request(mapmodule.getName(),rbAdd(layer.id,!0)),me.sandbox.request(mapmodule.getName(),visibilityRequestBuilder(layer.id,layer.hidden!==!0)),layer.style&&me.sandbox.request(mapmodule.getName(),styleReqBuilder(layer.id,layer.style)),layer.opacity&&me.sandbox.request(mapmodule.getName(),rbOpacity(layer.id,layer.opacity))},getState:function(){for(var map=this.sandbox.getMap(),selectedLayers=this.sandbox.findAllSelectedMapLayers(),zoom=map.getZoom(),lat=map.getX(),lon=map.getY(),layer,layerJson,state={north:lon,east:lat,zoom:map.getZoom(),srs:map.getSrsName(),selectedLayers:[]},i=0;i<selectedLayers.length;i++)layer=selectedLayers[i],layerJson={id:layer.getId(),opacity:layer.getOpacity()},layer.isVisible()||(layerJson.hidden=!0),layer.getCurrentStyle&&layer.getCurrentStyle()&&layer.getCurrentStyle().getName()&&layer.getCurrentStyle().getName()!=="!default!"&&(layerJson.style=layer.getCurrentStyle().getName()),state.selectedLayers.push(layerJson);return state},getStateParameters:function(){var state=this.getState(),link="zoomLevel="+state.zoom+"&coord="+state.east+"_"+state.north+"&mapLayers=",selectedLayers=state.selectedLayers,layers="",layer=null,i=0,ilen=0,key;if(this.conf&&this.conf.link)for(key in this.conf.link)link=key+"="+this.conf.link[key]+"&"+link;for(i=0,ilen=selectedLayers.length;i<ilen;i++)layer=selectedLayers[i],layer.hidden||(layers!==""&&(layers+=","),layers+=layer.id+"+"+layer.opacity,layers+=layer.style?"+"+layer.style:"+");return link+layers},toggleFullScreen:function(){jQuery("#"+this.contentMapDivId).toggleClass("oskari-map-window-fullscreen");this.mapmodule.updateSize()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.userinterface.Stateful"]});Oskari.clazz.define("Oskari.mapframework.enhancement.mapfull.StartMapWithLinkEnhancement",function(){},{enhance:function(core){function checkBoolean(bln){return bln===!0||bln==="true"}var splittedCoord,longitude,latitude;core.printDebug("Checking if map is started with link...");var coord=core.getRequestParameter("coord"),zoomLevel=core.getRequestParameter("zoomLevel"),mapLayers=core.getRequestParameter("mapLayers"),markerVisible=core.getRequestParameter("showMarker"),markerVisibleOption2=core.getRequestParameter("isCenterMarker"),keepLayersOrder=core.getRequestParameter("keepLayersOrder");if(keepLayersOrder===null&&(keepLayersOrder=!0),core.getMap().setMarkerVisible(checkBoolean(markerVisible)||checkBoolean(markerVisibleOption2)),coord!==null&&zoomLevel!==null){if(splittedCoord=coord.indexOf("_")>=0?coord.split("_"):coord.split("%20"),longitude=splittedCoord[0],latitude=splittedCoord[1],longitude===null||latitude===null){core.printDebug("Could not parse link location. Skipping.");return}core.printDebug("This is startup by link, moving map...");core.getMap().moveTo(longitude,latitude,zoomLevel)}}},{protocol:["Oskari.mapframework.enhancement.Enhancement"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapfull.request.MapResizeEnabledRequest",function(resizeEnabled){this._creator=null;this._resizeEnabled=resizeEnabled},{__name:"MapFull.MapResizeEnabledRequest",getName:function(){return this.__name},getResizeEnabled:function(){return this._resizeEnabled}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapfull.request.MapResizeEnabledRequestHandler",function(mapfull){this.mapfull=mapfull},{handleRequest:function(core,request){this.mapfull.resizeEnabled=request.getResizeEnabled()}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapfull.request.MapWindowFullScreenRequest",function(){this._creator=null},{__name:"MapFull.MapWindowFullScreenRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapfull.request.MapWindowFullScreenRequestHandler",function(mapfull){this.mapfull=mapfull},{handleRequest:function(){this.mapfull.toggleFullScreen()}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.registerLocalization({lang:"fi",key:"Generic",value:{"default-style":"Oletustyyli"}});Oskari.registerLocalization({lang:"sv",key:"Generic",value:{"default-style":"Frvald utseende"}});Oskari.registerLocalization({lang:"en",key:"Generic",value:{"default-style":"Default style"}});Oskari.clazz.define("Oskari.mapframework.event.map.layer.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/event/common/after-rearrange-selected-map-layer-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-change-map-layer-opacity-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-change-map-layer-style-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-highlight-map-layer-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-dim-map-layer-event.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"event-map-layer","Bundle-Name":"mapframework.event.map.layer.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.event.Bundle",Title:" mapframework.event.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}});Oskari.bundle_manager.installBundleClass("event-map-layer","Oskari.mapframework.event.map.layer.Bundle");Oskari.clazz.define("Oskari.mapframework.event.common.AfterRearrangeSelectedMapLayerEvent",function(movedMapLayer,fromPosition,toPosition){this._creator=null;this._movedMapLayer=movedMapLayer;this._fromPosition=fromPosition;this._toPosition=toPosition},{__name:"AfterRearrangeSelectedMapLayerEvent",getName:function(){return this.__name},getMovedMapLayer:function(){return this._movedMapLayer},getFromPosition:function(){return this._fromPosition},getToPosition:function(){return this._toPosition}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.AfterChangeMapLayerOpacityEvent",function(mapLayer){this._mapLayer=mapLayer},{__name:"AfterChangeMapLayerOpacityEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.AfterChangeMapLayerStyleEvent",function(mapLayer){this._mapLayer=mapLayer},{__name:"AfterChangeMapLayerStyleEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.AfterHighlightMapLayerEvent",function(mapLayer){this._creator=null;this._mapLayer=mapLayer},{__name:"AfterHighlightMapLayerEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.AfterDimMapLayerEvent",function(mapLayer){this._creator=null;this._mapLayer=mapLayer},{__name:"AfterDimMapLayerEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.map.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/event/common/features-available-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-map-layer-add-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-map-layer-remove-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-map-move-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-map-move-start-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-show-map-layer-info-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-hide-map-marker-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/mouse-hover-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/MapLayerEvent.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"event-map","Bundle-Name":"mapframework.event.map.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.event.Bundle",Title:" mapframework.event.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}});Oskari.bundle_manager.installBundleClass("event-map","Oskari.mapframework.event.map.Bundle");Oskari.clazz.define("Oskari.mapframework.event.common.FeaturesAvailableEvent",function(mapLayer,features,mimeType,projCode,op){this._creator=null;this._features=features;this._op=op;this._mapLayer=mapLayer;this._mimeType=mimeType;this._projCode=projCode},{__name:"FeaturesAvailableEvent",getName:function(){return this.__name},getFeatures:function(){return this._features},getOp:function(){return this._op},getMapLayer:function(){return this._mapLayer},getMimeType:function(){return this._mimeType},getProjCode:function(){return this._projCode}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.AfterMapLayerAddEvent",function(mapLayer,keepLayersOrder,isBasemap){this._creator=null;this._mapLayer=mapLayer;this._keepLayersOrder=keepLayersOrder;this._isBasemap=isBasemap?isBasemap:!1},{__name:"AfterMapLayerAddEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer},getKeepLayersOrder:function(){return this._keepLayersOrder},isBasemap:function(){return this._isBasemap}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.AfterMapLayerRemoveEvent",function(mapLayer){this._creator=null;this._mapLayer=mapLayer},{__name:"AfterMapLayerRemoveEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.AfterMapMoveEvent",function(centerX,centerY,zoom,marker,scale){this._creator=null;this._centerX=centerX;this._centerY=centerY;this._zoom=zoom;this._marker=marker;this._scale=scale},{__name:"AfterMapMoveEvent",getName:function(){return this.__name},getCreator:function(){return this._creator},getCenterX:function(){return this._centerX},getCenterY:function(){return this._centerY},getZoom:function(){return this._zoom},getMarker:function(){return this._marker},getScale:function(){return this._scale}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.MapMoveStartEvent",function(x,y){this._creator=null;this._x=x;this._y=y},{__name:"MapMoveStartEvent",getName:function(){return this.__name},getX:function(){return this._x},getY:function(){return this._y}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.AfterShowMapLayerInfoEvent",function(mapLayer){this._creator=null;this._mapLayer=mapLayer},{__name:"AfterShowMapLayerInfoEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.AfterHideMapMarkerEvent",function(){},{__name:"AfterHideMapMarkerEvent",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.MouseHoverEvent",function(lon,lat,isPaused){this._creator=null;this._lon=lon;this._lat=lat;this._paused=isPaused},{__name:"MouseHoverEvent",getName:function(){return this.__name},getLon:function(){return this._lon},getLat:function(){return this._lat},set:function(lon,lat,isPaused,pageX,pageY){this._lon=lon;this._lat=lat;this._paused=isPaused;this._pageX=pageX;this._pageY=pageY},isPaused:function(){return this._paused},getPageX:function(){return this._pageX},getPageY:function(){return this._pageY}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.common.MapLayerEvent",function(layerId,operation){if(this._creator=null,this._layerId=layerId,!this.operations[operation])throw"Unknown operation '"+operation+"'";this._operation=operation},{__name:"MapLayerEvent",getName:function(){return this.__name},getLayerId:function(){return this._layerId},getOperation:function(){return this._operation},operations:{add:"add",remove:"remove",sticky:"sticky",update:"update"}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.event.base.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/event/event.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"event-base","Bundle-Name":"mapframework.event.base.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.event.Bundle",Title:" mapframework.event.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}});Oskari.bundle_manager.installBundleClass("event-base","Oskari.mapframework.event.base.Bundle");Oskari.clazz.define("Oskari.mapframework.event.Event",function(){throw"mapframework.event.Event should not be used";},{getName:function(){throw"Running default implementation of Event.getName(). implement your own!";},setCreator:function(creator){this._creator=creator},getCreator:function(){return this._creator}});Oskari.clazz.define("Oskari.mapframework.domain.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/domain/AbstractLayer.js"},{type:"text/javascript",src:"../../../../sources/framework/domain/wmslayer.js"},{type:"text/javascript",src:"../../../../sources/framework/domain/vectorlayer.js"},{type:"text/javascript",src:"../../../../sources/framework/domain/map.js"},{type:"text/javascript",src:"../../../../sources/framework/domain/style.js"},{type:"text/javascript",src:"../../../../sources/framework/domain/tool.js"},{type:"text/javascript",src:"../../../../sources/framework/domain/user.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"domain","Bundle-Name":"mapframework.domain.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.domain.Bundle",Title:" mapframework.domain.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}});Oskari.bundle_manager.installBundleClass("domain","Oskari.mapframework.domain.Bundle");Oskari.clazz.define("Oskari.mapframework.domain.AbstractLayer",function(params,options){var me=this;me._id=undefined;me._name=null;me._description=null;me._type=null;me._layerType="";me._params=params||{};me._options=options||{};me._metaType=null;me._maxScale=null;me._minScale=null;me._visible=null;me._opacity=100;me._isSticky=null;me._inspireName=null;me._organizationName=null;me._dataUrl=null;me._orderNumber=null;me._subLayers=[];me._styles=[];me._currentStyle=null;me._legendImage=null;me._featureInfoEnabled=null;me._queryable=null;me._queryFormat=null;me._permissions={};me._geometry=[];me._geometryWKT=null;me._tools=[];me._metadataIdentifier=null;me._backendStatus=null;me._featureData=!1;me._layerUrls=[];me._baseLayerId=-1;me._realtime=!1;me._refreshRate=null},{setLocalization:function(loc){var name={},desc={},inspire={},organization={},lang,singleLang;for(lang in loc)loc.hasOwnProperty(lang)&&(singleLang=loc[lang],singleLang.name&&(name[lang]=singleLang.name),singleLang.subtitle&&(desc[lang]=singleLang.subtitle),singleLang.inspire&&(inspire[lang]=singleLang.inspire),singleLang.orgName&&(organization[lang]=singleLang.orgName));for(lang in name)if(name.hasOwnProperty(lang)){this.setName(name);break}for(lang in desc)if(desc.hasOwnProperty(lang)){this.setDescription(desc);break}for(lang in inspire)if(inspire.hasOwnProperty(lang)){this.setInspireName(inspire);break}for(lang in organization)if(organization.hasOwnProperty(lang)){this.setOrganizationName(organization);break}},setId:function(id){this._id=id},getId:function(){return this._id},setParentId:function(id){this._baseLayerId=id},getParentId:function(){return this._baseLayerId?this._baseLayerId:-1},setQueryFormat:function(queryFormat){this._queryFormat=queryFormat},getQueryFormat:function(){return this._queryFormat},setName:function(name){this._name=name},getName:function(lang){return this._name&&typeof this._name=="object"?lang?this._name[lang]:this._name[Oskari.getLang()]:this._name},setType:function(type){this._type=type},getType:function(){return this._type},setDataUrl:function(param){this._dataUrl=param},getDataUrl:function(){return this._dataUrl},setOrganizationName:function(param){this._organizationName=param},getOrganizationName:function(lang){return this._organizationName&&typeof this._organizationName=="object"?lang?this._organizationName[lang]:this._organizationName[Oskari.getLang()]:this._organizationName},setInspireName:function(param){this._inspireName=param},getInspireName:function(lang){return this._inspireName&&typeof this._inspireName=="object"?lang?this._inspireName[lang]:this._inspireName[Oskari.getLang()]:this._inspireName},setFeatureInfoEnabled:function(featureInfoEnabled){this._featureInfoEnabled=featureInfoEnabled},isFeatureInfoEnabled:function(){return this._featureInfoEnabled===!0?!0:!1},setDescription:function(description){this._description=description},getDescription:function(lang){return this._description&&typeof this._description=="object"?lang?this._description[lang]:this._description[Oskari.getLang()]:this._description},addSubLayer:function(layer){var sublayers=this.getSubLayers();for(i=0,len=sublayers.length;i<len;++i)if(sublayers[i].getId()===layer.getId())return!1;return sublayers.push(layer),!0},getSubLayers:function(){return this._subLayers},setMaxScale:function(maxScale){this._maxScale=maxScale},getMaxScale:function(){return this._maxScale},setMinScale:function(minScale){this._minScale=minScale},getMinScale:function(){return this._minScale},setOrderNumber:function(orderNumber){this._orderNumber=orderNumber},getOrderNumber:function(){return this._orderNumber},isVisible:function(){return this._visible===!0},setVisible:function(visible){this._visible=visible},setOpacity:function(opacity){this._opacity=opacity},getOpacity:function(){return this._opacity===null||this._opacity===undefined?100:this._opacity},setGeometryWKT:function(value){this._geometryWKT=value},getGeometryWKT:function(){return this._geometryWKT},setGeometry:function(value){this._geometry=value},getGeometry:function(){return this._geometry},addPermission:function(action,permission){this._permissions[action]=permission},removePermission:function(action){this._permissions[action]=null;delete this._permissions[action]},getPermission:function(action){return this._permissions[action]},getMetadataIdentifier:function(){return this._metadataIdentifier},setMetadataIdentifier:function(metadataid){this._metadataIdentifier=metadataid},getBackendStatus:function(){return this._backendStatus},setBackendStatus:function(backendStatus){this._backendStatus=backendStatus},setMetaType:function(type){this._metaType=type},getMetaType:function(){return this._metaType},addStyle:function(style){var foundExisting,i,curStyle;if(style&&style.getName&&typeof style.getName=="function"){for(foundExisting=!1,i=0;i<this.getStyles().length;++i)if(curStyle=this.getStyles()[i],curStyle.getName()==style.getName()){foundExisting=!0;break}foundExisting||this.getStyles().push(style)}},getStyles:function(){return this._styles||(this._styles=[]),this._styles},selectStyle:function(styleName){for(var style,me=this,i=0;i<me.getStyles().length;i++)if(style=me.getStyles()[i],style.getName()===styleName){me._currentStyle=style;style.getLegend()!==""&&(me._legendImage=style.getLegend());return}me._currentStyle||(this._currentStyle=this._createEmptyStyle())},_createEmptyStyle:function(){var style=Oskari.clazz.create("Oskari.mapframework.domain.Style");return style.setName(""),style.setTitle(""),style.setLegend(""),style},getCurrentStyle:function(){return this._currentStyle||this.selectStyle(""),this._currentStyle},getTools:function(){return this._tools},setTools:function(tools){this._tools=tools},addTool:function(tool){this._tools.push(tool)},getTool:function(toolName){var tool=null,i;if(this._tools.length>0&&toolName!=="")for(i=0;i<this._tools.length;i++)if(tool=this._tools[i],tool.getName()===toolName)return tool;return tool},setLegendImage:function(legendImage){this._legendImage=legendImage},getLegendImage:function(){return this._legendImage},hasLegendImage:function(){var i,ret=!1;if(this._legendImage)ret=!0;else for(i=0;i<this.getStyles().length;++i)if(this.getStyles()[i].getLegend()){ret=!0;break}return ret},setSticky:function(isSticky){this._isSticky=isSticky},isSticky:function(){return this._isSticky},setQueryable:function(queryable){this._queryable=queryable},getQueryable:function(){return this._queryable},setAsBaseLayer:function(){this._type="BASE_LAYER"},setAsNormalLayer:function(){this._type="NORMAL_LAYER"},setAsGroupLayer:function(){this._type="GROUP_LAYER"},isGroupLayer:function(){return this._type==="GROUP_LAYER"},isBaseLayer:function(){return this._type==="BASE_LAYER"},isInScale:function(scale){var _inScale=!1,_subLayers=this.getSubLayers();return scale=scale||Oskari.getSandbox().getMap().getScale(),_subLayers&&_subLayers.length?_inScale=_.any(_subLayers,function(subLayer){return subLayer.isInScale(scale)}):((scale>this.getMaxScale()||!this.getMaxScale())&&scale<this.getMinScale()||!this.getMinScale())&&(_inScale=!0),_inScale},getLayerType:function(){return this._layerType.toLowerCase()},isLayerOfType:function(flavour){return flavour&&flavour.toLowerCase()===this.getLayerType()},getIconClassname:function(){return this.isBaseLayer()?"layer-base":this.isGroupLayer()?"layer-group":"layer-"+this.getLayerType()},getParams:function(){return this._params},getOptions:function(){return this._options},hasFeatureData:function(){return this._featureData},addLayerUrl:function(layerUrl){this._layerUrls.push(layerUrl)},getLayerUrls:function(){return this._layerUrls},setRealtime:function(realtime){this._realtime=realtime===!0},isRealtime:function(){return this._realtime},setRefreshRate:function(refreshRate){this._refreshRate=refreshRate<0?0:refreshRate},getRefreshRate:function(){return this._refreshRate}});Oskari.clazz.define("Oskari.mapframework.domain.WmsLayer",function(){this._wmsLayerName=null;this._wmsUrls=[];this._availableQueryFormats=[];this._layerType="WMS"},{addWmsUrl:function(wmsUrl){for(var url,foundExisting=!1,i=0;i<this.getWmsUrls().length;++i)if(url=this.getWmsUrls()[i],url==wmsUrl){foundExisting=!0;break}foundExisting||this._wmsUrls.push(wmsUrl)},getWmsUrls:function(){return this._wmsUrls},setWmsUrls:function(wmsUrls){this._wmsUrls=wmsUrls},setWmsName:function(wmsName){this._wmsName=wmsName},getWmsName:function(){return this._wmsName},setVersion:function(version){this._version=version},getVersion:function(){return this._version},setAvailableQueryFormats:function(options){this._availableQueryFormats=options||[]},getAvailableQueryFormats:function(){return this._availableQueryFormats||[]}},{extend:["Oskari.mapframework.domain.AbstractLayer"]});Oskari.clazz.define("Oskari.mapframework.domain.VectorLayer",function(){this._sldspec=null;this._layerType="VECTOR"},{setStyledLayerDescriptor:function(sld){this._sldspec=sld},getStyledLayerDescriptor:function(){return this._sldspec}},{extend:["Oskari.mapframework.domain.AbstractLayer"]});Oskari.clazz.define("Oskari.mapframework.domain.Map",function(){this._centerX=null;this._centerY=null;this._zoom=null;this._scale=null;this._bbox=null;this._markerVisible=null;this.width=null;this.height=null;this.resolution=null;this.extent=null;this.maxExtent=null;this._isMoving=!1;this._projectionCode="EPSG:3067"},{moveTo:function(x,y,zoom){this._centerX=x;this._centerY=y;this._zoom=zoom},setMoving:function(movingBln){this._isMoving=movingBln},isMoving:function(){return this._isMoving},getX:function(){return this._centerX},getY:function(){return this._centerY},getZoom:function(){return this._zoom},setScale:function(scale){this._scale=scale},getScale:function(){return this._scale},setBbox:function(bbox){this._bbox=bbox},getBbox:function(){return this._bbox},setMarkerVisible:function(markerVisible){this._markerVisible=markerVisible===!0||markerVisible==="true"},isMarkerVisible:function(){return this._markerVisible===!0?!0:!1},setWidth:function(width){this.width=width},getWidth:function(){return this.width},setHeight:function(height){this.height=height},getHeight:function(){return this.height},setResolution:function(r){this.resolution=r},getResolution:function(){return this.resolution},setExtent:function(e){this.extent=e},getExtent:function(){return this.extent},setMaxExtent:function(me){this.maxExtent=me},getMaxExtent:function(){return this.maxExtent},setSrsName:function(projectionCode){this._projectionCode=projectionCode},getSrsName:function(){return this._projectionCode}});Oskari.clazz.define("Oskari.mapframework.domain.Style",function(){this._name=null;this._title=null;this._legend=null},{setName:function(name){this._name=name},getName:function(){return this._name},setTitle:function(title){this._title=title},getTitle:function(){return this._title},setLegend:function(legend){this._legend=legend},getLegend:function(){return this._legend}});Oskari.clazz.define("Oskari.mapframework.domain.Tool",function(){this._name=null;this._title=null;this._tooltip=null;this._iconCls=null;this._callback=null},{setName:function(name){this._name=name},getName:function(){return this._name},setTitle:function(title){this._title=title},getTitle:function(){return this._title},setTooltip:function(tooltip){this._tooltip=tooltip},getTooltip:function(){return this._tooltip},setIconCls:function(iconCls){this._iconCls=iconCls},getIconCls:function(){return this._iconCls},setCallback:function(callback){this._callback=callback},getCallback:function(){return this._callback}});Oskari.clazz.define("Oskari.mapframework.domain.User",function(userData){this._loggedIn=!1;this._roles=[];userData&&(this._firstName=userData.firstName,this._lastName=userData.lastName,this._nickName=userData.nickName,this._loginName=userData.loginName,this._uuid=userData.userUUID,this._roles=userData.roles||[],userData.userUUID&&(this._loggedIn=!0))},{getName:function(){return this._firstName+" "+this._lastName},getFirstName:function(){return this._firstName},getLastName:function(){return this._lastName},getNickName:function(){return this._nickName},getLoginName:function(){return this._loginName},getUuid:function(){return this._uuid},isLoggedIn:function(){return this._loggedIn},getRoles:function(){return this._roles},hasRole:function(ids){if(ids&&ids.length){var i,ilen,j,jlen,role,roles=this.getRoles();for(ilen=ids.length,jlen=roles.length,i=0;i<ilen;i++)for(id=ids[i],j=0;j<jlen;j++)if(role=roles[j],id===role.id)return!0}return!1}});Oskari.clazz.define("Oskari.mapframework.core.map.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/core/core-map-layer-methods.js"},{type:"text/javascript",src:"../../../../sources/framework/core/core-map-methods.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"core-map","Bundle-Name":"mapframework.core.map.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.core.Bundle",Title:" mapframework.core.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}});Oskari.bundle_manager.installBundleClass("core-map","Oskari.mapframework.core.map.Bundle");Oskari.clazz.category("Oskari.mapframework.core.Core","map-layer-methods",{isLayerAlreadySelected:function(id){var mapLayerService=this.getService("Oskari.mapframework.service.MapLayerService"),layer=mapLayerService.findMapLayer(id,this._selectedLayers);return layer!==null&&layer!==undefined},findMapLayerFromSelectedMapLayers:function(id){var mapLayerService=this.getService("Oskari.mapframework.service.MapLayerService");return mapLayerService.findMapLayer(id,this._selectedLayers)},isMapLayerAlreadyHighlighted:function(id){var mapLayerService=this.getService("Oskari.mapframework.service.MapLayerService"),layer=mapLayerService.findMapLayer(id,this._mapLayersHighlighted);return(layer===null||layer===undefined)&&this.printDebug("[core-map-layer-methods] "+id+" is not yet highlighted."),layer!==null&&layer!==undefined},findMapLayerFromAllAvailable:function(id){var mapLayerService=this.getService("Oskari.mapframework.service.MapLayerService"),layer=mapLayerService.findMapLayer(id);return(layer===null||layer===undefined)&&this.printDebug("Cannot find map layer with id '"+id+"' from all available. Check that current user has VIEW permissions to that layer."),layer},getAllSelectedLayers:function(){return this._selectedLayers},getAllHighlightedMapLayers:function(){return this._mapLayersHighlighted},allowMultipleHighlightLayers:function(allow){this._allowMultipleHighlightLayers=allow},_handleAddMapLayerRequest:function(request){var me=this,id=request.getMapLayerId(),keepLayersOrder=request.getKeepLayersOrder(),isBaseMap=request.isBasemap(),mapLayer,newLayerIndex,newSelectedLayers,i,evt;if(me.printDebug("Trying to add map layer with id '"+id+"' AS "+(isBaseMap?" BASE ":" NORMAL ")),me.isLayerAlreadySelected(id)){me.printDebug("Attempt to select already selected layer '"+id+"'");return}if(mapLayer=me.findMapLayerFromAllAvailable(id),!mapLayer){me.printDebug("Attempt to select layer that is not available '"+id+"'");return}if(isBaseMap==!0&&mapLayer.setType("BASE_LAYER"),newLayerIndex=-1,keepLayersOrder!==null&&keepLayersOrder!==undefined&&keepLayersOrder)this._selectedLayers.push(mapLayer);else if(mapLayer.isBaseLayer()||isBaseMap==!0){for(newSelectedLayers=[],newSelectedLayers.push(mapLayer),i=0;i<this._selectedLayers.length;i++)newSelectedLayers.push(this._selectedLayers[i]);delete this._selectedLayers;this._selectedLayers=newSelectedLayers}else this._selectedLayers.push(mapLayer);evt=mapLayer.isBaseLayer()||isBaseMap?me.getEventBuilder("AfterMapLayerAddEvent")(mapLayer,keepLayersOrder,isBaseMap):me.getEventBuilder("AfterMapLayerAddEvent")(mapLayer,!0,isBaseMap);me.copyObjectCreatorToFrom(evt,request);me.dispatch(evt)},_handleRemoveMapLayerRequest:function(request){var me=this,id=request.getMapLayerId(),mapLayer,index,n,event;if(me.printDebug("Trying to remove map layer with id '"+id+"'"),!me.isLayerAlreadySelected(id)){me.printDebug("Attempt to remove layer '"+id+"' that is not selected.");return}for(mapLayer=me.findMapLayerFromAllAvailable(id),index=-1,n=0;n<me._selectedLayers.length;n++)if(me._selectedLayers[n]===mapLayer){index=n;break}me._selectedLayers.splice(index,1);me.isMapLayerAlreadyHighlighted(id)&&(me.printDebug("Maplayer is also highlighted, removing it from highlight list."),me._handleDimMapLayerRequest(id));event=me.getEventBuilder("AfterMapLayerRemoveEvent")(mapLayer);me.copyObjectCreatorToFrom(event,request);me.dispatch(event)},_handleShowMapLayerInfoRequest:function(request){var mapLayer=this.findMapLayerFromAllAvailable(request.getMapLayerId()),event=this.getEventBuilder("AfterShowMapLayerInfoEvent")(mapLayer);this.copyObjectCreatorToFrom(event,request);this.dispatch(event)},_handleRearrangeSelectedMapLayerRequest:function(request){var requestToPosition=request.getToPosition(),requestMapLayerId=request.getMapLayerId(),modifiedLayer=null,oldPosition=0,event;if(requestMapLayerId!==null&&requestMapLayerId!==undefined&&requestToPosition!==null&&requestToPosition!==undefined){modifiedLayer=this.findMapLayerFromSelectedMapLayers(requestMapLayerId);for(var newSelectedLayers=[],itemsAdded=0,lastHandledIndex=0,layer,i=0;itemsAdded<requestToPosition;i++){if(lastHandledIndex++,layer=this._selectedLayers[i],layer.getId()+""==requestMapLayerId+""){oldPosition=i;continue}newSelectedLayers.push(layer);itemsAdded++}for(newSelectedLayers.push(modifiedLayer),i=lastHandledIndex;i<this._selectedLayers.length;i++){if(layer=this._selectedLayers[i],layer.getId()+""==requestMapLayerId+""){oldPosition=i;continue}newSelectedLayers.push(layer)}delete this._selectedLayers;this._selectedLayers=newSelectedLayers}event=this.getEventBuilder("AfterRearrangeSelectedMapLayerEvent")(modifiedLayer,oldPosition,requestToPosition);this.copyObjectCreatorToFrom(event,request);this.dispatch(event)},_handleChangeMapLayerOpacityRequest:function(request){var layer=this.findMapLayerFromSelectedMapLayers(request.getMapLayerId()),event;layer&&(layer.setOpacity(request.getOpacity()),event=this.getEventBuilder("AfterChangeMapLayerOpacityEvent")(layer),this.copyObjectCreatorToFrom(event,request),this.dispatch(event))},_handleChangeMapLayerStyleRequest:function(request){var layer=this.findMapLayerFromSelectedMapLayers(request.getMapLayerId()),event;layer&&request.getStyle()!=="!default!"&&(layer.selectStyle(request.getStyle()),event=this.getEventBuilder("AfterChangeMapLayerStyleEvent")(layer),this.copyObjectCreatorToFrom(event,request),this.dispatch(event))},_removeHighLightedMapLayer:function(id){for(var highlightedMapLayers=this.getAllHighlightedMapLayers(),mapLayer,evt,i=0;i<highlightedMapLayers.length;i++)if(mapLayer=highlightedMapLayers[i],!id||mapLayer.getId()+""==id+""){highlightedMapLayers.splice(i);evt=this.getEventBuilder("AfterDimMapLayerEvent")(mapLayer);this.dispatch(evt);return}},_handleHighlightMapLayerRequest:function(request){var creator=this.getObjectCreator(request),id=request.getMapLayerId(),mapLayer,evt;if(this.printDebug("[core-map-layer-methods] Trying to highlight map layer with id '"+id+"'"),this.isMapLayerAlreadyHighlighted(id)){this.printWarn("[core-map-layer-methods] Attempt to highlight already highlighted wms feature info map layer '"+id+"'");return}(this._allowMultipleHighlightLayers==!0?this._removeHighLightedMapLayer(id):this._removeHighLightedMapLayer(),mapLayer=this.findMapLayerFromSelectedMapLayers(id),mapLayer)&&(this._mapLayersHighlighted.push(mapLayer),this.printDebug("[core-map-layer-methods] Adding "+mapLayer+" ("+mapLayer.getId()+") to highlighted list."),evt=this.getEventBuilder("AfterHighlightMapLayerEvent")(mapLayer),this.copyObjectCreatorToFrom(evt,request),this.dispatch(evt))},_handleDimMapLayerRequest:function(layerId){var mapLayer,event;(this._allowMultipleHighlightLayers==!0?this._removeHighLightedMapLayer(layerId):this._removeHighLightedMapLayer(),mapLayer=this.findMapLayerFromAllAvailable(layerId),mapLayer)&&(event=this.getEventBuilder("AfterDimMapLayerEvent")(mapLayer),this.dispatch(event))}});Oskari.clazz.category("Oskari.mapframework.core.Core","map-methods",{_handleHideMapMarkerRequest:function(request){this._map.setMarkerVisible(!1);var evt=this.getEventBuilder("AfterHideMapMarkerEvent")();this.copyObjectCreatorToFrom(evt,request);this.dispatch(evt)}});Oskari.clazz.define("Oskari.mapframework.bundle.oskariui.OskariUIBundle",function(){this.conf={}},{create:function(){return this},update:function(){},start:function(){var partsMap=this.conf.partsMap||{},domMgr=Oskari.clazz.create("Oskari.framework.bundle.oskariui.DomManager",jQuery,partsMap);Oskari.setDomManager(domMgr)},stop:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.bundle.BundleInstance"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/oskariui/jquery-ui-1.9.1.custom.min.js"},{type:"text/javascript",src:"../../../../libraries/jquery/plugins/jquery.base64.min.js"},{type:"text/css",src:"../../../../resources/framework/bundle/oskariui/css/jquery-ui-1.9.1.custom.css"},{type:"text/css",src:"../../../../resources/framework/bundle/oskariui/bootstrap-grid.css"},{type:"text/javascript",src:"../../../../libraries/lodash/2.3.0/lodash.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/oskariui/DomManager.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/oskariui/Layout.js"}],locales:[]},bundle:{manifest:{"Bundle-Identifier":"oskariui","Bundle-Name":"oskariui","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2012"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","jquery"],"Import-Bundle":{}}},dependencies:["jquery"]});Oskari.bundle_manager.installBundleClass("oskariui","Oskari.mapframework.bundle.oskariui.OskariUIBundle");
/*! jQuery UI - v1.9.1 - 2012-11-09
* http://jqueryui.com
* Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.position.js, jquery.ui.draggable.js, jquery.ui.droppable.js, jquery.ui.resizable.js, jquery.ui.selectable.js, jquery.ui.sortable.js, jquery.ui.slider.js, jquery.ui.tooltip.js
* Copyright (c) 2012 jQuery Foundation and other contributors Licensed MIT */
(function(e,t){function i(t,n){var r,i,o,u=t.nodeName.toLowerCase();return"area"===u?(r=t.parentNode,i=r.name,!t.href||!i||r.nodeName.toLowerCase()!=="map"?!1:(o=e("img[usemap=#"+i+"]")[0],!!o&&s(o))):(/input|select|textarea|button|object/.test(u)?!t.disabled:"a"===u?t.href||n:n)&&s(t)}function s(t){return e.expr.filters.visible(t)&&!e(t).parents().andSelf().filter(function(){return e.css(this,"visibility")==="hidden"}).length}var n=0,r=/^ui-id-\d+$/;(e.ui=e.ui||{},e.ui.version)||(e.extend(e.ui,{version:"1.9.1",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({_focus:e.fn.focus,focus:function(t,n){return typeof t=="number"?this.each(function(){var r=this;setTimeout(function(){e(r).focus();n&&n.call(r)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length)for(var r=e(this[0]),i,s;r.length&&r[0]!==document;){if(i=r.css("position"),(i==="absolute"||i==="relative"||i==="fixed")&&(s=parseInt(r.css("zIndex"),10),!isNaN(s)&&s!==0))return s;r=r.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++n)})},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&e(this).removeAttr("id")})}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,r){function u(t,n,r,s){return e.each(i,function(){n-=parseFloat(e.css(t,"padding"+this))||0;r&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0);s&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var i=r==="Width"?["Left","Right"]:["Top","Bottom"],s=r.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?o["inner"+r].call(this):this.each(function(){e(this).css(s,u(this,n)+"px")})};e.fn["outer"+r]=function(t,n){return typeof t!="number"?o["outer"+r].call(this,t):this.each(function(){e(this).css(s,u(this,t,!0,n)+"px")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var n=e.attr(t,"tabindex"),r=isNaN(n);return(r||n>=0)&&i(t,!r)}}),e(function(){var t=document.body,n=t.appendChild(n=document.createElement("div"));n.offsetHeight;e.extend(n.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0});e.support.minHeight=n.offsetHeight===100;e.support.selectstart="onselectstart"in n;t.removeChild(n).style.display="none"}),function(){var t=/msie ([\w.]+)/.exec(navigator.userAgent.toLowerCase())||[];e.ui.ie=t.length?!0:!1;e.ui.ie6=parseFloat(t[1],10)===6}(),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,n,r){var i,s=e.ui[t].prototype;for(i in r)s.plugins[i]=s.plugins[i]||[],s.plugins[i].push([n,r[i]])},call:function(e,t,n){var r,i=e.plugins[t];if(i&&e.element[0].parentNode&&e.element[0].parentNode.nodeType!==11)for(r=0;r<i.length;r++)e.options[i[r][0]]&&i[r][1].apply(e.element,n)}},contains:e.contains,hasScroll:function(t,n){if(e(t).css("overflow")==="hidden")return!1;var r=n&&n==="left"?"scrollLeft":"scrollTop",i=!1;return t[r]>0?!0:(t[r]=1,i=t[r]>0,t[r]=0,i)},isOverAxis:function(e,t,n){return e>t&&e<t+n},isOver:function(t,n,r,i,s,o){return e.ui.isOverAxis(t,r,s)&&e.ui.isOverAxis(n,i,o)}}))})(jQuery),function(e,t){var n=0,r=Array.prototype.slice,i=e.cleanData;e.cleanData=function(t){for(var n=0,r;(r=t[n])!=null;n++)try{e(r).triggerHandler("remove")}catch(s){}i(t)};e.widget=function(t,n,r){var i,s,o,u,a=t.split(".")[0];t=t.split(".")[1];i=a+"-"+t;r||(r=n,n=e.Widget);e.expr[":"][i.toLowerCase()]=function(t){return!!e.data(t,i)};e[a]=e[a]||{};s=e[a][t];o=e[a][t]=function(e,t){if(!this._createWidget)return new o(e,t);arguments.length&&this._createWidget(e,t)};e.extend(o,s,{version:r.version,_proto:e.extend({},r),_childConstructors:[]});u=new n;u.options=e.widget.extend({},u.options);e.each(r,function(t,i){e.isFunction(i)&&(r[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},r=function(e){return n.prototype[t].apply(this,e)};return function(){var t=this._super,n=this._superApply,s;return this._super=e,this._superApply=r,s=i.apply(this,arguments),this._super=t,this._superApply=n,s}}())});o.prototype=e.widget.extend(u,{widgetEventPrefix:u.widgetEventPrefix||t},r,{constructor:o,namespace:a,widgetName:t,widgetBaseClass:i,widgetFullName:i});s?(e.each(s._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,o,n._proto)}),delete s._childConstructors):n._childConstructors.push(o);e.widget.bridge(t,o)};e.widget.extend=function(n){for(var i=r.call(arguments,1),s=0,o=i.length,u,a;s<o;s++)for(u in i[s])a=i[s][u],i[s].hasOwnProperty(u)&&a!==t&&(n[u]=e.isPlainObject(a)?e.isPlainObject(n[u])?e.widget.extend({},n[u],a):e.widget.extend({},a):a);return n};e.widget.bridge=function(n,i){var s=i.prototype.widgetFullName;e.fn[n]=function(o){var u=typeof o=="string",a=r.call(arguments,1),f=this;return o=!u&&a.length?e.widget.extend.apply(null,[o].concat(a)):o,u?this.each(function(){var r,i=e.data(this,s);return i?!e.isFunction(i[o])||o.charAt(0)==="_"?e.error("no such method '"+o+"' for "+n+" widget instance"):(r=i[o].apply(i,a),r!==i&&r!==t?(f=r&&r.jquery?f.pushStack(r.get()):r,!1):void 0):e.error("cannot call methods on "+n+" prior to initialization; attempted to call method '"+o+"'")}):this.each(function(){var t=e.data(this,s);t?t.option(o||{})._init():new i(o,this)}),f}};e.Widget=function(){};e.Widget._childConstructors=[];e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,r){r=e(r||this.defaultElement||this)[0];this.element=e(r);this.uuid=n++;this.eventNamespace="."+this.widgetName+this.uuid;this.options=e.widget.extend({},this.options,this._getCreateOptions(),t);this.bindings=e();this.hoverable=e();this.focusable=e();r!==this&&(e.data(r,this.widgetName,this),e.data(r,this.widgetFullName,this),this._on(this.element,{remove:function(e){e.target===r&&this.destroy()}}),this.document=e(r.style?r.ownerDocument:r.document||r),this.window=e(this.document[0].defaultView||this.document[0].parentWindow));this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,r){var i=n,s,o,u;if(arguments.length===0)return e.widget.extend({},this.options);if(typeof n=="string")if(i={},s=n.split("."),n=s.shift(),s.length){for(o=i[n]=e.widget.extend({},this.options[n]),u=0;u<s.length-1;u++)o[s[u]]=o[s[u]]||{},o=o[s[u]];if(n=s.pop(),r===t)return o[n]===t?null:o[n];o[n]=r}else{if(r===t)return this.options[n]===t?null:this.options[n];i[n]=r}return this._setOptions(i),this},_setOptions:function(e){for(var t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,e==="disabled"&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,n){var r,i=this;n?(t=r=e(t),this.bindings=this.bindings.add(t)):(n=t,t=this.element,r=this.widget());e.each(n,function(n,s){function o(){if(i.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled"))return(typeof s=="string"?i[s]:s).apply(i,arguments)}typeof s!="string"&&(o.guid=s.guid=s.guid||o.guid||e.guid++);var u=n.match(/^(\w+)\s*(.*)$/),a=u[1]+i.eventNamespace,f=u[2];f?r.delegate(f,a,o):t.bind(a,o)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return(typeof e=="string"?r[e]:e).apply(r,arguments)}var r=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t);this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t);this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,r){var i,s,o=this.options[t];if(r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent,s)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(r))===!1||n.isDefaultPrevented())}};e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){typeof i=="string"&&(i={effect:i});var o,u=i?i===!0||typeof i=="number"?n:i.effect||n:t;i=i||{};typeof i=="number"&&(i={duration:i});o=!e.isEmptyObject(i);i.complete=s;i.delay&&r.delay(i.delay);o&&e.effects&&(e.effects.effect[u]||e.uiBackCompat!==!1&&e.effects[u])?r[t](i):u!==t&&r[u]?r[u](i.duration,i.easing,s):r.queue(function(n){e(this)[t]();s&&s.call(r[0]);n()})}});e.uiBackCompat!==!1&&(e.Widget.prototype._getCreateOptions=function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]})}(jQuery),function(e){var n=!1;e(document).mouseup(function(){n=!1});e.widget("ui.mouse",{version:"1.9.1",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){if(!0===e.data(n.target,t.widgetName+".preventClickEvent"))return e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1});this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName);this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(!n){this._mouseStarted&&this._mouseUp(t);this._mouseDownEvent=t;var r=this,i=t.which===1,s=typeof this.options.cancel=="string"&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;return!i||s||!this._mouseCapture(t)?!0:(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(t)!==!1,!this._mouseStarted))?(t.preventDefault(),!0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return r._mouseMove(e)},this._mouseUpDelegate=function(e){return r._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),n=!0,!0)}},_mouseMove:function(t){return!e.ui.ie||document.documentMode>=9||!!t.button?this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted):this._mouseUp(t)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(e,t){function h(e,t,n){return[parseInt(e[0],10)*(l.test(e[0])?t/100:1),parseInt(e[1],10)*(l.test(e[1])?n/100:1)]}function p(t,n){return parseInt(e.css(t,n),10)||0}e.ui=e.ui||{};var n,r=Math.max,i=Math.abs,s=Math.round,o=/left|center|right/,u=/top|center|bottom/,a=/[\+\-]\d+%?/,f=/^\w+/,l=/%$/,c=e.fn.position;e.position={scrollbarWidth:function(){if(n!==t)return n;var r,i,s=e("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'><\/div><\/div>"),o=s.children()[0];return e("body").append(s),r=o.offsetWidth,s.css("overflow","scroll"),i=o.offsetWidth,r===i&&(i=s[0].clientWidth),s.remove(),n=r-i},getScrollInfo:function(t){var n=t.isWindow?"":t.element.css("overflow-x"),r=t.isWindow?"":t.element.css("overflow-y"),i=n==="scroll"||n==="auto"&&t.width<t.element[0].scrollWidth,s=r==="scroll"||r==="auto"&&t.height<t.element[0].scrollHeight;return{width:i?e.position.scrollbarWidth():0,height:s?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var n=e(t||window),r=e.isWindow(n[0]);return{element:n,isWindow:r,offset:n.offset()||{left:0,top:0},scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop(),width:r?n.width():n.outerWidth(),height:r?n.height():n.outerHeight()}}};e.fn.position=function(t){if(!t||!t.of)return c.apply(this,arguments);t=e.extend({},t);var n,l,d,v,m,g=e(t.of),y=e.position.getWithinInfo(t.within),b=e.position.getScrollInfo(y),w=g[0],E=(t.collision||"flip").split(" "),S={};return w.nodeType===9?(l=g.width(),d=g.height(),v={top:0,left:0}):e.isWindow(w)?(l=g.width(),d=g.height(),v={top:g.scrollTop(),left:g.scrollLeft()}):w.preventDefault?(t.at="left top",l=d=0,v={top:w.pageY,left:w.pageX}):(l=g.outerWidth(),d=g.outerHeight(),v=g.offset()),m=e.extend({},v),e.each(["my","at"],function(){var e=(t[this]||"").split(" "),n,r;e.length===1&&(e=o.test(e[0])?e.concat(["center"]):u.test(e[0])?["center"].concat(e):["center","center"]);e[0]=o.test(e[0])?e[0]:"center";e[1]=u.test(e[1])?e[1]:"center";n=a.exec(e[0]);r=a.exec(e[1]);S[this]=[n?n[0]:0,r?r[0]:0];t[this]=[f.exec(e[0])[0],f.exec(e[1])[0]]}),E.length===1&&(E[1]=E[0]),t.at[0]==="right"?m.left+=l:t.at[0]==="center"&&(m.left+=l/2),t.at[1]==="bottom"?m.top+=d:t.at[1]==="center"&&(m.top+=d/2),n=h(S.at,l,d),m.left+=n[0],m.top+=n[1],this.each(function(){var o,u,a=e(this),f=a.outerWidth(),c=a.outerHeight(),w=p(this,"marginLeft"),x=p(this,"marginTop"),T=f+w+p(this,"marginRight")+b.width,N=c+x+p(this,"marginBottom")+b.height,C=e.extend({},m),k=h(S.my,a.outerWidth(),a.outerHeight());t.my[0]==="right"?C.left-=f:t.my[0]==="center"&&(C.left-=f/2);t.my[1]==="bottom"?C.top-=c:t.my[1]==="center"&&(C.top-=c/2);C.left+=k[0];C.top+=k[1];e.support.offsetFractions||(C.left=s(C.left),C.top=s(C.top));o={marginLeft:w,marginTop:x};e.each(["left","top"],function(r,i){e.ui.position[E[r]]&&e.ui.position[E[r]][i](C,{targetWidth:l,targetHeight:d,elemWidth:f,elemHeight:c,collisionPosition:o,collisionWidth:T,collisionHeight:N,offset:[n[0]+k[0],n[1]+k[1]],my:t.my,at:t.at,within:y,elem:a})});e.fn.bgiframe&&a.bgiframe();t.using&&(u=function(e){var n=v.left-C.left,s=n+l-f,o=v.top-C.top,u=o+d-c,h={target:{element:g,left:v.left,top:v.top,width:l,height:d},element:{element:a,left:C.left,top:C.top,width:f,height:c},horizontal:s<0?"left":n>0?"right":"center",vertical:u<0?"top":o>0?"bottom":"middle"};l<f&&i(n+s)<l&&(h.horizontal="center");d<c&&i(o+u)<d&&(h.vertical="middle");h.important=r(i(n),i(s))>r(i(o),i(u))?"horizontal":"vertical";t.using.call(this,e,h)});a.offset(e.extend(C,{using:u}))})};e.ui.position={fit:{left:function(e,t){var n=t.within,i=n.isWindow?n.scrollLeft:n.offset.left,s=n.width,o=e.left-t.collisionPosition.marginLeft,u=i-o,a=o+t.collisionWidth-s-i,f;t.collisionWidth>s?u>0&&a<=0?(f=e.left+u+t.collisionWidth-s-i,e.left+=u-f):e.left=a>0&&u<=0?i:u>a?i+s-t.collisionWidth:i:u>0?e.left+=u:a>0?e.left-=a:e.left=r(e.left-o,e.left)},top:function(e,t){var n=t.within,i=n.isWindow?n.scrollTop:n.offset.top,s=t.within.height,o=e.top-t.collisionPosition.marginTop,u=i-o,a=o+t.collisionHeight-s-i,f;t.collisionHeight>s?u>0&&a<=0?(f=e.top+u+t.collisionHeight-s-i,e.top+=u-f):e.top=a>0&&u<=0?i:u>a?i+s-t.collisionHeight:i:u>0?e.top+=u:a>0?e.top-=a:e.top=r(e.top-o,e.top)}},flip:{left:function(e,t){var n=t.within,r=n.offset.left+n.scrollLeft,s=n.width,o=n.isWindow?n.scrollLeft:n.offset.left,u=e.left-t.collisionPosition.marginLeft,a=u-o,f=u+t.collisionWidth-s-o,l=t.my[0]==="left"?-t.elemWidth:t.my[0]==="right"?t.elemWidth:0,c=t.at[0]==="left"?t.targetWidth:t.at[0]==="right"?-t.targetWidth:0,h=-2*t.offset[0],p,d;a<0?(p=e.left+l+c+h+t.collisionWidth-s-r,(p<0||p<i(a))&&(e.left+=l+c+h)):f>0&&(d=e.left-t.collisionPosition.marginLeft+l+c+h-o,(d>0||i(d)<f)&&(e.left+=l+c+h))},top:function(e,t){var n=t.within,r=n.offset.top+n.scrollTop,s=n.height,o=n.isWindow?n.scrollTop:n.offset.top,u=e.top-t.collisionPosition.marginTop,a=u-o,f=u+t.collisionHeight-s-o,l=t.my[1]==="top",c=l?-t.elemHeight:t.my[1]==="bottom"?t.elemHeight:0,h=t.at[1]==="top"?t.targetHeight:t.at[1]==="bottom"?-t.targetHeight:0,p=-2*t.offset[1],d,v;a<0?(v=e.top+c+h+p+t.collisionHeight-s-r,e.top+c+h+p>a&&(v<0||v<i(a))&&(e.top+=c+h+p)):f>0&&(d=e.top-t.collisionPosition.marginTop+c+h+p-o,e.top+c+h+p>f&&(d>0||i(d)<f)&&(e.top+=c+h+p))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments);e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments);e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,n,r,i,s,o=document.getElementsByTagName("body")[0],u=document.createElement("div");t=document.createElement(o?"div":"body");r={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};o&&e.extend(r,{position:"absolute",left:"-1000px",top:"-1000px"});for(s in r)t.style[s]=r[s];t.appendChild(u);n=o||document.documentElement;n.insertBefore(t,n.firstChild);u.style.cssText="position: absolute; left: 10.7432222px;";i=e(u).offset().left;e.support.offsetFractions=i>10&&i<11;t.innerHTML="";n.removeChild(t)}();e.uiBackCompat!==!1&&function(e){var n=e.fn.position;e.fn.position=function(r){if(!r||!r.offset)return n.call(this,r);var i=r.offset.split(" "),s=r.at.split(" ");return i.length===1&&(i[1]=i[0]),/^\d/.test(i[0])&&(i[0]="+"+i[0]),/^\d/.test(i[1])&&(i[1]="+"+i[1]),s.length===1&&(/left|center|right/.test(s[0])?s[1]="center":(s[1]=s[0],s[0]="center")),n.call(this,e.extend(r,{at:s[0]+i[0]+" "+s[1]+i[1],offset:t}))}}(jQuery)}(jQuery),function(e){e.widget("ui.draggable",e.ui.mouse,{version:"1.9.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){this.options.helper!="original"||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative");this.options.addClasses&&this.element.addClass("ui-draggable");this.options.disabled&&this.element.addClass("ui-draggable-disabled");this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");this._mouseDestroy()},_mouseCapture:function(t){var n=this.options;return this.helper||n.disabled||e(t.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(t),this.handle?(e(n.iframeFix===!0?"iframe":n.iframeFix).each(function(){e('<div class="ui-draggable-iframeFix" style="background: #fff;"><\/div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var n=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),n.containment&&this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,n){if(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),!n){var r=this._uiHash();if(this._trigger("drag",t,r)===!1)return this._mouseUp({}),!1;this.position=r.position}return this.options.axis&&this.options.axis=="y"||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&this.options.axis=="x"||(this.helper[0].style.top=this.position.top+"px"),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var n=!1,r,i,s;for(e.ui.ddmanager&&!this.options.dropBehaviour&&(n=e.ui.ddmanager.drop(this,t)),this.dropped&&(n=this.dropped,this.dropped=!1),r=this.element[0],i=!1;r&&(r=r.parentNode);)r==document&&(i=!0);return!i&&this.options.helper==="original"?!1:(this.options.revert=="invalid"&&!n||this.options.revert=="valid"&&n||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)?(s=this,e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){s._trigger("stop",t)!==!1&&s._clear()})):this._trigger("stop",t)!==!1&&this._clear(),!1)},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){var n=!this.options.handle||!e(this.options.handle,this.element).length?!0:!1;return e(this.options.handle,this.element).find("*").andSelf().each(function(){this==t.target&&(n=!0)}),n},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t])):n.helper=="clone"?this.element.clone().removeAttr("id"):this.element;return r.parents("body").length||r.appendTo(n.appendTo=="parent"?this.element[0].parentNode:n.appendTo),r[0]!=this.element[0]&&!/(fixed|absolute)/.test(r.css("position"))&&r.css("position","absolute"),r},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" "));e.isArray(t)&&(t={left:+t[0],top:+t[1]||0});"left"in t&&(this.offset.click.left=t.left+this.margins.left);"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left);"top"in t&&(this.offset.click.top=t.top+this.margins.top);"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options,n,r,i,s;if(t.containment=="parent"&&(t.containment=this.helper[0].parentNode),(t.containment=="document"||t.containment=="window")&&(this.containment=[t.containment=="document"?0:e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t.containment=="document"?0:e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(t.containment=="document"?0:e(window).scrollLeft())+e(t.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(t.containment=="document"?0:e(window).scrollTop())+(e(t.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(t.containment)||t.containment.constructor==Array)t.containment.constructor==Array&&(this.containment=t.containment);else{if(n=e(t.containment),r=n[0],!r)return;i=n.offset();s=e(r).css("overflow")!="hidden";this.containment=[(parseInt(e(r).css("borderLeftWidth"),10)||0)+(parseInt(e(r).css("paddingLeft"),10)||0),(parseInt(e(r).css("borderTopWidth"),10)||0)+(parseInt(e(r).css("paddingTop"),10)||0),(s?Math.max(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(e(r).css("borderLeftWidth"),10)||0)-(parseInt(e(r).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(s?Math.max(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(e(r).css("borderTopWidth"),10)||0)-(parseInt(e(r).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom];this.relative_container=n}},_convertPositionTo:function(t,n){n||(n=this.position);var r=t=="absolute"?1:-1,i=this.options,s=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(s[0].tagName);return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():o?0:s.scrollTop())*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():o?0:s.scrollLeft())*r}},_generatePosition:function(t){var n=this.options,r=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(r[0].tagName),s=t.pageX,o=t.pageY,u,a,f,l;return this.originalPosition&&(this.containment&&(this.relative_container?(a=this.relative_container.offset(),u=[this.containment[0]+a.left,this.containment[1]+a.top,this.containment[2]+a.left,this.containment[3]+a.top]):u=this.containment,t.pageX-this.offset.click.left<u[0]&&(s=u[0]+this.offset.click.left),t.pageY-this.offset.click.top<u[1]&&(o=u[1]+this.offset.click.top),t.pageX-this.offset.click.left>u[2]&&(s=u[2]+this.offset.click.left),t.pageY-this.offset.click.top>u[3]&&(o=u[3]+this.offset.click.top)),n.grid&&(f=n.grid[1]?this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1]:this.originalPageY,o=u?f-this.offset.click.top<u[1]||f-this.offset.click.top>u[3]?f-this.offset.click.top<u[1]?f+n.grid[1]:f-n.grid[1]:f:f,l=n.grid[0]?this.originalPageX+Math.round((s-this.originalPageX)/n.grid[0])*n.grid[0]:this.originalPageX,s=u?l-this.offset.click.left<u[0]||l-this.offset.click.left>u[2]?l-this.offset.click.left<u[0]?l+n.grid[0]:l-n.grid[0]:l:l)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:r.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging");this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove();this.helper=null;this.cancelHelperRemoval=!1},_trigger:function(t,n,r){return r=r||this._uiHash(),e.ui.plugin.call(this,t,[n,r]),t=="drag"&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,n,r)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}});e.ui.plugin.add("draggable","connectToSortable",{start:function(t,n){var r=e(this).data("draggable"),i=r.options,s=e.extend({},n,{item:r.element});r.sortables=[];e(i.connectToSortable).each(function(){var n=e.data(this,"sortable");n&&!n.options.disabled&&(r.sortables.push({instance:n,shouldRevert:n.options.revert}),n.refreshPositions(),n._trigger("activate",t,s))})},stop:function(t,n){var r=e(this).data("draggable"),i=e.extend({},n,{item:r.element});e.each(r.sortables,function(){this.instance.isOver?(this.instance.isOver=0,r.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,r.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,i))})},drag:function(t,n){var r=e(this).data("draggable"),i=this,s=function(t){var n=this.offset.click.top,r=this.offset.click.left,i=this.positionAbs.top,s=this.positionAbs.left,o=t.height,u=t.width,a=t.top,f=t.left;return e.ui.isOver(i+n,s+r,a,f,o,u)};e.each(r.sortables,function(){var o=!1,u=this;this.instance.positionAbs=r.positionAbs;this.instance.helperProportions=r.helperProportions;this.instance.offset.click=r.offset.click;this.instance._intersectsWith(this.instance.containerCache)&&(o=!0,e.each(r.sortables,function(){return this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this!=u&&this.instance._intersectsWith(this.instance.containerCache)&&e.ui.contains(u.instance.element[0],this.instance.element[0])&&(o=!1),o}));o?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(i).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return n.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=r.offset.click.top,this.instance.offset.click.left=r.offset.click.left,this.instance.offset.parent.left-=r.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=r.offset.parent.top-this.instance.offset.parent.top,r._trigger("toSortable",t),r.dropped=this.instance.element,r.currentItem=r.element,this.instance.fromOutside=r),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),r._trigger("fromSortable",t),r.dropped=!1)})}});e.ui.plugin.add("draggable","cursor",{start:function(){var r=e("body"),i=e(this).data("draggable").options;r.css("cursor")&&(i._cursor=r.css("cursor"));r.css("cursor",i.cursor)},stop:function(){var r=e(this).data("draggable").options;r._cursor&&e("body").css("cursor",r._cursor)}});e.ui.plugin.add("draggable","opacity",{start:function(t,n){var r=e(n.helper),i=e(this).data("draggable").options;r.css("opacity")&&(i._opacity=r.css("opacity"));r.css("opacity",i.opacity)},stop:function(t,n){var r=e(this).data("draggable").options;r._opacity&&e(n.helper).css("opacity",r._opacity)}});e.ui.plugin.add("draggable","scroll",{start:function(){var r=e(this).data("draggable");r.scrollParent[0]!=document&&r.scrollParent[0].tagName!="HTML"&&(r.overflowOffset=r.scrollParent.offset())},drag:function(t){var r=e(this).data("draggable"),i=r.options,s=!1;r.scrollParent[0]!=document&&r.scrollParent[0].tagName!="HTML"?(i.axis&&i.axis=="x"||(r.overflowOffset.top+r.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity?r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop+i.scrollSpeed:t.pageY-r.overflowOffset.top<i.scrollSensitivity&&(r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop-i.scrollSpeed)),i.axis&&i.axis=="y"||(r.overflowOffset.left+r.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity?r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft+i.scrollSpeed:t.pageX-r.overflowOffset.left<i.scrollSensitivity&&(r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft-i.scrollSpeed))):(i.axis&&i.axis=="x"||(t.pageY-e(document).scrollTop()<i.scrollSensitivity?s=e(document).scrollTop(e(document).scrollTop()-i.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<i.scrollSensitivity&&(s=e(document).scrollTop(e(document).scrollTop()+i.scrollSpeed))),i.axis&&i.axis=="y"||(t.pageX-e(document).scrollLeft()<i.scrollSensitivity?s=e(document).scrollLeft(e(document).scrollLeft()-i.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<i.scrollSensitivity&&(s=e(document).scrollLeft(e(document).scrollLeft()+i.scrollSpeed))));s!==!1&&e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(r,t)}});e.ui.plugin.add("draggable","snap",{start:function(){var r=e(this).data("draggable"),i=r.options;r.snapElements=[];e(i.snap.constructor!=String?i.snap.items||":data(draggable)":i.snap).each(function(){var t=e(this),n=t.offset();this!=r.element[0]&&r.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:n.top,left:n.left})})},drag:function(t,n){for(var b,r=e(this).data("draggable"),i=r.options,s=i.snapTolerance,o=n.offset.left,u=o+r.helperProportions.width,a=n.offset.top,f=a+r.helperProportions.height,l=r.snapElements.length-1;l>=0;l--){var c=r.snapElements[l].left,h=c+r.snapElements[l].width,p=r.snapElements[l].top,d=p+r.snapElements[l].height;if(!(c-s<o&&o<h+s&&p-s<a&&a<d+s||c-s<o&&o<h+s&&p-s<f&&f<d+s||c-s<u&&u<h+s&&p-s<a&&a<d+s||c-s<u&&u<h+s&&p-s<f&&f<d+s)){r.snapElements[l].snapping&&r.options.snap.release&&r.options.snap.release.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[l].item}));r.snapElements[l].snapping=!1;continue}if(i.snapMode!="inner"){var v=Math.abs(p-f)<=s,m=Math.abs(d-a)<=s,g=Math.abs(c-u)<=s,y=Math.abs(h-o)<=s;v&&(n.position.top=r._convertPositionTo("relative",{top:p-r.helperProportions.height,left:0}).top-r.margins.top);m&&(n.position.top=r._convertPositionTo("relative",{top:d,left:0}).top-r.margins.top);g&&(n.position.left=r._convertPositionTo("relative",{top:0,left:c-r.helperProportions.width}).left-r.margins.left);y&&(n.position.left=r._convertPositionTo("relative",{top:0,left:h}).left-r.margins.left)}if(b=v||m||g||y,i.snapMode!="outer"){var v=Math.abs(p-a)<=s,m=Math.abs(d-f)<=s,g=Math.abs(c-o)<=s,y=Math.abs(h-u)<=s;v&&(n.position.top=r._convertPositionTo("relative",{top:p,left:0}).top-r.margins.top);m&&(n.position.top=r._convertPositionTo("relative",{top:d-r.helperProportions.height,left:0}).top-r.margins.top);g&&(n.position.left=r._convertPositionTo("relative",{top:0,left:c}).left-r.margins.left);y&&(n.position.left=r._convertPositionTo("relative",{top:0,left:h-r.helperProportions.width}).left-r.margins.left)}!r.snapElements[l].snapping&&(v||m||g||y||b)&&r.options.snap.snap&&r.options.snap.snap.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[l].item}));r.snapElements[l].snapping=v||m||g||y||b}}});e.ui.plugin.add("draggable","stack",{start:function(){var r=e(this).data("draggable").options,i=e.makeArray(e(r.stack)).sort(function(t,n){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(n).css("zIndex"),10)||0)}),s;i.length&&(s=parseInt(i[0].style.zIndex)||0,e(i).each(function(e){this.style.zIndex=s+e}),this[0].style.zIndex=s+i.length)}});e.ui.plugin.add("draggable","zIndex",{start:function(t,n){var r=e(n.helper),i=e(this).data("draggable").options;r.css("zIndex")&&(i._zIndex=r.css("zIndex"));r.css("zIndex",i.zIndex)},stop:function(t,n){var r=e(this).data("draggable").options;r._zIndex&&e(n.helper).css("zIndex",r._zIndex)}})}(jQuery),function(e){e.widget("ui.droppable",{version:"1.9.1",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect"},_create:function(){var t=this.options,n=t.accept;this.isover=0;this.isout=1;this.accept=e.isFunction(n)?n:function(e){return e.is(n)};this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight};e.ui.ddmanager.droppables[t.scope]=e.ui.ddmanager.droppables[t.scope]||[];e.ui.ddmanager.droppables[t.scope].push(this);t.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var t=e.ui.ddmanager.droppables[this.options.scope],n=0;n<t.length;n++)t[n]==this&&t.splice(n,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,n){t=="accept"&&(this.accept=e.isFunction(n)?n:function(e){return e.is(n)});e.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass);n&&this._trigger("activate",t,this.ui(n))},_deactivate:function(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass);n&&this._trigger("deactivate",t,this.ui(n))},_over:function(t){var n=e.ui.ddmanager.current;n&&(n.currentItem||n.element)[0]!=this.element[0]&&this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(n)))},_out:function(t){var n=e.ui.ddmanager.current;n&&(n.currentItem||n.element)[0]!=this.element[0]&&this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(n)))},_drop:function(t,n){var r=n||e.ui.ddmanager.current,i;return!r||(r.currentItem||r.element)[0]==this.element[0]?!1:(i=!1,this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var t=e.data(this,"droppable");if(t.options.greedy&&!t.options.disabled&&t.options.scope==r.options.scope&&t.accept.call(t.element[0],r.currentItem||r.element)&&e.ui.intersect(r,e.extend(t,{offset:t.element.offset()}),t.options.tolerance))return i=!0,!1}),i?!1:this.accept.call(this.element[0],r.currentItem||r.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(r)),this.element):!1)},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}});e.ui.intersect=function(t,n,r){if(!n.offset)return!1;var i=(t.positionAbs||t.position.absolute).left,s=i+t.helperProportions.width,o=(t.positionAbs||t.position.absolute).top,u=o+t.helperProportions.height,a=n.offset.left,f=a+n.proportions.width,l=n.offset.top,c=l+n.proportions.height;switch(r){case"fit":return a<=i&&s<=f&&l<=o&&u<=c;case"intersect":return a<i+t.helperProportions.width/2&&s-t.helperProportions.width/2<f&&l<o+t.helperProportions.height/2&&u-t.helperProportions.height/2<c;case"pointer":var h=(t.positionAbs||t.position.absolute).left+(t.clickOffset||t.offset.click).left,p=(t.positionAbs||t.position.absolute).top+(t.clickOffset||t.offset.click).top;return e.ui.isOver(p,h,l,a,n.proportions.height,n.proportions.width);case"touch":return(o>=l&&o<=c||u>=l&&u<=c||o<l&&u>c)&&(i>=a&&i<=f||s>=a&&s<=f||i<a&&s>f);default:return!1}};e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,n){var r=e.ui.ddmanager.droppables[t.options.scope]||[],i=n?n.type:null,s=(t.currentItem||t.element).find(":data(droppable)").andSelf(),o,u;e:for(o=0;o<r.length;o++)if(!r[o].options.disabled&&(!t||r[o].accept.call(r[o].element[0],t.currentItem||t.element))){for(u=0;u<s.length;u++)if(s[u]==r[o].element[0]){r[o].proportions.height=0;continue e}(r[o].visible=r[o].element.css("display")!="none",r[o].visible)&&(i=="mousedown"&&r[o]._activate.call(r[o],n),r[o].offset=r[o].element.offset(),r[o].proportions={width:r[o].element[0].offsetWidth,height:r[o].element[0].offsetHeight})}},drop:function(t,n){var r=!1;return e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance)&&(r=this._drop.call(this,n)||r),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=1,this.isover=0,this._deactivate.call(this,n)))}),r},dragStart:function(t,n){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)})},drag:function(t,n){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,n);e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){var r,i,s,o,u;this.options.disabled||this.greedyChild||!this.visible||(r=e.ui.intersect(t,this,this.options.tolerance),i=!r&&this.isover==1?"isout":r&&this.isover==0?"isover":null,i)&&(this.options.greedy&&(o=this.options.scope,u=this.element.parents(":data(droppable)").filter(function(){return e.data(this,"droppable").options.scope===o}),u.length&&(s=e.data(u[0],"droppable"),s.greedyChild=i=="isover"?1:0)),s&&i=="isover"&&(s.isover=0,s.isout=1,s._out.call(s,n)),this[i]=1,this[i=="isout"?"isover":"isout"]=0,this[i=="isover"?"_over":"_out"].call(this,n),s&&i=="isout"&&(s.isout=0,s.isover=1,s._over.call(s,n)))})},dragStop:function(t,n){t.element.parentsUntil("body").unbind("scroll.droppable");t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)}}}(jQuery),function(e){e.widget("ui.resizable",e.ui.mouse,{version:"1.9.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1e3},_create:function(){var t=this,n=this.options,r,i;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!n.aspectRatio,aspectRatio:n.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:n.helper||n.ghost||n.animate?n.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e('<div class="ui-wrapper" style="overflow: hidden;"><\/div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("resizable",this.element.data("resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=n.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor==String)for(this.handles=="all"&&(this.handles="n,e,s,w,se,sw,ne,nw"),r=this.handles.split(","),this.handles={},i=0;i<r.length;i++){var s=e.trim(r[i]),o="ui-resizable-"+s,u=e('<div class="ui-resizable-handle '+o+'"><\/div>');u.css({zIndex:n.zIndex});"se"==s&&u.addClass("ui-icon ui-icon-gripsmall-diagonal-se");this.handles[s]=".ui-resizable-"+s;this.element.append(u)}this._renderAxis=function(t){var n,r,i,s;t=t||this.element;for(n in this.handles)this.handles[n].constructor==String&&(this.handles[n]=e(this.handles[n],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(r=e(this.handles[n],this.element),i=0,i=/sw|ne|nw|se|n|s/.test(n)?r.outerHeight():r.outerWidth(),s=["padding",/ne|nw|n/.test(n)?"Top":/se|sw|s/.test(n)?"Bottom":/^e$/.test(n)?"Right":"Left"].join(""),t.css(s,i),this._proportionallyResize()),!e(this.handles[n]).length};this._renderAxis(this.element);this._handles=e(".ui-resizable-handle",this.element).disableSelection();this._handles.mouseover(function(){if(!t.resizing){if(this.className)var e=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);t.axis=e&&e[1]?e[1]:"se"}});n.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){n.disabled||(e(this).removeClass("ui-resizable-autohide"),t._handles.show())}).mouseleave(function(){n.disabled||t.resizing||(e(this).addClass("ui-resizable-autohide"),t._handles.hide())}));this._mouseInit()},_destroy:function(){var t,n;return this._mouseDestroy(),t=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()},this.elementIsWrapper&&(t(this.element),n=this.element,this.originalElement.css({position:n.css("position"),width:n.outerWidth(),height:n.outerHeight(),top:n.css("top"),left:n.css("left")}).insertAfter(n),n.remove()),this.originalElement.css("resize",this.originalResizeStyle),t(this.originalElement),this},_mouseCapture:function(t){var n=!1;for(var r in this.handles)e(this.handles[r])[0]==t.target&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(t){var r=this.options,i=this.element.position(),s=this.element,o,u,a;return this.resizing=!0,this.documentScroll={top:e(document).scrollTop(),left:e(document).scrollLeft()},(s.is(".ui-draggable")||/absolute/.test(s.css("position")))&&s.css({position:"absolute",top:i.top,left:i.left}),this._renderProxy(),o=n(this.helper.css("left")),u=n(this.helper.css("top")),r.containment&&(o+=e(r.containment).scrollLeft()||0,u+=e(r.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:o,top:u},this.size=this._helper?{width:s.outerWidth(),height:s.outerHeight()}:{width:s.width(),height:s.height()},this.originalSize=this._helper?{width:s.outerWidth(),height:s.outerHeight()}:{width:s.width(),height:s.height()},this.originalPosition={left:o,top:u},this.sizeDiff={width:s.outerWidth()-s.width(),height:s.outerHeight()-s.height()},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio=typeof r.aspectRatio=="number"?r.aspectRatio:this.originalSize.width/this.originalSize.height||1,a=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor",a=="auto"?this.axis+"-resize":a),s.addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(e){var t=this.helper,n=this.options,i=this,s=this.originalMousePosition,o=this.axis,u=e.pageX-s.left||0,a=e.pageY-s.top||0,f=this._change[o],l;return f?(l=f.apply(this,[e,u,a]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(l=this._updateRatio(l,e)),l=this._respectSize(l,e),this._propagate("resize",e),t.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"}),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),this._updateCache(l),this._trigger("resize",e,this.ui()),!1):!1},_mouseStop:function(t){var n,r;if(this.resizing=!1,n=this.options,r=this,this._helper){var i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),o=s&&e.ui.hasScroll(i[0],"left")?0:r.sizeDiff.height,u=s?0:r.sizeDiff.width,a={width:r.helper.width()-u,height:r.helper.height()-o},f=parseInt(r.element.css("left"),10)+(r.position.left-r.originalPosition.left)||null,l=parseInt(r.element.css("top"),10)+(r.position.top-r.originalPosition.top)||null;n.animate||this.element.css(e.extend(a,{top:l,left:f}));r.helper.height(r.size.height);r.helper.width(r.size.width);this._helper&&!n.animate&&this._proportionallyResize()}return e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(e){var t=this.options,n,i,s,o,u;u={minWidth:r(t.minWidth)?t.minWidth:0,maxWidth:r(t.maxWidth)?t.maxWidth:Infinity,minHeight:r(t.minHeight)?t.minHeight:0,maxHeight:r(t.maxHeight)?t.maxHeight:Infinity};(this._aspectRatio||e)&&(n=u.minHeight*this.aspectRatio,s=u.minWidth/this.aspectRatio,i=u.maxHeight*this.aspectRatio,o=u.maxWidth/this.aspectRatio,n>u.minWidth&&(u.minWidth=n),s>u.minHeight&&(u.minHeight=s),i<u.maxWidth&&(u.maxWidth=i),o<u.maxHeight&&(u.maxHeight=o));this._vBoundaries=u},_updateCache:function(e){var t=this.options;this.offset=this.helper.offset();r(e.left)&&(this.position.left=e.left);r(e.top)&&(this.position.top=e.top);r(e.height)&&(this.size.height=e.height);r(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var n=this.options,i=this.position,s=this.size,o=this.axis;return r(e.height)?e.width=e.height*this.aspectRatio:r(e.width)&&(e.height=e.width/this.aspectRatio),o=="sw"&&(e.left=i.left+(s.width-e.width),e.top=null),o=="nw"&&(e.top=i.top+(s.height-e.height),e.left=i.left+(s.width-e.width)),e},_respectSize:function(e,t){var n=this.helper,i=this._vBoundaries,s=this._aspectRatio||t.shiftKey,o=this.axis,u=r(e.width)&&i.maxWidth&&i.maxWidth<e.width,a=r(e.height)&&i.maxHeight&&i.maxHeight<e.height,f=r(e.width)&&i.minWidth&&i.minWidth>e.width,l=r(e.height)&&i.minHeight&&i.minHeight>e.height,v;f&&(e.width=i.minWidth);l&&(e.height=i.minHeight);u&&(e.width=i.maxWidth);a&&(e.height=i.maxHeight);var c=this.originalPosition.left+this.originalSize.width,h=this.position.top+this.size.height,p=/sw|nw|w/.test(o),d=/nw|ne|n/.test(o);return f&&p&&(e.left=c-i.minWidth),u&&p&&(e.left=c-i.maxWidth),l&&d&&(e.top=h-i.minHeight),a&&d&&(e.top=h-i.maxHeight),v=!e.width&&!e.height,v&&!e.left&&e.top?e.top=null:v&&!e.top&&e.left&&(e.left=null),e},_proportionallyResize:function(){var t=this.options,n,r,i,s,o;if(this._proportionallyResizeElements.length)for(n=this.helper||this.element,r=0;r<this._proportionallyResizeElements.length;r++)i=this._proportionallyResizeElements[r],this.borderDif||(s=[i.css("borderTopWidth"),i.css("borderRightWidth"),i.css("borderBottomWidth"),i.css("borderLeftWidth")],o=[i.css("paddingTop"),i.css("paddingRight"),i.css("paddingBottom"),i.css("paddingLeft")],this.borderDif=e.map(s,function(e,t){var n=parseInt(e,10)||0,r=parseInt(o[t],10)||0;return n+r})),i.css({height:n.height()-this.borderDif[0]-this.borderDif[2]||0,width:n.width()-this.borderDif[1]-this.borderDif[3]||0})},_renderProxy:function(){var t=this.element,n=this.options,r,i;this.elementOffset=t.offset();this._helper?(this.helper=this.helper||e('<div style="overflow:hidden;"><\/div>'),r=e.ui.ie6?1:0,i=e.ui.ie6?2:-1,this.helper.addClass(this._helper).css({width:this.element.outerWidth()+i,height:this.element.outerHeight()+i,position:"absolute",left:this.elementOffset.left-r+"px",top:this.elementOffset.top-r+"px",zIndex:++n.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var r=this.options,i=this.originalSize,s=this.originalPosition;return{left:s.left+t,width:i.width-t}},n:function(e,t,n){var r=this.options,i=this.originalSize,s=this.originalPosition;return{top:s.top+n,height:i.height-n}},s:function(e,t,n){return{height:this.originalSize.height+n}},se:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,n,r]))},sw:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,n,r]))},ne:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,n,r]))},nw:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,n,r]))}},_propagate:function(t,n){e.ui.plugin.call(this,t,[n,this.ui()]);t!="resize"&&this._trigger(t,n,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}});e.ui.plugin.add("resizable","alsoResize",{start:function(){var r=e(this).data("resizable"),i=r.options,s=function(t){e(t).each(function(){var t=e(this);t.data("resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})};typeof i.alsoResize=="object"&&!i.alsoResize.parentNode?i.alsoResize.length?(i.alsoResize=i.alsoResize[0],s(i.alsoResize)):e.each(i.alsoResize,function(e){s(e)}):s(i.alsoResize)},resize:function(t,n){var r=e(this).data("resizable"),i=r.options,s=r.originalSize,o=r.originalPosition,u={height:r.size.height-s.height||0,width:r.size.width-s.width||0,top:r.position.top-o.top||0,left:r.position.left-o.left||0},a=function(t,r){e(t).each(function(){var t=e(this),i=e(this).data("resizable-alsoresize"),s={},o=r&&r.length?r:t.parents(n.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(o,function(e,t){var n=(i[t]||0)+(u[t]||0);n&&n>=0&&(s[t]=n||null)});t.css(s)})};typeof i.alsoResize=="object"&&!i.alsoResize.nodeType?e.each(i.alsoResize,function(e,t){a(e,t)}):a(i.alsoResize)},stop:function(){e(this).removeData("resizable-alsoresize")}});e.ui.plugin.add("resizable","animate",{stop:function(t){var r=e(this).data("resizable"),i=r.options,s=r._proportionallyResizeElements,o=s.length&&/textarea/i.test(s[0].nodeName),u=o&&e.ui.hasScroll(s[0],"left")?0:r.sizeDiff.height,a=o?0:r.sizeDiff.width,f={width:r.size.width-a,height:r.size.height-u},l=parseInt(r.element.css("left"),10)+(r.position.left-r.originalPosition.left)||null,c=parseInt(r.element.css("top"),10)+(r.position.top-r.originalPosition.top)||null;r.element.animate(e.extend(f,c&&l?{top:c,left:l}:{}),{duration:i.animateDuration,easing:i.animateEasing,step:function(){var n={width:parseInt(r.element.css("width"),10),height:parseInt(r.element.css("height"),10),top:parseInt(r.element.css("top"),10),left:parseInt(r.element.css("left"),10)};s&&s.length&&e(s[0]).css({width:n.width,height:n.height});r._updateCache(n);r._propagate("resize",t)}})}});e.ui.plugin.add("resizable","containment",{start:function(){var i=e(this).data("resizable"),s=i.options,o=i.element,u=s.containment,a=u instanceof e?u.get(0):/parent/.test(u)?o.parent().get(0):u,f,l;if(a)if(i.containerElement=e(a),/document/.test(u)||u==document)i.containerOffset={left:0,top:0},i.containerPosition={left:0,top:0},i.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight};else{f=e(a);l=[];e(["Top","Right","Left","Bottom"]).each(function(e,t){l[e]=n(f.css("padding"+t))});i.containerOffset=f.offset();i.containerPosition=f.position();i.containerSize={height:f.innerHeight()-l[3],width:f.innerWidth()-l[1]};var c=i.containerOffset,h=i.containerSize.height,p=i.containerSize.width,d=e.ui.hasScroll(a,"left")?a.scrollWidth:p,v=e.ui.hasScroll(a)?a.scrollHeight:h;i.parentData={element:a,left:c.left,top:c.top,width:d,height:v}}},resize:function(t){var r=e(this).data("resizable"),i=r.options,s=r.containerSize,o=r.containerOffset,u=r.size,a=r.position,f=r._aspectRatio||t.shiftKey,l={top:0,left:0},c=r.containerElement;c[0]!=document&&/static/.test(c.css("position"))&&(l=o);a.left<(r._helper?o.left:0)&&(r.size.width=r.size.width+(r._helper?r.position.left-o.left:r.position.left-l.left),f&&(r.size.height=r.size.width/r.aspectRatio),r.position.left=i.helper?o.left:0);a.top<(r._helper?o.top:0)&&(r.size.height=r.size.height+(r._helper?r.position.top-o.top:r.position.top),f&&(r.size.width=r.size.height*r.aspectRatio),r.position.top=r._helper?o.top:0);r.offset.left=r.parentData.left+r.position.left;r.offset.top=r.parentData.top+r.position.top;var h=Math.abs((r._helper?r.offset.left-l.left:r.offset.left-l.left)+r.sizeDiff.width),p=Math.abs((r._helper?r.offset.top-l.top:r.offset.top-o.top)+r.sizeDiff.height),d=r.containerElement.get(0)==r.element.parent().get(0),v=/relative|absolute/.test(r.containerElement.css("position"));d&&v&&(h-=r.parentData.left);h+r.size.width>=r.parentData.width&&(r.size.width=r.parentData.width-h,f&&(r.size.height=r.size.width/r.aspectRatio));p+r.size.height>=r.parentData.height&&(r.size.height=r.parentData.height-p,f&&(r.size.width=r.size.height*r.aspectRatio))},stop:function(){var r=e(this).data("resizable"),i=r.options,s=r.position,o=r.containerOffset,u=r.containerPosition,a=r.containerElement,f=e(r.helper),l=f.offset(),c=f.outerWidth()-r.sizeDiff.width,h=f.outerHeight()-r.sizeDiff.height;r._helper&&!i.animate&&/relative/.test(a.css("position"))&&e(this).css({left:l.left-u.left-o.left,width:c,height:h});r._helper&&!i.animate&&/static/.test(a.css("position"))&&e(this).css({left:l.left-u.left-o.left,width:c,height:h})}});e.ui.plugin.add("resizable","ghost",{start:function(){var r=e(this).data("resizable"),i=r.options,s=r.size;r.ghost=r.originalElement.clone();r.ghost.css({opacity:.25,display:"block",position:"relative",height:s.height,width:s.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass(typeof i.ghost=="string"?i.ghost:"");r.ghost.appendTo(r.helper)},resize:function(){var r=e(this).data("resizable"),i=r.options;r.ghost&&r.ghost.css({position:"relative",height:r.size.height,width:r.size.width})},stop:function(){var r=e(this).data("resizable"),i=r.options;r.ghost&&r.helper&&r.helper.get(0).removeChild(r.ghost.get(0))}});e.ui.plugin.add("resizable","grid",{resize:function(t){var r=e(this).data("resizable"),i=r.options,s=r.size,o=r.originalSize,u=r.originalPosition,a=r.axis,f=i._aspectRatio||t.shiftKey,l,c;i.grid=typeof i.grid=="number"?[i.grid,i.grid]:i.grid;l=Math.round((s.width-o.width)/(i.grid[0]||1))*(i.grid[0]||1);c=Math.round((s.height-o.height)/(i.grid[1]||1))*(i.grid[1]||1);/^(se|s|e)$/.test(a)?(r.size.width=o.width+l,r.size.height=o.height+c):/^(ne)$/.test(a)?(r.size.width=o.width+l,r.size.height=o.height+c,r.position.top=u.top-c):/^(sw)$/.test(a)?(r.size.width=o.width+l,r.size.height=o.height+c,r.position.left=u.left-l):(r.size.width=o.width+l,r.size.height=o.height+c,r.position.top=u.top-c,r.position.left=u.left-l)}});var n=function(e){return parseInt(e,10)||0},r=function(e){return!isNaN(parseInt(e,10))}}(jQuery),function(e){e.widget("ui.selectable",e.ui.mouse,{version:"1.9.1",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch"},_create:function(){var t=this,n;this.element.addClass("ui-selectable");this.dragged=!1;this.refresh=function(){n=e(t.options.filter,t.element[0]);n.addClass("ui-selectee");n.each(function(){var t=e(this),n=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:n.left,top:n.top,right:n.left+t.outerWidth(),bottom:n.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})};this.refresh();this.selectees=n.addClass("ui-selectee");this._mouseInit();this.helper=e("<div class='ui-selectable-helper'><\/div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item");this.element.removeClass("ui-selectable ui-selectable-disabled");this._mouseDestroy()},_mouseStart:function(t){var n=this,r;(this.opos=[t.pageX,t.pageY],this.options.disabled)||(r=this.options,this.selectees=e(r.filter,this.element[0]),this._trigger("start",t),e(r.appendTo).append(this.helper),this.helper.css({left:t.clientX,top:t.clientY,width:0,height:0}),r.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var r=e.data(this,"selectable-item");r.startselected=!0;t.metaKey||t.ctrlKey||(r.$element.removeClass("ui-selected"),r.selected=!1,r.$element.addClass("ui-unselecting"),r.unselecting=!0,n._trigger("unselecting",t,{unselecting:r.element}))}),e(t.target).parents().andSelf().each(function(){var r=e.data(this,"selectable-item"),i;if(r)return i=!t.metaKey&&!t.ctrlKey||!r.$element.hasClass("ui-selected"),r.$element.removeClass(i?"ui-unselecting":"ui-selected").addClass(i?"ui-selecting":"ui-unselecting"),r.unselecting=!i,r.selecting=i,r.selected=i,i?n._trigger("selecting",t,{selecting:r.element}):n._trigger("unselecting",t,{unselecting:r.element}),!1}))},_mouseDrag:function(t){var n=this,a;if(this.dragged=!0,!this.options.disabled){var r=this.options,i=this.opos[0],s=this.opos[1],o=t.pageX,u=t.pageY;return i>o&&(a=o,o=i,i=a),s>u&&(a=u,u=s,s=a),this.helper.css({left:i,top:s,width:o-i,height:u-s}),this.selectees.each(function(){var a=e.data(this,"selectable-item"),f;a&&a.element!=n.element[0]&&(f=!1,r.tolerance=="touch"?f=!(a.left>o||a.right<i||a.top>u||a.bottom<s):r.tolerance=="fit"&&(f=a.left>i&&a.right<o&&a.top>s&&a.bottom<u),f?(a.selected&&(a.$element.removeClass("ui-selected"),a.selected=!1),a.unselecting&&(a.$element.removeClass("ui-unselecting"),a.unselecting=!1),a.selecting||(a.$element.addClass("ui-selecting"),a.selecting=!0,n._trigger("selecting",t,{selecting:a.element}))):(a.selecting&&((t.metaKey||t.ctrlKey)&&a.startselected?(a.$element.removeClass("ui-selecting"),a.selecting=!1,a.$element.addClass("ui-selected"),a.selected=!0):(a.$element.removeClass("ui-selecting"),a.selecting=!1,a.startselected&&(a.$element.addClass("ui-unselecting"),a.unselecting=!0),n._trigger("unselecting",t,{unselecting:a.element}))),a.selected&&!t.metaKey&&!t.ctrlKey&&!a.startselected&&(a.$element.removeClass("ui-selected"),a.selected=!1,a.$element.addClass("ui-unselecting"),a.unselecting=!0,n._trigger("unselecting",t,{unselecting:a.element}))))}),!1}},_mouseStop:function(t){var n=this,r;return this.dragged=!1,r=this.options,e(".ui-unselecting",this.element[0]).each(function(){var r=e.data(this,"selectable-item");r.$element.removeClass("ui-unselecting");r.unselecting=!1;r.startselected=!1;n._trigger("unselected",t,{unselected:r.element})}),e(".ui-selecting",this.element[0]).each(function(){var r=e.data(this,"selectable-item");r.$element.removeClass("ui-selecting").addClass("ui-selected");r.selecting=!1;r.selected=!0;r.startselected=!0;n._trigger("selected",t,{selected:r.element})}),this._trigger("stop",t),this.helper.remove(),!1}})}(jQuery),function(e){e.widget("ui.sortable",e.ui.mouse,{version:"1.9.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var e=this.options;this.containerCache={};this.element.addClass("ui-sortable");this.refresh();this.floating=this.items.length?e.axis==="x"||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1;this.offset=this.element.offset();this._mouseInit();this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled");this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,n){t==="disabled"?(this.options[t]=n,this.widget().toggleClass("ui-sortable-disabled",!!n)):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,n){var r=this,i,s,o;return this.reverting?!1:this.options.disabled||this.options.type=="static"?!1:(this._refreshItems(t),i=null,s=e(t.target).parents().each(function(){if(e.data(this,r.widgetName+"-item")==r)return i=e(this),!1}),e.data(t.target,r.widgetName+"-item")==r&&(i=e(t.target)),!i)?!1:this.options.handle&&!n&&(o=!1,e(this.options.handle,i).find("*").andSelf().each(function(){this==t.target&&(o=!0)}),!o)?!1:(this.currentItem=i,this._removeCurrentsFromItems(),!0)},_mouseStart:function(t,n,r){var i=this.options,s;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),i.containment&&this._setContainment(),i.cursor&&(e("body").css("cursor")&&(this._storedCursor=e("body").css("cursor")),e("body").css("cursor",i.cursor)),i.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",i.opacity)),i.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",i.zIndex)),this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!r)for(s=this.containers.length-1;s>=0;s--)this.containers[s]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var n,r,i;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(n=this.options,r=!1,this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<n.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+n.scrollSpeed:t.pageY-this.overflowOffset.top<n.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-n.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<n.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+n.scrollSpeed:t.pageX-this.overflowOffset.left<n.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-n.scrollSpeed)):(t.pageY-e(document).scrollTop()<n.scrollSensitivity?r=e(document).scrollTop(e(document).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<n.scrollSensitivity&&(r=e(document).scrollTop(e(document).scrollTop()+n.scrollSpeed)),t.pageX-e(document).scrollLeft()<n.scrollSensitivity?r=e(document).scrollLeft(e(document).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<n.scrollSensitivity&&(r=e(document).scrollLeft(e(document).scrollLeft()+n.scrollSpeed))),r!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&this.options.axis=="y"||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&this.options.axis=="x"||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--){var s=this.items[i],o=s.item[0],u=this._intersectsWithPointer(s);if(u&&s.instance===this.currentContainer&&o!=this.currentItem[0]&&this.placeholder[u==1?"next":"prev"]()[0]!=o&&!e.contains(this.placeholder[0],o)&&(this.options.type=="semi-dynamic"?!e.contains(this.element[0],o):!0)){if(this.direction=u==1?"down":"up",this.options.tolerance!="pointer"&&!this._intersectsWithSides(s))break;this._rearrange(t,s);this._trigger("change",t,this._uiHash());break}}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,n){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var r=this,i=this.placeholder.offset();this.reverting=!0;e(this.helper).animate({left:i.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:i.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){r._clear(t)})}else this._clear(t,n);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null});this.options.helper=="original"?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.options.helper!="original"&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},e(n).each(function(){var n=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[-=_](.+)/);n&&r.push((t.key||n[1]+"[]")+"="+(t.key&&t.expression?n[1]:n[2]))}),!r.length&&t.key&&r.push(t.key+"="),r.join("&")},toArray:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},n.each(function(){r.push(e(t.item||this).attr(t.attribute||"id")||"")}),r},_intersectsWith:function(e){var t=this.positionAbs.left,n=t+this.helperProportions.width,r=this.positionAbs.top,i=r+this.helperProportions.height,s=e.left,o=s+e.width,u=e.top,a=u+e.height,f=this.offset.click.top,l=this.offset.click.left,c=r+f>u&&r+f<a&&t+l>s&&t+l<o;return this.options.tolerance=="pointer"||this.options.forcePointerForContainers||this.options.tolerance!="pointer"&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?c:s<t+this.helperProportions.width/2&&n-this.helperProportions.width/2<o&&u<r+this.helperProportions.height/2&&i-this.helperProportions.height/2<a},_intersectsWithPointer:function(t){var n=this.options.axis==="x"||e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),r=this.options.axis==="y"||e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),i=n&&r,s=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return i?this.floating?o&&o=="right"||s=="down"?2:1:s&&(s=="down"?2:1):!1},_intersectsWithSides:function(t){var n=e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),r=e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),i=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return this.floating&&s?s=="right"&&r||s=="left"&&!r:i&&(i=="down"&&n||i=="up"&&!n)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return e!=0&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return e!=0&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor==String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var n=[],r=[],i=this._connectWith(),o,u,a,s;if(i&&t)for(s=i.length-1;s>=0;s--)for(o=e(i[s]),u=o.length-1;u>=0;u--)a=e.data(o[u],this.widgetName),a&&a!=this&&!a.options.disabled&&r.push([e.isFunction(a.options.items)?a.options.items.call(a.element):e(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a]);for(r.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=r.length-1;s>=0;s--)r[s][0].each(function(){n.push(this)});return e(n)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var n=0;n<t.length;n++)if(t[n]==e.item[0])return!1;return!0})},_refreshItems:function(t){var o,a,s,f,l,u,c,h;this.items=[];this.containers=[this];var n=this.items,r=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],i=this._connectWith();if(i&&this.ready)for(s=i.length-1;s>=0;s--)for(o=e(i[s]),u=o.length-1;u>=0;u--)a=e.data(o[u],this.widgetName),a&&a!=this&&!a.options.disabled&&(r.push([e.isFunction(a.options.items)?a.options.items.call(a.element[0],t,{item:this.currentItem}):e(a.options.items,a.element),a]),this.containers.push(a));for(s=r.length-1;s>=0;s--)for(f=r[s][1],l=r[s][0],u=0,c=l.length;u<c;u++)h=e(l[u]),h.data(this.widgetName+"-item",f),n.push({item:h,instance:f,width:0,height:0,left:0,top:0})},refreshPositions:function(t){var r,i,n,s;for(this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset()),n=this.items.length-1;n>=0;n--)(r=this.items[n],r.instance!=this.currentContainer&&this.currentContainer&&r.item[0]!=this.currentItem[0])||(i=this.options.toleranceElement?e(this.options.toleranceElement,r.item):r.item,t||(r.width=i.outerWidth(),r.height=i.outerHeight()),s=i.offset(),r.left=s.left,r.top=s.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(n=this.containers.length-1;n>=0;n--)s=this.containers[n].element.offset(),this.containers[n].containerCache.left=s.left,this.containers[n].containerCache.top=s.top,this.containers[n].containerCache.width=this.containers[n].element.outerWidth(),this.containers[n].containerCache.height=this.containers[n].element.outerHeight();return this},_createPlaceholder:function(t){var n,r;t=t||this;n=t.options;n.placeholder&&n.placeholder.constructor!=String||(r=n.placeholder,n.placeholder={element:function(){var n=e(document.createElement(t.currentItem[0].nodeName)).addClass(r||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return r||(n.style.visibility="hidden"),n},update:function(e,i){(!r||n.forcePlaceholderSize)&&(i.height()||i.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),i.width()||i.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}});t.placeholder=e(n.placeholder.element.call(t.element,t.currentItem));t.currentItem.after(t.placeholder);n.placeholder.update(t,t.placeholder)},_contactContainers:function(t){for(var l,c,h,n=null,r=null,i=this.containers.length-1;i>=0;i--)if(!e.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(n&&e.contains(this.containers[i].element[0],n.element[0]))continue;n=this.containers[i];r=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",t,this._uiHash(this)),this.containers[i].containerCache.over=0);if(n)if(this.containers.length===1)this.containers[r]._trigger("over",t,this._uiHash(this)),this.containers[r].containerCache.over=1;else{var s=1e4,o=null,u=this.containers[r].floating?"left":"top",a=this.containers[r].floating?"width":"height",f=this.positionAbs[u]+this.offset.click[u];for(l=this.items.length-1;l>=0;l--)e.contains(this.containers[r].element[0],this.items[l].item[0])&&this.items[l].item[0]!=this.currentItem[0]&&(c=this.items[l].item.offset()[u],h=!1,Math.abs(c-f)>Math.abs(c+this.items[l][a]-f)&&(h=!0,c+=this.items[l][a]),Math.abs(c-f)<s&&(s=Math.abs(c-f),o=this.items[l],this.direction=h?"up":"down"));if(!o&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[r];o?this._rearrange(t,o,null,!0):this._rearrange(t,null,this.containers[r].element,!0);this._trigger("change",t,this._uiHash());this.containers[r]._trigger("change",t,this._uiHash(this));this.options.placeholder.update(this.currentContainer,this.placeholder);this.containers[r]._trigger("over",t,this._uiHash(this));this.containers[r].containerCache.over=1}},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t,this.currentItem])):n.helper=="clone"?this.currentItem.clone():this.currentItem;return r.parents("body").length||e(n.appendTo!="parent"?n.appendTo:this.currentItem[0].parentNode)[0].appendChild(r[0]),r[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(r[0].style.width==""||n.forceHelperSize)&&r.width(this.currentItem.width()),(r[0].style.height==""||n.forceHelperSize)&&r.height(this.currentItem.height()),r},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" "));e.isArray(t)&&(t={left:+t[0],top:+t[1]||0});"left"in t&&(this.offset.click.left=t.left+this.margins.left);"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left);"top"in t&&(this.offset.click.top=t.top+this.margins.top);"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;if(t.containment=="parent"&&(t.containment=this.helper[0].parentNode),(t.containment=="document"||t.containment=="window")&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e(t.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(e(t.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),!/^(document|window|parent)$/.test(t.containment)){var n=e(t.containment)[0],r=e(t.containment).offset(),i=e(n).css("overflow")!="hidden";this.containment=[r.left+(parseInt(e(n).css("borderLeftWidth"),10)||0)+(parseInt(e(n).css("paddingLeft"),10)||0)-this.margins.left,r.top+(parseInt(e(n).css("borderTopWidth"),10)||0)+(parseInt(e(n).css("paddingTop"),10)||0)-this.margins.top,r.left+(i?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(e(n).css("borderLeftWidth"),10)||0)-(parseInt(e(n).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,r.top+(i?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(e(n).css("borderTopWidth"),10)||0)-(parseInt(e(n).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(t,n){n||(n=this.position);var r=t=="absolute"?1:-1,i=this.options,s=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(s[0].tagName);return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():o?0:s.scrollTop())*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():o?0:s.scrollLeft())*r}},_generatePosition:function(t){var n=this.options,r=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(r[0].tagName),s,o,u,a;return this.cssPosition=="relative"&&(this.scrollParent[0]==document||this.scrollParent[0]==this.offsetParent[0])&&(this.offset.relative=this._getRelativeOffset()),s=t.pageX,o=t.pageY,this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(s=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(s=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),n.grid&&(u=this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1],o=this.containment?u-this.offset.click.top<this.containment[1]||u-this.offset.click.top>this.containment[3]?u-this.offset.click.top<this.containment[1]?u+n.grid[1]:u-n.grid[1]:u:u,a=this.originalPageX+Math.round((s-this.originalPageX)/n.grid[0])*n.grid[0],s=this.containment?a-this.offset.click.left<this.containment[0]||a-this.offset.click.left>this.containment[2]?a-this.offset.click.left<this.containment[0]?a+n.grid[0]:a-n.grid[0]:a:a)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:r.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())}},_rearrange:function(e,t,n,r){n?n[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],this.direction=="down"?t.item[0]:t.item[0].nextSibling);this.counter=this.counter?++this.counter:1;var i=this.counter;this._delay(function(){i==this.counter&&this.refreshPositions(!r)})},_clear:function(t,n){var r,i;if(this.reverting=!1,r=[],!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]==this.currentItem[0]){for(i in this._storedCSS)(this._storedCSS[i]=="auto"||this._storedCSS[i]=="static")&&(this._storedCSS[i]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!n&&r.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),(this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!n&&r.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(n||(r.push(function(e){this._trigger("remove",e,this._uiHash())}),r.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),r.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),i=this.containers.length-1;i>=0;i--)n||r.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over&&(r.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over=0);if(this._storedCursor&&e("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex",this._storedZIndex=="auto"?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!n){for(this._trigger("beforeStop",t,this._uiHash()),i=0;i<r.length;i++)r[i].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!1}if(n||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null,!n){for(i=0;i<r.length;i++)r[i].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var n=t||this;return{helper:n.helper,placeholder:n.placeholder||e([]),position:n.position,originalPosition:n.originalPosition,offset:n.positionAbs,item:n.currentItem,sender:t?t.element:null}}})}(jQuery),function(e){var n=5;e.widget("ui.slider",e.ui.mouse,{version:"1.9.1",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null},_create:function(){var t,r,i=this.options,s=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),u=[];for(this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"+(i.disabled?" ui-slider-disabled ui-disabled":"")),this.range=e([]),i.range&&(i.range===!0&&(i.values||(i.values=[this._valueMin(),this._valueMin()]),i.values.length&&i.values.length!==2&&(i.values=[i.values[0],i.values[0]])),this.range=e("<div><\/div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+(i.range==="min"||i.range==="max"?" ui-slider-range-"+i.range:""))),r=i.values&&i.values.length||1,t=s.length;t<r;t++)u.push("<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'><\/a>");this.handles=s.add(e(u.join("")).appendTo(this.element));this.handle=this.handles.eq(0);this.handles.add(this.range).filter("a").click(function(e){e.preventDefault()}).mouseenter(function(){i.disabled||e(this).addClass("ui-state-hover")}).mouseleave(function(){e(this).removeClass("ui-state-hover")}).focus(function(){i.disabled?e(this).blur():(e(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),e(this).addClass("ui-state-focus"))}).blur(function(){e(this).removeClass("ui-state-focus")});this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)});this._on(this.handles,{keydown:function(t){var r,i,s,o,u=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(t.preventDefault(),!this._keySliding&&(this._keySliding=!0,e(t.target).addClass("ui-state-active"),r=this._start(t,u),r===!1))return}o=this.options.step;i=this.options.values&&this.options.values.length?s=this.values(u):s=this.value();switch(t.keyCode){case e.ui.keyCode.HOME:s=this._valueMin();break;case e.ui.keyCode.END:s=this._valueMax();break;case e.ui.keyCode.PAGE_UP:s=this._trimAlignValue(i+(this._valueMax()-this._valueMin())/n);break;case e.ui.keyCode.PAGE_DOWN:s=this._trimAlignValue(i-(this._valueMax()-this._valueMin())/n);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(i===this._valueMax())return;s=this._trimAlignValue(i+o);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i===this._valueMin())return;s=this._trimAlignValue(i-o)}this._slide(t,u,s)},keyup:function(t){var n=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,n),this._change(t,n),e(t.target).removeClass("ui-state-active"))}});this._refreshValue();this._animateOff=!1},_destroy:function(){this.handles.remove();this.range.remove();this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all");this._mouseDestroy()},_mouseCapture:function(t){var n,r,i,s,o,u,a,f,l=this,c=this.options;return c.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),n={x:t.pageX,y:t.pageY},r=this._normValueFromMouse(n),i=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var n=Math.abs(r-l.values(t));i>n&&(i=n,s=e(this),o=t)}),c.range===!0&&this.values(1)===c.min&&(o+=1,s=e(this.handles[o])),u=this._start(t,o),u===!1?!1:(this._mouseSliding=!0,this._handleIndex=o,s.addClass("ui-state-active").focus(),a=s.offset(),f=!e(t.target).parents().andSelf().is(".ui-slider-handle"),this._clickOffset=f?{left:0,top:0}:{left:t.pageX-a.left-s.width()/2,top:t.pageY-a.top-s.height()/2-(parseInt(s.css("borderTopWidth"),10)||0)-(parseInt(s.css("borderBottomWidth"),10)||0)+(parseInt(s.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,o,r),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},n=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,n),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,n,r,i,s;return this.orientation==="horizontal"?(t=this.elementSize.width,n=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,n=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),r=n/t,r>1&&(r=1),r<0&&(r=0),this.orientation==="vertical"&&(r=1-r),i=this._valueMax()-this._valueMin(),s=this._valueMin()+r*i,this._trimAlignValue(s)},_start:function(e,t){var n={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("start",e,n)},_slide:function(e,t,n){var r,i,s;this.options.values&&this.options.values.length?(r=this.values(t?0:1),this.options.values.length===2&&this.options.range===!0&&(t===0&&n>r||t===1&&n<r)&&(n=r),n!==this.values(t)&&(i=this.values(),i[t]=n,s=this._trigger("slide",e,{handle:this.handles[t],value:n,values:i}),r=this.values(t?0:1),s!==!1&&this.values(t,n,!0))):n!==this.value()&&(s=this._trigger("slide",e,{handle:this.handles[t],value:n}),s!==!1&&this.value(n))},_stop:function(e,t){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values());this._trigger("stop",e,n)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values());this._trigger("change",e,n)}},value:function(e){if(arguments.length){this.options.value=this._trimAlignValue(e);this._refreshValue();this._change(null,0);return}return this._value()},values:function(t,n){var r,i,s;if(arguments.length>1){this.options.values[t]=this._trimAlignValue(n);this._refreshValue();this._change(null,t);return}if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();for(r=this.options.values,i=arguments[0],s=0;s<r.length;s+=1)r[s]=this._trimAlignValue(i[s]),this._change(null,s);this._refreshValue()},_setOption:function(t,n){var r,i=0;e.isArray(this.options.values)&&(i=this.options.values.length);e.Widget.prototype._setOption.apply(this,arguments);switch(t){case"disabled":n?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.prop("disabled",!0),this.element.addClass("ui-disabled")):(this.handles.prop("disabled",!1),this.element.removeClass("ui-disabled"));break;case"orientation":this._detectOrientation();this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation);this._refreshValue();break;case"value":this._animateOff=!0;this._refreshValue();this._change(null,0);this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),r=0;r<i;r+=1)this._change(null,r);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0;this._refreshValue();this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e),e},_values:function(e){var t,n,r;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t),t;for(n=this.options.values.slice(),r=0;r<n.length;r+=1)n[r]=this._trimAlignValue(n[r]);return n},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,n=(e-this._valueMin())%t,r=e-n;return Math.abs(n)*2>=t&&(r+=n>0?t:-t),parseFloat(r.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,n,r,i,s,o=this.options.range,u=this.options,a=this,f=this._animateOff?!1:u.animate,l={};this.options.values&&this.options.values.length?this.handles.each(function(r){n=(a.values(r)-a._valueMin())/(a._valueMax()-a._valueMin())*100;l[a.orientation==="horizontal"?"left":"bottom"]=n+"%";e(this).stop(1,1)[f?"animate":"css"](l,u.animate);a.options.range===!0&&(a.orientation==="horizontal"?(r===0&&a.range.stop(1,1)[f?"animate":"css"]({left:n+"%"},u.animate),r===1&&a.range[f?"animate":"css"]({width:n-t+"%"},{queue:!1,duration:u.animate})):(r===0&&a.range.stop(1,1)[f?"animate":"css"]({bottom:n+"%"},u.animate),r===1&&a.range[f?"animate":"css"]({height:n-t+"%"},{queue:!1,duration:u.animate})));t=n}):(r=this.value(),i=this._valueMin(),s=this._valueMax(),n=s!==i?(r-i)/(s-i)*100:0,l[this.orientation==="horizontal"?"left":"bottom"]=n+"%",this.handle.stop(1,1)[f?"animate":"css"](l,u.animate),o==="min"&&this.orientation==="horizontal"&&this.range.stop(1,1)[f?"animate":"css"]({width:n+"%"},u.animate),o==="max"&&this.orientation==="horizontal"&&this.range[f?"animate":"css"]({width:100-n+"%"},{queue:!1,duration:u.animate}),o==="min"&&this.orientation==="vertical"&&this.range.stop(1,1)[f?"animate":"css"]({height:n+"%"},u.animate),o==="max"&&this.orientation==="vertical"&&this.range[f?"animate":"css"]({height:100-n+"%"},{queue:!1,duration:u.animate}))}})}(jQuery),function(e){function n(t,n){var r=(t.attr("aria-describedby")||"").split(/\s+/);r.push(n);t.data("ui-tooltip-id",n).attr("aria-describedby",e.trim(r.join(" ")))}function r(t){var n=t.data("ui-tooltip-id"),r=(t.attr("aria-describedby")||"").split(/\s+/),i=e.inArray(n,r);i!==-1&&r.splice(i,1);t.removeData("ui-tooltip-id");r=e.trim(r.join(" "));r?t.attr("aria-describedby",r):t.removeAttr("aria-describedby")}var t=0;e.widget("ui.tooltip",{version:"1.9.1",options:{content:function(){return e(this).attr("title")},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flipfit"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"});this.tooltips={};this.parents={};this.options.disabled&&this._disable()},_setOption:function(t,n){var r=this;if(t==="disabled"){this[n?"_disable":"_enable"]();this.options[t]=n;return}this._super(t,n);t==="content"&&e.each(this.tooltips,function(e,t){r._updateContent(t)})},_disable:function(){var t=this;e.each(this.tooltips,function(n,r){var i=e.Event("blur");i.target=i.currentTarget=r[0];t.close(i,!0)});this.element.find(this.options.items).andSelf().each(function(){var t=e(this);t.is("[title]")&&t.data("ui-tooltip-title",t.attr("title")).attr("title","")})},_enable:function(){this.element.find(this.options.items).andSelf().each(function(){var t=e(this);t.data("ui-tooltip-title")&&t.attr("title",t.data("ui-tooltip-title"))})},open:function(t){var n=this,r=e(t?t.target:this.element).closest(this.options.items);if(r.length){if(this.options.track&&r.data("ui-tooltip-id")){this._find(r).position(e.extend({of:r},this.options.position));this._off(this.document,"mousemove");return}r.attr("title")&&r.data("ui-tooltip-title",r.attr("title"));r.data("tooltip-open",!0);t&&t.type==="mouseover"&&r.parents().each(function(){var t;e(this).data("tooltip-open")&&(t=e.Event("blur"),t.target=t.currentTarget=this,n.close(t,!0));this.title&&(e(this).uniqueId(),n.parents[this.id]={element:this,title:this.title},this.title="")});this._updateContent(r,t)}},_updateContent:function(e,t){var n,r=this.options.content,i=this;if(typeof r=="string")return this._open(t,e,r);n=r.call(e[0],function(n){e.data("tooltip-open")&&i._delay(function(){this._open(t,e,n)})});n&&this._open(t,e,n)},_open:function(t,r,i){function f(e){(a.of=e,s.is(":hidden"))||s.position(a)}var s,o,u,a=e.extend({},this.options.position);if(i){if(s=this._find(r),s.length){s.find(".ui-tooltip-content").html(i);return}r.is("[title]")&&(t&&t.type==="mouseover"?r.attr("title",""):r.removeAttr("title"));s=this._tooltip(r);n(r,s.attr("id"));s.find(".ui-tooltip-content").html(i);this.options.track&&t&&/^mouse/.test(t.originalEvent.type)?(this._on(this.document,{mousemove:f}),f(t)):s.position(e.extend({of:r},this.options.position));s.hide();this._show(s,this.options.show);this.options.show&&this.options.show.delay&&(u=setInterval(function(){s.is(":visible")&&(f(a.of),clearInterval(u))},e.fx.interval));this._trigger("open",t,{tooltip:s});o={keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var n=e.Event(t);n.currentTarget=r[0];this.close(n,!0)}},remove:function(){this._removeTooltip(s)}};t&&t.type!=="mouseover"||(o.mouseleave="close");t&&t.type!=="focusin"||(o.focusout="close");this._on(r,o)}},close:function(t){var n=this,i=e(t?t.currentTarget:this.element),s=this._find(i);this.closing||(i.data("ui-tooltip-title")&&i.attr("title",i.data("ui-tooltip-title")),r(i),s.stop(!0),this._hide(s,this.options.hide,function(){n._removeTooltip(e(this))}),i.removeData("tooltip-open"),this._off(i,"mouseleave focusout keyup"),i[0]!==this.element[0]&&this._off(i,"remove"),this._off(this.document,"mousemove"),t&&t.type==="mouseleave"&&e.each(this.parents,function(e,t){t.element.title=t.title;delete n.parents[e]}),this.closing=!0,this._trigger("close",t,{tooltip:s}),this.closing=!1)},_tooltip:function(n){var r="ui-tooltip-"+t++,i=e("<div>").attr({id:r,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));return e("<div>").addClass("ui-tooltip-content").appendTo(i),i.appendTo(this.document[0].body),e.fn.bgiframe&&i.bgiframe(),this.tooltips[r]=n,i},_find:function(t){var n=t.data("ui-tooltip-id");return n?e("#"+n):e()},_removeTooltip:function(e){e.remove();delete this.tooltips[e.attr("id")]},_destroy:function(){var t=this;e.each(this.tooltips,function(n,r){var i=e.Event("blur");i.target=i.currentTarget=r[0];t.close(i,!0);e("#"+n).remove();r.data("ui-tooltip-title")&&(r.attr("title",r.data("ui-tooltip-title")),r.removeData("ui-tooltip-title"))})}})}(jQuery);jQuery.base64=function(){function _getbyte64(s,i){var idx=_ALPHA.indexOf(s.charAt(i));if(idx===-1)throw"Cannot decode base64";return idx}function _decode(s){var pads=0,i,b10,imax=s.length,x=[];if(s=String(s),imax===0)return s;if(imax%4!=0)throw"Cannot decode base64";for(s.charAt(imax-1)===_PADCHAR&&(pads=1,s.charAt(imax-2)===_PADCHAR&&(pads=2),imax-=4),i=0;i<imax;i+=4)b10=_getbyte64(s,i)<<18|_getbyte64(s,i+1)<<12|_getbyte64(s,i+2)<<6|_getbyte64(s,i+3),x.push(String.fromCharCode(b10>>16,b10>>8&255,b10&255));switch(pads){case 1:b10=_getbyte64(s,i)<<18|_getbyte64(s,i+1)<<12|_getbyte64(s,i+2)<<6;x.push(String.fromCharCode(b10>>16,b10>>8&255));break;case 2:b10=_getbyte64(s,i)<<18|_getbyte64(s,i+1)<<12;x.push(String.fromCharCode(b10>>16))}return x.join("")}function _getbyte(s,i){var x=s.charCodeAt(i);if(x>255)throw"INVALID_CHARACTER_ERR: DOM Exception 5";return x}function _encode(s){if(arguments.length!==1)throw"SyntaxError: exactly one argument required";s=String(s);var i,b10,x=[],imax=s.length-s.length%3;if(s.length===0)return s;for(i=0;i<imax;i+=3)b10=_getbyte(s,i)<<16|_getbyte(s,i+1)<<8|_getbyte(s,i+2),x.push(_ALPHA.charAt(b10>>18)),x.push(_ALPHA.charAt(b10>>12&63)),x.push(_ALPHA.charAt(b10>>6&63)),x.push(_ALPHA.charAt(b10&63));switch(s.length-imax){case 1:b10=_getbyte(s,i)<<16;x.push(_ALPHA.charAt(b10>>18)+_ALPHA.charAt(b10>>12&63)+_PADCHAR+_PADCHAR);break;case 2:b10=_getbyte(s,i)<<16|_getbyte(s,i+1)<<8;x.push(_ALPHA.charAt(b10>>18)+_ALPHA.charAt(b10>>12&63)+_ALPHA.charAt(b10>>6&63)+_PADCHAR)}return x.join("")}var _PADCHAR="=",_ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";return{decode:_decode,encode:_encode,VERSION:"1.0"}}(jQuery);
/**
 * @license
 * Lo-Dash 2.3.0 (Custom Build) <http://lodash.com/>
 * Build: `lodash modern -o ./dist/lodash.js`
 * Copyright 2012-2013 The Dojo Foundation <http://dojofoundation.org/>
 * Based on Underscore.js 1.5.2 <http://underscorejs.org/LICENSE>
 * Copyright 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 * Available under MIT license <http://lodash.com/license>
 */
(function(){function baseIndexOf(array,value,fromIndex){for(var index=(fromIndex||0)-1,length=array?array.length:0;++index<length;)if(array[index]===value)return index;return-1}function cacheIndexOf(cache,value){var type=typeof value,key;return(cache=cache.cache,type=="boolean"||value==null)?cache[value]?0:-1:(type!="number"&&type!="string"&&(type="object"),key=type=="number"?value:keyPrefix+value,cache=(cache=cache[type])&&cache[key],type=="object"?cache&&baseIndexOf(cache,value)>-1?0:-1:cache?0:-1)}function cachePush(value){var cache=this.cache,type=typeof value,key,typeCache;type=="boolean"||value==null?cache[value]=!0:(type!="number"&&type!="string"&&(type="object"),key=type=="number"?value:keyPrefix+value,typeCache=cache[type]||(cache[type]={}),type=="object"?(typeCache[key]||(typeCache[key]=[])).push(value):typeCache[key]=!0)}function charAtCallback(value){return value.charCodeAt(0)}function compareAscending(a,b){var ac=a.criteria,bc=b.criteria;if(ac!==bc){if(ac>bc||typeof ac=="undefined")return 1;if(ac<bc||typeof bc=="undefined")return-1}return a.index-b.index}function createCache(array){var index=-1,length=array.length,first=array[0],mid=array[length/2|0],last=array[length-1],cache,result;if(first&&typeof first=="object"&&mid&&typeof mid=="object"&&last&&typeof last=="object")return!1;for(cache=getObject(),cache["false"]=cache["null"]=cache["true"]=cache.undefined=!1,result=getObject(),result.array=array,result.cache=cache,result.push=cachePush;++index<length;)result.push(array[index]);return result}function escapeStringChar(match){return"\\"+stringEscapes[match]}function getArray(){return arrayPool.pop()||[]}function getObject(){return objectPool.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function releaseArray(array){array.length=0;arrayPool.length<maxPoolSize&&arrayPool.push(array)}function releaseObject(object){var cache=object.cache;cache&&releaseObject(cache);object.array=object.cache=object.criteria=object.object=object.number=object.string=object.value=null;objectPool.length<maxPoolSize&&objectPool.push(object)}function slice(array,start,end){start||(start=0);typeof end=="undefined"&&(end=array?array.length:0);for(var index=-1,length=end-start||0,result=Array(length<0?0:length);++index<length;)result[index]=array[start+index];return result}function runInContext(context){function lodash(value){return value&&typeof value=="object"&&!isArray(value)&&hasOwnProperty.call(value,"__wrapped__")?value:new lodashWrapper(value)}function lodashWrapper(value,chainAll){this.__chain__=!!chainAll;this.__wrapped__=value}function baseBind(bindData){function bound(){var args,thisBinding,result;return(partialArgs&&(args=partialArgs.slice(),push.apply(args,arguments)),this instanceof bound)?(thisBinding=baseCreate(func.prototype),result=func.apply(thisBinding,args||arguments),isObject(result)?result:thisBinding):func.apply(thisArg,args||arguments)}var func=bindData[0],partialArgs=bindData[2],thisArg=bindData[4];return setBindData(bound,bindData),bound}function baseClone(value,isDeep,callback,stackA,stackB){var result,isObj,className,ctor,isArr,initedStack,length;if(callback&&(result=callback(value),typeof result!="undefined"))return result;if(isObj=isObject(value),isObj){if(className=toString.call(value),!cloneableClasses[className])return value;ctor=ctorByClass[className];switch(className){case boolClass:case dateClass:return new ctor(+value);case numberClass:case stringClass:return new ctor(value);case regexpClass:return result=ctor(value.source,reFlags.exec(value)),result.lastIndex=value.lastIndex,result}}else return value;if(isArr=isArray(value),isDeep){for(initedStack=!stackA,stackA||(stackA=getArray()),stackB||(stackB=getArray()),length=stackA.length;length--;)if(stackA[length]==value)return stackB[length];result=isArr?ctor(value.length):{}}else result=isArr?slice(value):assign({},value);return(isArr&&(hasOwnProperty.call(value,"index")&&(result.index=value.index),hasOwnProperty.call(value,"input")&&(result.input=value.input)),!isDeep)?result:(stackA.push(value),stackB.push(result),(isArr?forEach:forOwn)(value,function(objValue,key){result[key]=baseClone(objValue,isDeep,callback,stackA,stackB)}),initedStack&&(releaseArray(stackA),releaseArray(stackB)),result)}function baseCreate(prototype){return isObject(prototype)?nativeCreate(prototype):{}}function baseCreateCallback(func,thisArg,argCount){var bindData,source;if(typeof func!="function")return identity;if(typeof thisArg=="undefined"||!("prototype"in func)||(bindData=func.__bindData__,typeof bindData=="undefined"&&(support.funcNames&&(bindData=!func.name),bindData=bindData||!support.funcDecomp,bindData||(source=fnToString.call(func),support.funcNames||(bindData=!reFuncName.test(source)),bindData||(bindData=reThis.test(source),setBindData(func,bindData)))),bindData===!1||bindData!==!0&&bindData[1]&1))return func;switch(argCount){case 1:return function(value){return func.call(thisArg,value)};case 2:return function(a,b){return func.call(thisArg,a,b)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection)}}return bind(func,thisArg)}function baseCreateWrapper(bindData){function bound(){var thisBinding=isBind?thisArg:this,args,result;return(partialArgs&&(args=partialArgs.slice(),push.apply(args,arguments)),(partialRightArgs||isCurry)&&(args||(args=slice(arguments)),partialRightArgs&&push.apply(args,partialRightArgs),isCurry&&args.length<arity))?(bitmask|=16,baseCreateWrapper([func,isCurryBound?bitmask:bitmask&-4,args,null,thisArg,arity])):(args||(args=arguments),isBindKey&&(func=thisBinding[key]),this instanceof bound)?(thisBinding=baseCreate(func.prototype),result=func.apply(thisBinding,args),isObject(result)?result:thisBinding):func.apply(thisBinding,args)}var func=bindData[0],bitmask=bindData[1],partialArgs=bindData[2],partialRightArgs=bindData[3],thisArg=bindData[4],arity=bindData[5],isBind=bitmask&1,isBindKey=bitmask&2,isCurry=bitmask&4,isCurryBound=bitmask&8,key=func;return setBindData(bound,bindData),bound}function baseDifference(array,values){var index=-1,indexOf=getIndexOf(),length=array?array.length:0,isLarge=length>=largeArraySize&&indexOf===baseIndexOf,result=[],cache,value;for(isLarge&&(cache=createCache(values),cache?(indexOf=cacheIndexOf,values=cache):isLarge=!1);++index<length;)value=array[index],indexOf(values,value)<0&&result.push(value);return isLarge&&releaseObject(values),result}function baseFlatten(array,isShallow,isStrict,fromIndex){for(var index=(fromIndex||0)-1,length=array?array.length:0,result=[],value;++index<length;)if(value=array[index],value&&typeof value=="object"&&typeof value.length=="number"&&(isArray(value)||isArguments(value))){isShallow||(value=baseFlatten(value,isShallow,isStrict));var valIndex=-1,valLength=value.length,resIndex=result.length;for(result.length+=valLength;++valIndex<valLength;)result[resIndex++]=value[valIndex]}else isStrict||result.push(value);return result}function baseIsEqual(a,b,callback,isWhere,stackA,stackB){var result,type,otherType,className,otherClass,isArr,aWrapped,bWrapped,ctorA,ctorB,initedStack,length,size,index,value;if(callback&&(result=callback(a,b),typeof result!="undefined"))return!!result;if(a===b)return a!==0||1/a==1/b;if(type=typeof a,otherType=typeof b,a===a&&!(a&&objectTypes[type])&&!(b&&objectTypes[otherType]))return!1;if(a==null||b==null)return a===b;if(className=toString.call(a),otherClass=toString.call(b),className==argsClass&&(className=objectClass),otherClass==argsClass&&(otherClass=objectClass),className!=otherClass)return!1;switch(className){case boolClass:case dateClass:return+a==+b;case numberClass:return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case regexpClass:case stringClass:return a==String(b)}if(isArr=className==arrayClass,!isArr){if(aWrapped=hasOwnProperty.call(a,"__wrapped__"),bWrapped=hasOwnProperty.call(b,"__wrapped__"),aWrapped||bWrapped)return baseIsEqual(aWrapped?a.__wrapped__:a,bWrapped?b.__wrapped__:b,callback,isWhere,stackA,stackB);if(className!=objectClass||(ctorA=a.constructor,ctorB=b.constructor,ctorA!=ctorB&&!(isFunction(ctorA)&&ctorA instanceof ctorA&&isFunction(ctorB)&&ctorB instanceof ctorB)&&"constructor"in a&&"constructor"in b))return!1}for(initedStack=!stackA,stackA||(stackA=getArray()),stackB||(stackB=getArray()),length=stackA.length;length--;)if(stackA[length]==a)return stackB[length]==b;if(size=0,result=!0,stackA.push(a),stackB.push(b),isArr){if(length=a.length,size=b.length,result=size==a.length,!result&&!isWhere)return result;while(size--)if(index=length,value=b[size],isWhere){while(index--)if(result=baseIsEqual(a[index],value,callback,isWhere,stackA,stackB))break}else if(!(result=baseIsEqual(a[size],value,callback,isWhere,stackA,stackB)))break;return result}return forIn(b,function(value,key,b){if(hasOwnProperty.call(b,key))return size++,result=hasOwnProperty.call(a,key)&&baseIsEqual(a[key],value,callback,isWhere,stackA,stackB)}),result&&!isWhere&&forIn(a,function(value,key,a){if(hasOwnProperty.call(a,key))return result=--size>-1}),initedStack&&(releaseArray(stackA),releaseArray(stackB)),result}function baseMerge(object,source,callback,stackA,stackB){(isArray(source)?forEach:forOwn)(source,function(source,key){var found,isArr,result=source,value=object[key],stackLength,isShallow;if(source&&((isArr=isArray(source))||isPlainObject(source))){for(stackLength=stackA.length;stackLength--;)if(found=stackA[stackLength]==source){value=stackB[stackLength];break}found||(callback&&(result=callback(value,source),(isShallow=typeof result!="undefined")&&(value=result)),isShallow||(value=isArr?isArray(value)?value:[]:isPlainObject(value)?value:{}),stackA.push(source),stackB.push(value),isShallow||baseMerge(value,source,callback,stackA,stackB))}else callback&&(result=callback(value,source),typeof result=="undefined"&&(result=source)),typeof result!="undefined"&&(value=result);object[key]=value})}function baseRandom(min,max){return min+floor(nativeRandom()*(max-min+1))}function baseUniq(array,isSorted,callback){var index=-1,indexOf=getIndexOf(),length=array?array.length:0,result=[],isLarge=!isSorted&&length>=largeArraySize&&indexOf===baseIndexOf,seen=callback||isLarge?getArray():result,cache,value,computed;for(isLarge&&(cache=createCache(seen),cache?(indexOf=cacheIndexOf,seen=cache):(isLarge=!1,seen=callback?seen:(releaseArray(seen),result)));++index<length;)value=array[index],computed=callback?callback(value,index,array):value,(isSorted?!index||seen[seen.length-1]!==computed:indexOf(seen,computed)<0)&&((callback||isLarge)&&seen.push(computed),result.push(value));return isLarge?(releaseArray(seen.array),releaseObject(seen)):callback&&releaseArray(seen),result}function createAggregator(setter){return function(collection,callback,thisArg){var result={},index,length,value;if(callback=lodash.createCallback(callback,thisArg,3),index=-1,length=collection?collection.length:0,typeof length=="number")while(++index<length)value=collection[index],setter(result,value,callback(value,index,collection),collection);else forOwn(collection,function(value,key,collection){setter(result,value,callback(value,key,collection),collection)});return result}}function createWrapper(func,bitmask,partialArgs,partialRightArgs,thisArg,arity){var isBind=bitmask&1,isBindKey=bitmask&2,isCurry=bitmask&4,isCurryBound=bitmask&8,isPartial=bitmask&16,isPartialRight=bitmask&32,bindData,creater;if(!isBindKey&&!isFunction(func))throw new TypeError;return(isPartial&&!partialArgs.length&&(bitmask&=-17,isPartial=partialArgs=!1),isPartialRight&&!partialRightArgs.length&&(bitmask&=-33,isPartialRight=partialRightArgs=!1),bindData=func&&func.__bindData__,bindData&&bindData!==!0)?(bindData=bindData.slice(),!isBind||bindData[1]&1||(bindData[4]=thisArg),!isBind&&bindData[1]&1&&(bitmask|=8),!isCurry||bindData[1]&4||(bindData[5]=arity),isPartial&&push.apply(bindData[2]||(bindData[2]=[]),partialArgs),isPartialRight&&push.apply(bindData[3]||(bindData[3]=[]),partialRightArgs),bindData[1]|=bitmask,createWrapper.apply(null,bindData)):(creater=bitmask==1||bitmask===17?baseBind:baseCreateWrapper,creater([func,bitmask,partialArgs,partialRightArgs,thisArg,arity]))}function escapeHtmlChar(match){return htmlEscapes[match]}function getIndexOf(){var result=(result=lodash.indexOf)===indexOf?baseIndexOf:result;return result}function shimIsPlainObject(value){var ctor,result;return!(value&&toString.call(value)==objectClass)||(ctor=value.constructor,isFunction(ctor)&&!(ctor instanceof ctor))?!1:(forIn(value,function(value,key){result=key}),typeof result=="undefined"||hasOwnProperty.call(value,result))}function unescapeHtmlChar(match){return htmlUnescapes[match]}function isArguments(value){return value&&typeof value=="object"&&typeof value.length=="number"&&toString.call(value)==argsClass||!1}function clone(value,isDeep,callback,thisArg){return typeof isDeep!="boolean"&&isDeep!=null&&(thisArg=callback,callback=isDeep,isDeep=!1),baseClone(value,isDeep,typeof callback=="function"&&baseCreateCallback(callback,thisArg,1))}function cloneDeep(value,callback,thisArg){return baseClone(value,!0,typeof callback=="function"&&baseCreateCallback(callback,thisArg,1))}function create(prototype,properties){var result=baseCreate(prototype);return properties?assign(result,properties):result}function findKey(object,callback,thisArg){var result;return callback=lodash.createCallback(callback,thisArg,3),forOwn(object,function(value,key,object){if(callback(value,key,object))return result=key,!1}),result}function findLastKey(object,callback,thisArg){var result;return callback=lodash.createCallback(callback,thisArg,3),forOwnRight(object,function(value,key,object){if(callback(value,key,object))return result=key,!1}),result}function forInRight(object,callback,thisArg){var pairs=[],length;for(forIn(object,function(value,key){pairs.push(key,value)}),length=pairs.length,callback=baseCreateCallback(callback,thisArg,3);length--;)if(callback(pairs[length--],pairs[length],object)===!1)break;return object}function forOwnRight(object,callback,thisArg){var props=keys(object),length=props.length,key;for(callback=baseCreateCallback(callback,thisArg,3);length--;)if(key=props[length],callback(object[key],key,object)===!1)break;return object}function functions(object){var result=[];return forIn(object,function(value,key){isFunction(value)&&result.push(key)}),result.sort()}function has(object,property){return object?hasOwnProperty.call(object,property):!1}function invert(object){for(var index=-1,props=keys(object),length=props.length,result={},key;++index<length;)key=props[index],result[object[key]]=key;return result}function isBoolean(value){return value===!0||value===!1||value&&typeof value=="object"&&toString.call(value)==boolClass||!1}function isDate(value){return value&&typeof value=="object"&&toString.call(value)==dateClass||!1}function isElement(value){return value&&value.nodeType===1||!1}function isEmpty(value){var result=!0,className,length;return value?(className=toString.call(value),length=value.length,className==arrayClass||className==stringClass||className==argsClass||className==objectClass&&typeof length=="number"&&isFunction(value.splice))?!length:(forOwn(value,function(){return result=!1}),result):result}function isEqual(a,b,callback,thisArg){return baseIsEqual(a,b,typeof callback=="function"&&baseCreateCallback(callback,thisArg,2))}function isFinite(value){return nativeIsFinite(value)&&!nativeIsNaN(parseFloat(value))}function isFunction(value){return typeof value=="function"}function isObject(value){return!!(value&&objectTypes[typeof value])}function isNaN(value){return isNumber(value)&&value!=+value}function isNull(value){return value===null}function isNumber(value){return typeof value=="number"||value&&typeof value=="object"&&toString.call(value)==numberClass||!1}function isRegExp(value){return value&&typeof value=="object"&&toString.call(value)==regexpClass||!1}function isString(value){return typeof value=="string"||value&&typeof value=="object"&&toString.call(value)==stringClass||!1}function isUndefined(value){return typeof value=="undefined"}function merge(object){var args=arguments,length=2,callback;if(!isObject(object))return object;typeof args[2]!="number"&&(length=args.length);length>3&&typeof args[length-2]=="function"?callback=baseCreateCallback(args[--length-1],args[length--],2):length>2&&typeof args[length-1]=="function"&&(callback=args[--length]);for(var sources=slice(arguments,1,length),index=-1,stackA=getArray(),stackB=getArray();++index<length;)baseMerge(object,sources[index],callback,stackA,stackB);return releaseArray(stackA),releaseArray(stackB),object}function omit(object,callback,thisArg){var result={},props,index,length,key;if(typeof callback!="function")for(props=[],forIn(object,function(value,key){props.push(key)}),props=baseDifference(props,baseFlatten(arguments,!0,!1,1)),index=-1,length=props.length;++index<length;)key=props[index],result[key]=object[key];else callback=lodash.createCallback(callback,thisArg,3),forIn(object,function(value,key,object){callback(value,key,object)||(result[key]=value)});return result}function pairs(object){for(var index=-1,props=keys(object),length=props.length,result=Array(length),key;++index<length;)key=props[index],result[index]=[key,object[key]];return result}function pick(object,callback,thisArg){var result={},key;if(typeof callback!="function")for(var index=-1,props=baseFlatten(arguments,!0,!1,1),length=isObject(object)?props.length:0;++index<length;)key=props[index],key in object&&(result[key]=object[key]);else callback=lodash.createCallback(callback,thisArg,3),forIn(object,function(value,key,object){callback(value,key,object)&&(result[key]=value)});return result}function transform(object,callback,accumulator,thisArg){var isArr=isArray(object),ctor,proto;return accumulator==null&&(isArr?accumulator=[]:(ctor=object&&object.constructor,proto=ctor&&ctor.prototype,accumulator=baseCreate(proto))),callback&&(callback=lodash.createCallback(callback,thisArg,4),(isArr?forEach:forOwn)(object,function(value,index,object){return callback(accumulator,value,index,object)})),accumulator}function values(object){for(var index=-1,props=keys(object),length=props.length,result=Array(length);++index<length;)result[index]=object[props[index]];return result}function at(collection){for(var args=arguments,index=-1,props=baseFlatten(args,!0,!1,1),length=args[2]&&args[2][args[1]]===collection?1:props.length,result=Array(length);++index<length;)result[index]=collection[props[index]];return result}function contains(collection,target,fromIndex){var index=-1,indexOf=getIndexOf(),length=collection?collection.length:0,result=!1;return fromIndex=(fromIndex<0?nativeMax(0,length+fromIndex):fromIndex)||0,isArray(collection)?result=indexOf(collection,target,fromIndex)>-1:typeof length=="number"?result=(isString(collection)?collection.indexOf(target,fromIndex):indexOf(collection,target,fromIndex))>-1:forOwn(collection,function(value){if(++index>=fromIndex)return!(result=value===target)}),result}function every(collection,callback,thisArg){var result=!0,index,length;if(callback=lodash.createCallback(callback,thisArg,3),index=-1,length=collection?collection.length:0,typeof length=="number"){while(++index<length)if(!(result=!!callback(collection[index],index,collection)))break}else forOwn(collection,function(value,index,collection){return result=!!callback(value,index,collection)});return result}function filter(collection,callback,thisArg){var result=[],index,length,value;if(callback=lodash.createCallback(callback,thisArg,3),index=-1,length=collection?collection.length:0,typeof length=="number")while(++index<length)value=collection[index],callback(value,index,collection)&&result.push(value);else forOwn(collection,function(value,index,collection){callback(value,index,collection)&&result.push(value)});return result}function find(collection,callback,thisArg){var index,length,value,result;if(callback=lodash.createCallback(callback,thisArg,3),index=-1,length=collection?collection.length:0,typeof length=="number"){while(++index<length)if(value=collection[index],callback(value,index,collection))return value}else return forOwn(collection,function(value,index,collection){if(callback(value,index,collection))return result=value,!1}),result}function findLast(collection,callback,thisArg){var result;return callback=lodash.createCallback(callback,thisArg,3),forEachRight(collection,function(value,index,collection){if(callback(value,index,collection))return result=value,!1}),result}function forEach(collection,callback,thisArg){var index=-1,length=collection?collection.length:0;if(callback=callback&&typeof thisArg=="undefined"?callback:baseCreateCallback(callback,thisArg,3),typeof length=="number"){while(++index<length)if(callback(collection[index],index,collection)===!1)break}else forOwn(collection,callback);return collection}function forEachRight(collection,callback,thisArg){var length=collection?collection.length:0,props;if(callback=callback&&typeof thisArg=="undefined"?callback:baseCreateCallback(callback,thisArg,3),typeof length=="number"){while(length--)if(callback(collection[length],length,collection)===!1)break}else props=keys(collection),length=props.length,forOwn(collection,function(value,key,collection){return key=props?props[--length]:--length,callback(collection[key],key,collection)});return collection}function invoke(collection,methodName){var args=slice(arguments,2),index=-1,isFunc=typeof methodName=="function",length=collection?collection.length:0,result=Array(typeof length=="number"?length:0);return forEach(collection,function(value){result[++index]=(isFunc?methodName:value[methodName]).apply(value,args)}),result}function map(collection,callback,thisArg){var index=-1,length=collection?collection.length:0,result;if(callback=lodash.createCallback(callback,thisArg,3),typeof length=="number")for(result=Array(length);++index<length;)result[index]=callback(collection[index],index,collection);else result=[],forOwn(collection,function(value,key,collection){result[++index]=callback(value,key,collection)});return result}function max(collection,callback,thisArg){var computed=-Infinity,result=computed,index,length,value;if(typeof callback!="function"&&thisArg&&thisArg[callback]===collection&&(callback=null),callback==null&&isArray(collection))for(index=-1,length=collection.length;++index<length;)value=collection[index],value>result&&(result=value);else callback=callback==null&&isString(collection)?charAtCallback:lodash.createCallback(callback,thisArg,3),forEach(collection,function(value,index,collection){var current=callback(value,index,collection);current>computed&&(computed=current,result=value)});return result}function min(collection,callback,thisArg){var computed=Infinity,result=computed,index,length,value;if(typeof callback!="function"&&thisArg&&thisArg[callback]===collection&&(callback=null),callback==null&&isArray(collection))for(index=-1,length=collection.length;++index<length;)value=collection[index],value<result&&(result=value);else callback=callback==null&&isString(collection)?charAtCallback:lodash.createCallback(callback,thisArg,3),forEach(collection,function(value,index,collection){var current=callback(value,index,collection);current<computed&&(computed=current,result=value)});return result}function pluck(collection,property){var index=-1,length=collection?collection.length:0,result;if(typeof length=="number")for(result=Array(length);++index<length;)result[index]=collection[index][property];return result||map(collection,property)}function reduce(collection,callback,accumulator,thisArg){var noaccum,index,length;if(!collection)return accumulator;if(noaccum=arguments.length<3,callback=lodash.createCallback(callback,thisArg,4),index=-1,length=collection.length,typeof length=="number")for(noaccum&&(accumulator=collection[++index]);++index<length;)accumulator=callback(accumulator,collection[index],index,collection);else forOwn(collection,function(value,index,collection){accumulator=noaccum?(noaccum=!1,value):callback(accumulator,value,index,collection)});return accumulator}function reduceRight(collection,callback,accumulator,thisArg){var noaccum=arguments.length<3;return callback=lodash.createCallback(callback,thisArg,4),forEachRight(collection,function(value,index,collection){accumulator=noaccum?(noaccum=!1,value):callback(accumulator,value,index,collection)}),accumulator}function reject(collection,callback,thisArg){return callback=lodash.createCallback(callback,thisArg,3),filter(collection,function(value,index,collection){return!callback(value,index,collection)})}function sample(collection,n,guard){if(collection&&typeof collection.length!="number"&&(collection=values(collection)),n==null||guard)return collection?collection[baseRandom(0,collection.length-1)]:undefined;var result=shuffle(collection);return result.length=nativeMin(nativeMax(0,n),result.length),result}function shuffle(collection){var index=-1,length=collection?collection.length:0,result=Array(typeof length=="number"?length:0);return forEach(collection,function(value){var rand=baseRandom(0,++index);result[index]=result[rand];result[rand]=value}),result}function size(collection){var length=collection?collection.length:0;return typeof length=="number"?length:keys(collection).length}function some(collection,callback,thisArg){var result,index,length;if(callback=lodash.createCallback(callback,thisArg,3),index=-1,length=collection?collection.length:0,typeof length=="number"){while(++index<length)if(result=callback(collection[index],index,collection))break}else forOwn(collection,function(value,index,collection){return!(result=callback(value,index,collection))});return!!result}function sortBy(collection,callback,thisArg){var index=-1,length=collection?collection.length:0,result=Array(typeof length=="number"?length:0),object;for(callback=lodash.createCallback(callback,thisArg,3),forEach(collection,function(value,key,collection){var object=result[++index]=getObject();object.criteria=callback(value,key,collection);object.index=index;object.value=value}),length=result.length,result.sort(compareAscending);length--;)object=result[length],result[length]=object.value,releaseObject(object);return result}function toArray(collection){return collection&&typeof collection.length=="number"?slice(collection):values(collection)}function compact(array){for(var index=-1,length=array?array.length:0,result=[],value;++index<length;)value=array[index],value&&result.push(value);return result}function difference(array){return baseDifference(array,baseFlatten(arguments,!0,!0,1))}function findIndex(array,callback,thisArg){var index=-1,length=array?array.length:0;for(callback=lodash.createCallback(callback,thisArg,3);++index<length;)if(callback(array[index],index,array))return index;return-1}function findLastIndex(array,callback,thisArg){var length=array?array.length:0;for(callback=lodash.createCallback(callback,thisArg,3);length--;)if(callback(array[length],length,array))return length;return-1}function first(array,callback,thisArg){var n=0,length=array?array.length:0,index;if(typeof callback!="number"&&callback!=null)for(index=-1,callback=lodash.createCallback(callback,thisArg,3);++index<length&&callback(array[index],index,array);)n++;else if(n=callback,n==null||thisArg)return array?array[0]:undefined;return slice(array,0,nativeMin(nativeMax(0,n),length))}function flatten(array,isShallow,callback,thisArg){return typeof isShallow!="boolean"&&isShallow!=null&&(thisArg=callback,callback=typeof isShallow!="function"&&thisArg&&thisArg[isShallow]===array?null:isShallow,isShallow=!1),callback!=null&&(array=map(array,callback,thisArg)),baseFlatten(array,isShallow)}function indexOf(array,value,fromIndex){var length,index;if(typeof fromIndex=="number")length=array?array.length:0,fromIndex=fromIndex<0?nativeMax(0,length+fromIndex):fromIndex||0;else if(fromIndex)return index=sortedIndex(array,value),array[index]===value?index:-1;return baseIndexOf(array,value,fromIndex)}function initial(array,callback,thisArg){var n=0,length=array?array.length:0,index;if(typeof callback!="number"&&callback!=null)for(index=length,callback=lodash.createCallback(callback,thisArg,3);index--&&callback(array[index],index,array);)n++;else n=callback==null||thisArg?1:callback||n;return slice(array,0,nativeMin(nativeMax(0,length-n),length))}function intersection(array){for(var args=arguments,argsLength=args.length,argsIndex=-1,caches=getArray(),index=-1,indexOf=getIndexOf(),length=array?array.length:0,result=[],seen=getArray(),value,cache;++argsIndex<argsLength;)value=args[argsIndex],caches[argsIndex]=indexOf===baseIndexOf&&(value?value.length:0)>=largeArraySize&&createCache(argsIndex?args[argsIndex]:seen);outer:while(++index<length)if(cache=caches[0],value=array[index],(cache?cacheIndexOf(cache,value):indexOf(seen,value))<0){for(argsIndex=argsLength,(cache||seen).push(value);--argsIndex;)if(cache=caches[argsIndex],(cache?cacheIndexOf(cache,value):indexOf(args[argsIndex],value))<0)continue outer;result.push(value)}while(argsLength--)cache=caches[argsLength],cache&&releaseObject(cache);return releaseArray(caches),releaseArray(seen),result}function last(array,callback,thisArg){var n=0,length=array?array.length:0,index;if(typeof callback!="number"&&callback!=null)for(index=length,callback=lodash.createCallback(callback,thisArg,3);index--&&callback(array[index],index,array);)n++;else if(n=callback,n==null||thisArg)return array?array[length-1]:undefined;return slice(array,nativeMax(0,length-n))}function lastIndexOf(array,value,fromIndex){var index=array?array.length:0;for(typeof fromIndex=="number"&&(index=(fromIndex<0?nativeMax(0,index+fromIndex):nativeMin(fromIndex,index-1))+1);index--;)if(array[index]===value)return index;return-1}function pull(array){for(var args=arguments,argsIndex=0,argsLength=args.length,length=array?array.length:0,index,value;++argsIndex<argsLength;)for(index=-1,value=args[argsIndex];++index<length;)array[index]===value&&(splice.call(array,index--,1),length--);return array}function range(start,end,step){start=+start||0;step=typeof step=="number"?step:+step||1;end==null&&(end=start,start=0);for(var index=-1,length=nativeMax(0,ceil((end-start)/(step||1))),result=Array(length);++index<length;)result[index]=start,start+=step;return result}function remove(array,callback,thisArg){var index=-1,length=array?array.length:0,result=[],value;for(callback=lodash.createCallback(callback,thisArg,3);++index<length;)value=array[index],callback(value,index,array)&&(result.push(value),splice.call(array,index--,1),length--);return result}function rest(array,callback,thisArg){if(typeof callback!="number"&&callback!=null){var n=0,index=-1,length=array?array.length:0;for(callback=lodash.createCallback(callback,thisArg,3);++index<length&&callback(array[index],index,array);)n++}else n=callback==null||thisArg?1:nativeMax(0,callback);return slice(array,n)}function sortedIndex(array,value,callback,thisArg){var low=0,high=array?array.length:low,mid;for(callback=callback?lodash.createCallback(callback,thisArg,1):identity,value=callback(value);low<high;)mid=low+high>>>1,callback(array[mid])<value?low=mid+1:high=mid;return low}function union(){return baseUniq(baseFlatten(arguments,!0,!0))}function uniq(array,isSorted,callback,thisArg){return typeof isSorted!="boolean"&&isSorted!=null&&(thisArg=callback,callback=typeof isSorted!="function"&&thisArg&&thisArg[isSorted]===array?null:isSorted,isSorted=!1),callback!=null&&(callback=lodash.createCallback(callback,thisArg,3)),baseUniq(array,isSorted,callback)}function without(array){return baseDifference(array,slice(arguments,1))}function zip(){for(var array=arguments.length>1?arguments:arguments[0],index=-1,length=array?max(pluck(array,"length")):0,result=Array(length<0?0:length);++index<length;)result[index]=pluck(array,index);return result}function zipObject(keys,values){for(var index=-1,length=keys?keys.length:0,result={},key;++index<length;)key=keys[index],values?result[key]=values[index]:key&&(result[key[0]]=key[1]);return result}function after(n,func){if(!isFunction(func))throw new TypeError;return function(){if(--n<1)return func.apply(this,arguments)}}function bind(func,thisArg){return arguments.length>2?createWrapper(func,17,slice(arguments,2),null,thisArg):createWrapper(func,1,null,null,thisArg)}function bindAll(object){for(var funcs=arguments.length>1?baseFlatten(arguments,!0,!1,1):functions(object),index=-1,length=funcs.length,key;++index<length;)key=funcs[index],object[key]=createWrapper(object[key],1,null,null,object);return object}function bindKey(object,key){return arguments.length>2?createWrapper(key,19,slice(arguments,2),null,object):createWrapper(key,3,null,null,object)}function compose(){for(var funcs=arguments,length=funcs.length;length--;)if(!isFunction(funcs[length]))throw new TypeError;return function(){for(var args=arguments,length=funcs.length;length--;)args=[funcs[length].apply(this,args)];return args[0]}}function createCallback(func,thisArg,argCount){var type=typeof func;if(func==null||type=="function")return baseCreateCallback(func,thisArg,argCount);if(type!="object")return function(object){return object[func]};var props=keys(func),key=props[0],a=func[key];return props.length==1&&a===a&&!isObject(a)?function(object){var b=object[key];return a===b&&(a!==0||1/a==1/b)}:function(object){for(var length=props.length,result=!1;length--;)if(!(result=baseIsEqual(object[props[length]],func[props[length]],null,!0)))break;return result}}function curry(func,arity){return arity=typeof arity=="number"?arity:+arity||func.length,createWrapper(func,4,null,null,null,arity)}function debounce(func,wait,options){var args,maxTimeoutId,result,stamp,thisArg,timeoutId,trailingCall,lastCalled=0,maxWait=!1,trailing=!0,leading,delayed,maxDelayed;if(!isFunction(func))throw new TypeError;return wait=nativeMax(0,wait)||0,options===!0?(leading=!0,trailing=!1):isObject(options)&&(leading=options.leading,maxWait="maxWait"in options&&(nativeMax(wait,options.maxWait)||0),trailing="trailing"in options?options.trailing:trailing),delayed=function(){var remaining=wait-(now()-stamp),isCalled;remaining<=0?(maxTimeoutId&&clearTimeout(maxTimeoutId),isCalled=trailingCall,maxTimeoutId=timeoutId=trailingCall=undefined,isCalled&&(lastCalled=now(),result=func.apply(thisArg,args),timeoutId||maxTimeoutId||(args=thisArg=null))):timeoutId=setTimeout(delayed,remaining)},maxDelayed=function(){timeoutId&&clearTimeout(timeoutId);maxTimeoutId=timeoutId=trailingCall=undefined;(trailing||maxWait!==wait)&&(lastCalled=now(),result=func.apply(thisArg,args),timeoutId||maxTimeoutId||(args=thisArg=null))},function(){var leadingCall,remaining,isCalled;return args=arguments,stamp=now(),thisArg=this,trailingCall=trailing&&(timeoutId||!leading),maxWait===!1?leadingCall=leading&&!timeoutId:(maxTimeoutId||leading||(lastCalled=stamp),remaining=maxWait-(stamp-lastCalled),isCalled=remaining<=0,isCalled?(maxTimeoutId&&(maxTimeoutId=clearTimeout(maxTimeoutId)),lastCalled=stamp,result=func.apply(thisArg,args)):maxTimeoutId||(maxTimeoutId=setTimeout(maxDelayed,remaining))),isCalled&&timeoutId?timeoutId=clearTimeout(timeoutId):timeoutId||wait===maxWait||(timeoutId=setTimeout(delayed,wait)),leadingCall&&(isCalled=!0,result=func.apply(thisArg,args)),!isCalled||timeoutId||maxTimeoutId||(args=thisArg=null),result}}function defer(func){if(!isFunction(func))throw new TypeError;var args=slice(arguments,1);return setTimeout(function(){func.apply(undefined,args)},1)}function delay(func,wait){if(!isFunction(func))throw new TypeError;var args=slice(arguments,2);return setTimeout(function(){func.apply(undefined,args)},wait)}function memoize(func,resolver){if(!isFunction(func))throw new TypeError;var memoized=function(){var cache=memoized.cache,key=resolver?resolver.apply(this,arguments):keyPrefix+arguments[0];return hasOwnProperty.call(cache,key)?cache[key]:cache[key]=func.apply(this,arguments)};return memoized.cache={},memoized}function once(func){var ran,result;if(!isFunction(func))throw new TypeError;return function(){return ran?result:(ran=!0,result=func.apply(this,arguments),func=null,result)}}function partial(func){return createWrapper(func,16,slice(arguments,1))}function partialRight(func){return createWrapper(func,32,null,slice(arguments,1))}function throttle(func,wait,options){var leading=!0,trailing=!0;if(!isFunction(func))throw new TypeError;return options===!1?leading=!1:isObject(options)&&(leading="leading"in options?options.leading:leading,trailing="trailing"in options?options.trailing:trailing),debounceOptions.leading=leading,debounceOptions.maxWait=wait,debounceOptions.trailing=trailing,debounce(func,wait,debounceOptions)}function wrap(value,wrapper){return createWrapper(wrapper,16,[value])}function escape(string){return string==null?"":String(string).replace(reUnescapedHtml,escapeHtmlChar)}function identity(value){return value}function mixin(object,source){var ctor=object,isFunc=!source||isFunction(ctor);source||(ctor=lodashWrapper,source=object,object=lodash);forEach(functions(source),function(methodName){var func=object[methodName]=source[methodName];isFunc&&(ctor.prototype[methodName]=function(){var value=this.__wrapped__,args=[value],result;return(push.apply(args,arguments),result=func.apply(object,args),value&&typeof value=="object"&&value===result)?this:(result=new ctor(result),result.__chain__=this.__chain__,result)})})}function noConflict(){return context._=oldDash,this}function noop(){}function random(min,max,floating){var noMin=min==null,noMax=max==null,rand;return(floating==null&&(typeof min=="boolean"&&noMax?(floating=min,min=1):noMax||typeof max!="boolean"||(floating=max,noMax=!0)),noMin&&noMax&&(max=1),min=+min||0,noMax?(max=min,min=0):max=+max||0,floating||min%1||max%1)?(rand=nativeRandom(),nativeMin(min+rand*(max-min+parseFloat("1e-"+((rand+"").length-1))),max)):baseRandom(min,max)}function result(object,property){if(object){var value=object[property];return isFunction(value)?object[property]():value}}function template(text,data,options){var settings=lodash.templateSettings,variable,hasVariable,sourceURL,result;text=String(text||"");options=defaults({},options,settings);var imports=defaults({},options.imports,settings.imports),importsKeys=keys(imports),importsValues=values(imports),isEvaluating,index=0,interpolate=options.interpolate||reNoMatch,source="__p += '",reDelimiters=RegExp((options.escape||reNoMatch).source+"|"+interpolate.source+"|"+(interpolate===reInterpolate?reEsTemplate:reNoMatch).source+"|"+(options.evaluate||reNoMatch).source+"|$","g");text.replace(reDelimiters,function(match,escapeValue,interpolateValue,esTemplateValue,evaluateValue,offset){return interpolateValue||(interpolateValue=esTemplateValue),source+=text.slice(index,offset).replace(reUnescapedString,escapeStringChar),escapeValue&&(source+="' +\n__e("+escapeValue+") +\n'"),evaluateValue&&(isEvaluating=!0,source+="';\n"+evaluateValue+";\n__p += '"),interpolateValue&&(source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'"),index=offset+match.length,match});source+="';\n";variable=options.variable;hasVariable=variable;hasVariable||(variable="obj",source="with ("+variable+") {\n"+source+"\n}\n");source=(isEvaluating?source.replace(reEmptyStringLeading,""):source).replace(reEmptyStringMiddle,"$1").replace(reEmptyStringTrailing,"$1;");source="function("+variable+") {\n"+(hasVariable?"":variable+" || ("+variable+" = {});\n")+"var __t, __p = '', __e = _.escape"+(isEvaluating?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+source+"return __p\n}";sourceURL="\n/*\n//# sourceURL="+(options.sourceURL||"/lodash/template/source["+templateCounter+++"]")+"\n*/";try{result=Function(importsKeys,"return "+source+sourceURL).apply(undefined,importsValues)}catch(e){e.source=source;throw e;}return data?result(data):(result.source=source,result)}function times(n,callback,thisArg){n=(n=+n)>-1?n:0;var index=-1,result=Array(n);for(callback=baseCreateCallback(callback,thisArg,1);++index<n;)result[index]=callback(index);return result}function unescape(string){return string==null?"":String(string).replace(reEscapedHtml,unescapeHtmlChar)}function uniqueId(prefix){var id=++idCounter;return String(prefix==null?"":prefix)+id}function chain(value){return value=new lodashWrapper(value),value.__chain__=!0,value}function tap(value,interceptor){return interceptor(value),value}function wrapperChain(){return this.__chain__=!0,this}function wrapperToString(){return String(this.__wrapped__)}function wrapperValueOf(){return this.__wrapped__}var support,setBindData,defaults,forIn,forOwn,isPlainObject,countBy,groupBy,indexBy,where,parseInt;context=context?_.defaults(root.Object(),context,_.pick(root,contextProps)):root;var Array=context.Array,Boolean=context.Boolean,Date=context.Date,Function=context.Function,Math=context.Math,Number=context.Number,Object=context.Object,RegExp=context.RegExp,String=context.String,TypeError=context.TypeError,arrayRef=[],objectProto=Object.prototype,oldDash=context._,toString=objectProto.toString,reNative=RegExp("^"+String(toString).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),ceil=Math.ceil,clearTimeout=context.clearTimeout,floor=Math.floor,fnToString=Function.prototype.toString,getPrototypeOf=reNative.test(getPrototypeOf=Object.getPrototypeOf)&&getPrototypeOf,hasOwnProperty=objectProto.hasOwnProperty,now=reNative.test(now=Date.now)&&now||function(){return+new Date},push=arrayRef.push,setTimeout=context.setTimeout,splice=arrayRef.splice,setImmediate=typeof(setImmediate=freeGlobal&&moduleExports&&freeGlobal.setImmediate)=="function"&&!reNative.test(setImmediate)&&setImmediate,defineProperty=function(){try{var o={},func=reNative.test(func=Object.defineProperty)&&func,result=func(o,o,o)&&func}catch(e){}return result}(),nativeCreate=reNative.test(nativeCreate=Object.create)&&nativeCreate,nativeIsArray=reNative.test(nativeIsArray=Array.isArray)&&nativeIsArray,nativeIsFinite=context.isFinite,nativeIsNaN=context.isNaN,nativeKeys=reNative.test(nativeKeys=Object.keys)&&nativeKeys,nativeMax=Math.max,nativeMin=Math.min,nativeParseInt=context.parseInt,nativeRandom=Math.random,ctorByClass={};ctorByClass[arrayClass]=Array;ctorByClass[boolClass]=Boolean;ctorByClass[dateClass]=Date;ctorByClass[funcClass]=Function;ctorByClass[objectClass]=Object;ctorByClass[numberClass]=Number;ctorByClass[regexpClass]=RegExp;ctorByClass[stringClass]=String;lodashWrapper.prototype=lodash.prototype;support=lodash.support={};support.funcDecomp=!reNative.test(context.WinRTError)&&reThis.test(runInContext);support.funcNames=typeof Function.name=="string";lodash.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:reInterpolate,variable:"",imports:{_:lodash}};nativeCreate||(baseCreate=function(){function Object(){}return function(prototype){if(isObject(prototype)){Object.prototype=prototype;Object.prototype=null}return{}||context.Object()}}());setBindData=defineProperty?function(func,value){descriptor.value=value;defineProperty(func,"__bindData__",descriptor)}:noop;var isArray=nativeIsArray||function(value){return value&&typeof value=="object"&&typeof value.length=="number"&&toString.call(value)==arrayClass||!1},shimKeys=function(object){var index,iterable=object,result=[];if(!iterable||!objectTypes[typeof object])return result;for(index in iterable)hasOwnProperty.call(iterable,index)&&result.push(index);return result},keys=nativeKeys?function(object){return isObject(object)?nativeKeys(object):[]}:shimKeys,htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},htmlUnescapes=invert(htmlEscapes),reEscapedHtml=RegExp("("+keys(htmlUnescapes).join("|")+")","g"),reUnescapedHtml=RegExp("["+keys(htmlEscapes).join("")+"]","g"),assign=function(object,source,guard){var index,iterable=object,result=iterable,callback;if(!iterable)return result;var args=arguments,argsIndex=0,argsLength=typeof guard=="number"?2:args.length;for(argsLength>3&&typeof args[argsLength-2]=="function"?callback=baseCreateCallback(args[--argsLength-1],args[argsLength--],2):argsLength>2&&typeof args[argsLength-1]=="function"&&(callback=args[--argsLength]);++argsIndex<argsLength;)if(iterable=args[argsIndex],iterable&&objectTypes[typeof iterable])for(var ownIndex=-1,ownProps=objectTypes[typeof iterable]&&keys(iterable),length=ownProps?ownProps.length:0;++ownIndex<length;)index=ownProps[ownIndex],result[index]=callback?callback(result[index],iterable[index]):iterable[index];return result};return defaults=function(object,source,guard){var index,iterable=object,result=iterable;if(!iterable)return result;for(var args=arguments,argsIndex=0,argsLength=typeof guard=="number"?2:args.length;++argsIndex<argsLength;)if(iterable=args[argsIndex],iterable&&objectTypes[typeof iterable])for(var ownIndex=-1,ownProps=objectTypes[typeof iterable]&&keys(iterable),length=ownProps?ownProps.length:0;++ownIndex<length;)index=ownProps[ownIndex],typeof result[index]=="undefined"&&(result[index]=iterable[index]);return result},forIn=function(collection,callback,thisArg){var index,iterable=collection,result=iterable;if(!iterable||!objectTypes[typeof iterable])return result;callback=callback&&typeof thisArg=="undefined"?callback:baseCreateCallback(callback,thisArg,3);for(index in iterable)if(callback(iterable[index],index,collection)===!1)return result;return result},forOwn=function(collection,callback,thisArg){var index,iterable=collection,result=iterable;if(!iterable||!objectTypes[typeof iterable])return result;callback=callback&&typeof thisArg=="undefined"?callback:baseCreateCallback(callback,thisArg,3);for(var ownIndex=-1,ownProps=objectTypes[typeof iterable]&&keys(iterable),length=ownProps?ownProps.length:0;++ownIndex<length;)if(index=ownProps[ownIndex],callback(iterable[index],index,collection)===!1)return result;return result},isPlainObject=function(value){if(!(value&&toString.call(value)==objectClass))return!1;var valueOf=value.valueOf,objProto=typeof valueOf=="function"&&(objProto=getPrototypeOf(valueOf))&&getPrototypeOf(objProto);return objProto?value==objProto||getPrototypeOf(value)==objProto:shimIsPlainObject(value)},countBy=createAggregator(function(result,value,key){hasOwnProperty.call(result,key)?result[key]++:result[key]=1}),groupBy=createAggregator(function(result,value,key){(hasOwnProperty.call(result,key)?result[key]:result[key]=[]).push(value)}),indexBy=createAggregator(function(result,value,key){result[key]=value}),where=filter,setImmediate&&(defer=function(func){if(!isFunction(func))throw new TypeError;return setImmediate.apply(context,arguments)}),parseInt=nativeParseInt(whitespace+"08")==8?nativeParseInt:function(value,radix){return nativeParseInt(isString(value)?value.replace(reLeadingSpacesAndZeros,""):value,radix||0)},lodash.after=after,lodash.assign=assign,lodash.at=at,lodash.bind=bind,lodash.bindAll=bindAll,lodash.bindKey=bindKey,lodash.chain=chain,lodash.compact=compact,lodash.compose=compose,lodash.countBy=countBy,lodash.create=create,lodash.createCallback=createCallback,lodash.curry=curry,lodash.debounce=debounce,lodash.defaults=defaults,lodash.defer=defer,lodash.delay=delay,lodash.difference=difference,lodash.filter=filter,lodash.flatten=flatten,lodash.forEach=forEach,lodash.forEachRight=forEachRight,lodash.forIn=forIn,lodash.forInRight=forInRight,lodash.forOwn=forOwn,lodash.forOwnRight=forOwnRight,lodash.functions=functions,lodash.groupBy=groupBy,lodash.indexBy=indexBy,lodash.initial=initial,lodash.intersection=intersection,lodash.invert=invert,lodash.invoke=invoke,lodash.keys=keys,lodash.map=map,lodash.max=max,lodash.memoize=memoize,lodash.merge=merge,lodash.min=min,lodash.omit=omit,lodash.once=once,lodash.pairs=pairs,lodash.partial=partial,lodash.partialRight=partialRight,lodash.pick=pick,lodash.pluck=pluck,lodash.pull=pull,lodash.range=range,lodash.reject=reject,lodash.remove=remove,lodash.rest=rest,lodash.shuffle=shuffle,lodash.sortBy=sortBy,lodash.tap=tap,lodash.throttle=throttle,lodash.times=times,lodash.toArray=toArray,lodash.transform=transform,lodash.union=union,lodash.uniq=uniq,lodash.values=values,lodash.where=where,lodash.without=without,lodash.wrap=wrap,lodash.zip=zip,lodash.zipObject=zipObject,lodash.collect=map,lodash.drop=rest,lodash.each=forEach,lodash.eachRight=forEachRight,lodash.extend=assign,lodash.methods=functions,lodash.object=zipObject,lodash.select=filter,lodash.tail=rest,lodash.unique=uniq,lodash.unzip=zip,mixin(lodash),lodash.clone=clone,lodash.cloneDeep=cloneDeep,lodash.contains=contains,lodash.escape=escape,lodash.every=every,lodash.find=find,lodash.findIndex=findIndex,lodash.findKey=findKey,lodash.findLast=findLast,lodash.findLastIndex=findLastIndex,lodash.findLastKey=findLastKey,lodash.has=has,lodash.identity=identity,lodash.indexOf=indexOf,lodash.isArguments=isArguments,lodash.isArray=isArray,lodash.isBoolean=isBoolean,lodash.isDate=isDate,lodash.isElement=isElement,lodash.isEmpty=isEmpty,lodash.isEqual=isEqual,lodash.isFinite=isFinite,lodash.isFunction=isFunction,lodash.isNaN=isNaN,lodash.isNull=isNull,lodash.isNumber=isNumber,lodash.isObject=isObject,lodash.isPlainObject=isPlainObject,lodash.isRegExp=isRegExp,lodash.isString=isString,lodash.isUndefined=isUndefined,lodash.lastIndexOf=lastIndexOf,lodash.mixin=mixin,lodash.noConflict=noConflict,lodash.noop=noop,lodash.parseInt=parseInt,lodash.random=random,lodash.reduce=reduce,lodash.reduceRight=reduceRight,lodash.result=result,lodash.runInContext=runInContext,lodash.size=size,lodash.some=some,lodash.sortedIndex=sortedIndex,lodash.template=template,lodash.unescape=unescape,lodash.uniqueId=uniqueId,lodash.all=every,lodash.any=some,lodash.detect=find,lodash.findWhere=find,lodash.foldl=reduce,lodash.foldr=reduceRight,lodash.include=contains,lodash.inject=reduce,forOwn(lodash,function(func,methodName){lodash.prototype[methodName]||(lodash.prototype[methodName]=function(){var args=[this.__wrapped__],chainAll=this.__chain__,result;return push.apply(args,arguments),result=func.apply(lodash,args),chainAll?new lodashWrapper(result,chainAll):result})}),lodash.first=first,lodash.last=last,lodash.sample=sample,lodash.take=first,lodash.head=first,forOwn(lodash,function(func,methodName){var callbackable=methodName!=="sample";lodash.prototype[methodName]||(lodash.prototype[methodName]=function(n,guard){var chainAll=this.__chain__,result=func(this.__wrapped__,n,guard);return!chainAll&&(n==null||guard&&!(callbackable&&typeof n=="function"))?result:new lodashWrapper(result,chainAll)})}),lodash.VERSION="2.3.0",lodash.prototype.chain=wrapperChain,lodash.prototype.toString=wrapperToString,lodash.prototype.value=wrapperValueOf,lodash.prototype.valueOf=wrapperValueOf,forEach(["join","pop","shift"],function(methodName){var func=arrayRef[methodName];lodash.prototype[methodName]=function(){var chainAll=this.__chain__,result=func.apply(this.__wrapped__,arguments);return chainAll?new lodashWrapper(result,chainAll):result}}),forEach(["push","reverse","sort","unshift"],function(methodName){var func=arrayRef[methodName];lodash.prototype[methodName]=function(){return func.apply(this.__wrapped__,arguments),this}}),forEach(["concat","slice","splice"],function(methodName){var func=arrayRef[methodName];lodash.prototype[methodName]=function(){return new lodashWrapper(func.apply(this.__wrapped__,arguments),this.__chain__)}}),lodash}var undefined,arrayPool=[],objectPool=[],idCounter=0,keyPrefix=+new Date+"",largeArraySize=75,maxPoolSize=40,whitespace=" \t\x0b\f\n\r\u2028\u2029",reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g,reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,reFlags=/\w*$/,reFuncName=/^\s*function[ \n\r\t]+\w/,reInterpolate=/<%=([\s\S]+?)%>/g,reLeadingSpacesAndZeros=RegExp("^["+whitespace+"]*0+(?=.$)"),reNoMatch=/($^)/,reThis=/\bthis\b/,reUnescapedString=/['\n\r\t\u2028\u2029\\]/g,contextProps=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setImmediate","setTimeout"],templateCounter=0,argsClass="[object Arguments]",arrayClass="[object Array]",boolClass="[object Boolean]",dateClass="[object Date]",funcClass="[object Function]",numberClass="[object Number]",objectClass="[object Object]",regexpClass="[object RegExp]",stringClass="[object String]",cloneableClasses={},_;cloneableClasses[funcClass]=!1;cloneableClasses[argsClass]=cloneableClasses[arrayClass]=cloneableClasses[boolClass]=cloneableClasses[dateClass]=cloneableClasses[numberClass]=cloneableClasses[objectClass]=cloneableClasses[regexpClass]=cloneableClasses[stringClass]=!0;var debounceOptions={leading:!1,maxWait:0,trailing:!1},descriptor={configurable:!1,enumerable:!1,value:null,writable:!1},objectTypes={boolean:!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},stringEscapes={"\\":"\\","'":"'","\n":"n","\r":"r","\t":"t","\u2028":"u2028","\u2029":"u2029"},root=objectTypes[typeof window]&&window||this,freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports,freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports&&freeExports,freeGlobal=objectTypes[typeof global]&&global;freeGlobal&&(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal)&&(root=freeGlobal);_=runInContext();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(root._=_,define(function(){return _})):freeExports&&freeModule?moduleExports?(freeModule.exports=_)._=_:freeExports._=_:root._=_}).call(this);Oskari.clazz.define("Oskari.framework.bundle.oskariui.DomManager",function(dollar,partsMap){this.$=dollar;this.partsMap=partsMap||{};this.layout=null;this.layouts=[]},{getEl:function(selector){return this.$(selector)},getElForPart:function(part){return this.$(this.partsMap[part])},setElForPart:function(part,el){this.partsMap[part]=this.$(el)},setElParts:function(partsMap){this.partsMap=partsMap},getElParts:function(){return this.partsMap},pushLayout:function(l){this.layout&&this.layout.removeLayout(this);this.layout=l;this.layouts.push(l);l.applyLayout(this)},popLayout:function(){var l=this.layouts.pop();if(l&&l.removeLayout(this),this.layouts.length===0){this.layout=null;return}l=this.layouts[this.layouts.length-1];this.layout=l;l.applyLayout(this)},getLayout:function(){return this.layout}},{protocol:["Oskari.dom.DomManager"]});Oskari.clazz.define("Oskari.framework.bundle.oskariui.Layout",function(){},{applyLayout:function(){},removeLayout:function(){}},{protocol:["Oskari.dom.Layout"]});Oskari.clazz.define("Oskari.mapframework.bundle.PluginMapModuleBundle",function(){},{create:function(){return this},update:function(manager,bundle,bi,info){manager.alert("RECEIVED update notification "+info)}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../src/mapping/mapmodule/AbstractMapModule.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/ui/module/map-module.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/Plugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/controls/ControlsPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/controls/PorttiKeyboard.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/controls/PorttiMouse.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/DisableMapKeyboardMovementRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/DisableMapMouseMovementRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/EnableMapKeyboardMovementRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/EnableMapMouseMovementRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/MapMovementControlsRequestHandler.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/show-map-measurement-request.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/getinfo/GetFeatureInfoHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/GetFeatureInfoRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/GetFeatureInfoActivationRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/getinfo/GetInfoPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/getinfo/GetFeatureInfoFormatter.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/getinfo/css/getinfo.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/markers/MarkersPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/RemoveMarkerRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/MarkerRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/search/SearchPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/search/service/searchservice.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/search/css/search.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/logo/LogoPlugin.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/logo/css/logoplugin.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/datasource/DataSourcePlugin.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/datasource/css/datasource.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/indexmap/IndexMapPlugin.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/indexmap/css/indexmap.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/scalebar/ScaleBarPlugin.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/scalebar/css/scalebar.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/publishertoolbar/PublisherToolbarPlugin.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/publishertoolbar/css/publishertoolbar.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/fullscreen/FullScreen.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/fullscreen/css/fullscreen.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/layers/LayerSelectionPlugin.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/layers/css/layersselection.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/layers/BackgroundLayerSelectionPlugin.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/layers/css/backgroundlayerselection.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/layers/LayersPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/MapLayerVisibilityRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/MapLayerVisibilityRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/MapMoveByLayerContentRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/MapMoveByLayerContentRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/event/MapLayerVisibilityChangedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/wmslayer/WmsLayerPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/vectorlayer/VectorLayerPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/location/GeoLocationPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/DrawPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/event/AddedFeatureEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/event/FinishedDrawingEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/event/SelectedDrawingEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/event/ActiveDrawingEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/GetGeometryRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/GetGeometryRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StartDrawingRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StartDrawingRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StopDrawingRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StopDrawingRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/publishertoolbar/PublisherToolbarPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/publishertoolbar/request/ToolContainerRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/publishertoolbar/request/ToolContainerRequestHandler.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/publishertoolbar/css/publishertoolbar.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/realtime/RealtimePlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/ToolSelectionRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/controls/ToolSelectionHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/MapLayerUpdateRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/MapLayerUpdateRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/MapMoveRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/event/MapClickedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/event/EscPressedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/event/GetInfoResultEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/event/MapSizeChangedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/zoombar/Portti2Zoombar.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/zoombar/css/porttizoombar.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/panbuttons/PanButtons.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/panbuttons/css/panbuttons.css"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/css/mapmodule.css"}],locales:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/am.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/bg.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/cs.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/da.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/de.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/en.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/es.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/et.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/fi.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/ge.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/gr.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/hr.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/hu.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/lv.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/nl.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/pl.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/pt.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/ro.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/rs.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/sl.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/sk.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/sq.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/sv.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/uk.js"}]},bundle:{manifest:{"Bundle-Identifier":"mapmodule-plugin","Bundle-Name":"mapmodule","Bundle-Tag":{mapframework:!0},"Bundle-Icon":{href:"icon.png"},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:"Kartta",Title:"Kartta"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","Ext","OpenLayers"]}}});Oskari.bundle_manager.installBundleClass("mapmodule-plugin","Oskari.mapframework.bundle.PluginMapModuleBundle");Oskari.AbstractFunc=function(){var name=arguments[0];return function(){throw"AbstractFuncCalled: "+name;}};Oskari.clazz.define("Oskari.mapping.mapmodule.AbstractMapModule",function(id,imageUrl,options){if(this._id=id,this._imageUrl=imageUrl,this._options={resolutions:[2048,1024,512,256,128,64,32,16,8,4,2,1,.5],srsName:"EPSG:3067",units:"m"},options)for(var key in options)this._options[key]=options[key];this._controls={};this._layerPlugins={};this._projection=null;this._projectionCode=this._options.srsName;this._supportedFormats={};this._map=null;this._mapScales=[];this._mapResolutions=this._options.resolutions;this._maxExtent=this._options.maxExtent||{};this._extent=this._maxExtent.left?[this._maxExtent.left,this._maxExtent.bottom,this._maxExtent.right,this._maxExtent.top]:[];this._sandbox=null;this._stealth=!1;this._pluginInstances={};this._localization=null;this.layerDefs=[];this.layerDefsById={}},{getImageUrl:function(){return this._imageUrl?this._imageUrl:"/Oskari/resources"},getControls:function(){return this._controls},getMapControl:function(id){return this._controls[id]},addMapControl:function(id,ctl){this._controls[id]=ctl;this._addMapControlImpl(ctl)},removeMapControl:function(id){var ctl=this._controls[id];this._removeMapControlImpl(ctl);delete this._controls[id]},setLayerPlugin:function(id,plug){this._layerPlugins[id]=plug},getLayerPlugin:function(id){return this._layerPlugins[id]},getLayerPlugins:function(){return this._layerPlugins},getName:function(){return this._id+"MapModule"},getSandbox:function(){return this._sandbox},getLocalization:function(key,force){return(this._localization&&force!==!0||(this._localization=Oskari.getLocalization("MapModule")),key)?this._localization[key]:this._localization},init:function(sandbox){return sandbox.printDebug("Initializing oskari map module...#############################################"),this._sandbox=sandbox,this._options&&(this._options.resolutions&&(this._mapResolutions=this._options.resolutions),this._options.srsName&&(this._projectionCode=this._options.srsName,this._sandbox&&this._sandbox.getMap().setSrsName(this._projectionCode))),this._map=this._createMapImpl(),this._calculateScalesImpl(this._mapResolutions),this._initImpl(this._sandbox,this._options,this._map)},_initImpl:function(sandbox,options,map){return map},getPluginInstances:function(){return this._pluginInstances},getPluginInstance:function(pluginName){return this._pluginInstances[this.getName()+pluginName]},isPluginActivated:function(pluginName){var plugin=this._pluginInstances[this.getName()+pluginName];return plugin?!0:!1},registerPlugin:function(plugin){var sandbox=this.getSandbox(),pluginName;plugin.setMapModule(this);pluginName=plugin.getName();sandbox.printDebug("["+this.getName()+"] Registering "+pluginName);plugin.register();this._pluginInstances[pluginName]=plugin},unregisterPlugin:function(plugin){var sandbox=this.getSandbox(),pluginName=plugin.getName();sandbox.printDebug("["+this.getName()+"] Unregistering "+pluginName);plugin.unregister();this._pluginInstances[pluginName]=undefined;plugin.setMapModule(null);delete this._pluginInstances[pluginName]},startPlugin:function(plugin){var sandbox=this.getSandbox(),pluginName=plugin.getName();sandbox.printDebug("["+this.getName()+"] Starting "+pluginName);plugin.startPlugin(sandbox)},stopPlugin:function(plugin){var sandbox=this.getSandbox(),pluginName=plugin.getName();sandbox.printDebug("["+this.getName()+"] Starting "+pluginName);plugin.stopPlugin(sandbox)},startPlugins:function(sandbox){for(var pluginName in this._pluginInstances)this._pluginInstances.hasOwnProperty(pluginName)&&(sandbox.printDebug("["+this.getName()+"] Starting "+pluginName),this._pluginInstances[pluginName].startPlugin(sandbox))},stopPlugins:function(sandbox){for(var pluginName in this._pluginInstances)this._pluginInstances.hasOwnProperty(pluginName)&&(sandbox.printDebug("["+this.getName()+"] Starting "+pluginName),this._pluginInstances[pluginName].stopPlugin(sandbox))},getStealth:function(){return this._stealth},setStealth:function(bln){this._stealth=!!bln},notifyAll:function(event,retainEvent){this.getStealth()||this.getSandbox().notifyAll(event,retainEvent)},getMap:function(){return this._map},getProjection:function(){return this._projectionCode},getProjectionObject:function(){return this._projection},getResolutionArray:function(){return this._mapResolutions},getExtentArray:function(){return this._extent},zoomIn:function(){this.adjustZoomLevel(1)},zoomOut:function(){this.adjustZoomLevel(-1)},zoomTo:function(zoomLevel){this.setZoomLevel(zoomLevel,!1)},moveMapByPixels:function(pX,pY,suppressStart,suppressEnd){return this.panMapByPixels(pX,pY,suppressStart,suppressEnd)},isValidLonLat:function(lon,lat){var isOk=!0;return lat<625e4||lat>82e5?!1:((lon<0||lon>135e4)&&(isOk=!1),isOk)},getClosestZoomLevel:function(maxScale,minScale){var zoomLevel=this.getZoomLevel(),scale,i;if(!minScale||!maxScale)return zoomLevel;if(scale=this.getMap().getScale(),scale<minScale){for(i=zoomLevel;i>0;i--)if(this._mapScales[i]>=minScale)return i}else if(scale>maxScale)for(i=zoomLevel;i<this._mapScales.length;i++)if(this._mapScales[i]<=maxScale)return i;return zoomLevel},formatMeasurementResult:function(geometry,drawMode){var measurement,unit;if(drawMode==="area")measurement=Math.round(100*geometry.getArea())/100,unit=" m",measurement>=1e6&&(measurement=Math.round(measurement)/1e6,unit=" km");else if(drawMode==="line")measurement=Math.round(100*geometry.getLength())/100,unit=" m",measurement>=1e3&&(measurement=Math.round(measurement)/1e3,unit=" km");else return"";return(measurement+unit).replace(".",",")},start:function(sandbox){if(!this.started){sandbox.printDebug("Starting "+this.getName());for(var p in this.eventHandlers)this.eventHandlers.hasOwnProperty(p)&&sandbox.registerForEventByName(this,p);this.startPlugins(sandbox);this.updateCurrentState();this.started=this._startImpl()}},_startImpl:function(){return!0},stop:function(sandbox){this.started&&(this.stopPlugins(sandbox),this.started=this._stopImpl())},_stopImpl:function(){return!0},eventHandlers:{},onEvent:function(event){var handler=this.eventHandlers[event.getName()];if(handler)return handler.apply(this,[event])},updateCurrentState:function(){var me=this,sandbox=me._sandbox,layers=sandbox.findAllSelectedMapLayers(),lps=this.getLayerPlugins(),layersPlugin;for(var p in lps)lps.hasOwnProperty(p)&&(layersPlugin=lps[p],sandbox.printDebug("preselecting "+p),layersPlugin.preselectLayers(layers))},getLayersByName:function(name){for(var ldef,results=[],layerDefs=this.layerDefs,l=0;l<layerDefs.length;l++)ldef=layerDefs[l],ldef.name.indexOf(name)!=-1&&results.push(ldef.impl);return results},getLayers:function(){return this.layerDefs},getLayerDefs:function(){return this.layerDefs},addLayer:function(layerImpl,layer,name){var ldef={name:name,id:layer.getId(),impl:layerImpl,layer:layer};this.layerDefs.push(ldef);this.layerDefsById[layer.getId()]=ldef;this._addLayerImpl(layerImpl)},removeLayer:function(layerImpl,layer){var newDefs,n;for(this._removeLayerImpl(layerImpl),delete this.layerDefsById[layer.getId()],newDefs=[],n=0;n<this.layerDefs.length;n++){if(this.layerDefs[n].layer.getId()!==layer.getId()){newDefs.push(this.layerDefs[n]);continue}delete this.layerDefs[n]}this.layerDefs=newDefs},setLayerIndex:function(layerImpl,index){for(var layerArr=this.getLayerDefs(),layerIndex=this.getLayerIndex(layerImpl),newLayerArr=[],prevDef=layerArr[layerIndex],n=0,n=0;n<layerArr.length;n++)n===index&&prevDef&&(newLayerArr.push(prevDef),prevDef=null),layerArr[n].impl===layerImpl||newLayerArr.push(layerArr[n]);for(n===index&&prevDef&&newLayerArr.push(prevDef),this.layerDefs=newLayerArr,n=0;n<layerArr.length;n++)this._setLayerImplIndex(layerArr[n].impl,n)},getLayerIndex:function(layerImpl){for(var layerArr=this.getLayerDefs(),n=0;n<layerArr.length;n++)if(layerArr[n].impl===layerImpl)return n;return-1},getMapScale:function(){var size=this.getMapSize(),extent=this.getMapExtent(),res=(extent[2]-extent[0])/size[0];return OpenLayers.Util.getScaleFromResolution(res,"m")},calculateLayerMinMaxResolutions:function(maxScale,minScale){for(var minScaleZoom=undefined,maxScaleZoom=undefined,i=0;i<this._mapScales.length;i++)(!minScale||minScale>=this._mapScales[i])&&(!maxScale||maxScale<=this._mapScales[i])&&(minScaleZoom===undefined&&(minScaleZoom=i),maxScaleZoom=i);return{min:minScaleZoom,max:maxScaleZoom}},getMapScales:function(){return this._mapScales},calculateLayerScales:function(maxScale,minScale){for(var layerScales=[],i=0;i<this._mapScales.length;i++)(!minScale||minScale>=this._mapScales[i])&&(!maxScale||maxScale<=this._mapScales[i])&&layerScales.push(this._mapScales[i]);return layerScales},calculateLayerResolutions:function(maxScale,minScale){for(var layerResolutions=[],i=0;i<this._mapScales.length;i++)(!minScale||minScale>=this._mapScales[i])&&(!maxScale||maxScale<=this._mapScales[i])&&layerResolutions.push(this._options.resolutions[i]);return layerResolutions},_crs2MapImpl:Oskari.AbstractFunc("_crs2MapImpl"),_map2CrsImpl:Oskari.AbstractFunc("_map2CrsImpl"),updateSize:Oskari.AbstractFunc("updateSize"),_createMapImpl:Oskari.AbstractFunc("_createMapImpl"),moveMapToLanLot:function(){return this.panMapToLonLat.apply(this,arguments)},panMapToLonLat:Oskari.AbstractFunc("moveMapToLanLot"),zoomToScale:Oskari.AbstractFunc("zoomToScale"),centerMap:Oskari.AbstractFunc("centerMap"),panMapByPixels:Oskari.AbstractFunc("panMapByPixels"),centerMapByPixels:Oskari.AbstractFunc("centerMapByPixels"),zoomToExtent:Oskari.AbstractFunc("zoomToExtent"),setZoomLevel:Oskari.AbstractFunc("setZoomLevel"),getZoomLevel:function(){return this.getMap().getZoom()},_updateDomainImpl:Oskari.AbstractFunc("_updateDomainImpl"),_addLayerImpl:Oskari.AbstractFunc("_addLayerImpl(layerImpl)"),_setLayerImplIndex:Oskari.AbstractFunc("_setLayerImplIndex(layerImpl,n)"),_removeLayerImpl:Oskari.AbstractFunc("_removeLayerImpl(layerImpl)"),_setLayerImplVisible:Oskari.AbstractFunc("_setLayerImplVisible"),_setLayerImplOpacity:Oskari.AbstractFunc("_setLayerImplOpacity"),adjustZoomLevel:Oskari.AbstractFunc("adjustZoomLevel(amount, suppressEvent)"),notifyMoveEnd:function(){},_calculateScalesImpl:Oskari.AbstractFunc("_calculateScalesImpl(resolutions)"),_addMapControlImpl:Oskari.AbstractFunc("_addMapControlImpl(ctl)"),_removeMapControlImpl:Oskari.AbstractFunc("_removeMapControlImpl(ctl)")},{protocol:["Oskari.mapframework.module.Module"]});Oskari.clazz.define("Oskari.mapframework.ui.module.common.MapModule",function(id,imageUrl,options){this._options={resolutions:[2e3,1e3,500,200,100,50,20,10,4,2,1,.5,.25],srsName:"EPSG:3067",units:"m"};var key;if(options)for(key in options)options.hasOwnProperty(key)&&(this._options[key]=options[key])},{_addMapControlPluginContainers:function(){for(var containerClasses=["bottom center","top center","right center","left center","bottom right","bottom left","top right","top left"],containerDiv,mapDiv=jQuery("#mapdiv"),i=0;i<containerClasses.length;i++)containerDiv=jQuery('<div class="mapplugins"><div class="mappluginsContainer"><div class="mappluginsContent"><\/div><\/div><\/div>'),containerDiv.addClass(containerClasses[i]),containerDiv.attr("data-location",containerClasses[i]),mapDiv.append(containerDiv)},setMapControlPlugin:function(element,containerClasses,position){var containerSelector=".mapplugins."+(containerClasses+" ").split(" ").join(".")+" .mappluginsContainer .mappluginsContent",container=jQuery(containerSelector),pos=position+"",inverted=/^(?=.*\bbottom\b)((?=.*\bleft\b)|(?=.*\bright\b)).+/.test(containerClasses),precedingPlugin=null,curr;if(!element)throw"Element is non-existent.";if(!containerClasses)throw"No container classes.";if(!container||!container.length)throw'Container with classes "'+containerSelector+'" not found.';element.attr("data-position",position);element.detach();position!==null&&position!==undefined?(container.find(".mapplugin").each(function(){curr=$(this);(!inverted&&curr.attr("data-position")<=pos||inverted&&curr.attr("data-position")>pos)&&(precedingPlugin=curr)}),precedingPlugin?precedingPlugin.after(element):container.prepend(element)):container.append(element)},_initImpl:function(sandbox,options,map){var scales=this._calculateScalesFromResolutions(options.resolutions,map.units);return this._mapScales=scales,this._createBaseLayer(),this._addMapControlPluginContainers(),map},_startImpl:function(){var sandbox=this.getSandbox();return this._addRequestHandlersImpl(sandbox),!0},_addRequestHandlersImpl:function(sandbox){this.requestHandlers={mapLayerUpdateHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MapLayerUpdateRequestHandler",sandbox,this),mapMoveRequestHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MapMoveRequestHandler",sandbox,this)};sandbox.addRequestHandler("MapModulePlugin.MapLayerUpdateRequest",this.requestHandlers.mapLayerUpdateHandler);sandbox.addRequestHandler("MapMoveRequest",this.requestHandlers.mapMoveRequestHandler)},_calculateScalesFromResolutions:function(resolutions,units){for(var calculatedScale,scales=[],i=0;i<resolutions.length;++i)calculatedScale=OpenLayers.Util.getScaleFromResolution(resolutions[i],units),calculatedScale=calculatedScale*1e8,calculatedScale=Math.round(calculatedScale),calculatedScale=calculatedScale/1e8,scales.push(calculatedScale);return scales},getMapViewPortDiv:function(){return this._map.viewPortDiv},getMapLayersContainerDiv:function(){return this._map.layerContainerDiv},_createMap:function(){this.getSandbox().printWarn("Depricated. Use _createMapImpl instead.");this._createMapImpl()},_createMapImpl:function(){var sandbox=this._sandbox,lonlat=new OpenLayers.LonLat(0,0),mapExtent=new OpenLayers.Bounds(0,0,1e7,1e7);return this._options!==null&&this._options!==undefined&&this._options.maxExtent!==null&&this._options.maxExtent!==undefined&&this._options.maxExtent.left!==null&&this._options.maxExtent.left!==undefined&&this._options.maxExtent.bottom!==null&&this._options.maxExtent.bottom!==undefined&&this._options.maxExtent.right!==null&&this._options.maxExtent.right!==undefined&&this._options.maxExtent.top!==null&&this._options.maxExtent.top!==undefined&&(mapExtent=new OpenLayers.Bounds(this._options.maxExtent.left,this._options.maxExtent.bottom,this._options.maxExtent.right,this._options.maxExtent.top)),this._map=new OpenLayers.Map({controls:[],units:this._options.units,maxExtent:mapExtent,resolutions:this._options.resolutions,projection:this._options.srsName,isBaseLayer:!0,center:lonlat,fallThrough:!0,theme:null,zoom:0,zoomMethod:null}),this._map},_createBaseLayer:function(){var base=new OpenLayers.Layer("BaseLayer",{layerId:0,isBaseLayer:!0,displayInLayerSwitcher:!1});this._map.addLayer(base)},moveMapToLanLot:function(lonlat,zoomAdjust,pIsDragging){var isDragging=pIsDragging===!0;this._map.setCenter(lonlat,this._getMapZoom(),isDragging);zoomAdjust&&this.adjustZoomLevel(zoomAdjust,!0);this._updateDomainImpl()},panMapToLonLat:function(lonlat,suppressEnd){this._map.setCenter(lonlat,this._getMapZoom());this._updateDomainImpl();suppressEnd!==!0&&this.notifyMoveEnd()},zoomToScale:function(scale,closest,suppressEnd){var isClosest=closest===!0;this._map.zoomToScale(scale,isClosest);this._updateDomainImpl();suppressEnd!==!0&&this.notifyMoveEnd()},centerMap:function(lonlat,zoom,suppressEnd){this._map.setCenter(lonlat,zoom,!1);this._updateDomainImpl();suppressEnd!==!0&&this.notifyMoveEnd()},zoomIn:function(){this.adjustZoomLevel(1)},zoomOut:function(){this.adjustZoomLevel(-1)},zoomTo:function(zoomLevel){this.setZoomLevel(zoomLevel,!1)},panMapEast:function(){var size=this._map.getSize();this.panMapByPixels(.75*size.w,0)},panMapWest:function(){var size=this._map.getSize();this.panMapByPixels(-.75*size.w,0)},panMapNorth:function(){var size=this._map.getSize();this.panMapByPixels(0,-.75*size.h)},panMapSouth:function(){var size=this._map.getSize();this.panMapByPixels(0,.75*size.h)},panMapByPixels:function(pX,pY,suppressStart,suppressEnd,isDrag){this._map.pan(pX,pY,{dragging:isDrag?!0:!1,animate:!1});this._updateDomainImpl();suppressStart!==!0&&this.notifyStartMove();suppressEnd!==!0&&this.notifyMoveEnd()},moveMapByPixels:function(pX,pY,suppressStart,suppressEnd){this._map.moveByPx(pX,pY);this._updateDomainImpl();suppressStart!==!0&&this.notifyStartMove();suppressEnd!==!0&&this.notifyMoveEnd()},centerMapByPixels:function(pX,pY,suppressStart,suppressEnd){var newXY=new OpenLayers.Pixel(pX,pY),newCenter=this._map.getLonLatFromViewPortPx(newXY);this.isValidLonLat(newCenter.lon,newCenter.lat)&&(this.moveMapToLanLot(newCenter),suppressStart!==!0&&this.notifyStartMove(),suppressEnd!==!0&&this.notifyMoveEnd())},isValidLonLat:function(lon,lat){var isOk=!0;return lat<625e4||lat>82e5?!1:((lon<0||lon>135e4)&&(isOk=!1),isOk)},zoomToExtent:function(bounds,suppressStart,suppressEnd){this._map.zoomToExtent(bounds);this._updateDomainImpl();suppressStart!==!0&&this.notifyStartMove();suppressEnd!==!0&&this.notifyMoveEnd()},adjustZoomLevel:function(amount,suppressEvent){var requestedZoomLevel=this._getNewZoomLevel(amount);this._map.zoomTo(requestedZoomLevel);this._updateDomainImpl();suppressEvent!==!0&&this.notifyMoveEnd()},setZoomLevel:function(newZoomLevel,suppressEvent){var currentZoomLevel=this._getMapZoom();newZoomLevel!==currentZoomLevel&&((newZoomLevel<0||newZoomLevel>this._map.getNumZoomLevels)&&(newZoomLevel=this._getMapZoom()),this._map.zoomTo(newZoomLevel),this._updateDomainImpl(),suppressEvent!==!0&&this.notifyMoveEnd())},_getNewZoomLevel:function(adjustment){var requestedZoomLevel=this._getMapZoom()+adjustment;return requestedZoomLevel>=0&&requestedZoomLevel<=this._map.getNumZoomLevels()?requestedZoomLevel:this._getMapZoom()},notifyStartMove:function(){if(!this.getStealth()){this.getSandbox().getMap().setMoving(!0);var centerX=this._getMapCenter().lon,centerY=this._getMapCenter().lat,evt=this.getSandbox().getEventBuilder("MapMoveStartEvent")(centerX,centerY);this.getSandbox().notifyAll(evt)}},_getMapCenter:function(){return this._map.getCenter()},_getMapZoom:function(){return this._map.getZoom()},_getMapScale:function(){return this._map.getScale()},_getMapLayersByName:function(layerName){return this._map.getLayersByName(layerName)},notifyMoveEnd:function(){var sandbox,lonlat,evt;this.getStealth()||(sandbox=this.getSandbox(),sandbox.getMap().setMoving(!1),lonlat=this._getMapCenter(),this._updateDomainImpl(),evt=sandbox.getEventBuilder("AfterMapMoveEvent")(lonlat.lon,lonlat.lat,this._getMapZoom(),!1,this._getMapScale()),sandbox.notifyAll(evt))},updateSize:function(){this.getMap().updateSize();this._updateDomainImpl();var sandbox=this.getSandbox(),mapVO=sandbox.getMap(),evt=sandbox.getEventBuilder("MapSizeChangedEvent")(mapVO.getWidth(),mapVO.getHeight());sandbox.notifyAll(evt)},_updateDomain:function(){this.getSandbox().printWarn("Depricated. Use _updateDomainImpl instead.");this._updateDomainImpl()},_updateDomainImpl:function(){var size;if(!this.getStealth()){var sandbox=this.getSandbox(),mapVO=sandbox.getMap(),lonlat=this._getMapCenter();mapVO.moveTo(lonlat.lon,lonlat.lat,this._getMapZoom());mapVO.setScale(this._getMapScale());size=this._map.getCurrentSize();mapVO.setWidth(size.w);mapVO.setHeight(size.h);mapVO.setResolution(this._map.getResolution());mapVO.setExtent(this._map.getExtent());mapVO.setMaxExtent(this._map.getMaxExtent());mapVO.setBbox(this._map.calculateBounds())}},transformCoordinates:function(pLonlat,srs){return this.getSandbox().printWarn("Depricated. Use _transformCoordinates instead if called from plugin. Otherwise, use Requests instead."),this._transformCoordinates(pLonlat,srs)},_transformCoordinates:function(pLonlat,srs){return pLonlat.transform(new OpenLayers.Projection(srs),this.getMap().getProjectionObject())},_drawMarker:function(){var centerMapLonLat,layerMarkers;this._removeMarkers();centerMapLonLat=this._getMapCenter();layerMarkers=new OpenLayers.Layer.Markers("Markers");this._map.addLayer(layerMarkers);var size=new OpenLayers.Size(32,32),offset=new OpenLayers.Pixel(-16,-size.h),icon=new OpenLayers.Icon(this.getImageUrl()+"/framework/bundle/mapmodule-plugin/images/marker.png",size,offset),marker=new OpenLayers.Marker(centerMapLonLat,icon);layerMarkers.addMarker(marker)},_removeMarkers:function(){var me=this,markerLayers=this._getMapLayersByName("Markers");return _.each(markerLayers,function(markerLayer){me._map.removeLayer(markerLayer,!1)}),markerLayers},_hasMarkers:function(){var markerLayer=this._getMapLayersByName("Markers"),i;if(markerLayer)for(i=0;i<markerLayer.length;i++)if(markerLayer[i]&&markerLayer[i].markers&&markerLayer[i].markers.length>0)return!0;return!1},eventHandlers:{AfterMapLayerAddEvent:function(event){this._afterMapLayerAddEvent(event)},SearchClearedEvent:function(){this._removeMarkers()},LayerToolsEditModeEvent:function(event){this._isInLayerToolsEditMode=event.isInMode()}},_afterMapLayerAddEvent:function(event){var map=this.getMap(),layer=event.getMapLayer(),keepLayersOrder=event.getKeepLayersOrder(),isBaseMap=event.isBasemap(),layerPlugins=this.getLayerPlugins(),markerLayers=this._getMapLayersByName("Markers");_.each(layerPlugins,function(plugin){_.isFunction(plugin.addMapLayerToMap)&&plugin.addMapLayerToMap(layer,keepLayersOrder,isBaseMap)});_.each(markerLayers,function(markerLayer){map.raiseLayer(markerLayer,map.layers.length)})},getOLMapLayers:function(layerId){var me=this,sandbox=me._sandbox,layer=sandbox.findMapLayerFromSelectedMapLayers(layerId),lps,p,layersPlugin,layerList,results;if(!layer)return null;lps=this.getLayerPlugins();results=[];for(p in lps)lps.hasOwnProperty(p)&&(layersPlugin=lps[p],layerList=layersPlugin.getOLMapLayers(layer),layerList&&(results=results.concat(layerList)));return results},changeCssClasses:function(classToAdd,removeClassRegex,elements){for(var j,el,i=0;i<elements.length;i++)el=elements[i],el.removeClass(function(index,classes){var removeThese="",classNames=classes.split(" ");for(j=0;j<classNames.length;++j)removeClassRegex.test(classNames[j])&&(removeThese+=classNames[j]+" ");return removeThese}),el.addClass(classToAdd)},isInLayerToolsEditMode:function(){return this._isInLayerToolsEditMode},_calculateScalesImpl:function(resolutions){for(var calculatedScale,i=0;i<resolutions.length;++i)calculatedScale=OpenLayers.Util.getScaleFromResolution(resolutions[i],"m"),calculatedScale=calculatedScale*1e4,calculatedScale=Math.round(calculatedScale),calculatedScale=calculatedScale/1e4,this._mapScales.push(calculatedScale)},_addMapControlImpl:function(ctl){this._map.addControl(ctl)},_removeMapControlImpl:function(ctl){this._map.removeControl(ctl)}},{protocol:["Oskari.mapframework.module.Module"],extend:["Oskari.mapping.mapmodule.AbstractMapModule"]});Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.Plugin",function(){throw"Oskari.mapframework.ui.module.common.mapmodule.Plugin should not be instantiated";},{getName:function(){throw"Implement your own";},setMapModule:function(){throw"Implement your own";},register:function(){throw"Implement your own";},unregister:function(){throw"Implement your own";},startPlugin:function(){throw"Implement your own";},stopPlugin:function(){throw"Implement your own";},eventHandlers:{},onEvent:function(event){return this.eventHandlers[event.getName()].apply(this,[event])}});Oskari.clazz.define("Oskari.mapframework.mapmodule.ControlsPlugin",function(config){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null;this.conf=config||{}},{__name:"ControlsPlugin",getName:function(){return this.pluginName},hasUI:function(){return!1},getMapModule:function(){return this.mapModule},setMapModule:function(mapModule){this.mapModule=mapModule;mapModule&&(this.pluginName=mapModule.getName()+this.__name,this._createMapControls())},register:function(){},unregister:function(){},init:function(sandbox){var me=this,mapMovementHandler=Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MapMovementControlsRequestHandler",me.getMapModule());this.requestHandlers={ToolSelectionRequest:Oskari.clazz.create("Oskari.mapframework.mapmodule.ToolSelectionHandler",sandbox,me),EnableMapKeyboardMovementRequest:mapMovementHandler,DisableMapKeyboardMovementRequest:mapMovementHandler,EnableMapMouseMovementRequest:mapMovementHandler,DisableMapMouseMovementRequest:mapMovementHandler}},startPlugin:function(sandbox){this._sandbox=sandbox;this._map=this.getMapModule().getMap();sandbox.register(this);var reqName,p;for(reqName in this.requestHandlers)this.requestHandlers.hasOwnProperty(reqName)&&sandbox.addRequestHandler(reqName,this.requestHandlers[reqName]);for(p in this.eventHandlers)this.eventHandlers.hasOwnProperty(p)&&sandbox.registerForEventByName(this,p);this._addMapControls()},stopPlugin:function(sandbox){var reqName,p;for(reqName in this.requestHandlers)this.requestHandlers.hasOwnProperty(reqName)&&sandbox.removeRequestHandler(reqName,this.requestHandlers[reqName]);for(p in this.eventHandlers)this.eventHandlers.hasOwnProperty(p)&&sandbox.unregisterFromEventByName(this,p);sandbox.unregister(this);this._removeMapControls();this._map=null;this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{"Toolbar.ToolSelectedEvent":function(){this.conf.zoomBox!==!1&&this._zoomBoxTool.deactivate();this.conf.measureControls!==!1&&(this._measureControls.line.deactivate(),this._measureControls.area.deactivate())}},onEvent:function(event){return this.eventHandlers[event.getName()].apply(this,[event])},_addMapControls:function(){var me=this;this.conf.zoomBox!==!1&&(this.getMapModule().addMapControl("zoomBoxTool",this._zoomBoxTool),this._zoomBoxTool.deactivate());this.conf.keyboardControls!==!1&&(this.getMapModule().addMapControl("keyboardControls",this._keyboardControls),this.getMapModule().getMapControl("keyboardControls").activate());this.conf.measureControls!==!1&&(this.getMapModule().addMapControl("measureControls_line",this._measureControls.line),this._measureControls.line.deactivate(),this.getMapModule().addMapControl("measureControls_area",this._measureControls.area),this._measureControls.area.deactivate());this.getMapModule().addMapControl("mouseControls",this._mouseControls)},_removeMapControls:function(){this.conf.zoomBox!==!1&&(this._zoomBoxTool.deactivate(),this.getMapModule().removeMapControl("zoomBoxTool",this._zoomBoxTool));this.conf.keyboardControls!==!1&&(this._keyboardControls.deactivate(),this.getMapModule().removeMapControl("keyboardControls",this._keyboardControls));this.conf.measureControls!==!1&&(this._measureControls.line.deactivate(),this._measureControls.area.deactivate(),this.getMapModule().removeMapControl("measureControls_line",this._measureControls.line),this.getMapModule().removeMapControl("measureControls_area",this._measureControls.area));this._mouseControls.deactivate();this.getMapModule().removeMapControl("mouseControls",this._mouseControls)},_createMapControls:function(){function measurementsHandler(event,finished){var sandbox=me._sandbox,geometry=event.geometry,units=event.units,order=event.order,measure=event.measure,out=null,geomAsText,geomMimeType,format;order===1?out=measure.toFixed(3)+" "+units:order===2&&(out=measure.toFixed(3)+" "+units+"<sup>2<\/sup>");geomAsText=null;geomMimeType=null;finished&&OpenLayers.Format.GeoJSON&&(format=new OpenLayers.Format.GeoJSON,geomAsText=format.write(geometry,!0),geomMimeType="application/json");sandbox.request(me,sandbox.getRequestBuilder("ShowMapMeasurementRequest")(out,finished,geomAsText,geomMimeType))}var me=this,sandbox=me._sandbox,optionsLine,optionsPolygon,key,control;if(!this._zoomBoxTool){this.conf.zoomBox!==!1&&(OpenLayers.Control.ZoomBox.prototype.draw=function(){this.handler=new OpenLayers.Handler.Box(this,{done:function(position){this.zoomBox(position);me.getMapModule()&&me.getMapModule().notifyMoveEnd()}},{keyMask:this.keyMask})},this._zoomBoxTool=new OpenLayers.Control.ZoomBox({alwaysZoom:!0}));this.conf.keyboardControls!==!1&&(this._keyboardControls=new OpenLayers.Control.PorttiKeyboard,this._keyboardControls.setup(this.getMapModule()));optionsLine={handlerOptions:{persist:!0},immediate:!0};optionsPolygon={handlerOptions:{persist:!0},immediate:!0};this._measureControls={};this.conf.measureControls!==!1&&(this._measureControls={line:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,optionsLine),area:new OpenLayers.Control.Measure(OpenLayers.Handler.Polygon,optionsPolygon)});for(key in this._measureControls)if(this._measureControls.hasOwnProperty(key)){control=this._measureControls[key];control.events.on({measure:function(event){measurementsHandler(event,!0)},measurepartial:function(event){measurementsHandler(event,!1)}})}this.conf.mouseControls!==!1&&(this._mouseControls=new OpenLayers.Control.PorttiMouse(this.conf.mouse),this._mouseControls.setup(this.getMapModule()))}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});OpenLayers.Control.PorttiKeyboard=OpenLayers.Class(OpenLayers.Control,{autoActivate:!1,slideFactor:50,core:null,setup:function(mapmodule){this.mapmodule=mapmodule;this.sandbox=mapmodule.getSandbox()},initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments)},draw:function(){this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyDown,keyup:this.defaultKeyUp})},defaultKeyDown:function(evt){if(!(jQuery("input:focus").length>0))switch(evt.keyCode){case OpenLayers.Event.KEY_LEFT:this.mapmodule.panMapByPixels(-this.slideFactor,0,!1,!0);break;case OpenLayers.Event.KEY_RIGHT:this.mapmodule.panMapByPixels(this.slideFactor,0,!1,!0);break;case OpenLayers.Event.KEY_UP:this.mapmodule.panMapByPixels(0,-this.slideFactor,!1,!0);break;case OpenLayers.Event.KEY_DOWN:this.mapmodule.panMapByPixels(0,this.slideFactor,!1,!0);break;case 17:this.sandbox.postRequestByName("CtrlKeyDownRequest");break;case 27:this.sandbox.postRequestByName("EscPressedEvent");break;case 33:this.mapmodule.notifyStartMove();this.mapmodule.panMapNorth();break;case 34:this.mapmodule.notifyStartMove();this.mapmodule.panMapSouth();break;case 35:this.mapmodule.notifyStartMove();this.mapmodule.panMapEast();break;case 36:this.mapmodule.notifyStartMove();this.mapmodule.panMapWest();break;case 43:case 61:case 187:case 107:this.mapmodule.zoomIn();break;case 45:case 109:case 189:case 95:this.mapmodule.zoomOut();break;case 70:this.sandbox.postRequestByName("MapFull.MapWindowFullScreenRequest")}},defaultKeyUp:function(evt){switch(evt.keyCode){case 17:this.sandbox.postRequestByName("CtrlKeyUpRequest");break;case 37:case 38:case 39:case 40:case 33:case 34:case 35:case 36:case 43:case 61:case 187:case 107:case 45:case 109:case 189:case 95:this.mapmodule.notifyMoveEnd()}},CLASS_NAME:"OpenLayers.Control.PorttiKeyboard"});OpenLayers.Control.PorttiMouse=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:1,documentDrag:!1,kinetic:null,enableKinetic:!1,kineticInterval:10,pinchZoom:null,pinchZoomOptions:null,zoomBox:null,zoomBoxEnabled:!0,zoomWheelEnabled:!0,mouseWheelOptions:null,handleRightClicks:!1,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:!0,useCenterMapInWheelZoom:!1,useCenterMapInDblClickZoom:!1,initialize:function(){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments)},setup:function(mapmodule){this.mapmodule=mapmodule;this.sandbox=this.mapmodule.getSandbox();this._hoverEventBuilder=this.sandbox.getEventBuilder("MouseHoverEvent");this._hoverEvent=this._hoverEventBuilder();this._mapClickedBuilder=this.sandbox.getEventBuilder("MapClickedEvent")},destroy:function(){this.deactivate();this.zoomBox&&this.zoomBox.destroy();this.zoomBox=null;this.pinchZoom&&this.pinchZoom.destroy();this.pinchZoom=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.handlers.drag.activate(),this.zoomWheelEnabled&&this.handlers.wheel.activate(),this.handlers.click.activate(),this.handlers.hover.activate(),this.zoomBoxEnabled&&this.zoomBox.activate(),this.pinchZoom&&this.pinchZoom.activate(),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.pinchZoom&&this.pinchZoom.deactivate(),this.zoomBox.deactivate(),this.handlers.drag.deactivate(),this.handlers.click.deactivate(),this.handlers.wheel.deactivate(),this.handlers.hover.deactivate(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){var config,clickCallbacks,clickOptions,pinchZoomOptions;this.enableKinetic&&(config={interval:this.kineticInterval},typeof this.enableKinetic=="object"&&(config=OpenLayers.Util.extend(config,this.enableKinetic)),this.kinetic=new OpenLayers.Kinetic(config));this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag});this.handleRightClicks&&(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False);clickCallbacks={click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick};clickOptions={double:!0,stopDouble:!0};this.handlers.click=new OpenLayers.Handler.Click(this,clickCallbacks,clickOptions);var hoverCallbacks={move:this.defaultHoverMove,pause:this.defaultHoverPause},me=this,hoverOptions={pixelTolerance:1.1,passesTolerance:function(px){var passes=!0,dpx;return me.panned?!1:(this.pixelTolerance&&this.px&&(dpx=Math.sqrt(Math.pow(this.px.x-px.x,2)+Math.pow(this.px.y-px.y,2)),dpx<this.pixelTolerance&&(passes=!1)),passes)}};this.handlers.hover=new OpenLayers.Handler.Hover(this,hoverCallbacks,hoverOptions);this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask});this.dragPan.draw();this.zoomBox.draw();this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},this.mouseWheelOptions);OpenLayers.Control.PinchZoom&&(pinchZoomOptions=this.pinchZoomOptions||{},pinchZoomOptions.pinchDone=function(evt,start,last){var zoom;if(this.applyTransform(""),zoom=this.map.getZoomForResolution(this.map.getResolution()/last.scale,!0),zoom!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){var resolution=this.map.getResolutionForZoom(zoom),location=this.map.getLonLatFromPixel(this.pinchOrigin),zoomPixel=this.currentCenter,size=this.map.getSize();location.lon+=resolution*(size.w/2-zoomPixel.x);location.lat-=resolution*(size.h/2-zoomPixel.y);me.sendMapSetCenter(location,zoom)}},this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},pinchZoomOptions)))},defaultClick:function(evt){var isIE8,now;evt.lastTouches&&evt.lastTouches.length==2?this.sendMapZoomOut():(isIE8=navigator.userAgent.indexOf("MSIE 8.0")!=-1,isIE8?(now=(new Date).getTime(),this.lastDblClickMs?now-this.lastDblClickMs<1e3||this.sendMapClickEvent(evt):this.sendMapClickEvent(evt)):this.sendMapClickEvent(evt))},defaultDblClick:function(evt){var currentZoom=this.map.getZoom(),newZoom=this.map.getZoom()+Math.round(1),isIE8;if(newZoom=Math.max(newZoom,0),newZoom=Math.min(newZoom,this.map.getNumZoomLevels()),newZoom!==currentZoom){var size=this.map.getSize(),deltaX=size.w/2-evt.xy.x,deltaY=evt.xy.y-size.h/2,newRes=this.map.baseLayer.getResolutionForZoom(newZoom),zoomPoint=this.map.getLonLatFromPixel(evt.xy),newCenter=null;newCenter=this.useCenterMapInDblClickZoom?this.map.getCenter():new OpenLayers.LonLat(zoomPoint.lon+deltaX*newRes,zoomPoint.lat+deltaY*newRes);isIE8=navigator.userAgent.indexOf("MSIE 8.0")!=-1;isIE8&&(this.lastDblClickMs=(new Date).getTime());this.sendMapSetCenter(newCenter,newZoom)}},defaultDblRightClick:function(){this.sendMapZoomOut()},wheelChange:function(evt,deltaZ){var currentZoom=this.map.getZoom(),newZoom=this.map.getZoom()+Math.round(deltaZ);if(newZoom=Math.max(newZoom,0),newZoom=Math.min(newZoom,this.map.getNumZoomLevels()),newZoom!==currentZoom){var size=this.map.getSize(),deltaX=size.w/2-evt.xy.x,deltaY=evt.xy.y-size.h/2,newRes=this.map.baseLayer.getResolutionForZoom(newZoom),zoomPoint=this.map.getLonLatFromPixel(evt.xy),newCenter=null;newCenter=this.useCenterMapInWheelZoom?this.map.getCenter():new OpenLayers.LonLat(zoomPoint.lon+deltaX*newRes,zoomPoint.lat+deltaY*newRes);this.sendMapSetCenter(newCenter,newZoom)}},wheelUp:function(evt,delta){this.wheelChange(evt,delta||1)},wheelDown:function(evt,delta){this.wheelChange(evt,delta||-1)},disableZoomBox:function(){this.zoomBoxEnabled=!1;this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=!0;this.active&&this.zoomBox.activate()},disableZoomWheel:function(){this.zoomWheelEnabled=!1;this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=!0;this.active&&this.handlers.wheel.activate()},panMapStart:function(){this.kinetic&&this.kinetic.begin();this.panned=!1},panMap:function(xy){this.kinetic&&this.kinetic.update(xy);this.panned||this.mapmodule.notifyStartMove();this.panned=!0;this.map.pan(this.handlers.drag.last.x-xy.x,this.handlers.drag.last.y-xy.y,{dragging:!0,animate:!1})},panMapDone:function(xy){var res,self;this.panned&&(res=null,this.kinetic&&(res=this.kinetic.end(xy)),this.mapmodule.panMapByPixels(this.handlers.drag.x-xy.x,this.handlers.drag.y-xy.y,!0,!1,!1),res&&(self=this,this.kinetic.move(res,function(x,y){self.mapmodule.panMapByPixels(x,y,!0,!1,!1)})),this.panned=!1)},defaultHoverMove:function(evt){if(!this.panned){var lonlat=this.map.getLonLatFromViewPortPx(evt.xy);this._hoverEvent.set(lonlat.lon,lonlat.lat,!1,evt.pageX,evt.pageY);this.sandbox.notifyAll(this._hoverEvent,!0)}},defaultHoverPause:function(evt){if(!this.panned){var lonlat=this.map.getLonLatFromViewPortPx(evt.xy);this._hoverEvent.set(lonlat.lon,lonlat.lat,!0,evt.pageX,evt.pageY);this.sandbox.notifyAll(this._hoverEvent)}},sendMapClickEvent:function(evt){var lonlat=this.map.getLonLatFromViewPortPx(evt.xy),event=this._mapClickedBuilder(lonlat,evt.xy.x,evt.xy.y);this.sandbox.notifyAll(event)},sendMapSetCenter:function(newCenter,newZoom){this.mapmodule.centerMap(newCenter,newZoom)},sendMapZoomOut:function(){this.mapmodule.zoomOut()},sendMapZoomIn:function(){this.mapmodule.zoomIn()},CLASS_NAME:"OpenLayers.Control.PorttiMouse"});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.DisableMapKeyboardMovementRequest",function(){this._creator=null},{__name:"DisableMapKeyboardMovementRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.DisableMapMouseMovementRequest",function(){this._creator=null},{__name:"DisableMapMouseMovementRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.EnableMapKeyboardMovementRequest",function(){this._creator=null},{__name:"EnableMapKeyboardMovementRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.EnableMapMouseMovementRequest",function(){this._creator=null},{__name:"EnableMapMouseMovementRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapMovementControlsRequestHandler",function(mapModule){this.mapModule=mapModule},{handleRequest:function(core,request){var control;request.getName()==="EnableMapKeyboardMovementRequest"?(control=this.mapModule.getMapControl("keyboardControls"),control&&control.activate()):request.getName()==="DisableMapKeyboardMovementRequest"?(control=this.mapModule.getMapControl("keyboardControls"),control&&control.deactivate()):request.getName()==="EnableMapMouseMovementRequest"?(control=this.mapModule.getMapControl("mouseControls"),control&&(control.activate(),control.registerMouseEvents())):request.getName()==="DisableMapMouseMovementRequest"&&(control=this.mapModule.getMapControl("mouseControls"),control&&(control.deactivate(),control.unregisterMouseEvents()))}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.request.common.ShowMapMeasurementRequest",function(value,finished,geometry,geometryMimeType){this._creator=null;this._value=value;this._geometry=geometry;this._finished=finished;this._geometryMimeType=geometryMimeType},{__name:"ShowMapMeasurementRequest",getName:function(){return this.__name},getValue:function(){return this._value},getGeometry:function(){return this._geometry},getGeometryMimeType:function(){return this._geometryMimeType},isFinished:function(){return this._finished}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.getinfo.GetFeatureInfoHandler",function(getInfoPlugin){this.getInfoPlugin=getInfoPlugin},{handleRequest:function(core,request){request.getName()=="MapModulePlugin.GetFeatureInfoRequest"?this.getInfoPlugin.handleGetInfo({lon:request.getLon(),lat:request.getLat()},request.getX(),request.getY()):request.getName()=="MapModulePlugin.GetFeatureInfoActivationRequest"&&this.getInfoPlugin.setEnabled(request.isEnabled())}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.GetFeatureInfoRequest",function(lon,lat,coordX,coordY){this._lon=lon;this._lat=lat;this._x=coordX;this._y=coordY},{__name:"MapModulePlugin.GetFeatureInfoRequest",getName:function(){return this.__name},getLon:function(){return this._lon},getLat:function(){return this._lat},getX:function(){return this._x},getY:function(){return this._y}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.GetFeatureInfoActivationRequest",function(blnEnable){this._enable=blnEnable===!0},{__name:"MapModulePlugin.GetFeatureInfoActivationRequest",getName:function(){return this.__name},isEnabled:function(){return this._enable}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.mapmodule.GetInfoPlugin",function(config,locale){var me=this,p;me.config=config;me._locale=locale;me.mapModule=null;me.pluginName=null;me._sandbox=null;me._map=null;me.enabled=!0;me.infoboxId="getinforesult";me._pendingAjaxQuery={busy:!1,jqhr:null,timestamp:null};me.clickLocation=null;me.template={};for(p in me.__templates)me.__templates.hasOwnProperty(p)&&(me.template[p]=jQuery(me.__templates[p]))},{__name:"GetInfoPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(mapModule){this.mapModule=mapModule;mapModule&&(this.pluginName=mapModule.getName()+this.__name)},hasUI:function(){return!0},init:function(sandbox){var me=this;me._sandbox=sandbox;me._sandbox.printDebug("[GetInfoPlugin] init");me.getGFIHandler=Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.getinfo.GetFeatureInfoHandler",me)},register:function(){},unregister:function(){},startPlugin:function(sandbox){var me=this,p;sandbox&&sandbox.register&&(me._sandbox=sandbox);me._map=me.getMapModule().getMap();me._sandbox.register(me);for(p in me.eventHandlers)me.eventHandlers.hasOwnProperty(p)&&me._sandbox.registerForEventByName(me,p);me._sandbox.addRequestHandler("MapModulePlugin.GetFeatureInfoRequest",me.getGFIHandler);me._sandbox.addRequestHandler("MapModulePlugin.GetFeatureInfoActivationRequest",me.getGFIHandler)},stopPlugin:function(sandbox){var me=this,p;me._closeGfiInfo();sandbox&&sandbox.register&&(me._sandbox=sandbox);for(p in me.eventHandlers)me.eventHandlers.hasOwnProperty(p)&&me._sandbox.unregisterFromEventByName(me,p);me._sandbox.unregister(me);me._map=null;me._sandbox=null;me.clickLocation=null},start:function(){},stop:function(){},setEnabled:function(blnEnabled){this.enabled=blnEnabled===!0;this.enabled||this._closeGfiInfo()},eventHandlers:{EscPressedEvent:function(){this._closeGfiInfo()},MapClickedEvent:function(evt){this.enabled&&(this.clickLocation={lonlat:evt.getLonLat()},this.handleGetInfo(this.clickLocation.lonlat))},AfterMapMoveEvent:function(){this._cancelAjaxRequest()},AfterMapLayerRemoveEvent:function(evt){this._refreshGfiInfo("remove",evt.getMapLayer().getId())},AfterMapLayerAddEvent:function(){this._refreshGfiInfo()},"InfoBox.InfoBoxEvent":function(evt){this._handleInfoBoxEvent(evt)},GetInfoResultEvent:function(evt){this._handleInfoResult(evt.getData())}},onEvent:function(event){var me=this;return this.eventHandlers[event.getName()].apply(this,[event])},_cancelAjaxRequest:function(){var me=this,jqhr;me._pendingAjaxQuery.busy&&(jqhr=me._pendingAjaxQuery.jqhr,me._pendingAjaxQuery.jqhr=null,jqhr)&&(this._sandbox.printDebug("[GetInfoPlugin] Abort jqhr ajax request"),jqhr.abort(),jqhr=null,me._pendingAjaxQuery.busy=!1)},_buildLayerIdList:function(){var me=this,selected=me._sandbox.findAllSelectedMapLayers(),layerIds;return layerIds=_.chain(selected).filter(function(layer){return me._isQualified(layer)}).map(function(layer){return layer.getId()}).value().join(","),layerIds||null},_isQualified:function(layer){return!this._isIgnoredLayerType(layer)&&layer.getQueryable&&layer.getQueryable()&&layer.isInScale(this._sandbox.getMap().getScale())&&layer.isVisible()},_isIgnoredLayerType:function(layer){return _.any((this.config||{}).ignoredLayerTypes,function(type){return layer.isLayerOfType(type)})},_startAjaxRequest:function(dteMs){this._pendingAjaxQuery.busy=!0;this._pendingAjaxQuery.timestamp=dteMs},_finishAjaxRequest:function(){this._pendingAjaxQuery.busy=!1;this._pendingAjaxQuery.jqhr=null;this._sandbox.printDebug("[GetInfoPlugin] finished jqhr ajax request")},_notifyAjaxFailure:function(){this._sandbox.printDebug("[GetInfoPlugin] GetFeatureInfo AJAX failed")},_isAjaxRequestBusy:function(){return this._pendingAjaxQuery.busy},handleGetInfo:function(lonlat){var me=this,dteMs=(new Date).getTime(),layerIds=me._buildLayerIdList(),ajaxUrl=this._sandbox.getAjaxUrl(),mapVO=me._sandbox.getMap(),olMap=me.mapModule.getMap(),px=olMap.getViewPortPxFromLonLat(lonlat);if(layerIds){if(me._pendingAjaxQuery.busy&&me._pendingAjaxQuery.timestamp&&dteMs-me._pendingAjaxQuery.timestamp<500){me._sandbox.printDebug("[GetInfoPlugin] GetFeatureInfo NOT SENT (time difference < 500ms)");return}me._cancelAjaxRequest();me._startAjaxRequest(dteMs);jQuery.ajax({beforeSend:function(x){me._pendingAjaxQuery.jqhr=x;x&&x.overrideMimeType&&x.overrideMimeType("application/j-son;charset=UTF-8")},success:function(resp){me._isAjaxRequestBusy()&&_.each(resp.data,function(datum){me._handleInfoResult({features:[datum],lonlat:lonlat,via:"ajax"})});me._finishAjaxRequest()},error:function(){me._finishAjaxRequest();me._notifyAjaxFailure()},always:function(){me._finishAjaxRequest()},complete:function(){me._finishAjaxRequest()},data:{layerIds:layerIds,projection:me.mapModule.getProjection(),x:px.x,y:px.y,lon:lonlat.lon,lat:lonlat.lat,width:mapVO.getWidth(),height:mapVO.getHeight(),bbox:mapVO.getBbox().toBBOX(),zoom:mapVO.getZoom(),srs:mapVO.getSrsName()},type:"POST",dataType:"json",url:ajaxUrl+"action_route=GetFeatureInfoWMS"})}},_handleInfoResult:function(data){var content=[],contentData={},fragments=[];fragments=data.via==="ajax"?this._parseGfiResponse(data):this._formatWFSFeaturesForInfoBox(data);fragments.length&&(contentData.actions={},contentData.html=this._renderFragments(fragments),contentData.layerId=fragments[0].layerId,content.push(contentData));this._showGfiInfo(content,data.lonlat)},_closeGfiInfo:function(){var reqBuilder=this._sandbox.getRequestBuilder("InfoBox.HideInfoBoxRequest"),request;reqBuilder&&(request=reqBuilder(this.infoboxId),this._sandbox.request(this,request))},_showGfiInfo:function(content,lonlat){var pluginLoc=this.getMapModule().getLocalization("plugin",!0),infoboxLoc=pluginLoc[this.__name],reqBuilder=this._sandbox.getRequestBuilder("InfoBox.ShowInfoBoxRequest"),request,colourScheme,font;_.isObject(this.config)&&(colourScheme=this.config.colourScheme,font=this.config.font);reqBuilder&&(request=reqBuilder(this.infoboxId,infoboxLoc.title,content,lonlat,!0,colourScheme,font),this._sandbox.request(this,request))},_refreshGfiInfo:function(operation,contentId){if(this.clickLocation){var reqB=this._sandbox.getRequestBuilder("InfoBox.RefreshInfoBoxRequest"),req;reqB&&(req=reqB(this.infoboxId,operation,contentId),this._sandbox.request(this,req))}},_handleInfoBoxEvent:function(evt){var me=this,clickLoc=this.clickLocation,clickEventB,clickEvent;evt.getId()===this.infoboxId&&evt.isOpen()&&_.isObject(clickLoc)&&(clickEventB=this._sandbox.getEventBuilder("MapClickedEvent"),clickEvent=clickEventB(clickLoc.lonlat),setTimeout(function(){me._sandbox.notifyAll(clickEvent)},0))}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.category("Oskari.mapframework.mapmodule.GetInfoPlugin","formatter",{__templates:{wrapper:"<div><\/div>",getinfoResultTable:'<table class="getinforesult_table"><\/table>',tableRow:"<tr><\/tr>",tableCell:"<td><\/td>",span:"<span><\/span>",header:'<div class="getinforesult_header"><div class="icon-bubble-left"><\/div>',headerTitle:'<div class="getinforesult_header_title"><\/div>',myPlacesWrapper:'<div class="myplaces_place"><h3 class="myplaces_header"><\/h3><p class="myplaces_desc"><\/p><a class="myplaces_imglink" target="_blank"><img class="myplaces_img"><\/img><\/a><a class="myplaces_link"><\/a><\/div>',linkOutside:'<a target="_blank"><\/a>'},_renderFragments:function(fragments){var me=this;return _.foldl(fragments,function(wrapper,fragment){var fragmentTitle=fragment.layerName,fragmentMarkup=fragment.markup;if(fragment.isMyPlace)fragmentMarkup&&wrapper.append(fragmentMarkup);else{var contentWrapper=me.template.wrapper.clone(),headerWrapper=me.template.header.clone(),titleWrapper=me.template.headerTitle.clone();titleWrapper.append(fragmentTitle);headerWrapper.append(titleWrapper);contentWrapper.append(headerWrapper);fragmentMarkup&&contentWrapper.append(fragmentMarkup);wrapper.append(contentWrapper)}return delete fragment.isMyPlace,wrapper},me.template.wrapper.clone())},_parseGfiResponse:function(data){if(data.layerCount!==0){var me=this,sandbox=this._sandbox,coll;return coll=_.chain(data.features).map(function(datum){var layer=sandbox.findMapLayerFromSelectedMapLayers(datum.layerId),layerName=layer?layer.getName():"",pretty=me._formatGfiDatum(datum);if(pretty!==null&&pretty!==undefined)return{markup:pretty,layerId:datum.layerId,layerName:layerName,type:datum.type}}).reject(function(feature){return feature===undefined}).value(),coll||[]}},_formatGfiDatum:function(datum){var i,attr,jsonData,table,value,row,labelCell,pluginLoc,myLoc,localizedAttr,valueCell,parsedHTML;if(!datum.presentationType)return null;var me=this,response=me.template.wrapper.clone(),contentType=typeof datum.content,hasHtml=!1;if(contentType==="string"&&(hasHtml=datum.content.indexOf("<html")>=0,hasHtml=hasHtml||datum.content.indexOf("<HTML")>=0),datum.presentationType==="JSON"||datum.content&&datum.content.parsed){if(datum.layerId&&typeof datum.layerId=="string"&&datum.layerId.match("myplaces_"))return me._formatMyPlacesGfi(datum);var even=!1,rawJsonData=datum.content.parsed,dataArray=[];for(Object.prototype.toString.call(rawJsonData)==="[object Array]"?dataArray=rawJsonData:dataArray.push(rawJsonData),i=0;i<dataArray.length;++i){jsonData=dataArray[i];table=me.template.getinfoResultTable.clone();for(attr in jsonData)jsonData.hasOwnProperty(attr)&&(value=me._formatJSONValue(jsonData[attr]),value&&(row=me.template.tableRow.clone(),table.append(row),even||row.addClass("odd"),even=!even,labelCell=me.template.tableCell.clone(),pluginLoc=this.getMapModule().getLocalization("plugin",!0),myLoc=pluginLoc[this.__name],localizedAttr=myLoc[attr],labelCell.append(localizedAttr||attr),row.append(labelCell),valueCell=me.template.tableCell.clone(),valueCell.append(value),row.append(valueCell)));response.append(table)}return response}if(hasHtml){if(parsedHTML=jQuery("<div><\/div>").append(datum.content),parsedHTML.find("link, meta, script, style, title").remove(),jQuery.trim(parsedHTML.html())==="")return null;parsedHTML.find("table").addClass("getinforesult_table");parsedHTML.find("tr:even").addClass("odd");response.append(parsedHTML.html())}else response.append(datum.content);return response},_formatJSONValue:function(pValue){var value,placeHolder,i,obj,objAttr,innerValue,pluginLoc,myLoc,localizedAttr,label,link;if(pValue){if(value=this.template.span.clone(),Object.prototype.toString.call(pValue)==="[object Array]")for(placeHolder="",i=0;i<pValue.length;++i){obj=pValue[i];for(objAttr in obj)obj.hasOwnProperty(objAttr)&&(innerValue=this._formatJSONValue(obj[objAttr]),innerValue&&(pluginLoc=this.getMapModule().getLocalization("plugin",!0),myLoc=pluginLoc[this.__name],localizedAttr=myLoc[objAttr],value.append(localizedAttr||objAttr),value.append(": "),value.append(innerValue),value.append("<br/>")))}else pValue.indexOf&&pValue.indexOf("://")>0&&pValue.indexOf("://")<7?(label=value,link=this.template.linkOutside.clone(),link.attr("href",pValue),link.append(pValue),value.append(link)):value.append(pValue);return value}},_formatWFSFeaturesForInfoBox:function(data){var me=this,layer=this._sandbox.findMapLayerFromSelectedMapLayers(data.layerId),isMyPlace=layer.isLayerOfType("myplaces"),fields=layer.getFields().slice(),hiddenFields=["__fid","__centerX","__centerY"],type="wfslayer",markup;if(data.features!="empty"&&layer!==null&&layer!==undefined)return isMyPlace||(fields=_.chain(fields).zip(layer.getLocales().slice()).map(function(pair){return _.contains(hiddenFields,_.first(pair))?_.first(pair):_.last(pair)||_.first(pair)}).value()),_.map(data.features,function(feature){var feat=_.chain(fields).zip(feature).filter(function(pair){return!_.contains(hiddenFields,_.first(pair))}).foldl(function(obj,pair){return obj[_.first(pair)]=_.last(pair),obj},{}).value();return markup=isMyPlace?me._formatMyPlacesGfi(feat):me._json2html(feat),{markup:markup,layerId:data.layerId,layerName:layer.getName(),type:type,isMyPlace:isMyPlace}})},_formatMyPlacesGfi:function(place){var me=this,content=me.template.myPlacesWrapper.clone(),img=content.find("a.myplaces_imglink"),link=content.find("a.myplaces_link");return content.find("h3.myplaces_header").html(place.name),content.find("p.myplaces_desc").html(place.place_desc),place.image_url?img.attr({href:place.image_url}).find("img.myplaces_img").attr({src:place.image_url}):img.remove(),place.link?link.attr({href:place.link}).html(place.link):link.remove(),content},_json2html:function(node){var value,vType,valpres,valueDiv,i,innerTable;if(node===null||node===undefined)return"";var even=!0,html=this.template.getinfoResultTable.clone(),row=null,keyColumn=null,valColumn=null;for(var key in node)if(value=node[key],value&&key){vType=(typeof value).toLowerCase();valpres="";switch(vType){case"string":value.indexOf("http://")===0?(valpres=this.template.linkOutside.clone(),valpres.attr("href",value),valpres.append(value)):valpres=value;break;case"undefined":valpres="n/a";break;case"boolean":valpres=value?"true":"false";break;case"number":valpres=""+value;break;case"function":valpres="?";break;case"object":if(jQuery.isArray(value)){for(valueDiv=this.template.wrapper.clone(),i=0;i<value.length;++i)innerTable=this._json2html(value[i]),valueDiv.append(innerTable);valpres=valueDiv}else valpres=this._json2html(value);break;default:valpres=""}even=!even;row=this.template.tableRow.clone();even||row.addClass("odd");keyColumn=this.template.tableCell.clone();keyColumn.append(key);row.append(keyColumn);valColumn=this.template.tableCell.clone();valColumn.append(valpres);row.append(valColumn);html.append(row)}return html}});Oskari.clazz.define("Oskari.mapframework.mapmodule.MarkersPlugin",function(){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null},{__name:"MarkersPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(mapModule){this.mapModule=mapModule;mapModule&&(this.pluginName=mapModule.getName()+this.__name)},hasUI:function(){return!0},init:function(){this.requestHandler=Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MarkerRequestHandler",this)},register:function(){},unregister:function(){},startPlugin:function(sandbox){this._sandbox=sandbox;this._map=this.getMapModule().getMap();this._createMapMarkersLayer();sandbox.register(this);this._sandbox.addRequestHandler("MapModulePlugin.RemoveMarkerRequest",this.requestHandler);for(var p in this.eventHandlers)this.eventHandlers.hasOwnProperty(p)&&sandbox.registerForEventByName(this,p)},stopPlugin:function(sandbox){this._sandbox.removeRequestHandler("MapModulePlugin.RemoveMarkerRequest",this.requestHandler);for(var p in this.eventHandlers)this.eventHandlers.hasOwnProperty(p)&&sandbox.unregisterFromEventByName(this,p);sandbox.unregister(this);this._map=null;this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{},onEvent:function(event){return this.eventHandlers[event.getName()].apply(this,[event])},removeMapMarkers:function(){var mapModule=this.getMapModule();mapModule&&mapModule._removeMarkers()},_createMapMarkersLayer:function(){var sandbox=this._sandbox,layerMarkers=new OpenLayers.Layer.Markers("Markers");this._map.addLayer(layerMarkers)}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.RemoveMarkerRequest",function(markerIdList){this._list=markerIdList},{__name:"MapModulePlugin.RemoveMarkerRequest",getName:function(){return this.__name},getMarkerIds:function(){return this._list}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MarkerRequestHandler",function(markersPlugin){this.markersPlugin=markersPlugin},{handleRequest:function(core,request){request.getName()==="MapModulePlugin.RemoveMarkerRequest"&&this.markersPlugin.removeMapMarkers(request.getMarkerIds())}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.SearchPlugin",function(config){var me=this;me.mapModule=null;me.pluginName=null;me._sandbox=null;me._map=null;me.conf=config;me.element=null;me.loc=null},{__name:"SearchPlugin",getClazz:function(){return"Oskari.mapframework.bundle.mapmodule.plugin.SearchPlugin"},getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(mapModule){this.mapModule=mapModule;mapModule&&(this.pluginName=mapModule.getName()+this.__name)},hasUI:function(){return!0},init:function(sandbox){var me=this,pluginLoc=me.getMapModule().getLocalization("plugin",!0),ajaxUrl;me.loc=pluginLoc[me.__name];me.template=jQuery('<div class="mapplugin search default-search-div" data-clazz="Oskari.mapframework.bundle.mapmodule.plugin.SearchPlugin"><div class="search-textarea-and-button"><input placeholder="'+me.loc.placeholder+'" type="text" /><input type="button" value="'+me.loc.search+'" name="search" /><\/div><div class="results"><div class="header"><div class="close icon-close" title="'+me.loc.close+'"><\/div><\/div><div class="content">&nbsp;<\/div><\/div><\/div>');me.styledTemplate=jQuery('<div class="mapplugin search published-search-div" data-clazz="Oskari.mapframework.bundle.mapmodule.plugin.SearchPlugin"><div class="search-area-div search-textarea-and-button"><div class="search-left"><\/div><div class="search-middle"><input class="search-input" placeholder="'+me.loc.placeholder+'" type="text" /><div class="close-results icon-close" title="'+me.loc.close+'"><\/div><\/div><div class="search-right"><\/div><\/div><div class="results published-search-results"><div class="content published-search-content"><\/div><\/div><\/div>');me.templateResultsTable=jQuery("<table class='search-results'><thead><tr><th>"+me.loc.column_name+"<\/th><th>"+me.loc.column_village+"<\/th><th>"+me.loc.column_type+"<\/th><\/tr><\/thead><tbody><\/tbody><\/table>");me.templateResultsRow=jQuery("<tr><td><a href='JavaScript:void(0);'><\/a><\/td><td><\/td><td><\/td><\/tr>");ajaxUrl=null;ajaxUrl=me.conf&&me.conf.url?me.conf.url:sandbox.getAjaxUrl()+"action_route=GetSearchResult";me.service=Oskari.clazz.create("Oskari.mapframework.bundle.search.service.SearchService",ajaxUrl)},register:function(){},unregister:function(){},startPlugin:function(sandbox){var me=this,p;me._sandbox=sandbox||me.getMapModule().getSandbox();me._map=me.getMapModule().getMap();me._sandbox.register(me);for(p in me.eventHandlers)me.eventHandlers.hasOwnProperty(p)&&me._sandbox.registerForEventByName(me,p);me._createUI()},stopPlugin:function(){var me=this,p;me.element.remove();me.element=null;for(p in me.eventHandlers)me.eventHandlers.hasOwnProperty(p)&&me._sandbox.unregisterFromEventByName(me,p);me._sandbox.unregister(me);me._map=null;me._sandbox=null},start:function(){},stop:function(){},eventHandlers:{LayerToolsEditModeEvent:function(event){this._setLayerToolsEditMode(event.isInMode())}},_setLayerToolsEditMode:function(isInEditMode){if(this.isInLayerToolsEditMode!==isInEditMode)if(this.isInLayerToolsEditMode=isInEditMode,this.isInLayerToolsEditMode){this._inputField.prop("disabled",!0);this._searchButton.prop("disabled",!0);var overlay=jQuery('<div class="search-editmode-overlay">');this.element.find(".search-textarea-and-button").css({position:"relative"}).append(overlay);overlay.mousedown(function(e){e.preventDefault()})}else this._inputField.prop("disabled",!1),this._searchButton.prop("disabled",!1),this.element.find(".search-editmode-overlay").remove()},onEvent:function(event){return this.eventHandlers[event.getName()].apply(this,[event])},setLocation:function(location){var me=this;me.conf||(me.conf={});me.conf.location||(me.conf.location={});me.conf.location.classes=location;me.element&&me.getMapModule().setMapControlPlugin(me.element,location,1)},_createUI:function(){var me=this,content;me.conf&&me.conf.toolStyle?(content=me.styledTemplate.clone(),me.element=content,me._inputField=content.find("input[type=text]"),me._searchButton=content.find("input[type=button]"),me.changeToolStyle(me.conf.toolStyle,content)):(content=me.template.clone(),me.element=content,me._inputField=content.find("input[type=text]"),me._searchButton=content.find("input[type=button]"));me._bindUIEvents()},_bindUIEvents:function(){var me=this,sandbox=me._sandbox,content=this.element,containerClasses="top left",position=1;me._inputField.focus(function(){sandbox.request(me.getName(),sandbox.getRequestBuilder("DisableMapKeyboardMovementRequest")())});me._inputField.blur(function(){sandbox.request(me.getName(),sandbox.getRequestBuilder("EnableMapKeyboardMovementRequest")())});me._inputField.keypress(function(event){me.isInLayerToolsEditMode||me._checkForEnter(event)});me._searchButton.click(function(){me.isInLayerToolsEditMode||me._doSearch()});content.find("div.search-right").click(function(){me.isInLayerToolsEditMode||me._doSearch()});content.find("div.close").click(function(){me.isInLayerToolsEditMode||(me._hideSearch(),me._inputField.val(""))});content.find("div.close-results").click(function(){me.isInLayerToolsEditMode||(me._hideSearch(),me._inputField.val(""))});content.find("div.results").hide();me.conf&&me.conf.location&&(containerClasses=me.conf.location.classes||containerClasses,position=me.conf.location.position||position);me.getMapModule().setMapControlPlugin(content,containerClasses,position);me.conf&&me.conf.font&&me.changeFont(me.conf.font,content);me.conf&&me.conf.toolStyle&&me._inputField.keyup(function(e){e.keyCode!==27&&(e.keyCode!==8||jQuery(this).val())||me._hideSearch()});me._setLayerToolsEditMode(me.getMapModule().isInLayerToolsEditMode())},_checkForEnter:function(event){var keycode;window.event?keycode=window.event.keyCode:event&&(keycode=event.which);event.keyCode===13&&this._doSearch()},_doSearch:function(){var me,inputField;if(!this._searchInProgess){me=this;me._hideSearch();me._searchInProgess=!0;inputField=me.element.find("input[type=text]");inputField.addClass("search-loading");var searchText=inputField.val(),searchCallback=function(msg){me._showResults(msg);me._enableSearch()},onErrorCallback=function(){me._enableSearch()};me.service.doSearch(searchText,searchCallback,onErrorCallback)}},_showResults:function(msg){var errorMsg=msg.error,me=this,resultsContainer=me.element.find("div.results"),header=resultsContainer.find("div.header"),content=resultsContainer.find("div.content"),totalCount,lat,lon,zoom;if(errorMsg){content.html(errorMsg);resultsContainer.show();return}if(totalCount=msg.totalCount,totalCount===0)content.html(this.loc.noresults),resultsContainer.show();else if(totalCount===1)lon=msg.locations[0].lon,lat=msg.locations[0].lat,zoom=msg.locations[0].zoomLevel,me._sandbox.request(me.getName(),me._sandbox.getRequestBuilder("MapMoveRequest")(lon,lat,zoom,!1));else{for(var table=me.templateResultsTable.clone(),tableBody=table.find("tbody"),clickFunction=function(){return me._resultClicked(jQuery(this).attr("data-location")),!1},i=0;i<totalCount;i+=1){if(i>=100){tableBody.append("<tr><td class='search-result-too-many' colspan='3'>"+me.loc.toomanyresults+"<\/td><\/tr>");break}lon=msg.locations[i].lon;lat=msg.locations[i].lat;zoom=msg.locations[i].zoomLevel;var dataLocation=lon+"---"+lat+"---"+zoom,row=me.templateResultsRow.clone(),name=msg.locations[i].name,municipality=msg.locations[i].village,type=msg.locations[i].type,cells=row.find("td"),xref=jQuery(cells[0]).find("a");row.attr("data-location",dataLocation);xref.attr("data-location",dataLocation);xref.attr("title",name);xref.append(name);xref.click(clickFunction);jQuery(cells[1]).attr("title",municipality).append(municipality);jQuery(cells[2]).attr("title",type).append(type);jQuery.browser.msie&&row.append(jQuery('<td style="width: 0px;"><\/td>'));tableBody.append(row)}me.conf&&me.conf.toolStyle||tableBody.find(":odd").addClass("odd");content.html(table);resultsContainer.show();me.conf&&me.conf.font&&me.changeFont(me.conf.font,content);me.conf&&me.conf.toolStyle&&(header.remove(),me.changeResultListStyle(me.conf.toolStyle,resultsContainer))}},_resultClicked:function(paramStr){var values=paramStr.split("---"),lon=values[0],lat=values[1],zoom=values[2];this._sandbox.request(this.getName(),this._sandbox.getRequestBuilder("MapMoveRequest")(lon,lat,zoom,!1))},_enableSearch:function(){this._searchInProgess=!1;jQuery("#search-string").removeClass("search-loading")},_hideSearch:function(){this.element.find("div.results").hide();this._sandbox.request(this.getName(),this._sandbox.getRequestBuilder("HideMapMarkerRequest")())},changeToolStyle:function(style,div){var me=this;if(div=div||me.element,style&&div){if(style.val===null){me.conf.toolStyle=null;div.removeClass("published-search-div").addClass("default-search-div");div.empty();me.template.children().clone().appendTo(div);me._inputField=div.find("input[type=text]");me._searchButton=div.find("input[type=button]");me._bindUIEvents();me.isInLayerToolsEditMode&&(me.isInLayerToolsEditMode=!1,me._setLayerToolsEditMode(!0));return}div.hasClass("default-search-div")&&(div.removeClass("default-search-div").addClass("published-search-div"),div.empty(),me.styledTemplate.children().clone().appendTo(div),me._inputField=div.find("input[type=text]"),me._searchButton=div.find("input[type=button]"),me._bindUIEvents(),me.isInLayerToolsEditMode&&(me.isInLayerToolsEditMode=!1,me._setLayerToolsEditMode(!0)));var resourcesPath=this.getMapModule().getImageUrl(),imgPath=resourcesPath+"/framework/bundle/mapmodule-plugin/plugin/search/images/",styleName=style.val,bgLeft=imgPath+"search-tool-"+styleName+"_01.png",bgMiddle=imgPath+"search-tool-"+styleName+"_02.png",bgRight=imgPath+"search-tool-"+styleName+"_03.png",left=div.find("div.search-left"),middle=div.find("div.search-middle"),right=div.find("div.search-right"),closeResults=middle.find("div.close-results"),inputField=div.find("input.search-input"),middleWidth=318-(style.widthLeft+style.widthRight),inputWidth=middleWidth-35;left.css({"background-image":'url("'+bgLeft+'")',width:style.widthLeft+"px"});middle.css({"background-image":'url("'+bgMiddle+'")',"background-repeat":"repeat-x",width:middleWidth+"px"});right.css({"background-image":'url("'+bgRight+'")',width:style.widthRight+"px"});inputField.css({width:inputWidth+"px"});closeResults.removeClass("icon-close icon-close-white");/dark/.test(styleName)?(closeResults.addClass("icon-close-white"),closeResults.css({"margin-top":"8px"}),inputField.css({color:"#ddd"})):(closeResults.addClass("icon-close"),closeResults.css({"margin-top":"10px"}),inputField.css({color:""}));me._setLayerToolsEditMode(me.getMapModule().isInLayerToolsEditMode())}},changeFont:function(fontId,div){var elements,classToAdd,testRegex;(div=div||this.element,div&&fontId)&&(elements=[],elements.push(div.find("table.search-results")),elements.push(div.find("input")),classToAdd="oskari-publisher-font-"+fontId,testRegex=/oskari-publisher-font-/,this.getMapModule().changeCssClasses(classToAdd,testRegex,elements))},changeResultListStyle:function(toolStyle,div){var cssClass="oskari-publisher-search-results-"+toolStyle.val;this.getMapModule().changeCssClasses(cssClass,/oskari-publisher-search-results-/,[div])}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.bundle.search.service.SearchService",function(searchUrl){this._searchUrl=searchUrl},{__qname:"Oskari.mapframework.bundle.search.service.SearchService",getQName:function(){return this.__qname},__name:"SearchService",getName:function(){return this.__name},doSearch:function(searchString,onSuccess,onError){var lang=Oskari.getLang(),epsg=Oskari.getSandbox().getMap().getSrsName();jQuery.ajax({dataType:"json",type:"POST",beforeSend:function(x){x&&x.overrideMimeType&&x.overrideMimeType("application/json")},url:this._searchUrl,data:{searchKey:searchString,Language:lang,epsg:epsg},error:onError,success:onSuccess})}},{protocol:["Oskari.mapframework.service.Service"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.LogoPlugin",function(conf){this.conf=conf;this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null;this.element=null},{templates:{main:jQuery("<div class='mapplugin logoplugin' data-clazz='Oskari.mapframework.bundle.mapmodule.plugin.LogoPlugin'><div class='terms'><a href='JavaScript:void(0);'><\/a><\/div><div class='data-sources'><\/div><\/div>"),dataSourcesDialog:jQuery("<div class='data-sources-dialog'><div class='layers'><h4><\/h4><\/div><div class='indicators'><h4><\/h4><\/div><\/div>")},__name:"LogoPlugin",getClazz:function(){return"Oskari.mapframework.bundle.mapmodule.plugin.LogoPlugin"},getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(mapModule){this.mapModule=mapModule;mapModule&&(this.pluginName=mapModule.getName()+this.__name)},hasUI:function(){return!0},init:function(){},register:function(){},unregister:function(){},startPlugin:function(sandbox){var me=this,p;me._sandbox=sandbox||me.getMapModule().getSandbox();me._map=me.getMapModule().getMap();me._sandbox.register(me);for(p in me.eventHandlers)me.eventHandlers.hasOwnProperty(p)&&me._sandbox.registerForEventByName(me,p);me._createUI()},stopPlugin:function(){var me=this;for(var p in me.eventHandlers)me.eventHandlers.hasOwnProperty(p)&&me._sandbox.unregisterFromEventByName(me,p);me._sandbox.unregister(me);me._map=null;me._sandbox=null;me.element&&(me.element.find("a").unbind("click"),me.element.remove(),me.element=undefined)},start:function(){},stop:function(){},eventHandlers:{"StatsGrid.IndicatorsEvent":function(event){this._addIndicatorsToDataSourcesDialog(event.getIndicators())},LayerToolsEditModeEvent:function(event){this.isInLayerToolsEditMode=!!event.isInMode();this.isInLayerToolsEditMode||this.setLocation(this.element.parents(".mapplugins").attr("data-location"))},MapSizeChangedEvent:function(){if(this.dataSourcesDialog){var target=jQuery("div.logoplugin div.data-sources");target&&this.dataSourcesDialog.moveTo(target,"top")}}},onEvent:function(event){var handler=this.eventHandlers[event.getName()];if(handler)return handler.apply(this,[event])},setLocation:function(location){var me=this;me.conf||(me.conf={});me.conf.location||(me.conf.location={});me.conf.location.classes=location;me.element&&me.getMapModule().setMapControlPlugin(me.element,location,1)},_createUI:function(){var me=this,sandbox=me._sandbox,pluginLoc=me.getMapModule().getLocalization("plugin",!0),myLoc=pluginLoc[me.__name],link,linkParams,mapUrl,termsUrl,containerClasses="bottom left",position=1,dataSources;me.conf&&(mapUrl=sandbox.getLocalizedProperty(me.conf.mapUrlPrefix),termsUrl=sandbox.getLocalizedProperty(me.conf.termsUrl));me.element||(me.element=me.templates.main.clone());me.conf&&(me.conf.location&&(containerClasses=me.conf.location.classes||containerClasses,position=me.conf.location.position||position),me.conf.font&&this.changeFont(me.conf.font));me.getMapModule().setMapControlPlugin(me.element,containerClasses,position);link=me.element.find("div.icon");mapUrl&&link.bind("click",function(){if(!me.isInLayerToolsEditMode)return linkParams=sandbox.generateMapLinkParameters(),mapUrl+=linkParams,window.open(mapUrl,"_blank"),!1});link=me.element.find("a");termsUrl?(link.append(myLoc.terms),link.bind("click",function(){if(!me.isInLayerToolsEditMode)return window.open(termsUrl,"_blank"),!1})):link.hide();dataSources=me.element.find("div.data-sources");me.conf&&me.conf.hideDataSourceLink?dataSources.remove():(dataSources.html(myLoc.dataSources),dataSources.click(function(e){me.isInLayerToolsEditMode||me.dataSourcesDialog!=null?me.dataSourcesDialog!=null&&(me.dataSourcesDialog.close(!0),me.dataSourcesDialog=null):(me._openDataSourcesDialog(e.target),me._requestDataSources())}));this.isInLayerToolsEditMode=me.getMapModule().isInLayerToolsEditMode()},changeFont:function(fontId,div){var classToAdd,testRegex;(div=div||this.element,div&&fontId)&&(classToAdd="oskari-publisher-font-"+fontId,testRegex=/oskari-publisher-font-/,this.getMapModule().changeCssClasses(classToAdd,testRegex,[div]))},_requestDataSources:function(){var me=this,reqBuilder=me._sandbox.getRequestBuilder("StatsGrid.IndicatorsRequest"),request;reqBuilder&&(request=reqBuilder(),me._sandbox.request(me,request))},_openDataSourcesDialog:function(target){var me=this,pluginLoc=me.getMapModule().getLocalization("plugin",!0)[me.__name],popupTitle=pluginLoc.dataSources,dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup"),closeButton=Oskari.clazz.create("Oskari.userinterface.component.Button"),content=me.templates.dataSourcesDialog.clone(),layersCont=content.find("div.layers"),layersHeaderLoc=pluginLoc.layersHeader,layers=me._sandbox.findAllSelectedMapLayers(),layersLen=layers.length,layer,i;if(closeButton.setTitle("OK"),closeButton.setHandler(function(){me.dataSourcesDialog=null;dialog.close(!0)}),layersLen===0)layersCont.remove();else for(layersCont.find("h4").html(layersHeaderLoc),i=0;i<layersLen;++i)layer=layers[i],layersCont.append("<div>"+layer.getName()+" - "+layer.getOrganizationName()+"<\/div>");this.dataSourcesDialog=dialog;dialog.show(popupTitle,content,[closeButton]);target=target||me.element.find("div.data-sources");dialog.moveTo(target,"top")},_addIndicatorsToDataSourcesDialog:function(indicators){var dialog=this.dataSourcesDialog;if(dialog){var pluginLoc=this.getMapModule().getLocalization("plugin",!0)[this.__name],content=dialog.getJqueryContent(),indicatorsCont=content.find("div.indicators"),indicatorsHeaderLoc=pluginLoc.indicatorsHeader,indicator,i,target;if(indicators=indicators||{},jQuery.isEmptyObject(indicators))indicatorsCont.remove();else{indicatorsCont.find("h4").html(indicatorsHeaderLoc);for(i in indicators)indicators.hasOwnProperty(i)&&(indicator=indicators[i],indicatorsCont.append("<div>"+indicator.title+" - "+indicator.organization+"<\/div>"))}target=target||this.element.find("div.data-sources");dialog.moveTo(target,"top")}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.DataSourcePlugin",function(){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null;this.template=null;this.element=null;this.sandbox=null;this.tool=null},{__name:"DataSourcePlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(mapModule){this.mapModule=mapModule;mapModule&&(this.pluginName=mapModule.getName()+this.__name)},hasUI:function(){return!0},init:function(){this.template=jQuery("<div class='oskari-datasource'><div class='link'><a href='JavaScript:void(0);'><\/a><\/div><\/div>");this.templateinfoIcon=jQuery('<div class="icon-info"><\/div>');this.templategroupTemplate=jQuery('<ul style="padding: 0 12px;"><\/ul>');this.templatecontent=jQuery("<div><\/div>");this.templateheading=jQuery("<b><\/b>")},register:function(){},unregister:function(){},startPlugin:function(sandbox){this._sandbox=sandbox;this._map=this.getMapModule().getMap();sandbox.register(this);for(var p in this.eventHandlers)this.eventHandlers.hasOwnProperty(p)&&sandbox.registerForEventByName(this,p);this._createUI()},stopPlugin:function(sandbox){for(var p in this.eventHandlers)this.eventHandlers.hasOwnProperty(p)&&sandbox.unregisterFromEventByName(this,p);sandbox.unregister(this);this._map=null;this._sandbox=null;this.element.find("a").unbind("click");this.element.remove();this.element=undefined},start:function(){},stop:function(){},eventHandlers:{},onEvent:function(event){return this.eventHandlers[event.getName()].apply(this,[event])},_layerListComparator:function(a,b){var nameA=a.getOrganizationName().toLowerCase(),nameB=b.getOrganizationName().toLowerCase(),ret=0;return nameA===nameB&&(nameA=a.getName().toLowerCase(),nameB=b.getName().toLowerCase()),nameA<nameB&&(ret=-1),nameA>nameB&&(ret=1),ret},_createUI:function(){var me=this,sandbox=me._sandbox,parentContainer=jQuery(this._map.div),pluginLoc,link;this.element||(this.element=this.template.clone());parentContainer.append(this.element);pluginLoc=this.getMapModule().getLocalization("plugin",!0);this.localization=pluginLoc[this.__name];link=this.element.find("a");link.append(this.localization.link);link.bind("click",function(){return me._openDialog(),!1})},_openDialog:function(){for(var me=this,sandbox=me._sandbox,dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup"),okBtn=dialog.createCloseButton(this.localization.button.close),infoIcon=this.templateinfoIcon.clone(),groupTemplate=this.templategroupTemplate.clone(),selectedLayers=this._getLayers(),group=null,content=this.templatecontent.clone(),currentGroup=null,layer,heading,layerItem,i=0;i<selectedLayers.length;++i)layer=selectedLayers[i],group!==layer.getOrganizationName()&&(group=layer.getOrganizationName(),heading=this.templateheading.clone(),group?heading.append(group):heading.append("N/A"),content.append(heading),currentGroup=groupTemplate.clone(),content.append(currentGroup)),layerItem=this._getLayerContainer(layer),layerItem&&currentGroup.append(layerItem);dialog.show(this.localization.popup.title,content,[okBtn]);dialog.moveTo(this.element.find("a"),"top")},_getLayers:function(){var me=this,selectedLayers=this._sandbox.findAllSelectedMapLayers();return selectedLayers.sort(function(a,b){return me._layerListComparator(a,b)}),selectedLayers},_getLayerContainer:function(layer){var me=this,infoIcon=this.templateinfoIcon.clone(),layerName=layer.getName(),layerItem,uuid,layerIcon;return layerName?(layerItem=jQuery("<li>"+layerName+"<\/li>"),uuid=layer.getMetadataIdentifier(),uuid&&(layerIcon=infoIcon.clone(),layerIcon.bind("click",function(){me._getMetadataInfoCallback(layer)}),layerItem.append(layerIcon)),layerItem):null},_getMetadataInfoCallback:function(layer){var me=this,sandbox=me._sandbox,uuid=layer.getMetadataIdentifier(),additionalUuids=[],additionalUuidsCheck={},subLayers,s,subUuid;if(additionalUuidsCheck[uuid]=!0,subLayers=layer.getSubLayers(),subLayers&&subLayers.length>0)for(s=0;s<subLayers.length;s++)subUuid=subLayers[s].getMetadataIdentifier(),subUuid&&subUuid!==""&&!additionalUuidsCheck[subUuid]&&(additionalUuidsCheck[subUuid]=!0,additionalUuids.push({uuid:subUuid}));sandbox.postRequestByName("catalogue.ShowMetadataRequest",[{uuid:uuid},additionalUuids])}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.IndexMapPlugin",function(config){var me=this;me.mapModule=null;me.pluginName=null;me._sandbox=null;me._map=null;me.conf=config;me.element=null;me._indexMap=null;me._indexMapUrl="/framework/bundle/mapmodule-plugin/plugin/indexmap/images/suomi25m_tm35fin.png";me.isInLayerToolsEditMode=!1},{templates:{main:jQuery('<div class="mapplugin indexmap" data-clazz="Oskari.mapframework.bundle.mapmodule.plugin.IndexMapPlugin"><\/div>'),toggle:jQuery('<div class="indexmapToggle"><\/div>')},__name:"IndexMapPlugin",getClazz:function(){return"Oskari.mapframework.bundle.mapmodule.plugin.IndexMapPlugin"},getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(mapModule){this.mapModule=mapModule;mapModule&&(this.pluginName=mapModule.getName()+this.__name)},hasUI:function(){return!0},init:function(){},setLocation:function(location){var me=this;me.conf||(me.conf={});me.conf.location||(me.conf.location={});me.conf.location.classes=location;me.element&&me.getMapModule().setMapControlPlugin(me.element,location,5)},_createUI:function(){var me=this,graphic=new OpenLayers.Layer.Image("Overview map image",me.getMapModule().getImageUrl()+me._indexMapUrl,new OpenLayers.Bounds(26783,6608595,852783,7787250),new OpenLayers.Size(120,173)),containerClasses="bottom right",position=5,controlOptions;me.element=me.templates.main.clone();controlOptions={div:me.element[0],mapOptions:{maxExtent:new OpenLayers.Bounds(26783,6608595,852783,7787250),units:"m",projection:me._map.getProjection(),numZoomLevels:1},layers:[graphic],size:new OpenLayers.Size(120,173),autoPan:!1,controls:[]};me.conf&&me.conf.location&&(containerClasses=me.conf.location.classes||containerClasses,position=me.conf.location.position||position);me.getMapModule().setMapControlPlugin(me.element,containerClasses,position);me._indexMap=new OpenLayers.Control.OverviewMap(controlOptions);this.isInLayerToolsEditMode=me.getMapModule().isInLayerToolsEditMode()},register:function(){},unregister:function(){},startPlugin:function(sandbox){var me=this,p,toggleButton;me._sandbox=sandbox||me.getMapModule().getSandbox();me._map=me.getMapModule().getMap();me._createUI();me._sandbox.register(me);for(p in me.eventHandlers)me.eventHandlers.hasOwnProperty(p)&&me._sandbox.registerForEventByName(me,p);me.getMapModule().addMapControl("overviewMap",me._indexMap);toggleButton=me.templates.toggle.clone();me._bindIcon(toggleButton);me.element.append(toggleButton)},_bindIcon:function(icon){var me=this;icon.bind("click",function(event){event.preventDefault();var miniMap=me.element.find(".olControlOverviewMapElement");miniMap.toggle()})},stopPlugin:function(){var me=this,p;me.getMapModule().removeMapControl("overviewMap");for(p in me.eventHandlers)me.eventHandlers.hasOwnProperty(p)&&me._sandbox.unregisterFromEventByName(me,p);me._sandbox.unregister(me);me._map=null;me._sandbox=null;me.element&&(me.element.remove(),me.element=undefined)},start:function(){},stop:function(){},eventHandlers:{AfterMapMoveEvent:function(){this._indexMap&&this._indexMap.update()},LayerToolsEditModeEvent:function(event){this._setLayerToolsEditMode(event.isInMode())}},_setLayerToolsEditMode:function(isInEditMode){var icon,miniMap;this.isInLayerToolsEditMode!==isInEditMode&&(this.isInLayerToolsEditMode=isInEditMode,icon=this.element.find(".indexmapToggle"),isInEditMode?(miniMap=this.element.find(".olControlOverviewMapElement"),miniMap.hide(),icon.unbind("click")):this._bindIcon(icon))},onEvent:function(event){return this.eventHandlers[event.getName()].apply(this,[event])}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.ScaleBarPlugin",function(conf){var me=this;me.conf=conf;me.element=null;me.mapModule=null;me.pluginName=null;me._sandbox=null;me._map=null;me._scalebar=null},{templates:{main:jQuery('<div class="mapplugin scalebar" data-clazz="Oskari.mapframework.bundle.mapmodule.plugin.ScaleBarPlugin"><\/div>')},__name:"ScaleBarPlugin",getClazz:function(){return"Oskari.mapframework.bundle.mapmodule.plugin.ScaleBarPlugin"},getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(mapModule){this.mapModule=mapModule;mapModule&&(this.pluginName=mapModule.getName()+this.__name)},hasUI:function(){return!0},init:function(){},register:function(){},unregister:function(){},setLocation:function(location){var me=this;me.conf||(me.conf={});me.conf.location.classes=location;me.element&&me.getMapModule().setMapControlPlugin(me.element,location,3)},startPlugin:function(sandbox){var me=this,p,containerClasses="bottom left",position=3;me._sandbox=sandbox||me.getMapModule().getSandbox();me._map=me.getMapModule().getMap();me.element=me.templates.main.clone();me._sandbox.register(me);for(p in me.eventHandlers)me.eventHandlers.hasOwnProperty(p)&&me._sandbox.registerForEventByName(me,p);me.conf&&me.conf.location&&(containerClasses=me.conf.location.classes||containerClasses,position=me.conf.location.position||position);me.getMapModule().setMapControlPlugin(me.element,containerClasses,position);me._scalebar=new OpenLayers.Control.ScaleLine({div:me.element[0]});me.getMapModule().addMapControl("scaleBar",me._scalebar)},stopPlugin:function(){var me=this,p;me.getMapModule().removeMapControl("scaleBar");for(p in me.eventHandlers)me.eventHandlers.hasOwnProperty(p)&&me._sandbox.unregisterFromEventByName(me,p);me._sandbox.unregister(me);me._map=null;me._sandbox=null;me.element&&(me.element.remove(),me.element=undefined)},start:function(){},stop:function(){},eventHandlers:{AfterMapMoveEvent:function(){this._scalebar&&this._scalebar.update()},LayerToolsEditModeEvent:function(event){this.isInLayerToolsEditMode=event.isInMode()}},onEvent:function(event){return this.eventHandlers[event.getName()].apply(this,[event])}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.PublisherToolbarPlugin",function(conf){var me=this;me.conf=conf||{};me.element=null;me.mapModule=null;me.pluginName=null;me._sandbox=null;me._map=null;me._scalebar=null;me.toolbarId=me.conf.toolbarId;me.toolbarContent="publishedToolbarContent";me.toolbarPopupContent="publishedToolbarPopupContent";me.toolbarContainer="publishedToolbarContainer";me.isInLayerToolsEditMode=!1},{templates:{main:jQuery("<div class=\"mapplugin tools\" data-clazz=\"Oskari.mapframework.bundle.mapmodule.plugin.PublisherToolbarPlugin\"><div class='icon'><\/div><div class='publishedToolbarContainer'><div class='tools-top-arrow'><\/div><\/div><\/div>"),container:jQuery("<div><\/div>"),publishedToolbarPopupContent:jQuery('<div class="publishedToolPopupContent"><h3><\/h3><div class="content"><\/div><div class="actions"><\/div><\/div>')},__name:"PublisherToolbarPlugin",getName:function(){return this.pluginName},getClazz:function(){return"Oskari.mapframework.bundle.mapmodule.plugin.PublisherToolbarPlugin"},getMapModule:function(){return this.mapModule},setMapModule:function(mapModule){this.mapModule=mapModule;mapModule&&(this.pluginName=mapModule.getName()+this.__name)},hasUI:function(){return!0},init:function(){var me=this,pluginLoc=me.getMapModule().getLocalization("plugin",!0),reqBuilder=me._sandbox.getRequestBuilder("ToolSelectionRequest"),gfiReqBuilder=me._sandbox.getRequestBuilder("MapModulePlugin.GetFeatureInfoActivationRequest");me.localization=pluginLoc[me.__name];me.template=jQuery(me.templates.main);me.buttonGroups=[{name:"history",buttons:{history_back:{toolbarid:me.toolbarId,iconCls:"tool-history-back-dark",tooltip:me.localization.history.back,prepend:!0,enabled:!1,sticky:!1,callback:function(){me._sandbox.request(me,reqBuilder("map_control_tool_prev"))}},history_forward:{toolbarid:me.toolbarId,iconCls:"tool-history-forward-dark",tooltip:me.localization.history.next,enabled:!1,sticky:!1,callback:function(){me._sandbox.request(me,reqBuilder("map_control_tool_next"))}}}},{name:"basictools",buttons:{measureline:{toolbarid:me.toolbarId,iconCls:"tool-measure-line-dark",tooltip:me.localization.measure.line,enabled:!1,sticky:!0,callback:function(){me._sandbox.request(me,gfiReqBuilder(!1));me._sandbox.request(me,reqBuilder("map_control_measure_tool"))}},measurearea:{toolbarid:me.toolbarId,iconCls:"tool-measure-area-dark",tooltip:me.localization.measure.area,enabled:!1,sticky:!0,callback:function(){me._sandbox.request(me,gfiReqBuilder(!1));me._sandbox.request(me,reqBuilder("map_control_measure_area_tool"))}}}}];this.requestHandlers={toolContainerRequestHandler:Oskari.clazz.create("Oskari.mapframework.bundle.toolbar.request.ToolContainerRequestHandler",me)}},register:function(){},unregister:function(){},setLocation:function(location){var me=this;me.conf||(me.conf={});me.conf.location||(me.conf.location={});me.conf.location.classes=location;me.element&&me.getMapModule().setMapControlPlugin(me.element,location,0)},startPlugin:function(sandbox){var me=this,p;me._sandbox=sandbox||me.getMapModule().getSandbox();me._map=me.getMapModule().getMap();me._sandbox.register(me);for(p in me.eventHandlers)me.eventHandlers.hasOwnProperty(p)&&me._sandbox.registerForEventByName(me,p);me._sandbox.addRequestHandler("Toolbar.ToolContainerRequest",this.requestHandlers.toolContainerRequestHandler);me._createUI()},stopPlugin:function(){var me=this;for(var p in me.eventHandlers)me.eventHandlers.hasOwnProperty(p)&&me._sandbox.unregisterFromEventByName(me,p);me.destroy();me._sandbox.unregister(me);me._map=null;me._sandbox=null;me.element&&(me.element.remove(),me.element=undefined)},start:function(){},stop:function(){},eventHandlers:{LayerToolsEditModeEvent:function(event){this._setLayerToolsEditMode(event.isInMode())}},_setLayerToolsEditMode:function(isInEditMode){this.isInLayerToolsEditMode!==isInEditMode&&(this.isInLayerToolsEditMode=isInEditMode,isInEditMode?(this.element.find("."+this.toolbarContainer).hide(),this.element.find("div.icon").unbind("click")):this._bindIcon())},onEvent:function(event){return this.eventHandlers[event.getName()].apply(this,[event])},show:function(isShown){var showHide=isShown?"show":"hide";this._sandbox.requestByName(this,"Toolbar.ToolbarRequest",[this.toolbarId,showHide])},destroy:function(){this._sandbox.requestByName(this,"Toolbar.ToolbarRequest",[this.toolbarId,"remove"])},changeName:function(title){this._sandbox.requestByName(this,"Toolbar.ToolbarRequest",[this.toolbarId,"changeName",title])},_createUI:function(){var me=this,toolscontainer,sandbox=me._sandbox,container,content,containers=[me.toolbarContent,me.toolbarPopupContent],i,ilen;if(!me.element)for(me.element=me.template.clone(),container=me.element.find("."+me.toolbarContainer),i=0,ilen=containers.length;i<ilen;i++)me.templates.container.clone().attr("class",containers[i]).appendTo(container);this.conf&&this.conf.toolStyle&&this.changeToolStyle(this.conf.toolStyle,me.element);me.insertToMap();toolscontainer=me.element.find("."+me.toolbarContainer);toolscontainer.hide();me._bindIcon();me.conf&&me.conf.font&&me.changeFont(me.conf.font,content)},_bindIcon:function(){var me=this,icon=me.element.find("div.icon"),toolscontainer=me.element.find("."+me.toolbarContainer);icon.bind("click",function(){toolscontainer.toggle()})},insertToMap:function(){var me=this,containerClasses="top left",position=0;me.conf&&me.conf.location&&(containerClasses=me.conf.location.classes||containerClasses,position=me.conf.location.position||position);me.getMapModule().setMapControlPlugin(me.element,containerClasses,position)},setToolbarContainer:function(){var me=this,sandbox=me._sandbox,builder=sandbox.getRequestBuilder("Toolbar.ToolbarRequest");me.toolbarId&&me.toolbarContent&&builder!==null&&builder!==undefined&&sandbox.requestByName(me,"Toolbar.ToolbarRequest",[me.toolbarId,"add",{title:me.localization.title,show:!1,toolbarContainer:me.element.find("."+me.toolbarContent),closeBoxCallback:function(){}}])},getToolOptions:function(){var me=this;return me.buttonGroups},changeToolStyle:function(style,div){var me=this,toolbarContent,key,buttonKey,i,confGroup,domGroup,domButton;if(div=div||me.element,div){var resourcesPath=me.getMapModule().getImageUrl(),imgPath=resourcesPath+"/framework/bundle/mapmodule-plugin/plugin/publishertoolbar/images/",styledImg=imgPath+"menu-"+style+".png",icon=div.find(".icon"),toolsContent=div.find("."+me.toolbarContent),toolsPopupContent=div.find("."+me.toolbarPopupContent),blackOrWhite=style?style.split("-")[1]:"dark";style===null?(icon.removeAttr("style"),toolsContent.removeClass("light","dark"),toolsPopupContent.removeClass("light","dark")):(icon.css({"background-image":'url("'+styledImg+'")'}),blackOrWhite==="dark"?(toolsContent.removeClass("light").addClass("dark"),toolsPopupContent.removeClass("light").addClass("dark")):(toolsContent.removeClass("dark").addClass("light"),toolsPopupContent.removeClass("dark").addClass("light")));toolbarContent=me.element.find("."+me.toolbarContent);for(key in me.buttonGroups)if(me.buttonGroups.hasOwnProperty(key)){confGroup=me.buttonGroups[key];domGroup=toolbarContent.find("div.toolrow[tbgroup="+me.toolbarId+"-"+confGroup.name+"]");for(buttonKey in confGroup.buttons)if(confGroup.buttons.hasOwnProperty(buttonKey)){var confButton=confGroup.buttons[buttonKey],iconClassParts=confButton.iconCls.split("-"),iconClass=iconClassParts[0],lastInd=iconClassParts.length-1;for(iconClassParts[lastInd]==="dark"||iconClassParts[lastInd]==="light"||(iconClassParts.push("dark"),lastInd++),i=1;i<iconClassParts.length;i++)iconClass+=i<lastInd?"-"+iconClassParts[i]:"-"+blackOrWhite;domButton=domGroup.find("."+confButton.iconCls).removeClass(confButton.iconCls).addClass(iconClass);confButton.iconCls=iconClass}}}},changeFont:function(fontId,div){var elements,classToAdd,testRegex;(div=div||this.element,div&&fontId)&&(elements=[],elements.push(div.find(".publishedToolbarPopupContent")),classToAdd="oskari-publisher-font-"+fontId,testRegex=/oskari-publisher-font-/,this.getMapModule().changeCssClasses(classToAdd,testRegex,elements))},setToolContent:function(data){var me=this,className=data.className||"",title=data.title||"",content=data.content||"",buttons=data.buttons||[],toolbarDiv=me.element.find("."+me.toolbarContent),contentDiv=me.element.find("."+className),appendContentDiv=!1,actionDiv,i;if(contentDiv.length===0&&(contentDiv=me.templates.publishedToolbarPopupContent.clone(),appendContentDiv=!0),contentDiv.find("h3").html(title),contentDiv.find(".content").html(content),className&&(contentDiv.removeClass(),contentDiv.addClass("publishedToolPopupContent "+className)),appendContentDiv&&buttons&&buttons.length>0)for(actionDiv=contentDiv.find(".actions"),actionDiv.empty(),i=0;i<buttons.length;i+=1)buttons[i].insertTo(actionDiv);else appendContentDiv&&contentDiv.bind("click",function(){me.resetToolContent()});return appendContentDiv&&(me.element.find("."+me.toolbarPopupContent).append(contentDiv),toolbarDiv.hide()),contentDiv},resetToolContent:function(data){var me=this,className=data.className||"publishedToolPopupContent",toolbarDiv=me.element.find("."+me.toolbarContent),contentDiv=me.element.find("."+className);contentDiv.remove();toolbarDiv.show()},getToolConfs:function(){var me=this,confs={},i,confGroup,j,confButton;for(i in me.buttonGroups)if(me.buttonGroups.hasOwnProperty(i)){confGroup=me.buttonGroups[i];confs[confGroup.name]={};for(j in confGroup.buttons)confGroup.buttons.hasOwnProperty(j)&&(confButton=confGroup.buttons[j],confs[confGroup.name][j]={iconCls:confButton.iconCls})}return confs}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.FullScreenPlugin",function(){var me=this;me.mapModule=null;me.pluginName=null;me._sandbox=null;me._map=null;me._fullscreen=null;me.templates={}},{__name:"FullScreenPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(mapModule){this.mapModule=mapModule;mapModule&&(this.pluginName=mapModule.getName()+this.__name)},hasUI:function(){return!0},init:function(){var me=this,fsimg=this.getMapModule().getImageUrl()+"/framework/bundle/mapmodule-plugin/plugin/fullscreen/images/";this.templates.main=jQuery('<div class="fullscreenDiv"><img class="fullscreenDivImg" src="'+fsimg+'hide-navigation.png"><\/img><\/div>')},register:function(){},unregister:function(){},startPlugin:function(sandbox){var me=this,p;me._sandbox=sandbox||me.getMapModule().getSandbox();this._map=this.getMapModule().getMap();me._sandbox.register(me);for(p in me.eventHandlers)me.eventHandlers.hasOwnProperty(p)&&me._sandbox.registerForEventByName(me,p);me.createUI()},stopPlugin:function(sandbox){var p;jQuery("div.fullscreenDiv").remove();for(p in this.eventHandlers)this.eventHandlers.hasOwnProperty(p)&&sandbox.unregisterFromEventByName(this,p);sandbox.unregister(this);this._map=null;this._sandbox=null},start:function(){},stop:function(){},setLocation:function(location){var me=this;me.conf||(me.conf={});me.conf.location=location;me.element&&(me.stopPlugin(),me.startPlugin())},createUI:function(){var me=this,fsimg=this.getMapModule().getImageUrl()+"/framework/bundle/mapmodule-plugin/plugin/fullscreen/images/",containerClasses="top left",position=1;me.element||(me.element=me.templates.main.clone());me.element.find(".fullscreenDivImg").bind("click",function(event){event.preventDefault();me._sandbox.postRequestByName("MapFull.MapWindowFullScreenRequest");jQuery(this).attr("src").match(/hide-navigation/)?jQuery(this).attr("src",fsimg+"show-navigation.png"):jQuery(this).attr("src",fsimg+"hide-navigation.png")});me.conf&&me.conf.location&&(containerClasses=me.conf.location.classes||containerClasses,position=me.conf.location.position||position);me.getMapModule().setMapControlPlugin(me.element,containerClasses,position)},eventHandlers:{},onEvent:function(event){return this.eventHandlers[event.getName()].apply(this,[event])}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.LayerSelectionPlugin",function(config){var me=this;me.mapModule=null;me.pluginName=null;me._sandbox=null;me._map=null;me.element=undefined;me.conf=config;me.initialSetup=!0;me.isInLayerToolsEditMode=!1;me.templates={}},{__name:"LayerSelectionPlugin",getClazz:function(){return"Oskari.mapframework.bundle.mapmodule.plugin.LayerSelectionPlugin"},getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(mapModule){this.mapModule=mapModule;mapModule&&(this.pluginName=mapModule.getName()+this.__name)},hasUI:function(){return!0},getMap:function(){return this._map},register:function(){},unregister:function(){},init:function(){var me=this;me.templates.main=jQuery('<div class=\'mapplugin layerselection\' data-clazz=\'Oskari.mapframework.bundle.mapmodule.plugin.LayerSelectionPlugin\'><div class="header"><div class="header-icon icon-arrow-white-right"><\/div><\/div><div class="content"><div class="layers"><\/div><div class="baselayers"><\/div><\/div><\/div>');me.templates.layer=jQuery("<div class='layer'><label><span><\/span><\/label><\/div>");me.templates.checkbox=jQuery("<input type='checkbox' />");me.templates.radiobutton=jQuery("<input type='radio' name='defaultBaselayer'/>");me.templates.baseLayerHeader=jQuery('<div class="baseLayerHeader"><\/div>');me.templates.headerArrow=jQuery('<div class="styled-header-arrow"><\/div>');me.templates.contentHeader=jQuery('<div class="content-header"><div class="content-header-title"><\/div><div class="content-close icon-close-white"><\/div><\/div>')},startPlugin:function(sandbox){var me=this,p;me._sandbox=sandbox||me.getMapModule().getSandbox();me._map=me.getMapModule().getMap();me._sandbox.register(me);for(p in me.eventHandlers)me.eventHandlers.hasOwnProperty(p)&&me._sandbox.registerForEventByName(me,p);me._createUI()},stopPlugin:function(sandbox){var me=this,p,sb=sandbox||this._sandbox;for(p in me.eventHandlers)me.eventHandlers.hasOwnProperty(p)&&sb&&sb.unregisterFromEventByName(me,p);sb.unregister(me);me.element&&(me.element.remove(),me.element=undefined,delete me.element)},start:function(){},stop:function(){},eventHandlers:{AfterMapLayerRemoveEvent:function(event){this.removeLayer(event.getMapLayer())},AfterMapLayerAddEvent:function(event){this.addLayer(event.getMapLayer());this._checkBaseLayers(event.getMapLayer())},MapLayerVisibilityChangedEvent:function(event){this.updateLayer(event.getMapLayer())},AfterMapMoveEvent:function(){this._checkBaseLayers()},AfterRearrangeSelectedMapLayerEvent:function(event){event._creator!==this.getName()&&this.sortLayers()},LayerToolsEditModeEvent:function(event){this._setLayerToolsEditMode(event.isInMode())}},_setLayerToolsEditMode:function(isInEditMode){if(this.isInLayerToolsEditMode!==isInEditMode){var header=this.element.find("div.header");this.isInLayerToolsEditMode=isInEditMode;isInEditMode?(this.closeSelection(),header.unbind("click")):this._bindHeader(header)}},onEvent:function(event){return this.eventHandlers[event.getName()].apply(this,[event])},preselectLayers:function(){},selectBaseLayer:function(layerId){var baseLayersDiv=this.element.find("div.content div.baselayers"),input;baseLayersDiv&&baseLayersDiv.length!==0&&(input=baseLayersDiv.find("input[value="+layerId+"]"),input.attr("checked","checked"),this._changedBaseLayer())},addLayer:function(layer){if(!this.layerRefs[layer.getId()]){var me=this,content=this.element.find("div.content"),layersDiv=content.find("div.layers"),div=this.templates.layer.clone(),input=this.templates.checkbox.clone();div.find("span").append(layer.getName());input.attr("value",layer.getId());layer.isVisible()?input.attr("checked",!0):input.attr("checked",!1);this._bindCheckbox(input,layer);div.find("span").before(input);this.layerRefs[layer.getId()]=div;layersDiv.append(div)}},updateLayer:function(layer){var div=this.layerRefs[layer.getId()],blnVisible=layer.isVisible(),input;input=div.find("input");blnVisible?input.is(":checked")||input.attr("checked","checked"):input.is(":checked")&&input.removeAttr("checked")},_bindCheckbox:function(input,layer){var me=this;input.change(function(){var checkbox=jQuery(this),isChecked=checkbox.is(":checked");isChecked?me._setLayerVisible(layer,!0):me._setLayerVisible(layer,!1)})},_setLayerVisible:function(layer,blnVisible){var sandbox=this._sandbox,visibilityRequestBuilder=sandbox.getRequestBuilder("MapModulePlugin.MapLayerVisibilityRequest"),request=visibilityRequestBuilder(layer.getId(),blnVisible);sandbox.request(this,request)},removeLayer:function(layer){var div=this.layerRefs[layer.getId()];div&&div.remove();delete this.layerRefs[layer.getId()]},addBaseLayer:function(layer){var me=this,div,input,baseLayersDiv;if(layer&&layer.getId&&me.element&&(div=me.layerRefs[layer.getId()],!div.parent().hasClass("baselayers"))){if(div.remove(),input=div.find("input"),input.remove(),input=me.templates.radiobutton.clone(),input.attr("value",layer.getId()),input.bind("change",function(){me._changedBaseLayer()}),div.find("span").before(input),baseLayersDiv=me.element.find("div.content div.baselayers"),baseLayersDiv.find("div.layer").length===0){var pluginLoc=me.getMapModule().getLocalization("plugin"),myLoc=pluginLoc[me.__name],header=me.templates.baseLayerHeader.clone();header.append(myLoc.chooseDefaultBaseLayer);baseLayersDiv.parent().find(".baseLayerHeader").remove();baseLayersDiv.before(header);input.attr("checked","checked")}baseLayersDiv.append(div);me.layerRefs[layer.getId()]=div;me._changedBaseLayer();me.sortLayers()}},removeBaseLayer:function(layer){var div=this.layerRefs[layer.getId()],input,isActive,layersDiv,baseLayersDiv,baseLayers,baselayerHeader,checked;div.remove();input=div.find("input");isActive=input.is(":checked");input.remove();input=this.templates.checkbox.clone();input.attr("value",layer.getId());isActive&&input.attr("checked","checked");this._bindCheckbox(input,layer);div.find("span").before(input);layersDiv=this.element.find("div.content div.layers");layersDiv.append(div);this._setLayerVisible(layer,!0);baseLayersDiv=this.element.find("div.content div.baselayers");baseLayers=baseLayersDiv.find("div.layer");baseLayers.length===0?(baselayerHeader=this.element.find("div.content div.baseLayerHeader"),baselayerHeader.remove()):(this.sortLayers(),checked=baseLayers.find("input:checked"),checked.length===0&&(jQuery(baseLayers.find("input").get(0)).attr("checked","checked"),this._changedBaseLayer()))},_changedBaseLayer:function(){for(var me=this,sandbox=me._sandbox,values=me.getBaseLayers(),layerId,layer,i=0;i<values.baseLayers.length;i+=1)layerId=values.baseLayers[i],layer=sandbox.findMapLayerFromSelectedMapLayers(layerId),layer!==null&&layer!==undefined&&me._setLayerVisible(layer,values.defaultBaseLayer+""==layerId+"");var builder=sandbox.getRequestBuilder("RearrangeSelectedMapLayerRequest"),request=builder(values.defaultBaseLayer,0);sandbox.request(me,request)},sortLayers:function(){for(var selectedLayers=this._sandbox.findAllSelectedMapLayers(),selectedBaseLayers=[],layersDiv=this.element.find("div.content div.layers"),layers=layersDiv.find("div.layer").detach(),baseLayersDiv=this.element.find("div.content div.baselayers"),baseLayers=baseLayersDiv.find("div.layer").detach(),layerId,inserted,insertLayer=function(index,element){var el=jQuery(element),input=el.find("input");if(input.val()===layerId)return layersDiv.append(el),inserted=!0,!1},insertBaseLayer=function(index,element){var el=jQuery(element),input=el.find("input");if(input.val()===layerId)return baseLayersDiv.append(el),inserted=!0,!1},sortBaseLayers=function(a,b){var ret=0;return a.getName()<b.getName()?ret=-1:a.getName()>b.getName()&&(ret=1),ret},i=selectedLayers.length-1;i>-1;i-=1)layerId=selectedLayers[i].getId()+"",inserted=!1,layers.each(insertLayer),inserted||selectedBaseLayers.push(selectedLayers[i]);for(selectedBaseLayers.sort(sortBaseLayers),i=0;i<selectedBaseLayers.length;i++)layerId=selectedBaseLayers[i].getId()+"",baseLayers.each(insertBaseLayer)},setupLayers:function(baseLayers){var me=this,layers,i;for(delete this.layerRefs,this.layerRefs={},layers=this._sandbox.findAllSelectedMapLayers(),i=layers.length-1;i>-1;i-=1)me.addLayer(layers[i]),baseLayers&&jQuery.inArray(layers[i].getId()+"",baseLayers)>-1&&me.addBaseLayer(layers[i])},openSelection:function(){var icon=this.element.find("div.header div.header-icon"),content;icon.removeClass("icon-arrow-white-right");icon.addClass("icon-arrow-white-down");content=this.element.find("div.content").show()},closeSelection:function(){var icon=this.element.find("div.header div.header-icon"),content;icon.removeClass("icon-arrow-white-down");icon.addClass("icon-arrow-white-right");content=this.element.find("div.content").hide()},getBaseLayers:function(){for(var inputs=this.element.find("div.content div.baselayers div.layer input"),layers=[],checkedLayer=null,input,i=0;i<inputs.length;i+=1)input=jQuery(inputs[i]),layers.push(input.val()),input.is(":checked")&&(checkedLayer=input.val());return{baseLayers:layers,defaultBaseLayer:checkedLayer}},setLocation:function(location){var me=this;me.conf||(me.conf={});me.conf.location||(me.conf.location={});me.conf.location.classes=location;me.element&&me.getMapModule().setMapControlPlugin(me.element,location,3)},_bindHeader:function(header){var me=this;header.bind("click",function(){var content=me.element.find("div.content");content.is(":hidden")?me.openSelection():me.closeSelection()})},_createUI:function(){var me=this,containerClasses="top left",position=3;me.element||(me.element=me.templates.main.clone());var pluginLoc=me.getMapModule().getLocalization("plugin",!0),myLoc=pluginLoc[me.__name],header=me.element.find("div.header");header.append(myLoc.title);me._bindHeader(header);me.closeSelection();me.setupLayers();me.conf&&me.conf.location&&(containerClasses=me.conf.location.classes||containerClasses,position=me.conf.location.position||position);me.getMapModule().setMapControlPlugin(me.element,containerClasses,position);me.conf&&me.conf.toolStyle&&me.changeToolStyle(me.conf.toolStyle,me.element);me.conf&&me.conf.font&&me.changeFont(me.conf.font,me.element);me.conf&&me.conf.colourScheme&&me.changeColourScheme(me.conf.colourScheme,me.element)},changeToolStyle:function(styleName,div){if(div=div||this.element,div){if(styleName===null){this.element&&(delete this.conf.toolStyle,this.stopPlugin(),this.startPlugin());return}var self=this,pluginLoc=this.getMapModule().getLocalization("plugin",!0),header=div.find("div.header"),headerArrow=this.templates.headerArrow.clone(),content=div.find("div.content"),contentHeader=this.templates.contentHeader.clone(),resourcesPath=this.getMapModule().getImageUrl(),imgPath=resourcesPath+"/framework/bundle/mapmodule-plugin/plugin/layers/images/",bgImg=imgPath+"map-layer-button-"+styleName+".png";header.empty();styleName!==null?(div.addClass("published-styled-layerselector"),content.addClass("published-styled-layerselector-content"),content.addClass("layerselection-styled-content"),header.addClass("published-styled-layerselector-header"),this.getMapModule().changeCssClasses("oskari-publisher-layers-"+styleName,/oskari-publisher-layers-/,[content]),this.getMapModule().changeCssClasses("oskari-publisher-layers-header-"+styleName,/oskari-publisher-layers-header-/,[contentHeader]),header.css({"background-image":'url("'+bgImg+'")'})):(div.removeClass("published-styled-layerselector"),content.removeClass("published-styled-layerselector-content"),content.removeClass("layerselection-styled-content"),header.removeClass("published-styled-layerselector-header"),this.getMapModule().changeCssClasses("",/oskari-publisher-layers-/,[content]),this.getMapModule().changeCssClasses("",/oskari-publisher-layers-header-/,[contentHeader]),header.css({"background-image":""}));content.find("div.content-header").remove();content.find("div.styled-header-arrow").remove();contentHeader.find("div.content-header-title").append(pluginLoc[this.__name].title);content.prepend(contentHeader);content.prepend(headerArrow);contentHeader.find("div.content-close").on("click",function(){self.closeSelection()});this.conf&&this.conf.colourScheme&&this.changeColourScheme(this.conf.colourScheme,this.element)}},changeColourScheme:function(colourScheme,div){if(div=div||this.element,div&&colourScheme){div.find("div.content-header").css({"background-color":colourScheme.bgColour});div.find("div.styled-header-arrow").css({"border-bottom-color":colourScheme.bgColour});var closeIcon=div.find("div.content-header div.content-close");closeIcon.removeClass("icon-close").removeClass("icon-close-white");closeIcon.addClass(colourScheme.iconCls);div.find("div.content-header div.content-header-title").css({color:colourScheme.titleColour})}},changeFont:function(fontId,div){if(div=div||this.element,div&&fontId){var classToAdd="oskari-publisher-font-"+fontId;this.getMapModule().changeCssClasses(classToAdd,/oskari-publisher-font-/,[div])}},_checkBaseLayers:function(layer){var i;if(this.conf&&this.conf.baseLayers)if(this.initialSetup&&(layer===null||layer===undefined)){for(this.initialSetup=!1,i=0;i<this.conf.baseLayers.length;i+=1)layer=this._sandbox.findMapLayerFromSelectedMapLayers(this.conf.baseLayers[i]),this.addBaseLayer(layer);this.conf.defaultBaseLayer&&this.selectBaseLayer(this.conf.defaultBaseLayer)}else if(layer!==null&&layer!==undefined){for(i=0;i<this.conf.baseLayers.length;i++)this.conf.baseLayers[i]==layer.getId()&&this.addBaseLayer(layer);this.conf.defaultBaseLayer==layer.getId()&&this.selectBaseLayer(this.conf.defaultBaseLayer)}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.BackgroundLayerSelectionPlugin",function(config){var i;if(this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.element=undefined,this.conf=config,this.error=!(this.conf&&this.conf.baseLayers&&this.conf.baseLayers.length),!this.error)for(i=0;i<this.conf.baseLayers.length;i+=1)typeof this.conf.baseLayers[i]=="number"&&(this.conf.baseLayers[i]=this.conf.baseLayers[i].toString());this.initialSetup=!0},{__name:"BackgroundLayerSelectionPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(mapModule){this.mapModule=mapModule;mapModule&&(this.pluginName=mapModule.getName()+this.__name)},hasUI:function(){return!0},getMap:function(){return this._map},register:function(){},unregister:function(){},init:function(){this.template=jQuery('<div class="backgroundLayerSelectionPlugin oskariui mapplugin"><div class="bg"><\/div><div class="content">    <ul><\/ul>    <div class="currentSelection"><\/div><\/div><\/div>');this.dropdownArrowTemplate=jQuery('<div class="header-icon icon-arrow-white-right"><\/div>');this.layerSelectionTemplate=jQuery("<li><\/li>");this.errorTemplate=jQuery('<div class="backgroundLayerSelectionPlugin oskariui mapplugin"><div class="bg"><\/div><div class="error">No baseLayers defined in configuration<\/div><\/div>')},startPlugin:function(sandbox){var p,me=this;me._sandbox=sandbox||me.getMapModule().getSandbox();me._map=me.getMapModule().getMap();me._sandbox.register(me);for(p in me.eventHandlers)me.eventHandlers.hasOwnProperty(p)&&me._sandbox.registerForEventByName(me,p);me._createUI()},stopPlugin:function(){var p,me=this;for(p in me.eventHandlers)me.eventHandlers.hasOwnProperty(p)&&me._sandbox.unregisterFromEventByName(me,p);me._sandbox.unregister(me);me.element&&(me.element.remove(),me.element=undefined,delete me.element)},start:function(){},stop:function(){},eventHandlers:{AfterRearrangeSelectedMapLayerEvent:function(){this._updateUISelection()},AfterMapLayerRemoveEvent:function(){this._createLayerSelectionElements()},AfterMapLayerAddEvent:function(){this._createLayerSelectionElements()},MapLayerEvent:function(){this._createLayerSelectionElements()},"userinterface.ExtensionUpdatedEvent":function(event){if(jQuery.inArray(event.getExtension().getName(),["Analyse","Publisher","StatsGrid","Printout"])>-1){var me=this,isShown=event.getViewState()!=="close";isShown?me.hiddenByMode||(me.hiddenByMode=!0,me.element.hide()):me.hiddenByMode&&(me.hiddenByMode=null,delete me.hiddenByMode,me.element.show())}}},onEvent:function(event){return this.eventHandlers[event.getName()].apply(this,[event])},_toggleSelection:function(){var icon=this.element.find("div.header-icon"),content=this.element.find("div.content");content.hasClass("open")?(icon.addClass("icon-arrow-white-right"),icon.removeClass("icon-arrow-white-down"),content.removeClass("open")):(icon.removeClass("icon-arrow-white-right"),icon.addClass("icon-arrow-white-down"),content.addClass("open"))},_getBottomLayer:function(){var allSelectedLayers=this._sandbox.findAllSelectedMapLayers();return allSelectedLayers&&allSelectedLayers.length?allSelectedLayers[0]:null},_updateSelection:function(newSelectionId){if(!this.error){var me=this,currentBottom=me._getBottomLayer(),currentBottomId="",currentSelection=me.element.find("div.currentSelection"),newSelection=me._sandbox.findMapLayerFromSelectedMapLayers(newSelectionId),isBaseLayer=!0;newSelectionId!==currentSelection.attr("data-layerId")&&(currentBottom&&(currentBottomId+=currentBottom.getId(),jQuery.inArray(currentBottomId,me.conf.baseLayers)>-1&&me._sandbox.postRequestByName("RemoveMapLayerRequest",[currentBottomId])),newSelection?me._sandbox.postRequestByName("RemoveMapLayerRequest",[newSelectionId]):(newSelection=me._sandbox.findMapLayerFromAllAvailable(newSelectionId),isBaseLayer=newSelection?newSelection.isBaseLayer():!0),me._sandbox.postRequestByName("AddMapLayerRequest",[newSelectionId,!1,isBaseLayer]),me._sandbox.postRequestByName("RearrangeSelectedMapLayerRequest",[newSelectionId,0]),me._toggleSelection())}},_updateUISelection:function(force){var me=this,newSelection=me._getBottomLayer(),newSelectionId="",newSelectionName="",listElement,currentSelection=me.element.find("div.currentSelection"),icon;(newSelection&&(newSelectionId+=newSelection.getId(),newSelectionName=newSelection.getName()),force||newSelectionId!==currentSelection.attr("data-layerId"))&&(me.element.find("li").each(function(){listElement=jQuery(this);listElement.toggleClass("selected",listElement.attr("data-layerId")===newSelectionId)}),currentSelection.empty(),currentSelection.attr("data-layerId",""),currentSelection.attr("title",""),jQuery.inArray(newSelectionId,me.conf.baseLayers)>-1&&(currentSelection.attr("data-layerId",newSelectionId),currentSelection.attr("title",newSelectionName),currentSelection.html(newSelectionName)),icon=me.dropdownArrowTemplate.clone(),me.element.find("div.content").hasClass("open")&&icon.removeClass("icon-arrow-white-right").addClass("icon-arrow-white-down"),currentSelection.prepend(icon),me.conf&&(me.conf.font&&me.changeFont(me.conf.font,me.element),me.conf.colorScheme&&me.changeColorScheme(me.conf.colorScheme,me.element)))},_createLayerSelectionElements:function(){var tooltip;if(!this.error){var me=this,layer,layerIds=me.conf.baseLayers,list=me.element.find("ul"),listItem,i,selectionUpdateHandler=function(){me._updateSelection(jQuery(this).attr("data-layerId"))};for(list.empty(),i=0;i<layerIds.length;i+=1)layer=me._sandbox.findMapLayerFromAllAvailable(layerIds[i]),layer&&(tooltip=layer.getDescription(),(typeof tooltip=="undefined"||tooltip===null)&&(tooltip=layer.getName()),listItem=me.layerSelectionTemplate.clone(),listItem.attr("data-layerId",layerIds[i]).attr("title",tooltip).html(layer.getName()),list.append(listItem),listItem.bind("click",selectionUpdateHandler));me._updateUISelection(!0)}},_createUI:function(){var me=this,containerClasses="bottom center",position=0;me.element||(me.error?me.element=me.errorTemplate.clone():(me.element=me.template.clone(),me.element.find("div.currentSelection").bind("click",function(){me._toggleSelection()}),me.element.find("div.content").toggleClass("dropdown",me.conf&&me.conf.showAsDropdown),me._createLayerSelectionElements()));me.conf&&me.conf.location&&(containerClasses=me.conf.location.classes||containerClasses,position=me.conf.location.position||position);me.getMapModule().setMapControlPlugin(me.element,containerClasses,position)},setLocation:function(location){var me=this;me.conf||(me.conf={});me.conf.location=location;me.element&&(me.stopPlugin(),me.startPlugin())},changeColorScheme:function(colorScheme,div){(div=div||this.element,div&&colorScheme)&&(div.find("li").css({"background-color":colorScheme.buttonBackgroundColor,color:colorScheme.buttonColor}).filter(".selected").css({"background-color":colorScheme.buttonSelectedBackgroundColor,color:colorScheme.buttonSelectedColor}),div.find(".dropdown li").css({"background-color":colorScheme.buttonSelectedBackgroundColor,color:colorScheme.buttonSelectedColor,"border-color":colorScheme.buttonBorderColor}),div.find("div.currentSelection").css({"background-color":colorScheme.buttonBackgroundColor,color:colorScheme.buttonColor}))},changeFont:function(fontId,div){if(div=div||this.element,div&&fontId){var classToAdd="oskari-publisher-font-"+fontId;this.getMapModule().changeCssClasses(classToAdd,/oskari-publisher-font-/,[div])}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.LayersPlugin",function(){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null;this._supportedFormats={};this._visibilityPollingInterval=1500;this._visibilityCheckOrder=0;this._previousTimer=null},{__name:"LayersPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(mapModule){this.mapModule=mapModule;this.pluginName=mapModule.getName()+this.__name},hasUI:function(){return!1},getMap:function(){return this._map},register:function(){},unregister:function(){},init:function(sandbox){this.requestHandlers={layerVisibilityHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MapLayerVisibilityRequestHandler",sandbox,this),layerContentHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MapMoveByLayerContentRequestHandler",sandbox,this)}},startPlugin:function(sandbox){this._sandbox=sandbox;this._map=this.getMapModule().getMap();sandbox.register(this);for(var p in this.eventHandlers)this.eventHandlers.hasOwnProperty(p)&&sandbox.registerForEventByName(this,p);sandbox.addRequestHandler("MapModulePlugin.MapLayerVisibilityRequest",this.requestHandlers.layerVisibilityHandler);sandbox.addRequestHandler("MapModulePlugin.MapMoveByLayerContentRequest",this.requestHandlers.layerContentHandler)},stopPlugin:function(sandbox){sandbox.removeRequestHandler("MapModulePlugin.MapLayerVisibilityRequest",this.requestHandlers.layerVisibilityHandler);sandbox.removeRequestHandler("MapModulePlugin.MapMoveByLayerContentRequest",this.requestHandlers.layerContentHandler);for(var p in this.eventHandlers)this.eventHandlers.hasOwnProperty(p)&&sandbox.unregisterFromEventByName(this,p);sandbox.unregister(this);this._map=null;this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{AfterRearrangeSelectedMapLayerEvent:function(event){this._afterRearrangeSelectedMapLayerEvent(event)},MapMoveStartEvent:function(){this._visibilityCheckOrder++;this._previousTimer&&(clearTimeout(this._previousTimer),this._previousTimer=null)},AfterMapMoveEvent:function(){this._scheduleVisiblityCheck()},AfterMapLayerAddEvent:function(event){this._parseGeometryForLayer(event.getMapLayer());this._scheduleVisiblityCheck()}},_scheduleVisiblityCheck:function(){var me=this;this._previousTimer&&(clearTimeout(this._previousTimer),this._previousTimer=null);this._visibilityCheckOrder++;this._previousTimer=setTimeout(function(){me._checkLayersVisibility(me._visibilityCheckOrder)},this._visibilityPollingInterval)},onEvent:function(event){return this.eventHandlers[event.getName()].apply(this,[event])},preselectLayers:function(){},_parseGeometryForLayer:function(layer){var layerWKTGeom,wkt,features,geometries,i;if(layer.getGeometry&&layer.getGeometry().length===0){if(layerWKTGeom=layer.getGeometryWKT(),!layerWKTGeom)return;if(wkt=new OpenLayers.Format.WKT,features=wkt.read(layerWKTGeom),features){for(features.constructor!=Array&&(features=[features]),geometries=[],i=0;i<features.length;++i)geometries.push(features[i].geometry);layer.setGeometry(geometries)}}},_checkLayersVisibility:function(orderNumber){if(orderNumber===this._visibilityCheckOrder){for(var layers=this._sandbox.findAllSelectedMapLayers(),layer,i=0;i<layers.length;++i)layer=layers[i],layer.isVisible()&&this.notifyLayerVisibilityChanged(layer);this._visibilityCheckScheduled=!1}},_isInScale:function(layer){var scale=this._sandbox.getMap().getScale();return layer.isInScale(scale)},isInGeometry:function(layer){var geometries=layer.getGeometry(),viewBounds,i,bounds;if(!geometries||geometries.length===0)return!0;for(viewBounds=this.getMap().getExtent(),i=0;i<geometries.length;++i)if((bounds=geometries[i].getBounds(),bounds)&&bounds.intersectsBounds(viewBounds))return!0;return!1},notifyLayerVisibilityChanged:function(layer){var scaleOk=layer.isVisible(),geometryMatch=layer.isVisible(),event;layer.isVisible()&&(scaleOk=this._isInScale(layer),geometryMatch=this.isInGeometry(layer));var map=this.getMap(),map=this.getMap(),mapLayers=this.getMapModule().getOLMapLayers(layer.getId()),mapLayer=mapLayers.length?mapLayers[0]:null;scaleOk&&geometryMatch&&layer.isVisible()?mapLayer&&!mapLayer.getVisibility()&&(mapLayer.setVisibility(!0),mapLayer.display(!0)):mapLayer&&mapLayer.getVisibility()&&(mapLayer.setVisibility(!1),mapLayer.display(!1));event=this._sandbox.getEventBuilder("MapLayerVisibilityChangedEvent")(layer,scaleOk,geometryMatch);this._sandbox.notifyAll(event)},_afterRearrangeSelectedMapLayerEvent:function(){var layers=this._sandbox.findAllSelectedMapLayers(),layerIndex=0,opLayersLength=this._map.layers.length,changeLayer=this._map.getLayersByName("Markers"),i,ilen,j,jlen,olLayers;for(changeLayer.length>0&&(this._map.setLayerIndex(changeLayer[0],opLayersLength),opLayersLength--),i=0,ilen=layers.length;i<ilen;i++)if(layers[i]!==null&&layers[i]!==undefined)for(olLayers=this.getMapModule().getOLMapLayers(layers[i].getId()),j=0,jlen=olLayers.length;j<jlen;j++)this._map.setLayerIndex(olLayers[j],layerIndex),layerIndex++}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapLayerVisibilityRequest",function(mapLayerId,visible){this._creator=null;this._mapLayerId=mapLayerId;this._visible=visible},{__name:"MapModulePlugin.MapLayerVisibilityRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId},getVisible:function(){return this._visible}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapLayerVisibilityRequestHandler",function(sandbox,layersPlugin){this.sandbox=sandbox;this.layersPlugin=layersPlugin},{handleRequest:function(core,request){var layerId=request.getMapLayerId(),layer=this.sandbox.findMapLayerFromSelectedMapLayers(layerId);if(layer&&layer.isVisible()!==request.getVisible()){layer.setVisible(request.getVisible());for(var map=this.layersPlugin.getMap(),module=this.layersPlugin.getMapModule(),layers=module.getOLMapLayers(layer.getId()),i=0;i<layers.length;i++)layers[i].setVisibility(layer.isVisible()),layers[i].display(layer.isVisible());this.layersPlugin.notifyLayerVisibilityChanged(layer)}}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapMoveByLayerContentRequest",function(mapLayerId){this._creator=null;this._mapLayerId=mapLayerId},{__name:"MapModulePlugin.MapMoveByLayerContentRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapMoveByLayerContentRequestHandler",function(sandbox,layersPlugin){this.sandbox=sandbox;this.layersPlugin=layersPlugin},{handleRequest:function(core,request){var layerId=request.getMapLayerId(),layer=this.sandbox.findMapLayerFromSelectedMapLayers(layerId),newZoom,containsGeometry,center;layer&&(newZoom=this.layersPlugin.getMapModule().getClosestZoomLevel(layer.getMinScale(),layer.getMaxScale()),this.layersPlugin.getMapModule().setZoomLevel(newZoom,!0),layer.getGeometry().length>0&&(containsGeometry=this.layersPlugin.isInGeometry(layer),containsGeometry||(center=layer.getGeometry()[0].getCentroid(),this.layersPlugin.getMapModule().moveMapToLanLot(new OpenLayers.LonLat(center.x,center.y)))),this.layersPlugin.getMapModule().notifyMoveEnd(),this.layersPlugin._checkLayersVisibility(this.layersPlugin._visibilityCheckOrder))}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.event.MapLayerVisibilityChangedEvent",function(mapLayer,inScale,geometryMatch){this._mapLayer=mapLayer;this._inScale=inScale==!0;this._geomMatch=geometryMatch!=!1},{__name:"MapLayerVisibilityChangedEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer},isInScale:function(){return this._inScale},isGeometryMatch:function(){return this._geomMatch}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.mapmodule.WmsLayerPlugin",function(){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null;this._supportedFormats={}},{__name:"WmsLayerPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(mapModule){this.mapModule=mapModule;this.pluginName=mapModule.getName()+this.__name},hasUI:function(){return!1},register:function(){this.getMapModule().setLayerPlugin("wmslayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("wmslayer",null)},init:function(){},startPlugin:function(sandbox){this._sandbox=sandbox;this._map=this.getMapModule().getMap();sandbox.register(this);for(var p in this.eventHandlers)this.eventHandlers.hasOwnProperty(p)&&sandbox.registerForEventByName(this,p)},stopPlugin:function(sandbox){for(var p in this.eventHandlers)this.eventHandlers.hasOwnProperty(p)&&sandbox.unregisterFromEventByName(this,p);sandbox.unregister(this);this._map=null;this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{MapLayerEvent:function(event){var op=event.getOperation(),layer=this._sandbox.findMapLayerFromSelectedMapLayers(event.getLayerId());op==="update"&&layer&&layer.isLayerOfType("WMS")&&this._updateLayer(layer)},AfterMapLayerRemoveEvent:function(event){this._afterMapLayerRemoveEvent(event)},AfterChangeMapLayerOpacityEvent:function(event){this._afterChangeMapLayerOpacityEvent(event)},AfterChangeMapLayerStyleEvent:function(event){this._afterChangeMapLayerStyleEvent(event)}},onEvent:function(event){return this.eventHandlers[event.getName()].apply(this,[event])},preselectLayers:function(layers){for(var sandbox=this._sandbox,layer,layerId,i=0;i<layers.length;i++)layer=layers[i],layerId=layer.getId(),layer.isLayerOfType("WMS")&&(sandbox.printDebug("preselecting "+layerId),this.addMapLayerToMap(layer,!0,layer.isBaseLayer()))},addMapLayerToMap:function(layer,keepLayerOnTop,isBaseMap){var layers,layerIdPrefix,i,ilen,layerResolutions,key,openLayer;if(layer.isLayerOfType("WMS"))for(layers=[],layerIdPrefix="layer_",(layer.isGroupLayer()||layer.isBaseLayer()||isBaseMap==!0)&&layer.getSubLayers().length>0?(layers=layer.getSubLayers(),layerIdPrefix="basemap_"):layers.push(layer),i=0,ilen=layers.length;i<ilen;i++){var _layer=layers[i],defaultParams={layers:_layer.getWmsName(),transparent:!0,id:_layer.getId(),styles:_layer.getCurrentStyle().getName(),format:"image/png"},defaultOptions={layerId:_layer.getWmsName(),isBaseLayer:!1,displayInLayerSwitcher:!1,visibility:_layer.isInScale(this.getMapModule().getMap().getScale()),buffer:0},layerParams=_layer.getParams(),layerOptions=_layer.getOptions();(_layer.getMaxScale()||_layer.getMinScale())&&(layerResolutions=this.getMapModule().calculateLayerResolutions(_layer.getMaxScale(),_layer.getMinScale()),defaultOptions.resolutions=layerResolutions);for(key in layerParams)layerParams.hasOwnProperty(key)&&(defaultParams[key]=layerParams[key]);for(key in layerOptions)layerOptions.hasOwnProperty(key)&&(defaultOptions[key]=layerOptions[key]);openLayer=new OpenLayers.Layer.WMS(layerIdPrefix+_layer.getId(),_layer.getWmsUrls(),defaultParams,defaultOptions);openLayer.opacity=_layer.getOpacity()/100;this._map.addLayer(openLayer);this._sandbox.printDebug("#!#! CREATED OPENLAYER.LAYER.WMS for "+_layer.getId());keepLayerOnTop?this._map.setLayerIndex(openLayer,this._map.layers.length):this._map.setLayerIndex(openLayer,0)}},_afterMapLayerRemoveEvent:function(event){var layer=event.getMapLayer();this._removeMapLayerFromMap(layer)},_removeMapLayerFromMap:function(layer){var remLayer,baseLayerId,i,subtmp;if(layer.isLayerOfType("WMS"))if(layer.isBaseLayer()||layer.isGroupLayer())if(baseLayerId="",layer.getSubLayers().length>0)for(i=0;i<layer.getSubLayers().length;i++)subtmp=layer.getSubLayers()[i],remLayer=this._map.getLayersByName("basemap_"+subtmp.getId()),remLayer&&remLayer[0]&&remLayer[0].destroy&&remLayer[0].destroy();else remLayer=this._map.getLayersByName("layer_"+layer.getId()),remLayer[0].destroy();else remLayer=this._map.getLayersByName("layer_"+layer.getId()),remLayer[0].destroy()},getOLMapLayers:function(layer){var baseLayerId,olLayers,i,tmpLayers;if(!layer.isLayerOfType("WMS"))return null;if(layer.isBaseLayer()||layer.isGroupLayer()){if(baseLayerId="",layer.getSubLayers().length>0){for(olLayers=[],i=0;i<layer.getSubLayers().length;i++)tmpLayers=this._map.getLayersByName("basemap_"+layer.getSubLayers()[i].getId()),olLayers.push(tmpLayers[0]);return olLayers}return this._map.getLayersByName("layer_"+layer.getId())}return this._map.getLayersByName("layer_"+layer.getId())},_afterChangeMapLayerOpacityEvent:function(event){var layer=event.getMapLayer(),mapLayer,bl;if(layer.isLayerOfType("WMS"))if(layer.isBaseLayer()||layer.isGroupLayer())if(layer.getSubLayers().length>0)for(bl=0;bl<layer.getSubLayers().length;bl++)mapLayer=this._map.getLayersByName("basemap_"+layer.getSubLayers()[bl].getId()),mapLayer[0].setOpacity(layer.getOpacity()/100);else mapLayer=this._map.getLayersByName("layer_"+layer.getId()),mapLayer[0]!==null&&mapLayer[0]!==undefined&&mapLayer[0].setOpacity(layer.getOpacity()/100);else this._sandbox.printDebug("Setting Layer Opacity for "+layer.getId()+" to "+layer.getOpacity()),mapLayer=this._map.getLayersByName("layer_"+layer.getId()),mapLayer[0]!==null&&mapLayer[0]!==undefined&&mapLayer[0].setOpacity(layer.getOpacity()/100)},_afterChangeMapLayerStyleEvent:function(event){var layer,styledLayer;event.getMapLayer().isLayerOfType("WMS")&&(layer=event.getMapLayer(),layer.isBaseLayer()||(styledLayer=this._map.getLayersByName("layer_"+layer.getId()),styledLayer!==null&&styledLayer!==undefined&&styledLayer[0].mergeNewParams({styles:layer.getCurrentStyle().getName()})))},_updateLayer:function(layer){for(var oLayers=this.getOLMapLayers(layer),subs=layer.getSubLayers(),layerList=subs.length?subs:[layer],llen=layerList.length,scale=this.getMapModule().getMap().getScale(),newRes,isInScale,i=0;i<llen;++i)newRes=this._calculateResolutions(layerList[i]),isInScale=layerList[i].isInScale(scale),newRes&&isInScale&&oLayers[i]&&(oLayers[i].addOptions({resolutions:newRes}),oLayers[i].setVisibility(isInScale),oLayers[i].redraw(!0))},_calculateResolutions:function(layer){var minScale=layer.getMinScale(),maxScale=layer.getMaxScale();if(minScale||maxScale)return this.getMapModule().calculateLayerResolutions(maxScale,minScale)}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.mapmodule.VectorLayerPlugin",function(){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null;this._supportedFormats={};this._sldFormat=new OpenLayers.Format.SLD({multipleSymbolizers:!1,namedLayersAsArray:!0})},{__name:"VectorLayerPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(mapModule){this.mapModule=mapModule;this.pluginName=mapModule.getName()+this.__name},hasUI:function(){return!1},register:function(){this.getMapModule().setLayerPlugin("vectorlayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("vectorlayer",null)},init:function(){},startPlugin:function(sandbox){this._sandbox=sandbox;this._map=this.getMapModule().getMap();this.registerVectorFormats();sandbox.register(this);for(var p in this.eventHandlers)sandbox.registerForEventByName(this,p)},stopPlugin:function(sandbox){for(var p in this.eventHandlers)this.eventHandlers.hasOwnProperty(p)&&sandbox.unregisterFromEventByName(this,p);sandbox.unregister(this);this._map=null;this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{AfterMapLayerRemoveEvent:function(event){this.afterMapLayerRemoveEvent(event)},FeaturesAvailableEvent:function(event){this.handleFeaturesAvailableEvent(event)},AfterChangeMapLayerOpacityEvent:function(event){this._afterChangeMapLayerOpacityEvent(event)}},onEvent:function(event){return this.eventHandlers[event.getName()].apply(this,[event])},preselectLayers:function(layers){for(var sandbox=this._sandbox,layer,layerId,i=0,ilen=layers.length;i<ilen;i++)(layer=layers[i],layerId=layer.getId(),layer.isLayerOfType("VECTOR"))&&(sandbox.printDebug("preselecting "+layerId),this.addMapLayerToMap(layer,!0,layer.isBaseLayer()))},registerVectorFormat:function(mimeType,formatImpl){this._supportedFormats[mimeType]=formatImpl},registerVectorFormats:function(){this.registerVectorFormat("application/json",new OpenLayers.Format.GeoJSON({}));this.registerVectorFormat("application/nlsfi-x-openlayers-feature",function(){this.read=function(data){return data}})},addMapLayerToMap:function(layer,keepLayerOnTop){var openLayer;if(layer.isLayerOfType("VECTOR")){var styleMap=new OpenLayers.StyleMap,layerOpts={styleMap:styleMap},sldSpec=layer.getStyledLayerDescriptor();if(sldSpec){this._sandbox.printDebug(sldSpec);var styleInfo=this._sldFormat.read(sldSpec),styles=styleInfo.namedLayers[0].userStyles,style=styles[0];styleMap.styles["default"]=style}openLayer=new OpenLayers.Layer.Vector("layer_"+layer.getId(),layerOpts);openLayer.opacity=layer.getOpacity()/100;this._map.addLayer(openLayer);this._sandbox.printDebug("#!#! CREATED VECTOR / OPENLAYER.LAYER.VECTOR for "+layer.getId());keepLayerOnTop?this._map.setLayerIndex(openLayer,this._map.layers.length):this._map.setLayerIndex(openLayer,0)}},afterMapLayerRemoveEvent:function(event){var layer=event.getMapLayer();this.removeMapLayerFromMap(layer)},_afterChangeMapLayerOpacityEvent:function(event){var layer=event.getMapLayer(),mapLayer;layer.isLayerOfType("VECTOR")&&(this._sandbox.printDebug("Setting Layer Opacity for "+layer.getId()+" to "+layer.getOpacity()),mapLayer=this._map.getLayersByName("layer_"+layer.getId()),mapLayer[0]!==null&&mapLayer[0]!==undefined&&mapLayer[0].setOpacity(layer.getOpacity()/100))},removeMapLayerFromMap:function(layer){if(layer.isLayerOfType("VECTOR")){var remLayer=this._map.getLayersByName("layer_"+layer.getId());remLayer[0].destroy()}},getOLMapLayers:function(layer){if(layer.isLayerOfType("VECTOR"))return this._map.getLayersByName("layer_"+layer.getId())},handleFeaturesAvailableEvent:function(event){var layer=event.getMapLayer(),mimeType=event.getMimeType(),features=event.getFeatures(),op=event.getOp(),mapLayer=this._map.getLayersByName("layer_"+layer.getId())[0],format,fc;mapLayer&&(op&&op=="replace"&&mapLayer.removeFeatures(mapLayer.features),format=this._supportedFormats[mimeType],format)&&(fc=format.read(features),mapLayer.addFeatures(fc))}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.GeoLocationPlugin",function(){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null;this._locationIsSet=!1},{__name:"GeoLocationPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(mapModule){this.mapModule=mapModule;mapModule&&(this.pluginName=mapModule.getName()+this.__name)},hasUI:function(){return!1},init:function(){},register:function(){},unregister:function(){},startPlugin:function(sandbox){this._sandbox=sandbox;this._map=this.getMapModule().getMap();sandbox.register(this);this._setupLocation()},stopPlugin:function(sandbox){sandbox.unregister(this);this._map=null;this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{},onEvent:function(event){return this.eventHandlers[event.getName()].apply(this,[event])},hasSetLocation:function(){return this._locationIsSet},_setupLocation:function(){var me=this,callback=function(lon,lat){var lonlat=me.getMapModule().transformCoordinates(new OpenLayers.LonLat(lon,lat),"EPSG:4326");me.getMapModule().centerMap(lonlat,6);me._locationIsSet=!0},lat,lon;navigator.geolocation?navigator.geolocation.getCurrentPosition(function(position){var lat=position.coords.latitude,lon=position.coords.longitude;callback(lon,lat)},function(){},{maximumAge:36e5,timeout:6e3}):typeof window.geoip_latitude=="function"&&typeof window.geoip_longitude=="function"&&(lat=geoip_latitude(),lon=geoip_longitude(),callback(lon,lat))}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin",function(config){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null;this.drawControls=null;this.drawLayer=null;this.editMode=!1;this.currentDrawMode=null;this.prefix="DrawPlugin.";config&&config.id&&(this.prefix=config.id+".");config&&config.graphicFill&&(this.graphicFill=config.graphicFill);this.multipart=config&&config.multipart===!0},{__name:"DrawPlugin",getName:function(){return this.prefix+this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(mapModule){this.mapModule=mapModule;this._map=mapModule.getMap();this.pluginName=mapModule.getName()+this.__name},startDrawing:function(params){if(params.isModify)this.modifyControls.select.select(this.drawLayer.features[0]);else if(this.drawLayer.destroyFeatures(),params.geometry){this.editMode=!0;var features=[new OpenLayers.Feature.Vector(params.geometry)];this.drawLayer.addFeatures(features);this.modifyControls.select.select(this.drawLayer.features[0])}else this.editMode=!1,this.toggleControl(params.drawMode)},stopDrawing:function(){this.toggleControl();this.drawLayer&&this.drawLayer.destroyFeatures()},forceFinishDraw:function(){try{this.finishedDrawing(!0)}catch(error){this.stopDrawing();var event=this._sandbox.getEventBuilder("DrawPlugin.SelectedDrawingEvent")();this._sandbox.notifyAll(event)}},finishedDrawing:function(isForced){var activeControls,i,components,lastIndex,event;if(!this.multipart||isForced){for(activeControls=this._getActiveDrawControls(),i=0;i<activeControls.length;i++)if(typeof this.drawControls[activeControls[i]].handler.finishGeometry==typeof Function){switch(activeControls[i]){case"line":if(this.drawControls.line.handler.line.geometry.components.length<2)continue;break;case"area":if(components=this.drawControls.area.handler.polygon.geometry.components,components[components.length-1].components.length<3)continue}this.drawControls[activeControls[i]].handler.finishGeometry()}this.toggleControl()}this.editMode||(lastIndex=this.drawLayer.features.length-1,this.modifyControls.select.select(this.drawLayer.features[lastIndex]));!this.multipart||isForced?(event=this._sandbox.getEventBuilder("DrawPlugin.FinishedDrawingEvent")(this.getDrawing(),this.editMode),this._sandbox.notifyAll(event)):(event=this._sandbox.getEventBuilder("DrawPlugin.AddedFeatureEvent")(this.getDrawing(),this.currentDrawMode),this._sandbox.notifyAll(event))},toggleControl:function(drawMode){this.currentDrawMode=drawMode;var key,control;for(key in this.drawControls)this.drawControls.hasOwnProperty(key)&&(control=this.drawControls[key],drawMode===key?control.activate():control.deactivate())},init:function(sandbox){var me=this,key;if(this.requestHandlers={startDrawingHandler:Oskari.clazz.create("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StartDrawingRequestPluginHandler",sandbox,me),stopDrawingHandler:Oskari.clazz.create("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StopDrawingRequestPluginHandler",sandbox,me),getGeometryHandler:Oskari.clazz.create("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.GetGeometryRequestPluginHandler",sandbox,me)},this.drawLayer=new OpenLayers.Layer.Vector(this.prefix+"DrawLayer",{eventListeners:{featuresadded:function(){me.finishedDrawing()},vertexmodified:function(){me._sendActiveGeometry(me.getDrawing())}}}),this.drawControls={point:new OpenLayers.Control.DrawFeature(me.drawLayer,OpenLayers.Handler.Point),line:new OpenLayers.Control.DrawFeature(me.drawLayer,OpenLayers.Handler.Path,{callbacks:{modify:function(geom,feature){me._sendActiveGeometry(me.getActiveDrawing(feature.geometry),"line")}}}),area:new OpenLayers.Control.DrawFeature(me.drawLayer,OpenLayers.Handler.Polygon,{handlerOptions:{holeModifier:"altKey"},callbacks:{modify:function(geom,feature){me._sendActiveGeometry(me.getActiveDrawing(feature.geometry),"area")}}}),box:new OpenLayers.Control.DrawFeature(me.drawLayer,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:4,irregular:!0}})},this.graphicFill!==null&&this.graphicFill!==undefined){var str=this.graphicFill,format=new OpenLayers.Format.SLD,obj=format.read(str),p;if(obj&&obj.namedLayers)for(p in obj.namedLayers)if(obj.namedLayers.hasOwnProperty(p)){this.drawLayer.styleMap.styles["default"]=obj.namedLayers[p].userStyles[0];this.drawLayer.redraw();break}}this.modifyControls={modify:new OpenLayers.Control.ModifyFeature(me.drawLayer,{standalone:!0})};this.modifyControls.select=new OpenLayers.Control.SelectFeature(me.drawLayer,{onBeforeSelect:this.modifyControls.modify.beforeSelectFeature,onSelect:this.modifyControls.modify.selectFeature,onUnselect:this.modifyControls.modify.unselectFeature,scope:this.modifyControls.modify});this._map.addLayers([me.drawLayer]);for(key in this.drawControls)this.drawControls.hasOwnProperty(key)&&this._map.addControl(this.drawControls[key]);for(key in this.modifyControls)this.modifyControls.hasOwnProperty(key)&&this._map.addControl(this.modifyControls[key]);this.modifyControls.modify.activate()},getDrawing:function(){var featClass,drawing,components,i;if(this.drawLayer.features.length===0)return null;if(featClass=this.drawLayer.features[0].geometry.CLASS_NAME,featClass==="OpenLayers.Geometry.MultiPoint"||featClass==="OpenLayers.Geometry.MultiLineString"||featClass==="OpenLayers.Geometry.MultiPolygon")return this.drawLayer.features[0].geometry;for(drawing=null,components=[],i=0;i<this.drawLayer.features.length;i++)components.push(this.drawLayer.features[i].geometry);switch(featClass){case"OpenLayers.Geometry.Point":drawing=new OpenLayers.Geometry.MultiPoint(components);break;case"OpenLayers.Geometry.LineString":drawing=new OpenLayers.Geometry.MultiLineString(components);break;case"OpenLayers.Geometry.Polygon":drawing=new OpenLayers.Geometry.MultiPolygon(components)}return drawing},getActiveDrawing:function(geometry){var prevGeom=this.getDrawing(),composedGeom;return prevGeom!==null&&prevGeom!==undefined?(composedGeom=prevGeom.clone(),composedGeom.addComponent(geometry),composedGeom):geometry},_getActiveDrawControls:function(){var activeDrawControls=[];for(var drawControl in this.drawControls)this.drawControls.hasOwnProperty(drawControl)&&this.drawControls[drawControl].active&&activeDrawControls.push(drawControl);return activeDrawControls},_sendActiveGeometry:function(geometry,drawMode){var eventBuilder=this._sandbox.getEventBuilder("DrawPlugin.ActiveDrawingEvent"),event,featClass;if(drawMode===null||drawMode===undefined){featClass=geometry.CLASS_NAME;switch(featClass){case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.MultiLineString":drawMode="line";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.MultiPolygon":drawMode="area";break;default:return}}eventBuilder&&(event=eventBuilder(geometry,drawMode),this._sandbox.notifyAll(event))},register:function(){},unregister:function(){},startPlugin:function(sandbox){this._sandbox=sandbox;sandbox.register(this);sandbox.addRequestHandler("DrawPlugin.StartDrawingRequest",this.requestHandlers.startDrawingHandler);sandbox.addRequestHandler("DrawPlugin.StopDrawingRequest",this.requestHandlers.stopDrawingHandler);sandbox.addRequestHandler("DrawPlugin.GetGeometryRequest",this.requestHandlers.getGeometryHandler)},stopPlugin:function(sandbox){sandbox.removeRequestHandler("DrawPlugin.StartDrawingRequest",this.requestHandlers.startDrawingHandler);sandbox.removeRequestHandler("DrawPlugin.StopDrawingRequest",this.requestHandlers.stopDrawingHandler);sandbox.removeRequestHandler("DrawPlugin.GetGeometryRequest",this.requestHandlers.getGeometryHandler);sandbox.unregister(this);this._map=null;this._sandbox=null},start:function(){},stop:function(){}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.event.AddedFeatureEvent",function(geometry,drawingMode){this._drawing=geometry;this._drawingMode=drawingMode},{__name:"DrawPlugin.AddedFeatureEvent",getName:function(){return this.__name},getDrawing:function(){return this._drawing},getDrawingMode:function(){return this._drawingMode}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.event.FinishedDrawingEvent",function(geometry,blnEdit){this._drawing=geometry;this._modification=blnEdit==!0},{__name:"DrawPlugin.FinishedDrawingEvent",getName:function(){return this.__name},getDrawing:function(){return this._drawing},isModification:function(){return this._modification}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.event.SelectedDrawingEvent",function(pPlace,dblClick){this._creator=null;this._place=pPlace;this._dblClick=dblClick},{__name:"DrawPlugin.SelectedDrawingEvent",getName:function(){return this.__name},getPlace:function(){return this._place},isDblClick:function(){return this._dblClick}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.event.ActiveDrawingEvent",function(geometry,mode){this._drawing=geometry;this._drawMode=mode},{__name:"DrawPlugin.ActiveDrawingEvent",getName:function(){return this.__name},getDrawing:function(){return this._drawing},getDrawMode:function(){return this._drawMode}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.GetGeometryRequest",function(callbackMethod){this._creator=null;this._callbackMethod=callbackMethod},{__name:"DrawPlugin.GetGeometryRequest",getName:function(){return this.__name},getCallBack:function(){return this._callbackMethod}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.GetGeometryRequestPluginHandler",function(sandbox,drawPlugin){this.sandbox=sandbox;this.drawPlugin=drawPlugin},{handleRequest:function(core,request){var callBack=request.getCallBack(),drawing;this.sandbox.printDebug("[Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.GetGeometryRequestPluginHandler] geometry requested");drawing=this.drawPlugin.getDrawing();callBack(drawing.geometry)}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StartDrawingRequest",function(config){if(config.geometry)this._geometry=config.geometry;else if(config.continueCurrent)this._continueCurrent=config.continueCurrent;else{if(!this.drawModes[config.drawMode])throw"Unknown draw mode '"+config.drawMode+"'";this._drawMode=config.drawMode}},{__name:"DrawPlugin.StartDrawingRequest",getName:function(){return this.__name},isModify:function(){return this._continueCurrent?!0:!1},drawModes:{point:"point",line:"line",area:"area",cut:"cut",box:"box"},getDrawMode:function(){return this._drawMode},getGeometry:function(){return this._geometry}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StartDrawingRequestPluginHandler",function(sandbox,drawPlugin){this.sandbox=sandbox;this.drawPlugin=drawPlugin},{handleRequest:function(core,request){var drawMode=request.getDrawMode();this.sandbox.printDebug("[Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StartDrawingRequestPluginHandler] Start Drawing: "+drawMode);this.drawPlugin.startDrawing({drawMode:request.getDrawMode(),geometry:request.getGeometry(),isModify:request.isModify(),style:""})}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StopDrawingRequest",function(isCancel){this._creator=null;this._isCancel=isCancel==!0},{__name:"DrawPlugin.StopDrawingRequest",getName:function(){return this.__name},isCancel:function(){return this._isCancel===!0}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StopDrawingRequestPluginHandler",function(sandbox,drawPlugin){this.sandbox=sandbox;this.drawPlugin=drawPlugin},{handleRequest:function(core,request){this.sandbox.printDebug("[Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StopDrawingRequestPluginHandler] Stop drawing");request.isCancel()?this.drawPlugin.stopDrawing():this.drawPlugin.forceFinishDraw()}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ToolContainerRequest",function(op,data){this._op=op;this._data=data||{}},{__name:"Toolbar.ToolContainerRequest",getName:function(){return this.__name},getOp:function(){return this._op},getData:function(){return this._data}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ToolContainerRequestHandler",function(toolbarPlugin){this._toolbar=toolbarPlugin},{handleRequest:function(core,request){var sandbox=core.getSandbox();request.getOp()=="set"?this._toolbar.setToolContent(request.getData()):request.getOp()=="reset"&&this._toolbar.resetToolContent(request.getData())}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.RealtimePlugin",function(config){this.minRefreshRate=1e3;this.maxRefreshRate=Infinity;this.ignoredLayerTypes=[];this.mapModule=undefined;this.pluginName=undefined;this.sandbox=undefined;this.intervals=undefined;this.config={minRefreshRate:this.minRefreshRate,maxRefreshRate:this.maxRefreshRate,ignoredLayerTypes:this.ignoredLayerTypes};config=config||{};for(var opt in config)config.hasOwnProperty(opt)&&(this.config[opt]=config[opt])},{__name:"RealtimePlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(mapModule){this.mapModule=mapModule;mapModule&&(this.pluginName=mapModule.getName()+this.__name)},hasUI:function(){return!1},register:function(){},unregister:function(){},init:function(){},start:function(){},stop:function(){},startPlugin:function(sandbox){this.sandbox=sandbox;this.intervals={};sandbox.register(this);for(var p in this.eventHandlers)this.eventHandlers.hasOwnProperty(p)&&sandbox.registerForEventByName(this,p)},stopPlugin:function(sandbox){for(var p in this.eventHandlers)this.eventHandlers.hasOwnProperty(p)&&sandbox.unregisterFromEventByName(this,p);sandbox.unregister(this);this.sandbox=undefined;this.intervals=undefined},eventHandlers:{AfterMapLayerAddEvent:function(event){var layer=event.getMapLayer();layer.isRealtime()&&this._isNotIgnored(layer)&&this._setInterval(layer)},AfterMapLayerRemoveEvent:function(event){var layer=event.getMapLayer();layer.isRealtime()&&this._isNotIgnored(layer)&&this._clearInterval(layer)},MapLayerEvent:function(event){var op=event.getOperation(),layer=this.sandbox.findMapLayerFromSelectedMapLayers(event.getLayerId());op==="update"&&layer&&layer.isRealtime()&&this._isNotIgnored(layer)&&this._resetInterval(layer)},MapLayerVisibilityChangedEvent:function(event){var layer=event.getMapLayer(),isVisible=layer.isVisible(),inScale=event.isInScale(),inViewPort=event.isGeometryMatch(),clearOnly=!isVisible||!inScale||!inViewPort;layer.isRealtime()&&this._isNotIgnored(layer)&&this._resetInterval(layer,clearOnly)},AfterMapMoveEvent:function(){this._resetEveryInterval()}},onEvent:function(event){var handler=this.eventHandlers[event.getName()];if(handler)return handler.apply(this,[event])},_getInterval:function(layer){return this.intervals[""+layer.getId()]},_setInterval:function(layer){this._getInterval(layer)==undefined&&(this.intervals[""+layer.getId()]=this._createInterval(layer))},_createInterval:function(layer){var me=this,sandbox=me.sandbox,refreshRate=this._getRefreshRate(layer.getRefreshRate()),reqB=sandbox.getRequestBuilder("MapModulePlugin.MapLayerUpdateRequest"),req=reqB?reqB(layer.getId(),!0):undefined;return setInterval(function(){req&&sandbox.request(me,req)},refreshRate)},_clearInterval:function(layer){var interval=this._getInterval(layer);interval!=undefined&&(clearInterval(interval),delete this.intervals[""+layer.getId()])},_resetInterval:function(layer,clearOnly){this._clearInterval(layer);clearOnly||this._setInterval(layer)},_resetEveryInterval:function(){var me=this,sandbox=me.sandbox;_.chain(this.intervals).keys().map(function(layerId){return sandbox.findMapLayerFromSelectedMapLayers(layerId)}).filter(function(layer){return layer&&layer.isRealtime()}).each(function(layer){me._resetInterval(layer)})},_getRefreshRate:function(rate){var minRate=this.config.minRefreshRate||this.minRefreshRate,maxRate=this.config.maxRefreshRate||this.maxRefreshRate;return _.min([_.max([rate*1e3,minRate]),maxRate])},_isNotIgnored:function(layer){return!_.any(this.config.ignoredLayerTypes,function(type){return layer.isLayerOfType(type)})}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.ToolSelectionRequest",function(toolId){this._toolId=toolId},{tools:{navigate:"map_control_navigate_tool",zoom:"map_control_zoom_tool",previous:"map_control_tool_prev",next:"map_control_tool_prev",measure:"map_control_measure_tool",measure_area:"map_control_measure_area_tool",select:"map_control_select_tool",draw_area:"map_control_draw_area_tool"},__name:"ToolSelectionRequest",getName:function(){return this.__name},getToolId:function(){return this._toolId},setToolId:function(toolId){this._toolId=toolId},getNamespace:function(){return this._toolId.indexOf(".")==-1?"":this._toolId.substring(0,this._toolId.lastIndexOf("."))},getToolName:function(){return this._toolId.indexOf(".")==-1?this._toolId:this._toolId.substring(this._toolId.lastIndexOf("."))}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.mapmodule.ToolSelectionHandler",function(sandbox,controlsPlugin){this.sandbox=sandbox;this.controlsPlugin=controlsPlugin},{handleRequest:function(core,request){var toolId=request.getToolId(),namespace=request.getNamespace(),toolName=request.getToolName(),stateHandler,slp;toolName==="map_control_tool_prev"?(stateHandler=this.sandbox.findRegisteredModuleInstance("StateHandler"),stateHandler&&stateHandler.historyMovePrevious()):toolName==="map_control_tool_next"?(stateHandler=this.sandbox.findRegisteredModuleInstance("StateHandler"),stateHandler&&stateHandler.historyMoveNext()):toolName==="map_control_select_tool"?(slp=this.sandbox.findRegisteredModuleInstance("SketchLayerPlugin"),slp&&slp.clearBbox()):toolName==="map_control_zoom_tool"&&this.controlsPlugin._zoomBoxTool?this.controlsPlugin._zoomBoxTool.activate():toolName==="map_control_measure_tool"&&this.controlsPlugin._measureControls?this.controlsPlugin._measureControls.line.activate():toolName==="map_control_measure_area_tool"&&this.controlsPlugin._measureControls&&this.controlsPlugin._measureControls.area.activate()}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapLayerUpdateRequest",function(layerId,forced,optParameters){this._layerId=layerId;this._forced=forced==!0;this._parameters=optParameters},{__name:"MapModulePlugin.MapLayerUpdateRequest",getName:function(){return this.__name},getLayerId:function(){return this._layerId},isForced:function(){return this._forced},getParameters:function(){return this._parameters},setParameters:function(p){this._parameters=p}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapLayerUpdateRequestHandler",function(sandbox,mapModule){this.sandbox=sandbox;this.mapModule=mapModule},{handleRequest:function(core,request){var layerId=request.getLayerId(),forced=request.isForced(),params=request.getParameters(),sandbox=this.sandbox,layer=sandbox.findMapLayerFromSelectedMapLayers(layerId),i,olLayerList,count;if(layer)if(params&&layer.isLayerOfType("WMS")){if(olLayerList=this.mapModule.getOLMapLayers(layerId),count=0,olLayerList)for(count=olLayerList.length,i=0;i<olLayerList.length;++i)olLayerList[i].mergeNewParams(params);this.sandbox.printDebug("[MapLayerUpdateRequestHandler] WMS layer / merge new params: "+layerId+", found "+count)}else{if(olLayerList=this.mapModule.getOLMapLayers(layerId),count=0,olLayerList)for(count=olLayerList.length,i=0;i<olLayerList.length;++i)olLayerList[i].redraw(forced);this.sandbox.printDebug("[MapLayerUpdateRequestHandler] Layer / update layer "+layerId+", found "+count)}}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapMoveRequestHandler",function(sandbox,mapModule){this.sandbox=sandbox;this.mapModule=mapModule},{handleRequest:function(core,request){var longitude=request.getCenterX(),latitude=request.getCenterY(),marker=request.getMarker(),zoom=request.getZoom(),srsName=request.getSrsName(),lonlat=new OpenLayers.LonLat(longitude,latitude),isProjectionDefined;if(srsName&&this.mapModule.getProjection()!==srsName){if(isProjectionDefined=Proj4js.defs[srsName],!isProjectionDefined)throw"SrsName not supported!";lonlat=this.mapModule.transformCoordinates(lonlat,srsName)}this.mapModule.moveMapToLanLot(lonlat,zoom,!1);(zoom||zoom===0)&&(zoom.CLASS_NAME==="OpenLayers.Bounds"?this.mapModule.zoomToExtent(zoom):this.mapModule.zoomTo(zoom));marker&&this.mapModule._drawMarker();this.sandbox.printDebug("[MapMoveRequestHandler] map moved")}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.event.MapClickedEvent",function(lonlat,mouseX,mouseY){this._lonlat=lonlat;this._mouseX=mouseX;this._mouseY=mouseY},{__name:"MapClickedEvent",getName:function(){return this.__name},getLonLat:function(){return this._lonlat},getMouseX:function(){return this._mouseX},getMouseY:function(){return this._mouseY}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.event.EscPressedEvent",function(){},{__name:"EscPressedEvent",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.event.GetInfoResultEvent",function(data){this._data=data},{__name:"GetInfoResultEvent",getName:function(){return this.__name},getData:function(){return this._data}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.event.MapSizeChangedEvent",function(width,height){this._width=width;this._height=height},{__name:"MapSizeChangedEvent",getName:function(){return this.__name},getWidth:function(){return this._width},getHeight:function(){return this._height}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.Portti2Zoombar",function(config){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null;this.templates={};this.element=null;this.__parent=null;this._slider=null;this._zoombar_messages={};this._suppressEvents=!1;this.conf=config},{__name:"Portti2Zoombar",getClazz:function(){return"Oskari.mapframework.bundle.mapmodule.plugin.Portti2Zoombar"},getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},hasUI:function(){return!0},setMapModule:function(mapModule){this.mapModule=mapModule;mapModule&&(this._map=mapModule.getMap(),this.pluginName=mapModule.getName()+this.__name)},init:function(){var me=this;this.templates.main=jQuery('<div class="oskariui mapplugin pzbDiv zoombar"><div class="pzbDiv-plus"><\/div><input type=\'hidden\' /><div class="slider"><\/div><div class="pzbDiv-minus"><\/div><\/div>')},register:function(){},unregister:function(){},startPlugin:function(sandbox){var p;this._sandbox=sandbox||this.getMapModule().getSandbox();this._sandbox.register(this);for(p in this.eventHandlers)this.eventHandlers.hasOwnProperty(p)&&this._sandbox.registerForEventByName(this,p);this._draw();this._setZoombarValue(this._map.getZoom())},stopPlugin:function(){var me=this,p;me.element&&(me.element.remove(),me._slider.remove(),delete me.element);for(p in me.eventHandlers)me.eventHandlers.hasOwnProperty(p)&&me._sandbox.unregisterFromEventByName(me,p);me._sandbox.unregister(me);me._sandbox=null},_draw:function(){var me=this,plus,minus;me.__parent||(me.__parent=me._map.div);me.element||(me.element=me.templates.main.clone());var inputId="pzb-input-"+me.getName(),sliderId="pzb-slider-"+me.getName(),sliderEl=me.element.find("div.slider"),containerClasses="top right",position=2;me.element.find("input").attr("id",inputId);sliderEl.attr("id",sliderId);me.element.mousedown(function(event){me.isInLayerToolsEditMode||event.stopPropagation()});me.conf&&me.conf.location&&(containerClasses=me.conf.location.classes||containerClasses,position=me.conf.location.position||position);me.getMapModule().setMapControlPlugin(me.element,containerClasses.replace("with-panbuttons",""),position);sliderEl=me.element.find("div.slider");sliderEl.css("height",me._map.getNumZoomLevels()*11+"px");me._slider=sliderEl.slider({orientation:"vertical",range:"min",min:0,max:me._map.getNumZoomLevels()-1,value:me._map.getZoom(),slide:function(event,ui){me.getMapModule().zoomTo(ui.value)}});plus=me.element.find(".pzbDiv-plus");plus.bind("click",function(){me.isInLayerToolsEditMode||me._slider.slider("value")<me._map.getNumZoomLevels()&&me.getMapModule().zoomTo(me._slider.slider("value")+1)});minus=me.element.find(".pzbDiv-minus");minus.bind("click",function(){me.isInLayerToolsEditMode||me._slider.slider("value")>0&&me.getMapModule().zoomTo(me._slider.slider("value")-1)});me.conf&&me.conf.toolStyle&&me.changeToolStyle(me.conf.toolStyle,me.element);me._setLayerToolsEditMode(me.getMapModule().isInLayerToolsEditMode())},_setZoombarValue:function(value){var me=this;me._slider&&(this._suppressEvents=!0,me._slider.slider("value",value),this._suppressEvents=!1)},setLocation:function(location){var me=this;me.conf||(me.conf={});me.conf.location.classes=location;me.element&&me.getMapModule().setMapControlPlugin(me.element,location,2)},eventHandlers:{AfterMapMoveEvent:function(event){if(this._sandbox){var me=this;me._setZoombarValue(event.getZoom())}},LayerToolsEditModeEvent:function(event){this._sandbox&&this._setLayerToolsEditMode(event.isInMode())}},_setLayerToolsEditMode:function(isInEditMode){this.isInLayerToolsEditMode=isInEditMode;this._slider&&this.isInLayerToolsEditMode?this._slider.slider("option","disabled",!0):this._slider&&this._slider.slider("option","disabled",!1)},onEvent:function(event){return this.eventHandlers[event.getName()].apply(this,[event])},start:function(){},stop:function(){},changeToolStyle:function(style,div){if(div=div||this.element,style&&div){var resourcesPath=this.getMapModule().getImageUrl(),imgUrl=resourcesPath+"/framework/bundle/mapmodule-plugin/plugin/portti2zoombar/images/",styleName=style.val,zoombarImg=imgUrl+"zoombar-"+styleName+".png",zoombarCursorImg=imgUrl+"zoombar-cursor-"+styleName+".png",zoombarMinusImg=imgUrl+"zoombar_minus-"+styleName+".png",zoombarPlusImg=imgUrl+"zoombar_plus-"+styleName+".png",bar=div.find(".ui-slider-vertical"),cursor=div.find(".ui-slider-handle"),plus=div.find(".pzbDiv-plus"),minus=div.find(".pzbDiv-minus"),slider=div.find("div.slider"),isRounded=styleName&&styleName.match(/^rounded/),sliderHeight=this._map.getNumZoomLevels()*style.heightCenter;style.val===null?(bar.css({"background-image":"",width:"","margin-left":""}),cursor.css({"background-image":"",width:"",height:"","margin-left":""}),plus.css({"background-image":"",width:"",height:""}),minus.css({"background-image":"",width:"",height:""}),slider.css({height:sliderHeight+"px"})):(bar.css({"background-image":'url("'+zoombarImg+'")',width:style.widthCenter,"margin-left":"0"}),cursor.css({"background-image":'url("'+zoombarCursorImg+'")',width:style.widthCursor,height:style.heightCursor,"margin-left":isRounded?"2px":"0"}),plus.css({"background-image":'url("'+zoombarPlusImg+'")',width:style.widthPlus,height:style.heightPlus}),minus.css({"background-image":'url("'+zoombarMinusImg+'")',width:style.widthMinus,height:style.heightMinus}),slider.css({height:sliderHeight+"px"}))}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.PanButtons",function(config){var me=this;me.mapModule=null;me.pluginName=null;me._sandbox=null;me._map=null;me.templates={};me.element=null;me.__parent=null;me.conf=config},{__name:"PanButtons",getClazz:function(){return"Oskari.mapframework.bundle.mapmodule.plugin.PanButtons"},getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},hasUI:function(){return!0},setMapModule:function(mapModule){this.mapModule=mapModule;mapModule&&(this._map=mapModule.getMap(),this.pluginName=mapModule.getName()+this.__name)},init:function(){var me=this,ppid=(new Date).getTime().toString();this.templates.main=jQuery('<div class="mapplugin panbuttonDiv panbuttons" data-clazz="Oskari.mapframework.bundle.mapmodule.plugin.PanButtons"><div>  <img class="panbuttonDivImg" usemap="#panbuttons_'+ppid+'">    <map name="panbuttons_'+ppid+'">      <area shape="circle" class="panbuttons_center" coords="45,45,20" href="#">      <area shape="polygon" class="panbuttons_left" coords="13,20,25,30,20,45,27,65,13,70,5,45" href="#">      <area shape="polygon" class="panbuttons_up" coords="30,8,45,4,60,8,60,23,45,20,30,23" href="#">      <area shape="polygon" class="panbuttons_right" coords="79,20,67,30,72,45,65,65,79,70,87,45" href="#">      <area shape="polygon" class="panbuttons_down" coords="30,82,45,86,60,82,60,68,45,70,30,68" href="#">    <\/map>  <\/img><\/div><\/div>')},register:function(){},unregister:function(){},startPlugin:function(sandbox){var me=this,p;me._sandbox=sandbox||me.getMapModule().getSandbox();me._sandbox.register(me);for(p in me.eventHandlers)me.eventHandlers.hasOwnProperty(p)&&me._sandbox.registerForEventByName(me,p);this._draw()},stopPlugin:function(){var me=this,p;me.element&&(me.element.remove(),delete me.element);for(p in me.eventHandlers)me.eventHandlers.hasOwnProperty(p)&&me._sandbox.unregisterFromEventByName(me,p);me._sandbox.unregister(this)},setLocation:function(location){var me=this;me.conf||(me.conf={});me.conf.location.classes=location;me.element&&me.getMapModule().setMapControlPlugin(me.element,location,0)},_draw:function(){var me=this,pbimg,panbuttonDivImg,center,left,right,top,bottom;me.__parent||(me.__parent=this._map.div);me.element||(me.element=me.templates.main.clone());var pb=me.element,containerClasses="top right",position=0;me.conf&&me.conf.location&&(containerClasses=me.conf.location.classes||containerClasses,position=me.conf.location.position||position);me.mapModule.setMapControlPlugin(pb,containerClasses,position);pbimg=this.getMapModule().getImageUrl()+"/framework/bundle/mapmodule-plugin/plugin/panbuttons/images/";panbuttonDivImg=pb.find(".panbuttonDivImg");panbuttonDivImg.attr("src",pbimg+"empty.png");me.conf&&me.conf.toolStyle&&me.changeToolStyle(me.conf.toolStyle,pb);center=pb.find(".panbuttons_center");center.bind("mouseover",function(){panbuttonDivImg.addClass("root")});center.bind("mouseout",function(){panbuttonDivImg.removeClass("root")});center.bind("click",function(){if(!me.isInLayerToolsEditMode){var mm=me.getMapModule(),sb=mm.getSandbox(),rb=sb.getRequestBuilder("StateHandler.SetStateRequest");rb?sb.request(me,rb()):sb.resetState()}});left=pb.find(".panbuttons_left");left.bind("mouseover",function(){panbuttonDivImg.addClass("left")});left.bind("mouseout",function(){panbuttonDivImg.removeClass("left")});left.bind("click",function(){me.isInLayerToolsEditMode||me.getMapModule().panMapByPixels(-100,0,!0)});right=pb.find(".panbuttons_right");right.bind("mouseover",function(){panbuttonDivImg.addClass("right")});right.bind("mouseout",function(){panbuttonDivImg.removeClass("right")});right.bind("click",function(){me.isInLayerToolsEditMode||me.getMapModule().panMapByPixels(100,0,!0)});top=pb.find(".panbuttons_up");top.bind("mouseover",function(){panbuttonDivImg.addClass("up")});top.bind("mouseout",function(){panbuttonDivImg.removeClass("up")});top.bind("click",function(){me.isInLayerToolsEditMode||me.getMapModule().panMapByPixels(0,-100,!0)});bottom=pb.find(".panbuttons_down");bottom.bind("mouseover",function(){panbuttonDivImg.addClass("down")});bottom.bind("mouseout",function(){panbuttonDivImg.removeClass("down")});bottom.bind("click",function(){me.isInLayerToolsEditMode||me.getMapModule().panMapByPixels(0,100,!0)});pb.mousedown(function(event){if(!me.isInLayerToolsEditMode){var radius=Math.round(.5*panbuttonDivImg[0].width),pbOffset=panbuttonDivImg.offset(),centerX=pbOffset.left+radius,centerY=pbOffset.top+radius;Math.sqrt(Math.pow(centerX-event.pageX,2)+Math.pow(centerY-event.pageY,2))<radius&&event.stopPropagation()}});this.isInLayerToolsEditMode=me.getMapModule().isInLayerToolsEditMode()},eventHandlers:{LayerToolsEditModeEvent:function(event){this.isInLayerToolsEditMode=event.isInMode()}},onEvent:function(event){return this.eventHandlers[event.getName()].apply(this,[event])},start:function(){},stop:function(){},changeToolStyle:function(styleName,div){var panButtons;if(div=div||this.element,div)if(panButtons=div.find("img.panbuttonDivImg"),styleName===null)panButtons.removeAttr("style");else{var resourcesPath=this.getMapModule().getImageUrl(),imgUrl=resourcesPath+"/framework/bundle/mapmodule-plugin/plugin/panbuttons/images/",bgImg=imgUrl+"panbutton-sprites-"+styleName+".png";panButtons.css({"background-image":'url("'+bgImg+'")'})}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.registerLocalization({lang:"am",key:"MapModule",value:{status_update_map:" ",zoombar_tooltip:{"zoomLvl-0":" ","zoomLvl-1":"","zoomLvl-2":"","zoomLvl-3":"","zoomLvl-4":"","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":" ","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:" ",dataSources:"NOT TRANSLATED",layersHeader:"NOT TRANSLATED",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:" ",popup:{title:" ",content:"NOT TRANSLATED"},button:{close:""}},LayerSelectionPlugin:{title:" ",chooseDefaultBaseLayer:"   "},SearchPlugin:{placeholder:" ",search:"",close:"  ",noresults:"    ",toomanyresults:"  100-  :     ",column_name:"",column_village:"",column_type:""},GetInfoPlugin:{title:" ",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"NOT TRANSLATED",link:"NOT TRANSLATED",name:"NOT TRANSLATED"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}});Oskari.registerLocalization({lang:"bg",key:"MapModule",value:{status_update_map:"  ",zoombar_tooltip:{"zoomLvl-0":" ","zoomLvl-1":"","zoomLvl-2":"","zoomLvl-3":"","zoomLvl-4":"","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"  ","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"  ",dataSources:"NOT TRANSLATED",layersHeader:"NOT TRANSLATED",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"  ",popup:{title:"  ",content:"NOT TRANSLATED"},button:{close:""}},LayerSelectionPlugin:{title:"  ",chooseDefaultBaseLayer:"     "},SearchPlugin:{placeholder:"  ",search:"",close:"    ",noresults:"   ",toomanyresults:"    100 . ,   ",column_name:"",column_village:"",column_type:""},GetInfoPlugin:{title:" ",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"NOT TRANSLATED",link:"NOT TRANSLATED",name:"NOT TRANSLATED"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}});Oskari.registerLocalization({lang:"cs",key:"MapModule",value:{status_update_map:"Aktualizace mapy",zoombar_tooltip:{"zoomLvl-0":"Mapa pozad","zoomLvl-1":"Stt","zoomLvl-2":"Provincie","zoomLvl-3":"","zoomLvl-4":"Msto","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Mstsk st","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Ulice","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Podmnky uit",termsLink:"https://www.lupapiste.fi/kayttoehdot",mapLinkBase:"http://www.paikkatietoikkuna.fi/web/en/map-window?"},DataSourcePlugin:{link:"Datov zdroj",popup:{title:"Datov zdroje",content:" "},button:{close:"Zavt"}},LayerSelectionPlugin:{title:"Objektov data",chooseDefaultBaseLayer:"Vyberte vrstvu pozad mapy"},SearchPlugin:{placeholder:"Vyhledat msta",search:"Vyhledat",close:"Zavt vsledky hledn",noresults:"dn vsledky nenalezeny",toomanyresults:"Nalezeno vce ne 100 vsledk. Specifikujte dotaz podrobnji.",column_name:"Jmno",column_village:"Obec",column_type:"Typ"},GetInfoPlugin:{title:"NOT TRANSLATED",layer:"NOT TRANSLATED",places:"Msta",description:"Popis",link:"URL-adresa",name:"Jmno"}}}});Oskari.registerLocalization({lang:"da",key:"MapModule",value:{status_update_map:"Opdaterer kort",zoombar_tooltip:{"zoomLvl-0":"Baggrundskort","zoomLvl-1":"Land","zoomLvl-2":"Provins","zoomLvl-3":"","zoomLvl-4":"By","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Bydel","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Gade/vej","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Brugsbetingelser",dataSources:"NOT TRANSLATED",layersHeader:"NOT TRANSLATED",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Datakilde",popup:{title:"Datakilde",content:"NOT TRANSLATED"},button:{close:"Luk"}},LayerSelectionPlugin:{title:"Objektdata",chooseDefaultBaseLayer:"Vlg bagrundskortlag"},SearchPlugin:{placeholder:"Find steder",search:"Find",close:"Luk sgeresultater",noresults:"Ingen resultater fundet",toomanyresults:"Over 100 resultater blev fundet, specificer din sgning yderligere",column_name:"Navn",column_village:"Kommune",column_type:"Type"},GetInfoPlugin:{title:"Kortlag",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"NOT TRANSLATED",link:"NOT TRANSLATED",name:"NOT TRANSLATED"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}});Oskari.registerLocalization({lang:"de",key:"MapModule",value:{status_update_map:"Karte wird aktualisiert",zoombar_tooltip:{"zoomLvl-0":"Hintergrundkarte","zoomLvl-1":"Land","zoomLvl-2":"Region","zoomLvl-3":"","zoomLvl-4":"Stadt","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Stadtteil","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Strae","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Nutzungsbedingungen",termsLink:"https://www.lupapiste.fi/kayttoehdot",mapLinkBase:"http://www.paikkatietoikkuna.fi/web/en/map-window?"},DataSourcePlugin:{link:"Datenquelle",popup:{title:"Datenquellen",content:" "},button:{close:"Schlieen"}},LayerSelectionPlugin:{title:"Objektdaten",chooseDefaultBaseLayer:"Hintergrundkarte whlen"},SearchPlugin:{placeholder:"Finde Orte",search:"Finde",close:"Liste der Suchergebnisse schlieen",noresults:"Keine Ergebnisse gefunden",toomanyresults:"ber 100 Ergebnisse gefunden. Bitte verfeinern Sie Ihre Suche.",column_name:"Name",column_village:"Gemeinde",column_type:"Typ"},GetInfoPlugin:{title:"Kartenebenen",layer:"NOT TRANSLATED",places:"Orte",description:"Beschreibung",link:"URL-addresse",name:"Name"}}}});Oskari.registerLocalization({lang:"en",key:"MapModule",value:{status_update_map:"Updating map",zoombar_tooltip:{"zoomLvl-0":"Background map","zoomLvl-1":"Country","zoomLvl-2":"Province","zoomLvl-3":"","zoomLvl-4":"Town","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Part of town","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Street","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Terms of Use",dataSources:"Data sources",termsLink:"https://www.lupapiste.fi/kayttoehdot",mapLinkBase:"http://www.paikkatietoikkuna.fi/web/en/map-window?",layersHeader:"Map layers",indicatorsHeader:"Indicators"},DataSourcePlugin:{link:"Data Source",popup:{title:"Data Sources",content:" "},button:{close:"Close"}},LayerSelectionPlugin:{title:"Object data",chooseDefaultBaseLayer:"Select background map layer"},SearchPlugin:{placeholder:"Find places",search:"Find",close:"Close search results",noresults:"No results found",toomanyresults:"Over 100 results found. Please refine your search.",column_name:"Name",column_village:"Municipality",column_type:"Type"},GetInfoPlugin:{title:"Map layers",layer:"Layer",places:"Places",description:"Description",link:"URL-address",name:"Name"},PublisherToolbarPlugin:{test:"test",history:{reset:"Return to default view",back:"Back",next:"Next"},measure:{line:"Measure distance",area:"Measure area"}}}}});Oskari.registerLocalization({lang:"es",key:"MapModule",value:{status_update_map:"Actualizando mapa",zoombar_tooltip:{"zoomLvl-0":"Mapa de fondo","zoomLvl-1":"Pas","zoomLvl-2":"Provincia","zoomLvl-3":"","zoomLvl-4":"Ciudad","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Parte de una ciudad","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Calle","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Trminos de uso",dataSources:"NOT TRANSLATED",layersHeader:"NOT TRANSLATED",indicatorsHeader:"NOT TRANSLATED",termsLink:"https://www.lupapiste.fi/kayttoehdot",mapLinkBase:"http://www.paikkatietoikkuna.fi/web/en/map-window?"},DataSourcePlugin:{link:"Fuente de datos",popup:{title:"Fuentes de datos",content:"NOT TRANSLATED"},button:{close:"Cerrar"}},LayerSelectionPlugin:{title:"Datos del objeto",chooseDefaultBaseLayer:"Seleccionar capa de fondo"},SearchPlugin:{placeholder:"Encontrar sitios",search:"Encontrar",close:"Cerrar resultados de bsqueda",noresults:"No se encontraron resultados",toomanyresults:"Ms de 100 resultados encontrados. Por favor, refine la bsqueda",column_name:"Nombre",column_village:"Municipio",column_type:"Tipo"},GetInfoPlugin:{title:"Capas",layer:"Layer",places:"Sitios",description:"Descripcin",link:"URL-address",name:"Nombre"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}});Oskari.registerLocalization({lang:"et",key:"MapModule",value:{status_update_map:"Kaardi uuendamine",zoombar_tooltip:{"zoomLvl-0":"Aluskaart","zoomLvl-1":"Riik","zoomLvl-2":"Maakond","zoomLvl-3":"","zoomLvl-4":"Linn","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Linnaosa","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Tnav","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Kasutustingimused",dataSources:"Andmete allikad",layersHeader:"Kaardikihid",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Andmete allikas",popup:{title:"Andmete allikad",content:" "},button:{close:"Sulge"}},LayerSelectionPlugin:{title:"Objekti andmed",chooseDefaultBaseLayer:"Vali aluskaardi kiht"},SearchPlugin:{placeholder:"Leia kohad",search:"Leia",close:"Sulge otsingutulemused",noresults:"Otsingutulemusi ei leitud",toomanyresults:"Leiti le 100 otsingutulemuse. Palun tpsusta otsingut.",column_name:"Name",column_village:"Omavalitsus",column_type:"Tp"},GetInfoPlugin:{title:"Kaardikihid",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"NOT TRANSLATED",link:"NOT TRANSLATED",name:"Nimi"},PublisherToolbarPlugin:{test:"test",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}});Oskari.registerLocalization({lang:"fi",key:"MapModule",value:{status_update_map:"Pivitetn karttaa",zoombar_tooltip:{"zoomLvl-0":"Taustakartta","zoomLvl-1":"Koko maa","zoomLvl-2":"Maakunta","zoomLvl-3":"","zoomLvl-4":"Kunta","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Kunnan osa","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Katu","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Kyttehdot",termsLink:"https://www.lupapiste.fi/kayttoehdot",mapLinkBase:"http://www.paikkatietoikkuna.fi/web/fi/kartta?",layersHeader:"Karttatasot",indicatorsHeader:"Indikaattorit"},DataSourcePlugin:{link:"Aineistolhde",popup:{title:"Tietolhteet",content:" "},button:{close:"Sulje"}},LayerSelectionPlugin:{title:"Karttatasot",chooseDefaultBaseLayer:"Valitse karttapohja"},SearchPlugin:{placeholder:"Hae paikkoja/osoitteita",search:"Hae",close:"Sulje hakutulokset",noresults:"Haulla ei lytynyt tuloksia",toomanyresults:"Lytyi yli 100 tulosta, tarkenna hakua.",column_name:"Nimi",column_village:"Kunta",column_type:"Tyyppi"},GetInfoPlugin:{title:"Kohdetiedot",layer:"Taso",places:"Kohteet",description:"Kuvaus",link:"URL-osoite",name:"Nimi"},PublisherToolbarPlugin:{test:"testi",history:{reset:"Paluu oletusnkymn",back:"Takaisin",next:"Eteenpin"},measure:{line:"Mittaa etisyys",area:"Mittaa alue"}}}}});Oskari.registerLocalization({lang:"ge",key:"MapModule",value:{status_update_map:" ",zoombar_tooltip:{"zoomLvl-0":" ","zoomLvl-1":"","zoomLvl-2":"","zoomLvl-3":"","zoomLvl-4":"","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":" ","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:" ",dataSources:"NOT TRANSLATED",layersHeader:"NOT TRANSLATED",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:" ",popup:{title:" ",content:"NOT TRANSLATED"},button:{close:""}},LayerSelectionPlugin:{title:" ",chooseDefaultBaseLayer:"   "},SearchPlugin:{placeholder:" ",search:"",close:"  ",noresults:"  ",toomanyresults:" 100  . ,  ",column_name:"",column_village:"",column_type:""},GetInfoPlugin:{title:" ",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"NOT TRANSLATED",link:"NOT TRANSLATED",name:"NOT TRANSLATED"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}});Oskari.registerLocalization({lang:"gr",key:"MapModule",value:{status_update_map:" ",zoombar_tooltip:{"zoomLvl-0":"","zoomLvl-1":"","zoomLvl-2":" ","zoomLvl-3":"","zoomLvl-4":"","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":" ","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:" ",dataSources:" ",layersHeader:" ",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:" ",popup:{title:" ",content:" "},button:{close:""}},LayerSelectionPlugin:{title:" ",chooseDefaultBaseLayer:" "},SearchPlugin:{placeholder:" ",search:"",close:"  ",noresults:"  ",toomanyresults:"   100 .      .",column_name:"",column_village:"",column_type:"/ (   )"},GetInfoPlugin:{title:" ",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"",link:"NOT TRANSLATED",name:""},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"",next:""},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}});Oskari.registerLocalization({lang:"hr",key:"MapModule",value:{status_update_map:"Auriranje karte",zoombar_tooltip:{"zoomLvl-0":"Karta pozadine","zoomLvl-1":"Zemlja","zoomLvl-2":"Pokrajina","zoomLvl-3":"","zoomLvl-4":"Grad","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Dio grada","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Ulica","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Uvjeti koritenja",dataSources:"Izvori podataka",layersHeader:"Slojevi karte",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Izvor podataka",popup:{title:"Izvori podataka",content:" "},button:{close:"Zatvori"}},LayerSelectionPlugin:{title:"Podaci o objektu",chooseDefaultBaseLayer:"Odaberi sloj karte pozadine"},SearchPlugin:{placeholder:"Nai mjesta",search:"Nai  ",close:"Zatvori rezultate pretraivanja",noresults:"Nisu pronaeni rezultati",toomanyresults:"Pronaeno je preko 100 rezultata. Precizirajte pretraivanje.",column_name:"Ime",column_village:"Opina",column_type:"Tip"},GetInfoPlugin:{title:"Slojevi karte",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"NOT TRANSLATED",link:"NOT TRANSLATED",name:"Ime"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}});Oskari.registerLocalization({lang:"hu",key:"MapModule",value:{status_update_map:"Trkp frissts",zoombar_tooltip:{"zoomLvl-0":"Httrtrkp","zoomLvl-1":"Orszg","zoomLvl-2":"Tartomny","zoomLvl-3":"","zoomLvl-4":"Vros","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Vrosrsz","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Utca","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Felhasznlsi felttelek",dataSources:"NOT TRANSLATED",layersHeader:"NOT TRANSLATED",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Adatforrs",popup:{title:"Adatforrsok",content:"NOT TRANSLATED"},button:{close:"Bezrs"}},LayerSelectionPlugin:{title:"Objektum adatai",chooseDefaultBaseLayer:"Httrtrkprteg kivlasztsa."},SearchPlugin:{placeholder:"Helyek keresse",search:"Keress",close:"Keressi eredmnyek bezrsa.",noresults:"Nincs tallat.",toomanyresults:"Tbb mint 100 tallat. Krem pontostsa a keresst.",column_name:"Nv",column_village:"Telepls",column_type:"Tpus"},GetInfoPlugin:{title:"Trkprtegek",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"NOT TRANSLATED",link:"NOT TRANSLATED",name:"NOT TRANSLATED"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}});Oskari.registerLocalization({lang:"lv",key:"MapModule",value:{status_update_map:"Kartes atjauninana",zoombar_tooltip:{"zoomLvl-0":"Fona karte","zoomLvl-1":"Valsts","zoomLvl-2":"Province","zoomLvl-3":"","zoomLvl-4":"Pilsta","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"NOT TRANSLATED","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Iela","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Lietoanas noteikumi",dataSources:"NOT TRANSLATED",layersHeader:"NOT TRANSLATED",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Datu avots",popup:{title:"Datu avoti",content:"NOT TRANSLATED"},button:{close:"Aizvrt"}},LayerSelectionPlugin:{title:"Objekta dati",chooseDefaultBaseLayer:"Izvlties fona kartes slni"},SearchPlugin:{placeholder:"Atrast vietas",search:"Atrast",close:"Aizvrt meklanas rezulttus",noresults:"Rezultti nav atrasti",toomanyresults:"Atrasti vairk k 100 rezultti. Ldzu precizjiet meklanas kritrijus",column_name:"Nosaukums",column_village:"Pavaldba",column_type:"Tips"},GetInfoPlugin:{title:"Kartes sli",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"NOT TRANSLATED",link:"NOT TRANSLATED",name:"NOT TRANSLATED"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}});Oskari.registerLocalization({lang:"nl",key:"MapModule",value:{status_update_map:"Kaart aan het vernieuwen",zoombar_tooltip:{"zoomLvl-0":"Achtergrondkaart","zoomLvl-1":"Land","zoomLvl-2":"Provincie","zoomLvl-3":"","zoomLvl-4":"Stad","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Stadsdeel","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Straat","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Gebruiksvoorwaarden",dataSources:"Gegevensbronnen",layersHeader:"Kaartlagen",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Gegevensbron",popup:{title:"Gegevensbronnen",content:" "},button:{close:"Sluiten"}},LayerSelectionPlugin:{title:"Objectgegevens",chooseDefaultBaseLayer:"Selecteer achtergrondkaartlaag"},SearchPlugin:{placeholder:"Vind plaatsen",search:"Vinden",close:"Sluit zoekresultaten",noresults:"Geen resultaten gevonden",toomanyresults:"Meer dan 100 resultaten gevonden. Verfijn uw zoekopdracht.",column_name:"Naam",column_village:"Gemeente",column_type:"Type"},GetInfoPlugin:{title:"Kaartlagen",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"Beschrijving",link:"NOT TRANSLATED",name:"Naam"},PublisherToolbarPlugin:{test:"test",history:{reset:"Terug naar standaardweergave",back:"Terug",next:"Verder"},measure:{line:"Meet afstand",area:"Meet gebied"}}}}});Oskari.registerLocalization({lang:"pl",key:"MapModule",value:{status_update_map:"Aktualizacja Mapy",zoombar_tooltip:{"zoomLvl-0":"Mapa rdowa","zoomLvl-1":"Kraj","zoomLvl-2":"Prowincja/Wojewdztwo","zoomLvl-3":"","zoomLvl-4":"Miasto","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Cz miasta","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Ulica","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Zasady korzystania",dataSources:"rda danych",layersHeader:"Warstwy map",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"rdo danych",popup:{title:"rda danych",content:" "},button:{close:"Zakocz"}},LayerSelectionPlugin:{title:"Dane obiektu",chooseDefaultBaseLayer:"Wybierz rdowa warstw mapy"},SearchPlugin:{placeholder:"Znajd miejsca",search:"Znajd",close:"Zamknij wyniki wyszukiwania",noresults:"Brak wynikw",toomanyresults:"Ponad 100 wynikw. Prosz doprecyzowa zapytanie.",column_name:"Nazwa",column_village:"Gmina",column_type:"Typ"},GetInfoPlugin:{title:"Warstwy map",layer:"NOT TRANSLATED",places:"Miejsca",description:"Opis",link:"NOT TRANSLATED",name:"Nazwa"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"Powrt do domylnego widoku",back:"Cofnij",next:"Nastpny"},measure:{line:"Pomiar odlegoci",area:"Pomiar powierzchni"}}}}});Oskari.registerLocalization({lang:"pt",key:"MapModule",value:{status_update_map:"A atualizar",zoombar_tooltip:{"zoomLvl-0":"Carta de fundo","zoomLvl-1":"Pas","zoomLvl-2":"Regio","zoomLvl-3":"","zoomLvl-4":"Localidade","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Parte de localidade","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Rua","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Termos de utilizao",dataSources:"Fontes de dados",layersHeader:"Camadas",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Fonte de dados",popup:{title:"Fontes de dados",content:"NOT TRANSLATED"},button:{close:"Fechar"}},LayerSelectionPlugin:{title:"Objetos",chooseDefaultBaseLayer:"Selecionar carta de fundo"},SearchPlugin:{placeholder:"Encontrar lugares",search:"Encontrar",close:"Fechar resultados da pesquisa",noresults:"Sem resultados",toomanyresults:"Mais de 100 resultados. Restrinja a pesquisa",column_name:"Nome",column_village:"Concelho",column_type:"Tipo"},GetInfoPlugin:{title:"Camadas",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"Descrio",link:"NOT TRANSLATED",name:"Nome"},PublisherToolbarPlugin:{test:"test",history:{reset:"Voltar  vista padro",back:"Voltar",next:"Seguinte"},measure:{line:"Medir distncia",area:"Medir rea"}}}}});Oskari.registerLocalization({lang:"ro",key:"MapModule",value:{status_update_map:"Actualizare hart",zoombar_tooltip:{"zoomLvl-0":"Hart suport","zoomLvl-1":"ar","zoomLvl-2":"Provincie","zoomLvl-3":"","zoomLvl-4":"Ora","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Zon a oraului","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Strad","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Termeni de folosin",dataSources:"NOT TRANSLATED",layersHeader:"NOT TRANSLATED",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Sursa de date",popup:{title:"Surse de date",content:"NOT TRANSLATED"},button:{close:"nchidere"}},LayerSelectionPlugin:{title:"Date obiect",chooseDefaultBaseLayer:"Selectare strat de hart suport"},SearchPlugin:{placeholder:"Cutare locaii",search:"Cutare",close:"nchide rezultatele cutrii",noresults:"Nu au fost gsite rezultate",toomanyresults:"Peste 100 de rezultate gsite. V rugm revizuii cutarea",column_name:"Nume",column_village:"Municipalitate",column_type:"Tip"},GetInfoPlugin:{title:"Straturi de hart",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"NOT TRANSLATED",link:"NOT TRANSLATED",name:"NOT TRANSLATED"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}});Oskari.registerLocalization({lang:"rs",key:"MapModule",value:{status_update_map:"Auriranje mape",zoombar_tooltip:{"zoomLvl-0":"Osnovna mapa","zoomLvl-1":"Drava","zoomLvl-2":"Pokrajina","zoomLvl-3":"","zoomLvl-4":"Grad","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Deo grada","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Ulica","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Uslovi korienja",dataSources:"NOT TRANSLATED",layersHeader:"NOT TRANSLATED",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Izvor podataka",popup:{title:"Izvori podataka",content:"NOT TRANSLATED"},button:{close:"Zatvori"}},LayerSelectionPlugin:{title:"Podaci sa atributima",chooseDefaultBaseLayer:"Izaberi osnovni sloj"},SearchPlugin:{placeholder:"Pronai lokaciju",search:"Pronai",close:"Zatvori naene rezultate",noresults:"Nema rezultata",toomanyresults:"Pronaeno je preko 100 rezultata. Molimo, precizirajte upit.",column_name:"Ime",column_village:"Optina",column_type:"Tip"},GetInfoPlugin:{title:"Slojevi",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"NOT TRANSLATED",link:"NOT TRANSLATED",name:"NOT TRANSLATED"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}});Oskari.registerLocalization({lang:"sl",key:"MapModule",value:{status_update_map:"Posodabljanje karte",zoombar_tooltip:{"zoomLvl-0":"Karta za ozadje","zoomLvl-1":"Drava","zoomLvl-2":"Provinca","zoomLvl-3":"","zoomLvl-4":"Mesto","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Del mesta","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Ulica","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Pogoji uporabe",dataSources:"NOT TRANSLATED",layersHeader:"NOT TRANSLATED",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Vir podatkov",popup:{title:"Viri podatkov",content:"NOT TRANSLATED"},button:{close:"Zapri"}},LayerSelectionPlugin:{title:"Objektni podatek",chooseDefaultBaseLayer:"Izberi karto za ozadje"},SearchPlugin:{placeholder:"Ii kraje",search:"Ii",close:"Zapri rezultate iskanja",noresults:"Ni rezultatov",toomanyresults:"Najdenih je bilo ve kot 100 rezultatov. Prosimo omejite iskanje.",column_name:"Ime",column_village:"Obina",column_type:"Tip"},GetInfoPlugin:{title:"Sloj karte",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"NOT TRANSLATED",link:"NOT TRANSLATED",name:"NOT TRANSLATED"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}});Oskari.registerLocalization({lang:"sk",key:"MapModule",value:{status_update_map:"Aktualizcia mapy",zoombar_tooltip:{"zoomLvl-0":"Podkladov mapa","zoomLvl-1":"Krajina","zoomLvl-2":"Oblas","zoomLvl-3":"","zoomLvl-4":"Mesto","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Mestsk as","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Ulica","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Podmienky pouvania",dataSources:"NOT TRANSLATED",layersHeader:"NOT TRANSLATED",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Zdroj dajov",popup:{title:"Zdroje dajov",content:"NOT TRANSLATED"},button:{close:"Zatvori"}},LayerSelectionPlugin:{title:"daje o objekte",chooseDefaultBaseLayer:"Zvoli mapov vrstvu podkladovej mapy"},SearchPlugin:{placeholder:"Njs umiestnenia",search:"Njs",close:"Zavrie vsledky vyhadvania",noresults:"Nenali sa iadne vsledky",toomanyresults:"Nalo sa vye 100 vsledkov. Spresnite vyhadvanie, prosm",column_name:"Nzov",column_village:"Obec",column_type:"Typ"},GetInfoPlugin:{title:"Mapov vrstvy",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"NOT TRANSLATED",link:"NOT TRANSLATED",name:"NOT TRANSLATED"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}});Oskari.registerLocalization({lang:"sq",key:"MapModule",value:{status_update_map:"Azhurnimi i harts",zoombar_tooltip:{"zoomLvl-0":"Harta n sfond","zoomLvl-1":"Vendi","zoomLvl-2":"Provinca","zoomLvl-3":"","zoomLvl-4":"Qyteti","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Pjesa e qytetit","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Rruga","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Kushtet e prdorimit",dataSources:"NOT TRANSLATED",layersHeader:"NOT TRANSLATED",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:"Burimi i t dhnave",popup:{title:"Burimet e t dhnave",content:"NOT TRANSLATED"},button:{close:"Mbyll"}},LayerSelectionPlugin:{title:"T dhnat e objektit",chooseDefaultBaseLayer:"Zgjidh shtresn e harts n sfond"},SearchPlugin:{placeholder:"Gjej vende",search:"Gjej",close:"Mbyll rezultatet e krkimit",noresults:"Asnj rezultat i gjetur",toomanyresults:"Mbi 100 rezultate t gjetura. Ju lutem prmirsojeni krkimin tuaj",column_name:"Emri",column_village:"Komuna",column_type:"Lloji"},GetInfoPlugin:{title:"Shtresat e harts",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"NOT TRANSLATED",link:"NOT TRANSLATED",name:"NOT TRANSLATED"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}});Oskari.registerLocalization({lang:"sv",key:"MapModule",value:{status_update_map:"Uppdaterar kartan",zoombar_tooltip:{"zoomLvl-0":"Bakgrundskarta","zoomLvl-1":"Hela landet","zoomLvl-2":"Landskap","zoomLvl-3":"","zoomLvl-4":"Kommun","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":"Stadsdel","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"Gata","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:"Anvndningsvillkor",termsLink:"https://www.lupapiste.fi/kayttoehdot?lang=sv",mapLinkBase:"http://www.paikkatietoikkuna.fi/web/sv/kartfonstret?",layersHeader:"Kartlager",indicatorsHeader:"Indikator"},DataSourcePlugin:{link:"Dataklla",popup:{title:"Datakllor",content:" "},button:{close:"Stng"}},LayerSelectionPlugin:{title:"Kartlager",chooseDefaultBaseLayer:"Vlj bottenkarta"},SearchPlugin:{placeholder:"Sk plats/adress",search:"Sk",close:"Stng skresultat",noresults:"Inga trffar",toomanyresults:"ver 100 trffar, avgrnsa skningen.",column_name:"Namn",column_village:"Kommun",column_type:"Typ"},GetInfoPlugin:{title:"Objektuppgifter",layer:"Lagret",places:"Object",description:"Beskrivning",link:"URL-address",name:"Namn"},PublisherToolbarPlugin:{test:"test",history:{reset:"Tillbaka till standardvyn",back:"Fregende",next:"Nsta"},measure:{line:"Mt avstnd",area:"Mt areal"}}}}});Oskari.registerLocalization({lang:"uk",key:"MapModule",value:{status_update_map:" ",zoombar_tooltip:{"zoomLvl-0":" ","zoomLvl-1":"","zoomLvl-2":"","zoomLvl-3":"","zoomLvl-4":"","zoomLvl-5":"","zoomLvl-6":"","zoomLvl-7":" ","zoomLvl-8":"","zoomLvl-9":"","zoomLvl-10":"","zoomLvl-11":"","zoomLvl-12":""},plugin:{LogoPlugin:{terms:" ",dataSources:"NOT TRANSLATED",layersHeader:"NOT TRANSLATED",indicatorsHeader:"NOT TRANSLATED"},DataSourcePlugin:{link:" ",popup:{title:" ",content:"NOT TRANSLATED"},button:{close:""}},LayerSelectionPlugin:{title:" '",chooseDefaultBaseLayer:"   "},SearchPlugin:{placeholder:" ",search:"",close:"  ",noresults:"  ",toomanyresults:"  100 .  ,  ",column_name:"",column_village:"",column_type:""},GetInfoPlugin:{title:" ",layer:"NOT TRANSLATED",places:"NOT TRANSLATED",description:"NOT TRANSLATED",link:"NOT TRANSLATED",name:"NOT TRANSLATED"},PublisherToolbarPlugin:{test:"NOT TRANSLATED",history:{reset:"NOT TRANSLATED",back:"NOT TRANSLATED",next:"NOT TRANSLATED"},measure:{line:"NOT TRANSLATED",area:"NOT TRANSLATED"}}}}});Oskari.clazz.define("Oskari.userinterface.bundle.ui.UserInterfaceBundle",function(){},{create:function(){return Oskari.clazz.create("Oskari.userinterface.bundle.ui.UserInterfaceBundleInstance")},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/request/AddExtensionRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/request/AddExtensionRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/request/RemoveExtensionRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/request/RemoveExtensionRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/request/UpdateExtensionRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/request/UpdateExtensionRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/request/ModalDialogRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/request/ModalDialogRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/event/ExtensionUpdatedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/Accordion.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/AccordionPanel.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/TabContainer.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/TabDropdownContainer.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/TabPanel.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/Badge.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/Alert.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/Popup.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/Overlay.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/Button.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/Form.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/UIHelper.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/FormInput.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/Popover.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/Grid.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/GridModel.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/ProgressSpinner.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/VisualizationForm.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/visualization-form/AreaForm.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/visualization-form/LineForm.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/visualization-form/DotForm.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/extension/DefaultTile.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/extension/DefaultFlyout.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/extension/DefaultExtension.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/extension/DefaultView.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/extension/DefaultLayout.js"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/divman.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/accordion.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/tab.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/modal.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/badge.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/alert.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/forminput.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/grid.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/popup.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/button.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/overlay.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/visualizationform.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/popover.css"},{type:"text/javascript",src:"../../../../libraries/raphaeljs/raphael.min.js"},{type:"text/javascript",src:"../../../../libraries/jquery/plugins/jquery-placeholder/jquery.placeholder.js"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/locale/en.js"},{lang:"cs",type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/locale/cs.js"},{lang:"de",type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/locale/de.js"},{lang:"es",type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/locale/es.js"}]},bundle:{manifest:{"Bundle-Identifier":"ui","Bundle-Name":"ui","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" kpI",Title:" kpI"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}});Oskari.bundle_manager.installBundleClass("divmanazer","Oskari.userinterface.bundle.ui.UserInterfaceBundle");Oskari.clazz.define("Oskari.userinterface.bundle.ui.UserInterfaceBundleInstance",function(){this.sandbox=null;this.requestHandlers={};this.extensions=[];this.extensionsByName={};this.compiledTemplates={};this.flyoutContainer=null;this.tileContainer=null;this.flyoutZIndexBase=1100;this.menubarContainerId="#menubar"},{getName:function(){return"userinterface.DivManazer"},init:function(){},getExtensionByName:function(name){return this.extensionsByName[name]},getSandbox:function(){return this.sandbox},start:function(){this.compileTemplates();var conf=this.conf,sandboxName=(conf?conf.sandbox:null)||"sandbox",sandbox=Oskari.getSandbox(sandboxName),toFix,height,ieFixClasses,n,fix;if(this.sandbox=sandbox,this.flyoutContainer=jQuery(document.body),this.tileContainer=jQuery(this.menubarContainerId),this.tileContainer.addClass("oskari-tile-container"),this.sandbox.register(this),this.requestHandlers.add=Oskari.clazz.create("Oskari.userinterface.bundle.ui.request.AddExtensionRequestHandler",this),this.requestHandlers.remove=Oskari.clazz.create("Oskari.userinterface.bundle.ui.request.RemoveExtensionRequestHandler",this),this.requestHandlers.update=Oskari.clazz.create("Oskari.userinterface.bundle.ui.request.UpdateExtensionRequestHandler",this),sandbox.addRequestHandler("userinterface.AddExtensionRequest",this.requestHandlers.add),sandbox.addRequestHandler("userinterface.RemoveExtensionRequest",this.requestHandlers.remove),sandbox.addRequestHandler("userinterface.UpdateExtensionRequest",this.requestHandlers.update),this.requestHandlers.modal=Oskari.clazz.create("Oskari.userinterface.bundle.ui.request.ModalDialogRequestHandler",this),sandbox.addRequestHandler("userinterface.ModalDialogRequest",this.requestHandlers.modal),jQuery.browser.msie&&jQuery.browser.version<"9.0")for(toFix=this.compiledTemplates["Oskari.userinterface.Flyout"].children(".oskari-flyoutcontentcontainer"),height=this.flyoutContainer.height(),ieFixClasses=this.ieFixClasses,n=0;n<ieFixClasses.length;n+=1)if(fix=ieFixClasses[n],height>=fix.min&&height<=fix.max){toFix.addClass(fix.cls);break}},update:function(){},stop:function(){sandbox.removeRequestHandler("userinterface.UpdateExtensionRequest",this.requestHandlers.update);sandbox.removeRequestHandler("userinterface.RemoveExtensionRequest",this.requestHandlers.remove);sandbox.removeRequestHandler("userinterface.AddExtensionRequest",this.requestHandlers.add);sandbox.removeRequestHandler("userinterface.ModalDialogRequest",this.requestHandlers.modal);this.sandbox.unregister(this);this.started=!1},templates:{"Oskari.userinterface.Tile":'<div class="oskari-tile oskari-tile-closed"><div class="oskari-tile-title"><\/div><div class="oskari-tile-status"><\/div><\/div>',"Oskari.userinterface.Flyout":'<div class="oskari-flyout oskari-closed"><div class="oskari-flyouttoolbar"><div class="oskari-flyoutheading"><\/div><div class="oskari-flyout-title"><p><\/p><\/div><div class="oskari-flyouttools"><div class="oskari-flyouttool-help"><\/div><div class="oskari-flyouttool-attach"><\/div><div class="oskari-flyouttool-detach"><\/div><div class="oskari-flyouttool-minimize"><\/div><div class="oskari-flyouttool-restore"><\/div><div class="oskari-flyouttool-close icon-close icon-close:hover"><\/div><\/div><\/div><div class="oskari-flyoutcontentcontainer"><div class="oskari-flyoutcontent"><\/div><\/div><\/div>',"Oskari.userinterface.View":'<div class="oskari-view"><\/div>'},compileTemplates:function(){var me=this,flyout;me.compiledTemplates["Oskari.userinterface.Tile"]=jQuery(this.templates["Oskari.userinterface.Tile"]);flyout=jQuery(me.templates["Oskari.userinterface.Flyout"]);flyout.css("left",me.defaults.attach.left);flyout.css("top",me.defaults.attach.top);me.compiledTemplates["Oskari.userinterface.Flyout"]=flyout;me.compiledTemplates["Oskari.userinterface.View"]=jQuery(this.templates["Oskari.userinterface.View"])},addExtension:function(extension){var me=this,plugins,extensions,extensionsByName,extensionInfo,count,name,flyoutPlugin,flyout,el,fcc,tilePlugin,tile,viewPlugin,view;return extension.startExtension(),plugins=extension.getPlugins(),extensions=me.extensions,extensionsByName=me.extensionsByName,extensionInfo={state:"close",extension:extension,draggable:null,draggableTarget:null,draggableHandle:null,viewState:{},extensionUpdatedEvent:null},extensionInfo.extensionUpdatedEvent=me.sandbox.getEventBuilder("userinterface.ExtensionUpdatedEvent")(extension,extensionInfo.state),count=extensions.length,name=extension.getName(),flyoutPlugin=plugins["Oskari.userinterface.Flyout"],flyout=null,el=null,flyoutPlugin!==null&&flyoutPlugin!==undefined&&(flyout=me.createFlyout(extension,flyoutPlugin,count,extensionInfo),me._applyDraggableToFlyout(flyout,extensionInfo,".oskari-flyouttoolbar"),fcc=flyout.children(".oskari-flyoutcontentcontainer"),el=fcc.children(".oskari-flyoutcontent"),flyoutPlugin.setEl(el.get()),me.flyoutContainer.append(flyout),flyoutPlugin.startPlugin()),tilePlugin=plugins["Oskari.userinterface.Tile"],tile=null,tilePlugin!==null&&tilePlugin!==undefined&&(tile=me.createTile(extension,tilePlugin,count,extensionInfo),tilePlugin.startPlugin(),tile.fadeIn(200),me.tileContainer.append(tile)),viewPlugin=plugins["Oskari.userinterface.View"],view=null,viewPlugin!==null&&viewPlugin!==undefined&&(view=me.createView(extension,viewPlugin,count,extensionInfo),el=view,viewPlugin.setEl(el.get()),viewPlugin.startPlugin()),extensionInfo.plugins={},tilePlugin&&(extensionInfo.plugins["Oskari.userinterface.Tile"]={plugin:tilePlugin,el:tile}),flyoutPlugin&&(extensionInfo.plugins["Oskari.userinterface.Flyout"]={plugin:flyoutPlugin,el:flyout}),viewPlugin&&(extensionInfo.plugins["Oskari.userinterface.View"]={plugin:viewPlugin,el:view}),extensions.push(extensionInfo),extensionsByName[name]=extensionInfo,extensionInfo},_applyDraggableToFlyout:function(flyout,extensionInfo,cls){var me=this,handle=flyout.children(cls).get()[0],flyoutTarget=flyout.get()[0],useHelper=!1,el;extensionInfo.draggableHandle=handle;extensionInfo.draggableTarget=flyoutTarget;extensionInfo.draggable=$(flyout).draggable({handle:jQuery(handle),helper:useHelper?function(){return el=jQuery("<div />"),el.css("width",flyout.css("width")),el.css("height",flyout.css("height")),el.css("border","2px solid rgba(0,0,0,.5)"),el.css("z-index",flyout.css("z-index")),el}:null,scroll:!1,stack:".oskari-flyout",create:function(){jQuery.browser.msie&&jQuery.browser.version[0]==="9"&&flyout.css("width",flyout.width()+"px")},start:function(){useHelper&&flyout.css("display","none")},drag:function(){},stop:function(event,ui){var viewState;useHelper&&(flyout.css("top",ui.helper.css("top")),flyout.css("left",ui.helper.css("left")));me.shuffleZIndices(flyout);useHelper&&flyout.css("display","");viewState=me.getFlyoutViewState(flyout,"detach");extensionInfo.viewState=viewState;me.notifyExtensionViewStateChange(extensionInfo)}})},createTile:function(extension,plugin){var me=this,tile=this.compiledTemplates["Oskari.userinterface.Tile"].clone(!0,!0),title=tile.children(".oskari-tile-title"),tileClick=function(){tile.off("click");me.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[extension,"toggle"]);window.setTimeout(function(){tile.click(tileClick)},500)};return title.append(plugin.getTitle()),tile.click(tileClick),plugin.setEl(tile.get()),tile},createFlyout:function(extension,plugin){var me=this,flyout=this.compiledTemplates["Oskari.userinterface.Flyout"].clone(!0,!0),flyouttools,toolage;return flyout.find(".oskari-flyout-title p").append(plugin.getTitle()),flyouttools=flyout.children(".oskari-flyouttoolbar").children(".oskari-flyouttools"),toolage={attach:flyouttools.children(".oskari-flyouttool-attach"),detach:flyouttools.children(".oskari-flyouttool-detach"),minimize:flyouttools.children(".oskari-flyouttool-minimize"),restore:flyouttools.children(".oskari-flyouttool-restore"),close:flyouttools.children(".oskari-flyouttool-close"),help:flyouttools.children(".oskari-flyouttool-help")},toolage.detach.click(function(){me.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[extension,"detach"])}),toolage.attach.click(function(){me.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[extension,"attach"])}),toolage.minimize.click(function(){me.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[extension,"minimize"])}),toolage.restore.click(function(){me.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[extension,"restore"])}),toolage.close.click(function(){me.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[extension,"close"])}),toolage.help.click(function(){me.getSandbox().postRequestByName("userguide.ShowUserGuideRequest",[{placement:"bottom",el:toolage.help,extension:extension.getName(),toggle:!0}])}),flyout},createView:function(){var me=this;return me.compiledTemplates["Oskari.userinterface.View"].clone(!0,!0)},removeExtension:function(extension){var me=this,extensions=me.extensions,extensionsByName=this.extensionsByName,extensionInfo=extensionsByName[extension.getName()],flyoutInfo=extensionInfo.plugins["Oskari.userinterface.Flyout"],flyoutPlugin,flyout,ops,closeOp,tileInfo,tile,after,n,len;for(flyoutInfo&&(flyoutPlugin=flyoutInfo.plugin,flyout=flyoutInfo.el,ops=this.flyoutOps,closeOp=ops.close,closeOp.apply(this,[flyout,flyoutPlugin,extensionInfo]),flyout.remove()),tileInfo=extensionInfo.plugins["Oskari.userinterface.Tile"],tileInfo&&(tile=tileInfo.el,tile.remove()),extensionsByName[extension.getName()]=null,after=[],n=0,len=extensions.length;n<len;n+=1)extensions[n]!==extensionInfo&&after.push(extensions[n]);me.extensions=after;extension.stopExtension()},updateExtension:function(extension,request){var me=this,extensions=me.extensions,i,extensionsByName,extensionInfo,extensionState,state,ops,op,flyoutInfo,closeOp,n,otherExtensionInfo,otherState,plgnfo,otherFlyoutInfo,otherFlyoutPlugin,otherFlyout,otherTileInfo,otherTile,flyoutPlugin,flyout,tileInfo,tile,viewInfo,viewPlugin,view,len,extTop,extLeft,extLocation;if(!extension){for(i=0;i<extensions.length;i+=1)this.updateExtension(extensions[i].extension,request);return}if(extensionsByName=this.extensionsByName,extensionInfo=extensionsByName[extension.getName()],extensionState=extensionInfo.state,state=request.getState(),state==="toggle"&&(extensionState==="close"?state="attach":extensionState==="attach"?state="close":extensionState==="detach"?state="minimize":extensionState==="minimize"?state="restore":extensionState==="restore"&&(state="minimize")),flyoutInfo=extensionInfo.plugins["Oskari.userinterface.Flyout"],state==="attach"&&flyoutInfo)for(extTop=null,extLeft=null,(request.getExtensionLocation().top||request.getExtensionLocation().left)&&(me.origExtensionLocation={}),extLocation=function(request,me,axis){me.origExtensionLocation&&(request.getExtensionLocation()[axis]?(me.origExtensionLocation[axis]=jQuery(flyoutInfo.el).css(axis),jQuery(flyoutInfo.el).css(axis,request.getExtensionLocation()[axis]+"px")):me.origExtensionLocation[axis]&&jQuery(flyoutInfo.el).css(axis,me.origExtensionLocation[axis]))},extLocation(request,me,"top"),extLocation(request,me,"left"),ops=me.flyoutOps,closeOp=ops.close,n=0,len=extensions.length;n<len;n+=1)if((otherExtensionInfo=extensions[n],otherExtensionInfo!==extensionInfo)&&otherExtensionInfo.state==="attach"){if(otherState="close",plgnfo=otherExtensionInfo.plugins,otherFlyoutInfo=plgnfo["Oskari.userinterface.Flyout"],otherFlyoutInfo)otherFlyoutPlugin=otherFlyoutInfo.plugin,otherFlyout=otherFlyoutInfo.el,otherExtensionInfo.state=otherState,closeOp.apply(this,[otherFlyout,otherFlyoutPlugin,otherExtensionInfo]),me.notifyExtensionViewStateChange(otherExtensionInfo);else continue;otherTileInfo=plgnfo["Oskari.userinterface.Tile"];otherTileInfo&&(otherTile=otherTileInfo.el,me.applyTransition(otherTile,otherState,me.tileTransitions))}flyoutInfo&&(flyoutPlugin=flyoutInfo.plugin,flyout=flyoutInfo.el,state==="attach"&&flyoutPlugin.lazyRender&&flyoutPlugin.lazyRender(),ops=me.flyoutOps,op=ops[state],op.apply(this,[flyout,flyoutPlugin,extensionInfo,extensions]));tileInfo=extensionInfo.plugins["Oskari.userinterface.Tile"];tileInfo&&(tile=tileInfo.el,me.applyTransition(tile,state,me.tileTransitions));viewInfo=extensionInfo.plugins["Oskari.userinterface.View"];viewInfo&&(viewPlugin=viewInfo.plugin,view=viewInfo.el,ops=me.viewOps,op=ops[state],op&&op.apply(this,[view,viewPlugin,extensionInfo,extensions]));extensionInfo.state=state;me.notifyExtensionViewStateChange(extensionInfo)},notifyExtensionViewStateChange:function(extensionInfo){var evt=extensionInfo.extensionUpdatedEvent;evt.setViewState(extensionInfo.state);evt.setViewInfo(extensionInfo.viewState);this.sandbox.notifyAll(evt,!0)},validStates:{attach:{attach:!0,detach:!1,close:!1,minimize:!1,restore:!1,drawer:!1,sidebar:!1},detach:{attach:!1,detach:!0,close:!1,minimize:!1,restore:!1,drawer:!1,sidebar:!1},minimize:{attach:!0,detach:!0,close:!1,minimize:!0,restore:!1,drawer:!1,sidebar:!1},restore:{attach:!1,detach:!0,close:!1,minimize:!1,restore:!0,drawer:!1,sidebar:!1},close:{attach:!1,detach:!1,close:!0,minimize:!1,restore:!1,drawer:!1,sidebar:!1},drawer:{attach:!1,detach:!1,close:!1,minimize:!1,restore:!1,drawer:!0,sidebar:!1},sidebar:{attach:!1,detach:!1,close:!1,minimize:!1,restore:!1,drawer:!1,sidebar:!0}},defaults:{detach:{left:"212px",top:"50px"},attach:{left:"192px",top:"30px"}},tileTransitions:{attach:{"oskari-tile-attached":!0,"oskari-tile-detached":!1,"oskari-tile-closed":!1},detach:{"oskari-tile-attached":!1,"oskari-tile-detached":!0,"oskari-tile-minimized":!1,"oskari-tile-closed":!1},minimize:{"oskari-tile-minimized":!0,"oskari-tile-closed":!1,"oskari-tile-detached":!1},restore:{"oskari-tile-minimized":!1,"oskari-tile-detached":!0},close:{"oskari-tile-closed":!0,"oskari-tile-attached":!1,"oskari-tile-detached":!1}},flyoutTransitions:{attach:{"oskari-attached":!0,"oskari-detached":!1,"oskari-closed":!1},detach:{"oskari-attached":!1,"oskari-detached":!0,"oskari-closed":!1},minimize:{"oskari-minimized":!0,"oskari-closed":!1,"oskari-detached":!1},restore:{"oskari-minimized":!1,"oskari-closed":!1,"oskari-detached":!0,"oskari-attached":!1},close:{"oskari-closed":!0,"oskari-minimized":!1,"oskari-detached":!1,"oskari-attached":!1}},applyTransition:function(obj,state,transitions){var transition=transitions[state],t;if(transition)for(t in transition)transition.hasOwnProperty(t)&&(transition[t]?obj.addClass(t):obj.removeClass(t))},getFlyoutViewState:function(flyout,state){return{left:flyout.css("left"),top:flyout.css("top"),width:flyout.width(),height:flyout.height(),"z-index":flyout.css("z-index"),viewState:state}},flyoutOps:{detach:function(flyout,flyoutPlugin,extensionInfo){var me=this,viewState;extensionInfo.viewState.left&&extensionInfo.viewState.top&&(extensionInfo.viewState.left!==me.defaults.attach.left||extensionInfo.viewState.top!==me.defaults.attach.top)||(extensionInfo.viewState.left=me.defaults.detach.left,extensionInfo.viewState.top=me.defaults.detach.top);me.shuffleZIndices(flyout);me.applyTransition(flyout,"detach",me.flyoutTransitions);viewState=me.getFlyoutViewState(flyout,"detach");extensionInfo.viewState=viewState},attach:function(flyout,flyoutPlugin,extensionInfo){var me=this,viewState;me.shuffleZIndices(flyout);me.applyTransition(flyout,"attach",me.flyoutTransitions);viewState=me.getFlyoutViewState(flyout,"attach");extensionInfo.viewState=viewState},minimize:function(flyout,flyoutPlugin,extensionInfo){var me=this,viewState=me.getFlyoutViewState(flyout,"minimize");me.applyTransition(flyout,"minimize",me.flyoutTransitions);extensionInfo.viewState=viewState},restore:function(flyout){var me=this;me.applyTransition(flyout,"restore",me.flyoutTransitions)},close:function(flyout,flyoutPlugin,extensionInfo){var me=this;extensionInfo.viewState={viewState:"close"};me.applyTransition(flyout,"close",me.flyoutTransitions)}},viewOps:{view:function(){},close:function(){}},setState:function(state){var me=this,divmanazerState=state,e,extensionInfo,restoredState;if(divmanazerState)for(e in me.extensionsByName)me.extensionsByName.hasOwnProperty(e)&&(extensionInfo=me.extensionsByName[e],restoredState=divmanazerState.extensionStatesByName[e],restoredState&&(extensionInfo.state=restoredState.state,extensionInfo.viewState=restoredState.viewState||{}))},getState:function(){var me=this,divmanazerState,e,extensionInfo;me.refreshExtensionViewStates();divmanazerState={extensionStatesByName:{}};for(e in me.extensionsByName)me.extensionsByName.hasOwnProperty(e)&&(extensionInfo=me.extensionsByName[e],divmanazerState.extensionStatesByName[e]={state:extensionInfo.state,viewState:extensionInfo.viewState});return divmanazerState},applyState:function(){var me=this;me.restoreExtensionViewStates()},refreshExtensionViewStates:function(){var me=this,e,extensionInfo,flyoutInfo,flyout,viewState;for(e in me.extensionsByName)me.extensionsByName.hasOwnProperty(e)&&(extensionInfo=me.extensionsByName[e],flyoutInfo=extensionInfo.plugins["Oskari.userinterface.Flyout"],flyoutInfo&&(flyout=flyoutInfo.el,viewState=me.getFlyoutViewState(flyout,extensionInfo.state),extensionInfo.viewState=viewState))},restoreExtensionViewStates:function(){var me=this,ops=me.flyoutOps,extensions=me.extensions,e,extensionInfo,flyoutInfo,flyoutPlugin,flyout,viewState,op,tileInfo,tile;for(e in me.extensionsByName)me.extensionsByName.hasOwnProperty(e)&&(extensionInfo=me.extensionsByName[e],flyoutInfo=extensionInfo.plugins["Oskari.userinterface.Flyout"],flyoutInfo&&(flyoutPlugin=flyoutInfo.plugin,flyout=flyoutInfo.el,viewState=extensionInfo.viewState,flyout.removeAttr("style"),flyout.css("left",viewState.left),flyout.css("top",viewState.top),flyout.width(viewState.width),flyout.height(viewState.height),flyout.css("z-index",viewState["z-index"]),op=ops[extensionInfo.state],op.apply(me,[flyout,flyoutPlugin,extensionInfo,extensions])),tileInfo=extensionInfo.plugins["Oskari.userinterface.Tile"],tileInfo&&(tile=tileInfo.el,me.applyTransition(tile,extensionInfo.state,me.tileTransitions)))},_toggleMapWindowFullScreen:function(){var me=this,reqBuilder=me.sandbox.getRequestBuilder("MapFull.MapWindowFullScreenRequest");reqBuilder&&me.sandbox.request(me.getName(),reqBuilder())},shuffleZIndices:function(toTop){var me=this,zarray=[],zprops={},zextns={},zflyout={},min=1100,idx,e,extensionInfo,flyoutInfo,flyout,zIndex,n;for(e in me.extensionsByName)me.extensionsByName.hasOwnProperty(e)&&(extensionInfo=me.extensionsByName[e],flyoutInfo=extensionInfo.plugins["Oskari.userinterface.Flyout"],flyoutInfo&&(flyout=flyoutInfo.el,zIndex=flyout.css("z-index"),zarray.push(zIndex),idx=String(zIndex),zprops[idx]=zIndex,zflyout[idx]=flyout,zextns[idx]=extensionInfo));for(zarray.sort(),n=0;n<zarray.length;n+=1)idx=zarray[n],zprops[idx]=min+n,zflyout[idx].css("z-index",zprops[zarray[n]]);toTop.css("z-index",min+zarray.length+2)},ieFixClasses:[{min:400,max:599,cls:"oskari-flyoutcontentcontainer_IE_400_599"},{min:600,max:799,cls:"oskari-flyoutcontentcontainer_IE_600_799"},{min:800,max:999,cls:"oskari-flyoutcontentcontainer_IE_800_999"},{min:1e3,max:1199,cls:"oskari-flyoutcontentcontainer_IE_1000_1199"},{min:1200,max:1399,cls:"oskari-flyoutcontentcontainer_IE_1200_1399"},{min:1400,max:9999,cls:"oskari-flyoutcontentcontainer_IE_1400"}]},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Stateful"]});Oskari.clazz.define("Oskari.userinterface.request.AddExtensionRequest",function(extension){this._extension=extension},{__name:"userinterface.AddExtensionRequest",getName:function(){return this.__name},getExtension:function(){return this._extension}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.userinterface.bundle.ui.request.AddExtensionRequestHandler",function(ui){this.ui=ui},{handleRequest:function(core,request){var extension=request.getExtension();this.ui.addExtension(extension)}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.userinterface.request.RemoveExtensionRequest",function(extension){this._extension=extension},{__name:"userinterface.RemoveExtensionRequest",getName:function(){return this.__name},getExtension:function(){return this._extension}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.userinterface.bundle.ui.request.RemoveExtensionRequestHandler",function(ui){this.ui=ui},{handleRequest:function(core,request){var extension=request.getExtension();this.ui.removeExtension(extension)}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.userinterface.request.UpdateExtensionRequest",function(extension,state,extensionName,extensionTop,extensionLeft){this._extension=extension;this._state=state;this._extensionName=extensionName;this._location={};this._location.top=extensionTop;this._location.left=extensionLeft},{__name:"userinterface.UpdateExtensionRequest",getName:function(){return this.__name},getExtension:function(){return this._extension},getState:function(){return this._state},getExtensionName:function(){return this._extensionName},getExtensionLocation:function(){return this._location}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.userinterface.bundle.ui.request.UpdateExtensionRequestHandler",function(ui){this.ui=ui},{handleRequest:function(core,request){var extension=request.getExtension(),extensionName=request.getExtensionName(),extensionInfo;if(!extension&&extensionName&&extensionName!="*"){if(extensionInfo=this.ui.getExtensionByName(extensionName),!extensionInfo)return;extension=extensionInfo.extension}this.ui.updateExtension(extension,request)}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.userinterface.request.ModalDialogRequest",function(title,message,buttons,onshow){this._title=title?title:"Untitled";this._message=message?message:"Lorem ipsum";this._buttons=buttons?buttons:{};this._parent=parent?parent:jQuery("#mapdiv");this._onshow=onshow?onshow:null},{__name:"userinterface.ModalDialogRequest",getName:function(){return this.__name},getTitle:function(){return this._title},getMessage:function(){return this._message},getButtons:function(){return this._buttons},getGeom:function(){return this._geom},getParent:function(){return this._parent},getOnShow:function(){return this._onshow}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.userinterface.bundle.ui.request.ModalDialogRequestHandler",function(ui){this._ui=ui;this._tpl={};this._tpl.modal=jQuery('<div id="modaldialog" class="modaldialog">  <div class="modaltitle"><\/div>  <div class="modalmessage"><\/div>  <div class="modalbuttons"><\/div> <\/div>');this._tpl.button=jQuery('<div class="modalbutton"><input type="button" /><\/input><\/div>');this._buttons={};this._args={closeClass:"modalclose",overlayId:"modaloverlay",overlayCss:{"background-color":"lightgrey",cursor:"wait"},containerId:"modalcontainer",containerCss:{"background-color":"white"},onClose:function(){this.close()},zIndex:80130}},{handleRequest:function(core,request){var tpl=this._tpl.modal.clone(),btns,buttondiv,bidx;tpl.find(".modaltitle").append(request.getTitle());tpl.find(".modalmessage").append(request.getMessage());btns=request.getButtons();buttondiv=tpl.find(".modalbuttons");for(bidx in btns)if(btns[bidx].name){var btn=btns[bidx],bcont=this._tpl.button.clone(),button=bcont.find("input");button.attr("name",btn.name);button.attr("text",btn.text);button.attr("value",btn.text);button.bind("click",btn.onclick);btn.close!==!1&&button.addClass(this._args.closeClass);buttondiv.append(bcont)}request.onshow&&(this._args.onShow=onshow);$.modal=tpl.modal(this._args)}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.userinterface.event.ExtensionUpdatedEvent",function(extension,viewstate,viewinfo){this._creator=null;this._extension=extension;this.viewstate=viewstate;this.viewinfo=viewinfo},{__name:"userinterface.ExtensionUpdatedEvent",getName:function(){return this.__name},getExtension:function(){return this._extension},getViewState:function(){return this.viewstate},setViewState:function(viewstate){this.viewstate=viewstate},getViewInfo:function(){return this.viewinfo},setViewInfo:function(viewinfo){this.viewinfo=viewinfo}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.userinterface.component.Accordion",function(){this.template=jQuery('<div class="accordion"><\/div>');this.templateMsg=jQuery('<div class="accordionmsg"><\/div>');this.panels=[];this.ui=this.template.clone()},{addPanel:function(panel){this.removeMessage();this.panels.push(panel);panel.insertTo(this.ui)},removePanel:function(pPanel){for(var panel=null,i=0;i<this.panels.length;i+=1)if(this.panels[i]===pPanel){panel=this.panels[i];this.panels.splice(i,1);break}return panel?(panel.destroy(),!0):!1},removeAllPanels:function(){this.ui.empty();this.panels=[]},removeMessage:function(){var msgContainer=this.ui.find("div.accordionmsg");msgContainer.length>0&&msgContainer.remove()},showMessage:function(message){this.removeMessage();var msgContainer=this.templateMsg.clone();msgContainer.append(message);this.ui.append(msgContainer)},showPanels:function(){for(var i=0,i=0;i<this.panels.length;i+=1)this.panels[i].setVisible(!0)},hidePanels:function(){for(var i=0,i=0;i<this.panels.length;i+=1)this.panels[i].setVisible(!1)},insertTo:function(container){container.append(this.ui)},getContainer:function(){return this.ui}});Oskari.clazz.define("Oskari.userinterface.component.AccordionPanel",function(){this.template=jQuery('<div class="accordion_panel"><div class="header"><div class="headerIcon icon-arrow-right"><\/div><div class="headerText"><\/div><\/div><div class="content"><\/div><\/div>');this.title=null;this.content=null;this.html=this.template.clone();var me=this,header=me.html.find("div.header");header.click(function(){me.isOpen()?me.close():me.open()});this.html.find("div.content").hide()},{setVisible:function(bln){bln===!0?this.html.show():this.html.hide()},isVisible:function(){return this.html.is(":visible")},isOpen:function(){return this.html.hasClass("open")},open:function(){this.html.addClass("open");var header=this.html.find("div.header div.headerIcon");header.removeClass("icon-arrow-right");header.addClass("icon-arrow-down");this.html.find("div.content").show()},close:function(){this.html.removeClass("open");var header=this.html.find("div.header div.headerIcon");header.removeClass("icon-arrow-down");header.addClass("icon-arrow-right");this.html.find("div.content").hide()},setTitle:function(pTitle){this.title=pTitle;var header=this.html.find("div.header div.headerText");header.html(this.title)},getTitle:function(){return this.title},setContent:function(pContent){this.content=pContent;var content=this.html.find("div.content");content.append(this.content)},destroy:function(){this.html.remove()},getContainer:function(){return this.html.find("div.content")},insertTo:function(container){container.append(this.html)}});Oskari.clazz.define("Oskari.userinterface.component.TabContainer",function(pEmptyMsg){this.panels=[];this.tabChangeListeners=[];this.emptyMsg=pEmptyMsg?pEmptyMsg:"No content";this.template=jQuery('<div class="oskariTabs">'+this.emptyMsg+"<\/div>");this.templateTabs=jQuery('<div class="tabsHeader"><ul class="tabsItem"><\/ul><\/div><br clear="all"/><div class="tabsContent tabsContentItem"><\/div>');this.ui=this.template.clone()},{addPanel:function(panel,first){var me=this,content,headerContainer,header,link,index;for(this.panels.length===0?(content=this.templateTabs.clone(),this.ui.html(content),typeof panel.getPriority()!="number"&&panel.setPriority(1)):first?panel.setPriority(this.panels[0].getPriority()-1):typeof panel.getPriority()!="number"&&panel.setPriority(this.panels[this.panels.lenght-1].getPriority()+1),index=0;index<this.panels.length;){if(panel.getPriority()<this.panels[index].getPriority())break;index=index+1}headerContainer=this.ui.find("ul.tabsItem");header=panel.getHeader();index===0?(headerContainer.prepend(header),this.select(panel)):headerContainer.children().eq(index-1).after(header);panel.insertAt(this.ui.find("div.tabsContentItem"),index);this.panels.splice(index,0,panel);this.panels.length===1&&this.select(panel);link=header.find("a");link.bind("click",function(){return me.select(panel),!1})},addTabChangeListener:function(pCallback){this.tabChangeListeners.push(pCallback)},select:function(panel){for(var previousPanel=null,headerContainer,tabs,i=0;i<this.panels.length;i+=1)if(this.isSelected(this.panels[i])){previousPanel=this.panels[i];previousPanel.handleSelection(!1);break}for(headerContainer=this.ui.find("ul"),headerContainer.find("li").removeClass("active"),tabs=this.ui.children().children("div.tab-content"),tabs.hide(),panel.getHeader().addClass("active"),panel.getContainer().show(),panel.handleSelection(!0),i=0;i<this.tabChangeListeners.length;i+=1)this.tabChangeListeners[i](previousPanel,panel)},isSelected:function(panel){return panel.getHeader().hasClass("active")},removePanel:function(pPanel){for(var panel=null,i=0;i<this.panels.length;i+=1)if(this.panels[i]===pPanel){panel=this.panels[i];this.panels.splice(i,1);break}if(this.panels.length===0)for(this.ui.html(this.emptyMsg),i=0;i<this.tabChangeListeners.length;i+=1)this.tabChangeListeners[i](pPanel);else this.select(this.panels[0]);return panel?(panel.destroy(),!0):!1},insertTo:function(container){container.append(this.ui)}});Oskari.clazz.define("Oskari.userinterface.component.TabDropdownContainer",function(pEmptyMsg,button){this.button=button;this.panels=[];this.tabChangeListeners=[];this.emptyMsg=pEmptyMsg?pEmptyMsg:"No content";this.template=jQuery('<div class="oskariTabs">'+this.emptyMsg+"<\/div>");this.templateTabOption=jQuery("<option><\/option>");this.templateTabs=jQuery('<div class="tabsHeader"><ul><li><select name="tabs"><\/select><\/li><\/ul><\/div><br clear="all"/><div class="tabsContent"><\/div>');this.ui=this.template.clone()},{addPanel:function(panel){var me=this,content,headerContainer,header;this.panels.length===0&&(content=this.templateTabs.clone(),me.ui.html(content),me.button&&me.button.insertTo&&me.button.insertTo(me.ui.find("li")));headerContainer=this.ui.find("ul li select");header=this.templateTabOption.clone();header.attr("id","layer-id-"+panel.getId());header.append(panel.getTitle());headerContainer.append(header);panel.setHeader(header);panel.insertTo(this.ui.find("div.tabsContent"));this.panels.push(panel);this.panels.length===1&&(this.select(panel),headerContainer.bind("change",function(){me.select(me.panels[this.selectedIndex])}))},updatePanel:function(panel){for(var me=this,headerContainer=me.ui.find("ul li select"),header,i=0;i<headerContainer.find("option").length;i++)header=jQuery(headerContainer.find("option")[i]),header.attr("id")==="layer-id-"+panel.getId()&&header.html(panel.getTitle())},addTabChangeListener:function(pCallback){this.tabChangeListeners.push(pCallback)},select:function(panel){var previousPanel=null,i,tabs,headerContainer,options,panelIndex;if(this.tabChangeListeners.length>0)for(i=0;i<this.panels.length;i++)if(this.isSelected(this.panels[i])){previousPanel=this.panels[i];break}for(tabs=this.ui.children().children("div.tab-content"),tabs.hide(),headerContainer=this.ui.find("ul li select"),options=headerContainer.find("option"),options.removeAttr("selected"),panelIndex=this._getPanelIndex(panel),jQuery(options[panelIndex]).attr("selected","selected"),panel.getContainer().show(),i=0;i<this.tabChangeListeners.length;i++)this.tabChangeListeners[i](previousPanel,panel)},isSelected:function(panel){var headerContainer=this.ui.find("ul li select :selected");return headerContainer.index()===this._getPanelIndex(panel)},_getPanelIndex:function(panel){for(var i=0;i<this.panels.length;i++)if(this.panels[i].getId()===panel.getId())return i;return-1},removePanel:function(pPanel){for(var panel=null,header,headerContainer,i=0;i<this.panels.length;i++)if(this.panels[i].getId()===pPanel.getId()){panel=this.panels[i];this.panels.splice(i,1);break}for(headerContainer=this.ui.find("ul li select :selected"),i=0;i<headerContainer.length;i++)header=jQuery(headerContainer[i]),header.attr("id")==="layer-id-"+panel.getId()&&header.remove();if(this.panels.length===0)for(this.ui.html(this.emptyMsg),i=0;i<this.tabChangeListeners.length;i++)this.tabChangeListeners[i](pPanel);else this.select(this.panels[0]);return panel?(panel.destroy(),!0):!1},insertTo:function(container){container.append(this.ui)}});Oskari.clazz.define("Oskari.userinterface.component.TabPanel",function(){this.template=jQuery('<div class="tab-content"><\/div>');this.templateTabHeader=jQuery('<li><a href="JavaScript:void(0);"><\/a><\/li>');this.id=null;this.title=null;this.content=null;this.header=null;this.selectionHandler=null;this.priority=1;this.html=this.template.clone();this.html.hide()},{setId:function(pId){this.id=pId},getId:function(){return this.id},setPriority:function(priority){this.priority=priority},getPriority:function(){return this.priority},setTitle:function(pTitle){var header,link;this.title=pTitle;header=this.templateTabHeader.clone();this.header=header;link=header.find("a");link.html(this.getTitle())},getTitle:function(){return this.title},setHeader:function(reference){this.header=reference},getHeader:function(){return this.header},setContent:function(pContent){this.content=pContent;this.html.html(this.content)},destroy:function(){this.header.remove();this.html.remove()},getContainer:function(){return this.html},setSelectionHandler:function(pHandler){this.selectionHandler=pHandler},handleSelection:function(isSelected){this.selectionHandler&&this.selectionHandler(isSelected===!0)},insertTo:function(container){container.append(this.html)},insertAt:function(container,index){index===0?container.prepend(this.html[0]):container.children().eq(index-1).after(this.html[0])}});Oskari.clazz.define("Oskari.userinterface.component.Badge",function(){this.compiledTemplates={};this.compileTemplates();this.ui=null;this.container=null},{templates:{"default":'<span class="oskari-badge"><\/span>',success:'<span class="oskari-badge oskari-badge-success"><\/span>',warning:'<span class="oskari-badge oskari-badge-warning"><\/span>',important:'<span class="oskari-badge oskari-badge-important"><\/span>',info:'<span class="oskari-badge oskari-badge-info"><\/span>',inverse:'<span class="oskari-badge oskari-badge-inverse"><\/span>'},compileTemplates:function(){for(var p in this.templates)this.templates.hasOwnProperty(p)&&(this.compiledTemplates[p]=jQuery(this.templates[p]))},insertTo:function(container){this.container=container},setContent:function(pContent,status){this.ui&&(this.ui.remove(),this.ui=null);var txtspan=this.compiledTemplates[status||"default"].clone();txtspan.append(pContent);this.container.append(txtspan);this.ui=txtspan},hide:function(){this.ui&&(this.ui.remove(),this.ui=null)}});Oskari.clazz.define("Oskari.userinterface.component.Alert",function(){this.compiledTemplates={};this.compileTemplates();this.ui=null;this.container=null},{templates:{"default":'<div class="oskari-alert"><div class="oskari-alert-icon-close"><div class="icon-close"><\/div><\/div><\/div>',success:'<div class="oskari-alert oskari-alert-success"><div class="oskari-alert-icon-close"><div class="icon-close"><\/div><\/div><\/div>',error:'<div class="oskari-alert oskari-alert-error"><div class="oskari-alert-icon-close"><div class="icon-close"><\/div><\/div><\/div>',info:'<div class="oskari-alert oskari-alert-info"><div class="oskari-alert-icon-close"><div class="icon-close"><\/div><\/div><\/div>'},compileTemplates:function(){for(var p in this.templates)this.templates.hasOwnProperty(p)&&(this.compiledTemplates[p]=jQuery(this.templates[p]))},insertTo:function(container){this.container=container},setContent:function(pContent,status,excludeCloseButton){this.ui&&(this.ui.remove(),this.ui=null);var me=this,txtdiv=me.compiledTemplates[status||"default"].clone(),includeCloseButton=!excludeCloseButton;txtdiv.append(pContent);me.container.prepend(txtdiv);me.ui=txtdiv;includeCloseButton?txtdiv.children(".oskari-alert-icon-close").click(function(){me.hide()}):txtdiv.children(".oskari-alert-icon-close").remove()},hide:function(){this.ui&&(this.ui.remove(),this.ui=null)}});Oskari.clazz.define("Oskari.userinterface.component.Popup",function(){this.template=jQuery('<div class="divmanazerpopup"><h3 class="popupHeader"><\/h3><div class="content"><\/div><div class="actions"><\/div><\/div>');this.templateButton=jQuery('<div class="button"><a href="JavaScript:void(0);"><\/a><\/div>');this.dialog=this.template.clone();this.overlay=null},{show:function(title,message,buttons){var me=this,contentDiv=this.dialog.find("div.content"),actionDiv,i,contentHeight,reasonableHeight;if(this.dialog.find("h3").html(title),contentDiv.html(message),buttons&&buttons.length>0)for(actionDiv=this.dialog.find("div.actions"),actionDiv.empty(),i=0;i<buttons.length;i+=1)buttons[i].insertTo(actionDiv);else this.dialog.bind("click",function(){me.close(!0)});jQuery("body").append(this.dialog);contentHeight=contentDiv.height();reasonableHeight=jQuery(document).height()*.6;contentHeight>reasonableHeight&&(contentDiv.height(reasonableHeight),contentDiv.css("overflow-y","auto"));this.dialog.css("margin-left",-(this.dialog.width()/2)+"px");this.dialog.css("margin-top",-(this.dialog.height()/2)+"px")},fadeout:function(timeout){var me=this,timer=3e3;timeout&&(timer=timeout);setTimeout(function(){me.close()},timer)},addClass:function(pClass){this.dialog.addClass(pClass)},createCloseButton:function(label){var me=this,okBtn=Oskari.clazz.create("Oskari.userinterface.component.Button");return okBtn.setTitle(label),okBtn.setHandler(function(){me.close(!0)}),okBtn},close:function(noAnimation){var me=this;this.overlay&&this.overlay.close();this.hasKeydownListener&&jQuery(this.dialog).off("keydown",this._stopKeydownPropagation);noAnimation?me.dialog.remove():(me.dialog.animate({opacity:0},500),setTimeout(function(){me.dialog.remove()},500))},alignment:["left","right","top","bottom"],moveTo:function(target,alignment){var me=this,align="right",tar=jQuery(target),pos=tar.offset();if(tar&&tar.length!==0&&pos){var targetWidth=tar.outerWidth(),targetHeight=tar.outerHeight(),dialogWidth=me.dialog.outerWidth(),dialogHeight=me.dialog.outerHeight(),left=pos.left,top=pos.top;alignment&&jQuery.inArray(alignment,this.alignment)!==-1&&(align=alignment);align==="right"?(left=left+targetWidth+5,top=top+targetHeight/2-dialogHeight/2):align==="left"?(left=left-dialogWidth-5,top=top+targetHeight/2-dialogHeight/2):align==="top"?(top=top-dialogHeight-5,left=left+targetWidth/2-dialogWidth/2):align==="bottom"&&(top=top+targetHeight+5,left=left+targetWidth/2-dialogWidth/2);left<0&&(left=0);top<0&&(top=0);me.dialog.addClass("arrow");me.dialog.addClass(alignment);me.dialog.css({left:left+"px",top:top+"px","margin-left":0,"margin-top":0})}},resetPosition:function(){var i;for(this.dialog.removeClass("arrow"),i=0;i<this.alignment.length;i+=1)this.dialog.removeClass(this.alignment[i]);this.dialog.removeAttr("style")},makeModal:function(){var overlay=Oskari.clazz.create("Oskari.userinterface.component.Overlay");overlay.overlay("body");this.overlay=overlay;overlay.followResizing(!0)},stopKeydownPropagation:function(){jQuery(this.dialog).keydown(this._stopKeydownPropagation);this.hasKeydownListener=!0},_stopKeydownPropagation:function(e){e.stopPropagation()},setContent:function(content){var contentEl=this.dialog.find("div.content");contentEl.empty();contentEl.append(content)},getContent:function(){return this.dialog.find("div.content")[0].textContent},getJqueryContent:function(){return this.dialog.find("div.content")},makeDraggable:function(){var me=this;me.dialog.css("position","absolute");me.dialog.draggable({scroll:!1})}});Oskari.clazz.define("Oskari.userinterface.component.Overlay",function(){this.template=jQuery('<div class="oskarioverlay transparent"><\/div>');this._overlays=null;this._resizingWorkaround=null},{overlay:function(elementSelector){var me=this,targetSelector=elementSelector,targets;targetSelector||(targetSelector="body");targets=jQuery(targetSelector);me._overlays=_.map(targets,function(target){return{overlay:me.template.clone(),target:jQuery(target)}});_.forEach(me._overlays,function(overlay){overlay.target.append(overlay.overlay)});me._setupSizeAndLocation();_.forEach(me._overlays,function(overlay){overlay.overlay.bind("click",function(event){event.preventDefault()})})},_setupSizeAndLocation:function(){var me=this;_.forEach(me._overlays,function(overlay){overlay.overlay.css({left:"0px",top:"0px",width:overlay.target.width()+"px",height:overlay.target.height()+"px"})})},resize:function(){var me=this;_.forEach(me._overlays,function(overlay){overlay.overlay.height(overlay.target.height());overlay.overlay.width(overlay.target.width())})},followResizing:function(useWindow){var me=this;useWindow?jQuery(window).resize(function(){me.resize()}):this._resizingWorkaround=setTimeout(function(){me.resize();me.followResizing()},500)},close:function(){var me=this;_.forEach(me._overlays,function(overlay){overlay.overlay.remove()});this._resizingWorkaround&&clearTimeout(this._resizingWorkaround)},bindClickToClose:function(){var me=this;_.forEach(me._overlays,function(overlay){overlay.overlay.bind("click",function(){me.close()})})}});Oskari.clazz.define("Oskari.userinterface.component.Button",function(){this.template=jQuery('<input type="button"/>');this.title=null;this.ui=this.template.clone();this.handler=null},{setTitle:function(pTitle){this.title=pTitle;this.ui&&this.ui.attr("value",pTitle)},addClass:function(pClass){this.ui.addClass(pClass)},setEnabled:function(blnEnabled){blnEnabled===!0?this.ui.removeAttr("disabled"):this.ui.attr("disabled","disabled")},getTitle:function(){return this.title},setHandler:function(pHandler){this.handler&&this.ui.unbind("click",this.handler);this.handler=pHandler;this.ui.bind("click",this.handler)},destroy:function(){this.ui.remove()},insertTo:function(container){container.append(this.ui)},getButton:function(){return this.ui}});Oskari.clazz.define("Oskari.userinterface.component.Form",function(){this.template=jQuery('<div class="oskariform"><\/div>');this._form=this.template.clone();this.fields=[]},{addField:function(field){this.fields.push(field)},getForm:function(){var i;for(this._form=this.template.clone(),i=0;i<this.fields.length;i+=1)this._form.append(this.fields[i].getField());return this._form},validate:function(){for(var errors=[],i=0;i<this.fields.length;i+=1)errors=errors.concat(this.fields[i].validate());return errors},showErrors:function(){for(var errors,i=0;i<this.fields.length;i+=1)errors=this.fields[i].validate(),this.fields[i].showErrors(errors)},clearErrors:function(){for(var i=0;i<this.fields.length;i+=1)this.fields[i].clearErrors()}});Oskari.clazz.define("Oskari.userinterface.component.UIHelper",function(sandbox){this.sandbox=sandbox},{processHelpLinks:function(title,content,errorTitle,errorMsg){if(content){var me=this,getCallback;getCallback=function(btn){return function(isSuccess,pContent){var dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup"),okBtn=dialog.createCloseButton("OK");okBtn.addClass("primary");isSuccess?(dialog.show(title,pContent.static,[okBtn]),dialog.moveTo(btn,"bottom")):dialog.show(errorTitle,errorMsg,[okBtn])}};content.find("[helptags]").each(function(i,e){var btn=jQuery(e),taglist=btn.attr("helptags");btn.bind("click",function(){me.getHelpArticle(taglist,getCallback(btn))})})}},getHelpArticle:function(taglist,callback){var me=this;jQuery.ajax({url:me.sandbox.getAjaxUrl()+"action_route=GetArticlesByTag",data:{tags:taglist},type:"GET",dataType:"json",beforeSend:function(x){x&&x.overrideMimeType&&x.overrideMimeType("application/j-son;charset=UTF-8")},success:function(resp){resp&&resp.articles[0]&&resp.articles[0].content?callback(!0,resp.articles[0].content):callback(!1)},error:function(){callback(!1)}})}});Oskari.clazz.define("Oskari.userinterface.component.FormInput",function(name,psandbox){var sandbox=psandbox||Oskari.getSandbox(),label,input;this.sandbox=sandbox;this.template=jQuery('<div class="oskarifield"><label><\/label><input type="text" autofocus/><\/div>');this.templateErrors=jQuery('<div class="error"><\/div>');this.templateTooltip=jQuery('<div class="icon-info"><\/div>');this.templateClearButton=jQuery('<div class="icon-close"><\/div>');this._field=this.template.clone();label=this._field.find("label");label.attr("for",name);input=this._field.find("input").focus();input.attr("name",name);this._name=name;this._validator=null;this._required=!1;this._requiredMsg="required";this._contentCheck=!1;this._contentCheckMsg="illegal characters";this._bindFocusAndBlur();this._regExp=/[\s\w\d\.\,\?\!\-]*/;this._colorRegExp=/^([A-Fa-f0-9]{6})$/},{setLabel:function(pLabel){var label=this._field.find("label");label.html(pLabel)},setTooltip:function(pTooltip,pDataTags){var tooltip=this.templateTooltip.clone(),label;tooltip.attr("title",pTooltip);pDataTags&&(tooltip.addClass("help"),tooltip.attr("helptags",pDataTags));label=this._field.find("label");label.before(tooltip)},setPlaceholder:function(pLabel){var input=this._field.find("input");input.attr("placeholder",pLabel)},setRequired:function(blnParam,reqMsg){this._required=blnParam===!0;reqMsg&&(this._requiredMsg=reqMsg)},setContentCheck:function(blnParam,errorMsg,regexp){this._contentCheck=blnParam===!0;regexp&&(this._regExp=regexp);errorMsg&&(this._contentCheckMsg=errorMsg)},showErrors:function(errors){this.clearErrors();for(var errorDiv=this.templateErrors.clone(),i=0;i<errors.length;i+=1)errorDiv.append(errors[i].error+"<br/>");this._field.append(errorDiv)},clearErrors:function(){var errors=this._field.find("div.error");errors.remove()},getField:function(){return this._field},getValue:function(blnFilteredValue){var value=this._field.find("input").val();return blnFilteredValue&&(value=value.match(this._regExp)),String(value)},setValue:function(value){this._field.find("input").attr("value",value)},getName:function(){return this._name},setEnabled:function(blnEnabled){blnEnabled===!0?this._field.find("input").removeAttr("disabled"):this._field.find("input").attr("disabled","disabled")},setRegExp:function(regex){this._regExp=regex},setValidator:function(pValidator){this._validator=pValidator},validate:function(){var errors=[],value;return this._validator&&(errors=this._validator(this)),value=this.getValue(),this._required&&(this.checkLength(value,1)||errors.push({field:this.getName(),error:this._requiredMsg})),this._contentCheck&&(this.checkValue()||errors.push({field:this.getName(),error:this._contentCheckMsg})),errors},checkLength:function(pStr,min,max){if(pStr){var str=jQuery.trim(pStr.toString());return min&&str.length<min?!1:max&&str.length>max?!1:!0}return!1},checkValue:function(){var value=this.getValue(),filtered=this.getValue(!0);return value===filtered},validateNumberRange:function(value,min,max){return isNaN(parseInt(value,10))?!1:isFinite(value)?value<min||value>max?!1:!0:!1},validateHexColor:function(value){return this._colorRegExp.test(value)},bindEnterKey:function(callback){var me=this,input=this._field.find("input");input.keypress(function(event){me._isEnterPress(event)&&callback(event)})},bindUpKey:function(callback){"use strict";var me=this,input=this._field.find("input");input.keydown(function(event){me._isUpPress(event)&&(event.preventDefault(),callback(event))})},bindDownKey:function(callback){"use strict";var me=this,input=this._field.find("input");input.keydown(function(event){me._isDownPress(event)&&(event.preventDefault(),callback(event))})},bindOnBlur:function(callback){"use strict";var input=this._field.find("input");input.blur(function(){callback()})},bindChange:function(callback,blnImmediate){var input=this._field.find("input");if(blnImmediate)input.keyup(callback);else input.on("change",callback)},addClearButton:function(){var clearButton=this.templateClearButton.clone(),input=this._field.find("input");clearButton.bind("click",function(){input.val("");input.trigger("change");input.trigger("keyup")});input.after(clearButton)},_bindFocusAndBlur:function(){var sandbox=this.sandbox,enabler,disabler,input;sandbox&&(enabler=sandbox.getRequestBuilder("EnableMapKeyboardMovementRequest"),disabler=sandbox.getRequestBuilder("DisableMapKeyboardMovementRequest"),enabler&&disabler)&&(input=this._field.find("input"),input.focus(function(){sandbox.postRequestByName("DisableMapKeyboardMovementRequest")}),input.blur(function(){sandbox.postRequestByName("EnableMapKeyboardMovementRequest")}))},_isEnterPress:function(event){var keycode=event.which;return keycode===13},_isDownPress:function(event){var keycode=event.which;return keycode===40},_isUpPress:function(event){var keycode=event.which;return keycode===38}});!function($){var Tooltip=function(element,options){this.init("oskariTooltip",element,options)},Popover=function(element,options){this.init("oskariPopover",element,options)};Tooltip.prototype={constructor:Tooltip,init:function(type,element,options){var eventIn,eventOut;if(this.type=type,this.$element=$(element),this.options=this.getOptions(options),this.enabled=!0,this.options.trigger!=="manual"){eventIn=this.options.trigger==="hover"?"mouseenter":"focus";eventOut=this.options.trigger==="hover"?"mouseleave":"blur";this.$element.on(eventIn,this.options.selector,$.proxy(this.enter,this));this.$element.on(eventOut,this.options.selector,$.proxy(this.leave,this))}this.options.selector?this._options=$.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(options){return options=$.extend({},$.fn[this.type].defaults,options,this.$element.data()),options.delay&&typeof options.delay=="number"&&(options.delay={show:options.delay,hide:options.delay}),options},enter:function(e){var self=$(e.currentTarget)[this.type](this._options).data(this.type);if(!self.options.delay||!self.options.delay.show)return self.show();clearTimeout(this.timeout);self.hoverState="in";this.timeout=setTimeout(function(){self.hoverState==="in"&&self.show()},self.options.delay.show)},leave:function(e){var self=$(e.currentTarget)[this.type](this._options).data(this.type);if(!self.options.delay||!self.options.delay.hide)return self.hide();clearTimeout(this.timeout);self.hoverState="out";this.timeout=setTimeout(function(){self.hoverState==="out"&&self.hide()},self.options.delay.hide)},show:function(){var $tip,inside,pos,actualWidth,actualHeight,placement,tp;if(this.hasContent()&&this.enabled){$tip=this.tip();this.setContent();this.options.animation&&$tip.addClass("fade");placement=this.options.placement.apply(this.options.scope);inside=/in/.test(placement);$tip.remove().css({top:0,left:0,display:"block"}).appendTo(inside?this.$element:document.body);pos=this.getPosition(inside);actualWidth=$tip[0].offsetWidth;actualHeight=$tip[0].offsetHeight;switch(inside?placement.split(" ")[1]:placement){case"bottom":tp={top:pos.top+pos.height,left:pos.left+pos.width/2-actualWidth/2};break;case"top":tp={top:pos.top-actualHeight,left:pos.left+pos.width/2-actualWidth/2};break;case"left":tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth};break;case"right":tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width}}$tip.css(tp).addClass(placement).addClass("in")}},isHTML:function(text){return typeof text!="string"||text.charAt(0)==="<"&&text.charAt(text.length-1)===">"&&text.length>=3||/^(?:[^<]*<[\w\W]+>[^>]*$)/.exec(text)},setContent:function(){var $tip=this.tip(),title=this.getTitle();$tip.find(".oskari-tooltip-inner")[this.isHTML(title)?"html":"text"](title);$tip.removeClass("fade in top bottom left right")},hide:function(){function removeWithAnimation(){var timeout=setTimeout(function(){$tip.off($.support.transition.end).remove()},500);$tip.one($.support.transition.end,function(){clearTimeout(timeout);$tip.remove()})}var $tip=this.tip();$tip.removeClass("in");$.support.transition&&this.$tip.hasClass("fade")?removeWithAnimation():$tip.remove()},fixTitle:function(){var $e=this.$element;($e.attr("title")||typeof $e.attr("data-original-title")!="string")&&$e.attr("data-original-title",$e.attr("title")||"").removeAttr("title")},hasContent:function(){return this.getTitle()},getPosition:function(inside){return $.extend({},inside?{top:0,left:0}:this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){return this.options.title.apply(this.options.scope)},tip:function(){return this.$tip=this.$tip||$(this.options.template)},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()},attach:function($el){this.$element=$el}};$.fn.oskariTooltip=function(option){return this.each(function(){var $this=$(this),data=$this.data("oskariTooltip"),options=typeof option=="object"&&option;data||$this.data("oskariTooltip",data=new Tooltip(this,options));typeof option=="string"&&data[option]()})};$.fn.oskariTooltip.Constructor=Tooltip;$.fn.oskariTooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="oskari-tooltip"><div class="oskari-tooltip-arrow"><\/div><div class="oskari-tooltip-inner"><\/div><\/div>',trigger:"hover",title:"",delay:0};Popover.prototype=$.extend({},$.fn.oskariTooltip.Constructor.prototype,{constructor:Popover,setContent:function(){var $tip=this.tip(),title=this.getTitle(),content=this.getContent();$tip.find(".oskari-popover-title")[this.isHTML(title)?"html":"text"](title);$tip.find(".oskari-popover-content > *")[this.isHTML(content)?"html":"text"](content);$tip.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){return this.options.content.apply(this.options.scope)},tip:function(){return this.$tip||(this.$tip=$(this.options.template)),this.$tip}});$.fn.oskariPopover=function(option){return this.each(function(){var $this=$(this),data=$this.data("oskariPopover"),options=typeof option=="object"&&option;data||$this.data("oskariPopover",data=new Popover(this,options));typeof option=="string"&&data[option]()})};$.fn.oskariPopover.Constructor=Popover;$.fn.oskariPopover.defaults=$.extend({},$.fn.oskariTooltip.defaults,{placement:"right",content:"",template:'<div class="oskari-popover"><div class="oskari-arrow"><\/div><div class="oskari-popover-inner"><h3 class="oskari-popover-title"><\/h3><div class="oskari-popover-content"><p><\/p><\/div><\/div><\/div>'});Oskari.clazz.define("Oskari.userinterface.component.Popover",function(title,content){this.title=title;this.content=content;this.$container=null;this.data=null;this.shown=!1;this.placement="bottom"},{templates:{container:'<div class="oskari-popover-container"/>'},hide:function(){this.shown&&(this.shown=!1,this.data)&&this.data.hide()},show:function(){this.shown||this.data&&(this.data.show(),this.shown=!0)},attachTo:function(element){var me=this;me.$container=$(element);me.data?me.data.attach(me.$container):me.data=new Popover(element,{scope:me,title:me.getTitle,content:me.getContent,trigger:"manual",placement:me.getPlacement});me.$container.data("oskariPopover",me.data)},getTitle:function(){return this.title},getContent:function(){return this.content},setContent:function(content,title){var me=this;me.hide();me.content=content;title&&(me.title=title);me.show()},setTitle:function(title,content){var me=this;me.hide();me.title=title;content&&(me.content=content);me.show()},setPlacement:function(p){this.placement=p},getPlacement:function(){return this.placement}})}(window.jQuery);Oskari.clazz.define("Oskari.userinterface.component.Grid",function(columnSelectorTooltip){this.model=null;var columnSelectorButtonTitle="";columnSelectorTooltip!==null&&columnSelectorTooltip!==undefined&&(columnSelectorButtonTitle=columnSelectorTooltip);this.template=jQuery('<table class="oskari-grid"><thead><tr><\/tr><\/thead><tbody><\/tbody><\/table>');this.templateTableHeader=jQuery('<th><a href="JavaScript:void(0);"><\/a><\/th>');this.templateDiv=jQuery("<div><\/div>");this.templateRow=jQuery("<tr><\/tr>");this.templateCell=jQuery("<td><\/td>");this.templatePopupLink=jQuery('<a href="JavaScript: void(0);"><\/a>');this.templateColumnSelectorButtonWrapper=jQuery("<div/>",{});this.templateColumnSelectorButton=jQuery("<div/>",{title:columnSelectorButtonTitle});this.templateColumnSelector=jQuery("<div/>",{});this.templateColumnSelectorList=jQuery("<ul/>",{});this.templateColumnSelectorListItem=jQuery('<li><div><input type="checkbox"/><label><\/label><\/div><\/li>');this.templateColumnSelectorClose=jQuery('<div class="icon-close close-selector-button"><\/div>');this.table=null;this.fieldNames=[];this.selectionListeners=[];this.additionalDataHandler=null;this.visibleColumnSelector=null;this.showColumnSelector=!1;this.resizableColumns=!1;this.uiNames={};this.valueRenderer={};this.lastSort=null},{setDataModel:function(pData){this.model=pData},getDataModel:function(){return this.model},setColumnSelector:function(newShowColumnSelector){this.showColumnSelector=newShowColumnSelector},setResizableColumns:function(newResizableColumns){this.resizableColumns=newResizableColumns},setColumnUIName:function(fieldName,uiName){this.uiNames[fieldName]=uiName},setColumnValueRenderer:function(fieldName,renderer){this.valueRenderer[fieldName]=renderer},setVisibleFields:function(pFieldNames){this.fieldNames=pFieldNames},addSelectionListener:function(pCallback){this.selectionListeners.push(pCallback)},setAdditionalDataHandler:function(title,handler){this.additionalDataHandler={title:title,handler:handler}},_createAdditionalDataField:function(data){if(!data||jQuery.isEmptyObject(data))return!1;var me=this,content=this._renderAdditionalData(data),link;return!data.size&&this.additionalDataHandler?(link=this.templatePopupLink.clone(),link.append(this.additionalDataHandler.title),link.bind("click",function(){return me.additionalDataHandler.handler(link,content),!1}),link):content},_renderAdditionalData:function(data){var table=this.template.clone(),body=table.find("tbody"),value,row,fieldCell,valueCell,type,innerTable,i,field,valueDiv;if(data.size){for(value="",i=0;i<data.size();i+=1)i!==0&&(value=value+", "),value=value+data[i];return value}if(jQuery.isArray(data)){for(valueDiv=this.templateDiv.clone(),i=0;i<data.length;++i)innerTable=this._renderAdditionalData(data[i]),valueDiv.append(innerTable);return valueDiv}for(field in data)if(data.hasOwnProperty(field)){row=this.templateRow.clone();fieldCell=this.templateCell.clone();valueCell=this.templateCell.clone();value=data[field];fieldCell.append(field);row.append(fieldCell);try{type=typeof value;type==="object"?(innerTable=this._renderAdditionalData(value),valueCell.append(innerTable)):type!=="function"&&valueCell.append(value);row.append(valueCell)}catch(ignore){}body.append(row)}return table},_renderHeader:function(table,fieldNames){for(var me=this,headerContainer=table.find("thead tr"),bodyContainer=table.find("tbody"),header,link,fieldName,uiName,headerClosureMagic=function(scopedValue){return function(){var linky=jQuery(this),selection=me.getSelection(),descending=!1,idField,j;for(bodyContainer.empty(),me.lastSort&&me.lastSort.attr===scopedValue&&(descending=!me.lastSort.descending),me._sortBy(scopedValue,descending),me._renderBody(table,fieldNames),headerContainer.find("th").removeClass("asc"),headerContainer.find("th").removeClass("desc"),descending?linky.parent().addClass("desc"):linky.parent().addClass("asc"),idField=me.model.getIdField(),j=0;j<selection.length;j+=1)me.select(selection[j][idField],!0);return!1}},i=0;i<fieldNames.length;i+=1)header=this.templateTableHeader.clone(),link=header.find("a"),fieldName=fieldNames[i],uiName=this.uiNames[fieldName],uiName||(uiName=fieldName),link.append(uiName),me.lastSort&&fieldName===me.lastSort.attr&&(me.lastSort.descending?header.addClass("desc"):header.addClass("asc")),link.bind("click",headerClosureMagic(fieldNames[i])),headerContainer.append(header)},_renderBody:function(table,fieldNames){for(var me=this,body=table.find("tbody"),dataArray=this.model.getData(),row,data,f,key,value,cell,renderer,rows,rowClicked,i=0;i<dataArray.length;i+=1){for(row=this.templateRow.clone(),data=dataArray[i],row.attr("data-id",data[this.model.getIdField()]),f=0;f<fieldNames.length;f+=1)key=fieldNames[f],value=data[key],cell=this.templateCell.clone(),typeof value=="object"?cell.append(this._createAdditionalDataField(value)):(renderer=this.valueRenderer[key],renderer&&(value=renderer(value,data)),cell.append(value)),row.append(cell);body.append(row)}rows=table.find("tbody tr");rowClicked=function(){me._dataSelected(jQuery(this).attr("data-id"))};rows.bind("click",rowClicked);rows.find("a").hover(function(){jQuery(this).parents("tr").unbind("click")},function(){jQuery(this).parents("tr").bind("click",rowClicked)})},_renderColumnSelector:function(table,fieldNames){this.visibleColumnSelector=this.templateColumnSelectorButtonWrapper.clone();var me=this,columnSelectorButton=this.templateColumnSelectorButton.clone(),columnSelector=this.templateColumnSelector.clone(),columnSelectorList=this.templateColumnSelectorList.clone(),columnSelectorClose=this.templateColumnSelectorClose.clone(),fields,visibleField,i,j,newColumn,checkboxInput;for(this.visibleColumnSelector.addClass("column-selector-placeholder"),columnSelectorButton.addClass("icon-menu"),columnSelector.addClass("column-selector"),this.visibleColumnSelector.append(columnSelectorButton),this.visibleColumnSelector.append(columnSelector),jQuery("input.column-selector-list-item").remove(),columnSelectorButton.click(function(){columnSelector.css("visibility")!=="hidden"?columnSelector.css("visibility","hidden"):columnSelector.css("visibility","visible")}),columnSelectorClose.click(function(e){e.stopPropagation();columnSelector.css("visibility","hidden")}),fields=this.model.getFields(),i=0;i<fields.length;i+=1){for(visibleField=!1,j=0;j<fieldNames.length;j+=1)if(fields[i]===fieldNames[j]){visibleField=!0;break}newColumn=this.templateColumnSelectorListItem.clone();newColumn.addClass("column-selector-list-item");checkboxInput=newColumn.find("input");checkboxInput.attr("checked",visibleField);checkboxInput.addClass("column-selector-list-item");checkboxInput.attr("id",fields[i]);newColumn.find("label").attr({"for":fields[i],"class":"column-label"}).html(fields[i]);newColumn.css({margin:"5px"});checkboxInput.change(function(){for(var fieldSelectors=jQuery("input.column-selector-list-item"),oldFields=me.model.getFields(),newFields=[],l,k=0;k<oldFields.length;k+=1)for(l=0;l<fieldSelectors.length;l+=1)if(oldFields[k]===fieldSelectors[l].id){fieldSelectors[l].checked&&newFields.push(oldFields[k]);break}newFields.length>0&&me.setVisibleFields(newFields);me.renderTo(me.visibleColumnSelector.parent(),{columnSelector:"open"})});columnSelectorList.append(newColumn)}columnSelectorList.attr("class","column-selector-list");columnSelector.append(columnSelectorList,columnSelectorClose);columnSelectorClose.click(function(e){e.stopPropagation();columnSelector.css("visibility","hidden")})},_enableColumnResizer:function(){var pressed=!1,start,startX,startWidth,featureTable=jQuery("table.oskari-grid th");featureTable.css("cursor","e-resize");featureTable.mousedown(function(e){start=jQuery(this);pressed=!0;startX=e.pageX;startWidth=jQuery(this).width();jQuery(start).addClass("resizing");jQuery(document).attr("unselectable","on").css("user-select","none").on("selectstart",!1)});jQuery(document).mousemove(function(e){pressed&&jQuery(start).width(startWidth+(e.pageX-startX))});jQuery(document).mouseup(function(){pressed&&(jQuery(start).removeClass("resizing"),pressed=!1)})},renderTo:function(container,state){container.empty();var fieldNames=this.fieldNames,table=this.template.clone();fieldNames.length===0&&(fieldNames=this.model.getFields());this.table=table;this._renderHeader(table,fieldNames);this.lastSort&&this._sortBy(this.lastSort.attr,this.lastSort.descending);this._renderBody(table,fieldNames);this.showColumnSelector&&(this._renderColumnSelector(table,fieldNames),container.append(this.visibleColumnSelector),state!==null&&state!==undefined&&state.columnSelector==="open"&&this.visibleColumnSelector.find(".column-selector").css("visibility","visible"));container.append(table);this.resizableColumns&&this._enableColumnResizer()},_dataSelected:function(dataId){for(var i=0;i<this.selectionListeners.length;i+=1)this.selectionListeners[i](this,dataId)},select:function(value,keepPrevious){for(var key=this.model.getIdField(),dataArray=this.model.getData(),rows,data,index=0;index<dataArray.length;index+=1)if(data=dataArray[index],data[key]===value)break;rows=this.table.find("tbody tr");keepPrevious!==!0&&rows.removeClass("selected");jQuery(rows[index]).addClass("selected")},removeSelections:function(){var rows=this.table.find("tbody tr");rows.removeClass("selected")},getSelection:function(){for(var dataArray=this.model.getData(),selection=[],rows=this.table.find("tbody tr"),row,i=0;i<rows.length;i+=1)row=jQuery(rows[i]),row.hasClass("selected")&&selection.push(dataArray[i]);return selection},getTable:function(){return this.table},_sortBy:function(pAttribute,pDescending){var me=this,dataArray=me.model.getData();dataArray.length!==0&&(this.lastSort={attr:pAttribute,descending:pDescending},dataArray.sort(function(a,b){return me._sortComparator(a,b,pAttribute,pDescending)}))},_sortComparator:function(a,b,pAttribute,pDescending){var nameA,nameB,value;return typeof a[pAttribute]=="object"||typeof b[pAttribute]=="object"?0:(nameA=a[pAttribute],nameA?nameA.toLowerCase&&(nameA=nameA.toLowerCase()):nameA="",nameB=b[pAttribute],nameB?nameB.toLowerCase&&(nameB=nameB.toLowerCase()):nameB="",value=0,nameA<nameB?value=-1:nameA>nameB&&(value=1),pDescending&&(value=value*-1),value)}});Oskari.clazz.define("Oskari.userinterface.component.GridModel",function(){this.fields=[];this.data=[];this.idField=null},{_addField:function(field){this.idField||(this.idField=field);this.fields.push(field)},getFields:function(){return this.fields},setIdField:function(pField){this.idField=pField},getIdField:function(){return this.idField},addData:function(pData){var key;if(this.fields.length===0)for(key in pData)pData.hasOwnProperty(key)&&this._addField(key);this.data.push(pData)},getData:function(){return this.data}});Oskari.clazz.define("Oskari.userinterface.component.ProgressSpinner",function(){this.container=undefined;this.opts=undefined},{__opts:{lines:15,length:0,width:5,radius:16,corners:0,rotate:0,color:"#000",speed:.6,trail:59,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"},insertTo:function(el,opts){this.container=el;this.opts=opts||this.__opts},start:function(){var el=this.container,$el=$(el),data=$el.data(),Spinner=this._Spinner,opts=this.opts;data.spinner&&(data.spinner.stop(),delete data.spinner);opts!==!1&&(data.spinner=new Spinner($.extend({color:$el.css("color")},opts)).spin($el.get()[0]))},stop:function(){var el=this.container,$el,data;el&&($el=$(el),data=$el.data(),data.spinner&&(data.spinner.stop(),delete data.spinner))},_Spinner:function(window,document){function createEl(tag,prop){var el=document.createElement(tag||"div");for(var n in prop)prop.hasOwnProperty(n)&&(el[n]=prop[n]);return el}function ins(parent){for(var i=1,n=arguments.length;i<n;i+=1)parent.appendChild(arguments[i]);return parent}function addAnimation(alpha,trail,i,lines){var name=["opacity",trail,~~(alpha*100),i,lines].join("-"),start=.01+i/lines*100,z=Math.max(1-(1-alpha)/trail*(100-start),alpha),prefix=useCssAnimations.substring(0,useCssAnimations.indexOf("Animation")).toLowerCase(),pre=prefix&&"-"+prefix+"-"||"";return animations[name]||(sheet.insertRule("@"+pre+"keyframes "+name+"{0%{opacity:"+z+"}"+start+"%{opacity:"+alpha+"}"+(start+.01)+"%{opacity:1}"+(start+trail)%100+"%{opacity:"+alpha+"}100%{opacity:"+z+"}}",sheet.cssRules.length),animations[name]=1),name}function vendor(el,prop){var s=el.style,pp,i;if(s[prop]!==undefined)return prop;for(prop=prop.charAt(0).toUpperCase()+prop.slice(1),i=0;i<prefixes.length;i+=1)if(pp=prefixes[i]+prop,s[pp]!==undefined)return pp}function css(el,prop){for(var n in prop)prop.hasOwnProperty(n)&&(el.style[vendor(el,n)||n]=prop[n]);return el}function merge(obj){for(var def,n,i=1;i<arguments.length;i+=1){def=arguments[i];for(n in def)def.hasOwnProperty(n)&&obj[n]===undefined&&(obj[n]=def[n])}return obj}function pos(el){for(var o={x:el.offsetLeft,y:el.offsetTop};el=el.offsetParent;)o.x+=el.offsetLeft,o.y+=el.offsetTop;return o}function Spinner(o){if(!this.spin)return new Spinner(o);this.opts=merge(o||{},Spinner.defaults,defaults)}var prefixes=["webkit","Moz","ms","O"],animations={},useCssAnimations,sheet,defaults={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",speed:1,trail:100,opacity:1/4,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};return sheet=function(){var el=createEl("style",{type:"text/css"});return ins(document.getElementsByTagName("head")[0],el),el.sheet||el.styleSheet}(),Spinner.defaults={},merge(Spinner.prototype,{spin:function(target){this.stop();var self=this,o=self.opts,el=self.el=css(createEl(0,{className:o.className}),{position:o.position,width:0,zIndex:o.zIndex}),mid=o.radius+o.length+o.width,ep,tp,i,fps,f,ostep,astep;return target&&(target.insertBefore(el,target.firstChild||null),tp=pos(target),ep=pos(el),css(el,{left:(o.left==="auto"?tp.x-ep.x+(target.offsetWidth>>1):parseInt(o.left,10)+mid)+"px",top:(o.top==="auto"?tp.y-ep.y+(target.offsetHeight>>1):parseInt(o.top,10)+mid)+"px"})),el.setAttribute("aria-role","progressbar"),self.lines(el,self.opts),useCssAnimations||(i=0,fps=o.fps,f=fps/o.speed,ostep=(1-o.opacity)/(f*o.trail/100),astep=f/o.lines,function anim(){var s,alpha;for(i+=1,s=o.lines;s;s-=1)alpha=Math.max(1-(i+s*astep)%f*ostep,o.opacity),self.opacity(el,o.lines-s,alpha,o);self.timeout=self.el&&setTimeout(anim,~~(1e3/fps))}()),self},stop:function(){var el=this.el;return el&&(clearTimeout(this.timeout),el.parentNode&&el.parentNode.removeChild(el),this.el=undefined),this},lines:function(el,o){function fill(color,shadow){return css(createEl(),{position:"absolute",width:o.length+o.width+"px",height:o.width+"px",background:color,boxShadow:shadow,transformOrigin:"left",transform:"rotate("+~~(360/o.lines*i+o.rotate)+"deg) translate("+o.radius+"px,0)",borderRadius:(o.corners*o.width>>1)+"px"})}for(var seg,i=0;i<o.lines;i+=1)seg=css(createEl(),{position:"absolute",top:1+~(o.width/2)+"px",transform:o.hwaccel?"translate3d(0,0,0)":"",opacity:o.opacity,animation:useCssAnimations&&addAnimation(o.opacity,o.trail,i,o.lines)+" "+1/o.speed+"s linear infinite"}),o.shadow&&ins(seg,css(fill("#000","0 0 4px #000"),{top:"2px"})),ins(el,ins(seg,fill(o.color,"0 0 1px rgba(0,0,0,.1)")));return el},opacity:function(el,i,val){i<el.childNodes.length&&(el.childNodes[i].style.opacity=val)}}),function(){function vml(tag,attr){return createEl("<"+tag+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',attr)}var ss=css(createEl("group"),{behavior:"url(#default#VML)"});!vendor(ss,"transform")&&ss.adj?(sheet.addRule(".spin-vml","behavior:url(#default#VML)"),Spinner.prototype.lines=function(el,o){function grp(){return css(vml("group",{coordsize:s+" "+s,coordorigin:-r+" "+-r}),{width:s,height:s})}function seg(i,dx,filter){ins(g,ins(css(grp(),{rotation:360/o.lines*i+"deg",left:~~dx}),ins(css(vml("roundrect",{arcsize:o.corners}),{width:r,height:o.width,left:o.radius,top:-o.width>>1,filter:filter}),vml("fill",{color:o.color,opacity:o.opacity}),vml("stroke",{opacity:0}))))}var r=o.length+o.width,s=2*r,margin,g,i;if(margin=-(o.width+o.length)*2+"px",g=css(grp(),{position:"absolute",top:margin,left:margin}),o.shadow)for(i=1;i<=o.lines;i+=1)seg(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=o.lines;i+=1)seg(i);return ins(el,g)},Spinner.prototype.opacity=function(el,i,val,o){var c=el.firstChild;o=o.shadow&&o.lines||0;c&&i+o<c.childNodes.length&&(c=c.childNodes[i+o],c=c&&c.firstChild,c=c&&c.firstChild,c&&(c.opacity=val))}):useCssAnimations=vendor(ss,"animation")}(),Spinner}(window,document)});Oskari.clazz.define("Oskari.userinterface.component.VisualizationForm",function(options){this._clazzPrefix="Oskari.userinterface.component.visualization-form.";this._clazzSuffix="Form";this._iconClsPrefix="icon-";this._defaultLocKey="VisualizationForm";this._loc=this._getLocalization("DivManazer");this.lineCapMap=["butt","round"];this.lineCornerMap=["mitre","round","bevel"];this.lineStyleMap=["","5 2",""];this.dialog=null;options=options||{};this._options=jQuery.extend({},{forms:["dot","line","area"],formValues:{dot:{shape:1,color:"000000",size:3},line:{style:0,cap:0,corner:0,width:1,color:"3233ff"},area:{line:{width:1,corner:0,style:0,color:"000000"},fill:{style:-1,color:"ffde00"}}}},options);this._formClazzes=this._createFormClazzes(this._options.forms,this._options.formValues);this.template=jQuery('<div id="visualization-form"><\/div>');this.templateRenderButton=jQuery('<div class="renderButton"><\/div>')},{getForm:function(){var me=this,form=this.template.clone(),formClazzes=this._getFormClazz(),btnContainer,formName;for(formName in formClazzes)formClazzes.hasOwnProperty(formName)&&(btnContainer=this.templateRenderButton.clone(),btnContainer.attr("title",this._loc.tooltips[formName]),btnContainer.addClass(this._iconClsPrefix+(formName==="dot"?"point":formName)),btnContainer.click(me._bindRenderButton(formClazzes[formName])),form.append(btnContainer));return form},getValues:function(){var values={},formClazzes=this._getFormClazz(),fClazzName,fClazz;for(fClazzName in formClazzes)formClazzes.hasOwnProperty(fClazzName)&&(fClazz=formClazzes[fClazzName],values[fClazzName]=fClazz.getValues());return values},setValues:function(values){if(values!==null&&values!==undefined&&typeof values=="object"){var formClazzes=this._getFormClazz(),fClazzName,fClazz;for(fClazzName in formClazzes)formClazzes.hasOwnProperty(fClazzName)&&(fClazz=formClazzes[fClazzName],fClazz.setValues(values[fClazzName]))}},hexToRgb:function(hex){var result;return hex=hex.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(m,r,g,b){return r+r+g+g+b+b}),result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex),result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null},rgbToHex:function(rgb){if(rgb.charAt(0)==="#")return rgb.substring(1);var parts=rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),j;for(delete parts[0],j=1;j<=3;++j)parts[j]=parseInt(parts[j],10).toString(16),parts[j].length===1&&(parts[j]="0"+parts[j]);return parts.join("")},_bindRenderButton:function(formClazz){var me=this;return function(e){formClazz&&formClazz.showForm&&typeof formClazz.showForm=="function"&&(me.dialog&&me.dialog.close(!0),me.dialog=formClazz.showForm(e.target))}},_getFormClazz:function(formName){return formName!==null&&formName!==undefined?this._formClazzes[formName]:this._formClazzes},_getLocalization:function(locKey){var locale=Oskari.getLocalization(locKey),ret=null;return locale&&(ret=locale[this._defaultLocKey]),ret},_createFormClazzes:function(formNames,formValues){for(var fLen=formNames?formNames.length:0,fClazzes={},fName,fValues,fClazz,i=0;i<fLen;++i)fName=formNames[i],fValues=formValues[fName],fClazz=this._createFormClazz(fName,fValues),fClazzes[fName]=fClazz;return fClazzes},_createFormClazz:function(formName,formValues){var clazz=this._capitalize(formName),clazzName=this._clazzPrefix+clazz+this._clazzSuffix,loc=this._loc[formName];return Oskari.clazz.create(clazzName,this,loc,formValues)},_capitalize:function(str){return str.charAt(0).toUpperCase()+str.slice(1)}});Oskari.clazz.define("Oskari.userinterface.component.visualization-form.AreaForm",function(creator,loc,defaultValues){this.creator=creator;this.loc=loc;this.defaultValues=defaultValues;this.first=!0;this.values={lineWidth:this.defaultValues.line.width,lineCorner:this.defaultValues.line.corner,lineStyle:this.defaultValues.line.style,lineColor:this.defaultValues.line.color,fillColor:this.defaultValues.fill.color,fillStyle:this.defaultValues.fill.style};this.styleButtonNames=["icon-line-basic","icon-line-dashed","icon-double-line"];this.cornerButtonNames=["icon-corner-sharp","icon-corner-round"];this.colorTypes=["line","fill"];this.basicColors=["#ffffff","#666666","#ffde00","#f8931f","#ff3334","#bf2652","#000000","#cccccc","#652d90","#3233ff","#26bf4b","#00ff01"];this.paper=null;this.activeColorCell=[-1,-1];for(var j,i=0;i<this.basicColors.length;i++)for(j=0;j<this.basicColors.length;j++)if(this.basicColors[j]==="#"+this.values.fillColor[i]){this.activeColorCell[i]=j;break}this.fillButtonNames=["icon-line-thin-diagonal","icon-line-wide-diagonal","icon-line-thin-horizontal","icon-line-wide-horizontal"];this.templateAreaStyleDialogContent=jQuery('<div class="areaform"><div class="container"><div class="column1"><label>'+this.loc.linestyle.label+'<\/label><div class="style icon-buttons"><\/div><label>'+this.loc.linecorner.label+'<\/label><div class="corner icon-buttons"><\/div><label>'+this.loc.linewidth.label+'<\/label><br><div class="width"><\/div><\/div><div class="column2"><div class="column21"><label>'+this.loc.linecolor.label+'<\/label><div class="color-grid"><div class="color-rectangle line"><\/div><\/div><div class="color-label"><label>'+this.loc.linecolor.labelOr+'<\/label><\/div><div class="color-source-selector-line"><label>'+this.loc.linecolor.labelCustom+'<\/label><\/div><div class="custom-colors-line"><\/div><\/div><div class="column22"><div class="column221"><label>'+this.loc.color.label+'<\/label><div class="color-grid"><div class="color-rectangle fill"><\/div><\/div><div class="color-label"><label>'+this.loc.color.labelOr+'<\/label><\/div><div class="color-source-selector-fill"><label>'+this.loc.color.labelCustom+'<\/label><\/div><div class="custom-colors-fill"><\/div><label>'+this.loc.fill.label+'<\/label><div class="fill icon-buttons"><\/div><\/div><div class="column222"><label>'+this.loc.preview.label+'<\/label><div class="preview"><\/div><\/div><\/div><\/div><\/div><\/div>');this.templateButton=jQuery('<div class="icon-button"><\/div>');this.templateColorCell=jQuery('<div class="color-cell"><\/div>');this.templateCustomColor=jQuery('<div class="custom-color-editor"><div class="colorcontainer"><div class="colorcolumn1"><\/div><div class="colorcolumn2"><div class="colorcolumn21"><\/div><div class="colorcolumn22"><\/div><\/div><\/div>');this.templateColorSource=jQuery('<input type="checkbox" name="colorInput" value = "custom" class="color-source">');this.templateColorValue=jQuery('<label class="color-label"><\/label><br><input type="text" name="color-input" value="0" disabled="disabled" class="custom-color">');this.minWidth=1;this.maxWidth=5;this.templateWidthValue=jQuery('<input type="number" name="width" class="linewidth" min="'+this.minWidth+'" max="'+this.maxWidth+'" step=1 value="'+this.values.lineWidth+'">');this.previewSize=50;this.selectColor="#dddddd"},{getValues:function(){var lineCorner=this.values.lineCorner,lineStyle=this.values.lineStyle;return typeof lineCorner=="number"&&(lineCorner=this.creator.lineCornerMap[lineCorner]),typeof lineStyle=="number"&&(lineStyle=this.creator.lineStyleMap[lineStyle]),{lineWidth:this.values.lineWidth,lineCorner:lineCorner,lineStyle:lineStyle,lineColor:this.values.lineColor,fillColor:this.values.fillColor,fillStyle:this.values.fillStyle}},setValues:function(values){var i;if(values!==null&&values!==undefined){for(i=0;i<this.creator.lineCornerMap.length;i++)values.lineCorner===this.creator.lineCornerMap[i]&&(values.lineCorner=i);for(i=0;i<this.creator.lineStyleMap.length;i++)values.lineStyle===this.creator.lineStyleMap[i]&&(values.lineStyle=i);jQuery.extend(!0,this.values,values)}},showForm:function(renderButton,state){var me=this,renderDialog,widthSpinner,c,statedChosenColor,cType,colorCell,idExt,id,colorCheckbox,customColorEditor,redValue,greenValue,blueValue,rgb,fillBtnContainer,saveBtn,cancelBtn;state!==null&&state!==undefined&&jQuery.extend(!0,me.values,state.area);renderDialog=Oskari.clazz.create("Oskari.userinterface.component.Popup");renderDialog.addClass("renderdialog");renderDialog.addClass("areavisualization");var title=me.loc.title,dialogContent=me.templateAreaStyleDialogContent.clone(),content=dialogContent.find("div.style"),i,styleBtnContainer,newValue,cornerBtnContainer;for(me.values.lineStyle.length===0&&(me.values.lineStyle=0),i=0;i<me.styleButtonNames.length;i++)styleBtnContainer=me.templateButton.clone(),styleBtnContainer.addClass(me.styleButtonNames[i]),styleBtnContainer.attr("id",i+"linestyle"),i===me.values.lineStyle&&this._styleSelectedButton(styleBtnContainer),styleBtnContainer.click(function(){newValue=parseInt(jQuery(this).attr("id").charAt(0),10);me._selectButton("lineStyle",newValue);me.values.lineStyle=newValue;me._updatePreview(dialogContent)}),content.append(styleBtnContainer);for(content=dialogContent.find("div.corner"),i=0;i<me.cornerButtonNames.length;i++)cornerBtnContainer=me.templateButton.clone(),cornerBtnContainer.addClass(me.cornerButtonNames[i]),cornerBtnContainer.attr("id",i+"linecorner"),i===me.values.lineCorner&&this._styleSelectedButton(cornerBtnContainer),cornerBtnContainer.click(function(){newValue=parseInt(jQuery(this).attr("id").charAt(0),10);me._selectButton("lineCorner",newValue);me.values.lineCorner=newValue;me._updatePreview(dialogContent)}),content.append(cornerBtnContainer);for(content=dialogContent.find("div.width"),widthSpinner=me.templateWidthValue.clone(),widthSpinner.val(me.values.lineWidth!==null&&me.values.lineWidth!==undefined?me.values.lineWidth:1),widthSpinner.change(function(){var newValue=parseInt(widthSpinner.val(),10);isNaN(newValue)||(me.values.lineWidth=newValue,me._updatePreview())}),content.append(widthSpinner),c=0;c<2;c++){for(statedChosenColor=!1,cType=c===0?"lineColor":"fillColor",content=dialogContent.find(".color-rectangle."+me.colorTypes[c]),i=0;i<me.basicColors.length;i++)colorCell=me.templateColorCell.clone(),colorCell.css("background-color",me.basicColors[i]),idExt="ColorCell",id=i.toString()+c.toString()+idExt,id.length===idExt.length+2&&(id="0"+id),colorCell.attr("id",id),colorCell.click(function(){var cellIndex=parseInt(this.id.substring(0,2),10),colorType=parseInt(this.id.substring(2,3),10),activeCell;jQuery("#"+colorType+"color-checkbox").prop("checked")||cellIndex!==me.activeColorCell[colorType]&&(me.activeColorCell[colorType]>-1&&(activeCell=me.activeColorCell[colorType].toString(),me.activeColorCell[colorType]<10&&(activeCell="0"+activeCell),jQuery("#"+activeCell+colorType+"ColorCell").css("border","1px solid #000000")),me.values[colorType===0?"lineColor":"fillColor"]=me.creator.rgbToHex(this.style.backgroundColor),me.activeColorCell[colorType]=cellIndex,cellIndex<10&&(cellIndex="0"+cellIndex.toString()),jQuery("#"+cellIndex+colorType+"ColorCell").css("border","3px solid #ffffff"),me._updatePreview(dialogContent))}),"#"+me.values[cType]===me.basicColors[i]&&(colorCell.css("border","3px solid #ffffff"),me.activeColorCell[c]=i,statedChosenColor=!0),content.append(colorCell);content=dialogContent.find(".color-source-selector-"+me.colorTypes[c]);colorCheckbox=me.templateColorSource.clone();colorCheckbox.attr("id",c+"color-checkbox");me.activeColorCell[c]===-1&&colorCheckbox.attr("checked",!0);colorCheckbox.change(function(){var colorTypeId=this.id.substring(0,1),colorType=colorTypeId==="0"?"lineColor":"fillColor",cell,activeCell;jQuery("input.custom-color."+me.colorTypes[colorTypeId]).prop("disabled",!this.checked);cell=me.activeColorCell[colorTypeId].toString();me.activeColorCell[colorTypeId]<10&&(cell="0"+cell);activeCell=jQuery("#"+cell+colorTypeId+"ColorCell");this.checked&&(activeCell.css("border","1px solid #000000"),jQuery(".custom-red-value."+me.colorTypes[colorTypeId]).val(parseInt(me.values[colorType].substring(0,2),16)),jQuery(".custom-green-value."+me.colorTypes[colorTypeId]).val(parseInt(me.values[colorType].substring(2,4),16)),jQuery(".custom-blue-value."+me.colorTypes[colorTypeId]).val(parseInt(me.values[colorType].substring(4),16)),me.activeColorCell[colorTypeId]=-1);me._updatePreview(dialogContent)});content.prepend(colorCheckbox);statedChosenColor||(colorCheckbox.checked=!0,content.find("input.color-source").prop("disabled",!1).attr("checked","checked"));content=dialogContent.find(".custom-colors-"+me.colorTypes[c]);customColorEditor=this.templateCustomColor.clone();customColorEditor.addClass(me.colorTypes[c]);content.append(customColorEditor);redValue=me.templateColorValue.clone();redValue.addClass("custom-red-value");redValue.addClass(me.colorTypes[c]);me.activeColorCell[c]===-1&&(redValue.val(parseInt(me.values.lineColor.substring(0,2),16)),redValue.prop("disabled",!1));content.find(".colorcolumn1").append(redValue);content.find("label.custom-red-value").text("R");content.find("input.custom-red-value").attr("id",c+"red-value");greenValue=me.templateColorValue.clone();greenValue.addClass("custom-green-value");greenValue.addClass(me.colorTypes[c]);me.activeColorCell[c]===-1&&(greenValue.val(parseInt(me.values[cType].substring(2,4),16)),greenValue.prop("disabled",!1));content.find(".colorcolumn21").append(greenValue);content.find("label.custom-green-value").text("G");content.find("input.custom-green-value").attr("id",c+"green-value");blueValue=me.templateColorValue.clone();blueValue.addClass("custom-blue-value");blueValue.addClass(me.colorTypes[c]);me.activeColorCell[c]===-1&&(blueValue.val(parseInt(me.values[cType].substring(4),16)),blueValue.prop("disabled",!1));content.find(".colorcolumn22").append(blueValue);content.find("label.custom-blue-value").text("B");content.find("input.custom-blue-value").attr("id",c+"blue-value");statedChosenColor||(rgb=me.creator.hexToRgb(me.values[cType]),content.find("input.custom-color.custom-red-value").val(rgb.r),content.find("input.custom-color.custom-green-value").val(rgb.g),content.find("input.custom-color.custom-blue-value").val(rgb.b),dialogContent.find("input#"+c.toString()+"red-value.custom-color").prop("disabled",!1),dialogContent.find("input#"+c.toString()+"green-value.custom-color").prop("disabled",!1),dialogContent.find("input#"+c.toString()+"blue-value.custom-color").prop("disabled",!1));content.find(".custom-color").change(function(){var colorType=this.id.substring(0,1),values=[],i,intValue;for(values[0]=jQuery("input#"+colorType+"red-value").val(),values[1]=jQuery("input#"+colorType+"green-value").val(),values[2]=jQuery("input#"+colorType+"blue-value").val(),i=0;i<3;i++){if(intValue=parseInt(values[i],10),intValue<0||intValue>255)return;values[i]=intValue.toString(16);values[i].length===1&&(values[i]="0"+values[i])}me.values[colorType==="0"?"lineColor":"fillColor"]=values.join("");me._updatePreview()})}for(content=dialogContent.find("div.fill.icon-buttons"),i=0;i<me.fillButtonNames.length;i++)fillBtnContainer=me.templateButton.clone(),fillBtnContainer.addClass(me.fillButtonNames[i]),fillBtnContainer.attr("id",i+"fillstyle"),i===me.values.fillStyle&&this._styleSelectedButton(fillBtnContainer),fillBtnContainer.click(function(){var newValue=parseInt(jQuery(this).attr("id").charAt(0),10);me.values.fillStyle===newValue?(me.values.fillStyle=-1,me._styleUnselectedButton(jQuery("div#"+newValue+"fillstyle.icon-button"))):(me.values.fillStyle!==-1&&me._styleUnselectedButton(jQuery("div#"+me.values.fillStyle+"fillstyle.icon-button")),me._styleSelectedButton(jQuery("div#"+newValue+"fillstyle.icon-button")),me.values.fillStyle=newValue);me._updatePreview(dialogContent)}),content.append(fillBtnContainer);return this._updatePreview(dialogContent),saveBtn=Oskari.clazz.create("Oskari.userinterface.component.Button"),saveBtn.setTitle(me.loc.buttons.save),saveBtn.addClass("primary showSelection"),saveBtn.setHandler(function(){renderDialog.close()}),cancelBtn=Oskari.clazz.create("Oskari.userinterface.component.Button"),cancelBtn.setTitle(me.loc.buttons.cancel),cancelBtn.setHandler(function(){me.values.lineWidth=me.defaultValues.line.width;me.values.lineCorner=me.defaultValues.line.corner;me.values.lineStyle=me.defaultValues.line.style;me.values.lineColor=me.defaultValues.line.color;me.values.fillColor=me.defaultValues.fill.color;me.values.fillStyle=me.defaultValues.fill.style;renderDialog.close()}),renderDialog.show(title,dialogContent,[saveBtn,cancelBtn]),renderDialog.moveTo(renderButton,"top"),renderDialog},_selectButton:function(property,selectedButton){var propertyType=property.substring(4).toLowerCase();this._styleUnselectedButton(jQuery("div#"+this.values[property]+"line"+propertyType+".icon-button"));this._styleSelectedButton(jQuery("div#"+selectedButton+"line"+propertyType+".icon-button"))},_updatePreview:function(dialog){this.first&&(this.first=!1,this.values.fillStyle=this.defaultValues.fill.style);var me=this,view=dialog===undefined||dialog===null?jQuery(".areaform"):dialog,content=view.find(".preview"),preview;if(content.length>0)preview=content.get(0),preview.children.length===0&&(this.paper=Raphael(preview,50,50));else return;var fill=parseInt(me.values.fillStyle,10)<0?"#"+me.values.fillColor:"none",basicAttributes={stroke:"#"+me.values.lineColor,fill:fill,"stroke-width":me.values.lineWidth,"stroke-linejoin":me.values.lineCorner===0?"miter":"round","stroke-linecap":"butt","stroke-dasharray":me.values.lineStyle===1?"- ":""},patternAttributes={};if(this.paper.clear(),me.values.fillStyle>=0)switch(me.values.fillStyle){case 0:patternAttributes={"stroke-width":1,stroke:"#"+me.values.fillColor,fill:"none"};this.paper.path("M"+[10.5,17.5]+"L"+[11.2,16.8]+"M"+[12.3,19.7]+"L"+[16,16]+"M"+[14.1,21.9]+"L"+[20.8,15.2]+"M"+[15.9,24.1]+"L"+[25.6,14.4]+"M"+[17.7,26.3]+"L"+[30.4,13.6]+"M"+[19.5,28.5]+"L"+[35.2,12.8]+"M"+[21.4,30.6]+"L"+[40,12]+"M"+[23.2,32.8]+"L"+[37.4,18.6]+"M"+[25,35]+"L"+[34.8,25.2]+"M"+[26.8,37.2]+"L"+[32.2,31.8]+"M"+[28.6,39.4]+"L"+[29.6,38.4]).attr(patternAttributes);this.paper.circle(0,0,0);break;case 1:patternAttributes={"stroke-width":2,stroke:"#"+me.values.fillColor,fill:"none"};this.paper.path("M"+[14.8,16.2]+"L"+[11.9,19.1]+"M"+[23.2,14.8]+"L"+[15,23]+"M"+[31.6,13.4]+"L"+[18.2,26.8]+"M"+[39.8,12.2]+"L"+[21.4,30.6]+"M"+[35.4,23.6]+"L"+[24.5,34.5]+"M"+[30.9,35.1]+"L"+[27.7,38.3]).attr(patternAttributes);this.paper.circle(0,0,0);break;case 2:patternAttributes={"stroke-width":1,stroke:"#"+me.values.fillColor,fill:"none"};this.paper.path("M"+[19,15.5]+"L"+[38.6,15.5]+"M"+[12.1,19.5]+"L"+[37,19.5]+"M"+[15.4,23.5]+"L"+[35.4,23.5]+"M"+[18.7,27.5]+"L"+[33.9,27.5]+"M"+[22,31.5]+"L"+[32.3,31.5]+"M"+[25.3,35.5]+"L"+[30.7,35.5]+"M"+[28.6,39.5]+"L"+[29.1,39.5]).attr(patternAttributes);this.paper.circle(0,0,0);break;case 3:patternAttributes={"stroke-width":2,stroke:"#"+me.values.fillColor,fill:"none"};this.paper.path("M"+[16.1,16]+"L"+[38.4,16]+"M"+[13.4,21]+"L"+[36.4,21]+"M"+[17.5,26]+"L"+[35.5,26]+"M"+[21.6,31]+"L"+[32.5,31]+"M"+[25.7,36]+"L"+[30.5,36]).attr(patternAttributes);this.paper.circle(0,0,0)}var p1=[10,17],p2=[40,12],p3=[29,40],a=this.paper.path("M"+p1+"L"+p2+","+p3+"Z").attr(basicAttributes);if(this.paper.circle(0,0,0),me.values.lineStyle===2){var d=2*(2+parseInt(me.values.lineWidth,10)),t1=Math.atan(Math.abs((p2[1]-p1[1])/(p2[0]-p1[0]))),p1a=[p1[0]+d*Math.sin(Math.PI/3+t1),p1[1]+d*Math.cos(Math.PI/3+t1)],t2=Math.atan(Math.abs((p3[1]-p2[1])/(p3[0]-p2[0]))),p2a=[p2[0]-d*Math.sin(Math.PI/3+t2),p2[1]-d*Math.cos(Math.PI/3+t2)],t3=Math.atan(Math.abs((p1[1]-p3[1])/(p1[0]-p3[0]))),p3a=[p3[0]-d*Math.cos(Math.PI/6+t3),p3[1]-d*Math.sin(Math.PI/6+t3)];this.paper.path("M"+p1a+"L"+p2a+","+p3a+"Z").attr(basicAttributes)}},_getOnScreenForm:function(){return jQuery("div.renderdialog")},_styleSelectedButton:function(selectedButton){selectedButton.css("border","2px solid");selectedButton.css("background-color",this.selectColor)},_styleUnselectedButton:function(unselectedButton){unselectedButton.css("border","1px solid");unselectedButton.css("background-color","transparent")}});Oskari.clazz.define("Oskari.userinterface.component.visualization-form.LineForm",function(creator,loc,defaultValues){this.creator=creator;this.loc=loc;this.defaultValues=defaultValues;this.values={style:this.defaultValues.style,cap:this.defaultValues.cap,corner:this.defaultValues.corner,width:this.defaultValues.width,color:this.defaultValues.color};this.styleButtonNames=["icon-line-basic","icon-line-dashed","icon-double-line"];this.capButtonNames=["icon-line-flat_cap","icon-line-round_cap"];this.cornerButtonNames=["icon-corner-sharp","icon-corner-round"];this.basicColors=["#ffffff","#666666","#ffde00","#f8931f","#ff3334","#bf2652","#000000","#cccccc","#652d90","#3233ff","#26bf4b","#00ff01"];this.paper=null;this.activeColorCell=-1;for(var i=0;i<this.basicColors.length;i++)if(this.basicColors[i]==="#"+this.values.color){this.activeColorCell=i;break}this.templateLineStyleDialogContent=jQuery('<div class="lineform"><div class="container"><div class="column1"><label>'+this.loc.style.label+'<\/label><div class="style icon-buttons"><\/div><label>'+this.loc.cap.label+'<\/label><div class="cap icon-buttons"><\/div><label>'+this.loc.corner.label+'<\/label><div class="corner icon-buttons"><\/div><label>'+this.loc.width.label+'<\/label><br><div class="width"><\/div><\/div><div class="column2"><div class="column21"><label>'+this.loc.color.label+'<\/label><div class="color-grid"><div class="color-rectangle"><\/div><\/div><div class="color-label"><label>'+this.loc.color.labelOr+'<\/label><\/div><div class="color-source-selector"><label>'+this.loc.color.labelCustom+'<\/label><\/div><div class="custom-colors"><\/div><\/div><div class="column22"><label>'+this.loc.preview.label+'<\/label><div class="preview"><\/div><\/div><\/div><\/div><\/div>');this.templateButton=jQuery('<div class="icon-button"><\/div>');this.templateColorCell=jQuery('<div class="color-cell"><\/div>');this.templateCustomColor=jQuery('<div class="custom-color-editor"><div class="colorcontainer"><div class="colorcolumn1"><\/div><div class="colorcolumn2"><div class="colorcolumn21"><\/div><div class="colorcolumn22"><\/div><\/div><\/div>');this.templateColorSource=jQuery('<input type="checkbox" name="colorInput" value = "custom" class="color-source">');this.templateColorValue=jQuery('<label class="color-label"><\/label><br><input type="text" name="color-input" value="0" disabled="disabled" class="custom-color">');this.minWidth=1;this.maxWidth=10;this.templateWidthValue=jQuery('<input type="number" name="width" class="linewidth" min="'+this.minWidth+'" max="'+this.maxWidth+'" step=1 value="'+this.values.width+'">');this.previewSize=50;this.selectColor="#dddddd"},{getValues:function(){var cap=this.values.cap,corner=this.values.corner,style=this.values.style;return typeof cap=="number"&&(cap=this.creator.lineCapMap[cap]),typeof corner=="number"&&(corner=this.creator.lineCornerMap[corner]),typeof style=="number"&&(style=this.creator.lineStyleMap[style]),{width:this.values.width,color:this.values.color,cap:cap,corner:corner,style:style}},setValues:function(values){var i;if(values!==null&&values!==undefined){for(i=0;i<this.creator.lineCapMap.length;i++)values.cap===this.creator.lineCapMap[i]&&(values.cap=i);for(i=0;i<this.creator.lineCornerMap.length;i++)values.corner===this.creator.lineCornerMap[i]&&(values.corner=i);for(i=0;i<this.creator.lineStyleMap.length;i++)values.style===this.creator.lineStyleMap[i]&&(values.style=i);jQuery.extend(!0,this.values,values)}},showForm:function(renderButton,state){var me=this,renderDialog,widthSpinner,statedChosenColor,colorCell,idExt,id,cellIndex,activeCell,colorCheckbox,customColorEditor,redValue,greenValue,blueValue,rgb,saveBtn,cancelBtn;state!==null&&state!==undefined&&jQuery.extend(!0,me.values,state.line);renderDialog=Oskari.clazz.create("Oskari.userinterface.component.Popup");renderDialog.addClass("renderdialog");renderDialog.addClass("linevisualization");var title=me.loc.title,dialogContent=me.templateLineStyleDialogContent.clone(),content=dialogContent.find("div.style"),i,cornerBtnContainer,styleBtnContainer,capBtnContainer,newValue;for(me.values.style.length===0&&(me.values.style=0),i=0;i<me.styleButtonNames.length;i++)styleBtnContainer=me.templateButton.clone(),styleBtnContainer.addClass(me.styleButtonNames[i]),styleBtnContainer.attr("id",i+"linestyle"),i===me.values.style&&this._styleSelectedButton(styleBtnContainer),styleBtnContainer.click(function(){newValue=parseInt(jQuery(this).attr("id").charAt(0),10);me._selectButton("style",newValue);me.values.style=newValue;me._updatePreview(dialogContent)}),content.append(styleBtnContainer);for(content=dialogContent.find("div.cap"),i=0;i<me.capButtonNames.length;i++)capBtnContainer=me.templateButton.clone(),capBtnContainer.addClass(me.capButtonNames[i]),capBtnContainer.attr("id",i+"linecap"),i===me.values.cap&&this._styleSelectedButton(capBtnContainer),capBtnContainer.click(function(){newValue=parseInt(jQuery(this).attr("id").charAt(0));me._selectButton("cap",newValue);me.values.cap=newValue;me._updatePreview(dialogContent)}),content.append(capBtnContainer);for(content=dialogContent.find("div.corner"),i=0;i<me.cornerButtonNames.length;i++)cornerBtnContainer=me.templateButton.clone(),cornerBtnContainer.addClass(me.cornerButtonNames[i]),cornerBtnContainer.attr("id",i+"linecorner"),i===me.values.corner&&this._styleSelectedButton(cornerBtnContainer),cornerBtnContainer.click(function(){newValue=parseInt(jQuery(this).attr("id").charAt(0));me._selectButton("corner",newValue);me.values.corner=newValue;me._updatePreview(dialogContent)}),content.append(cornerBtnContainer);for(content=dialogContent.find("div.width"),widthSpinner=me.templateWidthValue.clone(),widthSpinner.change(function(){var newValue=parseInt(widthSpinner.val(),10);isNaN(newValue)||(me.values.width=newValue,me._updatePreview())}),widthSpinner.val(me.values.width!==null&&me.values.width!==undefined?me.values.width:1),content.append(widthSpinner),statedChosenColor=!1,content=dialogContent.find(".color-rectangle"),i=0;i<me.basicColors.length;i++)colorCell=me.templateColorCell.clone(),colorCell.css("background-color",me.basicColors[i]),idExt="ColorCell",id=i+idExt,id.length===idExt.length+1&&(id="0"+id),colorCell.attr("id",id),colorCell.click(function(){jQuery(".color-source").prop("checked")||(cellIndex=parseInt(this.id.substring(0,2),10),cellIndex!==me.activeColorCell)&&(me.activeColorCell>-1&&(activeCell=me.activeColorCell.toString(),me.activeColorCell<10&&(activeCell="0"+activeCell),jQuery("#"+activeCell+"ColorCell").css("border","1px solid #000000")),me.values.color=me.creator.rgbToHex(this.style.backgroundColor),me.activeColorCell=cellIndex,cellIndex<10&&(cellIndex="0"+cellIndex.toString()),jQuery("#"+cellIndex+"ColorCell").css("border","3px solid #ffffff"),me._updatePreview(dialogContent))}),"#"+me.values.color===me.basicColors[i]&&(colorCell.css("border","3px solid #ffffff"),me.activeColorCell=i,statedChosenColor=!0),content.append(colorCell);return content=dialogContent.find(".color-source-selector"),colorCheckbox=me.templateColorSource.clone(),me.activeColorCell===-1&&colorCheckbox.attr("checked",!0),colorCheckbox.change(function(){var cell,activeCell;jQuery("input.custom-color").prop("disabled",!this.checked);cell=me.activeColorCell.toString();me.activeColorCell<10&&(cell="0"+cell);activeCell=jQuery("#"+cell+"ColorCell");this.checked&&(activeCell.css("border","1px solid #000000"),jQuery(".custom-red-value").val(parseInt(me.values.color.substring(0,2),16)),jQuery(".custom-green-value").val(parseInt(me.values.color.substring(2,4),16)),jQuery(".custom-blue-value").val(parseInt(me.values.color.substring(4),16)),me.activeColorCell=-1);me._updatePreview(dialogContent)}),content.prepend(colorCheckbox),statedChosenColor||(colorCheckbox.checked=!0,content.find("input.color-source").prop("disabled",!1).attr("checked","checked")),content=dialogContent.find(".custom-colors"),customColorEditor=this.templateCustomColor.clone(),content.append(customColorEditor),redValue=me.templateColorValue.clone(),redValue.addClass("custom-red-value"),me.activeColorCell===-1&&(redValue.val(parseInt(me.values.color.substring(0,2),16)),redValue.prop("disabled",!1)),dialogContent.find(".colorcolumn1").append(redValue),dialogContent.find("label.custom-red-value").text("R"),greenValue=me.templateColorValue.clone(),greenValue.addClass("custom-green-value"),me.activeColorCell===-1&&(greenValue.val(parseInt(me.values.color.substring(2,4),16)),greenValue.prop("disabled",!1)),dialogContent.find(".colorcolumn21").append(greenValue),dialogContent.find("label.custom-green-value").text("G"),blueValue=me.templateColorValue.clone(),blueValue.addClass("custom-blue-value"),me.activeColorCell===-1&&(blueValue.val(parseInt(me.values.color.substring(4),16)),blueValue.prop("disabled",!1)),dialogContent.find(".colorcolumn22").append(blueValue),dialogContent.find("label.custom-blue-value").text("B"),statedChosenColor||(rgb=me.creator.hexToRgb(me.values.color),dialogContent.find("input.custom-color.custom-red-value").val(rgb.r),dialogContent.find("input.custom-color.custom-green-value").val(rgb.g),dialogContent.find("input.custom-color.custom-blue-value").val(rgb.b),dialogContent.find("input.custom-color").prop("disabled",!1)),dialogContent.find(".custom-color").change(function(){var values=[],i,intValue;for(values[0]=jQuery("input.custom-color.custom-red-value").val(),values[1]=jQuery("input.custom-color.custom-green-value").val(),values[2]=jQuery("input.custom-color.custom-blue-value").val(),i=0;i<3;i++){if(intValue=parseInt(values[i],10),intValue<0||intValue>255)return;values[i]=intValue.toString(16);values[i].length===1&&(values[i]="0"+values[i])}me.values.color=values.join("");me._updatePreview()}),this._updatePreview(dialogContent),saveBtn=Oskari.clazz.create("Oskari.userinterface.component.Button"),saveBtn.setTitle(me.loc.buttons.save),saveBtn.addClass("primary showSelection"),saveBtn.setHandler(function(){renderDialog.close()}),cancelBtn=Oskari.clazz.create("Oskari.userinterface.component.Button"),cancelBtn.setTitle(me.loc.buttons.cancel),cancelBtn.setHandler(function(){me.values.size=me.defaultValues.size;me.values.color=me.defaultValues.color;me.values.shape=me.defaultValues.shape;renderDialog.close()}),renderDialog.show(title,dialogContent,[saveBtn,cancelBtn]),renderDialog.moveTo(renderButton,"top"),me._updatePreview(),renderDialog},_selectButton:function(property,selectedButton){this._styleUnselectedButton(jQuery("div#"+this.values[property]+"line"+property+".icon-button"));this._styleSelectedButton(jQuery("div#"+selectedButton+"line"+property+".icon-button"))},_updatePreview:function(dialog){var me=this,view=dialog===undefined||dialog===null?jQuery(".lineform"):dialog,content=view.find(".preview"),preview,p2b,p3a,p3b;if(content.length>0)preview=content.get(0),preview.children.length===0&&(this.paper=Raphael(preview,50,50));else return;var attributes={stroke:"#"+me.values.color,fill:"none","stroke-width":me.values.width,"stroke-linejoin":me.values.corner===0?"miter":"round","stroke-linecap":me.values.cap===0?"butt":"round","stroke-dasharray":me.values.style===1?"- ":""},p1=[10,15],p2=[20,35],p3=[40,25];if(this.paper.clear(),me.values.style!==2)this.paper.path("M"+p1[0]+","+p1[1]+"L"+p2+","+p3).attr(attributes);else{var d=1.5+.5*me.values.width,p1a=[p1[0]+2*d/Math.sqrt(5),p1[1]-d/Math.sqrt(5)],p1b=[p1[0]-2*d/Math.sqrt(5),p1[1]+d/Math.sqrt(5)],p2a=[];p2a[0]=p2[0]+.5*d*(Math.sqrt(3)-1);p2a[1]=p2[1]-.5*d*(Math.sqrt(3)+1);p2b=[];p2b[0]=p2[0]-.5*d*(Math.sqrt(3)-1);p2b[1]=p2[1]+.5*d*(Math.sqrt(3)+1);p3a=[p3[0]-d/Math.sqrt(5),p3[1]-2*d/Math.sqrt(5)];p3b=[p3[0]+d/Math.sqrt(5),p3[1]+2*d/Math.sqrt(5)];this.paper.path("M"+p1a[0]+","+p1a[1]+"L"+p2a+","+p3a+"M"+p1b[0]+","+p1b[1]+"L"+p2b+","+p3b).attr(attributes);this.paper.circle(0,0,0)}},_getOnScreenForm:function(){return jQuery("div.renderdialog")},_styleSelectedButton:function(selectedButton){selectedButton.css("border","2px solid");selectedButton.css("background-color",this.selectColor)},_styleUnselectedButton:function(unselectedButton){unselectedButton.css("border","1px solid");unselectedButton.css("background-color","transparent")}});Oskari.clazz.define("Oskari.userinterface.component.visualization-form.DotForm",function(creator,loc,defaultValues){this.creator=creator;this.loc=loc;this.defaultValues=defaultValues;this.values={size:this.defaultValues.size,color:this.defaultValues.color,shape:this.defaultValues.shape};this.minSize=this.defaultValues.dotMinSize!==null&&this.defaultValues.dotMinSize!==undefined?this.defaultValues.dotMinSize:1;this.maxSize=this.defaultValues.dotMaxSize?this.defaultValues.dotMaxSize:5;this.basicColors=["#ffffff","#666666","#ffde00","#f8931f","#ff3334","#bf2652","#000000","#cccccc","#652d90","#3233ff","#26bf4b","#00ff01"];this.paper=null;this.activeColorCell=6;this.symbolButtons={square:{iconCls:"marker-square",iconId:1,offset:[5,36],scale:2},dot:{iconCls:"marker-dot",iconId:5,offset:[5,30],scale:0},arrow:{iconCls:"marker-arrow",iconId:6,offset:[5,35],scale:2},pin:{iconCls:"marker-pin",iconId:3,offset:[2,35],scale:2},pin2:{iconCls:"marker-pin2",iconId:2,offset:[5,35],scale:2},stud:{iconCls:"marker-stud",iconId:0,offset:[2,35],scale:2},flag:{iconCls:"marker-flag",iconId:4,offset:[9,35],scale:2}};this.templateSymbolDialogContent=jQuery('<div class="pointform"><div class="container"><div class="column1"><label>'+this.loc.symbol.label+'<\/label><div class="symbols icon-buttons"><\/div><label>'+this.loc.size.label+'<\/label><br><div class="sizer-values"><\/div><div class="sizer"><\/div><\/div><div class="column2"><div class="column21"><label>'+this.loc.color.label+'<\/label><div class="color-grid"><div class="color-rectangle"><\/div><\/div><div class="color-label"><label>'+this.loc.color.labelOr+'<\/label><\/div><div class="color-source-selector"><label>'+this.loc.color.labelCustom+'<\/label><\/div><div class="custom-colors"><\/div><\/div><div class="column22"><label>'+this.loc.preview.label+'<\/label><div class="preview"><\/div><\/div><\/div><\/div><\/div>');this.templateSymbolButton=jQuery('<div class="icon-button"><\/div>');this.templateColorCell=jQuery('<div class="color-cell"><\/div>');this.templateCustomColor=jQuery('<div class="custom-color-editor"><div class="colorcontainer"><div class="colorcolumn1"><\/div><div class="colorcolumn2"><div class="colorcolumn21"><\/div><div class="colorcolumn22"><\/div><\/div><\/div>');this.templateColorSource=jQuery('<input type="checkbox" name="colorInput" value = "custom" class="color-source">');this.templateColorValue=jQuery('<label class="color-label"><\/label><br><input type="text" name="color-input" value="0" disabled="disabled" class="custom-color">');this.templateSizerValue=jQuery('<div class="sizer-value"><\/div>');this.previewSize=50},{getValues:function(){return{size:this.values.size,color:this.values.color,shape:this.values.shape}},setValues:function(values){values!==null&&values!==undefined&&jQuery.extend(!0,this.values,values)},showForm:function(renderButton,state){var me=this,renderDialog,statedChosenColor,colorCell,idExt,id,cellIndex,activeCell,colorCheckbox,customColorEditor,redValue,greenValue,blueValue,rgb,saveBtn,cancelBtn;state!==null&&state!==undefined&&jQuery.extend(!0,me.values,state.dot);renderDialog=Oskari.clazz.create("Oskari.userinterface.component.Popup");renderDialog.addClass("renderdialog");renderDialog.addClass("pointvisualization");var title=me.loc.title,dialogContent=me.templateSymbolDialogContent.clone(),content=dialogContent.find("div.symbols"),buttonName,btnContainer,button;for(buttonName in this.symbolButtons)this.symbolButtons.hasOwnProperty(buttonName)&&(btnContainer=this.templateSymbolButton.clone(),button=this.symbolButtons[buttonName],btnContainer.addClass(button.iconCls),btnContainer.attr("id",button.iconId+"marker"),button.iconId===parseInt(me.values.shape,10)&&btnContainer.css("border","2px solid"),btnContainer.click(function(){me.values.shape=parseInt(jQuery(this).attr("id").charAt(0),10);me._selectButton(me.values.shape);me._updatePreview(dialogContent)}),content.append(btnContainer));var numIntervals=me.maxSize-me.minSize,intervalWidth=110/numIntervals,numVisValues=0,i,newSizerValue,position;for(content=dialogContent.find(".sizer-values"),i=1;i<=10;i++)newSizerValue=me.templateSizerValue.clone(),newSizerValue.html(i),newSizerValue.addClass("value"+i),i<me.minSize||i>me.maxSize?newSizerValue.hide():(position=numVisValues*intervalWidth.toString()+"px",newSizerValue.css("left",position),newSizerValue.show(),numVisValues=numVisValues+1),content.append(newSizerValue);for(content=dialogContent.find(".sizer"),content.slider({range:"min",min:me.minSize,max:me.maxSize,value:this.values.size,slide:function(event,ui){me.values.size=ui.value;me._updatePreview(dialogContent)}}),statedChosenColor=!1,content=dialogContent.find(".color-rectangle"),i=0;i<me.basicColors.length;i++)colorCell=me.templateColorCell.clone(),colorCell.css("background-color",me.basicColors[i]),idExt="ColorCell",id=i+idExt,id.length===idExt.length+1&&(id="0"+id),colorCell.attr("id",id),colorCell.click(function(){jQuery(".color-source").prop("checked")||(cellIndex=parseInt(this.id.substring(0,2),10),cellIndex!==me.activeColorCell)&&(me.activeColorCell>-1&&(activeCell=me.activeColorCell.toString(),me.activeColorCell<10&&(activeCell="0"+activeCell),jQuery("#"+activeCell+"ColorCell").css("border","1px solid #000000")),me.values.color=me.creator.rgbToHex(this.style.backgroundColor),me.activeColorCell=cellIndex,cellIndex<10&&(cellIndex="0"+cellIndex.toString()),jQuery("#"+cellIndex+"ColorCell").css("border","3px solid #ffffff"),me._updatePreview(dialogContent))}),"#"+me.values.color===me.basicColors[i]&&(colorCell.css("border","3px solid #ffffff"),me.activeColorCell=i,statedChosenColor=!0),content.append(colorCell);return content=dialogContent.find(".color-source-selector"),colorCheckbox=me.templateColorSource.clone(),colorCheckbox.change(function(){jQuery("input.custom-color").prop("disabled",!this.checked);var activeCell=jQuery("#"+me.activeColorCell+"ColorCell");this.checked?activeCell.css("border","1px solid #000000"):activeCell.css("border","3px solid #ffffff");me._updatePreview(dialogContent)}),content.prepend(colorCheckbox),statedChosenColor||(colorCheckbox.checked=!0,content.find("input.color-source").prop("disabled",!1).attr("checked","checked")),content=dialogContent.find(".custom-colors"),customColorEditor=this.templateCustomColor.clone(),content.append(customColorEditor),redValue=me.templateColorValue.clone(),redValue.addClass("custom-red-value"),dialogContent.find(".colorcolumn1").append(redValue),dialogContent.find("label.custom-red-value").text("R"),greenValue=me.templateColorValue.clone(),greenValue.addClass("custom-green-value"),dialogContent.find(".colorcolumn21").append(greenValue),dialogContent.find("label.custom-green-value").text("G"),blueValue=me.templateColorValue.clone(),blueValue.addClass("custom-blue-value"),dialogContent.find(".colorcolumn22").append(blueValue),dialogContent.find("label.custom-blue-value").text("B"),statedChosenColor||(rgb=me.creator.hexToRgb(me.values.color),dialogContent.find("input.custom-color.custom-red-value").val(rgb.r),dialogContent.find("input.custom-color.custom-green-value").val(rgb.g),dialogContent.find("input.custom-color.custom-blue-value").val(rgb.b),dialogContent.find("input.custom-color").prop("disabled",!1)),dialogContent.find(".custom-color").change(function(){var values=[],i,intValue;for(values[0]=jQuery("input.custom-color.custom-red-value").val(),values[1]=jQuery("input.custom-color.custom-green-value").val(),values[2]=jQuery("input.custom-color.custom-blue-value").val(),i=0;i<3;i++){if(intValue=parseInt(values[i],10),intValue<0||intValue>255)return;values[i]=intValue.toString(16);values[i].length===1&&(values[i]="0"+values[i])}me.values.color=values.join("");me._updatePreview()}),this._updatePreview(dialogContent),saveBtn=Oskari.clazz.create("Oskari.userinterface.component.Button"),saveBtn.setTitle(me.loc.buttons.save),saveBtn.addClass("primary showSelection"),saveBtn.setHandler(function(){renderDialog.close()}),cancelBtn=Oskari.clazz.create("Oskari.userinterface.component.Button"),cancelBtn.setTitle(me.loc.buttons.cancel),cancelBtn.setHandler(function(){me.values.size=me.defaultValues.size;me.values.color=me.defaultValues.color;me.values.shape=me.defaultValues.shape;renderDialog.close()}),renderDialog.show(title,dialogContent,[saveBtn,cancelBtn]),renderDialog.moveTo(renderButton,"top"),renderDialog},_selectButton:function(selectedButton){var buttonName,button,container;for(buttonName in this.symbolButtons)this.symbolButtons.hasOwnProperty(buttonName)&&(button=this.symbolButtons[buttonName],container=jQuery("div#"+button.iconId+"marker.icon-button"),button.iconId.toString()===selectedButton.toString()?container.css("border","2px solid"):container.css("border","1px solid"))},_updatePreview:function(dialog){var me=this,view=dialog===undefined||dialog===null?jQuery(".pointform"):dialog,content=view.find(".preview"),preview,buttonName,button,font,baseFontIndex;if(content.length>0)preview=content.get(0),preview.children.length===0&&(this.paper=Raphael(preview,50,50));else return;var charIndex=0,offset=[0,0],scale=0;for(buttonName in me.symbolButtons)if(me.symbolButtons.hasOwnProperty(buttonName)&&(button=me.symbolButtons[buttonName],button.iconId.toString()===me.values.shape.toString())){charIndex=button.iconId;offset=button.offset;scale=button.scale;break}Raphael.registerFont({w:512,face:{"font-family":"dot-markers","font-weight":400,"font-stretch":"normal","units-per-em":"512","panose-1":"2 0 5 3 0 0 0 0 0 0",ascent:"480",descent:"-32",bbox:"0 -480 512 32","underline-thickness":"0","underline-position":"0","unicode-range":"U+E000-U+F000"},glyphs:{" ":{},"":{d:"288,-426v-21,-4,-35,-2,-42,5v-2,2,-2,4,-1,7v2,5,5,10,9,18v4,8,6,13,7,15v-3,3,-9,9,-18,17v-13,12,-13,12,-19,18v-7,7,-1,15,18,24v8,4,17,7,26,8v23,5,39,3,49,-5v3,-3,4,-6,3,-9r-9,-18v-4,-9,-4,-10,-8,-18v-3,-6,-4,-9,-5,-11v2,-2,2,-3,11,-11v9,-8,9,-8,15,-14v6,-5,1,-12,-15,-20v-7,-3,-14,-5,-21,-6xm262,-256r9,-48r-12,-2r-9,50r12,0"},"":{d:"320,-427r-127,0r0,126r35,0r28,45r28,-45r36,0r0,-126"},"":{d:"256,-429v-17,0,-30,5,-42,17v-12,12,-18,26,-18,43v0,10,5,24,15,43v10,19,20,35,30,48r15,21v40,-53,60,-90,60,-112v0,-17,-6,-31,-18,-43v-12,-12,-25,-17,-42,-17xm256,-344v-7,0,-12,-2,-17,-7v-5,-5,-7,-10,-7,-17v0,-7,2,-13,7,-18v5,-5,10,-7,17,-7v7,0,13,2,18,7v5,5,7,11,7,18v0,7,-2,12,-7,17v-5,5,-11,7,-18,7"},"":{d:"262,-257r17,-71r-12,-2r-17,73r12,0xm240,-380v0,12,4,22,12,31v8,9,19,13,31,13v12,0,22,-4,31,-13v9,-9,13,-19,13,-31v0,-12,-4,-22,-13,-30v-9,-8,-19,-13,-31,-13v-12,0,-23,5,-31,13v-8,8,-12,18,-12,30"},"":{d:"262,-257r41,-169r-13,0r-40,169r12,0xm164,-427r18,45r-38,44r115,0r21,-89r-116,0"},"":{d:"196,-256v0,17,6,30,18,42v12,12,25,18,42,18v17,0,30,-6,42,-18v12,-12,18,-25,18,-42v0,-17,-6,-30,-18,-42v-12,-12,-25,-18,-42,-18v-17,0,-30,6,-42,18v-12,12,-18,25,-18,42"},"":{d:"284,-331r0,-93r-56,0r0,93r-39,0r67,75r67,-75r-39,0"},"":{d:"0,-480r512,512r-512,0r0,-512",w:0},"":{}}});font=this.paper.getFont("dot-markers");baseFontIndex=57344;this.paper.clear();var x=offset[0]-this.values.size*5,y=offset[1]+this.values.size*scale,size=40+this.values.size*10;this.paper.print(x,y,String.fromCharCode(charIndex+baseFontIndex),font,size).attr({"stroke-width":1,fill:"#"+me.values.color,stroke:"#b4b4b4"});this.paper.circle(0,0,0)},_getOnScreenForm:function(){return jQuery("div.renderdialog")}});Oskari.clazz.define("Oskari.userinterface.extension.DefaultTile",function(instance,locale){this.locale=locale;this.instance=instance;this.container=null;this.template=null},{getName:function(){return"Oskari.userinterface.extension.DefaultTile"},setEl:function(el){this.container=$(el)},startPlugin:function(){},stopPlugin:function(){},getTitle:function(){return this.locale.title},getDescription:function(){return this.locale.description},getOptions:function(){},setState:function(state){this.state=state},getState:function(){return this.state}},{protocol:["Oskari.userinterface.Tile"]});Oskari.clazz.define("Oskari.userinterface.extension.DefaultFlyout",function(instance,locale){this.instance=instance;this.locale=locale;this.container=null},{getName:function(){return"Oskari.userinterface.extension.DefaultFlyout"},setEl:function(el){this.container=jQuery(el)},getEl:function(){return this.container},startPlugin:function(){},stopPlugin:function(){},getTitle:function(){return this.locale.title},getDescription:function(){return this.locale.description},setState:function(state){this.state=state},getState:function(){return this.state},getLocalization:function(){return this.locale}},{protocol:["Oskari.userinterface.Flyout"]});Oskari.clazz.define("Oskari.userinterface.extension.DefaultExtension",function(name,flyoutClazz,tileClazz,viewClazz){this.sandbox=null;this.plugins={};this._localization=null;this.conf={name:name,tileClazz:tileClazz||"Oskari.userinterface.extension.DefaultTile",flyoutClazz:flyoutClazz||"Oskari.userinterface.extension.DefaultFlyout",viewClazz:viewClazz}},{getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},getSandbox:function(){return this.sandbox},update:function(){},getLocalization:function(key){return(this._localization||(this._localization=Oskari.getLocalization(this.getName())),key)?this._localization[key]:this._localization},start:function(){var me=this,conf=this.conf,sandboxName=(conf?conf.sandbox:null)||"sandbox",sandbox=Oskari.getSandbox(sandboxName),request;me.sandbox=sandbox;sandbox.register(this);conf&&conf.stateful===!0&&sandbox.registerAsStateful(this.mediator.bundleId,this);request=sandbox.getRequestBuilder("userinterface.AddExtensionRequest")(this);sandbox.request(this,request)},stop:function(){var sandbox=this.sandbox,request=sandbox.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);sandbox.request(this,request);sandbox.unregisterStateful(this.mediator.bundleId);sandbox.unregister(this);this.sandbox=null;this.started=!1},startExtension:function(){var me=this,sandbox=me.sandbox,p,locFlyout,locTile,locView;for(p in me.eventHandlers)me.eventHandlers.hasOwnProperty(p)&&sandbox.registerForEventByName(me,p);locFlyout=me.getLocalization("flyout");locFlyout&&me.conf.flyoutClazz&&(me.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create(me.conf.flyoutClazz,me,locFlyout));locTile=me.getLocalization("tile");locTile&&me.conf.tileClazz&&(me.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create(me.conf.tileClazz,me,locTile));locView=me.getLocalization("view");locView&&me.conf.viewClazz&&(me.plugins["Oskari.userinterface.View"]=Oskari.clazz.create(me.conf.viewClazz,me,locView))},stopExtension:function(){var me=this,sandbox=me.sandbox,p,pluginType;for(p in me.eventHandlers)me.eventHandlers.hasOwnProperty(p)&&sandbox.unregisterFromEventByName(me,p);for(pluginType in me.plugins)me.plugins.hasOwnProperty(pluginType)&&pluginType&&(me.plugins[pluginType]=null)},getPlugins:function(){return this.plugins},init:function(){return null},getName:function(){return this.conf.name},getConfiguration:function(){return this.conf},eventHandlers:{},onEvent:function(event){var me=this,handler=me.eventHandlers[event.getName()];if(handler)return handler.apply(this,[event])},getLang:function(){return Oskari.getLang()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]});Oskari.clazz.define("Oskari.userinterface.extension.DefaultView",function(instance,locale){this.instance=instance;this.locale=locale;this.container=null},{getName:function(){return"Oskari.userinterface.extension.DefaultView"},setEl:function(el){this.container=jQuery(el)},getEl:function(){return this.container},startPlugin:function(){},stopPlugin:function(){},getTitle:function(){return this.locale.title},getDescription:function(){return this.locale.description},setState:function(state){this.state=state},getState:function(){return this.state},getLocalization:function(){return this.locale}},{protocol:["Oskari.userinterface.View"]});Oskari.clazz.define("Oskari.userinterface.extension.DefaultLayout",function(instance,locale){this.instance=instance;this.locale=locale;this.container=null},{getName:function(){return"Oskari.userinterface.extension.DefaultLayout"},setEl:function(el){this.container=jQuery(el)},getEl:function(){return this.container},startPlugin:function(){},stopPlugin:function(){},getTitle:function(){return this.locale.title},getDescription:function(){return this.locale.description},setState:function(state){this.state=state},getState:function(){return this.state},getLocalization:function(){return this.locale}},{protocol:["Oskari.userinterface.Layout"]});!function(a){var b,c,d="0.4.2",e="hasOwnProperty",f=/[\.\/]/,g="*",h=function(){},i=function(a,b){return a-b},j={n:{}},k=function(a,d){var p,q;a=String(a);var e,f=c,g=Array.prototype.slice.call(arguments,2),h=k.listeners(a),j=0,l=[],m={},n=[],o=b;for(b=a,c=0,p=0,q=h.length;q>p;p++)"zIndex"in h[p]&&(l.push(h[p].zIndex),h[p].zIndex<0&&(m[h[p].zIndex]=h[p]));for(l.sort(i);l[j]<0;)if(e=m[l[j++]],n.push(e.apply(d,g)),c)return c=f,n;for(p=0;q>p;p++)if(e=h[p],"zIndex"in e)if(e.zIndex==l[j]){if(n.push(e.apply(d,g)),c)break;do if(j++,e=m[l[j]],e&&n.push(e.apply(d,g)),c)break;while(e)}else m[e.zIndex]=e;else if(n.push(e.apply(d,g)),c)break;return c=f,b=o,n.length?n:null};k._events=j;k.listeners=function(a){for(var b,c,d,i,k,l,m=a.split(f),n=j,o=[n],p=[],e=0,h=m.length;h>e;e++){for(l=[],i=0,k=o.length;k>i;i++)for(n=o[i].n,c=[n[m[e]],n[g]],d=2;d--;)b=c[d],b&&(l.push(b),p=p.concat(b.f||[]));o=l}return p};k.on=function(a,b){if(a=String(a),"function"!=typeof b)return function(){};for(var c=a.split(f),d=j,e=0,g=c.length;g>e;e++)d=d.n,d=d.hasOwnProperty(c[e])&&d[c[e]]||(d[c[e]]={n:{}});for(d.f=d.f||[],e=0,g=d.f.length;g>e;e++)if(d.f[e]==b)return h;return d.f.push(b),function(a){+a==+a&&(b.zIndex=+a)}};k.f=function(a){var b=[].slice.call(arguments,1);return function(){k.apply(null,[a,null].concat(b).concat([].slice.call(arguments,0)))}};k.stop=function(){c=1};k.nt=function(a){return a?new RegExp("(?:\\.|\\/|^)"+a+"(?:\\.|\\/|$)").test(b):b};k.nts=function(){return b.split(f)};k.off=k.unbind=function(a,b){var c,d,h,i,l,m,n,o,p,q;if(!a)return k._events=j={n:{}},void 0;for(o=a.split(f),p=[j],i=0,l=o.length;l>i;i++)for(m=0;m<p.length;m+=h.length-2){if(h=[m,1],c=p[m].n,o[i]!=g)c[o[i]]&&h.push(c[o[i]]);else for(d in c)c[e](d)&&h.push(c[d]);p.splice.apply(p,h)}for(i=0,l=p.length;l>i;i++)for(c=p[i];c.n;){if(b){if(c.f){for(m=0,n=c.f.length;n>m;m++)if(c.f[m]==b){c.f.splice(m,1);break}c.f.length||delete c.f}for(d in c.n)if(c.n[e](d)&&c.n[d].f){for(q=c.n[d].f,m=0,n=q.length;n>m;m++)if(q[m]==b){q.splice(m,1);break}q.length||delete c.n[d].f}}else{delete c.f;for(d in c.n)c.n[e](d)&&c.n[d].f&&delete c.n[d].f}c=c.n}};k.once=function(a,b){var c=function(){return k.unbind(a,c),b.apply(this,arguments)};return k.on(a,c)};k.version=d;k.toString=function(){return"You are running Eve "+d};"undefined"!=typeof module&&module.exports?module.exports=k:"undefined"!=typeof define?define("eve",[],function(){return k}):a.eve=k}(this),function(a,b){"function"==typeof define&&define.amd?define(["eve"],function(c){return b(a,c)}):b(a,a.eve)}(this,function(a,b){function c(a){var d,e;return c.is(a,"function")?u?a():b.on("raphael.DOMload",a):c.is(a,V)?c._engine.create[D](c,a.splice(0,3+c.is(a[0],T))).add(a):(d=Array.prototype.slice.call(arguments,0),c.is(d[d.length-1],"function"))?(e=d.pop(),u?e.call(c._engine.create[D](c,d)):b.on("raphael.DOMload",function(){e.call(c._engine.create[D](c,d))})):c._engine.create[D](c,arguments)}function d(a){var b,c;if("function"==typeof a||Object(a)!==a)return a;b=new a.constructor;for(c in a)a[z](c)&&(b[c]=d(a[c]));return b}function e(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return a.push(a.splice(c,1)[0])}function f(a,b,c){function d(){var f=Array.prototype.slice.call(arguments,0),g=f.join(""),h=d.cache=d.cache||{},i=d.count=d.count||[];return h[z](g)?(e(i,g),c?c(h[g]):h[g]):(i.length>=1e3&&delete h[i.shift()],i.push(g),h[g]=a[D](b,f),c?c(h[g]):h[g])}return d}function g(){return this.hex}function h(a,b){for(var f,c=[],d=0,e=a.length;e-2*!b>d;d+=2)f=[{x:+a[d-2],y:+a[d-1]},{x:+a[d],y:+a[d+1]},{x:+a[d+2],y:+a[d+3]},{x:+a[d+4],y:+a[d+5]}],b?d?e-4==d?f[3]={x:+a[0],y:+a[1]}:e-2==d&&(f[2]={x:+a[0],y:+a[1]},f[3]={x:+a[2],y:+a[3]}):f[0]={x:+a[e-2],y:+a[e-1]}:e-4==d?f[3]=f[2]:d||(f[0]={x:+a[d],y:+a[d+1]}),c.push(["C",(-f[0].x+6*f[1].x+f[2].x)/6,(-f[0].y+6*f[1].y+f[2].y)/6,(f[1].x+6*f[2].x-f[3].x)/6,(f[1].y+6*f[2].y-f[3].y)/6,f[2].x,f[2].y]);return c}function i(a,b,c,d,e){var f=-3*b+9*c-9*d+3*e,g=a*f+6*b-12*c+6*d;return a*g-3*b+3*c}function j(a,b,c,d,e,f,g,h,j){null==j&&(j=1);j=j>1?1:0>j?0:j;for(var k=j/2,m=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],n=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],o=0,p=0;12>p;p++){var q=k*m[p]+k,r=i(q,a,c,e,g),s=i(q,b,d,f,h),t=r*r+s*s;o+=n[p]*N.sqrt(t)}return k*o}function k(a,b,c,d,e,f,g,h,i){if(!(0>i||j(a,b,c,d,e,f,g,h)<i)){for(var l=1,m=l/2,n=l-m,k=j(a,b,c,d,e,f,g,h,n);Q(k-i)>.01;)m/=2,n+=(i>k?1:-1)*m,k=j(a,b,c,d,e,f,g,h,n);return n}}function l(a,b,c,d,e,f,g,h){if(!(O(a,c)<P(e,g)||P(a,c)>O(e,g)||O(b,d)<P(f,h)||P(b,d)>O(f,h))){var i=(a*d-b*c)*(e-g)-(a-c)*(e*h-f*g),j=(a*d-b*c)*(f-h)-(b-d)*(e*h-f*g),k=(a-c)*(f-h)-(b-d)*(e-g);if(k){var l=i/k,m=j/k,n=+l.toFixed(2),o=+m.toFixed(2);if(!(n<+P(a,c).toFixed(2)||n>+O(a,c).toFixed(2)||n<+P(e,g).toFixed(2)||n>+O(e,g).toFixed(2)||o<+P(b,d).toFixed(2)||o>+O(b,d).toFixed(2)||o<+P(f,h).toFixed(2)||o>+O(f,h).toFixed(2)))return{x:l,y:m}}}}function m(a,b,d){var e=c.bezierBBox(a),f=c.bezierBBox(b),r,s,A,B;if(!c.isBBoxIntersect(e,f))return d?0:[];for(var g=j.apply(0,a),h=j.apply(0,b),i=O(~~(g/5),1),k=O(~~(h/5),1),m=[],n=[],o={},p=d?0:[],q=0;i+1>q;q++)r=c.findDotsAtSegment.apply(c,a.concat(q/i)),m.push({x:r.x,y:r.y,t:q/i});for(q=0;k+1>q;q++)r=c.findDotsAtSegment.apply(c,b.concat(q/k)),n.push({x:r.x,y:r.y,t:q/k});for(q=0;i>q;q++)for(s=0;k>s;s++){var t=m[q],u=m[q+1],v=n[s],w=n[s+1],x=Q(u.x-t.x)<.001?"y":"x",y=Q(w.x-v.x)<.001?"y":"x",z=l(t.x,t.y,u.x,u.y,v.x,v.y,w.x,w.y);if(z){if(o[z.x.toFixed(4)]==z.y.toFixed(4))continue;o[z.x.toFixed(4)]=z.y.toFixed(4);A=t.t+Q((z[x]-t[x])/(u[x]-t[x]))*(u.t-t.t);B=v.t+Q((z[y]-v[y])/(w[y]-v[y]))*(w.t-v.t);A>=0&&1.001>=A&&B>=0&&1.001>=B&&(d?p++:p.push({x:z.x,y:z.y,t1:P(A,1),t2:P(B,1)}))}}return p}function n(a,b,d){var s,t,u,v,w,x,y;a=c._path2curve(a);b=c._path2curve(b);for(var e,f,g,h,i,j,k,l,n,o,p=d?0:[],q=0,r=a.length;r>q;q++)if(s=a[q],"M"==s[0])e=i=s[1],f=j=s[2];else for("C"==s[0]?(n=[e,f].concat(s.slice(1)),e=n[6],f=n[7]):(n=[e,f,e,f,i,j,i,j],e=i,f=j),t=0,u=b.length;u>t;t++)if(v=b[t],"M"==v[0])g=k=v[1],h=l=v[2];else if("C"==v[0]?(o=[g,h].concat(v.slice(1)),g=o[6],h=o[7]):(o=[g,h,g,h,k,l,k,l],g=k,h=l),w=m(n,o,d),d)p+=w;else{for(x=0,y=w.length;y>x;x++)w[x].segment1=q,w[x].segment2=t,w[x].bez1=n,w[x].bez2=o;p=p.concat(w)}return p}function o(a,b,c,d,e,f){null!=a?(this.a=+a,this.b=+b,this.c=+c,this.d=+d,this.e=+e,this.f=+f):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}function p(){return this.x+H+this.y+H+this.width+"  "+this.height}function q(a,b,c,d,e,f){function g(a){return((l*a+k)*a+j)*a}function h(a,b){var c=i(a,b);return((o*c+n)*c+m)*c}function i(a,b){for(var c,d,f,h,e=a,i=0;8>i;i++){if(f=g(e)-a,Q(f)<b)return e;if(h=(3*l*e+2*k)*e+j,Q(h)<1e-6)break;e-=f/h}if(c=0,d=1,e=a,c>e)return c;if(e>d)return d;for(;d>c;){if(f=g(e),Q(f-a)<b)return e;a>f?c=e:d=e;e=(d-c)/2+c}return e}var j=3*b,k=3*(d-b)-j,l=1-j-k,m=3*c,n=3*(e-c)-m,o=1-m-n;return h(a,1/(200*f))}function r(a,b){var c=[],d={},e;if(this.ms=b,this.times=1,a){for(e in a)a[z](e)&&(d[_(e)]=a[e],c.push(_(e)));c.sort(lb)}this.anim=d;this.top=c[c.length-1];this.percents=c}function s(a,d,e,f,g,h){var u,v,x,y,A,B,C,D,F,G,H,K,L,M,N,O,P,Q;e=_(e);var i,j,k,l,m,n,p=a.ms,r={},s={},t={};if(f){for(v=0,x=ic.length;x>v;v++)if(u=ic[v],u.el.id==d.id&&u.anim==a){u.percent!=e?(ic.splice(v,1),k=1):j=u;d.attr(u.totalOrigin);break}}else f=+s;for(v=0,x=a.percents.length;x>v;v++){if(a.percents[v]==e||a.percents[v]>f*a.top){e=a.percents[v];m=a.percents[v-1]||0;p=p/a.top*(e-m);l=a.percents[v+1];i=a.anim[e];break}f&&d.attr(a.anim[a.percents[v]])}if(i){if(j)j.initstatus=f,j.start=new Date-j.ms*f;else{for(y in i)if(i[z](y)&&(db[z](y)||d.paper.customAttributes[z](y)))switch(r[y]=d.attr(y),null==r[y]&&(r[y]=cb[y]),s[y]=i[y],db[y]){case T:t[y]=(s[y]-r[y])/p;break;case"colour":r[y]=c.getRGB(r[y]);A=c.getRGB(s[y]);t[y]={r:(A.r-r[y].r)/p,g:(A.g-r[y].g)/p,b:(A.b-r[y].b)/p};break;case"path":for(B=Kb(r[y],s[y]),C=B[1],r[y]=B[0],t[y]=[],v=0,x=r[y].length;x>v;v++)for(t[y][v]=[0],D=1,F=r[y][v].length;F>D;D++)t[y][v][D]=(C[v][D]-r[y][v][D])/p;break;case"transform":if(G=d._,H=Pb(G[y],s[y]),H)for(r[y]=H.from,s[y]=H.to,t[y]=[],t[y].real=!0,v=0,x=r[y].length;x>v;v++)for(t[y][v]=[r[y][v][0]],D=1,F=r[y][v].length;F>D;D++)t[y][v][D]=(s[y][v][D]-r[y][v][D])/p;else K=d.matrix||new o,L={_:{transform:G.transform},getBBox:function(){return d.getBBox(1)}},r[y]=[K.a,K.b,K.c,K.d,K.e,K.f],Nb(L,s[y]),s[y]=L._.transform,t[y]=[(L.matrix.a-K.a)/p,(L.matrix.b-K.b)/p,(L.matrix.c-K.c)/p,(L.matrix.d-K.d)/p,(L.matrix.e-K.e)/p,(L.matrix.f-K.f)/p];break;case"csv":if(M=I(i[y])[J](w),N=I(r[y])[J](w),"clip-rect"==y)for(r[y]=N,t[y]=[],v=N.length;v--;)t[y][v]=(M[v]-r[y][v])/p;s[y]=M;break;default:for(M=[][E](i[y]),N=[][E](r[y]),t[y]=[],v=d.paper.customAttributes[y].length;v--;)t[y][v]=((M[v]||0)-(N[v]||0))/p}if(O=i.easing,P=c.easing_formulas[O],P||((P=I(O).match(Z),P&&5==P.length)?(Q=P,P=function(a){return q(a,+Q[1],+Q[2],+Q[3],+Q[4],p)}):P=nb),n=i.start||a.start||+new Date,u={anim:a,percent:e,timestamp:n,start:n+(a.del||0),status:0,initstatus:f||0,stop:!1,ms:p,easing:P,from:r,diff:t,to:s,el:d,callback:i.callback,prev:m,next:l,repeat:h||a.times,origin:d.attr(),totalOrigin:g},ic.push(u),f&&!j&&!k&&(u.stop=!0,u.start=new Date-p*f,1==ic.length))return kc();k&&(u.start=new Date-u.ms*f);1==ic.length&&jc(kc)}b("raphael.anim.start."+d.id,d,a)}}function t(a){for(var b=0;b<ic.length;b++)ic[b].el.paper==a&&ic.splice(b--,1)}var sb,tb,Ab,Qb,ac,bc,hc,mc,nc,oc;c.version="2.1.2";c.eve=b;var u,v,w=/[, ]+/,x={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},y=/\{(\d+)\}/g,z="hasOwnProperty",A={doc:document,win:a},B={was:Object.prototype[z].call(A.win,"Raphael"),is:A.win.Raphael},C=function(){this.ca=this.customAttributes={}},D="apply",E="concat",F="ontouchstart"in A.win||A.win.DocumentTouch&&A.doc instanceof DocumentTouch,G="",H=" ",I=String,J="split",K="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[J](H),L={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},M=I.prototype.toLowerCase,N=Math,O=N.max,P=N.min,Q=N.abs,R=N.pow,S=N.PI,T="number",U="string",V="array",W=Object.prototype.toString,X=(c._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i,/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i),Y={NaN:1,Infinity:1,"-Infinity":1},Z=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,$=N.round,_=parseFloat,ab=parseInt,bb=I.prototype.toUpperCase,cb=c._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},db=c._availableAnimAttrs={blur:T,"clip-rect":"csv",cx:T,cy:T,fill:"colour","fill-opacity":T,"font-size":T,height:T,opacity:T,path:"path",r:T,rx:T,ry:T,stroke:"colour","stroke-opacity":T,"stroke-width":T,transform:"transform",width:T,x:T,y:T},eb=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,fb={hs:1,rg:1},gb=/,?([achlmqrstvxz]),?/gi,hb=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,ib=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,jb=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,kb=(c._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,{}),lb=function(a,b){return _(a)-_(b)},mb=function(){},nb=function(a){return a},ob=c._rectPath=function(a,b,c,d,e){return e?[["M",a+e,b],["l",c-2*e,0],["a",e,e,0,0,1,e,e],["l",0,d-2*e],["a",e,e,0,0,1,-e,e],["l",2*e-c,0],["a",e,e,0,0,1,-e,-e],["l",0,2*e-d],["a",e,e,0,0,1,e,-e],["z"]]:[["M",a,b],["l",c,0],["l",0,d],["l",-c,0],["z"]]},pb=function(a,b,c,d){return null==d&&(d=c),[["M",a,b],["m",0,-d],["a",c,d,0,1,1,0,2*d],["a",c,d,0,1,1,0,-2*d],["z"]]},qb=c._getPath={path:function(a){return a.attr("path")},circle:function(a){var b=a.attrs;return pb(b.cx,b.cy,b.r)},ellipse:function(a){var b=a.attrs;return pb(b.cx,b.cy,b.rx,b.ry)},rect:function(a){var b=a.attrs;return ob(b.x,b.y,b.width,b.height,b.r)},image:function(a){var b=a.attrs;return ob(b.x,b.y,b.width,b.height)},text:function(a){var b=a._getBBox();return ob(b.x,b.y,b.width,b.height)},set:function(a){var b=a._getBBox();return ob(b.x,b.y,b.width,b.height)}},rb=c.mapPath=function(a,b){if(!b)return a;var c,d,e,f,g,h,i;for(a=Kb(a),e=0,g=a.length;g>e;e++)for(i=a[e],f=1,h=i.length;h>f;f+=2)c=b.x(i[f],i[f+1]),d=b.y(i[f],i[f+1]),i[f]=c,i[f+1]=d;return a};if(c._g=A,c.type=A.win.SVGAngle||A.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML","VML"==c.type){if(tb=A.doc.createElement("div"),tb.innerHTML='<v:shape adj="1"/>',sb=tb.firstChild,sb.style.behavior="url(#default#VML)",!sb||"object"!=typeof sb.adj)return c.type=G;tb=null}c.svg=!(c.vml="VML"==c.type);c._Paper=C;c.fn=v=C.prototype=c.prototype;c._id=0;c._oid=0;c.is=function(a,b){return b=M.call(b),"finite"==b?!Y[z](+a):"array"==b?a instanceof Array:"null"==b&&null===a||b==typeof a&&null!==a||"object"==b&&a===Object(a)||"array"==b&&Array.isArray&&Array.isArray(a)||W.call(a).slice(8,-1).toLowerCase()==b};c.angle=function(a,b,d,e,f,g){if(null==f){var h=a-d,i=b-e;return h||i?(180+180*N.atan2(-i,-h)/S+360)%360:0}return c.angle(a,b,f,g)-c.angle(d,e,f,g)};c.rad=function(a){return a%360*S/180};c.deg=function(a){return 180*a/S%360};c.snapTo=function(a,b,d){var e,f;if(d=c.is(d,"finite")?d:10,c.is(a,V)){for(e=a.length;e--;)if(Q(a[e]-b)<=d)return a[e]}else{if(a=+a,f=b%a,d>f)return b-f;if(f>a-d)return b-f+a}return b};c.createUUID=function(a,b){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(a,b).toUpperCase()}}(/[xy]/g,function(a){var b=0|16*N.random(),c="x"==a?b:8|3&b;return c.toString(16)});c.setWindow=function(a){b("raphael.setWindow",c,A.win,a);A.win=a;A.doc=A.win.document;c._engine.initWin&&c._engine.initWin(A.win)};var ub=function(a){var b,d,e,h,i;if(c.vml){d=/^\s+|\s+$/g;try{e=new ActiveXObject("htmlfile");e.write("<body>");e.close();b=e.body}catch(g){b=createPopup().document.body}h=b.createTextRange();ub=f(function(a){try{b.style.color=I(a).replace(d,G);var c=h.queryCommandValue("ForeColor");return c=(255&c)<<16|65280&c|(16711680&c)>>>16,"#"+("000000"+c.toString(16)).slice(-6)}catch(e){return"none"}})}else i=A.doc.createElement("i"),i.title="Raphal Colour Picker",i.style.display="none",A.doc.body.appendChild(i),ub=f(function(a){return i.style.color=a,A.doc.defaultView.getComputedStyle(i,G).getPropertyValue("color")});return ub(a)},vb=function(){return"hsb("+[this.h,this.s,this.b]+")"},wb=function(){return"hsl("+[this.h,this.s,this.l]+")"},xb=function(){return this.hex},yb=function(a,b,d){if(null==b&&c.is(a,"object")&&"r"in a&&"g"in a&&"b"in a&&(d=a.b,b=a.g,a=a.r),null==b&&c.is(a,U)){var e=c.getRGB(a);a=e.r;b=e.g;d=e.b}return(a>1||b>1||d>1)&&(a/=255,b/=255,d/=255),[a,b,d]},zb=function(a,b,d,e){a*=255;b*=255;d*=255;var f={r:a,g:b,b:d,hex:c.rgb(a,b,d),toString:xb};return c.is(e,"finite")&&(f.opacity=e),f};c.color=function(a){var b;return c.is(a,"object")&&"h"in a&&"s"in a&&"b"in a?(b=c.hsb2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.hex=b.hex):c.is(a,"object")&&"h"in a&&"s"in a&&"l"in a?(b=c.hsl2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.hex=b.hex):(c.is(a,"string")&&(a=c.getRGB(a)),c.is(a,"object")&&"r"in a&&"g"in a&&"b"in a?(b=c.rgb2hsl(a),a.h=b.h,a.s=b.s,a.l=b.l,b=c.rgb2hsb(a),a.v=b.b):(a={hex:"none"},a.r=a.g=a.b=a.h=a.s=a.v=a.l=-1)),a.toString=xb,a};c.hsb2rgb=function(a,b,c,d){this.is(a,"object")&&"h"in a&&"s"in a&&"b"in a&&(c=a.b,b=a.s,a=a.h,d=a.o);a*=360;var e,f,g,h,i;return a=a%360/60,i=c*b,h=i*(1-Q(a%2-1)),e=f=g=c-i,a=~~a,e+=[i,h,0,0,h,i][a],f+=[h,i,i,h,0,0][a],g+=[0,0,h,i,i,h][a],zb(e,f,g,d)};c.hsl2rgb=function(a,b,c,d){this.is(a,"object")&&"h"in a&&"s"in a&&"l"in a&&(c=a.l,b=a.s,a=a.h);(a>1||b>1||c>1)&&(a/=360,b/=100,c/=100);a*=360;var e,f,g,h,i;return a=a%360/60,i=2*b*(.5>c?c:1-c),h=i*(1-Q(a%2-1)),e=f=g=c-i/2,a=~~a,e+=[i,h,0,0,h,i][a],f+=[h,i,i,h,0,0][a],g+=[0,0,h,i,i,h][a],zb(e,f,g,d)};c.rgb2hsb=function(a,b,c){c=yb(a,b,c);a=c[0];b=c[1];c=c[2];var d,e,f,g;return f=O(a,b,c),g=f-P(a,b,c),d=0==g?null:f==a?(b-c)/g:f==b?(c-a)/g+2:(a-b)/g+4,d=(d+360)%6/6,e=0==g?0:g/f,{h:d,s:e,b:f,toString:vb}};c.rgb2hsl=function(a,b,c){c=yb(a,b,c);a=c[0];b=c[1];c=c[2];var d,e,f,g,h,i;return g=O(a,b,c),h=P(a,b,c),i=g-h,d=0==i?null:g==a?(b-c)/i:g==b?(c-a)/i+2:(a-b)/i+4,d=(d+360)%6/6,f=(g+h)/2,e=0==i?0:.5>f?i/(2*f):i/(2-2*f),{h:d,s:e,l:f,toString:wb}};c._path2string=function(){return this.join(",").replace(gb,"$1")};c._preload=function(a,b){var c=A.doc.createElement("img");c.style.cssText="position:absolute;left:-9999em;top:-9999em";c.onload=function(){b.call(this);this.onload=null;A.doc.body.removeChild(this)};c.onerror=function(){A.doc.body.removeChild(this)};A.doc.body.appendChild(c);c.src=a};c.getRGB=f(function(a){if(!a||(a=I(a)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:g};if("none"==a)return{r:-1,g:-1,b:-1,hex:"none",toString:g};fb[z](a.toLowerCase().substring(0,2))||"#"==a.charAt()||(a=ub(a));var b,d,e,f,h,i,j=a.match(X);return j?(j[2]&&(e=ab(j[2].substring(5),16),d=ab(j[2].substring(3,5),16),b=ab(j[2].substring(1,3),16)),j[3]&&(e=ab((h=j[3].charAt(3))+h,16),d=ab((h=j[3].charAt(2))+h,16),b=ab((h=j[3].charAt(1))+h,16)),j[4]&&(i=j[4][J](eb),b=_(i[0]),"%"==i[0].slice(-1)&&(b*=2.55),d=_(i[1]),"%"==i[1].slice(-1)&&(d*=2.55),e=_(i[2]),"%"==i[2].slice(-1)&&(e*=2.55),"rgba"==j[1].toLowerCase().slice(0,4)&&(f=_(i[3])),i[3]&&"%"==i[3].slice(-1)&&(f/=100)),j[5]?(i=j[5][J](eb),b=_(i[0]),"%"==i[0].slice(-1)&&(b*=2.55),d=_(i[1]),"%"==i[1].slice(-1)&&(d*=2.55),e=_(i[2]),"%"==i[2].slice(-1)&&(e*=2.55),("deg"==i[0].slice(-3)||""==i[0].slice(-1))&&(b/=360),"hsba"==j[1].toLowerCase().slice(0,4)&&(f=_(i[3])),i[3]&&"%"==i[3].slice(-1)&&(f/=100),c.hsb2rgb(b,d,e,f)):j[6]?(i=j[6][J](eb),b=_(i[0]),"%"==i[0].slice(-1)&&(b*=2.55),d=_(i[1]),"%"==i[1].slice(-1)&&(d*=2.55),e=_(i[2]),"%"==i[2].slice(-1)&&(e*=2.55),("deg"==i[0].slice(-3)||""==i[0].slice(-1))&&(b/=360),"hsla"==j[1].toLowerCase().slice(0,4)&&(f=_(i[3])),i[3]&&"%"==i[3].slice(-1)&&(f/=100),c.hsl2rgb(b,d,e,f)):(j={r:b,g:d,b:e,toString:g},j.hex="#"+(16777216|e|d<<8|b<<16).toString(16).slice(1),c.is(f,"finite")&&(j.opacity=f),j)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:g}},c);c.hsb=f(function(a,b,d){return c.hsb2rgb(a,b,d).hex});c.hsl=f(function(a,b,d){return c.hsl2rgb(a,b,d).hex});c.rgb=f(function(a,b,c){return"#"+(16777216|c|b<<8|a<<16).toString(16).slice(1)});c.getColor=function(a){var b=this.getColor.start=this.getColor.start||{h:0,s:1,b:a||.75},c=this.hsb2rgb(b.h,b.s,b.b);return b.h+=.075,b.h>1&&(b.h=0,b.s-=.2,b.s<=0&&(this.getColor.start={h:0,s:1,b:b.b})),c.hex};c.getColor.reset=function(){delete this.start};c.parsePathString=function(a){var b,d,e;return a?(b=Ab(a),b.arr)?Cb(b.arr):(d={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},e=[],c.is(a,V)&&c.is(a[0],V)&&(e=Cb(a)),e.length||I(a).replace(hb,function(a,b,c){var f=[],g=b.toLowerCase();if(c.replace(jb,function(a,b){b&&f.push(+b)}),"m"==g&&f.length>2&&(e.push([b][E](f.splice(0,2))),g="l",b="m"==b?"l":"L"),"r"==g)e.push([b][E](f));else for(;f.length>=d[g]&&(e.push([b][E](f.splice(0,d[g]))),d[g]););}),e.toString=c._path2string,b.arr=Cb(e),e):null};c.parseTransformString=f(function(a){if(!a)return null;var b=[];return c.is(a,V)&&c.is(a[0],V)&&(b=Cb(a)),b.length||I(a).replace(ib,function(a,c,d){var e=[];M.call(c);d.replace(jb,function(a,b){b&&e.push(+b)});b.push([c][E](e))}),b.toString=c._path2string,b});Ab=function(a){var b=Ab.ps=Ab.ps||{};return b[a]?b[a].sleep=100:b[a]={sleep:100},setTimeout(function(){for(var c in b)b[z](c)&&c!=a&&(b[c].sleep--,!b[c].sleep&&delete b[c])}),b[a]};c.findDotsAtSegment=function(a,b,c,d,e,f,g,h,i){var j=1-i,k=R(j,3),l=R(j,2),m=i*i,n=m*i,o=k*a+3*l*i*c+3*j*i*i*e+n*g,p=k*b+3*l*i*d+3*j*i*i*f+n*h,q=a+2*i*(c-a)+m*(e-2*c+a),r=b+2*i*(d-b)+m*(f-2*d+b),s=c+2*i*(e-c)+m*(g-2*e+c),t=d+2*i*(f-d)+m*(h-2*f+d),u=j*a+i*c,v=j*b+i*d,w=j*e+i*g,x=j*f+i*h,y=90-180*N.atan2(q-s,r-t)/S;return(q>s||t>r)&&(y+=180),{x:o,y:p,m:{x:q,y:r},n:{x:s,y:t},start:{x:u,y:v},end:{x:w,y:x},alpha:y}};c.bezierBBox=function(a,b,d,e,f,g,h,i){c.is(a,"array")||(a=[a,b,d,e,f,g,h,i]);var j=Jb.apply(null,a);return{x:j.min.x,y:j.min.y,x2:j.max.x,y2:j.max.y,width:j.max.x-j.min.x,height:j.max.y-j.min.y}};c.isPointInsideBBox=function(a,b,c){return b>=a.x&&b<=a.x2&&c>=a.y&&c<=a.y2};c.isBBoxIntersect=function(a,b){var d=c.isPointInsideBBox;return d(b,a.x,a.y)||d(b,a.x2,a.y)||d(b,a.x,a.y2)||d(b,a.x2,a.y2)||d(a,b.x,b.y)||d(a,b.x2,b.y)||d(a,b.x,b.y2)||d(a,b.x2,b.y2)||(a.x<b.x2&&a.x>b.x||b.x<a.x2&&b.x>a.x)&&(a.y<b.y2&&a.y>b.y||b.y<a.y2&&b.y>a.y)};c.pathIntersection=function(a,b){return n(a,b)};c.pathIntersectionNumber=function(a,b){return n(a,b,1)};c.isPointInsidePath=function(a,b,d){var e=c.pathBBox(a);return c.isPointInsideBBox(e,b,d)&&1==n(a,[["M",b,d],["H",e.x2+10]],1)%2};c._removedFactory=function(a){return function(){b("raphael.log",null,"Raphal: you are calling to method "+a+" of removed object",a)}};var Bb=c.pathBBox=function(a){var b=Ab(a),k;if(b.bbox)return d(b.bbox);if(!a)return{x:0,y:0,width:0,height:0,x2:0,y2:0};a=Kb(a);for(var c,e=0,f=0,g=[],h=[],i=0,j=a.length;j>i;i++)(c=a[i],"M"==c[0])?(e=c[1],f=c[2],g.push(e),h.push(f)):(k=Jb(e,f,c[1],c[2],c[3],c[4],c[5],c[6]),g=g[E](k.min.x,k.max.x),h=h[E](k.min.y,k.max.y),e=c[5],f=c[6]);var l=P[D](0,g),m=P[D](0,h),n=O[D](0,g),o=O[D](0,h),p=n-l,q=o-m,r={x:l,y:m,x2:n,y2:o,width:p,height:q,cx:l+p/2,cy:m+q/2};return b.bbox=d(r),r},Cb=function(a){var b=d(a);return b.toString=c._path2string,b},Db=c._pathToRelative=function(a){var b=Ab(a),j,k,l,m,n,o,p,q,r;if(b.rel)return Cb(b.rel);c.is(a,V)&&c.is(a&&a[0],V)||(a=c.parsePathString(a));var d=[],e=0,f=0,g=0,h=0,i=0;for("M"==a[0][0]&&(e=a[0][1],f=a[0][2],g=e,h=f,i++,d.push(["M",e,f])),j=i,k=a.length;k>j;j++){if(l=d[j]=[],m=a[j],m[0]!=M.call(m[0]))switch(l[0]=M.call(m[0]),l[0]){case"a":l[1]=m[1];l[2]=m[2];l[3]=m[3];l[4]=m[4];l[5]=m[5];l[6]=+(m[6]-e).toFixed(3);l[7]=+(m[7]-f).toFixed(3);break;case"v":l[1]=+(m[1]-f).toFixed(3);break;case"m":g=m[1];h=m[2];default:for(n=1,o=m.length;o>n;n++)l[n]=+(m[n]-(n%2?e:f)).toFixed(3)}else for(l=d[j]=[],"m"==m[0]&&(g=m[1]+e,h=m[2]+f),p=0,q=m.length;q>p;p++)d[j][p]=m[p];r=d[j].length;switch(d[j][0]){case"z":e=g;f=h;break;case"h":e+=+d[j][r-1];break;case"v":f+=+d[j][r-1];break;default:e+=+d[j][r-2];f+=+d[j][r-1]}}return d.toString=c._path2string,b.rel=Cb(d),d},Eb=c._pathToAbsolute=function(a){var b=Ab(a),s,t;if(b.abs)return Cb(b.abs);if(c.is(a,V)&&c.is(a&&a[0],V)||(a=c.parsePathString(a)),!a||!a.length)return[["M",0,0]];var d=[],e=0,f=0,g=0,i=0,j=0;"M"==a[0][0]&&(e=+a[0][1],f=+a[0][2],g=e,i=f,j++,d[0]=["M",e,f]);for(var k,l,m=3==a.length&&"M"==a[0][0]&&"R"==a[1][0].toUpperCase()&&"Z"==a[2][0].toUpperCase(),n=j,o=a.length;o>n;n++){if(d.push(k=[]),l=a[n],l[0]!=bb.call(l[0]))switch(k[0]=bb.call(l[0]),k[0]){case"A":k[1]=l[1];k[2]=l[2];k[3]=l[3];k[4]=l[4];k[5]=l[5];k[6]=+(l[6]+e);k[7]=+(l[7]+f);break;case"V":k[1]=+l[1]+f;break;case"H":k[1]=+l[1]+e;break;case"R":for(var p=[e,f][E](l.slice(1)),q=2,r=p.length;r>q;q++)p[q]=+p[q]+e,p[++q]=+p[q]+f;d.pop();d=d[E](h(p,m));break;case"M":g=+l[1]+e;i=+l[2]+f;default:for(q=1,r=l.length;r>q;q++)k[q]=+l[q]+(q%2?e:f)}else if("R"==l[0])p=[e,f][E](l.slice(1)),d.pop(),d=d[E](h(p,m)),k=["R"][E](l.slice(-2));else for(s=0,t=l.length;t>s;s++)k[s]=l[s];switch(k[0]){case"Z":e=g;f=i;break;case"H":e=k[1];break;case"V":f=k[1];break;case"M":g=k[k.length-2];i=k[k.length-1];default:e=k[k.length-2];f=k[k.length-1]}}return d.toString=c._path2string,b.abs=Cb(d),d},Fb=function(a,b,c,d){return[a,b,c,d,c,d]},Gb=function(a,b,c,d,e,f){var g=1/3,h=2/3;return[g*a+h*c,g*b+h*d,g*e+h*c,g*f+h*d,e,f]},Hb=function(a,b,c,d,e,g,h,i,j,k){var l,m=120*S/180,n=S/180*(+e||0),o=[],p=f(function(a,b,c){var d=a*N.cos(c)-b*N.sin(c),e=a*N.sin(c)+b*N.cos(c);return{x:d,y:e}}),A;if(k)y=k[0],z=k[1],w=k[2],x=k[3];else{l=p(a,b,-n);a=l.x;b=l.y;l=p(i,j,-n);i=l.x;j=l.y;var q=(N.cos(S/180*e),N.sin(S/180*e),(a-i)/2),r=(b-j)/2,s=q*q/(c*c)+r*r/(d*d);s>1&&(s=N.sqrt(s),c=s*c,d=s*d);var t=c*c,u=d*d,v=(g==h?-1:1)*N.sqrt(Q((t*u-t*r*r-u*q*q)/(t*r*r+u*q*q))),w=v*c*r/d+(a+i)/2,x=v*-d*q/c+(b+j)/2,y=N.asin(((b-x)/d).toFixed(9)),z=N.asin(((j-x)/d).toFixed(9));y=w>a?S-y:y;z=w>i?S-z:z;0>y&&(y=2*S+y);0>z&&(z=2*S+z);h&&y>z&&(y-=2*S);!h&&z>y&&(z-=2*S)}if(A=z-y,Q(A)>m){var B=z,C=i,D=j;z=y+m*(h&&z>y?1:-1);i=w+c*N.cos(z);j=x+d*N.sin(z);o=Hb(i,j,c,d,e,0,h,C,D,[z,B,w,x])}A=z-y;var F=N.cos(y),G=N.sin(y),H=N.cos(z),I=N.sin(z),K=N.tan(A/4),L=4/3*c*K,M=4/3*d*K,O=[a,b],P=[a+L*G,b-M*F],R=[i+L*I,j-M*H],T=[i,j];if(P[0]=2*O[0]-P[0],P[1]=2*O[1]-P[1],k)return[P,R,T][E](o);o=[P,R,T][E](o).join()[J](",");for(var U=[],V=0,W=o.length;W>V;V++)U[V]=V%2?p(o[V-1],o[V],n).y:p(o[V],o[V+1],n).x;return U},Ib=function(a,b,c,d,e,f,g,h,i){var j=1-i;return{x:R(j,3)*a+3*R(j,2)*i*c+3*j*i*i*e+R(i,3)*g,y:R(j,3)*b+3*R(j,2)*i*d+3*j*i*i*f+R(i,3)*h}},Jb=f(function(a,b,c,d,e,f,g,h){var i,j=e-2*c+a-(g-2*e+c),k=2*(c-a)-2*(e-c),l=a-c,m=(-k+N.sqrt(k*k-4*j*l))/2/j,n=(-k-N.sqrt(k*k-4*j*l))/2/j,o=[b,h],p=[a,g];return Q(m)>"1e12"&&(m=.5),Q(n)>"1e12"&&(n=.5),m>0&&1>m&&(i=Ib(a,b,c,d,e,f,g,h,m),p.push(i.x),o.push(i.y)),n>0&&1>n&&(i=Ib(a,b,c,d,e,f,g,h,n),p.push(i.x),o.push(i.y)),j=f-2*d+b-(h-2*f+d),k=2*(d-b)-2*(f-d),l=b-d,m=(-k+N.sqrt(k*k-4*j*l))/2/j,n=(-k-N.sqrt(k*k-4*j*l))/2/j,Q(m)>"1e12"&&(m=.5),Q(n)>"1e12"&&(n=.5),m>0&&1>m&&(i=Ib(a,b,c,d,e,f,g,h,m),p.push(i.x),o.push(i.y)),n>0&&1>n&&(i=Ib(a,b,c,d,e,f,g,h,n),p.push(i.x),o.push(i.y)),{min:{x:P[D](0,p),y:P[D](0,o)},max:{x:O[D](0,p),y:O[D](0,o)}}}),Kb=c._path2curve=f(function(a,b){var c=!b&&Ab(a);if(!b&&c.curve)return Cb(c.curve);for(var d=Eb(a),e=b&&Eb(b),f={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},g={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},h=function(a,b,c){var d,e;if(!a)return["C",b.x,b.y,b.x,b.y,b.x,b.y];switch(!(a[0]in{T:1,Q:1})&&(b.qx=b.qy=null),a[0]){case"M":b.X=a[1];b.Y=a[2];break;case"A":a=["C"][E](Hb[D](0,[b.x,b.y][E](a.slice(1))));break;case"S":"C"==c||"S"==c?(d=2*b.x-b.bx,e=2*b.y-b.by):(d=b.x,e=b.y);a=["C",d,e][E](a.slice(1));break;case"T":"Q"==c||"T"==c?(b.qx=2*b.x-b.qx,b.qy=2*b.y-b.qy):(b.qx=b.x,b.qy=b.y);a=["C"][E](Gb(b.x,b.y,b.qx,b.qy,a[1],a[2]));break;case"Q":b.qx=a[1];b.qy=a[2];a=["C"][E](Gb(b.x,b.y,a[1],a[2],a[3],a[4]));break;case"L":a=["C"][E](Fb(b.x,b.y,a[1],a[2]));break;case"H":a=["C"][E](Fb(b.x,b.y,a[1],b.y));break;case"V":a=["C"][E](Fb(b.x,b.y,b.x,a[1]));break;case"Z":a=["C"][E](Fb(b.x,b.y,b.X,b.Y))}return a},i=function(a,b){if(a[b].length>7){a[b].shift();for(var c=a[b];c.length;)a.splice(b++,0,["C"][E](c.splice(0,6)));a.splice(b,1);l=O(d.length,e&&e.length||0)}},j=function(a,b,c,f,g){a&&b&&"M"==a[g][0]&&"M"!=b[g][0]&&(b.splice(g,0,["M",f.x,f.y]),c.bx=0,c.by=0,c.x=a[g][1],c.y=a[g][2],l=O(d.length,e&&e.length||0))},k=0,l=O(d.length,e&&e.length||0);l>k;k++){d[k]=h(d[k],f);i(d,k);e&&(e[k]=h(e[k],g));e&&i(e,k);j(d,e,f,g,k);j(e,d,g,f,k);var m=d[k],n=e&&e[k],o=m.length,p=e&&n.length;f.x=m[o-2];f.y=m[o-1];f.bx=_(m[o-4])||f.x;f.by=_(m[o-3])||f.y;g.bx=e&&(_(n[p-4])||g.x);g.by=e&&(_(n[p-3])||g.y);g.x=e&&n[p-2];g.y=e&&n[p-1]}return e||(c.curve=Cb(d)),e?[d,e]:d},null,Cb),Lb=(c._parseDots=f(function(a){for(var f,g,k,b=[],d=0,e=a.length;e>d;d++){if(f={},g=a[d].match(/^([^:]*):?([\d\.]*)/),f.color=c.getRGB(g[1]),f.color.error)return null;f.color=f.color.hex;g[2]&&(f.offset=g[2]+"%");b.push(f)}for(d=1,e=b.length-1;e>d;d++)if(!b[d].offset){for(var h=_(b[d-1].offset||0),i=0,j=d+1;e>j;j++)if(b[j].offset){i=b[j].offset;break}for(i||(i=100,j=e),i=_(i),k=(i-h)/(j-d+1);j>d;d++)h+=k,b[d].offset=h+"%"}return b}),c._tear=function(a,b){a==b.top&&(b.top=a.prev);a==b.bottom&&(b.bottom=a.next);a.next&&(a.next.prev=a.prev);a.prev&&(a.prev.next=a.next)}),Mb=(c._tofront=function(a,b){b.top!==a&&(Lb(a,b),a.next=null,a.prev=b.top,b.top.next=a,b.top=a)},c._toback=function(a,b){b.bottom!==a&&(Lb(a,b),a.next=b.bottom,a.prev=null,b.bottom.prev=a,b.bottom=a)},c._insertafter=function(a,b,c){Lb(a,c);b==c.top&&(c.top=a);b.next&&(b.next.prev=a);a.next=b.next;a.prev=b;b.next=a},c._insertbefore=function(a,b,c){Lb(a,c);b==c.bottom&&(c.bottom=a);b.prev&&(b.prev.next=a);a.prev=b.prev;b.prev=a;a.next=b},c.toMatrix=function(a,b){var c=Bb(a),d={_:{transform:G},getBBox:function(){return c}};return Nb(d,b),d.matrix}),Nb=(c.transformPath=function(a,b){return rb(a,Mb(a,b))},c._extractTransform=function(a,b){var l,m;if(null==b)return a._.transform;b=I(b).replace(/\.{3}|\u2026/g,a._.transform||G);var d=c.parseTransformString(b),e=0,f=0,g=0,h=1,i=1,j=a._,k=new o;if(j.transform=d||[],d)for(l=0,m=d.length;m>l;l++){var n,p,q,r,s,t=d[l],u=t.length,v=I(t[0]).toLowerCase(),w=t[0]!=v,x=w?k.invert():0;"t"==v&&3==u?w?(n=x.x(0,0),p=x.y(0,0),q=x.x(t[1],t[2]),r=x.y(t[1],t[2]),k.translate(q-n,r-p)):k.translate(t[1],t[2]):"r"==v?2==u?(s=s||a.getBBox(1),k.rotate(t[1],s.x+s.width/2,s.y+s.height/2),e+=t[1]):4==u&&(w?(q=x.x(t[2],t[3]),r=x.y(t[2],t[3]),k.rotate(t[1],q,r)):k.rotate(t[1],t[2],t[3]),e+=t[1]):"s"==v?2==u||3==u?(s=s||a.getBBox(1),k.scale(t[1],t[u-1],s.x+s.width/2,s.y+s.height/2),h*=t[1],i*=t[u-1]):5==u&&(w?(q=x.x(t[3],t[4]),r=x.y(t[3],t[4]),k.scale(t[1],t[2],q,r)):k.scale(t[1],t[2],t[3],t[4]),h*=t[1],i*=t[2]):"m"==v&&7==u&&k.add(t[1],t[2],t[3],t[4],t[5],t[6]);j.dirtyT=1;a.matrix=k}a.matrix=k;j.sx=h;j.sy=i;j.deg=e;j.dx=f=k.e;j.dy=g=k.f;1==h&&1==i&&!e&&j.bbox?(j.bbox.x+=+f,j.bbox.y+=+g):j.dirtyT=1}),Ob=function(a){var b=a[0];switch(b.toLowerCase()){case"t":return[b,0,0];case"m":return[b,1,0,0,1,0,0];case"r":return 4==a.length?[b,0,a[2],a[3]]:[b,0];case"s":return 5==a.length?[b,1,1,a[3],a[4]]:3==a.length?[b,1,1]:[b,1]}},Pb=c._equaliseTransform=function(a,b){b=I(b).replace(/\.{3}|\u2026/g,a);a=c.parseTransformString(a)||[];b=c.parseTransformString(b)||[];for(var d,e,f,g,h=O(a.length,b.length),i=[],j=[],k=0;h>k;k++){if(f=a[k]||Ob(b[k]),g=b[k]||Ob(f),f[0]!=g[0]||"r"==f[0].toLowerCase()&&(f[2]!=g[2]||f[3]!=g[3])||"s"==f[0].toLowerCase()&&(f[3]!=g[3]||f[4]!=g[4]))return;for(i[k]=[],j[k]=[],d=0,e=O(f.length,g.length);e>d;d++)d in f&&(i[k][d]=f[d]),d in g&&(j[k][d]=g[d])}return{from:i,to:j}};c._getContainer=function(a,b,d,e){var f;return f=null!=e||c.is(a,"object")?a:A.doc.getElementById(a),null!=f?f.tagName?null==b?{container:f,width:f.style.pixelWidth||f.offsetWidth,height:f.style.pixelHeight||f.offsetHeight}:{container:f,width:b,height:d}:{container:1,x:a,y:b,width:d,height:e}:void 0};c.pathToRelative=Db;c._engine={};c.path2curve=Kb;c.matrix=function(a,b,c,d,e,f){return new o(a,b,c,d,e,f)},function(a){function b(a){return a[0]*a[0]+a[1]*a[1]}function d(a){var c=N.sqrt(b(a));a[0]&&(a[0]/=c);a[1]&&(a[1]/=c)}a.add=function(a,b,c,d,e,f){var g,h,i,j,k=[[],[],[]],l=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],m=[[a,c,e],[b,d,f],[0,0,1]];for(a&&a instanceof o&&(m=[[a.a,a.c,a.e],[a.b,a.d,a.f],[0,0,1]]),g=0;3>g;g++)for(h=0;3>h;h++){for(j=0,i=0;3>i;i++)j+=l[g][i]*m[i][h];k[g][h]=j}this.a=k[0][0];this.b=k[1][0];this.c=k[0][1];this.d=k[1][1];this.e=k[0][2];this.f=k[1][2]};a.invert=function(){var a=this,b=a.a*a.d-a.b*a.c;return new o(a.d/b,-a.b/b,-a.c/b,a.a/b,(a.c*a.f-a.d*a.e)/b,(a.b*a.e-a.a*a.f)/b)};a.clone=function(){return new o(this.a,this.b,this.c,this.d,this.e,this.f)};a.translate=function(a,b){this.add(1,0,0,1,a,b)};a.scale=function(a,b,c,d){null==b&&(b=a);(c||d)&&this.add(1,0,0,1,c,d);this.add(a,0,0,b,0,0);(c||d)&&this.add(1,0,0,1,-c,-d)};a.rotate=function(a,b,d){a=c.rad(a);b=b||0;d=d||0;var e=+N.cos(a).toFixed(9),f=+N.sin(a).toFixed(9);this.add(e,f,-f,e,b,d);this.add(1,0,0,1,-b,-d)};a.x=function(a,b){return a*this.a+b*this.c+this.e};a.y=function(a,b){return a*this.b+b*this.d+this.f};a.get=function(a){return+this[I.fromCharCode(97+a)].toFixed(4)};a.toString=function(){return c.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()};a.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"};a.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]};a.split=function(){var a={},e,f,g;return a.dx=this.e,a.dy=this.f,e=[[this.a,this.c],[this.b,this.d]],a.scalex=N.sqrt(b(e[0])),d(e[0]),a.shear=e[0][0]*e[1][0]+e[0][1]*e[1][1],e[1]=[e[1][0]-e[0][0]*a.shear,e[1][1]-e[0][1]*a.shear],a.scaley=N.sqrt(b(e[1])),d(e[1]),a.shear/=a.scaley,f=-e[0][1],g=e[1][1],0>g?(a.rotate=c.deg(N.acos(g)),0>f&&(a.rotate=360-a.rotate)):a.rotate=c.deg(N.asin(f)),a.isSimple=!(+a.shear.toFixed(9)||a.scalex.toFixed(9)!=a.scaley.toFixed(9)&&a.rotate),a.isSuperSimple=!+a.shear.toFixed(9)&&a.scalex.toFixed(9)==a.scaley.toFixed(9)&&!a.rotate,a.noRotation=!+a.shear.toFixed(9)&&!a.rotate,a};a.toTransformString=function(a){var b=a||this[J]();return b.isSimple?(b.scalex=+b.scalex.toFixed(4),b.scaley=+b.scaley.toFixed(4),b.rotate=+b.rotate.toFixed(4),(b.dx||b.dy?"t"+[b.dx,b.dy]:G)+(1!=b.scalex||1!=b.scaley?"s"+[b.scalex,b.scaley,0,0]:G)+(b.rotate?"r"+[b.rotate,0,0]:G)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(o.prototype);Qb=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);v.safari="Apple Computer, Inc."==navigator.vendor&&(Qb&&Qb[1]<4||"iP"==navigator.platform.slice(0,2))||"Google Inc."==navigator.vendor&&Qb&&Qb[1]<8?function(){var a=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){a.remove()})}:mb;for(var Rb=function(){this.returnValue=!1},Sb=function(){return this.originalEvent.preventDefault()},Tb=function(){this.cancelBubble=!0},Ub=function(){return this.originalEvent.stopPropagation()},Vb=function(a){var b=A.doc.documentElement.scrollTop||A.doc.body.scrollTop,c=A.doc.documentElement.scrollLeft||A.doc.body.scrollLeft;return{x:a.clientX+c,y:a.clientY+b}},Wb=function(){return A.doc.addEventListener?function(a,b,c,d){var e=function(a){var b=Vb(a);return c.call(d,a,b.x,b.y)},f;return(a.addEventListener(b,e,!1),F&&L[b])&&(f=function(b){for(var e=Vb(b),f=b,g=0,h=b.targetTouches&&b.targetTouches.length;h>g;g++)if(b.targetTouches[g].target==a){b=b.targetTouches[g];b.originalEvent=f;b.preventDefault=Sb;b.stopPropagation=Ub;break}return c.call(d,b,e.x,e.y)},a.addEventListener(L[b],f,!1)),function(){return a.removeEventListener(b,e,!1),F&&L[b]&&a.removeEventListener(L[b],e,!1),!0}}:A.doc.attachEvent?function(a,b,c,d){var e=function(a){a=a||A.win.event;var b=A.doc.documentElement.scrollTop||A.doc.body.scrollTop,e=A.doc.documentElement.scrollLeft||A.doc.body.scrollLeft,f=a.clientX+e,g=a.clientY+b;return a.preventDefault=a.preventDefault||Rb,a.stopPropagation=a.stopPropagation||Tb,c.call(d,a,f,g)};return a.attachEvent("on"+b,e),function(){return a.detachEvent("on"+b,e),!0}}:void 0}(),Xb=[],Yb=function(a){for(var i,j,c,d=a.clientX,e=a.clientY,f=A.doc.documentElement.scrollTop||A.doc.body.scrollTop,g=A.doc.documentElement.scrollLeft||A.doc.body.scrollLeft,h=Xb.length;h--;){if(c=Xb[h],F&&a.touches){for(j=a.touches.length;j--;)if(i=a.touches[j],i.identifier==c.el._drag.id){d=i.clientX;e=i.clientY;(a.originalEvent?a.originalEvent:a).preventDefault();break}}else a.preventDefault();var k,l=c.el.node,m=l.nextSibling,n=l.parentNode,o=l.style.display;A.win.opera&&n.removeChild(l);l.style.display="none";k=c.el.paper.getElementByPoint(d,e);l.style.display=o;A.win.opera&&(m?n.insertBefore(l,m):n.appendChild(l));k&&b("raphael.drag.over."+c.el.id,c.el,k);d+=g;e+=f;b("raphael.drag.move."+c.el.id,c.move_scope||c.el,d-c.el._drag.x,e-c.el._drag.y,d,e,a)}},Zb=function(a){c.unmousemove(Yb).unmouseup(Zb);for(var d,e=Xb.length;e--;)d=Xb[e],d.el._drag={},b("raphael.drag.end."+d.el.id,d.end_scope||d.start_scope||d.move_scope||d.el,a);Xb=[]},$b=c.el={},_b=K.length;_b--;)!function(a){c[a]=$b[a]=function(b,d){return c.is(b,"function")&&(this.events=this.events||[],this.events.push({name:a,f:b,unbind:Wb(this.shape||this.node||A.doc,a,b,d||this)})),this};c["un"+a]=$b["un"+a]=function(b){for(var d=this.events||[],e=d.length;e--;)d[e].name==a&&(c.is(b,"undefined")||d[e].f==b)&&(d[e].unbind(),d.splice(e,1),!d.length&&delete this.events);return this}}(K[_b]);$b.data=function(a,d){var e=kb[this.id]=kb[this.id]||{},f;if(0==arguments.length)return e;if(1==arguments.length){if(c.is(a,"object")){for(f in a)a[z](f)&&this.data(f,a[f]);return this}return b("raphael.data.get."+this.id,this,e[a],a),e[a]}return e[a]=d,b("raphael.data.set."+this.id,this,d,a),this};$b.removeData=function(a){return null==a?kb[this.id]={}:kb[this.id]&&delete kb[this.id][a],this};$b.getData=function(){return d(kb[this.id]||{})};$b.hover=function(a,b,c,d){return this.mouseover(a,c).mouseout(b,d||c)};$b.unhover=function(a,b){return this.unmouseover(a).unmouseout(b)};ac=[];$b.drag=function(a,d,e,f,g,h){function i(i){var n,o;(i.originalEvent||i).preventDefault();var j=i.clientX,k=i.clientY,l=A.doc.documentElement.scrollTop||A.doc.body.scrollTop,m=A.doc.documentElement.scrollLeft||A.doc.body.scrollLeft;if(this._drag.id=i.identifier,F&&i.touches)for(o=i.touches.length;o--;)if(n=i.touches[o],this._drag.id=n.identifier,n.identifier==this._drag.id){j=n.clientX;k=n.clientY;break}this._drag.x=j+m;this._drag.y=k+l;!Xb.length&&c.mousemove(Yb).mouseup(Zb);Xb.push({el:this,move_scope:f,start_scope:g,end_scope:h});d&&b.on("raphael.drag.start."+this.id,d);a&&b.on("raphael.drag.move."+this.id,a);e&&b.on("raphael.drag.end."+this.id,e);b("raphael.drag.start."+this.id,g||f||this,i.clientX+m,i.clientY+l,i)}return this._drag={},ac.push({el:this,start:i}),this.mousedown(i),this};$b.onDragOver=function(a){a?b.on("raphael.drag.over."+this.id,a):b.unbind("raphael.drag.over."+this.id)};$b.undrag=function(){for(var a=ac.length;a--;)ac[a].el==this&&(this.unmousedown(ac[a].start),ac.splice(a,1),b.unbind("raphael.drag.*."+this.id));ac.length||c.unmousemove(Yb).unmouseup(Zb);Xb=[]};v.circle=function(a,b,d){var e=c._engine.circle(this,a||0,b||0,d||0);return this.__set__&&this.__set__.push(e),e};v.rect=function(a,b,d,e,f){var g=c._engine.rect(this,a||0,b||0,d||0,e||0,f||0);return this.__set__&&this.__set__.push(g),g};v.ellipse=function(a,b,d,e){var f=c._engine.ellipse(this,a||0,b||0,d||0,e||0);return this.__set__&&this.__set__.push(f),f};v.path=function(a){!a||c.is(a,U)||c.is(a[0],V)||(a+=G);var b=c._engine.path(c.format[D](c,arguments),this);return this.__set__&&this.__set__.push(b),b};v.image=function(a,b,d,e,f){var g=c._engine.image(this,a||"about:blank",b||0,d||0,e||0,f||0);return this.__set__&&this.__set__.push(g),g};v.text=function(a,b,d){var e=c._engine.text(this,a||0,b||0,I(d));return this.__set__&&this.__set__.push(e),e};v.set=function(a){c.is(a,"array")||(a=Array.prototype.splice.call(arguments,0,arguments.length));var b=new mc(a);return this.__set__&&this.__set__.push(b),b.paper=this,b.type="set",b};v.setStart=function(a){this.__set__=a||this.set()};v.setFinish=function(){var a=this.__set__;return delete this.__set__,a};v.setSize=function(a,b){return c._engine.setSize.call(this,a,b)};v.setViewBox=function(a,b,d,e,f){return c._engine.setViewBox.call(this,a,b,d,e,f)};v.top=v.bottom=null;v.raphael=c;bc=function(a){var b=a.getBoundingClientRect(),c=a.ownerDocument,d=c.body,e=c.documentElement,f=e.clientTop||d.clientTop||0,g=e.clientLeft||d.clientLeft||0,h=b.top+(A.win.pageYOffset||e.scrollTop||d.scrollTop)-f,i=b.left+(A.win.pageXOffset||e.scrollLeft||d.scrollLeft)-g;return{y:h,x:i}};v.getElementByPoint=function(a,b){var c=this,d=c.canvas,e=A.doc.elementFromPoint(a,b),f,g,h;if(A.win.opera&&"svg"==e.tagName&&(f=bc(d),g=d.createSVGRect(),g.x=a-f.x,g.y=b-f.y,g.width=g.height=1,h=d.getIntersectionList(g,null),h.length&&(e=h[h.length-1])),!e)return null;for(;e.parentNode&&e!=d.parentNode&&!e.raphael;)e=e.parentNode;return e==c.canvas.parentNode&&(e=d),e=e&&e.raphael?c.getById(e.raphaelid):null};v.getElementsByBBox=function(a){var b=this.set();return this.forEach(function(d){c.isBBoxIntersect(d.getBBox(),a)&&b.push(d)}),b};v.getById=function(a){for(var b=this.bottom;b;){if(b.id==a)return b;b=b.next}return null};v.forEach=function(a,b){for(var c=this.bottom;c;){if(a.call(b,c)===!1)return this;c=c.next}return this};v.getElementsByPoint=function(a,b){var c=this.set();return this.forEach(function(d){d.isPointInside(a,b)&&c.push(d)}),c};$b.isPointInside=function(a,b){var d=this.realPath=qb[this.type](this);return this.attr("transform")&&this.attr("transform").length&&(d=c.transformPath(d,this.attr("transform"))),c.isPointInsidePath(d,a,b)};$b.getBBox=function(a){if(this.removed)return{};var b=this._;return a?((b.dirty||!b.bboxwt)&&(this.realPath=qb[this.type](this),b.bboxwt=Bb(this.realPath),b.bboxwt.toString=p,b.dirty=0),b.bboxwt):((b.dirty||b.dirtyT||!b.bbox)&&((b.dirty||!this.realPath)&&(b.bboxwt=0,this.realPath=qb[this.type](this)),b.bbox=Bb(rb(this.realPath,this.matrix)),b.bbox.toString=p,b.dirty=b.dirtyT=0),b.bbox)};$b.clone=function(){if(this.removed)return null;var a=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(a),a};$b.glow=function(a){var g;if("text"==this.type)return null;a=a||{};var b={width:(a.width||10)+(+this.attr("stroke-width")||1),fill:a.fill||!1,opacity:a.opacity||.5,offsetx:a.offsetx||0,offsety:a.offsety||0,color:a.color||"#000"},c=b.width/2,d=this.paper,e=d.set(),f=this.realPath||qb[this.type](this);for(f=this.matrix?rb(f,this.matrix):f,g=1;c+1>g;g++)e.push(d.path(f).attr({stroke:b.color,fill:b.fill?b.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(b.width/c*g).toFixed(3),opacity:+(b.opacity/c).toFixed(3)}));return e.insertBefore(this).translate(b.offsetx,b.offsety)};var cc=function(a,b,d,e,f,g,h,i,l){return null==l?j(a,b,d,e,f,g,h,i):c.findDotsAtSegment(a,b,d,e,f,g,h,i,k(a,b,d,e,f,g,h,i,l))},dc=function(a,b){return function(d,e,f){d=Kb(d);for(var g,h,i,j,k,l="",m={},n=0,o=0,p=d.length;p>o;o++){if(i=d[o],"M"==i[0])g=+i[1],h=+i[2];else{if(j=cc(g,h,i[1],i[2],i[3],i[4],i[5],i[6]),n+j>e){if(b&&!m.start){if(k=cc(g,h,i[1],i[2],i[3],i[4],i[5],i[6],e-n),l+=["C"+k.start.x,k.start.y,k.m.x,k.m.y,k.x,k.y],f)return l;m.start=l;l=["M"+k.x,k.y+"C"+k.n.x,k.n.y,k.end.x,k.end.y,i[5],i[6]].join();n+=j;g=+i[5];h=+i[6];continue}if(!a&&!b)return k=cc(g,h,i[1],i[2],i[3],i[4],i[5],i[6],e-n),{x:k.x,y:k.y,alpha:k.alpha}}n+=j;g=+i[5];h=+i[6]}l+=i.shift()+i}return m.end=l,k=a?n:b?m:c.findDotsAtSegment(g,h,i[0],i[1],i[2],i[3],i[4],i[5],1),k.alpha&&(k={x:k.x,y:k.y,alpha:k.alpha}),k}},ec=dc(1),fc=dc(),gc=dc(0,1);c.getTotalLength=ec;c.getPointAtLength=fc;c.getSubpath=function(a,b,c){if(this.getTotalLength(a)-c<1e-6)return gc(a,b).end;var d=gc(a,c,1);return b?gc(d,b).end:d};$b.getTotalLength=function(){var a=this.getPath();if(a)return this.node.getTotalLength?this.node.getTotalLength():ec(a)};$b.getPointAtLength=function(a){var b=this.getPath();if(b)return fc(b,a)};$b.getPath=function(){var a,b=c._getPath[this.type];if("text"!=this.type&&"set"!=this.type)return b&&(a=b(this)),a};$b.getSubpath=function(a,b){var d=this.getPath();if(d)return c.getSubpath(d,a,b)};hc=c.easing_formulas={linear:function(a){return a},"<":function(a){return R(a,1.7)},">":function(a){return R(a,.48)},"<>":function(a){var b=.48-a/1.04,c=N.sqrt(.1734+b*b),d=c-b,e=R(Q(d),1/3)*(0>d?-1:1),f=-c-b,g=R(Q(f),1/3)*(0>f?-1:1),h=e+g+.5;return 3*(1-h)*h*h+h*h*h},backIn:function(a){var b=1.70158;return a*a*((b+1)*a-b)},backOut:function(a){a-=1;var b=1.70158;return a*a*((b+1)*a+b)+1},elastic:function(a){return a==!!a?a:R(2,-10*a)*N.sin((a-.075)*2*S/.3)+1},bounce:function(a){var b,c=7.5625,d=2.75;return 1/d>a?b=c*a*a:2/d>a?(a-=1.5/d,b=c*a*a+.75):2.5/d>a?(a-=2.25/d,b=c*a*a+.9375):(a-=2.625/d,b=c*a*a+.984375),b}};hc.easeIn=hc["ease-in"]=hc["<"];hc.easeOut=hc["ease-out"]=hc[">"];hc.easeInOut=hc["ease-in-out"]=hc["<>"];hc["back-in"]=hc.backIn;hc["back-out"]=hc.backOut;var ic=[],jc=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(a){setTimeout(a,16)},kc=function(){for(var e,q,r,t,u,v,w,x,y,a=+new Date,d=0;d<ic.length;d++)if(e=ic[d],!e.el.removed&&!e.paused){var f,g,h=a-e.start,i=e.ms,j=e.easing,k=e.from,l=e.diff,m=e.to,n=(e.t,e.el),o={},p={};if(e.initstatus?(h=(e.initstatus*e.anim.top-e.prev)/(e.percent-e.prev)*i,e.status=e.initstatus,delete e.initstatus,e.stop&&ic.splice(d--,1)):e.status=(e.prev+(e.percent-e.prev)*(h/i))/e.anim.top,!(0>h))if(i>h){q=j(h/i);for(r in k)if(k[z](r)){switch(db[r]){case T:f=+k[r]+q*i*l[r];break;case"colour":f="rgb("+[lc($(k[r].r+q*i*l[r].r)),lc($(k[r].g+q*i*l[r].g)),lc($(k[r].b+q*i*l[r].b))].join(",")+")";break;case"path":for(f=[],t=0,u=k[r].length;u>t;t++){for(f[t]=[k[r][t][0]],v=1,w=k[r][t].length;w>v;v++)f[t][v]=+k[r][t][v]+q*i*l[r][t][v];f[t]=f[t].join(H)}f=f.join(H);break;case"transform":if(l[r].real)for(f=[],t=0,u=k[r].length;u>t;t++)for(f[t]=[k[r][t][0]],v=1,w=k[r][t].length;w>v;v++)f[t][v]=k[r][t][v]+q*i*l[r][t][v];else x=function(a){return+k[r][a]+q*i*l[r][a]},f=[["m",x(0),x(1),x(2),x(3),x(4),x(5)]];break;case"csv":if("clip-rect"==r)for(f=[],t=4;t--;)f[t]=+k[r][t]+q*i*l[r][t];break;default:for(y=[][E](k[r]),f=[],t=n.paper.customAttributes[r].length;t--;)f[t]=+y[t]+q*i*l[r][t]}o[r]=f}n.attr(o),function(a,c,d){setTimeout(function(){b("raphael.anim.frame."+a,c,d)})}(n.id,n,e.anim)}else{if(function(a,d,e){setTimeout(function(){b("raphael.anim.frame."+d.id,d,e);b("raphael.anim.finish."+d.id,d,e);c.is(a,"function")&&a.call(d)})}(e.callback,n,e.anim),n.attr(m),ic.splice(d--,1),e.repeat>1&&!e.next){for(g in m)m[z](g)&&(p[g]=e.totalOrigin[g]);e.el.attr(p);s(e.anim,e.el,e.anim.percents[0],null,e.totalOrigin,e.repeat-1)}e.next&&!e.stop&&s(e.anim,e.el,e.next,null,e.totalOrigin,e.repeat)}}c.svg&&n&&n.paper&&n.paper.safari();ic.length&&jc(kc)},lc=function(a){return a>255?255:0>a?0:a};$b.animateWith=function(a,b,d,e,f,g){var h=this,i,j,k;if(h.removed)return g&&g.call(h),h;for(i=d instanceof r?d:c.animation(d,e,f,g),s(i,h,i.percents[0],null,h.attr()),j=0,k=ic.length;k>j;j++)if(ic[j].anim==b&&ic[j].el==a){ic[k-1].start=ic[j].start;break}return h};$b.onAnimation=function(a){return a?b.on("raphael.anim.frame."+this.id,a):b.unbind("raphael.anim.frame."+this.id),this};r.prototype.delay=function(a){var b=new r(this.anim,this.ms);return b.times=this.times,b.del=+a||0,b};r.prototype.repeat=function(a){var b=new r(this.anim,this.ms);return b.del=this.del,b.times=N.floor(O(a,0))||1,b};c.animation=function(a,b,d,e){if(a instanceof r)return a;(c.is(d,"function")||!d)&&(e=e||d||null,d=null);a=Object(a);b=+b||0;var f,g,h={};for(g in a)a[z](g)&&_(g)!=g&&_(g)+"%"!=g&&(f=!0,h[g]=a[g]);return f?(d&&(h.easing=d),e&&(h.callback=e),new r({100:h},b)):new r(a,b)};$b.animate=function(a,b,d,e){var f=this,g;return f.removed?(e&&e.call(f),f):(g=a instanceof r?a:c.animation(a,b,d,e),s(g,f,g.percents[0],null,f.attr()),f)};$b.setTime=function(a,b){return a&&null!=b&&this.status(a,P(b,a.ms)/a.ms),this};$b.status=function(a,b){var c,d,e=[],f=0;if(null!=b)return s(a,this,-1,P(b,1)),this;for(c=ic.length;c>f;f++)if(d=ic[f],d.el.id==this.id&&(!a||d.anim==a)){if(a)return d.status;e.push({anim:d.anim,status:d.status})}return a?0:e};$b.pause=function(a){for(var c=0;c<ic.length;c++)ic[c].el.id!=this.id||a&&ic[c].anim!=a||b("raphael.anim.pause."+this.id,this,ic[c].anim)!==!1&&(ic[c].paused=!0);return this};$b.resume=function(a){for(var d,c=0;c<ic.length;c++)ic[c].el.id!=this.id||a&&ic[c].anim!=a||(d=ic[c],b("raphael.anim.resume."+this.id,this,d.anim)!==!1&&(delete d.paused,this.status(d.anim,d.status)));return this};$b.stop=function(a){for(var c=0;c<ic.length;c++)ic[c].el.id!=this.id||a&&ic[c].anim!=a||b("raphael.anim.stop."+this.id,this,ic[c].anim)!==!1&&ic.splice(c--,1);return this};b.on("raphael.remove",t);b.on("raphael.clear",t);$b.toString=function(){return"Raphals object"};mc=function(a){if(this.items=[],this.length=0,this.type="set",a)for(var b=0,c=a.length;c>b;b++)a[b]&&(a[b].constructor==$b.constructor||a[b].constructor==mc)&&(this[this.items.length]=this.items[this.items.length]=a[b],this.length++)};nc=mc.prototype;nc.push=function(){for(var a,b,c=0,d=arguments.length;d>c;c++)a=arguments[c],a&&(a.constructor==$b.constructor||a.constructor==mc)&&(b=this.items.length,this[b]=this.items[b]=a,this.length++);return this};nc.pop=function(){return this.length&&delete this[this.length--],this.items.pop()};nc.forEach=function(a,b){for(var c=0,d=this.items.length;d>c;c++)if(a.call(b,this.items[c],c)===!1)return this;return this};for(oc in $b)$b[z](oc)&&(nc[oc]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a][D](c,b)})}}(oc));return nc.attr=function(a,b){var d,e,f,g;if(a&&c.is(a,V)&&c.is(a[0],"object"))for(d=0,e=a.length;e>d;d++)this.items[d].attr(a[d]);else for(f=0,g=this.items.length;g>f;f++)this.items[f].attr(a,b);return this},nc.clear=function(){for(;this.length;)this.pop()},nc.splice=function(a,b){var g;a=0>a?O(this.length+a,0):a;b=O(0,P(this.length-a,b));for(var d=[],e=[],f=[],c=2;c<arguments.length;c++)f.push(arguments[c]);for(c=0;b>c;c++)e.push(this[a+c]);for(;c<this.length-a;c++)d.push(this[a+c]);for(g=f.length,c=0;c<g+d.length;c++)this.items[a+c]=this[a+c]=g>c?f[c]:d[c-g];for(c=this.items.length=this.length-=b-g;this[c];)delete this[c++];return new mc(e)},nc.exclude=function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]==a)return this.splice(b,1),!0},nc.animate=function(a,b,d,e){var k;(c.is(d,"function")||!d)&&(e=d||null);var f,g,h=this.items.length,i=h,j=this;if(!h)return this;for(e&&(g=function(){--h||e.call(j)}),d=c.is(d,U)?d:g,k=c.animation(a,b,d,g),f=this.items[--i].animate(k);i--;)this.items[i]&&!this.items[i].removed&&this.items[i].animateWith(f,k,k),this.items[i]&&!this.items[i].removed||h--;return this},nc.insertAfter=function(a){for(var b=this.items.length;b--;)this.items[b].insertAfter(a);return this},nc.getBBox=function(){for(var f,a=[],b=[],c=[],d=[],e=this.items.length;e--;)this.items[e].removed||(f=this.items[e].getBBox(),a.push(f.x),b.push(f.y),c.push(f.x+f.width),d.push(f.y+f.height));return a=P[D](0,a),b=P[D](0,b),c=O[D](0,c),d=O[D](0,d),{x:a,y:b,x2:c,y2:d,width:c-a,height:d-b}},nc.clone=function(a){a=this.paper.set();for(var b=0,c=this.items.length;c>b;b++)a.push(this.items[b].clone());return a},nc.toString=function(){return"Raphals set"},nc.glow=function(a){var b=this.paper.set();return this.forEach(function(c){var d=c.glow(a);null!=d&&d.forEach(function(a){b.push(a)})}),b},nc.isPointInside=function(a,b){var c=!1;return this.forEach(function(d){if(d.isPointInside(a,b))return(console.log("runned"),c=!0,!1)}),c},c.registerFont=function(a){var b,c,d,e,f,g;if(!a.face)return a;this.fonts=this.fonts||{};b={w:a.w,face:{},glyphs:{}};c=a.face["font-family"];for(d in a.face)a.face[z](d)&&(b.face[d]=a.face[d]);if(this.fonts[c]?this.fonts[c].push(b):this.fonts[c]=[b],!a.svg){b.face["units-per-em"]=ab(a.face["units-per-em"],10);for(e in a.glyphs)if(a.glyphs[z](e)&&(f=a.glyphs[e],b.glyphs[e]={w:f.w,k:{},d:f.d&&"M"+f.d.replace(/[mlcxtrv]/g,function(a){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[a]||"M"})+"z"},f.k))for(g in f.k)f[z](g)&&(b.glyphs[e].k[g]=f.k[g])}return a},v.getFont=function(a,b,d,e){var f,g,h,i,j,k;if(e=e||"normal",d=d||"normal",b=+b||{normal:400,bold:700,lighter:300,bolder:800}[b]||400,c.fonts){if(f=c.fonts[a],!f){g=new RegExp("(^|\\s)"+a.replace(/[^\w\d\s+!~.:_-]/g,G)+"(\\s|$)","i");for(h in c.fonts)if(c.fonts[z](h)&&g.test(h)){f=c.fonts[h];break}}if(f)for(j=0,k=f.length;k>j&&(i=f[j],i.face["font-weight"]!=b||i.face["font-style"]!=d&&i.face["font-style"]||i.face["font-stretch"]!=e);j++);return i}},v.print=function(a,b,d,e,f,g,h,i){var v,x;g=g||"middle";h=O(P(h||0,1),-1);i=O(P(i||1,3),1);var j,k=I(d)[J](G),l=0,m=0,n=G;if(c.is(e,"string")&&(e=this.getFont(e)),e){j=(f||16)/e.face["units-per-em"];for(var o=e.face.bbox[J](w),p=+o[0],q=o[3]-o[1],r=0,s=+o[1]+("baseline"==g?q+ +e.face.descent:q/2),t=0,u=k.length;u>t;t++)"\n"==k[t]?(l=0,x=0,m=0,r+=q*i):(v=m&&e.glyphs[k[t-1]]||{},x=e.glyphs[k[t]],l+=m?(v.w||e.w)+(v.k&&v.k[k[t]]||0)+e.w*h:0,m=1),x&&x.d&&(n+=c.transformPath(x.d,["t",l*j,r*j,"s",j,j,p,s,"t",(a-p)/j,(b-s)/j]))}return this.path(n).attr({fill:"#000",stroke:"none"})},v.add=function(a){if(c.is(a,"array"))for(var b,d=this.set(),e=0,f=a.length;f>e;e++)b=a[e]||{},x[z](b.type)&&d.push(this[b.type]().attr(b));return d},c.format=function(a,b){var d=c.is(b,V)?[0][E](b):arguments;return a&&c.is(a,U)&&d.length-1&&(a=a.replace(y,function(a,b){return null==d[++b]?G:d[b]})),a||G},c.fullfill=function(){var a=/\{([^\}]+)\}/g,b=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,c=function(a,c,d){var e=d;return c.replace(b,function(a,b,c,d,f){b=b||d;e&&(b in e&&(e=e[b]),"function"==typeof e&&f&&(e=e()))}),e=(null==e||e==d?a:e)+""};return function(b,d){return String(b).replace(a,function(a,b){return c(a,b,d)})}}(),c.ninja=function(){return B.was?A.win.Raphael=B.is:delete Raphael,c},c.st=nc,function(a,b,d){function e(){/in/.test(a.readyState)?setTimeout(e,9):c.eve("raphael.DOMload")}null==a.readyState&&a.addEventListener&&(a.addEventListener(b,d=function(){a.removeEventListener(b,d,!1);a.readyState="complete"},!1),a.readyState="loading");e()}(document,"DOMContentLoaded"),b.on("raphael.DOMload",function(){u=!0}),function(){var B,C;if(c.svg){var a="hasOwnProperty",b=String,d=parseFloat,e=parseInt,f=Math,g=f.max,h=f.abs,i=f.pow,j=/[, ]+/,k=c.eve,l="",m=" ",n="http://www.w3.org/1999/xlink",o={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},p={};c.toString=function(){return"Your browser supports SVG.\nYou are running Raphal "+this.version};var q=function(d,e){if(e){"string"==typeof d&&(d=q(d));for(var f in e)e[a](f)&&("xlink:"==f.substring(0,6)?d.setAttributeNS(n,f.substring(6),b(e[f])):d.setAttribute(f,b(e[f])))}else d=c._g.doc.createElementNS("http://www.w3.org/2000/svg",d),d.style&&(d.style.webkitTapHighlightColor="rgba(0,0,0,0)");return d},r=function(a,e){var j="linear",k=a.id+e,m=.5,n=.5,o=a.node,p=a.paper,r=o.style,s=c._g.doc.getElementById(k),t,u,v,w,x,y;if(!s){if(e=b(e).replace(c._radial_gradient,function(a,b,c){if(j="radial",b&&c){m=d(b);n=d(c);var e=2*(n>.5)-1;i(m-.5,2)+i(n-.5,2)>.25&&(n=f.sqrt(.25-i(m-.5,2))*e+.5)&&.5!=n&&(n=n.toFixed(5)-1e-5*e)}return l}),e=e.split(/\s*\-\s*/),"linear"==j){if(t=e.shift(),t=-d(t),isNaN(t))return null;u=[0,0,f.cos(c.rad(t)),f.sin(c.rad(t))];v=1/(g(h(u[2]),h(u[3]))||1);u[2]*=v;u[3]*=v;u[2]<0&&(u[0]=-u[2],u[2]=0);u[3]<0&&(u[1]=-u[3],u[3]=0)}if(w=c._parseDots(e),!w)return null;if(k=k.replace(/[\(\)\s,\xb0#]/g,"_"),a.gradient&&k!=a.gradient.id&&(p.defs.removeChild(a.gradient),delete a.gradient),!a.gradient)for(s=q(j+"Gradient",{id:k}),a.gradient=s,q(s,"radial"==j?{fx:m,fy:n}:{x1:u[0],y1:u[1],x2:u[2],y2:u[3],gradientTransform:a.matrix.invert()}),p.defs.appendChild(s),x=0,y=w.length;y>x;x++)s.appendChild(q("stop",{offset:w[x].offset?w[x].offset:x?"100%":"0%","stop-color":w[x].color||"#fff"}))}return q(o,{fill:"url(#"+k+")",opacity:1,"fill-opacity":1}),r.fill=l,r.opacity=1,r.fillOpacity=1,1},s=function(a){var b=a.getBBox(1);q(a.pattern,{patternTransform:a.matrix.invert()+" translate("+b.x+","+b.y+")"})},t=function(d,e,f){var A,B,C,D,E,F;if("path"==d.type){for(var g,h,i,j,k,m=b(e).toLowerCase().split("-"),n=d.paper,r=f?"end":"start",s=d.node,t=d.attrs,u=t["stroke-width"],v=m.length,w="classic",x=3,y=3,z=5;v--;)switch(m[v]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":w=m[v];break;case"wide":y=5;break;case"narrow":y=2;break;case"long":x=5;break;case"short":x=2}("open"==w?(x+=2,y+=2,z+=2,i=1,j=f?4:1,k={fill:"none",stroke:t.stroke}):(j=i=x/2,k={fill:t.stroke,stroke:"none"}),d._.arrows?f?(d._.arrows.endPath&&p[d._.arrows.endPath]--,d._.arrows.endMarker&&p[d._.arrows.endMarker]--):(d._.arrows.startPath&&p[d._.arrows.startPath]--,d._.arrows.startMarker&&p[d._.arrows.startMarker]--):d._.arrows={},"none"!=w)?(A="raphael-marker-"+w,B="raphael-marker-"+r+w+x+y,c._g.doc.getElementById(A)?p[A]++:(n.defs.appendChild(q(q("path"),{"stroke-linecap":"round",d:o[w],id:A})),p[A]=1),D=c._g.doc.getElementById(B),D?(p[B]++,C=D.getElementsByTagName("use")[0]):(D=q(q("marker"),{id:B,markerHeight:y,markerWidth:x,orient:"auto",refX:j,refY:y/2}),C=q(q("use"),{"xlink:href":"#"+A,transform:(f?"rotate(180 "+x/2+" "+y/2+") ":l)+"scale("+x/z+","+y/z+")","stroke-width":(2/(x/z+y/z)).toFixed(4)}),D.appendChild(C),n.defs.appendChild(D),p[B]=1),q(C,k),E=i*("diamond"!=w&&"oval"!=w),f?(g=d._.arrows.startdx*u||0,h=c.getTotalLength(t.path)-E*u):(g=E*u,h=c.getTotalLength(t.path)-(d._.arrows.enddx*u||0)),k={},k["marker-"+r]="url(#"+B+")",(h||g)&&(k.d=c.getSubpath(t.path,g,h)),q(s,k),d._.arrows[r+"Path"]=A,d._.arrows[r+"Marker"]=B,d._.arrows[r+"dx"]=E,d._.arrows[r+"Type"]=w,d._.arrows[r+"String"]=e):(f?(g=d._.arrows.startdx*u||0,h=c.getTotalLength(t.path)-g):(g=0,h=c.getTotalLength(t.path)-(d._.arrows.enddx*u||0)),d._.arrows[r+"Path"]&&q(s,{d:c.getSubpath(t.path,g,h)}),delete d._.arrows[r+"Path"],delete d._.arrows[r+"Marker"],delete d._.arrows[r+"dx"],delete d._.arrows[r+"Type"],delete d._.arrows[r+"String"]);for(k in p)p[a](k)&&!p[k]&&(F=c._g.doc.getElementById(k),F&&F.parentNode.removeChild(F))}},u={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},v=function(a,c,d){if(c=u[b(c).toLowerCase()]){for(var e=a.attrs["stroke-width"]||"1",f={round:e,square:e,butt:0}[a.attrs["stroke-linecap"]||d["stroke-linecap"]]||0,g=[],h=c.length;h--;)g[h]=c[h]*e+(h%2?1:-1)*f;q(a.node,{"stroke-dasharray":g.join(",")})}},w=function(d,f){var i=d.node,k=d.attrs,m=i.style.visibility,o,p,w,x,u,z,A,B,C,D,E,F,G,H,I,J;i.style.visibility="hidden";for(o in f)if(f[a](o)){if(!c._availableAttrs[a](o))continue;p=f[o];switch(k[o]=p,o){case"blur":d.blur(p);break;case"href":case"title":u=q("title");w=c._g.doc.createTextNode(p);u.appendChild(w);i.appendChild(u);break;case"target":x=i.parentNode;"a"!=x.tagName.toLowerCase()&&(u=q("a"),x.insertBefore(u,i),u.appendChild(i),x=u);"target"==o?x.setAttributeNS(n,"show","blank"==p?"new":p):x.setAttributeNS(n,o,p);break;case"cursor":i.style.cursor=p;break;case"transform":d.transform(p);break;case"arrow-start":t(d,p);break;case"arrow-end":t(d,p,1);break;case"clip-rect":z=b(p).split(j);4==z.length&&(d.clip&&d.clip.parentNode.parentNode.removeChild(d.clip.parentNode),A=q("clipPath"),B=q("rect"),A.id=c.createUUID(),q(B,{x:z[0],y:z[1],width:z[2],height:z[3]}),A.appendChild(B),d.paper.defs.appendChild(A),q(i,{"clip-path":"url(#"+A.id+")"}),d.clip=B);p||(C=i.getAttribute("clip-path"),C&&(D=c._g.doc.getElementById(C.replace(/(^url\(#|\)$)/g,l)),D&&D.parentNode.removeChild(D),q(i,{"clip-path":l}),delete d.clip));break;case"path":"path"==d.type&&(q(i,{d:p?k.path=c._pathToAbsolute(p):"M0,0"}),d._.dirty=1,d._.arrows&&("startString"in d._.arrows&&t(d,d._.arrows.startString),"endString"in d._.arrows&&t(d,d._.arrows.endString,1)));break;case"width":if(i.setAttribute(o,p),d._.dirty=1,!k.fx)break;o="x";p=k.x;case"x":k.fx&&(p=-k.x-(k.width||0));case"rx":if("rx"==o&&"rect"==d.type)break;case"cx":i.setAttribute(o,p);d.pattern&&s(d);d._.dirty=1;break;case"height":if(i.setAttribute(o,p),d._.dirty=1,!k.fy)break;o="y";p=k.y;case"y":k.fy&&(p=-k.y-(k.height||0));case"ry":if("ry"==o&&"rect"==d.type)break;case"cy":i.setAttribute(o,p);d.pattern&&s(d);d._.dirty=1;break;case"r":"rect"==d.type?q(i,{rx:p,ry:p}):i.setAttribute(o,p);d._.dirty=1;break;case"src":"image"==d.type&&i.setAttributeNS(n,"href",p);break;case"stroke-width":(1!=d._.sx||1!=d._.sy)&&(p/=g(h(d._.sx),h(d._.sy))||1);d.paper._vbSize&&(p*=d.paper._vbSize);i.setAttribute(o,p);k["stroke-dasharray"]&&v(d,k["stroke-dasharray"],f);d._.arrows&&("startString"in d._.arrows&&t(d,d._.arrows.startString),"endString"in d._.arrows&&t(d,d._.arrows.endString,1));break;case"stroke-dasharray":v(d,p,f);break;case"fill":if(E=b(p).match(c._ISURL),E){A=q("pattern");F=q("image");A.id=c.createUUID();q(A,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1});q(F,{x:0,y:0,"xlink:href":E[1]});A.appendChild(F),function(a){c._preload(E[1],function(){var b=this.offsetWidth,c=this.offsetHeight;q(a,{width:b,height:c});q(F,{width:b,height:c});d.paper.safari()})}(A);d.paper.defs.appendChild(A);q(i,{fill:"url(#"+A.id+")"});d.pattern=A;d.pattern&&s(d);break}if(G=c.getRGB(p),G.error){if(("circle"==d.type||"ellipse"==d.type||"r"!=b(p).charAt())&&r(d,p)){("opacity"in k||"fill-opacity"in k)&&(H=c._g.doc.getElementById(i.getAttribute("fill").replace(/^url\(#|\)$/g,l)),H&&(I=H.getElementsByTagName("stop"),q(I[I.length-1],{"stop-opacity":("opacity"in k?k.opacity:1)*("fill-opacity"in k?k["fill-opacity"]:1)})));k.gradient=p;k.fill="none";break}}else delete f.gradient,delete k.gradient,!c.is(k.opacity,"undefined")&&c.is(f.opacity,"undefined")&&q(i,{opacity:k.opacity}),!c.is(k["fill-opacity"],"undefined")&&c.is(f["fill-opacity"],"undefined")&&q(i,{"fill-opacity":k["fill-opacity"]});G[a]("opacity")&&q(i,{"fill-opacity":G.opacity>1?G.opacity/100:G.opacity});case"stroke":G=c.getRGB(p);i.setAttribute(o,G.hex);"stroke"==o&&G[a]("opacity")&&q(i,{"stroke-opacity":G.opacity>1?G.opacity/100:G.opacity});"stroke"==o&&d._.arrows&&("startString"in d._.arrows&&t(d,d._.arrows.startString),"endString"in d._.arrows&&t(d,d._.arrows.endString,1));break;case"gradient":("circle"==d.type||"ellipse"==d.type||"r"!=b(p).charAt())&&r(d,p);break;case"opacity":k.gradient&&!k[a]("stroke-opacity")&&q(i,{"stroke-opacity":p>1?p/100:p});case"fill-opacity":if(k.gradient){H=c._g.doc.getElementById(i.getAttribute("fill").replace(/^url\(#|\)$/g,l));H&&(I=H.getElementsByTagName("stop"),q(I[I.length-1],{"stop-opacity":p}));break}default:"font-size"==o&&(p=e(p,10)+"px");J=o.replace(/(\-.)/g,function(a){return a.substring(1).toUpperCase()});i.style[J]=p;d._.dirty=1;i.setAttribute(o,p)}}y(d,f);i.style.visibility=m},x=1.2,y=function(d,f){var p,r;if("text"==d.type&&(f[a]("text")||f[a]("font")||f[a]("font-size")||f[a]("x")||f[a]("y"))){var g=d.attrs,h=d.node,i=h.firstChild?e(c._g.doc.defaultView.getComputedStyle(h.firstChild,l).getPropertyValue("font-size"),10):10;if(f[a]("text")){for(g.text=f.text;h.firstChild;)h.removeChild(h.firstChild);for(var j,k=b(f.text).split("\n"),m=[],n=0,o=k.length;o>n;n++)j=q("tspan"),n&&q(j,{dy:i*x,x:g.x}),j.appendChild(c._g.doc.createTextNode(k[n])),h.appendChild(j),m[n]=j}else for(m=h.getElementsByTagName("tspan"),n=0,o=m.length;o>n;n++)n?q(m[n],{dy:i*x,x:g.x}):q(m[0],{dy:0});q(h,{x:g.x,y:g.y});d._.dirty=1;p=d._getBBox();r=g.y-(p.y+p.height/2);r&&c.is(r,"finite")&&q(m[0],{dy:r})}},z=function(a,b){this[0]=this.node=a;a.raphael=!0;this.id=c._oid++;a.raphaelid=this.id;this.matrix=c.matrix();this.realPath=null;this.paper=b;this.attrs=this.attrs||{};this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1};!b.bottom&&(b.bottom=this);this.prev=b.top;b.top&&(b.top.next=this);b.top=this;this.next=null},A=c.el;z.prototype=A;A.constructor=z;c._engine.path=function(a,b){var c=q("path"),d;return b.canvas&&b.canvas.appendChild(c),d=new z(c,b),d.type="path",w(d,{fill:"none",stroke:"#000",path:a}),d};A.rotate=function(a,c,e){if(this.removed)return this;if(a=b(a).split(j),a.length-1&&(c=d(a[1]),e=d(a[2])),a=d(a[0]),null==e&&(c=e),null==c||null==e){var f=this.getBBox(1);c=f.x+f.width/2;e=f.y+f.height/2}return this.transform(this._.transform.concat([["r",a,c,e]])),this};A.scale=function(a,c,e,f){if(this.removed)return this;if(a=b(a).split(j),a.length-1&&(c=d(a[1]),e=d(a[2]),f=d(a[3])),a=d(a[0]),null==c&&(c=a),null==f&&(e=f),null==e||null==f)var g=this.getBBox(1);return e=null==e?g.x+g.width/2:e,f=null==f?g.y+g.height/2:f,this.transform(this._.transform.concat([["s",a,c,e,f]])),this};A.translate=function(a,c){return this.removed?this:(a=b(a).split(j),a.length-1&&(c=d(a[1])),a=d(a[0])||0,c=+c||0,this.transform(this._.transform.concat([["t",a,c]])),this)};A.transform=function(b){var d=this._,e;return null==b?d.transform:((c._extractTransform(this,b),this.clip&&q(this.clip,{transform:this.matrix.invert()}),this.pattern&&s(this),this.node&&q(this.node,{transform:this.matrix}),1!=d.sx||1!=d.sy)&&(e=this.attrs[a]("stroke-width")?this.attrs["stroke-width"]:1,this.attr({"stroke-width":e})),this)};A.hide=function(){return!this.removed&&this.paper.safari(this.node.style.display="none"),this};A.show=function(){return!this.removed&&this.paper.safari(this.node.style.display=""),this};A.remove=function(){var a,b;if(!this.removed&&this.node.parentNode){a=this.paper;a.__set__&&a.__set__.exclude(this);k.unbind("raphael.*.*."+this.id);this.gradient&&a.defs.removeChild(this.gradient);c._tear(this,a);"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.removeChild(this.node.parentNode):this.node.parentNode.removeChild(this.node);for(b in this)this[b]="function"==typeof this[b]?c._removedFactory(b):null;this.removed=!0}};A._getBBox=function(){var a,b;"none"==this.node.style.display&&(this.show(),a=!0);b={};try{b=this.node.getBBox()}catch(c){}finally{b=b||{}}return a&&this.hide(),b};A.attr=function(b,d){var e,f,m,n,o,p;if(this.removed)return this;if(null==b){e={};for(f in this.attrs)this.attrs[a](f)&&(e[f]=this.attrs[f]);return e.gradient&&"none"==e.fill&&(e.fill=e.gradient)&&delete e.gradient,e.transform=this._.transform,e}if(null==d&&c.is(b,"string")){if("fill"==b&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;if("transform"==b)return this._.transform;for(var g=b.split(j),h={},i=0,l=g.length;l>i;i++)b=g[i],h[b]=b in this.attrs?this.attrs[b]:c.is(this.paper.customAttributes[b],"function")?this.paper.customAttributes[b].def:c._availableAttrs[b];return l-1?h:h[g[0]]}if(null==d&&c.is(b,"array")){for(h={},i=0,l=b.length;l>i;i++)h[b[i]]=this.attr(b[i]);return h}null!=d?(m={},m[b]=d):null!=b&&c.is(b,"object")&&(m=b);for(n in m)k("raphael.attr."+n+"."+this.id,this,m[n]);for(n in this.paper.customAttributes)if(this.paper.customAttributes[a](n)&&m[a](n)&&c.is(this.paper.customAttributes[n],"function")){o=this.paper.customAttributes[n].apply(this,[].concat(m[n]));this.attrs[n]=m[n];for(p in o)o[a](p)&&(m[p]=o[p])}return w(this,m),this};A.toFront=function(){if(this.removed)return this;"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.appendChild(this.node.parentNode):this.node.parentNode.appendChild(this.node);var a=this.paper;return a.top!=this&&c._tofront(this,a),this};A.toBack=function(){if(this.removed)return this;var a=this.node.parentNode;return"a"==a.tagName.toLowerCase()?a.parentNode.insertBefore(this.node.parentNode,this.node.parentNode.parentNode.firstChild):a.firstChild!=this.node&&a.insertBefore(this.node,this.node.parentNode.firstChild),c._toback(this,this.paper),this.paper,this};A.insertAfter=function(a){if(this.removed)return this;var b=a.node||a[a.length-1].node;return b.nextSibling?b.parentNode.insertBefore(this.node,b.nextSibling):b.parentNode.appendChild(this.node),c._insertafter(this,a,this.paper),this};A.insertBefore=function(a){if(this.removed)return this;var b=a.node||a[0].node;return b.parentNode.insertBefore(this.node,b),c._insertbefore(this,a,this.paper),this};A.blur=function(a){var b=this,d,e;return 0!=+a?(d=q("filter"),e=q("feGaussianBlur"),b.attrs.blur=a,d.id=c.createUUID(),q(e,{stdDeviation:+a||1.5}),d.appendChild(e),b.paper.defs.appendChild(d),b._blur=d,q(b.node,{filter:"url(#"+d.id+")"})):(b._blur&&(b._blur.parentNode.removeChild(b._blur),delete b._blur,delete b.attrs.blur),b.node.removeAttribute("filter")),b};c._engine.circle=function(a,b,c,d){var e=q("circle"),f;return a.canvas&&a.canvas.appendChild(e),f=new z(e,a),f.attrs={cx:b,cy:c,r:d,fill:"none",stroke:"#000"},f.type="circle",q(e,f.attrs),f};c._engine.rect=function(a,b,c,d,e,f){var g=q("rect"),h;return a.canvas&&a.canvas.appendChild(g),h=new z(g,a),h.attrs={x:b,y:c,width:d,height:e,r:f||0,rx:f||0,ry:f||0,fill:"none",stroke:"#000"},h.type="rect",q(g,h.attrs),h};c._engine.ellipse=function(a,b,c,d,e){var f=q("ellipse"),g;return a.canvas&&a.canvas.appendChild(f),g=new z(f,a),g.attrs={cx:b,cy:c,rx:d,ry:e,fill:"none",stroke:"#000"},g.type="ellipse",q(f,g.attrs),g};c._engine.image=function(a,b,c,d,e,f){var g=q("image"),h;return q(g,{x:c,y:d,width:e,height:f,preserveAspectRatio:"none"}),g.setAttributeNS(n,"href",b),a.canvas&&a.canvas.appendChild(g),h=new z(g,a),h.attrs={x:c,y:d,width:e,height:f,src:b},h.type="image",h};c._engine.text=function(a,b,d,e){var f=q("text"),g;return a.canvas&&a.canvas.appendChild(f),g=new z(f,a),g.attrs={x:b,y:d,"text-anchor":"middle",text:e,font:c._availableAttrs.font,stroke:"none",fill:"#000"},g.type="text",w(g,g.attrs),g};c._engine.setSize=function(a,b){return this.width=a||this.width,this.height=b||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this};c._engine.create=function(){var a=c._getContainer.apply(0,arguments),b=a&&a.container,d=a.x,e=a.y,f=a.width,g=a.height,h,i,j;if(!b)throw new Error("SVG container not found.");return i=q("svg"),j="overflow:hidden;",d=d||0,e=e||0,f=f||512,g=g||342,q(i,{height:g,version:1.1,width:f,xmlns:"http://www.w3.org/2000/svg"}),1==b?(i.style.cssText=j+"position:absolute;left:"+d+"px;top:"+e+"px",c._g.doc.body.appendChild(i),h=1):(i.style.cssText=j+"position:relative",b.firstChild?b.insertBefore(i,b.firstChild):b.appendChild(i)),b=new c._Paper,b.width=f,b.height=g,b.canvas=i,b.clear(),b._left=b._top=0,h&&(b.renderfix=function(){}),b.renderfix(),b};c._engine.setViewBox=function(a,b,c,d,e){k("raphael.setViewBox",this,this._viewBox,[a,b,c,d,e]);var f,h,i=g(c/this.width,d/this.height),j=this.top,l=e?"meet":"xMinYMin";for(null==a?(this._vbSize&&(i=1),delete this._vbSize,f="0 0 "+this.width+m+this.height):(this._vbSize=i,f=a+m+b+m+c+m+d),q(this.canvas,{viewBox:f,preserveAspectRatio:l});i&&j;)h="stroke-width"in j.attrs?j.attrs["stroke-width"]:1,j.attr({"stroke-width":h}),j._.dirty=1,j._.dirtyT=1,j=j.prev;return this._viewBox=[a,b,c,d,!!e],this};c.prototype.renderfix=function(){var a,b=this.canvas,c=b.style,e,f;try{a=b.getScreenCTM()||b.createSVGMatrix()}catch(d){a=b.createSVGMatrix()}e=-a.e%1;f=-a.f%1;(e||f)&&(e&&(this._left=(this._left+e)%1,c.left=this._left+"px"),f&&(this._top=(this._top+f)%1,c.top=this._top+"px"))};c.prototype.clear=function(){c.eve("raphael.clear",this);for(var a=this.canvas;a.firstChild;)a.removeChild(a.firstChild);this.bottom=this.top=null;(this.desc=q("desc")).appendChild(c._g.doc.createTextNode("Created with Raphal "+c.version));a.appendChild(this.desc);a.appendChild(this.defs=q("defs"))};c.prototype.remove=function(){k("raphael.remove",this);this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var a in this)this[a]="function"==typeof this[a]?c._removedFactory(a):null};B=c.st;for(C in A)A[a](C)&&!B[a](C)&&(B[C]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a].apply(c,b)})}}(C))}}(),function(){var F,G,H;if(c.vml){var a="hasOwnProperty",b=String,d=parseFloat,e=Math,f=e.round,g=e.max,h=e.min,i=e.abs,j="fill",k=/[, ]+/,l=c.eve,m=" progid:DXImageTransform.Microsoft",n=" ",o="",p={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},q=/([clmz]),?([^clmz]*)/gi,r=/ progid:\S+Blur\([^\)]+\)/g,s=/-?[^,\s-]+/g,t="position:absolute;left:0;top:0;width:1px;height:1px",u=21600,v={path:1,rect:1,image:1},w={circle:1,ellipse:1},x=function(a){var d=/[ahqstv]/gi,e=c._pathToAbsolute,g,h,i,j,k,l,m,r;if(b(a).match(d)&&(e=c._path2curve),d=/[clmz]/g,e==c._pathToAbsolute&&!b(a).match(d))return b(a).replace(q,function(a,b,c){var d=[],e="m"==b.toLowerCase(),g=p[b];return c.replace(s,function(a){e&&2==d.length&&(g+=d+p["m"==b?"l":"L"],d=[]);d.push(f(a*u))}),g+d});for(j=e(a),g=[],k=0,l=j.length;l>k;k++){for(h=j[k],i=j[k][0].toLowerCase(),"z"==i&&(i="x"),m=1,r=h.length;r>m;m++)i+=f(h[m]*u)+(m!=r-1?",":o);g.push(i)}return g.join(n)},y=function(a,b,d){var e=c.matrix();return e.rotate(-a,.5,.5),{dx:e.x(b,d),dy:e.y(b,d)}},z=function(a,b,c,d,e,f){var g=a._,h=a.matrix,k=g.fillpos,l=a.node,m=l.style,o=1,p="",q=u/b,r=u/c,s,t;(m.visibility="hidden",b&&c)&&((l.coordsize=i(q)+n+i(r),m.rotation=f*(0>b*c?-1:1),f)&&(s=y(f,d,e),d=s.dx,e=s.dy),(0>b&&(p+="x"),0>c&&(p+=" y")&&(o=-1),m.flip=p,l.coordorigin=d*-q+n+e*-r,k||g.fillsize)&&(t=l.getElementsByTagName(j),t=t&&t[0],l.removeChild(t),k&&(s=y(f,h.x(k[0],k[1]),h.y(k[0],k[1])),t.position=s.dx*o+n+s.dy*o),g.fillsize&&(t.size=g.fillsize[0]*i(b)+n+g.fillsize[1]*i(c)),l.appendChild(t)),m.visibility="visible")};c.toString=function(){return"Your browser doesnt support SVG. Falling down to VML.\nYou are running Raphal "+this.version};var A=function(a,c,d){for(var k,e=b(c).toLowerCase().split("-"),f=d?"end":"start",g=e.length,h="classic",i="medium",j="medium";g--;)switch(e[g]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":h=e[g];break;case"wide":case"narrow":j=e[g];break;case"long":case"short":i=e[g]}k=a.node.getElementsByTagName("stroke")[0];k[f+"arrow"]=h;k[f+"arrowlength"]=i;k[f+"arrowwidth"]=j},B=function(e,i){var t,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,X;e.attrs=e.attrs||{};var l=e.node,m=e.attrs,p=l.style,q=v[e.type]&&(i.x!=m.x||i.y!=m.y||i.width!=m.width||i.height!=m.height||i.cx!=m.cx||i.cy!=m.cy||i.rx!=m.rx||i.ry!=m.ry||i.r!=m.r),r=w[e.type]&&(m.cx!=i.cx||m.cy!=i.cy||m.r!=i.r||m.rx!=i.rx||m.ry!=i.ry),s=e;for(t in i)i[a](t)&&(m[t]=i[t]);if(q&&(m.path=c._getPath[e.type](e),e._.dirty=1),i.href&&(l.href=i.href),i.title&&(l.title=i.title),i.target&&(l.target=i.target),i.cursor&&(p.cursor=i.cursor),"blur"in i&&e.blur(i.blur),(i.path&&"path"==e.type||q)&&(l.path=x(~b(m.path).toLowerCase().indexOf("r")?c._pathToAbsolute(m.path):m.path),"image"==e.type&&(e._.fillpos=[m.x,m.y],e._.fillsize=[m.width,m.height],z(e,1,1,0,0,0))),"transform"in i&&e.transform(i.transform),r){var y=+m.cx,B=+m.cy,D=+m.rx||+m.r||0,E=+m.ry||+m.r||0;l.path=c.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",f((y-D)*u),f((B-E)*u),f((y+D)*u),f((B+E)*u),f(y*u));e._.dirty=1}if("clip-rect"in i&&(G=b(i["clip-rect"]).split(k),4==G.length&&(G[2]=+G[2]+ +G[0],G[3]=+G[3]+ +G[1],H=l.clipRect||c._g.doc.createElement("div"),I=H.style,I.clip=c.format("rect({1}px {2}px {3}px {0}px)",G),l.clipRect||(I.position="absolute",I.top=0,I.left=0,I.width=e.paper.width+"px",I.height=e.paper.height+"px",l.parentNode.insertBefore(H,l),H.appendChild(l),l.clipRect=H)),i["clip-rect"]||l.clipRect&&(l.clipRect.style.clip="auto")),e.textpath&&(J=e.textpath.style,i.font&&(J.font=i.font),i["font-family"]&&(J.fontFamily='"'+i["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,o)+'"'),i["font-size"]&&(J.fontSize=i["font-size"]),i["font-weight"]&&(J.fontWeight=i["font-weight"]),i["font-style"]&&(J.fontStyle=i["font-style"])),("arrow-start"in i&&A(s,i["arrow-start"]),"arrow-end"in i&&A(s,i["arrow-end"],1),null!=i.opacity||null!=i["stroke-width"]||null!=i.fill||null!=i.src||null!=i.stroke||null!=i["stroke-width"]||null!=i["stroke-opacity"]||null!=i["fill-opacity"]||null!=i["stroke-dasharray"]||null!=i["stroke-miterlimit"]||null!=i["stroke-linejoin"]||null!=i["stroke-linecap"])&&(K=l.getElementsByTagName(j),L=!1,(K=K&&K[0],!K&&(L=K=F(j)),"image"==e.type&&i.src&&(K.src=i.src),i.fill&&(K.on=!0),(null==K.on||"none"==i.fill||null===i.fill)&&(K.on=!1),K.on&&i.fill)&&(M=b(i.fill).match(c._ISURL),M?(K.parentNode==l&&l.removeChild(K),K.rotate=!0,K.src=M[1],K.type="tile",N=e.getBBox(1),K.position=N.x+n+N.y,e._.fillpos=[N.x,N.y],c._preload(M[1],function(){e._.fillsize=[this.offsetWidth,this.offsetHeight]})):(K.color=c.getRGB(i.fill).hex,K.src=o,K.type="solid",c.getRGB(i.fill).error&&(s.type in{circle:1,ellipse:1}||"r"!=b(i.fill).charAt())&&C(s,i.fill,K)&&(m.fill="none",m.gradient=i.fill,K.rotate=!1))),("fill-opacity"in i||"opacity"in i)&&(O=((+m["fill-opacity"]+1||2)-1)*((+m.opacity+1||2)-1)*((+c.getRGB(i.fill).o+1||2)-1),O=h(g(O,0),1),K.opacity=O,K.src&&(K.color="none")),l.appendChild(K),P=l.getElementsByTagName("stroke")&&l.getElementsByTagName("stroke")[0],Q=!1,P||(Q=P=F("stroke")),(i.stroke&&"none"!=i.stroke||i["stroke-width"]||null!=i["stroke-opacity"]||i["stroke-dasharray"]||i["stroke-miterlimit"]||i["stroke-linejoin"]||i["stroke-linecap"])&&(P.on=!0),("none"==i.stroke||null===i.stroke||null==P.on||0==i.stroke||0==i["stroke-width"])&&(P.on=!1),R=c.getRGB(i.stroke),P.on&&i.stroke&&(P.color=R.hex),O=((+m["stroke-opacity"]+1||2)-1)*((+m.opacity+1||2)-1)*((+R.o+1||2)-1),S=.75*(d(i["stroke-width"])||1),(O=h(g(O,0),1),null==i["stroke-width"]&&(S=m["stroke-width"]),i["stroke-width"]&&(P.weight=S),S&&1>S&&(O*=S)&&(P.weight=1),P.opacity=O,i["stroke-linejoin"]&&(P.joinstyle=i["stroke-linejoin"]||"miter"),P.miterlimit=i["stroke-miterlimit"]||8,i["stroke-linecap"]&&(P.endcap="butt"==i["stroke-linecap"]?"flat":"square"==i["stroke-linecap"]?"square":"round"),i["stroke-dasharray"])&&(T={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"},P.dashstyle=T[a](i["stroke-dasharray"])?T[i["stroke-dasharray"]]:o),Q&&l.appendChild(P)),"text"==s.type){s.paper.canvas.style.display=o;var U=s.paper.span,V=100,W=m.font&&m.font.match(/\d+(?:\.\d*)?(?=px)/);p=U.style;m.font&&(p.font=m.font);m["font-family"]&&(p.fontFamily=m["font-family"]);m["font-weight"]&&(p.fontWeight=m["font-weight"]);m["font-style"]&&(p.fontStyle=m["font-style"]);W=d(m["font-size"]||W&&W[0])||10;p.fontSize=W*V+"px";s.textpath.string&&(U.innerHTML=b(s.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));X=U.getBoundingClientRect();s.W=m.w=(X.right-X.left)/V;s.H=m.h=(X.bottom-X.top)/V;s.X=m.x;s.Y=m.y+s.H/2;("x"in i||"y"in i)&&(s.path.v=c.format("m{0},{1}l{2},{1}",f(m.x*u),f(m.y*u),f(m.x*u)+1));for(var Y=["x","y","text","font","font-family","font-weight","font-style","font-size"],Z=0,$=Y.length;$>Z;Z++)if(Y[Z]in i){s._.dirty=1;break}switch(m["text-anchor"]){case"start":s.textpath.style["v-text-align"]="left";s.bbx=s.W/2;break;case"end":s.textpath.style["v-text-align"]="right";s.bbx=-s.W/2;break;default:s.textpath.style["v-text-align"]="center";s.bbx=0}s.textpath.style["v-text-kern"]=!0}},C=function(a,f,g){var k,l;a.attrs=a.attrs||{};var h=(a.attrs,Math.pow),i="linear",j=".5 .5";if((a.attrs.gradient=f,f=b(f).replace(c._radial_gradient,function(a,b,c){return i="radial",b&&c&&(b=d(b),c=d(c),h(b-.5,2)+h(c-.5,2)>.25&&(c=e.sqrt(.25-h(b-.5,2))*(2*(c>.5)-1)+.5),j=b+n+c),o}),f=f.split(/\s*\-\s*/),"linear"==i)&&(k=f.shift(),k=-d(k),isNaN(k))||(l=c._parseDots(f),!l))return null;if(a=a.shape||a.node,l.length){a.removeChild(g);g.on=!0;g.method="none";g.color=l[0].color;g.color2=l[l.length-1].color;for(var m=[],p=0,q=l.length;q>p;p++)l[p].offset&&m.push(l[p].offset+n+l[p].color);g.colors=m.length?m.join():"0% "+g.color;"radial"==i?(g.type="gradientTitle",g.focus="100%",g.focussize="0 0",g.focusposition=j,g.angle=0):(g.type="gradient",g.angle=(270-k)%360);a.appendChild(g)}return 1},D=function(a,b){this[0]=this.node=a;a.raphael=!0;this.id=c._oid++;a.raphaelid=this.id;this.X=0;this.Y=0;this.attrs={};this.paper=b;this.matrix=c.matrix();this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1};!b.bottom&&(b.bottom=this);this.prev=b.top;b.top&&(b.top.next=this);b.top=this;this.next=null},E=c.el;D.prototype=E;E.constructor=D;E.transform=function(a){var d,e,f;if(null==a)return this._.transform;e=this.paper._viewBoxShift;f=e?"s"+[e.scale,e.scale]+"-1-1t"+[e.dx,e.dy]:o;e&&(d=a=b(a).replace(/\.{3}|\u2026/g,this._.transform||o));c._extractTransform(this,f+a);var g,h=this.matrix.clone(),i=this.skew,j=this.node,k=~b(this.attrs.fill).indexOf("-"),l=!b(this.attrs.fill).indexOf("url(");if(h.translate(1,1),l||k||"image"==this.type)if(i.matrix="1 0 0 1",i.offset="0 0",g=h.split(),k&&g.noRotation||!g.isSimple){j.style.filter=h.toFilter();var m=this.getBBox(),p=this.getBBox(1),q=m.x-p.x,r=m.y-p.y;j.coordorigin=q*-u+n+r*-u;z(this,1,1,q,r,0)}else j.style.filter=o,z(this,g.scalex,g.scaley,g.dx,g.dy,g.rotate);else j.style.filter=o,i.matrix=b(h),i.offset=h.offset();return d&&(this._.transform=d),this};E.rotate=function(a,c,e){if(this.removed)return this;if(null!=a){if(a=b(a).split(k),a.length-1&&(c=d(a[1]),e=d(a[2])),a=d(a[0]),null==e&&(c=e),null==c||null==e){var f=this.getBBox(1);c=f.x+f.width/2;e=f.y+f.height/2}return this._.dirtyT=1,this.transform(this._.transform.concat([["r",a,c,e]])),this}};E.translate=function(a,c){return this.removed?this:(a=b(a).split(k),a.length-1&&(c=d(a[1])),a=d(a[0])||0,c=+c||0,this._.bbox&&(this._.bbox.x+=a,this._.bbox.y+=c),this.transform(this._.transform.concat([["t",a,c]])),this)};E.scale=function(a,c,e,f){if(this.removed)return this;if(a=b(a).split(k),a.length-1&&(c=d(a[1]),e=d(a[2]),f=d(a[3]),isNaN(e)&&(e=null),isNaN(f)&&(f=null)),a=d(a[0]),null==c&&(c=a),null==f&&(e=f),null==e||null==f)var g=this.getBBox(1);return e=null==e?g.x+g.width/2:e,f=null==f?g.y+g.height/2:f,this.transform(this._.transform.concat([["s",a,c,e,f]])),this._.dirtyT=1,this};E.hide=function(){return!this.removed&&(this.node.style.display="none"),this};E.show=function(){return!this.removed&&(this.node.style.display=o),this};E._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}};E.remove=function(){if(!this.removed&&this.node.parentNode){this.paper.__set__&&this.paper.__set__.exclude(this);c.eve.unbind("raphael.*.*."+this.id);c._tear(this,this.paper);this.node.parentNode.removeChild(this.node);this.shape&&this.shape.parentNode.removeChild(this.shape);for(var a in this)this[a]="function"==typeof this[a]?c._removedFactory(a):null;this.removed=!0}};E.attr=function(b,d){var e,f,n,o,p,q;if(this.removed)return this;if(null==b){e={};for(f in this.attrs)this.attrs[a](f)&&(e[f]=this.attrs[f]);return e.gradient&&"none"==e.fill&&(e.fill=e.gradient)&&delete e.gradient,e.transform=this._.transform,e}if(null==d&&c.is(b,"string")){if(b==j&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;for(var g=b.split(k),h={},i=0,m=g.length;m>i;i++)b=g[i],h[b]=b in this.attrs?this.attrs[b]:c.is(this.paper.customAttributes[b],"function")?this.paper.customAttributes[b].def:c._availableAttrs[b];return m-1?h:h[g[0]]}if(this.attrs&&null==d&&c.is(b,"array")){for(h={},i=0,m=b.length;m>i;i++)h[b[i]]=this.attr(b[i]);return h}null!=d&&(n={},n[b]=d);null==d&&c.is(b,"object")&&(n=b);for(o in n)l("raphael.attr."+o+"."+this.id,this,n[o]);if(n){for(o in this.paper.customAttributes)if(this.paper.customAttributes[a](o)&&n[a](o)&&c.is(this.paper.customAttributes[o],"function")){p=this.paper.customAttributes[o].apply(this,[].concat(n[o]));this.attrs[o]=n[o];for(q in p)p[a](q)&&(n[q]=p[q])}n.text&&"text"==this.type&&(this.textpath.string=n.text);B(this,n)}return this};E.toFront=function(){return!this.removed&&this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&c._tofront(this,this.paper),this};E.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),c._toback(this,this.paper)),this)};E.insertAfter=function(a){return this.removed?this:(a.constructor==c.st.constructor&&(a=a[a.length-1]),a.node.nextSibling?a.node.parentNode.insertBefore(this.node,a.node.nextSibling):a.node.parentNode.appendChild(this.node),c._insertafter(this,a,this.paper),this)};E.insertBefore=function(a){return this.removed?this:(a.constructor==c.st.constructor&&(a=a[0]),a.node.parentNode.insertBefore(this.node,a.node),c._insertbefore(this,a,this.paper),this)};E.blur=function(a){var b=this.node.runtimeStyle,d=b.filter;return d=d.replace(r,o),0!=+a?(this.attrs.blur=a,b.filter=d+n+m+".Blur(pixelradius="+(+a||1.5)+")",b.margin=c.format("-{0}px 0 0 -{0}px",f(+a||1.5))):(b.filter=d,b.margin=0,delete this.attrs.blur),this};c._engine.path=function(a,b){var c=F("shape"),d,e,f;return c.style.cssText=t,c.coordsize=u+n+u,c.coordorigin=b.coordorigin,d=new D(c,b),e={fill:"none",stroke:"#000"},a&&(e.path=a),d.type="path",d.path=[],d.Path=o,B(d,e),b.canvas.appendChild(c),f=F("skew"),f.on=!0,c.appendChild(f),d.skew=f,d.transform(o),d};c._engine.rect=function(a,b,d,e,f,g){var h=c._rectPath(b,d,e,f,g),i=a.path(h),j=i.attrs;return i.X=j.x=b,i.Y=j.y=d,i.W=j.width=e,i.H=j.height=f,j.r=g,j.path=h,i.type="rect",i};c._engine.ellipse=function(a,b,c,d,e){var f=a.path();return f.attrs,f.X=b-d,f.Y=c-e,f.W=2*d,f.H=2*e,f.type="ellipse",B(f,{cx:b,cy:c,rx:d,ry:e}),f};c._engine.circle=function(a,b,c,d){var e=a.path();return e.attrs,e.X=b-d,e.Y=c-d,e.W=e.H=2*d,e.type="circle",B(e,{cx:b,cy:c,r:d}),e};c._engine.image=function(a,b,d,e,f,g){var h=c._rectPath(d,e,f,g),i=a.path(h).attr({stroke:"none"}),k=i.attrs,l=i.node,m=l.getElementsByTagName(j)[0];return k.src=b,i.X=k.x=d,i.Y=k.y=e,i.W=k.width=f,i.H=k.height=g,k.path=h,i.type="image",m.parentNode==l&&l.removeChild(m),m.rotate=!0,m.src=b,m.type="tile",i._.fillpos=[d,e],i._.fillsize=[f,g],l.appendChild(m),z(i,1,1,0,0,0),i};c._engine.text=function(a,d,e,g){var h=F("shape"),i=F("path"),j=F("textpath"),k,l,m;return d=d||0,e=e||0,g=g||"",i.v=c.format("m{0},{1}l{2},{1}",f(d*u),f(e*u),f(d*u)+1),i.textpathok=!0,j.string=b(g),j.on=!0,h.style.cssText=t,h.coordsize=u+n+u,h.coordorigin="0 0",k=new D(h,a),l={fill:"#000",stroke:"none",font:c._availableAttrs.font,text:g},k.shape=h,k.path=i,k.textpath=j,k.type="text",k.attrs.text=b(g),k.attrs.x=d,k.attrs.y=e,k.attrs.w=1,k.attrs.h=1,B(k,l),h.appendChild(j),h.appendChild(i),a.canvas.appendChild(h),m=F("skew"),m.on=!0,h.appendChild(m),k.skew=m,k.transform(o),k};c._engine.setSize=function(a,b){var d=this.canvas.style;return this.width=a,this.height=b,a==+a&&(a+="px"),b==+b&&(b+="px"),d.width=a,d.height=b,d.clip="rect(0 "+a+" "+b+" 0)",this._viewBox&&c._engine.setViewBox.apply(this,this._viewBox),this};c._engine.setViewBox=function(a,b,d,e,f){c.eve("raphael.setViewBox",this,this._viewBox,[a,b,d,e,f]);var h,i,j=this.width,k=this.height,l=1/g(d/j,e/k);return f&&(h=k/e,i=j/d,j>d*h&&(a-=(j-d*h)/2/h),k>e*i&&(b-=(k-e*i)/2/i)),this._viewBox=[a,b,d,e,!!f],this._viewBoxShift={dx:-a,dy:-b,scale:l},this.forEach(function(a){a.transform("...")}),this};c._engine.initWin=function(a){var b=a.document;b.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{b.namespaces.rvml||b.namespaces.add("rvml","urn:schemas-microsoft-com:vml");F=function(a){return b.createElement("<rvml:"+a+' class="rvml">')}}catch(c){F=function(a){return b.createElement("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}};c._engine.initWin(c._g.win);c._engine.create=function(){var a=c._getContainer.apply(0,arguments),b=a.container,d=a.height,e=a.width,f=a.x,g=a.y;if(!b)throw new Error("VML container not found.");var h=new c._Paper,i=h.canvas=c._g.doc.createElement("div"),j=i.style;return f=f||0,g=g||0,e=e||512,d=d||342,h.width=e,h.height=d,e==+e&&(e+="px"),d==+d&&(d+="px"),h.coordsize=1e3*u+n+1e3*u,h.coordorigin="0 0",h.span=c._g.doc.createElement("span"),h.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",i.appendChild(h.span),j.cssText=c.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",e,d),1==b?(c._g.doc.body.appendChild(i),j.left=f+"px",j.top=g+"px",j.position="absolute"):b.firstChild?b.insertBefore(i,b.firstChild):b.appendChild(i),h.renderfix=function(){},h};c.prototype.clear=function(){c.eve("raphael.clear",this);this.canvas.innerHTML=o;this.span=c._g.doc.createElement("span");this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";this.canvas.appendChild(this.span);this.bottom=this.top=null};c.prototype.remove=function(){c.eve("raphael.remove",this);this.canvas.parentNode.removeChild(this.canvas);for(var a in this)this[a]="function"==typeof this[a]?c._removedFactory(a):null;return!0};G=c.st;for(H in E)E[a](H)&&!G[a](H)&&(G[H]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a].apply(c,b)})}}(H))}}(),B.was?A.win.Raphael=c:Raphael=c,c});
/*! http://mths.be/placeholder v2.0.7 by @mathias */
(function(window,document,$){function args(elem){var newAttrs={},rinlinejQuery=/^jQuery\d+$/;return $.each(elem.attributes,function(i,attr){attr.specified&&!rinlinejQuery.test(attr.name)&&(newAttrs[attr.name]=attr.value)}),newAttrs}function clearPlaceholder(event,value){var input=this,$input=$(input);if(input.value==$input.attr("placeholder")&&$input.hasClass("placeholder"))if($input.data("placeholder-password")){if($input=$input.hide().next().show().attr("id",$input.removeAttr("id").data("placeholder-id")),event===!0)return $input[0].value=value;$input.focus()}else input.value="",$input.removeClass("placeholder"),input==safeActiveElement()&&input.select()}function setPlaceholder(){var $replacement,input=this,$input=$(input),id=this.id;if(input.value==""){if(input.type=="password"){if(!$input.data("placeholder-textinput")){try{$replacement=$input.clone().attr({type:"text"})}catch(e){$replacement=$("<input>").attr($.extend(args(this),{type:"text"}))}$replacement.removeAttr("name").data({"placeholder-password":$input,"placeholder-id":id}).bind("focus.placeholder",clearPlaceholder);$input.data({"placeholder-textinput":$replacement,"placeholder-id":id}).before($replacement)}$input=$input.removeAttr("id").hide().prev().attr("id",id).show()}$input.addClass("placeholder");$input[0].value=$input.attr("placeholder")}else $input.removeClass("placeholder")}function safeActiveElement(){try{return document.activeElement}catch(err){}}var isInputSupported="placeholder"in document.createElement("input"),isTextareaSupported="placeholder"in document.createElement("textarea"),prototype=$.fn,valHooks=$.valHooks,propHooks=$.propHooks,hooks,placeholder;isInputSupported&&isTextareaSupported?(placeholder=prototype.placeholder=function(){return this},placeholder.input=placeholder.textarea=!0):(placeholder=prototype.placeholder=function(){var $this=this;return $this.filter((isInputSupported?"textarea":":input")+"[placeholder]").not(".placeholder").bind({"focus.placeholder":clearPlaceholder,"blur.placeholder":setPlaceholder}).data("placeholder-enabled",!0).trigger("blur.placeholder"),$this},placeholder.input=isInputSupported,placeholder.textarea=isTextareaSupported,hooks={get:function(element){var $element=$(element),$passwordInput=$element.data("placeholder-password");return $passwordInput?$passwordInput[0].value:$element.data("placeholder-enabled")&&$element.hasClass("placeholder")?"":element.value},set:function(element,value){var $element=$(element),$passwordInput=$element.data("placeholder-password");return $passwordInput?$passwordInput[0].value=value:$element.data("placeholder-enabled")?(value==""?(element.value=value,element!=safeActiveElement()&&setPlaceholder.call(element)):$element.hasClass("placeholder")?clearPlaceholder.call(element,!0,value)||(element.value=value):element.value=value,$element):element.value=value}},isInputSupported||(valHooks.input=hooks,propHooks.value=hooks),isTextareaSupported||(valHooks.textarea=hooks,propHooks.value=hooks),$(function(){$(document).delegate("form","submit.placeholder",function(){var $inputs=$(".placeholder",this).each(clearPlaceholder);setTimeout(function(){$inputs.each(setPlaceholder)},10)})}),$(window).bind("beforeunload.placeholder",function(){$(".placeholder").each(function(){this.value=""})}))})(this,document,jQuery);Oskari.registerLocalization({lang:"fi",key:"DivManazer",value:{VisualizationForm:{tooltips:{dot:"Muokkaa pisteen esitystapaa",area:"Muokkaa alueen esitystapaa",line:"Muokkaa viivan esitystapaa"},dot:{title:"Pistekohteen esitystapa",tooltip:"",symbol:{label:"Pistekohteen kuvake"},size:{label:"Koko"},color:{label:"Vri",labelOr:"tai",labelCustom:"Oma RGB-vri (0-255)"},preview:{label:"Esikatselu"},buttons:{save:"Tallenna",cancel:"Peruuta"}},line:{title:"Viivan esitystapa",tooltip:"",style:{label:"Viivan tyyli"},cap:{label:"Viivan pdyt"},corner:{label:"Kulmat"},width:{label:"Leveys"},color:{label:"Vri",labelOr:"tai",labelCustom:"Oma RGB-vri (0-255)"},preview:{label:"Esikatselu"},buttons:{save:"Tallenna",cancel:"Peruuta"}},area:{title:"Alueen esitystapa",tooltip:"",linestyle:{label:"Alueen viivan tyyli"},linecap:{label:"Alueen viivan pdyt"},linecorner:{label:"Kulmat"},linewidth:{label:"Leveys"},linecolor:{label:"Viivan vri",labelOr:"tai",labelCustom:"Oma RGB-vri (0-255)"},color:{label:"Alueen tyttvri",labelOr:"tai",labelCustom:"Oma RGB-vri (0-255)"},fill:{label:"Alueen tyttkuvio"},preview:{label:"Esikatselu"},buttons:{save:"Tallenna",cancel:"Peruuta"}}}}});Oskari.registerLocalization({lang:"sv",key:"DivManazer",value:{VisualizationForm:{tooltips:{dot:"Editera punktens stil",area:"Editera omrdets stil",line:"Editera linjens stil"},dot:{title:"Visualisering av punktobjekt",tooltip:"Punktens stil",symbol:{label:"Ikon fr punktobjekt"},size:{label:"Storlek"},color:{label:"Frg",labelOr:"eller",labelCustom:"Egen RGB-frg (0-255)"},preview:{label:"Frhandsgranska"},buttons:{save:"Lagra",cancel:"Tillbaka"}},line:{title:"Visualisering av linje",tooltip:"",style:{label:"Linjens stil"},cap:{label:"Linjens ndpunkter"},corner:{label:"Hrn"},width:{label:"Bredd"},color:{label:"Frg",labelOr:"eller",labelCustom:"Egen RGB-frg (0-255)"},preview:{label:"Frhandsgranska"},buttons:{save:"Lagra",cancel:"Tillbaka"}},area:{title:"Visualisering av omrdet",tooltip:"",linestyle:{label:"Konturlinjens stil"},linecap:{label:"Linjens ndpunkter"},linecorner:{label:"Hrn"},linewidth:{label:"Bredd"},linecolor:{label:"Linjens frg",labelOr:"eller",labelCustom:"Egen RGB-frg (0-255)"},color:{label:"Ifyllnadsfrg fr omrde",labelOr:"eller",labelCustom:"Egen RGB-frg (0-255)"},fill:{label:"Ifyllnandsmnster fr omrde"},preview:{label:"Frhandsvisning"},buttons:{save:"Lagra",cancel:"Tillbaka"}}}}});Oskari.registerLocalization({lang:"en",key:"DivManazer",value:{VisualizationForm:{tooltips:{dot:"Edit point style",area:"Edit area style",line:"Edit line style"},dot:{title:"Point feature portrayal",tooltip:"",symbol:{label:"Point feature icon"},size:{label:"Size"},color:{label:"Colour",labelOr:"or",labelCustom:"Custom RGB color (0-255)"},preview:{label:"Preview"},buttons:{save:"Save",cancel:"Cancel"}},line:{title:"Line portrayal",tooltip:"",style:{label:"Line style"},cap:{label:"Line endigs"},corner:{label:"Corners"},width:{label:"Width"},color:{label:"Colour",labelOr:"or",labelCustom:"Custom RGB colour (0-255)"},preview:{label:"Preview"},buttons:{save:"Save",cancel:"Cancel"}},area:{title:"Area portrayal",tooltip:"",linestyle:{label:"Area line style"},linecap:{label:"Area line endings"},linecorner:{label:"Corners"},linewidth:{label:"Width"},linecolor:{label:"Line colour",labelOr:"or",labelCustom:"Custom RGB colour (0-255)"},color:{label:"Area fill colour",labelOr:"or",labelCustom:"Own RGB colour (0-255)"},fill:{label:"Area fill pattern"},preview:{label:"Preview"},buttons:{save:"Save",cancel:"Cancel"}}}}});Oskari.registerLocalization({lang:"cs",key:"DivManazer",value:{VisualizationForm:{tooltips:{dot:"Edit point style",area:"Edit area style",line:"Edit line style"},dot:{title:"Point feature portrayal",tooltip:"",symbol:{label:"Point feature icon"},size:{label:"Size"},color:{label:"Colour",labelOr:"or",labelCustom:"Custom RGB color (0-255)"},preview:{label:"Preview"},buttons:{save:"Save",cancel:"Cancel"}},line:{title:"Line portrayal",tooltip:"",style:{label:"Line style"},cap:{label:"Line endigs"},corner:{label:"Corners"},width:{label:"Width"},color:{label:"Colour",labelOr:"or",labelCustom:"Custom RGB colour (0-255)"},preview:{label:"Preview"},buttons:{save:"Save",cancel:"Cancel"}},area:{title:"Area portrayal",tooltip:"",linestyle:{label:"Area line style"},linecap:{label:"Area line endings"},linecorner:{label:"Corners"},linewidth:{label:"Width"},linecolor:{label:"Line colour",labelOr:"or",labelCustom:"Custom RGB colour (0-255)"},color:{label:"Area fill colour",labelOr:"or",labelCustom:"Own RGB colour (0-255)"},fill:{label:"Area fill pattern"},preview:{label:"Preview"},buttons:{save:"Save",cancel:"Cancel"}}}}});Oskari.registerLocalization({lang:"de",key:"DivManazer",value:{VisualizationForm:{tooltips:{dot:"Edit point style",area:"Edit area style",line:"Edit line style"},dot:{title:"Point feature portrayal",tooltip:"",symbol:{label:"Point feature icon"},size:{label:"Size"},color:{label:"Colour",labelOr:"or",labelCustom:"Custom RGB color (0-255)"},preview:{label:"Preview"},buttons:{save:"Save",cancel:"Cancel"}},line:{title:"Line portrayal",tooltip:"",style:{label:"Line style"},cap:{label:"Line endigs"},corner:{label:"Corners"},width:{label:"Width"},color:{label:"Colour",labelOr:"or",labelCustom:"Custom RGB colour (0-255)"},preview:{label:"Preview"},buttons:{save:"Save",cancel:"Cancel"}},area:{title:"Area portrayal",tooltip:"",linestyle:{label:"Area line style"},linecap:{label:"Area line endings"},linecorner:{label:"Corners"},linewidth:{label:"Width"},linecolor:{label:"Line colour",labelOr:"or",labelCustom:"Custom RGB colour (0-255)"},color:{label:"Area fill colour",labelOr:"or",labelCustom:"Own RGB colour (0-255)"},fill:{label:"Area fill pattern"},preview:{label:"Preview"},buttons:{save:"Save",cancel:"Cancel"}}}}});Oskari.registerLocalization({lang:"es",key:"DivManazer",value:{VisualizationForm:{tooltips:{dot:"Edit point style",area:"Edit area style",line:"Edit line style"},dot:{title:"Point feature portrayal",tooltip:"",symbol:{label:"Point feature icon"},size:{label:"Size"},color:{label:"Colour",labelOr:"or",labelCustom:"Custom RGB color (0-255)"},preview:{label:"Preview"},buttons:{save:"Save",cancel:"Cancel"}},line:{title:"Line portrayal",tooltip:"",style:{label:"Line style"},cap:{label:"Line endigs"},corner:{label:"Corners"},width:{label:"Width"},color:{label:"Colour",labelOr:"or",labelCustom:"Custom RGB colour (0-255)"},preview:{label:"Preview"},buttons:{save:"Save",cancel:"Cancel"}},area:{title:"Area portrayal",tooltip:"",linestyle:{label:"Area line style"},linecap:{label:"Area line endings"},linecorner:{label:"Corners"},linewidth:{label:"Width"},linecolor:{label:"Line colour",labelOr:"or",labelCustom:"Custom RGB colour (0-255)"},color:{label:"Area fill colour",labelOr:"or",labelCustom:"Own RGB colour (0-255)"},fill:{label:"Area fill pattern"},preview:{label:"Preview"},buttons:{save:"Save",cancel:"Cancel"}}}}});Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.ToolbarBundle",function(){},{create:function(){return Oskari.clazz.create("Oskari.mapframework.bundle.toolbar.ToolbarBundleInstance")},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/button-methods.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/default-buttons.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/request/AddToolButtonRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/request/RemoveToolButtonRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/request/ToolButtonStateRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/request/SelectToolButtonRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/request/ToolButtonRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/request/ShowMapMeasurementRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/event/ToolSelectedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/request/ToolbarRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/request/ToolbarRequestHandler.js"},{type:"text/css",src:"../../../../resources/framework/bundle/toolbar/css/toolbar.css"}],locales:[{lang:"am",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/am.js"},{lang:"cs",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/cs.js"},{lang:"da",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/da.js"},{lang:"de",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/de.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/en.js"},{lang:"es",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/es.js"},{lang:"et",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/et.js"},{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/fi.js"},{lang:"hr",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/hr.js"},{lang:"hu",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/hu.js"},{lang:"lv",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/lv.js"},{lang:"nl",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/nl.js"},{lang:"pl",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/pl.js"},{lang:"pt",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/pt.js"},{lang:"ro",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/ro.js"},{lang:"rs",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/rs.js"},{lang:"sl",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/sl.js"},{lang:"sk",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/sk.js"},{lang:"sq",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/sq.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/sv.js"},{lang:"uk",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/uk.js"}]},bundle:{manifest:{"Bundle-Identifier":"toolbar","Bundle-Name":"toolbar","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:"Toolbar",Title:"Toolbar"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}},dependencies:["jquery"]});Oskari.bundle_manager.installBundleClass("toolbar","Oskari.mapframework.bundle.toolbar.ToolbarBundle");Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.ToolbarBundleInstance",function(){this.sandbox=null;this.started=!1;this.buttons={};this.selectedButton=null;this.defaultButton=null;this.container=null;this.menutoolbarcontainer=null;this.containers={};this.toolbars={};this.groupsToToolbars={}},{__name:"Toolbar",getName:function(){return this.__name},setSandbox:function(sbx){this.sandbox=sbx},getSandbox:function(){return this.sandbox},update:function(){},start:function(){var me=this,defaultContainerId,defaultMenuToolbarContainer,p;if(!me.started){me.started=!0;var conf=me.conf,sandboxName=(conf?conf.sandbox:null)||"sandbox",sandbox=Oskari.getSandbox(sandboxName);sandbox.register(me);me.setSandbox(sandbox);defaultContainerId=(conf?conf.defaultToolbarContainer:null)||"#toolbar";this.container=jQuery(defaultContainerId);this.containers["default"]=this.container;this.toolbars["default"]=this.container;defaultMenuToolbarContainer=(conf?conf.defaultMenuToolbarContainer:null)||"#menutoolbar";this.menutoolbarcontainer=jQuery(defaultMenuToolbarContainer);for(p in me.eventHandlers)me.eventHandlers.hasOwnProperty(p)&&p&&sandbox.registerForEventByName(me,p);sandbox.addRequestHandler("Toolbar.AddToolButtonRequest",this.requestHandlers.toolButtonRequestHandler);sandbox.addRequestHandler("Toolbar.RemoveToolButtonRequest",this.requestHandlers.toolButtonRequestHandler);sandbox.addRequestHandler("Toolbar.ToolButtonStateRequest",this.requestHandlers.toolButtonRequestHandler);sandbox.addRequestHandler("Toolbar.SelectToolButtonRequest",this.requestHandlers.toolButtonRequestHandler);sandbox.addRequestHandler("Toolbar.ToolbarRequest",this.requestHandlers.toolbarRequestHandler);sandbox.addRequestHandler("ShowMapMeasurementRequest",this.requestHandlers.showMapMeasurementRequestHandler);sandbox.registerAsStateful(this.mediator.bundleId,this);this._addDefaultButtons&&this._addDefaultButtons()}},templates:{group:'<div class="toolrow"><\/div>',tool:'<div class="tool"><\/div>',menutoolbar:'<div class="oskari-closed oskariui-menutoolbar"><div class="oskariui-menutoolbar-modetitle"><div class="oskariui-menutoolbar-title"><p><\/p><\/div><\/div><div class="oskariui-menutoolbar-container"><div class="oskariui-menutoolbarbuttongroup"><\/div><\/div><div class="oskariui-menutoolbar-closebox"><div class="icon-close-white"><\/div><\/div><\/div>',addedToolbar:'<div class="oskariui-toolbar-title"><p><\/p><\/div><div class="oskariui-toolbar-container"><div class="oskariui-toolbarbuttongroup"><\/div><\/div>'},init:function(){var me=this;this.templateGroup=jQuery(this.templates.group);this.templateTool=jQuery(this.templates.tool);this.templateMenutoolbar=jQuery(this.templates.menutoolbar);this.requestHandlers={toolButtonRequestHandler:Oskari.clazz.create("Oskari.mapframework.bundle.toolbar.request.ToolButtonRequestHandler",me),toolbarRequestHandler:Oskari.clazz.create("Oskari.mapframework.bundle.toolbar.request.ToolbarRequestHandler",me),showMapMeasurementRequestHandler:Oskari.clazz.create("Oskari.mapframework.bundle.toolbar.request.ShowMapMeasurementRequestHandler",me)}},createMenuToolbarContainer:function(tbid,pdata){var data=pdata||{},tbcontainer=this.templateMenutoolbar.clone(),c;return this.menutoolbarcontainer.append(tbcontainer),this.toolbars[tbid]=tbcontainer,c=tbcontainer.find(".oskariui-menutoolbarbuttongroup"),this.containers[tbid]=c,data.title&&tbcontainer.find(".oskariui-menutoolbar-title p").append(data.title),data.show&&tbcontainer.removeClass("oskari-closed"),data.closeBoxCallback&&tbcontainer.find(".oskariui-menutoolbar-closebox div").click(data.closeBoxCallback),c},addToolbarContainer:function(tbid,pdata){var tbcontainer=pdata.toolbarContainer,c;return tbcontainer.append(jQuery(this.templates.addedToolbar)),this.toolbars[tbid]=tbcontainer,c=tbcontainer.find(".oskariui-toolbarbuttongroup"),this.containers[tbid]=c,pdata.title&&tbcontainer.find(".oskariui-toolbar-title p").append(pdata.title),c},changeMenuToolbarTitle:function(title){title&&this.menutoolbarcontainer.find(".oskariui-menutoolbar-title p").html(title)},getToolbarContainer:function(ptbid,data){var tbid=ptbid||"default",c=this.containers[tbid];return c===undefined&&this.menutoolbarcontainer&&!data.toolbarContainer?c=this.createMenuToolbarContainer(tbid,data):(c===undefined||c.parents("body").length===0)&&data&&data.toolbarContainer&&(c=this.addToolbarContainer(tbid,data)),c},onEvent:function(event){var me=this,handler=me.eventHandlers[event.getName()];if(handler)return handler.apply(this,[event])},measureTools:{basictools:{measureline:!0,measurearea:!0}},eventHandlers:{"Toolbar.ToolSelectedEvent":function(event){var me=this,sandbox=this.getSandbox(),msg;me.measureTools[event.getGroupId()]&&me.measureTools[event.getGroupId()][event.getToolId()]&&(msg=me.getLocalization("measure").guidance[event.getToolId()],sandbox.request(me,sandbox.getRequestBuilder("ShowMapMeasurementRequest")(msg||"",!1,null,null)))}},stop:function(){var me=this,sandbox=me.sandbox();for(var p in me.eventHandlers)me.eventHandlers.hasOwnProperty(p)&&p&&sandbox.unregisterFromEventByName(me,p);sandbox.removeRequestHandler("ShowMapMeasurementRequest",this.requestHandlers.showMapMeasurementRequestHandler);sandbox.removeRequestHandler("Toolbar.ToolbarRequest",this.requestHandlers.toolbarRequestHandler);sandbox.removeRequestHandler("Toolbar.AddToolButtonRequest",this.requestHandlers.toolButtonRequestHandler);sandbox.removeRequestHandler("Toolbar.RemoveToolButtonRequest",this.requestHandlers.toolButtonRequestHandler);sandbox.removeRequestHandler("Toolbar.ToolButtonStateRequest",this.requestHandlers.toolButtonRequestHandler);sandbox.removeRequestHandler("Toolbar.SelectToolButtonRequest",this.requestHandlers.toolButtonRequestHandler);this.sandbox.unregisterStateful(this.mediator.bundleId);me.sandbox.unregister(me);me.started=!1},getLocalization:function(key){return(this._localization||(this._localization=Oskari.getLocalization(this.getName())),key)?this._localization[key]:this._localization},setState:function(state){var toolbar,groupContainer,button;if(state)if(state.selected){this.selectedButton=state.selected;var tool=state.selected.id,group=state.selected.group,groupName=group.split("-");groupName.length<2&&(group="default-"+group);toolbar=this.getToolbarContainer();this._removeToolSelections();groupContainer=toolbar.find("div.toolrow[tbgroup="+group+"]");groupContainer.length>0&&(button=groupContainer.find("div.tool[tool="+tool+"]"),button.length>0&&(button.addClass("selected"),this.buttons[group][tool].callback()))}else this.selectedButton=null},getState:function(){var state={};return this.selectedButton&&(state.selected=this.selectedButton),state},_removeToolbar:function(tbid){var tb=this.toolbars[tbid];tb&&tb.remove();this.toolbars[tbid]=undefined;delete this.toolbars[tbid]},_showToolbar:function(tbid){this.toolbars[tbid].show()},_hideToolbar:function(tbid){this.toolbars[tbid].hide()},_addToolbar:function(tbid,data){this.getToolbarContainer(tbid,data)}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module"]});Oskari.clazz.category("Oskari.mapframework.bundle.toolbar.ToolbarBundleInstance","button-methods",{addToolButton:function(pId,pGroup,pConfig){var button;if(pId&&pGroup&&pConfig&&pConfig.callback){var me=this,toolbar=me.getToolbarContainer(pConfig?pConfig.toolbarid:null,pConfig),group=null,prefixedGroup=(pConfig.toolbarid||"default")+"-"+pGroup;(me.buttons[prefixedGroup]?group=toolbar.find("div.toolrow[tbgroup="+prefixedGroup+"]"):(me.buttons[prefixedGroup]={},group=me.templateGroup.clone(),group.attr("tbgroup",prefixedGroup),toolbar.append(group),me.groupsToToolbars[prefixedGroup]=pConfig?pConfig.toolbarid:null),me.buttons[prefixedGroup][pId])||(me.buttons[prefixedGroup][pId]=pConfig,button=me.templateTool.clone(),button.attr("tool",pId),button.attr("title",pConfig.tooltip),me.conf.classes&&me.conf.classes[pGroup]&&me.conf.classes[pGroup][pId]?button.addClass(me.conf.classes[pGroup][pId].iconCls):button.addClass(pConfig.iconCls),pConfig.text&&button.append(pConfig.tooltip),me.selectedButton?me.selectedButton.id===pId&&me.selectedButton.group===prefixedGroup&&(button.addClass("selected"),pConfig.callback()):pConfig.selected&&(button.addClass("selected"),me.selectedButton={id:pId,group:prefixedGroup}),pConfig.selected&&(me.defaultButton={id:pId,group:prefixedGroup}),button.bind("click",function(){me._clickButton(pId,prefixedGroup)}),pConfig.prepend?group.prepend(button):group.append(button),pConfig.disabled===!0&&button.addClass("disabled"))}},_clickButton:function(pId,pGroup){var btn,toolbar,group,button,e;if(!pId)if(this.defaultButton)pId=this.defaultButton.id,pGroup=this.defaultButton.group;else{e=this.sandbox.getEventBuilder("Toolbar.ToolSelectedEvent")(pId,pGroup);this.sandbox.notifyAll(e);this.container.find(".tool.selected").removeClass("selected");return}(btn=this.buttons[pGroup][pId],btn.enabled!=!1)&&(btn.sticky==!0&&(e=this.sandbox.getEventBuilder("Toolbar.ToolSelectedEvent")(pId,pGroup),this.sandbox.notifyAll(e),this._removeToolSelections(pGroup),toolbar=this.getToolbarContainer(this.groupsToToolbars[pGroup]),group=toolbar.find("div.toolrow[tbgroup="+pGroup+"]"),button=group.find("div.tool[tool="+pId+"]"),button.addClass("selected"),this.selectedButton={id:pId,group:pGroup}),btn.toggleSelection&&(toolbar=this.getToolbarContainer(this.groupsToToolbars[pGroup]),group=toolbar.find("div.toolrow[tbgroup="+pGroup+"]"),button=group.find("div.tool[tool="+pId+"]"),button.hasClass("selected")?button.removeClass("selected"):button.addClass("selected")),btn.callback())},_removeToolSelections:function(pGroup){var toolbar=this.getToolbarContainer(this.groupsToToolbars[pGroup]),tools=toolbar.find("div.tool");tools.removeClass("selected")},removeToolButton:function(pId,pGroup,pToolbarId){var prefixedGroup,toolbar,group,button,count,key;if(pGroup&&(prefixedGroup=(pToolbarId||"default")+"-"+pGroup,this.buttons[prefixedGroup]))if(toolbar=this.getToolbarContainer(this.groupsToToolbars[prefixedGroup]),group=toolbar.find("div.toolrow[tbgroup="+prefixedGroup+"]"),pId){button=group.find("div.tool[tool="+pId+"]");button.remove();this.buttons[prefixedGroup][pId]=null;delete this.buttons[prefixedGroup][pId];count=0;for(key in this.buttons[prefixedGroup])this.buttons[prefixedGroup].hasOwnProperty(key)&&count++;count===0&&(group.remove(),this.buttons[prefixedGroup]=null,delete this.buttons[prefixedGroup])}else group.remove(),this.buttons[prefixedGroup]=null,delete this.buttons[prefixedGroup]},changeToolButtonState:function(pId,pGroup,pState,pToolbarId){var prefixedGroup,toolbar,group,button,buttonContainers,b;if(pGroup&&(prefixedGroup=(pToolbarId||"default")+"-"+pGroup,this.buttons[prefixedGroup]))if(toolbar=this.getToolbarContainer(this.groupsToToolbars[prefixedGroup]),group=toolbar.find("div.toolrow[tbgroup="+prefixedGroup+"]"),pId)button=group.find("div.tool[tool="+pId+"]"),this.buttons[prefixedGroup][pId].enabled=pState,pState?button.removeClass("disabled"):button.addClass("disabled");else{buttonContainers=group.find("div.tool");pState?buttonContainers.removeClass("disabled"):buttonContainers.addClass("disabled");for(b in this.buttons[prefixedGroup])this.buttons[prefixedGroup].hasOwnProperty(b)&&(this.buttons[prefixedGroup][b].enabled=pState)}}});Oskari.clazz.category("Oskari.mapframework.bundle.toolbar.ToolbarBundleInstance","default-buttons",{_isButtonConfigured:function(pId,pGroup){return this.conf&&(this.conf[pGroup]===!1||this.conf[pGroup]&&this.conf[pGroup][pId]===!1)?!1:!0},_addDefaultButtons:function(){var me=this,loc=this.getLocalization("buttons"),reqBuilder=this.getSandbox().getRequestBuilder("ToolSelectionRequest"),gfiReqBuilder=this.getSandbox().getRequestBuilder("MapModulePlugin.GetFeatureInfoActivationRequest"),rb,rn,linkParams,pcn,okcn,dialog,okBtn,linkContent,wopParm,link,mapUrlPrefix=me.conf?me.getSandbox().getLocalizedProperty(me.conf.mapUrlPrefix):null,buttonGroups=[{name:"history",buttons:{reset:{iconCls:"tool-reset",tooltip:loc.history.reset,sticky:!1,callback:function(){rb=me.getSandbox().getRequestBuilder("StateHandler.SetStateRequest");rb&&me.getSandbox().request(me,rb())}},history_back:{iconCls:"tool-history-back",tooltip:loc.history.back,sticky:!1,callback:function(){me.getSandbox().request(me,reqBuilder("map_control_tool_prev"))}},history_forward:{iconCls:"tool-history-forward",tooltip:loc.history.next,sticky:!1,callback:function(){me.getSandbox().request(me,reqBuilder("map_control_tool_next"))}}}},{name:"basictools",buttons:{zoombox:{iconCls:"tool-zoombox",tooltip:loc.zoom,sticky:!0,callback:function(){rn="map_control_zoom_tool";me.getSandbox().request(me,gfiReqBuilder(!1));me.getSandbox().request(me,reqBuilder(rn))}},select:{iconCls:"tool-pan",tooltip:loc.pan,selected:!0,sticky:!0,callback:function(){rn="map_control_navigate_tool";me.getSandbox().request(me,gfiReqBuilder(!0));me.getSandbox().request(me,reqBuilder(rn))}},measureline:{iconCls:"tool-measure-line",tooltip:loc.measure.line,sticky:!0,callback:function(){rn="map_control_measure_tool";me.getSandbox().request(me,gfiReqBuilder(!1));me.getSandbox().request(me,reqBuilder(rn))}},measurearea:{iconCls:"tool-measure-area",tooltip:loc.measure.area,sticky:!0,callback:function(){rn="map_control_measure_area_tool";me.getSandbox().request(me,gfiReqBuilder(!1));me.getSandbox().request(me,reqBuilder(rn))}}}},{name:"viewtools",buttons:{link:{iconCls:"tool-link",tooltip:loc.link.tooltip,sticky:!1,callback:function(){linkParams=me.getSandbox().generateMapLinkParameters({showMarker:!0});pcn="Oskari.userinterface.component.Popup";okcn="Oskari.userinterface.component.Button";dialog=Oskari.clazz.create(pcn);dialog.addClass("no_resize");okBtn=Oskari.clazz.create(okcn);okBtn.setTitle(loc.link.ok);okBtn.addClass("primary");okBtn.setHandler(function(){rn="EnableMapKeyboardMovementRequest";dialog.close();me.getSandbox().postRequestByName(rn)});linkContent='<textarea rows="3" cols="80">'+mapUrlPrefix+linkParams+"<\/textarea>";rn="DisableMapKeyboardMovementRequest";me.getSandbox().postRequestByName(rn);dialog.show(loc.link.title,linkContent,[okBtn])}},print:{iconCls:"tool-print",tooltip:loc.print.tooltip,sticky:!1,callback:function(){wopParm="location=1,status=1,scrollbars=1,width=850,height=1200";link=window.location.pathname+"?"+me.getSandbox().generateMapLinkParameters()+"&p_p_id=Portti2Map_WAR_portti2mapportlet&p_p_lifecycle=0&p_p_state=exclusive&showMarker=false&forceCache=true&mapmode=print&viewId=2";window.open(link,"Print",wopParm)}}}}],buttonGroup;for(group in buttonGroups){buttonGroup=buttonGroups[group];for(tool in buttonGroup.buttons)(tool!=="link"||mapUrlPrefix)&&this._isButtonConfigured(tool,buttonGroup.name)&&this.addToolButton(tool,buttonGroup.name,buttonGroup.buttons[tool])}}});Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.AddToolButtonRequest",function(id,group,config){this._id=id;this._group=group;this._config=config},{__name:"Toolbar.AddToolButtonRequest",getName:function(){return this.__name},getId:function(){return this._id},getGroup:function(){return this._group},getConfig:function(){return this._config}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.RemoveToolButtonRequest",function(id,group,toolbarId){this._id=id;this._group=group;this._toolbarId=toolbarId},{__name:"Toolbar.RemoveToolButtonRequest",getName:function(){return this.__name},getId:function(){return this._id},getGroup:function(){return this._group},getToolbarId:function(){return this._toolbarId}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ToolButtonStateRequest",function(id,group,state){this._id=id;this._group=group;this._state=state==!0},{__name:"Toolbar.ToolButtonStateRequest",getName:function(){return this.__name},getId:function(){return this._id},getGroup:function(){return this._group},getState:function(){return this._state}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.SelectToolButtonRequest",function(id,group){this._id=id;this._group=group},{__name:"Toolbar.SelectToolButtonRequest",getName:function(){return this.__name},getId:function(){return this._id},getGroup:function(){return this._group}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ToolButtonRequestHandler",function(toolbar){this._toolbar=toolbar},{handleRequest:function(core,request){var sandbox=core.getSandbox(),requestName=request.getName();requestName=="Toolbar.AddToolButtonRequest"?this._handleAdd(sandbox,request):requestName=="Toolbar.RemoveToolButtonRequest"?this._handleRemove(sandbox,request):requestName=="Toolbar.ToolButtonStateRequest"?this._handleState(sandbox,request):requestName=="Toolbar.SelectToolButtonRequest"&&this._handleClick(sandbox,request)},_handleAdd:function(sandbox,request){this._toolbar.addToolButton(request.getId(),request.getGroup(),request.getConfig())},_handleRemove:function(sandbox,request){this._toolbar.removeToolButton(request.getId(),request.getGroup(),request.getToolbarId())},_handleState:function(sandbox,request){this._toolbar.changeToolButtonState(request.getId(),request.getGroup(),request.getState())},_handleClick:function(sandbox,request){this._toolbar._clickButton(request.getId(),request.getGroup())}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ShowMapMeasurementRequestHandler",function(toolbar){var me=this,loc,title,buttons,cancelBtn;me._toolbar=toolbar;loc=this._toolbar.getLocalization("measure");title=loc.title;me._title=title;me._dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup");me._dialog.addClass("oskari-measurement");buttons=[];cancelBtn=Oskari.clazz.create("Oskari.userinterface.component.Button");cancelBtn.setTitle(loc.close);buttons.push(cancelBtn);me._buttons=buttons;me._dialogShown=!1;me._content=null},{handleRequest:function(core,request){var sandbox=core.getSandbox();this._showMeasurementResults(request.getValue())},getValue:function(){return this._value},_showMeasurementResults:function(value){var me=this,dialog=me._dialog,cancelBtn;me._toolbar.conf.hasContentContainer?me._showResultsInPlugin(value):(me._dialogShown||(dialog.show(me._title,"",me._buttons),cancelBtn=me._buttons[0],cancelBtn.setHandler(function(){me._dialogShown=!1;var toolbarRequest=me._toolbar.getSandbox().getRequestBuilder("Toolbar.SelectToolButtonRequest")();me._toolbar.getSandbox().request(me._toolbar,toolbarRequest);me._dialog.close(!0)}),dialog.moveTo("#toolbar div.toolrow[tbgroup=default-basictools]","top"),me._content=jQuery("<div><\/div>"),dialog.setContent(me._content),me._dialogShown=!0),me._content.html(value))},_showResultsInPlugin:function(value){var me=this,toolContainerRequest,cancelBtn;me.toolContentDivData||(cancelBtn=me._buttons[0],cancelBtn.setHandler(function(){var toolbarRequest=me._toolbar.getSandbox().getRequestBuilder("Toolbar.SelectToolButtonRequest")();me._toolbar.getSandbox().request(me._toolbar,toolbarRequest);me._hideResultsInPlugin(!0)}),me.toolContentDivData={className:"measureline",title:me._title,content:jQuery("<div><\/div>"),buttons:me._buttons},toolContainerRequest=me._toolbar.getSandbox().getRequestBuilder("Toolbar.ToolContainerRequest")("set",me.toolContentDivData),me._toolbar.getSandbox().request(me._toolbar,toolContainerRequest));me.toolContentDivData.content.html(value)},_hideResultsInPlugin:function(){var me=this,toolContainerRequest=me._toolbar.getSandbox().getRequestBuilder("Toolbar.ToolContainerRequest")("reset",me.toolContentDivData);me._toolbar.getSandbox().request(me._toolbar,toolContainerRequest);me.toolContentDivData=null}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.event.ToolSelectedEvent",function(toolId,groupId){this._toolId=toolId;this._groupId=groupId},{__name:"Toolbar.ToolSelectedEvent",getName:function(){return this.__name},getToolId:function(){return this._toolId},getGroupId:function(){return this._groupId}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ToolbarRequest",function(id,op,data){this._id=id;this._op=op;this._data=data},{__name:"Toolbar.ToolbarRequest",getName:function(){return this.__name},getId:function(){return this._id},getOp:function(){return this._op},getData:function(){return this._data}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ToolbarRequestHandler",function(toolbar){this._toolbar=toolbar},{handleRequest:function(core,request){var sandbox=core.getSandbox(),requestOperation=request.getOp();requestOperation==="add"?this._toolbar._addToolbar(request.getId(),request.getData()):requestOperation==="show"?this._toolbar._showToolbar(request.getId()):requestOperation==="hide"?this._toolbar._hideToolbar(request.getId()):requestOperation==="remove"?this._toolbar._removeToolbar(request.getId()):requestOperation==="changeName"&&this._toolbar.changeMenuToolbarTitle(request.getData())},_handleAdd:function(sandbox,request){this._toolbar.addToolButton(request.getId(),request.getGroup(),request.getConfig())},_handleRemove:function(sandbox,request){this._toolbar.removeToolButton(request.getId(),request.getGroup())},_handleState:function(sandbox,request){this._toolbar.changeToolButtonState(request.getId(),request.getGroup(),request.getState())},_handleClick:function(sandbox,request){this._toolbar._clickButton(request.getId(),request.getGroup())}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.registerLocalization({lang:"am",key:"Toolbar",value:{buttons:{link:{tooltip:"",ok:"OK",title:"  "},print:{tooltip:""},history:{reset:"  ",back:"",next:""},pan:"  ",zoom:"",measure:{line:" ",area:" "}},measure:{title:"",close:"",guidance:{measureline:"   :    ",measurearea:"   :    "}}}});Oskari.registerLocalization({lang:"cs",key:"Toolbar",value:{buttons:{link:{tooltip:"Odkaz",ok:"Ok",title:"Odkaz na zobrazen mapy"},print:{tooltip:"Tisk"},history:{reset:"Nvrat do defaultnho zobrazen",back:"Zpt",next:"Dal"},pan:"Posunout zobrazen mapy",zoom:"Piblit",measure:{line:"Mit vzdlenost",area:"Mit plochu"}},measure:{title:"Men",close:"Storno",guidance:{measureline:"Zmit dlku na map. Men ukonte dvojklikem.",measurearea:"Zmit plochu na map. Men ukonte dvojklikem."}}}});Oskari.registerLocalization({lang:"da",key:"Toolbar",value:{buttons:{link:{tooltip:"Link",ok:"Ok",title:"Link til kortvisning"},print:{tooltip:"Print"},history:{reset:"Tilbage til standardvisning",back:"Tilbage",next:"Nste"},pan:"Pannorr kortvisning",zoom:"Zoom ind",measure:{line:"Ml afstand",area:"Ml omrde"}},measure:{title:"Ml",close:"Annullr",guidance:{measureline:"Ml en linje p kortet. Dobbeltklik for at stoppe mling.",measurearea:"Ml et omrde p kortet. Dobbeltklik for at stoppe mling."}}}});Oskari.registerLocalization({lang:"de",key:"Toolbar",value:{buttons:{link:{tooltip:"Link",ok:"Ok",title:"Link zur Kartenansicht"},print:{tooltip:"Drucken"},history:{reset:"Zurck zur Standardansicht",back:"Zurck",next:"Weiter"},pan:"Kartenauschnitt verschieben",zoom:"Hereinzoomen",measure:{line:"Entfernung messen",area:"Flche messen"}},measure:{title:"Messfunktionen",close:"Abbrechen",guidance:{measureline:"Messen Sie eine Linie auf der Karte. Doppelklicken, um die Messung zu beenden.",measurearea:"Messen Sie eine Flche auf der Karte. Doppelklicken, um die Messung zu beenden."}}}});Oskari.registerLocalization({lang:"en",key:"Toolbar",value:{buttons:{link:{tooltip:"Link",ok:"Ok",title:"Link to map view"},print:{tooltip:"Print"},history:{reset:"Return to default view",back:"Back",next:"Next"},pan:"Pan map view",zoom:"Zoom in",measure:{line:"Measure distance",area:"Measure area"}},measure:{title:"Measurements",close:"Cancel",guidance:{measureline:"Measure a line on the map. Double-click to stop measuring.",measurearea:"Measure an area on the map. Double-click to stop measuring."}}}});Oskari.registerLocalization({lang:"es",key:"Toolbar",value:{buttons:{link:{tooltip:"Enlace",ok:"Hecho",title:"Enlace a una vista"},print:{tooltip:"Imprimir"},history:{reset:"Volver a la vista inicial",back:"Atrs",next:"Siguiente"},pan:"Desplazar la vista",zoom:"Acercar",measure:{line:"Medir distancia",area:"Medir rea"}},measure:{title:"Mediciones",close:"Cancelar",guidance:{measureline:"Medir una lnea en el mapa. Doble click para finalizar la medicin.",measurearea:"Medir un rea en el mapa. Doble click para finalizar la medicin."}}}});Oskari.registerLocalization({lang:"et",key:"Toolbar",value:{buttons:{link:{tooltip:"Link",ok:"Ok",title:"Link kaardivaatesse"},print:{tooltip:"Prindi"},history:{reset:"Tagasiprdumine vaikevaatesse",back:"Tagasi",next:"Jrgmine"},pan:"Liigu kaardivaates",zoom:"Suumi sisse",measure:{line:"Mda vahemaa",area:"Mda pind"}},measure:{title:"Mtmised",close:"Thista",guidance:{measureline:"Mda joon kaardil. Topeltklps lpetab mtmise.",measurearea:"Mda pindala kaardil. Topeltkklps lpetab mtmise."}}}});Oskari.registerLocalization({lang:"fi",key:"Toolbar",value:{buttons:{link:{tooltip:"Linkki",ok:"Ok",title:"Linkki karttankymn"},print:{tooltip:"Tulosta"},history:{reset:"Paluu oletusnkymn",back:"Takaisin",next:"Eteenpin"},pan:"Liikuta karttaa",zoom:"Lhenn",measure:{line:"Mittaa etisyys",area:"Mittaa alue"}},measure:{title:"Mittaustulokset",close:"Lopeta",guidance:{measureline:"Osoita mitattava matka kartalta. Lopeta mittaaminen hiiren kaksoisnapautuksella.",measurearea:"Osoita mitattava alue kartalta. Lopeta mittaaminen hiiren kaksoisnapautuksella."}}}});Oskari.registerLocalization({lang:"hr",key:"Toolbar",value:{buttons:{link:{tooltip:"Poveznica",ok:"Ok",title:"Poveznica na prikaz karte"},print:{tooltip:"Ispis"},history:{reset:"Povratak na zadani prikaz",back:"Natrag",next:"Dalje"},pan:"Pomakni prikaz karte",zoom:"Uveaj",measure:{line:"Izmjeri udaljenost",area:"Izmjeri povrinu"}},measure:{title:"Mjerenja",close:"Poniti",guidance:{measureline:"Izmjeri liniju na karti. Dvostruki klik za prekid mjerenja.",measurearea:"Izmjeri povrinu na karti. Dvostruki klik za prekid mjerenja."}}}});Oskari.registerLocalization({lang:"hu",key:"Toolbar",value:{buttons:{link:{tooltip:"Link",ok:"Ok",title:"Trkpnzet link"},print:{tooltip:"Nyomtats"},history:{reset:"Vissza az alaprtelmezett nzethez",back:"Vissza",next:"Kvetkez"},pan:"Trkpnzet eltolsa",zoom:"Nagyts",measure:{line:"Tvolsgmrs",area:"Terletmrs"}},measure:{title:"Mrsek",close:"Mgsem",guidance:{measureline:"Vonal mrse a trkpen. Mrs befejezse dupla kattintssal.",measurearea:"Terlet mrse a trkpen. Mrs befejezse dupla kattintssal."}}}});Oskari.registerLocalization({lang:"lv",key:"Toolbar",value:{buttons:{link:{tooltip:"Saite",ok:"Labi",title:"Saite uz kartes skatu"},print:{tooltip:"Drukt"},history:{reset:"Atgriezties pie noklusjuma skata",back:"Atpaka",next:"Nkamais"},pan:"Bdt kartes skatu",zoom:"Tuvint",measure:{line:"Mrt attlumu",area:"Mrt laukumu"}},measure:{title:"Mrjumi",close:"Atcelt",guidance:{measureline:"Mrt lniju uz kartes. Dubultklikis, lai apturtu mranu.",measurearea:"Mrt laukumu uz kartes. Dubultklikis, lai apturtu mranu."}}}});Oskari.registerLocalization({lang:"nl",key:"Toolbar",value:{buttons:{link:{tooltip:"Link",ok:"Ok",title:"Link naar de kaartweergave"},print:{tooltip:"Print"},history:{reset:"Terug naar standaardweergave",back:"Terug ",next:"Verder"},pan:"Verschuif kaartweergave",zoom:"Vergroten",measure:{line:"Meet afstand",area:"Meet gebied"}},measure:{title:"Metingen",close:"Annuleren",guidance:{measureline:"Meet een lijn in de kaart. Dubbelklik om te stoppen met meten.",measurearea:"Meet een gebied in de kaart. Dubbelklik om te stoppen met meten."}}}});Oskari.registerLocalization({lang:"pl",key:"Toolbar",value:{buttons:{link:{tooltip:"Link",ok:"Ok",title:"Link do widoku mapy"},print:{tooltip:"Drukuj"},history:{reset:"Powrt do domylnego widoku",back:"Cofnij",next:"Nastpny"},pan:"NOT TRANSLATED",zoom:"Przybli",measure:{line:"Pomiar odlegoci",area:"Pomiar powierzchni"}},measure:{title:"Pomiary",close:"Anuluj",guidance:{measureline:"Zmierz lini na mapie. Podwjne kliknicie wstrzymuje pomiar.",measurearea:"Zmierz powierzchni mapy.Podwjne kliknicie wstrzymuje pomiar."}}}});Oskari.registerLocalization({lang:"pt",key:"Toolbar",value:{buttons:{link:{tooltip:"Ligao",ok:"Ok",title:"Ligao  vista da carta"},print:{tooltip:"Imprimir"},history:{reset:"Voltar  vista padro",back:"Voltar",next:"Seguinte"},pan:"Vista panormica",zoom:"Ampliar",measure:{line:"Medir distncia",area:"Medir rea"}},measure:{title:"Medies",close:"Cancelar",guidance:{measureline:"Medir uma linha na carta. Duplo-clique para parar",measurearea:"Medir uma rea na carta. Duplo-clique para parar"}}}});Oskari.registerLocalization({lang:"ro",key:"Toolbar",value:{buttons:{link:{tooltip:"Link",ok:"Ok",title:"Link ctre vizualizare hart"},print:{tooltip:"Imprimare"},history:{reset:"Revenire la vederea implicit",back:"napoi",next:"Urmtorul"},pan:"Deplasare hart",zoom:"Mrire",measure:{line:"Msurare distan",area:"Msurare suprafa"}},measure:{title:"Msurtori",close:"Anulare",guidance:{measureline:"Msurare linie pe hart. Dublu-click pentru a ncheia msurtoarea",measurearea:"Msurare suprafa pe hart. Dublu-click pentru a ncheia msurtoarea"}}}});Oskari.registerLocalization({lang:"rs",key:"Toolbar",value:{buttons:{link:{tooltip:"Link",ok:"Potvrdi",title:"Link ka prikazu mape"},print:{tooltip:"tampa"},history:{reset:"Povratak na poetni prikaz",back:"Nazad",next:"Sledei"},pan:"Pomeri prikaz na karti",zoom:"Uveaj prikaz",measure:{line:"Izmeri duinu",area:"Izmeri povrinu"}},measure:{title:"Merenja",close:"Odustani",guidance:{measureline:"Merenje linije na mapi. Dupli klik za kraj merenja.",measurearea:"Merenje povrine na mapi. Dupli klik za kraj merenja."}}}});Oskari.registerLocalization({lang:"sl",key:"Toolbar",value:{buttons:{link:{tooltip:"Povezava",ok:"V redu",title:"Povezava na pogled karte"},print:{tooltip:"Natisni"},history:{reset:"Vrnitev na privzet pogled",back:"Nazaj",next:"Naprej"},pan:"Premakni pogled karte",zoom:"Poveaj",measure:{line:"Izmeri razdaljo",area:"Izmeri povrino"}},measure:{title:"Meritve",close:"Preklii",guidance:{measureline:"Izmeri linijo na karti. Dvoklikni za konanje merjenja.",measurearea:"Izmeri povrino na karti. Dvoklikni za konanje merjenja."}}}});Oskari.registerLocalization({lang:"sk",key:"Toolbar",value:{buttons:{link:{tooltip:"Link",ok:"Ok",title:"Link k zobrazeniu mapy"},print:{tooltip:"Tla"},history:{reset:"Nvrat k predvolenmu zobrazeniu",back:"Sp",next:"alej"},pan:"Posunutie zobrazenia mapy",zoom:"Pribli",measure:{line:"Mera vzdialenosti",area:"Mera plochy"}},measure:{title:"Meranie",close:"Zrui",guidance:{measureline:"Mera lniu na mape. Dvojklik na skonenie merania.",measurearea:"Mera plochu na mape. Dvojklik na skonenie merania."}}}});Oskari.registerLocalization({lang:"sq",key:"Toolbar",value:{buttons:{link:{tooltip:"Linku",ok:"Ok (prano)",title:"Linku pr pamje t harts"},print:{tooltip:"Shtyp"},history:{reset:"Kthehu n shikimin automatik/t parazgjedhur",back:"Kthehu prapa",next:"Shko prpara"},pan:"Lviz pamjen n hart",zoom:"Zmadho",measure:{line:"Matje e distancs",area:"Matje e siprfaqes"}},measure:{title:"Matjet",close:"Anulo",guidance:{measureline:"Mat nj vij n hart. Kliko dy her pr ta ndalur matjen.",measurearea:"Mat nj siprfaqe n hart. Kliko dy her pr ta ndalur matjen."}}}});Oskari.registerLocalization({lang:"sv",key:"Toolbar",value:{buttons:{link:{tooltip:"Lnk",ok:"Ok",title:"Lnk till kartvyn"},print:{tooltip:"Skriv ut"},history:{reset:"Tillbaka till standardvyn",back:"Fregende",next:"Nsta"},pan:"Flytta kartan",zoom:"Zooma in",measure:{line:"Mt avstnd",area:"Mt areal"}},measure:{title:"Mtningsresultat",close:"Avbryt",guidance:{measureline:"Peka ut strckan som ska mtas p kartan. Sluta mtningen genom att dubbelklicka.",measurearea:"Peka ut omrdet som ska mtas p kartan. Sluta mtningen genom att dubbelklicka."}}}});Oskari.registerLocalization({lang:"uk",key:"Toolbar",value:{buttons:{link:{tooltip:"",ok:"",title:"   "},print:{tooltip:""},history:{reset:"   ",back:" ",next:" "},pan:"",zoom:"",measure:{line:" ",area:" "}},measure:{title:"",close:"",guidance:{measureline:"   .    .",measurearea:"   .    ."}}}});Oskari.clazz.define("Oskari.mapframework.bundle.layerselection2.LayerSelectionBundle",function(){},{create:function(){var me=this;return Oskari.clazz.create("Oskari.mapframework.bundle.layerselection2.LayerSelectionBundleInstance")},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/Flyout.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/Tile.js"},{type:"text/css",src:"../../../../resources/framework/bundle/layerselection2/css/style.css"}],locales:[{lang:"bg",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/bg.js"},{lang:"cs",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/cs.js"},{lang:"da",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/da.js"},{lang:"de",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/de.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/en.js"},{lang:"es",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/es.js"},{lang:"et",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/et.js"},{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/fi.js"},{lang:"ge",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/ge.js"},{lang:"gr",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/gr.js"},{lang:"hr",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/hr.js"},{lang:"hu",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/hu.js"},{lang:"lv",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/lv.js"},{lang:"es",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/es.js"},{lang:"nl",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/nl.js"},{lang:"pl",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/pl.js"},{lang:"pt",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/pt.js"},{lang:"ro",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/ro.js"},{lang:"rs",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/rs.js"},{lang:"sl",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/sl.js"},{lang:"sk",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/sk.js"},{lang:"sq",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/sq.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/sv.js"},{lang:"uk",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/uk.js"}]},bundle:{manifest:{"Bundle-Identifier":"layerselection2","Bundle-Name":"layerselection2","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","jquery"],"Import-Bundle":{}}},dependencies:["jquery"]});Oskari.bundle_manager.installBundleClass("layerselection2","Oskari.mapframework.bundle.layerselection2.LayerSelectionBundle");Oskari.clazz.define("Oskari.mapframework.bundle.layerselection2.LayerSelectionBundleInstance",function(){this.sandbox=null;this.started=!1;this.plugins={};this.localization=null},{__name:"LayerSelection",getName:function(){return this.__name},setSandbox:function(sandbox){this.sandbox=sandbox},getSandbox:function(){return this.sandbox},getLocalization:function(key){return(this._localization||(this._localization=Oskari.getLocalization(this.getName())),key)?this._localization[key]:this._localization},start:function(){var me=this,request;if(!me.started){me.started=!0;var conf=this.conf,sandboxName=(conf?conf.sandbox:null)||"sandbox",sandbox=Oskari.getSandbox(sandboxName),p;me.sandbox=sandbox;this.localization=Oskari.getLocalization(this.getName());sandbox.register(me);for(p in me.eventHandlers)me.eventHandlers.hasOwnProperty(p)&&sandbox.registerForEventByName(me,p);request=sandbox.getRequestBuilder("userinterface.AddExtensionRequest")(this);sandbox.request(this,request);me.createUi()}},init:function(){return null},update:function(){},onEvent:function(event){var handler=this.eventHandlers[event.getName()];if(handler)return handler.apply(this,[event])},eventHandlers:{AfterMapLayerRemoveEvent:function(event){this.plugins["Oskari.userinterface.Tile"].refresh();this.plugins["Oskari.userinterface.Flyout"].handleLayerSelectionChanged(event.getMapLayer(),!1)},AfterMapLayerAddEvent:function(event){this.plugins["Oskari.userinterface.Tile"].refresh();this.plugins["Oskari.userinterface.Flyout"].handleLayerSelectionChanged(event.getMapLayer(),!0,event.getKeepLayersOrder())},MapLayerEvent:function(event){var mapLayerService=this.sandbox.getService("Oskari.mapframework.service.MapLayerService"),layerId=event.getLayerId(),layer;event.getOperation()==="update"?(layer=mapLayerService.findMapLayer(layerId),this.plugins["Oskari.userinterface.Flyout"].handleLayerModified(layer)):event.getOperation()==="sticky"&&(layer=mapLayerService.findMapLayer(layerId),this.plugins["Oskari.userinterface.Flyout"].handleLayerSticky(layer))},MapLayerVisibilityChangedEvent:function(event){this.plugins["Oskari.userinterface.Flyout"].handleLayerVisibilityChanged(event.getMapLayer(),event.isInScale(),event.isGeometryMatch())},AfterChangeMapLayerOpacityEvent:function(event){event._creator!==this.getName()&&this.plugins["Oskari.userinterface.Flyout"].handleLayerOpacityChanged(event.getMapLayer())},AfterChangeMapLayerStyleEvent:function(event){event._creator!==this.getName()&&this.plugins["Oskari.userinterface.Flyout"].handleLayerStyleChanged(event.getMapLayer())},AfterRearrangeSelectedMapLayerEvent:function(event){event._creator!==this.getName()&&(this.plugins["Oskari.userinterface.Tile"].refresh(),this.plugins["Oskari.userinterface.Flyout"].handleLayerOrderChanged(event._movedMapLayer,event._fromPosition,event._toPosition))},"userinterface.ExtensionUpdatedEvent":function(event){var me=this,doOpen;event.getExtension().getName()===me.getName()&&(doOpen=event.getViewState()!=="close")}},stop:function(){var sandbox=this.sandbox,p,request;for(p in this.eventHandlers)this.eventHandlers.hasOwnProperty(p)&&sandbox.unregisterFromEventByName(this,p);request=sandbox.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);sandbox.request(this,request);this.sandbox.unregister(this);this.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.layerselection2.Flyout",this);this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.mapframework.bundle.layerselection2.Tile",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null;this.plugins["Oskari.userinterface.Tile"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){var me=this;this.plugins["Oskari.userinterface.Flyout"].createUi();this.plugins["Oskari.userinterface.Tile"].refresh()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]});Oskari.clazz.define("Oskari.mapframework.bundle.layerselection2.Flyout",function(instance){this.instance=instance;this.container=null;this.state=null;this.template=null;this.templateLayer=null;this.templateLayerTools=null;this.templateLayerOutOfScale=null;this.templateLayerOutOfContentArea=null;this.sortableBinded=!1;this._sliders={}},{getName:function(){return"Oskari.mapframework.bundle.layerselection2.Flyout"},setEl:function(el){this.container=el[0];jQuery(this.container).hasClass("layerselection2")||jQuery(this.container).addClass("layerselection2")},startPlugin:function(){var loc=this.instance.getLocalization("layer");this.template=jQuery('<ul class="selectedLayersList sortable" data-sortable=\'{itemCss: "li.layer.selected", handleCss: "div.layer-title" }\'><\/ul>');this.templateLayer=jQuery('<li class="layerselection2 layer selected"><div class="layer-info"><div class="layer-icon"><\/div><div class="layer-tool-remove"><\/div><div class="layer-title"><h4><\/h4><\/div><\/div><div class="stylesel"><label for="style">'+loc.style+'<\/label><select name="style"><\/select><\/div><div class="layer-tools volatile"><\/div><\/li>');this.templateLayerFooterTools=jQuery('<div class="right-tools"><div class="layer-rights"><\/div><div class="object-data"><\/div><div class="layer-description"><div class="icon-info"><\/div><\/div><\/div><div class="left-tools"><div class="layer-visibility"><a href="JavaScript:void(0);">'+loc.hide+'<\/a>&nbsp;<span class="temphidden" style="display: none;">'+loc.hidden+'<\/span><\/div><div class="oskariui layer-opacity"><div class="layout-slider" id="layout-slider"><\/div> <div class="opacity-slider" style="display:inline-block"><input type="text" name="opacity-slider" class="opacity-slider opacity" id="opacity-slider" />%<\/div><\/div><\/div>');this.templateLayerFooterHidden=jQuery('<p class="layer-msg"><a href="JavaScript:void(0);">'+loc.show+"<\/a> "+loc.hidden+"<\/p>");this.templateLayerFooterOutOfScale=jQuery('<p class="layer-msg">'+loc["out-of-scale"]+' <a href="JavaScript:void(0);">'+loc["move-to-scale"]+"<\/a><\/p>");this.templateLayerFooterOutOfContentArea=jQuery('<p class="layer-msg">'+loc["out-of-content-area"]+' <a href="JavaScript:void(0);">'+loc["move-to-content-area"]+"<\/a><\/p>")},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(state){this.state=state},createUi:function(){var me=this,celOriginal=jQuery(this.container),listContainer;celOriginal.empty();listContainer=this.template.clone();celOriginal.append(listContainer);for(var sandbox=me.instance.getSandbox(),layers=sandbox.findAllSelectedMapLayers(),scale=sandbox.getMap().getScale(),layer,layerContainer,n=layers.length-1;n>=0;--n)layer=layers[n],layerContainer=this._createLayerContainer(layer),listContainer.append(layerContainer),this._appendLayerFooter(layerContainer,layer,layer.isInScale(scale),!0);listContainer.sortable({stop:function(event,ui){var item=ui.item;me._layerOrderChanged(item)}});this.sortableBinded||(this.sortableBinded=!0)},_appendLayerFooter:function(layerDiv,layer,isInScale,isGeometryMatch){var toolsDiv=layerDiv.find("div.layer-tools"),footer=this._createLayerFooter(layer,layerDiv),oosFtr,oocaFtr,opa,slider;layer.isVisible()?isInScale?isGeometryMatch?footer.css("display",""):(oocaFtr=this._createLayerFooterOutOfContentArea(layer),toolsDiv.addClass("out-of-content"),footer.css("display","none"),toolsDiv.append(oocaFtr)):(oosFtr=this._createLayerFooterOutOfScale(layer),toolsDiv.addClass("out-of-scale"),footer.css("display","none"),toolsDiv.append(oosFtr)):(toolsDiv.addClass("hidden-layer"),footer.css("display","none"),toolsDiv.append(this._createLayerFooterHidden(layer)));toolsDiv.append(footer);opa=layerDiv.find("div.layer-opacity input.opacity");slider=this._addSlider(layer,layerDiv,opa)},_addSlider:function(layer,layerDiv,input){var me=this,lyrId=layer.getId(),opa=layer.getOpacity(),sliderEl=layerDiv.find(".layout-slider"),slider=sliderEl.slider({min:0,max:100,value:opa,slide:function(event,ui){me._layerOpacityChanged(layer,ui.value)},stop:function(event,ui){me._layerOpacityChanged(layer,ui.value)}});if(me._sliders[lyrId]=slider,input){input.attr("value",layer.getOpacity());input.on("change paste keyup",function(){me._layerOpacityChanged(layer,jQuery(this).val())})}return slider},_layerOrderChanged:function(item){var allNodes=jQuery(this.container).find(".selectedLayersList li.layerselection2"),movedId=item.attr("layer_id"),newIndex=-1;if(allNodes.each(function(index){return $(this).attr("layer_id")==movedId?(newIndex=index,!1):!0}),newIndex>-1){newIndex=allNodes.length-1-newIndex;var sandbox=this.instance.getSandbox(),builder=sandbox.getRequestBuilder("RearrangeSelectedMapLayerRequest"),request=builder(movedId,newIndex);sandbox.request(this.instance.getName(),request)}},_updateStyles:function(layer,layerDiv){var me=this,sandbox=me.instance.getSandbox(),stylesel=layerDiv.find("div.stylesel");if(stylesel.hide(),layer.getStyles&&layer.getStyles().length>1){var hasOpts=!1,styles=layer.getStyles(),sel=stylesel.find("select"),i,opt;for(sel.empty(),i=0;i<styles.length;i++)opt=jQuery('<option value="'+styles[i].getName()+'">'+styles[i].getTitle()+"<\/option>"),sel.append(opt),hasOpts=!0;sel.hasClass("binded")||(sel.change(function(){var val=sel.find("option:selected").val(),builder,req;layer.selectStyle(val);builder=sandbox.getRequestBuilder("ChangeMapLayerStyleRequest");req=builder(layer.getId(),val);sandbox.request(me.instance.getName(),req)}),sel.addClass("binded"));hasOpts&&(layer.getCurrentStyle()&&sel.val(layer.getCurrentStyle().getName()),sel.trigger("change"),stylesel.show())}},_createLayerContainer:function(layer){var me=this,sandbox=me.instance.getSandbox(),opacityRequestBuilder=sandbox.getRequestBuilder("ChangeMapLayerOpacityRequest"),layerId=layer.getId(),value=layer.getOpacity(),layerDiv=this.templateLayer.clone(),tooltips,icon;return layerDiv.attr("layer_id",layerId),layerDiv.find("div.layer-title h4").append(layer.getName()),layerDiv.find("div.layer-title").append(layer.getDescription()),this._updateStyles(layer,layerDiv),tooltips=this.instance.getLocalization("layer").tooltip,icon=layerDiv.find("div.layer-icon"),icon.addClass(layer.getIconClassname()),layer.isBaseLayer()?icon.attr("title",tooltips["type-base"]):layer.isLayerOfType("WMS")?icon.attr("title",tooltips["type-wms"]):layer.isLayerOfType("WMTS")?icon.attr("title",tooltips["type-wms"]):layer.isLayerOfType("WFS")?icon.attr("title",tooltips["type-wfs"]):layer.isLayerOfType("VECTOR")&&icon.attr("title",tooltips["type-wms"]),layer.isSticky()||(layerDiv.find("div.layer-tool-remove").addClass("icon-close"),layerDiv.find("div.layer-tool-remove").bind("click",function(){var builder=sandbox.getRequestBuilder("RemoveMapLayerRequest"),request=builder(layer.getId());sandbox.request(me.instance.getName(),request)})),layerDiv},handleLayerOrderChanged:function(layer,fromPosition,toPosition){if(!layer)throw"handleLayerOrderChanged: No layer provided";if(isNaN(fromPosition))throw"handleLayerOrderChanged: fromPosition is Not a Number: "+fromPosition;if(isNaN(toPosition))throw"handleLayerOrderChanged: toPosition is Not a Number: "+toPosition;if(fromPosition!==toPosition){var me=this,layerContainer=jQuery(me.container).find("ul.selectedLayersList"),layerCount=layerContainer.find("> li").length,fromIndex=layerCount-fromPosition,toIndex=layerCount-toPosition,el=layerContainer.find("> li:nth-child("+fromIndex+")").detach();toIndex===1?layerContainer.prepend(el):toIndex===layerCount?layerContainer.append(el):layerContainer.find("> li:nth-child("+toIndex+")").before(el)}},handleLayerVisibilityChanged:function(layer,isInScale,isGeometryMatch){var me=this,sandbox=me.instance.getSandbox(),lyrSel="li.layerselection2.layer.selected[layer_id="+layer.getId()+"]",layerDiv=jQuery(this.container).find(lyrSel),loc=this.instance.getLocalization("layer"),footer=layerDiv.find("div.layer-tools");footer.empty();layerDiv.removeClass("hidden-layer");layerDiv.removeClass("out-of-scale");layerDiv.removeClass("out-of-content");this._sliders[layer.getId()]=null;this._appendLayerFooter(layerDiv,layer,isInScale,isGeometryMatch)},_layerOpacityChanged:function(layer,newOpacity){var sandbox=this.instance.getSandbox(),requestBuilder=sandbox.getRequestBuilder("ChangeMapLayerOpacityRequest"),request=requestBuilder(layer.getId(),newOpacity);sandbox.request(this.instance.getName(),request);this._changeOpacityInput(layer)},_changeOpacityInput:function(layer){var lyrSel="li.layerselection2.layer.selected[layer_id="+layer.getId()+"]",layerDiv=jQuery(this.container).find(lyrSel),opa=layerDiv.find("div.layer-opacity input.opacity"),slider=layerDiv.find(".layout-slider");opa.attr("value",layer.getOpacity());slider.slider("value",layer.getOpacity())},handleLayerOpacityChanged:function(layer){this._sliders[layer.getId()]&&(this._sliders[layer.getId()].slider("value",layer.getOpacity()),this._changeOpacityInput(layer))},handleLayerStyleChanged:function(layer){var lyrSel="li.layer.selected[layer_id="+layer.getId()+"]",layerDiv=jQuery(this.container).find(lyrSel),styleDropdown=layerDiv.find("div.stylesel select");styleDropdown.val(layer.getCurrentStyle().getName())},_createLayerFooterOutOfScale:function(layer){var me=this,sandbox=me.instance.getSandbox(),msg=this.templateLayerFooterOutOfScale.clone(),reqName,requestBuilder;return msg.addClass("layer-msg-for-outofscale"),reqName="MapModulePlugin.MapMoveByLayerContentRequest",requestBuilder=sandbox.getRequestBuilder(reqName),msg.find("a").bind("click",function(){var request=requestBuilder(layer.getId());return sandbox.request(me.instance.getName(),request),!1}),msg},_createLayerFooterHidden:function(layer){var me=this,sandbox=me.instance.getSandbox(),msg=this.templateLayerFooterHidden.clone(),reqName,visibilityRequestBuilder;return msg.addClass("layer-msg-for-hidden"),reqName="MapModulePlugin.MapLayerVisibilityRequest",visibilityRequestBuilder=sandbox.getRequestBuilder(reqName),msg.find("a").bind("click",function(){var request=visibilityRequestBuilder(layer.getId(),!0);return sandbox.request(me.instance.getName(),request),!1}),msg},_createLayerFooterOutOfContentArea:function(layer){var me=this,sandbox=me.instance.getSandbox(),msg=this.templateLayerFooterOutOfContentArea.clone(),reqName,requestBuilder;return msg.addClass("layer-msg-for-outofcontentarea"),reqName="MapModulePlugin.MapMoveByLayerContentRequest",requestBuilder=sandbox.getRequestBuilder(reqName),msg.find("a").bind("click",function(){var request=requestBuilder(layer.getId());return sandbox.request(me.instance.getName(),request),!1}),msg},_createLayerFooter:function(layer){var me=this,sandbox=me.instance.getSandbox(),tools=this.templateLayerFooterTools.clone(),loc=this.instance.getLocalization("layer"),visibilityRequestBuilder=sandbox.getRequestBuilder("MapModulePlugin.MapLayerVisibilityRequest"),closureMagic,laytools,s,laytool,toolContainer;if(layer.isSticky()&&tools.find("div.layer-visibility").hide(),tools.find("div.layer-visibility a").bind("click",function(){var request=visibilityRequestBuilder(layer.getId(),!1);return sandbox.request(me.instance.getName(),request),!1}),subLmeta=!1,!layer.getMetadataIdentifier()){if(subLayers=layer.getSubLayers(),subLayers&&subLayers.length>0)for(subLmeta=!0,s=0;s<subLayers.length;s+=1)if(subUuid=subLayers[s].getMetadataIdentifier(),!subUuid||subUuid===""){subLmeta=!1;break}subLmeta||tools.find("div.layer-description").hide()}for((layer.getMetadataIdentifier()||subLmeta)&&tools.find("div.icon-info").bind("click",function(){var uuid=layer.getMetadataIdentifier(),additionalUuids=[],additionalUuidsCheck={},subLayers,s,subUuid;if(additionalUuidsCheck[uuid]=!0,subLayers=layer.getSubLayers(),subLayers&&subLayers.length>0)for(s=0;s<subLayers.length;s++)subUuid=subLayers[s].getMetadataIdentifier(),subUuid&&subUuid!==""&&!additionalUuidsCheck[subUuid]&&(additionalUuidsCheck[subUuid]=!0,additionalUuids.push({uuid:subUuid}));sandbox.postRequestByName("catalogue.ShowMetadataRequest",[{uuid:uuid},additionalUuids])}),closureMagic=function(tool){return function(){return tool.getCallback()(),!1}},laytools=layer.getTools(),s=0;s<laytools.length;s++)laytool=laytools[s],laytool&&(laytool.getIconCls()?(toolContainer=jQuery("<div><\/div>"),toolContainer.addClass(laytool.getIconCls()),toolContainer.attr("title",laytool.getTooltip()),tools.find("div.object-data").append(toolContainer),toolContainer.bind("click",closureMagic(laytool))):(toolContainer=jQuery('<a href="JavaScript:void(0);"><\/a>'),toolContainer.append(laytool.getTitle()),tools.find("div.object-data").append(toolContainer),toolContainer.bind("click",closureMagic(laytool))));return this._updatePublishPermissionText(layer,tools),tools},_updatePublishPermissionText:function(layer,footer){var sandbox=this.instance.getSandbox(),loc=this.instance.getLocalization("layer"),publishPermission=layer.getPermission("publish");publishPermission=="publication_permission_ok"&&sandbox.getUser().isLoggedIn()&&(footer.find("div.layer-rights").html(loc.rights.can_be_published_map_user.label),footer.find("div.layer-rights").attr("title",loc.rights.can_be_published_map_user.tooltip))},handleLayerSelectionChanged:function(layer,isSelected,keepLayersOrder){var layerDiv;if(isSelected){var me=this,sandbox=me.instance.getSandbox(),scale=sandbox.getMap().getScale(),listContainer=jQuery("ul.selectedLayersList"),layerContainer=this._createLayerContainer(layer),footer=layerContainer.find("div.layer-tools"),previousLayers=[];previousLayers=layer.isBaseLayer()&&!keepLayersOrder?listContainer.find("li.layerselection2[layer_id^=base_]"):listContainer.find(".layerselection2.layer.selected");previousLayers.length>0?layer.isBaseLayer()&&!keepLayersOrder?previousLayers.last().after(layerContainer):previousLayers.first().before(layerContainer):listContainer.append(layerContainer);this._appendLayerFooter(layerContainer,layer,layer.isInScale(scale),!0)}else layerDiv=jQuery(this.container).find("li.layerselection2[layer_id="+layer.getId()+"]"),layerDiv&&(this._sliders[layer.getId()]=null,layerDiv.remove())},handleLayerModified:function(layer){var me=this,layerDiv=jQuery(me.container).find("li.layerselection2[layer_id="+layer.getId()+"]"),scale=this.instance.getSandbox().getMap().getScale();newDiv=this._createLayerContainer(layer);layerDiv.replaceWith(newDiv);this._appendLayerFooter(newDiv,layer,layer.isInScale(scale),!0)},handleLayerSticky:function(layer){var me=this,layerDiv=jQuery(me.container).find("li.layerselection2[layer_id="+layer.getId()+"]");layerDiv.find("div.layer-tool-remove").removeClass("icon-close")},refresh:function(){for(var me=this,sandbox=me.instance.getSandbox(),layers=sandbox.findAllSelectedMapLayers(),layer,n=layers.length-1;n>=0;--n)layer=layers[n],this.handleLayerOpacityChanged(layer)}},{protocol:["Oskari.userinterface.Flyout"]});Oskari.clazz.define("Oskari.mapframework.bundle.layerselection2.Tile",function(instance){this.instance=instance;this.container=null;this.template=null;this.shownLayerCount=null},{getName:function(){return"Oskari.mapframework.bundle.layerselection2.Tile"},setEl:function(el){this.container=jQuery(el)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(){},notifyUser:function(){var me=this,status=this.container.children(".oskari-tile-status");status.stop();this._blink(status,2)},_blink:function(element,count){var me=this;element&&(count||(count=1),element.animate({opacity:.25},500,function(){element.animate({opacity:1},500,function(){count>1&&me._blink(element,--count)})}))},refresh:function(){var me=this,instance=me.instance,cel=this.container,tpl=this.template,sandbox=instance.getSandbox(),layers=sandbox.findAllSelectedMapLayers(),layerCount=layers.length,status=this.container.children(".oskari-tile-status");status.addClass("icon-bubble-right");status.html(layerCount);this.notifyUser()}},{protocol:["Oskari.userinterface.Tile"]});Oskari.registerLocalization({lang:"bg",key:"LayerSelection",value:{title:" ",desc:"",layer:{style:"",show:"",hide:"",hidden:"   ","out-of-scale":"           ","move-to-scale":"  ","out-of-content-area":"       ","move-to-content-area":"     ",description:"","object-data":"  ",rights:{notavailable:" ",guest:",     ",loggedin:" ",official:"     ","need-login":"  ",can_be_published_by_provider:{label:"   ,  ",tooltip:"    ,  ,      .    -   ,               "},can_be_published:{label:" ",tooltip:"               "},can_be_published_map_user:{label:" ",tooltip:"                   "},no_publication_permission:{label:" ",tooltip:" -                 "},can_be_published_by_authority:{label:" ",tooltip:"             "}},tooltip:{"type-base":" - ","type-wms":" ","type-wfs":" "}}}});Oskari.registerLocalization({lang:"cs",key:"LayerSelection",value:{title:"Vybran vrstvy",desc:"",layer:{style:"Styl",show:"Zobrazit",hide:"Skrt",hidden:"Mapa byla doasn skryta.","out-of-scale":"Data tto mapov vrstvy nemohou bt zobrazena ve zvolen rovni mtka.","move-to-scale":"Pibli do vhodn rovn mtka.","out-of-content-area":"V tto lokalit neobsahuje mapov vrstva dn data.","move-to-content-area":"Pesu do stedu plochy rozsahu.",description:"Popis","object-data":"Objektov data",rights:{notavailable:"Publikace zakzna",guest:"Pro publikaci tto mapov vrstvy se pihlaste.",loggedin:"Publikace povolena",official:"Publikace povolena pro pouit ady.","need-login":"Muste se pihlsit.",can_be_published_by_provider:{label:"Publikace povolena pro poskytovatele dat.",tooltip:"Pro publikaci tto mapov vrstvy potebujete prva poskytovatel dat. Pokud jste poskytovatel dat, kontaktujte prosm podporu a poadujte prva pro publikaci."},can_be_published:{label:"Publikace povolena",tooltip:"Mapov vrstva me bt publikovna ve vloenm mapovm okn bez omezen potu uivatel."},can_be_published_map_user:{label:"Publikace povolena",tooltip:"Mapov vrstva me bt publikovna ve vloenm mapovm okn a poet uivatel za tden me bt omezen."},no_publication_permission:{label:"Publikace zakzna",tooltip:"Poskytovatel dat nepovolil publikaci tto mapov vrstvy ve vloenm mapovm okn."},can_be_published_by_authority:{label:"Publikace povolena",tooltip:"Mapov vrstva me bt publikovna ve vloenm mapovm okn bez omezen."}},tooltip:{"type-base":"Mapa pozad","type-wms":"Mapov vrstva","type-wfs":"Datov produkt"}}}});Oskari.registerLocalization({lang:"da",key:"LayerSelection",value:{title:"Valgte lag",desc:"",layer:{style:"Stil",show:"Vis",hide:"Skjul",hidden:"Kortet er blevet skjult midlertidigt","out-of-scale":"Data i dette kortlag kan ikke vises i det valgte zoomniveau","move-to-scale":"G til et passende zoomniveau","out-of-content-area":"Kortlaget indeholder ingen data p denne lokation","move-to-content-area":"Flyt til centret i omrdet med indhold",description:"Beskrivelse","object-data":"Objektdata",rights:{notavailable:"Publicring ikke tilladt",guest:"Log ind for at publicre dette kortlag",loggedin:"Publicring tilladt",official:"Publicring tilladt til myndighedsbrug","need-login":"Du skal logge ind",can_be_published_by_provider:{label:"Publicring tilladt for dataansvarlige",tooltip:"Du skal vre dataansvarlig for at publicre dette kortlag. Hvis du er dataansvarlig, kontakt venligst support og bed om rettigheder til at publicre"},can_be_published:{label:"Publicring tilladt",tooltip:"Kortlaget kan publicres i et indlejret kortvindue uden at begrnse antallet af brugere"},can_be_published_map_user:{label:"Publicring tilladt",tooltip:"Kortlaget kan publicres i et indlejret kortvindue og antal brugere per uge kan begrnses"},no_publication_permission:{label:"Publicring ikke tilladt",tooltip:"Den dataansvarlige har ikke givet tilladelse til at publicre dette kortlag i et indlejret kortvindue"},can_be_published_by_authority:{label:"Publicring tilladt",tooltip:"Kortlaget kan publicres i et indlejret kortvindue uden begrnsninger p brug"}},tooltip:{"type-base":"Baggrundskort","type-wms":"Kortlag","type-wfs":"Dataprodukt"}}}});Oskari.registerLocalization({lang:"de",key:"LayerSelection",value:{title:"Ausgewhlte Ebenen",desc:"",layer:{style:"Ansicht",show:"Zeige",hide:"Verberge",hidden:"Diese Karte wurde vorbergehend ausgeblendet.","out-of-scale":"Die Daten der Kartenebenen knnen in diesem Mastab nicht angezeigt werden.","move-to-scale":"Zu einem geeigneten Mastab wechseln.","out-of-content-area":"Die Kartenebene enthlt an dieser Position keine Daten.","move-to-content-area":"Direkt zum Mittelpunkt der Daten begeben.",description:"Beschreibung","object-data":"Objektdaten",rights:{notavailable:"Verffentlichung untersagt.",guest:"Melden Sie sich an, um diese Kartenebene zu verffentlichen.",loggedin:"Verffentlichung erlaubt",official:"Verffentlichung fr die Nutzung durch Behrden zulssig.","need-login":"Sie mssen sich anmelden.",can_be_published_by_provider:{label:"Verffentlichung erlaubt fr Datenanbieter.",tooltip:"Es werden Datenanbieter-Rechte bentigt, um diese Kartenebene zu verffentlichen. Sollten Sie ein Datenanbieter sein, kontaktieren Sie bitte den Support-Service und fordern Sie die Verffentlichungsrechte an."},can_be_published:{label:"Verffentlichung erlaubt",tooltip:"Die Kartenebene darf ohne eine Begrenzung der Nutzeranzahl in einem eingebundenen Kartenfenster verffentlicht werden."},can_be_published_map_user:{label:"Verffentlichung erlaubt",tooltip:"Die Kartenebene darf mit einer eventuellen Begrenzung der Nutzeranzahl pro Woche in einem eingebundenen Kartenfenster verffentlicht werden."},no_publication_permission:{label:"Verffentlichung untersagt",tooltip:"Der Datenanbieter hat keine Genehmigung zur Verffentlichung der Kartenebene in einem eingebundenen Kartenfenster gegeben."},can_be_published_by_authority:{label:"Verffentlichung erlaubt",tooltip:"Die Kartenebene darf in einem eingebundenen Kartenfenster ohne Nutzungsbeschrnkungen verffentlicht werden."}},tooltip:{"type-base":"Hintergrundkarte","type-wms":"Kartenebene","type-wfs":"Datenprodukt"}}}});Oskari.registerLocalization({lang:"en",key:"LayerSelection",value:{title:"Selected layers",desc:"",layer:{style:"Style",show:"Show",hide:"Hide",hidden:"The map has been temporarily hidden.","out-of-scale":"Data in this map layer cannot be shown at the selected scale level.","move-to-scale":"Go to a suitable scale level.","out-of-content-area":"The map layer contains no data at this location.","move-to-content-area":"Locate",description:"Description","object-data":"Object data",rights:{notavailable:"Publication prohibited.",guest:"Log in to publish this map layer.",loggedin:"Publication permitted",official:"Publication permitted for use by authorities.","need-login":"You must log in.",can_be_published_by_provider:{label:"Publication permitted for data providers.",tooltip:"Data provider rights are required to publish this map layer. If you are a data provider, please contact the support service of Paikkatietoikkuna and request rights to publish."},can_be_published:{label:"Publication permitted",tooltip:"The map layer can be published in an embedded map window without limiting the number of users."},can_be_published_map_user:{label:"Publication permitted",tooltip:"The map layer can be published in an embedded map window and the number of users per week may be limited."},no_publication_permission:{label:"Publication prohibited.",tooltip:"The data provider has not granted permission to publish this map layer in an embedded map window."},can_be_published_by_authority:{label:"Publication permitted",tooltip:"The map layer can be published in an embedded map window without usage limits."}},tooltip:{"type-base":"Background map","type-wms":"Map layer","type-wfs":"Data product"}}}});Oskari.registerLocalization({lang:"es",key:"LayerSelection",value:{title:"Capas seleccionadas",desc:"",layer:{style:"Estilo",show:"Mostrar",hide:"Ocultar",hidden:"Se ha ocultado el mapa temporalmente","out-of-scale":"No pueden mostrarse los datos de esta capa a la escala seleccionada","move-to-scale":"Ir a un nivel de escala adecuado","out-of-content-area":"La capa no contiene datos para esta localizacin","move-to-content-area":"Moverse al centro del rea del contenido",description:"Descripcin","object-data":"Datos del objeto",rights:{notavailable:"Publicacin no permitida",guest:"Identificarse para publicar esta capa",loggedin:"Publicacin permitida",official:"Publicacin permitida para el uso mediante autorizacin","need-login":"Debe identificarse",can_be_published_by_provider:{label:"Publicacin permitida para proveedores de datos",tooltip:"Se requieren derechos de proveedor de datos para publicar esta capa. Si es un proveedor de datos, por favor, contacte con el servicio de soporte y solicite los derechos para publicar"},can_be_published:{label:"Publicacin permitida",tooltip:"La capa puede publicarse en un visualizador incorporado sin lmite en el nmero de usuarios"},can_be_published_map_user:{label:"Publicacin permitida",tooltip:"La capa puede publicarse en un visualizador incorporado y el nmero de usuarios semanales puede limitarse"},no_publication_permission:{label:"Publicacin no permitida",tooltip:"El proveedor de datos no ha concedido el permiso para publicar esta capa en un visualizador incorporado"},can_be_published_by_authority:{label:"Publicacin permitida",tooltip:"La capa puede publicarse en un visualizador incrustado sin limitaciones de uso"}},tooltip:{"type-base":"Mapa de fondo","type-wms":"Capa","type-wfs":"Producto"}}}});Oskari.registerLocalization({lang:"et",key:"LayerSelection",value:{title:"Valitud kihid",desc:"",layer:{style:"Stiil",show:"Nita",hide:"Peida",hidden:"Kaart on ajutiselt peidetud.","out-of-scale":"Selle kaardilehe andmeid ei saa valitud mtkavas nidata.","move-to-scale":"Liigu sobivasse mtkavasse.","out-of-content-area":"Kaardikiht ei sisalda antud asukohas andmeid.","move-to-content-area":"Liigu sisuala keskpunkti.",description:"Kirjeldus","object-data":"Objekti andmed",rights:{notavailable:"Avaldamine keelatud.",guest:"Selle kaardikihi avaldamiseks logige sisse.",loggedin:"Avaldamine lubatud.",official:"Avaldamine lubatud ametkondlikuks kasutuseks.","need-login":"Peate sisse logima.",can_be_published_by_provider:{label:"Avaldamine lubatud andmete tarnijale.",tooltip:"Selle kaardikihi avaldamiseks on vaja andmete tarnija nusolekut. Kui olete andmete tarnija, siis prduge toe pakkuja poole ja ksige avaldamise nusolekut."},can_be_published:{label:"Avaldamine lubatud.",tooltip:"Kaardikihti vib avaldada pimitud kaardiaknas ilma kasutajate arvu piiramata."},can_be_published_map_user:{label:"Avaldamine lubatud.",tooltip:"Kaardikihti vib avaldada pimitud kaardiaknas ja kasutajate arvu ndalas vib piirata."},no_publication_permission:{label:"Avaldamine keelatud.",tooltip:"Andmete tarnija ei ole andnud igust seda kaardikihti pimitud kaardiaknas avaldada."},can_be_published_by_authority:{label:"Avaldamine lubatud.",tooltip:"Kaardikihti vib kasutuspiiranguteta avaldada pimitud kaardiaknas."}},tooltip:{"type-base":"Aluskaart","type-wms":"Kaardikiht","type-wfs":"Andmetoode"}}}});Oskari.registerLocalization({lang:"fi",key:"LayerSelection",value:{title:"Karttatasot",desc:"",layer:{style:"Tyyli",show:"Nyt",hide:"Piilota",hidden:"Karttataso on tilapisesti piilotettu.","out-of-scale":"Tmn karttatason aineistoa ei voida nytt valitulla mittakaavatasolla.","move-to-scale":"Siirry sopivalle mittakaavatasolle","out-of-content-area":"Tll karttatasolla ei ole aineistoa tss sijainnissa","move-to-content-area":"Paikanna",description:"Kuvaus","object-data":"Kohdetiedot",rights:{notavailable:"Ei julkaistavissa",guest:"Kirjaudu sisn julkaistaksesi karttatason",loggedin:"Julkaistavissa",official:"Viranomaiskyttn julkaistavissa","need-login":"Vaatii kirjautumisen",can_be_published_by_provider:{label:"Tiedontuottajana julkaistavissa",tooltip:"Karttatason julkaisemiseen tarvitaan tiedontuottajan oikeudet. Mikli olet tiedontuottaja, ota yhteytt Paikkatietoikkunan tukipalveluun ja pyyd julkaisuoikeuksia."},can_be_published:{label:"Julkaistavissa",tooltip:"Karttatason voi julkaista upotetussa karttaikkunassa ilman kyttmrrajoitusta."},can_be_published_map_user:{label:"Julkaistavissa",tooltip:"Karttatason voi julkaista upotetussa karttaikkunassa. Viikoittainen kyttmr voi olla rajoitettu."},no_publication_permission:{label:"Ei julkaistavissa",tooltip:"Karttatason julkaisemiseen upotetussa karttaikkunassa ei ole tiedontuottajan lupaa."},can_be_published_by_authority:{label:"Julkaistavissa",tooltip:"Karttatason voi julkaista upotetussa karttaikkunassa ilman kyttmrrajoitusta."}},tooltip:{"type-base":"Taustakartta","type-wms":"Karttataso","type-wfs":"Tietotuote"}}}});Oskari.registerLocalization({lang:"ge",key:"LayerSelection",value:{title:" ",desc:"",layer:{style:"",show:"",hide:"",hidden:"  ","out-of-scale":"    ","move-to-scale":"  ","out-of-content-area":"    ","move-to-content-area":"  ",description:"","object-data":" ",rights:{notavailable:" ",guest:"  ",loggedin:" ",official:"   ","need-login":" ",can_be_published_by_provider:{label:"   ",tooltip:"     ,    , ,      "},can_be_published:{label:" ",tooltip:"          "},can_be_published_map_user:{label:" ",tooltip:"           "},no_publication_permission:{label:" ",tooltip:"         "},can_be_published_by_authority:{label:" ",tooltip:"         "}},tooltip:{"type-base":" ","type-wms":" ","type-wfs":" "}}}});Oskari.registerLocalization({lang:"gr",key:"LayerSelection",value:{title:" ",desc:"",layer:{style:"",show:"",hide:"",hidden:"    .","out-of-scale":"           .","move-to-scale":"    .","out-of-content-area":"         .","move-to-content-area":"     .",description:"","object-data":" ",rights:{notavailable:"  .",guest:"     .",loggedin:"  ",official:"      .","need-login":"  .",can_be_published_by_provider:{label:"      ..",tooltip:"              .    ,           ."},can_be_published:{label:"  ",tooltip:"             ."},can_be_published_map_user:{label:"  ",tooltip:"               ."},no_publication_permission:{label:"  ",tooltip:"              ."},can_be_published_by_authority:{label:"  ",tooltip:"            ."}},tooltip:{"type-base":"","type-wms":" ","type-wfs":""}}}});Oskari.registerLocalization({lang:"hr",key:"LayerSelection",value:{title:"Odabrani slojevi",desc:"",layer:{style:"Stil",show:"Prikai",hide:"Sakrij",hidden:"Karta je privremeno sakrivena.","out-of-scale":"Podaci u ovom sloju karte ne mogu se prikazati u odabranom mjerilu.","move-to-scale":"Idi na odgovarajue mjerilo.","out-of-content-area":"Sloj karte ne sadri podatke za ovu lokaciju.","move-to-content-area":"Pomakni u sredite povrine sa sadrajem.",description:"Opis","object-data":"Podaci o objektu",rights:{notavailable:"Zabranjeno objavljivanje.",guest:"Prijavi se za objavu ovog sloja karte.",loggedin:"Doputeno objavljivanje",official:"Objavljivanje doputeno za koritenje slubenih tijela.","need-login":"Obavezna prijava.",can_be_published_by_provider:{label:"Objavljivanje doputeno za pruatelje podataka.",tooltip:"Za objavljivanje ovog sloja karte potrebna je imati prava pruatelja podataka. Ako ste pruatelj podataka, kontaktirajte slubu za podrku i zatraite pravo za objavljivanje."},can_be_published:{label:"Doputeno objavljivanje",tooltip:"Sloj karte mogue je objaviti u prozoru s umetnutom kartom bez ogranienja broja korisnika."},can_be_published_map_user:{label:"Doputeno objavljivanje",tooltip:"Sloj karte mogue je objaviti u prozoru s ugraenom kartom i mogue je ograniiti tjedni broj korisnika."},no_publication_permission:{label:"Zabranjeno objavljivanje",tooltip:"Pruatelj podataka nije dopustio objavljivanje ovog sloja karte u prozoru s umetnutom kartom."},can_be_published_by_authority:{label:"Doputeno objavljivanje",tooltip:"Sloj karte mogue je objaviti u prozoru s umetnutom kartom bez ogranienja koritenja."}},tooltip:{"type-base":"Karta pozadine","type-wms":"Sloj karte","type-wfs":"Podatkovni proizvod"}}}});Oskari.registerLocalization({lang:"hu",key:"LayerSelection",value:{title:"Kivlasztott rtegek",desc:"",layer:{style:"Stlus",show:"Megjelents",hide:"Elrejts",hidden:"A trkp ideiglenesen rejtve.","out-of-scale":"Ezen a trkprtegen az adatot nem lehet megjelenteni a kivlasztott mretarnyban.","move-to-scale":"Vlasszon egy megfelel mretarnyt.","out-of-content-area":"A trkprteg nem tartalmaz adatot ezen a helyen.","move-to-content-area":"Menjen a terlet kzepre.",description:"Lers","object-data":"Objektum adatok",rights:{notavailable:"Kzzttele tilos.",guest:"A trkprteg kzzttelhez jelentkezzen be.",loggedin:"Kzzttele engedlyezett.",official:"Kzzttele hatsgi hasznlatra engedlyezett.","need-login":"Be kell jelentkeznie",can_be_published_by_provider:{label:"Kzztetele az adatszolgltatknak engedlyezett.",tooltip:"A kzzttelhez adatszolgltati jogok szksgesek. Amennyiben n adatszolgltat a kzztteli jogokrt krem lpjen kapcsolatba az gyflszolglattal."},can_be_published:{label:"Kzzttele engedlyezett.",tooltip:"A trkprteg kzztehet egy begyazott trkpablakban a felhasznlk szmnak korltozsa nlkl."},can_be_published_map_user:{label:"Kzzttele engedlyezett.",tooltip:"A trkprteg kzztehet egy begyazott trkpablakban, a heti felhasznlk szma korltozott lehet."},no_publication_permission:{label:"Kzzttele engedlyezett.",tooltip:"Ennek a trkprtegnek egy begyazott trkpablakban val kzzttelre az adatszolgltat nem adott engedlyt."},can_be_published_by_authority:{label:"Kzzttele engedlyezett.",tooltip:"A trkprteg kzztehet egy begyazott trkpablakban felhasznlsi korltozs nlkl."}},tooltip:{"type-base":"Httr trkp","type-wms":"Trkprteg","type-wfs":"Adattermk"}}}});Oskari.registerLocalization({lang:"lv",key:"LayerSelection",value:{title:"Izvltie sli",desc:"",layer:{style:"Stils",show:"Rdt",hide:"Paslpt",hidden:"Karte pagaidm ir paslpta","out-of-scale":"Datus aj kartes sln nevar pardt izvltaj mrog","move-to-scale":"Prejiet uz piemrotu mrogu","out-of-content-area":"Kartes slnis aj atraans viet nesatur datus","move-to-content-area":"Prvietoties uz vietas, kur ir redzams saturs, centru",description:"Apraksts","object-data":"Objekta dati",rights:{notavailable:"Publicana ir aizliegta",guest:"Ldzam pieteikties, lai publictu o kartes slni",loggedin:"Publicana ir atauta",official:"Publicana ir atauta pilnvarotm iestdm","need-login":"Jums ir jpiesaks",can_be_published_by_provider:{label:"Publicana ir atauta datu sniedzjiem",tooltip:"Ir nepiecieamas datu sniedzja tiesbas, lai publictu kartes slni. Ja Js esat datu sniedzjs, sazinieties ar atbalsta dienestu un pieprasiet publicanas tiesbas"},can_be_published:{label:"Publicana atauta",tooltip:"Kartes slni drkst publict iegult kartes log neierobeojot lietotju skaitu"},can_be_published_map_user:{label:"Publicana atauta",tooltip:"Kartes slni drkst publict iegult kartes log ierobeojot lietotju skaitu vienas nedas laik"},no_publication_permission:{label:"Publicana aizliegta",tooltip:"Datu sniedzjs nav devis atauju publict o kartes slni iegults kartes log"},can_be_published_by_authority:{label:"Publicana atauta",tooltip:"Kartes slni var publict iegults kartes log bez ierobeojumiem"}},tooltip:{"type-base":"Fona karte","type-wms":"Kartes slnis","type-wfs":"Datu produkts"}}}});Oskari.registerLocalization({lang:"nl",key:"LayerSelection",value:{title:"Geselecteerde laag",desc:"",layer:{style:"Stijl",show:"Toon",hide:"Verberg",hidden:"De kaart is tijdelijk verborgen.","out-of-scale":"Gegevens op deze kaartlaag kunnen niet op het geselecteerde schaalniveau worden getoond.","move-to-scale":"Ga naar een geschikt schaalniveau.","out-of-content-area":"De kaartlaag bevat geen gegevens op deze locatie.","move-to-content-area":"Verplaats naar het midden van het gebied.",description:"Beschrijving","object-data":"Objectgegevens",rights:{notavailable:"Publicatie niet toegestaan.",guest:"Log in om deze kaartlaag te publiceren.",loggedin:"Publicatie toegestaan",official:"Publicatie is toegestaan voor gebruik door overheden.","need-login":"U moet inloggen.",can_be_published_by_provider:{label:"Publicatie is toegestaan voor gegevensverstrekkers.",tooltip:"De rechten van de gegevensverstrekker zijn vereist om deze kaartlaag te publiceren. Als u een gegevensverstrekker bent, neem dan contact op met de klantenservice met het verzoek om publicatierechten te verkrijgen."},can_be_published:{label:"Publicatie toegestaan",tooltip:"De kaartlaag kan in een gentegreerd kaartvenster weergegeven worden zonder beperking van het aantal gebruikers."},can_be_published_map_user:{label:"Publicatie toegestaan",tooltip:"De kaartlaag kan in een gentegreerd kaartvenster worden weergegeven en het aantal gebruikers per week kan worden beperkt."},no_publication_permission:{label:"Publicatie niet toegestaan.",tooltip:"De gegevensvertrekker heeft geen toestemming verleend om deze kaartlaag in een gentergreerd kaartvenster weer te geven."},can_be_published_by_authority:{label:"Publicatie toegestaan",tooltip:"De kaartlaag kan in een gentegreerd kaartvenster weergegeven worden zonder gebruikslimieten."}},tooltip:{"type-base":"Achtergrondkaart","type-wms":"Kaartlaag","type-wfs":"Productgegevens"}}}});Oskari.registerLocalization({lang:"pl",key:"LayerSelection",value:{title:"Wybrane warstwy",desc:"",layer:{style:"Styl",show:"Poka",hide:"Ukryj",hidden:"Mapa zostaa czasowo uktyra.","out-of-scale":"Dane na tej warstwie mapy nie mog zosta wywietlone w wybranej skali.","move-to-scale":"Przejd do odpowiedniego poziomu skali.","out-of-content-area":"Warstwa nie zawiera adnych danych dla tej lokalizacji.","move-to-content-area":"Przesu na rodek obszaru.",description:"Opis","object-data":"Dane obiektu",rights:{notavailable:"Publikacja niedozwolona.",guest:"Zaloguj si w celu opublikowania tej warstwy mapy.",loggedin:"Publikacja dozwolona",official:"Publikacja dozwolona na potrzeby wadz.","need-login":"Musisz si zalogowa.",can_be_published_by_provider:{label:"Publikacja dozwolona na potrzeby dostawcw danych",tooltip:"Do publikacji tej warstwy wymagane s uprawnienia dostawcy danych. Jeeli jeste dostawc danych, skontaktuj si z dziaem wsparcia w celu uzyskania uprawnie do publikacji."},can_be_published:{label:"Publikacja dozwolona",tooltip:"Warstwa mapy moe zosta opublikowana jako wbudowane okno bez ogranicze liczby uytkownikw."},can_be_published_map_user:{label:"Publikacja dozwolona",tooltip:"Warstwa mapy moe zosta opublikowana jako wbudowane okno a ilo uytkownikw na tydzie moe by ograniczona."},no_publication_permission:{label:"Publikacja dozwolona",tooltip:"Dostawca danych nie zezwoli na publikacj tej warstwy mapy jako wbudowanego okna."},can_be_published_by_authority:{label:"Publikacja dozwolona",tooltip:"Warstwa mapy moe zosta opublikowana jako wbudowane okno bez ogranicze wykorzystania."}},tooltip:{"type-base":"Mapa rdowa","type-wms":"Warstwa mapy","type-wfs":"Produkt"}}}});Oskari.registerLocalization({lang:"pt",key:"LayerSelection",value:{title:"Camadas selecionadas",desc:"",layer:{style:"Estilo",show:"Mostrar",hide:"Esconder",hidden:"A carta est temporariamente invisvel","out-of-scale":"Dados desta camada no podem ser visualizados na escala selecionada","move-to-scale":"Escolha uma escala adequada","out-of-content-area":"A camada no tem dados nesta localizao","move-to-content-area":"Mover para o centro da rea",description:"Descrio","object-data":"Objeto",rights:{notavailable:"Publicao interdita",guest:"Ligue-se para publicar esta camada",loggedin:"Publicao permitida",official:"Publicao permitida para uso de entidades oficiais","need-login":"Deve ligar-se",can_be_published_by_provider:{label:"Publicao permitida para fornecedores",tooltip:" obrigatrio possuir direitos de fornecedor para publicao desta camada. Se  fornecedor por favor contate o servio de suporte e requisite direitos de publicao"},can_be_published:{label:"Publicao permitida",tooltip:"A camada pode ser publicada numa vista embutida sem limite de nmero de utilizadores"},can_be_published_map_user:{label:"Publicao permitida",tooltip:"A camada pode ser publicada numa vista embutida e o nmero de utilizadores por semana pode ser limitado"},no_publication_permission:{label:"Publicao interdita",tooltip:"O fornecedor no tem autorizao para publicar esta camada numa vista embutida"},can_be_published_by_authority:{label:"Publicao permitida",tooltip:"A camada pode ser publicada numa vista embutida sem limites de utilizao"}},tooltip:{"type-base":"Carta de fundo","type-wms":"Camada","type-wfs":"Produto"}}}});Oskari.registerLocalization({lang:"ro",key:"LayerSelection",value:{title:"Straturi Selectate",desc:"",layer:{style:"Stil",show:"Afiare",hide:"Ascundere",hidden:"Harta a fost temporar ascuns","out-of-scale":"Datele din acest strat nu pot fi afiate la scara selectat","move-to-scale":"Alegere scar potrivit","out-of-content-area":"Stratul de hart nu conine date la aceast locaie","move-to-content-area":"Mutare n centrul zonei de coninut",description:"Descriere","object-data":"Date obiect",rights:{notavailable:"Publicare interzis",guest:"Autentificare pentru publicarea acestui strat",loggedin:"Publicare permis",official:"Publicare permis pentru uzul autoritilor","need-login":"Trebuie s v autentificai",can_be_published_by_provider:{label:"Publicare permis pentru furnizorii de date",tooltip:"Sunt necesare drepturile furnizorului de date pentru a publica acest strat.Dac suntei furnizor de date v rugm contactai serviciul suport i solicitai drepturi de publicare"},can_be_published:{label:"Publicare permis",tooltip:"Stratul poate fi publicat ntr-o hart nglobat fr a limita numrul de utilizatori"},can_be_published_map_user:{label:"Publicare permis",tooltip:"Stratul poate fi publicat ntr-o hart nglobat iar numrul de utilizatori pe sptmn poate fi limitat"},no_publication_permission:{label:"Publicare nepermis",tooltip:"Furnizorul de date nu a acordat permisiunea de publicare a acestui strat ntr-o hart nglobat"},can_be_published_by_authority:{label:"Publicare permis",tooltip:"Stratul poate fi publicat ntr-o hart nglobat fr limitarea folosirii"}},tooltip:{"type-base":"Hart suport","type-wms":"Strat de hart","type-wfs":"Produs de hart"}}}});Oskari.registerLocalization({lang:"rs",key:"LayerSelection",value:{title:"Izabrani slojevi",desc:"",layer:{style:"Stil",show:"Prikai",hide:"Sakrij",hidden:"Mapa je privremeno skrivena","out-of-scale":"Podaci ovog sloja mape ne mogu biti prikazani u izabranoj razmeri","move-to-scale":"Izaberite odgovarajuu razmeru","out-of-content-area":"Sloj ne sadri podatke na ovoj lokaciji","move-to-content-area":"Pomeri prikaz na centar prostora sa podacima",description:"Opis","object-data":"Prikazani podaci",rights:{notavailable:"Zabranjeno publikovanje",guest:"Prijavite se da bi publikovali ovaj sloj",loggedin:"Dozvoljeno publikovanje",official:"Dozvoljeno publikovanje za autorizovanu upotrebu","need-login":"Morate se prijaviti",can_be_published_by_provider:{label:"Dozvoljeno publikovanje za provajdera podataka",tooltip:"Za publikovanje ove mape potrebna su prava provajdera podataka. Ako ste provajder, kontaktirajte podrku za dobijanje prava."},can_be_published:{label:"Dozvoljeno publikovanje",tooltip:"Sloj moe biti publlikovan u ugraenoj mapi, bez ogranienja broja korisnika"},can_be_published_map_user:{label:"Dozvoljeno publikovanje",tooltip:"Sloj moe biti publlikovan u ugraenoj mapi, sa ogranienim brojem korisnika sedmino"},no_publication_permission:{label:"Zabranjeno publikovanje",tooltip:"Provajder podataka ne dozvoljava publikovanje sloja u ugraenoj mapi"},can_be_published_by_authority:{label:"Dozvoljeno publikovanje",tooltip:"Sloj moe biti publlikovan u ugraenoj mapi, bez ogranienja u korienju"}},tooltip:{"type-base":"Osnovna mapa","type-wms":"Sloj","type-wfs":"Podaci sa atributima"}}}});Oskari.registerLocalization({lang:"sl",key:"LayerSelection",value:{title:"Izbrani sloji",desc:"",layer:{style:"Stil",show:"Prikai",hide:"Skrij",hidden:"Karta je zaasno skrita","out-of-scale":"V tem izbranem merilu podatki na sloju karte ne morejo biti prikazani.","move-to-scale":"Izberi primerno merilo","out-of-content-area":"Sloj karte na tej lokaciji ne vsebuje nobenih podatkov.","move-to-content-area":"Premakni se na sredino izbranega obmoja",description:"Opis","object-data":"Object data",rights:{notavailable:"Objava prepovedana",guest:"Za objavo sloja karte se mora prijaviti",loggedin:"Objava dovoljena",official:"Objava dovoljena za uporabo s strani odgovorne osebe","need-login":"Prijavi se",can_be_published_by_provider:{label:"Objava dovoljena za ponudnike podatkov",tooltip:"Za objavo sloja karte so potrebne pravice ponudnika podatkov. e ste ponudnik podatkov, se prosimo obrnite na slubo za podporo in zahtevajte pravice za objavo."},can_be_published:{label:"Objava dovoljena",tooltip:"Sloj karte je lahko objavljen v vstavljenem kartnem oknu brez omejitve tevila uporabnikov"},can_be_published_map_user:{label:"Objava dovoljena",tooltip:"Sloj karte je lahko objavljen v vstavljenem kartnem oknu in tevilo uporabnikov na teden je lahko omejeno"},no_publication_permission:{label:"Objava prepovedana",tooltip:"Ponudnik podatkov ne dovoljuje objavo sloja karte v vstavljenem kartnem oknu"},can_be_published_by_authority:{label:"Objava dovoljena",tooltip:"Sloj karte je lahko objavljen v vstavljenem kartnem oknu brez omejitev uporabe"}},tooltip:{"type-base":"Karta za ozadje","type-wms":"Sloj karte","type-wfs":"Podatki o izdelku"}}}});Oskari.registerLocalization({lang:"sk",key:"LayerSelection",value:{title:"Vybran vrstvy",desc:"",layer:{style:"tl",show:"Zobrazi",hide:"Skry",hidden:"Mapa je doasne skryt","out-of-scale":"Vo vybranej rovni mierky nie je mon zobrazi daje z tejto mapovej vrstvy","move-to-scale":"Prejdi na vhodn rove mierky","out-of-content-area":"Na danom mieste mapov vrstva neobsahuje iadne daje","move-to-content-area":"Presun do stredu oblasti danho obsahu",description:"Popis","object-data":"daje o objekte",rights:{notavailable:"Zkaz zverejnenia",guest:"Prihlsi sa, aby sa dala mapov vrstva zverejneni",loggedin:"Povolenie zverejnenia",official:"Zverejnenie povolen na radn vyuitie","need-login":"Muste sa prihlsi",can_be_published_by_provider:{label:"Zverejnenie povolen pre poskytovateov dajov",tooltip:"K zverejneniu danej mapovej vrstvy s potrebn prva poskytovateov dajov. Ak ste poskytovateom dajov, kontaktujte, prosm, zkazncke centrum a vyiadajte si prva na uverejnenie"},can_be_published:{label:"Povolenie zverejnenia",tooltip:"Mapov vrstva sa moe zverejni vo vloenom mapovom okne bez obmedzenia potu pouvateov"},can_be_published_map_user:{label:"Povolenie zverejnenia",tooltip:"Mapov vrstva sa moe zverejni vo vloenom mapovom okne a poet pouvateov za tde me by obmedzen"},no_publication_permission:{label:"Zkaz zverejnenia",tooltip:"Poskytovate dajov nepovolil zverejnenie tejto mapovej vrstvy vo vloenom mapovom okne"},can_be_published_by_authority:{label:"Povolenie zverejnenia",tooltip:"Mapov vrstva sa moe zverejni vo vloenom mapovom okne bez obmedzenia"}},tooltip:{"type-base":"Podkladov mapa","type-wms":"Mapov vrstva","type-wfs":"daje o produkte"}}}});Oskari.registerLocalization({lang:"sq",key:"LayerSelection",value:{title:"Shtresat e zgjedhura",desc:"",layer:{style:"Stili",show:"Paraqit",hide:"Fsheh",hidden:"Harta sht fshehur prkohsisht","out-of-scale":"T dhnat n kt shtres t harts nuk mund t paraqiten n nivelin/shkalln e zgjedhur","move-to-scale":"Shko n nj nivel/shkall t prshtatshme","out-of-content-area":"Shtresa e harts nuk prmban asnj t dhn n kt lokacion","move-to-content-area":"Shko n qendr t siprfaqes s prmbajtjes",description:"Prshkrim","object-data":"T dhnat e objektit",rights:{notavailable:"Publikimi i ndaluar",guest:"Kyu pr t publikuar kt shtres t harts",loggedin:"Publikimi i lejuar",official:"Publikimi i lejuar pr prdorim nga autoritetet","need-login":"Ju duhet t kyeni gjithsesi",can_be_published_by_provider:{label:"Publikimi i lejuar pr ofruesit e t dhnave",tooltip:"Krkohen t drejtat e ofruesit t t dhnave pr ta publikuar kt shtres t harts. Nse ju jeni ofrues i t dhnave, ju lutem kontaktojeni shrbimin mbshtets dhe krkoni t drejtat pr publikim"},can_be_published:{label:"Publikimi i lejuar",tooltip:"Shtresa e harts mund t publikohet n nj dritare t harts s futur pa e limituar numrin e prdoruesve"},can_be_published_map_user:{label:"Publikimi i lejuar",tooltip:"Shtresa e harts mund t publikohet n nj dritare t harts s futur dhe numri i prdoruesve mund t limitohet pr jav"},no_publication_permission:{label:"Publikimi i ndaluar",tooltip:"Ofruesi i t dhnave nuk e ka fituar t drejtn e publikimit t ksaj shtrese t harts n nj dritare t harts s futur"},can_be_published_by_authority:{label:"Publikimi i lejuar",tooltip:"Shtresa e harts mund t publikohet n nj dritare t harts s futur pa limit t prdorimit"}},tooltip:{"type-base":"Harta n sfond","type-wms":"Shtresa e harts","type-wfs":"Produkti i t dhnave"}}}});Oskari.registerLocalization({lang:"sv",key:"LayerSelection",value:{title:"Kartlager",desc:"",layer:{style:"Stil",show:"Visa",hide:"Gm",hidden:"Kartan r tillflligt gmd.","out-of-scale":"Data som ingr i detta kartlager kan inte visas p den valda skalnivn.","move-to-scale":"G till en lmplig skalniv.","out-of-content-area":"Detta kartlager saknar innehll vid dessa koordinater.","move-to-content-area":"Lokalisera",description:"Beskrivning","object-data":"Objektuppgifter",rights:{notavailable:"Fr inte publiceras.",guest:"Logga in fr att avskilja och inbdda detta kartlager.",loggedin:"Fr publiceras",official:"Fr publiceras fr myndighetsbruk.","need-login":"Du mste logga in.",can_be_published_by_provider:{label:"Fr publiceras av dataproducenter",tooltip:"Fr att publicera detta kartlager krvs dataproducentrttigheter. Om du r dataproducent, kontakta Paikkatietoikkunas stdtjnst och be om publiceringsrttigheter."},can_be_published:{label:"Fr publiceras",tooltip:"Kartlagret fr publiceras i ett inbddat kartfnster utan att begrnsa antalet anvndare."},can_be_published_map_user:{label:"Fr publiceras",tooltip:"Kartlagret fr publiceras i ett inbddat kartfnster. Antalet anvndare per vecka kan vara begrnsat."},no_publication_permission:{label:"Fr inte publiceras.",tooltip:"Dataproducenten har inte beviljat tillstnd att publicera kartlagret i ett inbddat kartfnster."},can_be_published_by_authority:{label:"Fr publiceras",tooltip:"Kartlagret fr publiceras i ett inbddat kartfnster utan anvndningsbegrnsningar."}},tooltip:{"type-base":"Bakgrundskarta","type-wms":"Kartlager","type-wfs":"Dataprodukt"}}}});Oskari.registerLocalization({lang:"uk",key:"LayerSelection",value:{title:" ",desc:"",layer:{style:"",show:"",hide:"",hidden:"  ","out-of-scale":"         ","move-to-scale":"   ","out-of-content-area":"      ","move-to-content-area":"    ",description:"","object-data":" '",rights:{notavailable:" ",guest:"       ",loggedin:" ",official:"     ","need-login":"    ",can_be_published_by_provider:{label:"    ",tooltip:"        .    ,  , '        "},can_be_published:{label:" ",tooltip:"            "},can_be_published_map_user:{label:" ",tooltip:"        ,        "},no_publication_permission:{label:" ",tooltip:"             "},can_be_published_by_authority:{label:" ",tooltip:"          - "}},tooltip:{"type-base":" ","type-wms":" ","type-wfs":""}}}});Oskari.clazz.define("Oskari.mapframework.bundle.infobox.InfoBoxBundle",function(){},{create:function(){var me=this;return Oskari.clazz.create("Oskari.mapframework.bundle.infobox.InfoBoxBundleInstance")},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/infobox/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/infobox/plugin/openlayerspopup/OpenlayersPopupPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/infobox/request/ShowInfoBoxRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/infobox/request/ShowInfoBoxRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/infobox/request/HideInfoBoxRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/infobox/request/HideInfoBoxRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/infobox/request/RefreshInfoBoxRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/infobox/request/RefreshInfoBoxRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/infobox/event/InfoBoxEvent.js"},{type:"text/css",src:"../../../../resources/framework/bundle/infobox/css/infobox.css"}]},bundle:{manifest:{"Bundle-Identifier":"infobox","Bundle-Name":"infobox","Bundle-Author":[{Name:"ev",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}},dependencies:["jquery"]});Oskari.bundle_manager.installBundleClass("infobox","Oskari.mapframework.bundle.infobox.InfoBoxBundle");Oskari.clazz.define("Oskari.mapframework.bundle.infobox.InfoBoxBundleInstance",function(){this.sandbox=null;this.started=!1;this.mediator=null},{__name:"Infobox",getName:function(){return this.__name},setSandbox:function(sbx){this.sandbox=sbx},getSandbox:function(){return this.sandbox},update:function(){},start:function(){var me=this,sandbox,p,mapModule;if(!me.started){me.started=!0;sandbox=Oskari.$("sandbox");sandbox.register(me);me.setSandbox(sandbox);for(p in me.eventHandlers)p&&sandbox.registerForEventByName(me,p);mapModule=sandbox.findRegisteredModuleInstance("MainMapModule");mapModule.registerPlugin(this.popupPlugin);mapModule.startPlugin(this.popupPlugin);sandbox.addRequestHandler("InfoBox.ShowInfoBoxRequest",this.requestHandlers.showInfoHandler);sandbox.addRequestHandler("InfoBox.HideInfoBoxRequest",this.requestHandlers.hideInfoHandler);sandbox.addRequestHandler("InfoBox.RefreshInfoBoxRequest",this.requestHandlers.refreshInfoHandler)}},init:function(){var me=this,adaptable=this.conf&&this.conf.adaptable===!0;return this.popupPlugin=Oskari.clazz.create("Oskari.mapframework.bundle.infobox.plugin.mapmodule.OpenlayersPopupPlugin"),this.popupPlugin.setAdaptable(adaptable),this.requestHandlers={showInfoHandler:Oskari.clazz.create("Oskari.mapframework.bundle.infobox.request.ShowInfoBoxRequestHandler",this.popupPlugin),hideInfoHandler:Oskari.clazz.create("Oskari.mapframework.bundle.infobox.request.HideInfoBoxRequestHandler",this.popupPlugin),refreshInfoHandler:Oskari.clazz.create("Oskari.mapframework.bundle.infobox.request.RefreshInfoBoxRequestHandler",this.popupPlugin)},null},onEvent:function(event){var me=this,handler=me.eventHandlers[event.getName()];if(handler)return handler.apply(this,[event])},eventHandlers:{MapClickedEvent:function(){}},stop:function(){var me=this,sandbox=this.sandbox;for(var p in me.eventHandlers)p&&sandbox.unregisterFromEventByName(me,p);me.sandbox.unregister(me);me.started=!1},setState:function(state){var i,data;if(state&&state.popups)for(this.popupPlugin.close(),i=0;i<state.popups.length;++i)data=state.popups[i],this.popupPlugin.popup(data.id,data.title,data.data,data.lonlat)},getState:function(){var state={popups:[]},popups=this.popupPlugin.getPopups(),id,popup,data;for(id in popups)popup=popups[id],data={id:id,title:popup.title,data:popup.contentData,lonlat:popup.lonlat},state.popups.push(data);return state}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module"]});jQuery.fn.outerHTML=function(arg){var ret;return this.length?arg?(jQuery.each(this,function(i,el){var fnRet,pass=el,inOrOut=el.outerHTML?"outerHTML":"innerHTML";el.outerHTML||(el=jQuery(el).wrap("<div>").parent()[0]);jQuery.isFunction(arg)?(fnRet=arg.call(pass,i,el[inOrOut]))!==!1&&(el[inOrOut]=fnRet):el[inOrOut]=arg;el.outerHTML||jQuery(el).children().unwrap()}),this):this[0].outerHTML||(ret=this.wrap("<div>").parent().html(),this.unwrap(),ret):val===undefined||val===null?this:null};Oskari.clazz.define("Oskari.mapframework.bundle.infobox.plugin.mapmodule.OpenlayersPopupPlugin",function(){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null;this._popups={}},{__name:"OpenLayersPopupPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(mapModule){this.mapModule=mapModule;this._map=mapModule.getMap();this.pluginName=mapModule.getName()+this.__name},init:function(){var me=this;me._arrow=jQuery('<div class="popupHeaderArrow"><\/div>');me._header=jQuery("<div><\/div>");me._headerWrapper=jQuery('<div class="popupHeader"><\/div>');me._headerCloseButton=jQuery('<div class="olPopupCloseBox icon-close-white" style="position: absolute; top: 12px;"><\/div>');me._contentDiv=jQuery('<div class="popupContent"><\/div>');me._contentWrapper=jQuery('<div class="contentWrapper"><\/div>');me._actionLink=jQuery('<span class="infoboxActionLinks"><a href="#"><\/a><\/span>');me._actionButton=jQuery('<span class="infoboxActionLinks"><input type="button" /><\/span>');me._contentSeparator=jQuery('<div class="infoboxLine">separator<\/div>')},popup:function(id,title,contentData,lonlat,colourScheme,font){if(!_.isEmpty(contentData)){var me=this,currPopup=this._popups[id],refresh=currPopup&&currPopup.lonlat.lon===lonlat.lon&&currPopup.lonlat.lat===lonlat.lat;refresh&&(contentData=this._getChangedContentData(currPopup.contentData.slice(),contentData.slice()),currPopup.contentData=contentData);this._renderPopup(id,contentData,title,lonlat,colourScheme,font,refresh)}},_renderPopup:function(id,contentData,title,lonlat,colourScheme,font,refresh){var contentDiv=this._renderContentData(contentData),popupContent=this._renderPopupContent(title,contentDiv),popup,popupDOM,inputs;refresh?(popup=this._popups[id].popup,popup.setContentHTML(popupContent)):(popup=new OpenLayers.Popup(id,lonlat,new OpenLayers.Size(400,300),popupContent,!1),this._popups[id]={title:title,contentData:contentData,lonlat:lonlat,popup:popup,colourScheme:colourScheme,font:font},popup.moveTo=function(px){if(px!==null&&px!==undefined&&this.div!==null&&this.div!==undefined){this.div.style.left=px.x+"px";var topy=px.y-20;this.div.style.top=topy+"px"}},this.getMapModule().getMap().addPopup(popup));this.adaptable&&this._adaptPopupSize(id,refresh);this._panMapToShowPopup(lonlat);this._setClickEvent(id,popup,contentData);popup.setBackgroundColor("transparent");jQuery(popup.div).css("overflow","visible");jQuery(popup.groupDiv).css("overflow","visible");popupDOM=jQuery("#"+id);colourScheme&&this._changeColourScheme(colourScheme,popupDOM,id);font&&this._changeFont(font,popupDOM,id);inputs=popupDOM.find(".contentWrapper input, .contentWrapper textarea");typeof inputs.placeholder=="function"&&inputs.placeholder()},_renderPopupContent:function(title,contentDiv){var arrow=this._arrow.clone(),header=this._header.clone(),headerWrapper=this._headerWrapper.clone(),closeButton=this._headerCloseButton.clone();return header.append(title),headerWrapper.append(header),headerWrapper.append(closeButton),arrow.outerHTML()+headerWrapper.outerHTML()+contentDiv.outerHTML()},_renderContentData:function(contentData){var me=this;return _.foldl(contentData,function(contentDiv,datum,index){var useButtons=datum.useButtons===!0,primaryButton=datum.primaryButton,contentWrapper=me._contentWrapper.clone(),key,actionLink,btn,link;contentWrapper.append(datum.html);for(key in datum.actions)useButtons?(actionLink=me._actionButton.clone(),btn=actionLink.find("input"),btn.attr({contentdata:index,value:key}),key==primaryButton&&btn.addClass("primary")):(actionLink=me._actionLink.clone(),link=actionLink.find("a"),link.attr("contentdata",index),link.append(key)),contentWrapper.append(actionLink);return contentDiv.append(contentWrapper),contentDiv},me._contentDiv.clone())},_setClickEvent:function(id,popup,contentData){var me=this;popup.events.un({click:popup.onclick,scope:popup});popup.events.on({click:function(evt){var link=jQuery(evt.target||evt.srcElement),i,text;link.hasClass("olPopupCloseBox")?me.close(id):(i=link.attr("contentdata"),text=link.attr("value"),text||(text=link.html()),contentData[i]&&contentData[i].actions&&contentData[i].actions[text]&&contentData[i].actions[text]())},scope:popup})},_getChangedContentData:function(oldData,newData){for(var j,nLen,i=0,oLen=oldData.length;i<oLen;++i)for(j=0,nLen=newData.length;j<nLen;++j)if(newData[j].layerId&&newData[j].layerId===oldData[i].layerId){oldData[i]=newData[j];newData.splice(j,1);break}return oldData.concat(newData)},removeContentData:function(popupId,contentId){var popup=this.getPopups(popupId),removed=!1,contentData,datum,i;if(popup){for(contentData=popup.contentData,i=0,cLen=contentData.length;i<cLen;++i)if(datum=contentData[i],datum.layerId&&""+datum.layerId==""+contentId){contentData.splice(i,1);removed=!0;break}removed&&(contentData.length===0?this.close(popupId):this._renderPopup(popupId,contentData,popup.title,popup.lonlat,popup.colourScheme,popup.font,!0))}},setAdaptable:function(isAdaptable){this.adaptable=isAdaptable},_adaptPopupSize:function(olPopupId,isOld){var viewport=jQuery(this.getMapModule().getMapViewPortDiv()),popup=jQuery("#"+olPopupId),left=parseFloat(popup.css("left")),wrapper,height;isOld||(left=left+10);popup.find(".popupHeaderArrow").css({"margin-left":"-10px"});var header=popup.find(".popupHeader").css("width","100%"),maxWidth=viewport.width()*.7,maxHeight=viewport.height()*.7,content=popup.find(".popupContent").css({"margin-left":"0",padding:"5px 20px 5px 20px","max-height":maxHeight-40+"px"});popup.find(".olPopupContent").css({width:"100%",height:"100%"});wrapper=content.find(".contentWrapper");popup.css({height:"auto",width:"auto","min-width":"300px","max-width":maxWidth+"px","min-height":"200px",left:left+"px","z-index":"16000"});jQuery.browser.msie?wrapper.css({"padding-bottom":"5px"}):(height=wrapper.height(),height=height>maxHeight?maxHeight+30+"px":"auto",content.css({height:height}))},_panMapToShowPopup:function(lonlat){var pixels=this._map.getViewPortPxFromLonLat(lonlat),size=this._map.getCurrentSize(),width=size.w,height=size.h,panx=0,pany=0,popup=jQuery(".olPopup"),infoboxWidth=popup.width()+128,infoboxHeight=popup.height()+128;pixels.x+infoboxWidth>width&&(panx=width-(pixels.x+infoboxWidth));pixels.y+infoboxHeight>height?pany=height-(pixels.y+infoboxHeight):pixels.y<25&&(pany=25);(panx!==0||pany!==0)&&this.getMapModule().panMapByPixels(-panx,-pany)},_changeColourScheme:function(colourScheme,div,id){if(div=div||jQuery("div#"+id),colourScheme&&div){var gfiHeaderArrow=div.find("div.popupHeaderArrow"),gfiHeader=div.find("div.popupHeader"),gfiTitle=div.find("div.popupTitle"),layerHeader=div.find("div.getinforesult_header"),featureHeader=div.find("h3.myplaces_header"),closeButton=div.find("div.olPopupCloseBox");gfiHeaderArrow.css({"border-right-color":colourScheme.bgColour});gfiHeader.css({"background-color":colourScheme.bgColour,color:colourScheme.titleColour});gfiTitle.css({color:colourScheme.titleColour});layerHeader.css({"background-color":colourScheme.bgColour});layerHeader.find("div.getinforesult_header_title").css({color:colourScheme.titleColour});featureHeader.css({color:colourScheme.headerColour});colourScheme.iconCls&&closeButton.removeClass("icon-close-white icon-close").addClass(colourScheme.iconCls)}},_changeFont:function(fontId,div,id){var elements,j,el;if(div=div||jQuery("div#"+id),div&&fontId)for(elements=[],elements.push(div),elements.push(div.find("table.getinforesult_table")),j=0;j<elements.length;j++)el=elements[j],el.removeClass(function(){for(var removeThese="",classNames=this.className.split(" "),i=0;i<classNames.length;++i)/oskari-publisher-font-/.test(classNames[i])&&(removeThese+=classNames[i]+" ");return removeThese}),el.addClass("oskari-publisher-font-"+fontId)},close:function(id,position){var pid,popup;if(!id){for(pid in this._popups)popup=this._popups[pid],position&&position.lon===popup.lonlat.lon&&position.lat===popup.lonlat.lat||(popup.popup.destroy(),delete this._popups[pid]);return}this._popups[id]&&(this._popups[id].popup&&this._popups[id].popup.destroy(),delete this._popups[id])},getPopups:function(id){return id?this._popups[id]:this._popups},register:function(){},unregister:function(){},startPlugin:function(sandbox){this._sandbox=sandbox;sandbox.register(this)},stopPlugin:function(sandbox){sandbox.unregister(this);this._map=null;this._sandbox=null},start:function(){},stop:function(){}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.bundle.infobox.request.ShowInfoBoxRequest",function(id,title,content,position,hidePrevious,colourScheme,font){this._creator=null;this._id=id;this._title=title;this._content=content;this._position=position;this._hidePrevious=hidePrevious==!0;this._colourScheme=colourScheme;this._font=font},{__name:"InfoBox.ShowInfoBoxRequest",getName:function(){return this.__name},getId:function(){return this._id},getTitle:function(){return this._title},getContent:function(){return this._content},getPosition:function(){return this._position},getHidePrevious:function(){return this._hidePrevious},getColourScheme:function(){return this._colourScheme},getFont:function(){return this._font}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.infobox.request.ShowInfoBoxRequestHandler",function(popupPlugin){this.popupPlugin=popupPlugin},{handleRequest:function(core,request){request.getHidePrevious()&&this.popupPlugin.close(undefined,request.getPosition());this.popupPlugin.popup(request.getId(),request.getTitle(),request.getContent(),request.getPosition(),request.getColourScheme(),request.getFont())}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.bundle.infobox.request.HideInfoBoxRequest",function(id){this._creator=null;this._id=id},{__name:"InfoBox.HideInfoBoxRequest",getName:function(){return this.__name},getId:function(){return this._id}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.infobox.request.HideInfoBoxRequestHandler",function(popupPlugin){this.popupPlugin=popupPlugin},{handleRequest:function(core,request){this.popupPlugin.close(request.getId())}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.bundle.infobox.request.RefreshInfoBoxRequest",function(id,operation,contentId){this._creator=null;this._id=id;this._operation=operation;this._contentId=contentId},{__name:"InfoBox.RefreshInfoBoxRequest",getName:function(){return this.__name},getId:function(){return this._id},getOperation:function(){return this._operation},getContentId:function(){return this._contentId}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.infobox.request.RefreshInfoBoxRequestHandler",function(popupPlugin){this.popupPlugin=popupPlugin},{handleRequest:function(core,request){var sandbox=this.popupPlugin._sandbox,popupId=request.getId(),operation=request.getOperation(),contentId=request.getContentId(),popup=this.popupPlugin.getPopups(popupId),evtB,evt;popup&&(operation==="remove"?this.popupPlugin.removeContentData(popupId,contentId):(evtB=sandbox.getEventBuilder("InfoBox.InfoBoxEvent"),evt=evtB(popupId,!0),sandbox.notifyAll(evt)))}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.bundle.infobox.event.InfoBoxEvent",function(_popupId,_popupOpen){this._popupId=_popupId;this._isOpen=_popupOpen},{__name:"InfoBox.InfoBoxEvent",getName:function(){return this.__name},getId:function(){return this._popupId},isOpen:function(){return this._isOpen}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.PersonalDataBundle",function(){},{create:function(){var me=this;return Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.PersonalDataBundleInstance")},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-personaldata/instance.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-personaldata/Flyout.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-personaldata/Tile.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-personaldata/MyPlacesTab.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-personaldata/MyViewsTab.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-personaldata/service/ViewService.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-personaldata/PublishedMapsTab.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-personaldata/AccountTab.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-personaldata/request/AddTabRequest.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-personaldata/request/AddTabRequestHandler.js"},{type:"text/css",src:"../../../../resources/lupapiste/bundle/lupapiste-personaldata/css/personaldata.css"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-personaldata/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-personaldata/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-personaldata/locale/en.js"},{lang:"cs",type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-personaldata/locale/cs.js"},{lang:"de",type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-personaldata/locale/de.js"},{lang:"es",type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-personaldata/locale/es.js"}]},bundle:{manifest:{"Bundle-Identifier":"lupapiste-personaldata","Bundle-Name":"lupapiste-personaldata","Bundle-Author":[{Name:"ejv",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}},dependencies:["jquery"]});Oskari.bundle_manager.installBundleClass("lupapiste-personaldata","Oskari.mapframework.bundle.personaldata.PersonalDataBundle");Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.PersonalDataBundleInstance",function(){this.core=null;this.sandbox=null;this.started=!1;this.template=null;this.plugins={};this.viewService=null},{__name:"PersonalData",getName:function(){return this.__name},setSandbox:function(sandbox){this.sandbox=sandbox},getSandbox:function(){return this.sandbox},getViewService:function(){return this.viewService},getLocalization:function(key){return(this._localization||(this._localization=Oskari.getLocalization(this.getName())),key)?this._localization[key]:this._localization},start:function(){var me=this,request;if(!me.started){me.started=!0;var conf=this.conf,sandboxName=(conf?conf.sandbox:null)||"sandbox",sandbox=Oskari.getSandbox(sandboxName);me.sandbox=sandbox;this.viewService=Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.service.ViewService",sandbox.getAjaxUrl());sandbox.register(me);for(p in me.eventHandlers)sandbox.registerForEventByName(me,p);request=sandbox.getRequestBuilder("userinterface.AddExtensionRequest")(this);sandbox.request(this,request);me.createUi();this.requestHandlers={addTabRequestHandler:Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.request.AddTabRequestHandler",sandbox,this.plugins["Oskari.userinterface.Flyout"])};sandbox.addRequestHandler("PersonalData.AddTabRequest",this.requestHandlers.addTabRequestHandler)}},init:function(){return window.personaldataTest=this,null},update:function(){},onEvent:function(event){var handler=this.eventHandlers[event.getName()];if(handler)return handler.apply(this,[event])},eventHandlers:{},stop:function(){var sandbox=this.sandbox(),request;for(p in this.eventHandlers)sandbox.unregisterFromEventByName(this,p);sandbox.removeRequestHandler("PersonalData.AddTabRequest",this.requestHandlers.addTabRequestHandler);request=sandbox.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);sandbox.request(this,request);this.sandbox.unregister(this);this.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.Flyout",this);this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.Tile",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null;this.plugins["Oskari.userinterface.Tile"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){var me=this;this.plugins["Oskari.userinterface.Flyout"].createUi();this.plugins["Oskari.userinterface.Tile"].refresh()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]});Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.Flyout",function(instance){this.instance=instance;this.container=null;this.state=null;this.template=null;this.templateTabHeader=null;this.templateTabContent=null;this.tabsData=[]},{getName:function(){return"Oskari.mapframework.bundle.personaldata.Flyout"},setEl:function(el){this.container=el[0];jQuery(this.container).hasClass("personaldata")||jQuery(this.container).addClass("personaldata")},startPlugin:function(){var me=this,tabsLocalization=this.instance.getLocalization("tabs");this.tabsData={myPlaces:Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.MyPlacesTab",this.instance,tabsLocalization.myplaces)}},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(state){this.state=state},createUi:function(){var me=this,sandbox=me.instance.getSandbox(),flyout=jQuery(this.container),tabId,tab,panel;if(flyout.empty(),this.tabsContainer=Oskari.clazz.create("Oskari.userinterface.component.TabContainer",this.instance.getLocalization("notLoggedIn")),this.tabsContainer.insertTo(flyout),sandbox.getUser().isLoggedIn())for(tabId in this.tabsData)tab=this.tabsData[tabId],panel=Oskari.clazz.create("Oskari.userinterface.component.TabPanel"),panel.setTitle(tab.getTitle()),tab.addTabContent(panel.getContainer()),tab.bindEvents&&tab.bindEvents(),this.tabsContainer.addPanel(panel)},addTab:function(item){var sandbox=this.instance.getSandbox(),panel;sandbox.getUser().isLoggedIn()&&(panel=Oskari.clazz.create("Oskari.userinterface.component.TabPanel"),panel.setTitle(item.title),panel.setContent(item.content),this.tabsContainer.addPanel(panel,item.first))}},{protocol:["Oskari.userinterface.Flyout"]});Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.Tile",function(instance){this.instance=instance;this.container=null;this.template=null},{getName:function(){return"Oskari.mapframework.bundle.personaldata.Tile"},setEl:function(el){this.container=jQuery(el)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){},getOptions:function(){},setState:function(){},refresh:function(){}},{protocol:["Oskari.userinterface.Tile"]});Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.MyPlacesTab",function(instance,localization){this.instance=instance;this.loc=localization;this.tabsContainer=undefined;this.tabPanels={};this.linkTemplate=jQuery('<a href="JavaScript:void(0);"><\/a>');this.iconTemplate=jQuery('<div class="icon"><\/div>')},{getName:function(){return"PersonalData.MyPlaces"},getTitle:function(){return this.loc.title},addTabContent:function(container){var me=this;this.tabsContainer=Oskari.clazz.create("Oskari.userinterface.component.TabDropdownContainer",this.loc.nocategories);this.tabsContainer.insertTo(container)},eventHandlers:{"LupaPisteMyPlaces.MyPlacesChangedEvent":function(){for(var id,panel,service=this.instance.sandbox.getService("Oskari.lupapiste.bundle.myplaces2.service.MyPlacesService"),categories=service.getAllCategories(),places=service.getAllMyPlaces(),me=this,editLinkClosure=function(id){return function(){var request=me.instance.sandbox.getRequestBuilder("MyPlaces.EditCategoryRequest")(id);return me.instance.sandbox.request(me.instance,request),!1}},deletelinkClosure=function(id){return function(){var request=me.instance.sandbox.getRequestBuilder("MyPlaces.DeleteCategoryRequest")(id);return me.instance.sandbox.request(me.instance,request),!1}},i=0;i<categories.length;++i)id=categories[i].getId(),panel=this.tabPanels[id],panel?(panel.setTitle(categories[i].name),me.tabsContainer.updatePanel(panel)):(panel=this._createCategoryTab(categories[i]),this.tabsContainer.addPanel(panel),this.tabPanels[id]=panel),this._populatePlaces(id),panel.getContainer().empty(),panel.grid.renderTo(panel.getContainer());this._removeObsoleteCategories()}},_showPlace:function(geometry){var center=geometry.getCentroid(),mapmoveRequest=this.instance.sandbox.getRequestBuilder("MapMoveRequest")(center.x,center.y,geometry.getBounds(),!1);this.instance.sandbox.request(this.instance,mapmoveRequest)},_editPlace:function(data){this._showPlace(data.geometry,data.categoryId);var request=this.instance.sandbox.getRequestBuilder("userinterface.UpdateExtensionRequest")(this.instance,"close",this.instance.getName());this.instance.sandbox.request(this.instance.getName(),request);request=this.instance.sandbox.getRequestBuilder("LupaPisteMyPlaces.EditPlaceRequest")(data.id);this.instance.sandbox.request(this.instance,request)},_deletePlace:function(data){var me=this,sandbox=this.instance.sandbox,loc=this.loc.notification["delete"],dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup"),okBtn=Oskari.clazz.create("Oskari.userinterface.component.Button"),cancelBtn,confirmMsg;okBtn.setTitle(loc.btnDelete);okBtn.addClass("primary");okBtn.setHandler(function(){dialog.close();var service=sandbox.getService("Oskari.lupapiste.bundle.myplaces2.service.MyPlacesService"),callback=function(isSuccess,featureId){var map=sandbox.findRegisteredModuleInstance("MainMapModule").getMap(),layer=map.getLayersByName("LupapisteVectors")[0],feature;layer&&(feature=layer.getFeaturesByAttribute("id",featureId)[0],layer.removeFeatures(feature));isSuccess?dialog.show(loc.title,loc.success):dialog.show(loc.title,loc.error);dialog.fadeout()};service.deleteMyPlace(data.id,callback)});cancelBtn=dialog.createCloseButton(loc.btnCancel);confirmMsg=loc.confirm+'"'+data.name+'"?';dialog.show(loc.title,confirmMsg,[cancelBtn,okBtn]);dialog.makeModal()},_getDrawModeFromGeometry:function(geometry){if(geometry===null)return null;var olClass=geometry.CLASS_NAME;return"OpenLayers.Geometry.MultiPoint"===olClass||"OpenLayers.Geometry.Point"===olClass?"point":"OpenLayers.Geometry.MultiLineString"===olClass||"OpenLayers.Geometry.LineString"===olClass?"line":"OpenLayers.Geometry.MultiPolygon"===olClass||"OpenLayers.Geometry.Polygon"===olClass?"area":null},_createCategoryTab:function(category){var me=this,id=category.getId(),panel=Oskari.clazz.create("Oskari.userinterface.component.TabPanel"),visibleFields,nameRenderer,editRenderer,deleteRenderer,estatesRenderer,i,key;for(panel.setId(id),panel.setTitle(category.getName()),panel.grid=Oskari.clazz.create("Oskari.userinterface.component.Grid"),visibleFields=["name","desc","height","area","length","estates","delete","edit"],panel.grid.setVisibleFields(visibleFields),nameRenderer=function(name,data){var link=me.linkTemplate.clone(),linkIcon=me.iconTemplate.clone(),shape=me._getDrawModeFromGeometry(data.geometry);return linkIcon.addClass("myplaces-"+shape),link.append(linkIcon),link.append(name),link.bind("click",function(){return me._showPlace(data.geometry,data.categoryId),!1}),link},panel.grid.setColumnValueRenderer("name",nameRenderer),editRenderer=function(name,data){var link=me.linkTemplate.clone();return link.append(name),link.bind("click",function(){return me._editPlace(data),!1}),link},panel.grid.setColumnValueRenderer("edit",editRenderer),deleteRenderer=function(name,data){var link=me.linkTemplate.clone();return link.append(name),link.bind("click",function(){return me._deletePlace(data),!1}),link},panel.grid.setColumnValueRenderer("delete",deleteRenderer),estatesRenderer=function(name,data){var link=me.linkTemplate.clone();return link.append(name),link.bind("click",function(){var loc=me.instance.getLocalization(),dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup"),okBtn=dialog.createCloseButton(loc.button.close),content=jQuery('<div id="estatestable" style="max-height:300px; overflow-y:scroll; overflow-x:none;"><\/div>');return content.append('<img src="'+Oskari.app.appConfig.lupakartta.conf.ajaxloader+'" />'),dialog.show(loc.tabs.myplaces.grid.estates,content,[okBtn]),jQuery.ajax({url:Oskari.app.appConfig.lupakartta.conf.ajaxurl+"/property-info-by-wkt",data:{wkt:data.geometry.toString()},dataType:"json",success:function(data){function formatKiinttunnus(tunnus){var a=tunnus.substring(0,3).replace(/^0+/,""),b=tunnus.substring(3,6).replace(/^0+/,""),c=tunnus.substring(6,10).replace(/^0+/,""),d=tunnus.substring(10,14).replace(/^0+/,"");return a.length==0&&(a="0"),b.length==0&&(b="0"),c.length==0&&(c="0"),d.length==0&&(d="0"),""+a+"-"+b+"-"+c+"-"+d}var table,i;for(content.empty(),table=jQuery("<table><thead><tr><th>"+loc.tabs.myplaces.estate+"<\/th><th>"+loc.tabs.myplaces.type+"<\/th><\/tr><\/thead><\/table>"),content.append(table),i=0;i<data.length;++i)table.append("<tr><th>"+formatKiinttunnus(data[i].kiinttunnus)+"<\/th><th>"+data[i].rekisteriyksikkolaji.selite[Oskari.getLang()]+"<\/th><tr>")}}),!1}),link},panel.grid.setColumnValueRenderer("estates",estatesRenderer),i=0;i<visibleFields.length;++i)key=visibleFields[i],panel.grid.setColumnUIName(key,this.loc.grid[key]);return panel},_populatePlaces:function(categoryId){var service=this.instance.sandbox.getService("Oskari.lupapiste.bundle.myplaces2.service.MyPlacesService"),places=service.getAllMyPlaces(),panel=this.tabPanels[categoryId],gridModel=Oskari.clazz.create("Oskari.userinterface.component.GridModel"),i;for(gridModel.setIdField("id"),panel.grid.setDataModel(gridModel),i=0;i<places.length;++i)places[i].getCategoryID()==categoryId&&gridModel.addData({id:places[i].getId(),name:places[i].getName(),desc:places[i].getDescription(),geometry:places[i].getGeometry(),categoryId:places[i].getCategoryID(),edit:this.loc.edit,"delete":this.loc["delete"],createDate:this._formatDate(service,places[i].getCreateDate()),updateDate:this._formatDate(service,places[i].getUpdateDate()),height:places[i].getHeight(),area:places[i].getArea(),length:places[i].getLength(),estates:this.loc.show})},_formatDate:function(service,date){var time=service.parseDate(date),value="";return time.length>0&&(value=time[0]),value},_removeObsoleteCategories:function(){var service=this.instance.sandbox.getService("Oskari.lupapiste.bundle.myplaces2.service.MyPlacesService"),categoryId,category;for(categoryId in this.tabPanels)category=service.findCategory(categoryId),category||(this.tabsContainer.removePanel(this.tabPanels[categoryId]),this.tabPanels[categoryId].grid=undefined,delete this.tabPanels[categoryId].grid,this.tabPanels[categoryId]=undefined,delete this.tabPanels[categoryId])},onEvent:function(event){var handler=this.eventHandlers[event.getName()];if(handler)return handler.apply(this,[event])},bindEvents:function(){var instance=this.instance,sandbox=instance.getSandbox();for(p in this.eventHandlers)sandbox.registerForEventByName(this,p)},unbindEvents:function(){var instance=this.instance,sandbox=instance.getSandbox();for(p in this.eventHandlers)sandbox.unregisterFromEventByName(this,p)}});Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.MyViewsTab",function(instance,localization){var tbstt,reqBuilder;this.instance=instance;this.loc=localization;this.template=jQuery('<div class="viewsList volatile"><\/div>');this.templateLink=jQuery('<a href="JavaScript:void(0);"><\/a>');this.templateDesc=jQuery('<div class="oskarifield"><label for="description"><\/label><textarea id="view_description" name="description" placeholder="'+this.loc.popup.description_placeholder+'"><\/textarea><\/div>');this.container=null;var sandbox=instance.sandbox,me=this,rbState=sandbox.getRequestBuilder("StateHandler.SaveStateRequest");rbState&&(reqBuilder=sandbox.getRequestBuilder("Toolbar.AddToolButtonRequest"),tbstt="localization.button.toolbarsave",localization&&localization.button&&localization.button.toolbarsave&&(tbstt=localization.button.toolbarsave),sandbox.request(instance,reqBuilder("save_view","viewtools",{iconCls:"tool-save-view",tooltip:tbstt,sticky:!1,prepend:!0,callback:function(){me._promptForView(function(name,description){var rbState=sandbox.getRequestBuilder("StateHandler.SaveStateRequest");sandbox.request(instance,rbState(name,description))})}})));sandbox.getUser().isLoggedIn()||(reqBuilder=sandbox.getRequestBuilder("Toolbar.ToolButtonStateRequest"),sandbox.request(instance,reqBuilder("save_view","viewtools",!1)))},{getName:function(){return"PersonalData.MyViews"},getTitle:function(){return this.loc.title},addTabContent:function(container){var me=this,content=me.template.clone();me.container=container;container.append(content);me._refreshViewsList()},_renderViewsList:function(views){var me,listContainer,model,grid;views||(views=[]);me=this;listContainer=me.container.find(".viewsList");listContainer.empty();this.viewData=views;model=this._getGridModel(views);grid=this._getGrid(model);grid.renderTo(listContainer)},_refreshViewsList:function(){var me=this,service=me.instance.getViewService();service.loadViews("USER",function(isSuccess,response){isSuccess?me._renderViewsList(response.views):me._showErrorMessage(me.loc.error.loadfailed)})},_editView:function(view){var me=this,sandbox=this.instance.getSandbox(),service=me.instance.getViewService(),successCallback=function(newName,newDescription){service.updateView(view.id,newName,newDescription,function(isSuccess){if(isSuccess){var dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup");dialog.show(me.loc.popup.title,me.loc.save.success);dialog.fadeout();me._refreshViewsList()}else me._showErrorMessage(me.loc.error.notsaved)})};this._promptForView(successCallback,view.name,view.description)},_promptForView:function(successCallback,viewName,viewDescription){var me=this,form=Oskari.clazz.create("Oskari.userinterface.component.Form"),nameInput=Oskari.clazz.create("Oskari.userinterface.component.FormInput","name"),title,template,dialog,okBtn,sandbox,cancelBtn;nameInput.setPlaceholder(this.loc.popup.name_placeholder);title=this.loc.popup.title;viewName&&(title=this.loc.popup.edit,nameInput.setValue(viewName));nameInput.setRequired(!0,me.loc.save.error_noname);nameInput.setContentCheck(!0,me.loc.save.error_illegalchars);form.addField(nameInput);template=form.getForm();template.append(me.templateDesc.clone());viewDescription&&template.find("textarea").val(viewDescription);dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup");okBtn=Oskari.clazz.create("Oskari.userinterface.component.Button");okBtn.setTitle(this.loc.button.save);okBtn.addClass("primary");sandbox=this.instance.sandbox;okBtn.setHandler(function(){var errors=form.validate();errors.length==0?(successCallback(nameInput.getValue(),template.find("textarea").val()),dialog.close()):form.showErrors()});cancelBtn=dialog.createCloseButton(this.loc.button.cancel);dialog.show(title,template,[cancelBtn,okBtn]);dialog.dialog.on("keyup",function(e){e.stopPropagation()});dialog.dialog.on("keydown",function(e){e.stopPropagation()})},_getGridModel:function(views){var gridModel=Oskari.clazz.create("Oskari.userinterface.component.GridModel"),i;for(gridModel.setIdField("id"),i=0;i<views.length;++i){var view=views[i],isPublic=view.isPublic===!0,data={id:view.id,state:view.state,name:view.name,description:view.description,isPublic:isPublic,edit:this.loc.edit,publish:isPublic?this.loc.unpublish:this.loc.publish,"delete":this.loc["delete"]};gridModel.addData(data)}return gridModel},_getGrid:function(model){var me=this,instance=this.instance,sandbox=instance.getSandbox(),visibleFields=["name","description","edit","delete"],grid=Oskari.clazz.create("Oskari.userinterface.component.Grid"),nameRenderer,editRenderer,deleteRenderer,i,key,coluiname;for(grid.setDataModel(model),grid.setVisibleFields(visibleFields),nameRenderer=function(name,data){var link=me.templateLink.clone();return link.append(name),link.bind("click",function(){var rb=sandbox.getRequestBuilder("StateHandler.SetStateRequest"),req;return rb&&(req=rb(data.state),req.setCurrentViewId(data.id),sandbox.request(instance,req)),!1}),link},grid.setColumnValueRenderer("name",nameRenderer),editRenderer=function(name,data){var link=me.templateLink.clone();return link.append(name),link.bind("click",function(){var view=me._getViewById(data.id);return view&&me._editView(view),!1}),link},grid.setColumnValueRenderer("edit",editRenderer),deleteRenderer=function(name,data){var link=me.templateLink.clone();return link.append(name),link.bind("click",function(){var view=me._getViewById(data.id);return view&&me._confirmDelete(view),!1}),link},grid.setColumnValueRenderer("delete",deleteRenderer),i=0;i<visibleFields.length;++i)key=visibleFields[i],coluiname="grid."+key,this.loc&&this.loc.grid&&this.loc.grid[key]&&(coluiname=this.loc.grid[key]),grid.setColumnUIName(key,coluiname);return grid},_getViewById:function(id){for(var i=0;i<this.viewData.length;++i)if(this.viewData[i].id==id)return this.viewData[i];this._showErrorMessage(me.loc.error.generic)},_confirmDelete:function(view){var me=this,dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup"),okBtn=Oskari.clazz.create("Oskari.userinterface.component.Button"),sandbox,cancelBtn;okBtn.setTitle(this.loc["delete"]);okBtn.addClass("primary");sandbox=this.instance.sandbox;okBtn.setHandler(function(){me._deleteView(view);dialog.close()});cancelBtn=dialog.createCloseButton(this.loc.button.cancel);dialog.show(me.loc.popup.deletetitle,me.loc.popup.deletemsg,[cancelBtn,okBtn]);dialog.makeModal()},_deleteView:function(view){var me=this,service=me.instance.getViewService();service.deleteView(view,function(isSuccess){isSuccess?me._refreshViewsList():me._showErrorMessage(me.loc.error.notdeleted)})},_showErrorMessage:function(msg){var dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup"),button=dialog.createCloseButton(this.loc.button.ok);button.addClass("primary");dialog.show(this.loc.error.title,msg,[button])},bindEvents:function(){var instance=this.instance,sandbox=instance.getSandbox();for(var p in this.eventHandlers)sandbox.registerForEventByName(this,p)},unbindEvents:function(){var instance=this.instance,sandbox=instance.getSandbox();for(var p in this.eventHandlers)sandbox.unregisterFromEventByName(this,p)},eventHandlers:{StateSavedEvent:function(event){if(event.isError()){this._showErrorMessage(this.loc.error.notsaved);return}var dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup");dialog.show(this.loc.popup.title,this.loc.save.success);dialog.fadeout();this._refreshViewsList()}},onEvent:function(event){var handler=this.eventHandlers[event.getName()];if(handler)return handler.apply(this,[event])}});Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.service.ViewService",function(viewUrl){this._viewUrl=viewUrl},{__qname:"Oskari.mapframework.bundle.personaldata.service.ViewService",getQName:function(){return this.__qname},__name:"ViewService",getName:function(){return this.__name},loadViews:function(type,callback){var me=this;type||(type="USER");jQuery.ajax({url:me._viewUrl+"action_route=GetViews",data:{viewType:type},type:"POST",dataType:"json",beforeSend:function(x){x&&x.overrideMimeType&&x.overrideMimeType("application/j-son;charset=UTF-8")},success:function(response){callback(!0,response)},error:function(){callback(!1)}})},deleteView:function(view,callback){var me=this;jQuery.ajax({url:me._viewUrl+"action_route=DeleteView",data:{id:view.id},type:"POST",beforeSend:function(x){x&&x.overrideMimeType&&x.overrideMimeType("application/j-son;charset=UTF-8")},success:function(){callback(!0)},error:function(){callback(!1)}})},makeViewPublic:function(id,isPublic,callback){var me=this;jQuery.ajax({url:me._viewUrl+"action_route=AdjustViewAccess",data:{id:id,isPublic:isPublic},type:"POST",dataType:"json",beforeSend:function(x){x&&x.overrideMimeType&&x.overrideMimeType("application/j-son;charset=UTF-8")},success:function(){callback(!0)},error:function(){callback(!1)}})},updateView:function(id,name,description,callback){var me=this;jQuery.ajax({url:me._viewUrl+"action_route=UpdateView",type:"POST",data:{id:id,newName:name,newDescription:description},dataType:"json",beforeSend:function(x){x&&x.overrideMimeType&&x.overrideMimeType("application/j-son;charset=UTF-8")},success:function(){callback(!0)},error:function(){callback(!1)}})},isViewLayersLoaded:function(viewData,sandbox){var response={status:!1,msg:"error"},i,layer;if(viewData&&viewData.state&&viewData.state.mapfull&&viewData.state.mapfull.state&&viewData.state.mapfull.state.selectedLayers){var selected=viewData.state.mapfull.state.selectedLayers,mapLayerService=sandbox.getService("Oskari.mapframework.service.MapLayerService"),layers=mapLayerService.getAllLayers(),loaded=mapLayerService.isAllLayersLoaded(),layerMissing=!1;for(i=0;i<selected.length;++i)if(layer=mapLayerService.findMapLayer(selected[i].id,layers),!layer){layerMissing=!0;break}loaded?layerMissing?response.msg="missing":(response.status=!0,response.msg="ok"):layerMissing?response.msg="notloaded":(response.status=!0,response.msg="ok")}return response}},{protocol:["Oskari.mapframework.service.Service"]});Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.PublishedMapsTab",function(instance,localization){this.instance=instance;this.template=jQuery('<div class="viewsList volatile"><\/div>');this.templateLink=jQuery('<a href="JavaScript:void(0);"><\/a>');this.loc=localization;this.container=null},{getName:function(){return"PersonalData.PublishedMapsTab"},getTitle:function(){return this.loc.title},addTabContent:function(container){var me=this,content=me.template.clone();me.container=container;container.append(content);me._refreshViewsList()},_renderViewsList:function(views){var me,listContainer,model,grid;views||(views=[]);me=this;listContainer=me.container.find(".viewsList");listContainer.empty();this.viewData=views;model=this._getGridModel(views);grid=this._getGrid(model);grid.renderTo(listContainer)},_refreshViewsList:function(){var me=this,service=me.instance.getViewService();service.loadViews("PUBLISHED",function(isSuccess,response){isSuccess?me._renderViewsList(response.views):me._showErrorMessage(me.loc.error.loadfailed)})},_getViewById:function(id){for(var i=0;i<this.viewData.length;++i)if(this.viewData[i].id==id)return this.viewData[i];this._showErrorMessage(me.loc.error.generic)},_confirmSetState:function(cb,blnMissing){var me=this,dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup"),okBtn=Oskari.clazz.create("Oskari.userinterface.component.Button"),cancelBtn;okBtn.setTitle(this.loc.button.ok);okBtn.addClass("primary");okBtn.setHandler(function(){dialog.close();cb&&blnMissing&&cb()});cancelBtn=dialog.createCloseButton(this.loc.button.cancel);blnMissing?dialog.show(me.loc.popup.showErrorTitle,me.loc.popup.showConfirmMissing,[cancelBtn,okBtn]):dialog.show(me.loc.popup.showErrorTitle,me.loc.popup.showConfirmNotLoaded,[cancelBtn]);dialog.makeModal()},_confirmDelete:function(view){var me=this,dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup"),okBtn=Oskari.clazz.create("Oskari.userinterface.component.Button"),sandbox,cancelBtn;okBtn.setTitle(this.loc["delete"]);okBtn.addClass("primary");sandbox=this.instance.sandbox;okBtn.setHandler(function(){me._deleteView(view);dialog.close()});cancelBtn=dialog.createCloseButton(this.loc.button.cancel);dialog.show(me.loc.popup.deletetitle,me.loc.popup.deletemsg,[cancelBtn,okBtn]);dialog.makeModal()},_deleteView:function(view){var me=this,service=me.instance.getViewService();service.deleteView(view,function(isSuccess){isSuccess?me._refreshViewsList():me._showErrorMessage(me.loc.error.notdeleted)})},_showErrorMessage:function(msg){var dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup"),button=dialog.createCloseButton(this.loc.button.ok);button.addClass("primary");dialog.show(this.loc.error.title,msg,[button])},_getGridModel:function(views){var gridModel=Oskari.clazz.create("Oskari.userinterface.component.GridModel"),i;for(gridModel.setIdField("id"),i=0;i<views.length;++i){var view=views[i],isPublic=view.isPublic===!0,data={id:view.id,state:view.state,name:view.name,domain:view.pubDomain,lang:view.lang,isPublic:isPublic,show:this.loc.show,edit:this.loc.edit,publish:isPublic?this.loc.unpublish:this.loc.publish,"delete":this.loc["delete"]};gridModel.addData(data)}return gridModel},_getGrid:function(model){var me=this,instance=this.instance,sandbox=instance.getSandbox(),visibleFields=["name","domain","publish","show","edit","delete"],grid=Oskari.clazz.create("Oskari.userinterface.component.Grid"),nameRenderer,deleteRenderer,service,publishRenderer,i,key,coluiname;grid.setDataModel(model);grid.setVisibleFields(visibleFields);nameRenderer=function(name,data){var link=me.templateLink.clone();return link.append(name),link.bind("click",function(){return window.open("/web/fi/kartta?p_p_id=Portti2Map_WAR_portti2mapportlet&p_p_lifecycle=0&p_p_state=exclusive&published=true&viewId="+data.id,"Published","location=1,status=1,scrollbars=yes,width=850,height=800"),!1}),link};grid.setColumnValueRenderer("name",nameRenderer);var setStateRequestBuilder=sandbox.getRequestBuilder("StateHandler.SetStateRequest"),service=instance.getViewService(),setMapState=function(data,forced,confirmCallback){var resp=service.isViewLayersLoaded(data,sandbox),req;return resp.status||forced===!0?setStateRequestBuilder?(req=setStateRequestBuilder(data.state),req.setCurrentViewId(data.id),sandbox.request(instance,req),!0):!1:(me._confirmSetState(confirmCallback,resp.msg=="missing"),!1)},showRenderer=function(name,data){var link=me.templateLink.clone();return link.append(name),link.bind("click",function(){return setMapState(data,!1,function(){return setMapState(data,!0),!1}),!1}),link};grid.setColumnValueRenderer("show",showRenderer);var publishMapEditorRequestBuilder=sandbox.getRequestBuilder("Publisher.PublishMapEditorRequest"),editRequestSender=function(data){if(publishMapEditorRequestBuilder){var req=publishMapEditorRequestBuilder(data);sandbox.request(instance,req)}},editRenderer=function(name,data){var link=me.templateLink.clone();return link.append(name),link.bind("click",function(){return setMapState(data,!1,function(){setMapState(data,!0);editRequestSender(data)})&&editRequestSender(data),!1}),link};for(grid.setColumnValueRenderer("edit",editRenderer),deleteRenderer=function(name,data){var link=me.templateLink.clone();return link.append(name),link.bind("click",function(){var view=me._getViewById(data.id);return view&&me._confirmDelete(view),!1}),link},grid.setColumnValueRenderer("delete",deleteRenderer),service=instance.getViewService(),publishRenderer=function(name,data){var link=me.templateLink.clone();return link.html(name),link.bind("click",function(){var view=me._getViewById(data.id),newState;return view&&(newState=!view.isPublic,service.makeViewPublic(data.id,newState,function(isSuccess){isSuccess?(view.isPublic=newState,data.publish=view.isPublic?me.loc.unpublish:me.loc.publish,link.html(data.publish)):newState?me._showErrorMessage(me.loc.error.makePublic):me._showErrorMessage(me.loc.error.makePrivate)})),!1}),link},grid.setColumnValueRenderer("publish",publishRenderer),i=0;i<visibleFields.length;++i)key=visibleFields[i],coluiname="grid."+key,this.loc&&this.loc.grid&&this.loc.grid[key]&&(coluiname=this.loc.grid[key]),grid.setColumnUIName(key,coluiname);return grid},bindEvents:function(){var instance=this.instance,sandbox=instance.getSandbox();for(var p in this.eventHandlers)sandbox.registerForEventByName(this,p)},unbindEvents:function(){var instance=this.instance,sandbox=instance.getSandbox();for(var p in this.eventHandlers)sandbox.unregisterFromEventByName(this,p)},eventHandlers:{"Publisher.MapPublishedEvent":function(){this._refreshViewsList()}},onEvent:function(event){var handler=this.eventHandlers[event.getName()];if(handler)return handler.apply(this,[event])}});Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.AccountTab",function(instance,localization){this.instance=instance;this.template=jQuery('<div class="account"><div class="info"><\/div><div class="bottomlinks"><\/div><\/div>');this.loc=localization},{getTitle:function(){return this.loc.title},addTabContent:function(container){var content=this.template.clone();container.append(content);this._createAccountTab(container)},_createAccountTab:function(container){for(var fieldContainer,bottomLinks,bottomLinksContainer,data,link,me=this,sandbox=me.instance.getSandbox(),fieldTemplate=jQuery('<div class="dataField"><div class="label"><\/div><div class="value"><\/div><br clear="all" /><\/div>'),user=sandbox.getUser(),localization=this.loc,accountData=[{label:localization.firstName,value:user.getFirstName()},{label:localization.lastName,value:user.getLastName()},{label:localization.nickName,value:user.getNickName()},{label:localization.email,value:user.getLoginName()}],infoContainer=container.find("div.info"),i=0;i<accountData.length;++i)data=accountData[i],fieldContainer=fieldTemplate.clone(),fieldContainer.find(".label").html(data.label),fieldContainer.find(".value").html(data.value),infoContainer.append(fieldContainer);for(bottomLinks=[{label:localization.changeInfo,href:localization.changeInfoUrl}],bottomLinksContainer=container.find("div.bottomlinks"),i=0;i<bottomLinks.length;++i)data=bottomLinks[i],link=jQuery('<a href="'+data.href+'">'+data.label+"<\/a>&nbsp; "),bottomLinksContainer.append(link)}});Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.request.AddTabRequest",function(title,content,first){this._title=title;this._content=content;this._first=!!first},{__name:"PersonalData.AddTabRequest",getName:function(){return this.__name},getTitle:function(){return this._title},getContent:function(){return this._content},isFirst:function(){return this._first}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.request.AddTabRequestHandler",function(sandbox,personaldata){this.sandbox=sandbox;this.personaldata=personaldata},{handleRequest:function(core,request){this.personaldata.addTab({title:request.getTitle(),content:request.getContent(),first:request.isFirst()})}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.registerLocalization({lang:"fi",key:"PersonalData",value:{title:"Omat tiedot",desc:"Omat tiedot",notLoggedIn:"Omiin tietoihin voit tallentaa omia karttankymi ja kohteita sek nhd muille sivustoille julkaisemasi kartat. <a href='/web/fi/login'>Kirjaudu palveluun<\/a>.",tabs:{myplaces:{title:"Kohteet",nocategories:"Et ole viel tallentanut kohteita.",publishCategory:{privateTooltip:"Taso on yksityinen. Muuta taso julkiseksi klikkaamalla.",publicTooltip:"Taso on julkinen. Muuta taso yksityiseksi klikkaamalla."},editCategory:"Muokkaa tasoa",deleteCategory:"Poista taso",edit:"Muokkaa","delete":"Poista",show:"Nyt",grid:{name:"Nimi",desc:"Kuvaus",height:"Korkeus/Syvyys (m)",createDate:"Luotu",updateDate:"Pivitetty",edit:" ","delete":" ",area:"Pinta-ala (m2)",length:"Pituus (m)",estates:"Kiinteistt"},estate:"Kiinteist",type:"Rekisteriyksikn laji",notification:{"delete":{title:"Kohteen poistaminen",confirm:"Haluatko poistaa kohteen?",btnDelete:"Poista",btnCancel:"Peruuta",success:"Kohde on poistettu.",error:"Kohteen poistaminen eponnistui. Kokeile uudestaan myhemmin.",cancel:"Kohdetta ei ole poistettu."}}},myviews:{title:"Omat nkymt",edit:"Muokkaa",publish:"Muuta julkiseksi",unpublish:"Muuta yksityiseksi","delete":"Poista",grid:{name:"Nimi",description:"Kuvaus",publish:"Julkaisu",edit:" ","delete":" "},popup:{edit:"Muokkaa nkymn tietoja",title:"Nkymn tallennus",label:"Nkymn nimi:",name_placeholder:"Anna nkymlle nimi",description_placeholder:"Anna nkymlle kuvaus",save:"Tallenna",cancel:"Peruuta",error_noname:"Syt nimi",deletetitle:"Poiston varmistus",deletemsg:"Haluatko poistaa nkymn?"},save:{success:"Nkym tallennettu.",error_noname:"Nimi ei voi olla tyhj.",error_illegalchars:"Nimess on luvattomia merkkej. Sallittuja merkkej ovat kaikki suomen kielen aakkoset, numerot sek vlilynti ja yhdysmerkki.",msg:{view_name:"Nkymn nimi"}},button:{ok:"OK",save:"Tallenna",cancel:"Peruuta",toolbarsave:"Tallenna nkym"},error:{title:"Virhe!",generic:"Jrjestelmss tapahtui virhe. Yrit uudelleen myhemmin.",notsaved:"Nkymn tallentaminen eponnistui.",notdeleted:"Nkymn poisto eponnistui.",makePublic:"Nkymn muuttaminen julkiseksi eponnistui. Yrit myhemmin uudelleen.",makePrivate:"Nkymn muuttaminen yksityiseksi eponnistui. Yrit myhemmin uudelleen.",loadfailed:"Nkymien lataus eponnistui."}},publishedmaps:{title:"Julkaistut kartat",show:"Nyt kartalla",edit:"Muokkaa",publish:"Julkaise kartta",unpublish:"Peru julkaisu","delete":"Poista",grid:{name:"Nimi",domain:"Kartan tiedot",publish:"Tila",show:" ",edit:" ","delete":" "},popup:{edit:"Vaihda kartan nimi",title:"Kartan tallennus",label:"Kartan nimi:",placeholder:"Anna kartalle nimi",save:"Tallenna",cancel:"Peruuta",error_noname:"Anna kartalle nimi",deletetitle:"Poiston varmistus",deletemsg:"Haluatko poistaa julkaistun kartan? Tmn jlkeen kartta ei ny sivustollasi.",showErrorTitle:"Nkym puutteellinen",showConfirmMissing:"Osa nkymn tallennetuista tasoista ei ole kytettviss, haluatko silti avata nkymn?",showConfirmNotLoaded:"Kaikki karttatasot eivt ole viel latautuneet, yrit uudelleen hetken pst."},save:{success:"Kartta tallennettu.",error_noname:"Nimi ei voi olla tyhj.",error_illegalchars:"Nimess on luvattomia merkkej. Sallittuja merkkej ovat kaikki suomen kielen aakkoset, numerot sek vlilynti ja yhdysmerkki.",msg:{view_name:"Kartan nimi"}},button:{ok:"OK",save:"Tallenna",cancel:"Peruuta",toolbarsave:"Tallenna kartta"},error:{title:"Virhe!",generic:"Jrjestelmss tapahtui virhe. Yrit uudelleen myhemmin.",notsaved:"Kartan tallentaminen eponnistui.",notdeleted:"Kartan poisto eponnistui.",makePublic:"Kartan julkaiseminen eponnistui. Yrit myhemmin uudelleen.",makePrivate:"Kartan vaihtaminen yksityiseksi eponnistui. Yrit myhemmin uudelleen."}},account:{title:"Tilin tiedot",firstName:"Etunimi",lastName:"Sukunimi",nickName:"Nimimerkki",email:"Shkpostiosoite",changeInfo:"Muuta tietoja",changePassword:"Muuta salasana",removeAccount:"Poista tili",changeInfoUrl:"/web/fi/profiili"}},button:{yes:"Kyll",no:"Ei",close:"Sulje"}}});Oskari.registerLocalization({lang:"sv",key:"PersonalData",value:{title:"Mina uppgifter",desc:"Mina uppgifter",notLoggedIn:"Du kan lagra dina egna kartvyer och titta p kartor som du har inbddat p andra webbplatser i Mina uppgifter. <a href='/web/sv/login'>Logga in<\/a>.",tabs:{myplaces:{title:"Objekt",nocategories:"Du har nnu inte lagrat objekten.",publishCategory:{privateTooltip:"Kartlagret r privat. Klicka p lagret fr att offentliggra det.",publicTooltip:"Kartlagret r offentliggra. Klicka p lagret fr att privat det."},editCategory:"Editera kartlager",deleteCategory:"Ta bort kartlager",edit:"Editera","delete":"Ta bort",show:"Visa",grid:{name:"Namn",desc:"Beskrivning",height:"Hojd/Djup (m)",createDate:"Skapad",updateDate:"Uppdaterad",edit:" ","delete":" ",area:"Areal (m2)",length:"Lngd (m)",estates:"Fastighets"},estate:"Fastighet",type:"Registerenhetens art",notification:{"delete":{title:"Ta bort objekt",confirm:"Vill du ta bort detta objekt?",btnDelete:"Ta bort",btnCancel:"Tillbaka",success:"Objektet har tagits bort.",error:"Objektet kunde inte tas bort. Prova p nytt senare.",cancel:"Objektet har inte tagits bort."}}},myviews:{title:"Mina vyer",edit:"Editera",publish:"Offentliggr",unpublish:"Gr privat","delete":"Ta bort",grid:{name:"Namn",description:"Beskrivning",publish:"Vyn r offentlig",edit:" ","delete":" "},popup:{edit:"Editera vyn",title:"Lagra vy",label:"Vyns namn",name_placeholder:"Namnge vy",description_placeholder:"Beskriv vyn",save:"Lagra",cancel:"Tillbaka",error_noname:"Skriv namnet",deletetitle:"Bekrfta radering",deletemsg:"Vill du ta bort denna vy?"},save:{success:"Vyn har lagrats.",error_noname:"Namnet kan inte vara tomt.",error_illegalchars:"I namnet ingr otilltna tecken. Tilltna r alla bokstver i det svenska alfabetet, siffror, mellanslag och bindestreck.",msg:{view_name:"Vyns namn"}},button:{ok:"OK",save:"Lagra",cancel:"Tillbaka",toolbarsave:"Lagra vy"},error:{title:"Fel!",generic:"Systemfel. Frsk p nytt senare.",notsaved:"Vyn kunde inte lagras.",notdeleted:"Vyn kunde inte tas bort.",makePublic:"Vyn kunde inte gras offentlig Frsk p nytt senare.",makePrivate:"Vyn kunde inte gras privat. Frsk p nytt senare.",loadfailed:"Vyerna kunde inte laddas ned."}},publishedmaps:{title:"Inbddade",show:"Visa p kartan",edit:"Redigera",publish:"Avskilj karta",unpublish:"terta avskiljandet","delete":"Ta bort",grid:{name:"Namn",domain:"Kartinstllnigar",publish:"Status",show:" ",edit:" ","delete":" "},popup:{edit:"Byt namn p kartan",title:"Lagra karta",label:"Kartans namn:",placeholder:"Namnge kartan",save:"Lagra",cancel:"Tillbaka",error_noname:"Namnge kartan",deletetitle:"Vill du ta bort denna karta?",deletemsg:"Vill du ta bort den inbddade kartan? Efter detta syns kartan inte lngre p din webbplats.",showErrorTitle:"Bristfllig vy",showConfirmMissing:"En del av de kartlager som har lagrats i vyn r inte tillgngliga, vill du nd ppna vyn?",showConfirmNotLoaded:"Alla kartlager har nnu inte laddats ned, frsk p nytt om en stund."},save:{success:"Kartan har lagrats.",error_noname:"Namnet kan inte vara tomt.",error_illegalchars:"I namnet ingr otilltna tecken. Tilltna r alla bokstver i det svenska alfabetet, siffror, mellanslag och bindestreck.",msg:{view_name:"Kartans namn"}},button:{ok:"OK",save:"Lagra",cancel:"Tillbaka",toolbarsave:"Lagra karta"},error:{title:"Fel!",generic:"Systemfel. Frsk p nytt senare.",notsaved:"Kartan kunde inte lagras.",notdeleted:"Kartan kunde inte tas bort.",makePublic:"Kartan kunde inte gras offentlig. Frsk p nytt senare.",makePrivate:"Kartan kunde inte gras privat. Frsk p nytt senare."}},account:{title:"Anvndarkonto",firstName:"Frnamn",lastName:"Efternamn",nickName:"Signatur",email:"E-postadress",changeInfo:"ndra uppgifter",changePassword:"Byt ut lsenordet",removeAccount:"Radera konto",changeInfoUrl:"/web/sv/profil"}},button:{yes:"Ja",no:"Nej",close:"Stng"}}});Oskari.registerLocalization({lang:"en",key:"PersonalData",value:{title:"My data",desc:"My data",notLoggedIn:"You can save map views and browse maps that you have embedded on other websites in My data. <a href='/web/en/login'>Log in<\/a>.",tabs:{myplaces:{title:"Places",nocategories:"You have not yet saved the places.",publishCategory:{privateTooltip:"The map layer is private. Click the map layer to make it public.",publicTooltip:"The map layer is public. Click the map layer to make it private."},editCategory:"Edit map layer",deleteCategory:"Delete map layer",edit:"Edit","delete":"Delete",show:"Show",grid:{name:"Name",desc:"Description",height:"Height/Depth (m)",createDate:"Created",updateDate:"Updated",edit:" ","delete":" ",area:"Area (m2)",length:"Length (m)",estates:"???"},estate:"???",type:"???",notification:{"delete":{title:"Delete place",confirm:"Do you want to delete this place?",btnDelete:"Delete",btnCancel:"Cancel",success:"The place has been deleted.",error:"The place could not be deleted. Please try again later.",cancel:"The object has not been deleted."}}},myviews:{title:"My map views",edit:"Edit",publish:"Publish",unpublish:"Unpublish","delete":"Delete",grid:{name:"Name",description:"Description",publish:"Published",edit:" ","delete":" "},popup:{edit:"Edit view's information",title:"Save map view",label:"Name of map view:",name_placeholder:"Give the map view a name",description_placeholder:"Give the map view a description",save:"Save",cancel:"Cancel",error_noname:"Type the name",deletetitle:"Confirm delete",deletemsg:"Do you want to delete this map view?"},save:{success:"The map view has been saved.",error_noname:"The name field cannot be blank.",error_illegalchars:"The name contains disallowed characters. Allowed characters are the letters a-z as well as ,  and , numbers, backspaces and hyphens.",msg:{view_name:"The name of the map view"}},button:{ok:"OK",save:"Save",cancel:"Cancel",toolbarsave:"Save map view"},error:{title:"Error!",generic:"System error. Please try again later.",notsaved:"The map view could not be saved.",notdeleted:"The map view could not be deleted.",makePublic:"The map view could not be published. Please try again later.",makePrivate:"The map view could not be unpublished. Please try again later.",loadfailed:"The map views could not be downloaded."}},publishedmaps:{title:"Embedded maps",show:"Show on the map",edit:"Edit",publish:"Publish map",unpublish:"Unpublish map","delete":"Delete",grid:{name:"Name",domain:"Map settings",publish:"Status",show:" ",edit:" ","delete":" "},popup:{edit:"Change map name",title:"Save map",label:"Map name",placeholder:"Give the map a name",save:"Save",cancel:"Cancel",error_noname:"Give the map a name",deletetitle:"Delete map?",deletemsg:"Do you want to delete the embedded map? It will no longer be shown on your website.",showErrorTitle:"Incomplete view",showConfirmMissing:"Some saved map layers are not available, do you still want to open this view?",showConfirmNotLoaded:"Some map layers have not yet loaded, try again later."},save:{success:"The map has been saved.",error_noname:"The name field cannot be blank.",error_illegalchars:"The name contains disallowed characters. Allowed characters are the letters a-z as well as ,  and , numbers, backspaces and hyphens.",msg:{view_name:"Map name"}},button:{ok:"OK",save:"Save",cancel:"Cancel",toolbarsave:"Save map"},error:{title:"Error!",generic:"System error. Please try again later.",notsaved:"The map could not be saved.",notdeleted:"The map could not be deleted.",makePublic:"The map could not be published. Please try again later.",makePrivate:"The map could not be unpublished. Please try again later."}},account:{title:"My account",firstName:"First name",lastName:"Last name",nickName:"Nickname",email:"E-mail",changeInfo:"Change your account information",changePassword:"Change your password",removeAccount:"Delete your account",changeInfoUrl:"/web/en/profile"}},button:{yes:"Yes",no:"No",close:"Close"}}});Oskari.registerLocalization({lang:"cs",key:"PersonalData",value:{title:"Moje data",desc:"Moje data",notLoggedIn:"Lze uloit zobrazen map a prohlet mapy, kter jste vloili do jinch web v Mch datech. <a href='/web/en/login'>Pihlsit se<\/a>.",tabs:{myplaces:{title:"Msta",nocategories:"Msta jste jet neuloil.",publishCategory:{privateTooltip:"Mapa je soukrom| Kliknte na mapovou vrstvu pro jej veejn zpstupnn.",publicTooltip:"Mapa je veejn| Kliknte na mapovou vrstvu pro jej zmnu na soukromou."},editCategory:"Upravit mapovou vrstvu",deleteCategory:"Smazat mapovou vrstvu",edit:"Upravit","delete":"Smazat",grid:{name:"Jmno",desc:"Popis",height:"Vyska/hloubka (m)",createDate:"Vytvoeno",updateDate:"Aktualizovno",edit:" ","delete":" "},notification:{"delete":{title:"Smazat msto",confirm:"Chcete toto msto smazat?",btnDelete:"Smazat",btnCancel:"Storno",success:"Msto bylo smazno.",error:"Msto nelze smazat, zkuste to prosm pozdji.",cancel:"Tento objekt nebyl smazn."}}},myviews:{title:"M zobrazen mapy",edit:"Upravit",publish:"Publikovat",unpublish:"Zruit publikaci","delete":"Smazat",grid:{name:"Jmno",description:"Popis",publish:"Publikovno",edit:" ","delete":" "},popup:{edit:"Upravit informace o zobrazen",title:"Uloit zobrazen mapy",label:"Jmno zobrazen mapy:",name_placeholder:"Pojmenujte zobrazen mapy",description_placeholder:"Popite zobrazen mapy",save:"Uloit",cancel:"Storno",error_noname:"Zadejte jmno",deletetitle:"Potvrte smazn",deletemsg:"Chcete toto zobrazen mapy smazat?"},save:{success:"Zobrazen mapy bylo smazno.",error_noname:"Pole jmna neme bt przdn.",error_illegalchars:"Jmno obsahuje nepovolen znaky. Povolen znaky jsou a-z, ,  a , sla, mezery a pomlky.",msg:{view_name:"Jmno zobrazen mapy"}},button:{ok:"OK",save:"Uloit",cancel:"Storno",toolbarsave:"Uloit zobrazen mapy"},error:{title:"Chyba!",generic:"Systmov chyba. Zkuste to prosm pozdji.",notsaved:"Zobrazen mapy nemohlo bt uloeno.",notdeleted:"Zobrazen mapy nemohlo bt smazno.",makePublic:"Zobrazen mapy nemohlo bt publikovno. Zkuste to prosm pozdji.",makePrivate:"Zobrazen mapy nemohla bt zruena publikace. Zkuste to prosm pozdji.",loadfailed:"Zobrazen mapy nemohlo bt staeno."}},publishedmaps:{title:"Vloen mapy",show:"Uka na map",edit:"Upravit",publish:"Publikovat mapu",unpublish:"Zruit publikaci mapy","delete":"Smazat",grid:{name:"Jmno",domain:"Nastaven mapy",publish:"Stav",show:" ",edit:" ","delete":" "},popup:{edit:"Zmnit jmno mapy",title:"Uloit mapu",label:"Jmno mapy",placeholder:"Pojmenovat mapu",save:"Uloit",cancel:"Storno",error_noname:"Pojmenovat mapu",deletetitle:"Smazat mapu?",deletemsg:"Chcete vloenou mapu smazat? Pak ji nebude zobrazovna na vaem webu.",showErrorTitle:"Nepln zobrazen",showConfirmMissing:"Nkter uloen mapov vrstvy nejsou dostupn, chcete stle otevt tuto novou?",showConfirmNotLoaded:"Nkter mapov vrstvy nebyly nahrny, zkuste to pozdji."},save:{success:"Mapa byla uloena.",error_noname:"Pole jmna neme bt przdn.",error_illegalchars:"Jmno obsahuje nepovolen znaky. Povolen znaky jsou a-z, ,  a , sla, mezery a pomlky.",msg:{view_name:"Jmno mapy"}},button:{ok:"OK",save:"Uloit",cancel:"Storno",toolbarsave:"Uloit mapu"},error:{title:"Chyba!",generic:"Systmov chyba. Zkuste to prosm pozdji.",notsaved:"Mapa nemohla bt uloena.",notdeleted:"Mapa nemohla bt smazna.",makePublic:"Mapa nemohla bt publikovna. Zkuste to prosm pozdji.",makePrivate:"Map nemohla bt zruena publikace. Zkuste to prosm pozdji."}},account:{title:"Mj et",firstName:"Kestn jmno",lastName:"Pjmen",nickName:"Pezdvka",email:"E-mail",changeInfo:"Zmnit informace o vaem tu",changePassword:"Zmnit vae heslo",removeAccount:"Zruit v et",changeInfoUrl:"/web/en/profile"}},button:{yes:"Ano",no:"Ne"}}});Oskari.registerLocalization({lang:"de",key:"PersonalData",value:{title:"Meine Daten",desc:"Meine Daten",notLoggedIn:"Sie knnen unter \"Meine Daten\" Kartenansichten speichern und Karten durchsuchen, die Sie auf anderen Webseiten eingebunden haben. <a href='/web/en/login'>Anmelden<\/a>.",tabs:{myplaces:{title:"Orte",nocategories:"Sie haben die Orte bisher nicht gespeichert.",publishCategory:{privateTooltip:"Die Kartenebene ist nicht ffentlich.| Klicken Sie auf die Kartenebene, um sie ffentlich zu machen.",publicTooltip:"Die Kartenebene ist ffentlich| Klicken Sie auf die Kartenebene, um sie nicht ffentlich zu machen."},editCategory:"Kartenebene bearbeiten",deleteCategory:"Kartenebene lschen",edit:"Bearbeiten","delete":"Lschen",grid:{name:"Name",desc:"Beschreibung",height:"Hohe/Tiefe (m)",createDate:"Erstellt",updateDate:"Aktualisiert",edit:" ","delete":" "},notification:{"delete":{title:"Ort lschen",confirm:"Mchten Sie diesen Ort lschen?",btnDelete:"Abbrechen",btnCancel:"Cancel",success:"Der Ort wurde gelscht.",error:"Dieser Ort konnte nicht gelscht werden. Bitte versuchen Sie es spter noch einmal.",cancel:"Der Ort wurde nicht gelscht."}}},myviews:{title:"Meine Kartenansichten",edit:"Bearbeiten",publish:"Verffentlichen",unpublish:"Verffentlichung rckgngig machen","delete":"Lschen",grid:{name:"Name",description:"Beschreibung",publish:"Verffentlicht",edit:" ","delete":" "},popup:{edit:"Informationen zur Kartenansicht bearbeiten",title:"Kartenansicht speichern",label:"Name der Kartenansicht:",name_placeholder:"Geben Sie der Kartenansicht einen Namen",description_placeholder:"Beschreiben Sie die Kartenansicht",save:"Speichern",cancel:"Abbrechen",error_noname:"Geben Sie den Namen ein",deletetitle:"Lschen besttigen",deletemsg:"Mchten Sie diese Kartenansicht lschen?"},save:{success:"Diese Kartenansicht wurde gespeichert.",error_noname:"Das Namensfeld darf nicht leer sein.",error_illegalchars:"Der Name enthlt unzulssige Zeichen. Erlaubte Zeichen sind die Buchstaben a-z, , ,  sowie Zahlen, Bindestriche und die Backspace-Taste.",msg:{view_name:"Der Name der Kartenansicht"}},button:{ok:"OK",save:"Speichern",cancel:"Abbrechen",toolbarsave:"Kartenansicht speichern"},error:{title:"Fehler!",generic:"Systemfehler! Bitte versuchen Sie es spter noch einmal",notsaved:"Die Kartenansicht konnte nicht gespeichert werden.",notdeleted:"Die Kartenansicht konnte nicht gelscht werden.",makePublic:"Die Kartenansicht konnte nicht verffentlicht werden. Bitte versuchen Sie es spter noch einmal.",makePrivate:"Die Verffentlichung der Kartenansicht konnte nicht rckgngig gemacht werden. Bitte versuchen Sie es spter noch einmal.",loadfailed:"Die Kartenansichten konnte nicht heruntergeladen werden."}},publishedmaps:{title:"Eingebundene Karten",show:"Auf der Karte anzeigen",edit:"Bearbeiten",publish:"Karte verffentlichen",unpublish:"Verffentlichung der Karte rckgngig machen","delete":"Lschen",grid:{name:"Name",domain:"Karteneinstellungen",publish:"Status",show:" ",edit:" ","delete":" "},popup:{edit:"Kartenname ndern",title:"Karte speichern",label:"Kartenname",placeholder:"Geben Sie der Karte einen Namen",save:"Speichern",cancel:"Abbrechen",error_noname:"Geben Sie der Karte einen Namen",deletetitle:"Karte lschen?",deletemsg:"Mchten Sie die eingebundene Karte lschen? Sie wird nicht lnger auf Ihrer Webseite angezeigt.",showErrorTitle:"Unvollstndige Ansicht",showConfirmMissing:"Einige der gespeicherten Kartenebenen sind nicht verfgbar. Mchten Sie die Ansicht trotzdem ffnen?",showConfirmNotLoaded:"Einige Kartenebenen sind noch nicht geladen, bitte versuchen Sie es spter noch einmal."},save:{success:"Die Karte wurde gespeichert.",error_noname:"Das Namensfeld darf nicht leer sein.",error_illegalchars:"Der Name enthlt unzulssige Zeichen. Erlaubte Zeichen sind die Buchstaben a-z, , ,  sowie Zahlen, Bindestriche und die Backspace-Taste.",msg:{view_name:"Kartenname"}},button:{ok:"OK",save:"Speichern",cancel:"Abbrechen",toolbarsave:"Karte speichern"},error:{title:"Fehler!",generic:"Systemfehler! Bitte versuchen Sie es spter noch einmal.",notsaved:"Die Karte konnte nicht gespeichert werden.",notdeleted:"Die Karte konnte nicht gelscht werden.",makePublic:"Die Karte konnte nicht verffentlicht werden. Bitte versuchen Sie es spter noch einmal.",makePrivate:"Die Verffentlichung der Karte konnte nicht rckgngig gemacht werden. Bitte versuchen Sie es spter noch einmal."}},account:{title:"Mein Konto",firstName:"Vorname",lastName:"Nachname",nickName:"Spitzname",email:"E-Mail",changeInfo:"ndern Sie Ihre Konto-Informationen",changePassword:"ndern Sie Ihr Passwort",removeAccount:"Lschen Sie Ihr Konto",changeInfoUrl:"/web/en/profile"}},button:{yes:"Ja",no:"Nein"}}});Oskari.registerLocalization({lang:"es",key:"PersonalData",value:{title:"Mis datos",desc:"Mis datos",notLoggedIn:"En Mis datos, puede guardar vistas y navegar por los mapas que haya incorporado en otros portales web. <a href='/web/en/login'>Acceder<\/a>.",tabs:{myplaces:{title:"Sitios",nocategories:"Todava no ha guardado los sitios.",publishCategory:{privateTooltip:"La capa es privada. Pulse en la capa para publicarla.",publicTooltip:"La capa es pblica. Pulse en la capa para despublicarla."},editCategory:"Editar capa",deleteCategory:"Borrar capa",edit:"Editar","delete":"Borrar",grid:{name:"Nombre",desc:"Descripcin",height:"Altura/Profundidad (m)",createDate:"Creada",updateDate:"Actualizada",edit:" ","delete":" "},notification:{"delete":{title:"Borrar sitio",confirm:"Desea borrar este sitio?",btnDelete:"Borrar",btnCancel:"Cancelar",success:"Se ha borrado el sitio.",error:"El sitio no puede borrarse. Por favor, intntelo ms tarde.",cancel:"No se ha borrado el objeto."}}},myviews:{title:"Mis vistas",edit:"Editar",publish:"Publicar",unpublish:"Despublicar","delete":"Borrar",grid:{name:"Nombre",description:"Descripcin",publish:"Publicado",edit:" ","delete":" "},popup:{edit:"Editar informacin de la vista",title:"Guardar vista",label:"Nombre de la vista:",name_placeholder:"Asignar un nombre a la vista",description_placeholder:"Asignar una descripcin a la vista",save:"Guardar",cancel:"Cancelar",error_noname:"Tipo de nombre",deletetitle:"Confirmar borrado",deletemsg:"Desea borrar esta vista?"},save:{success:"Se ha guardado la vista.",error_noname:"El nombre del campo no puede estar vaco.",error_illegalchars:"El nombre contiene caracteres no permitidos. Los caracteres permitidos son las letras entre a-z, los nmeros, los espacios y los guiones.",msg:{view_name:"El nombre de la vista"}},button:{ok:"Hecho",save:"Guardar",cancel:"Cancelar",toolbarsave:"Guardar vista"},error:{title:"Error!",generic:"Error del sistema! Por favor, intntelo ms tarde",notsaved:"No pudo guardarse la vista.",notdeleted:"No pudo borrarse la vista.",makePublic:"No pudo publicarse la vista. Por favor, intntelo ms tarde.",makePrivate:"No pudo despublicarse la vista. Por favor, intntelo ms tarde.",loadfailed:"No pudieron descargarse las vistas."}},publishedmaps:{title:"Mapas incorporados",show:"Mostrar en el mapa",edit:"Editar",publish:"Publicar mapa",unpublish:"Despublicar mapa","delete":"Borrar",grid:{name:"Nombre",domain:"Configuracin del mapa",publish:"Estado",show:" ",edit:" ","delete":" "},popup:{edit:"Cambiar el nombre del mapa",title:"Guardar mapa",label:"Nombre del mapa",placeholder:"Asignar un nombre al mapa",save:"Guardar",cancel:"Cancelar",error_noname:"Asignar un nombre al mapa",deletetitle:"Borrar el mapa?",deletemsg:"Desea borrar el mapa incorporado? No se mostrar ms en tu portal web.",showErrorTitle:"Vista incompleta",showConfirmMissing:"Algunas capas guardadas no estn disponibles. Aun as, quiere abrir esta vista?",showConfirmNotLoaded:"Algunas capas no se han cargado todava, intntelo ms tarde."},save:{success:"Se ha guardado el mapa.",error_noname:"El nombre del campo no puede estar vaco.",error_illegalchars:"El nombre contiene caracteres no permitidos. Los caracteres permitidos son las letras entre a-z, los nmeros, los espacios y los guiones.",msg:{view_name:"Nombre del mapa"}},button:{ok:"Hecho",save:"Guardar",cancel:"Cancelar",toolbarsave:"Guardar mapa"},error:{title:"Error!",generic:"Error del sistema! Por favor, intntelo ms tarde.",notsaved:"No pudo guardarse el mapa.",notdeleted:"No pudo borrarse el mapa.",makePublic:"No pudo publicarse el mapa. Por favor, intntelo ms tarde.",makePrivate:"No pudo despublicarse el mapa. Por favor, intntelo ms tarde."}},account:{title:"Mi cuenta",firstName:"Nombre",lastName:"Apellido",nickName:"Alias",email:"Correo electrnico",changeInfo:"Cambiar la informacin de su cuenta",changePassword:"Cambiar su contrasea",removeAccount:"Borrar su cuenta",changeInfoUrl:"/web/en/profile"}},button:{yes:"Si",no:"No"}}});Oskari.clazz.define("Oskari.lupapiste.bundle.myplaces2.MyPlacesBundle",function(){},{create:function(){return Oskari.clazz.create("Oskari.lupapiste.bundle.myplaces2.MyPlacesBundleInstance")},update:function(manager,bundle,bi,info){manager.alert("RECEIVED update notification "+info)}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/event/FinishedDrawingEvent.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/event/MyPlaceHoverEvent.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/event/MyPlacesChangedEvent.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/event/MyPlaceSelectedEvent.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/event/ActiveDrawingEvent.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/model/MyPlace.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/model/MyPlacesCategory.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/plugin/DrawPlugin.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/plugin/HoverPlugin.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/request/StopDrawingRequest.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/request/StartDrawingRequest.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/request/GetGeometryRequest.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/request/GetGeometryRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/request/StartDrawingRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/request/StopDrawingRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/request/EditPlaceRequest.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/request/EditCategoryRequest.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/request/DeleteCategoryRequest.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/request/PublishCategoryRequest.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/request/EditRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/service/MyPlacesService.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/service/MyPlacesWFSTStore.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/view/MainView.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/view/PlaceForm.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/view/CategoryForm.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/ButtonHandler.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/CategoryHandler.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/instance.js"},{type:"text/javascript",src:"../../../../libraries/jscolor/jscolor.js"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-myplaces2/locale/en.js"}]},bundle:{manifest:{"Bundle-Identifier":"lupapiste-myplaces2","Bundle-Name":"lupapiste-myplaces2","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","jquery"],"Import-Bundle":{}}},dependencies:["jquery"]});Oskari.bundle_manager.installBundleClass("lupapiste-myplaces2","Oskari.lupapiste.bundle.myplaces2.MyPlacesBundle");Oskari.clazz.define("Oskari.lupapiste.bundle.myplaces2.event.FinishedDrawingEvent",function(geometry,blnEdit){this._drawing=geometry;this._modification=blnEdit==!0},{__name:"LupaPisteMyPlaces.FinishedDrawingEvent",getName:function(){return this.__name},getDrawing:function(){return this._drawing},isModification:function(){return this._modification}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.lupapiste.myplaces2.event.MyPlaceHoverEvent",function(pLonlat,pEvent,zoomLevel){this._creator=null;this._lonlat=pLonlat;this._hoverEvent=pEvent;this._zoom=zoomLevel},{__name:"LupaPisteMyPlaces.MyPlaceHoverEvent",getName:function(){return this.__name},getHoverEvent:function(){return this._hoverEvent},getLonLat:function(){return this._lonlat},getZoomLevel:function(){return this._zoom}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.lupapiste.myplaces2.event.MyPlacesChangedEvent",function(){},{__name:"LupaPisteMyPlaces.MyPlacesChangedEvent",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.lupapiste.myplaces2.event.MyPlaceSelectedEvent",function(pMyPlace,dblClick){this._creator=null;this._myPlace=pMyPlace;this._dblClick=dblClick},{__name:"LupaPisteMyPlaces.MyPlaceSelectedEvent",getName:function(){return this.__name},getPlace:function(){return this._myPlace},isDblClick:function(){return this._dblClick}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.lupapiste.bundle.myplaces2.event.ActiveDrawingEvent",function(geometry,mode){this._drawing=geometry;this._drawMode=mode},{__name:"LupaPisteMyPlaces.ActiveDrawingEvent",getName:function(){return this.__name},getDrawing:function(){return this._drawing},getDrawMode:function(){return this._drawMode}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.lupapiste.bundle.myplaces2.model.MyPlace",function(){this.id=undefined;this.name=undefined;this.description=undefined;this.categoryID=undefined;this.geometry=undefined;this.link=undefined;this.createDate=undefined;this.updateDate=undefined;this.area=undefined;this.height=undefined;this.length=undefined},{setId:function(value){this.id=value},getId:function(){return this.id},setHeight:function(value){this.height=value},getHeight:function(){return this.height},setName:function(value){this.name=value},getName:function(){return this.name},setDescription:function(value){this.description=value},getDescription:function(){return this.description},setLink:function(value){this.link=value},getLink:function(){return this.link},setCategoryID:function(value){this.categoryID=value},getCategoryID:function(){return this.categoryID},setGeometry:function(value){this.geometry=value},getGeometry:function(){return this.geometry},setCreateDate:function(value){this.createDate=value},getCreateDate:function(){return this.createDate},setUpdateDate:function(value){this.updateDate=value},getUpdateDate:function(){return this.updateDate},setUUID:function(value){this.uuid=value},getUUID:function(){return this.uuid},setLength:function(value){this.length=value},getLength:function(){return this.length},setArea:function(value){this.area=value},getArea:function(){return this.area}});Oskari.clazz.define("Oskari.lupapiste.bundle.myplaces2.model.MyPlacesCategory",function(){this.id=undefined;this.name=undefined;this._isDefault=!1;this._isPublic=!1;this.lineWidth=1;this.lineColor="993300";this.areaLineWidth=1;this.areaLineColor="993300";this.areaFillColor="993300";this.dotSize=4;this.dotColor="993300";this.uuid=undefined},{setId:function(value){this.id=value},getId:function(){return this.id},setName:function(value){this.name=value},getName:function(){return this.name},setDefault:function(value){this._isDefault=value==!0},isDefault:function(){return this._isDefault==!0},setPublic:function(value){this._isPublic=value==!0},isPublic:function(){return this._isPublic==!0},setLineWidth:function(value){this.lineWidth=value},getLineWidth:function(){return this.lineWidth},setLineColor:function(value){this.lineColor=value},getLineColor:function(){return this.lineColor},setAreaLineWidth:function(value){this.areaLineWidth=value},getAreaLineWidth:function(){return this.areaLineWidth},setAreaLineColor:function(value){this.areaLineColor=value},getAreaLineColor:function(){return this.areaLineColor},setAreaFillColor:function(value){this.areaFillColor=value},getAreaFillColor:function(){return this.areaFillColor},setDotSize:function(value){this.dotSize=value},getDotSize:function(){return this.dotSize},setDotColor:function(value){this.dotColor=value},getDotColor:function(){return this.dotColor},setUUID:function(value){this.uuid=value},getUUID:function(){return this.uuid}});Oskari.clazz.define("Oskari.lupapiste.bundle.myplaces2.plugin.DrawPlugin",function(){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null;this.drawControls=null;this.drawLayer=null;this.editMode=!1;this.currentDrawMode=null},{__name:"LupaPisteMyPlaces.DrawPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(mapModule){this.mapModule=mapModule;this._map=mapModule.getMap();this.pluginName=mapModule.getName()+this.__name},startDrawing:function(params){if(params.isModify)this.modifyControls.select.select(this.drawLayer.features[0]);else if(this.drawLayer.destroyFeatures(),params.geometry){this.editMode=!0;var features=[new OpenLayers.Feature.Vector(params.geometry)];this.drawLayer.addFeatures(features);this.modifyControls.select.select(this.drawLayer.features[0])}else this.editMode=!1,this.toggleControl(params.drawMode)},stopDrawing:function(){this.toggleControl();this.drawLayer.destroyFeatures();var map=this._sandbox.findRegisteredModuleInstance("MainMapModule").getMap(),layer=map.getLayersByName("LupapisteVectors")[0];layer.redraw();this.modifyControls.modify.unselectFeature()},forceFinishDraw:function(){try{this.drawControls[this.currentDrawMode].finishSketch()}catch(error){this.stopDrawing();var event=this._sandbox.getEventBuilder("LupaPisteMyPlaces.MyPlaceSelectedEvent")();this._sandbox.notifyAll(event)}},finishedDrawing:function(){if(this.toggleControl(),!this.editMode){this.modifyControls.select.select(this.drawLayer.features[0]);var event=this._sandbox.getEventBuilder("LupaPisteMyPlaces.FinishedDrawingEvent")(this.getDrawing(),this.editMode);this._sandbox.notifyAll(event)}},toggleControl:function(drawMode){var key,control;this.currentDrawMode=drawMode;for(key in this.drawControls)control=this.drawControls[key],drawMode==key?control.activate():control.deactivate()},init:function(sandbox){var me=this,key;this.requestHandlers={startDrawingHandler:Oskari.clazz.create("Oskari.lupapiste.bundle.myplaces2.request.StartDrawingRequestPluginHandler",sandbox,me),stopDrawingHandler:Oskari.clazz.create("Oskari.lupapiste.bundle.myplaces2.request.StopDrawingRequestPluginHandler",sandbox,me),getGeometryHandler:Oskari.clazz.create("Oskari.lupapiste.bundle.myplaces2.request.GetGeometryRequestPluginHandler",sandbox,me)};this.drawLayer=new OpenLayers.Layer.Vector("MyPlaces Draw Layer",{eventListeners:{featuresadded:function(){me.finishedDrawing()},vertexmodified:function(){me._sendActiveGeometry(me.getDrawing())}}});this.drawControls={point:new OpenLayers.Control.DrawFeature(me.drawLayer,OpenLayers.Handler.Point),line:new OpenLayers.Control.DrawFeature(me.drawLayer,OpenLayers.Handler.Path,{callbacks:{modify:function(geom,feature){me._sendActiveGeometry(feature.geometry,"line")}}}),area:new OpenLayers.Control.DrawFeature(me.drawLayer,OpenLayers.Handler.Polygon,{callbacks:{modify:function(geom,feature){me._sendActiveGeometry(feature.geometry,"area")}}}),box:new OpenLayers.Control.DrawFeature(me.drawLayer,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:4,irregular:!0}}),circle:new OpenLayers.Control.DrawFeature(me.drawLayer,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:40,irregular:!1}}),ellipse:new OpenLayers.Control.DrawFeature(me.drawLayer,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:40,irregular:!0}})};this.modifyControls={modify:new OpenLayers.Control.ModifyFeature(me.drawLayer,{standalone:!0})};this.modifyControls.select=new OpenLayers.Control.SelectFeature(me.drawLayer,{geometryTypes:this.modifyControls.modify.geometryTypes,clickout:this.modifyControls.modify.clickout,toggle:this.modifyControls.modify.toggle,onBeforeSelect:this.modifyControls.modify.beforeSelectFeature,onSelect:this.modifyControls.modify.selectFeature,onUnselect:this.modifyControls.modify.unselectFeature,scope:this.modifyControls.modify});this._map.addLayers([me.drawLayer]);for(key in this.drawControls)this._map.addControl(this.drawControls[key]);for(key in this.modifyControls)this._map.addControl(this.modifyControls[key]);this.modifyControls.modify.activate()},getDrawing:function(){return this.drawLayer.features.length===0?null:this.drawLayer.features[0].geometry},_sendActiveGeometry:function(geometry,drawMode){var eventBuilder=this._sandbox.getEventBuilder("LupaPisteMyPlaces.ActiveDrawingEvent"),event,featClass;if(drawMode==null){featClass=geometry.CLASS_NAME;switch(featClass){case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.MultiLineString":drawMode="line";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.MultiPolygon":drawMode="area";break;default:return}}eventBuilder&&(event=eventBuilder(geometry,drawMode),this._sandbox.notifyAll(event))},register:function(){},unregister:function(){},startPlugin:function(sandbox){this._sandbox=sandbox;sandbox.register(this);sandbox.addRequestHandler("LupaPisteMyPlaces.StartDrawingRequest",this.requestHandlers.startDrawingHandler);sandbox.addRequestHandler("LupaPisteMyPlaces.StopDrawingRequest",this.requestHandlers.stopDrawingHandler);sandbox.addRequestHandler("LupaPisteMyPlaces.GetGeometryRequest",this.requestHandlers.getGeometryHandler)},stopPlugin:function(sandbox){sandbox.removeRequestHandler("LupaPisteMyPlaces.StartDrawingRequest",this.requestHandlers.startDrawingHandler);sandbox.removeRequestHandler("LupaPisteMyPlaces.StopDrawingRequest",this.requestHandlers.stopDrawingHandler);sandbox.removeRequestHandler("LupaPisteMyPlaces.GetGeometryRequest",this.requestHandlers.getGeometryHandler);sandbox.unregister(this);this._map=null;this._sandbox=null},start:function(){},stop:function(){}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.lupapiste.bundle.myplaces2.plugin.HoverPlugin",function(){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null},{__name:"LupaPisteMyPlaces.HoverPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(mapModule){this.mapModule=mapModule;this._map=mapModule.getMap();this.pluginName=mapModule.getName()+this.__name},init:function(sandbox){var me=this;OpenLayers.Control.Hover=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{delay:500,pixelTolerance:null,stopMove:!1},initialize:function(){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions);OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.Hover(this,{pause:this.onPause,move:this.onMove},this.handlerOptions)},onPause:function(){},onMove:function(){}});this.hoverControl=new OpenLayers.Control.Hover({handlerOptions:{delay:500,pixelTolerance:6},onPause:function(evt){var lonlat=me._map.getLonLatFromPixel(evt.xy),event=sandbox.getEventBuilder("LupaPisteMyPlaces.MyPlaceHoverEvent")(lonlat,evt,me._map.getZoom());sandbox.notifyAll(event)}});this._map.addControl(this.hoverControl)},activate:function(){this.hoverControl.activate()},deactivate:function(){this.hoverControl.deactivate()},register:function(){},unregister:function(){},startPlugin:function(sandbox){this._sandbox=sandbox;sandbox.register(this)},stopPlugin:function(sandbox){sandbox.unregister(this);this._map=null;this._sandbox=null},start:function(){},stop:function(){}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.myplaces.request.StopDrawingRequest",function(isCancel){this._creator=null;this._isCancel=isCancel==!0},{__name:"LupaPisteMyPlaces.StopDrawingRequest",getName:function(){return this.__name},isCancel:function(){return this._isCancel===!0}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.lupapiste.bundle.myplaces2.request.StartDrawingRequest",function(config){if(config.geometry)this._geometry=config.geometry;else if(config.continueCurrent)this._continueCurrent=config.continueCurrent;else{if(!this.drawModes[config.drawMode])throw"Unknown draw mode '"+config.drawMode+"'";this._drawMode=config.drawMode}},{__name:"LupaPisteMyPlaces.StartDrawingRequest",getName:function(){return this.__name},isModify:function(){return this._continueCurrent?!0:!1},drawModes:{point:"point",line:"line",area:"area",box:"box",circle:"circle",ellipse:"ellipse"},getDrawMode:function(){return this._drawMode},getGeometry:function(){return this._geometry}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.lupapiste.bundle.myplaces2.request.GetGeometryRequest",function(callbackMethod){this._creator=null;this._callbackMethod=callbackMethod},{__name:"LupaPisteMyPlaces.GetGeometryRequest",getName:function(){return this.__name},getCallBack:function(){return this._callbackMethod}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.lupapiste.bundle.myplaces2.request.GetGeometryRequestPluginHandler",function(sandbox,drawPlugin){this.sandbox=sandbox;this.drawPlugin=drawPlugin},{handleRequest:function(core,request){var callBack=request.getCallBack(),drawing;this.sandbox.printDebug("[Oskari.lupapiste.bundle.myplaces2.request.GetGeometryRequestPluginHandler] geometry requested");drawing=this.drawPlugin.getDrawing();callBack(drawing.geometry)}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.lupapiste.bundle.myplaces2.request.StartDrawingRequestPluginHandler",function(sandbox,drawPlugin){this.sandbox=sandbox;this.drawPlugin=drawPlugin},{handleRequest:function(core,request){var drawMode=request.getDrawMode();this.sandbox.printDebug("[Oskari.lupapiste.bundle.myplaces2.request.StartDrawingRequestPluginHandler] Start Drawing: "+drawMode);this.drawPlugin.startDrawing({drawMode:request.getDrawMode(),geometry:request.getGeometry(),isModify:request.isModify(),style:""})}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.lupapiste.bundle.myplaces2.request.StopDrawingRequestPluginHandler",function(sandbox,drawPlugin){this.sandbox=sandbox;this.drawPlugin=drawPlugin},{handleRequest:function(core,request){this.sandbox.printDebug("[Oskari.lupapiste.bundle.myplaces2.request.StopDrawingRequestPluginHandler] Stop drawing");request.isCancel()?this.drawPlugin.stopDrawing():this.drawPlugin.forceFinishDraw()}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.lupapiste.bundle.myplaces2.request.EditPlaceRequest",function(placeId){this._placeId=placeId},{__name:"LupaPisteMyPlaces.EditPlaceRequest",getName:function(){return this.__name},getId:function(){return this._placeId}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.lupapiste.bundle.myplaces2.request.EditCategoryRequest",function(categoryId){this._categoryId=categoryId},{__name:"LupaPisteMyPlaces.EditCategoryRequest",getName:function(){return this.__name},getId:function(){return this._categoryId}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.lupapiste.bundle.myplaces2.request.DeleteCategoryRequest",function(categoryId){this._categoryId=categoryId},{__name:"LupaPisteMyPlaces.DeleteCategoryRequest",getName:function(){return this.__name},getId:function(){return this._categoryId}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.lupapiste.bundle.myplaces2.request.PublishCategoryRequest",function(categoryId,isPublic){this._categoryId=categoryId;this._isPublic=isPublic==!0},{__name:"LupaPisteMyPlaces.PublishCategoryRequest",getName:function(){return this.__name},getId:function(){return this._categoryId},isPublic:function(){return this._isPublic}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.lupapiste.bundle.myplaces2.request.EditRequestHandler",function(sandbox,instance){this.sandbox=sandbox;this.instance=instance},{handleRequest:function(core,request){var sandbox=core.getSandbox();request.getName()==="LupaPisteMyPlaces.EditPlaceRequest"?this._handleEditPlace(sandbox,request):request.getName()==="LupaPisteMyPlaces.EditCategoryRequest"?this._handleEditCategory(sandbox,request):request.getName()==="LupaPisteMyPlaces.DeleteCategoryRequest"?this._handleDeleteCategory(sandbox,request):request.getName()==="LupaPisteMyPlaces.PublishCategoryRequest"&&this._handlePublishCategory(sandbox,request)},_handleEditPlace:function(sandbox,request){var service,place,center,location;this.sandbox.printDebug("[Oskari.lupapiste.bundle.myplaces2.request.EditRequestHandler] edit requested for place "+request.getId());service=this.instance.getService();place=service.findMyPlace(request.getId());place&&(center=place.getGeometry().getCentroid(),location={lon:center.x,lat:center.y},this.instance.getDrawPlugin().startDrawing({geometry:place.getGeometry()}),this.instance.getMainView().showPlaceForm(location,place))},_handleEditCategory:function(sandbox,request){this.sandbox.printDebug("[Oskari.lupapiste.bundle.myplaces2.request.EditRequestHandler] edit requested for category "+request.getId());var service=this.instance.getService(),category=service.findCategory(request.getId());category&&this.instance.getCategoryHandler().editCategory(category)},_handleDeleteCategory:function(sandbox,request){this.sandbox.printDebug("[Oskari.lupapiste.bundle.myplaces2.request.EditRequestHandler] delete requested for category "+request.getId());var service=this.instance.getService(),category=service.findCategory(request.getId());category&&this.instance.getCategoryHandler().confirmDeleteCategory(category)},_handlePublishCategory:function(sandbox,request){this.sandbox.printDebug("[Oskari.lupapiste.bundle.myplaces2.request.EditRequestHandler] (un/)publish requested for category "+request.getId());var service=this.instance.getService(),category=service.findCategory(request.getId());category&&this.instance.getCategoryHandler().confirmPublishCategory(category,request.isPublic())}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.lupapiste.bundle.myplaces2.service.MyPlacesService",function(url,uuid,sandbox,defaultName,pInstance){this._categoryList=[];this._placesList=[];this.wfstStore=Oskari.clazz.create("Oskari.lupapiste.bundle.myplaces2.service.MyPlacesWFSTStore",url,uuid);this._sandbox=sandbox;this.defaultCategory=null;this.defaultCategoryName=defaultName;this._instance=pInstance},{__qname:"Oskari.lupapiste.bundle.myplaces2.service.MyPlacesService",getQName:function(){return this.__qname},__name:"MyPlacesService",getName:function(){return this.__name},init:function(){var me=this;this.wfstStore.connect();var loadedCategories=!1,loadedPlaces=!1,initialLoadCallBackCategories=function(categories){if(categories)for(var i=0;i<categories.length;++i)me._addCategory(categories[i]);loadedCategories=!0;me.getDefaultCategory()?loadedPlaces&&me._notifyDataChanged():me._createDefaultCategory()},initialLoadCallBackPlaces=function(places){places&&(me._placesList=places);loadedPlaces=!0;loadedCategories&&me._notifyDataChanged()};this.wfstStore.getCategories(initialLoadCallBackCategories);this.wfstStore.getMyPlaces(initialLoadCallBackPlaces)},_createDefaultCategory:function(){var me=this,defaultCategory=Oskari.clazz.create("Oskari.lupapiste.bundle.myplaces2.model.MyPlacesCategory"),defaultCategoryCreationCallback;defaultCategory.setDefault(!0);defaultCategory.setName("Lupapiste");defaultCategoryCreationCallback=function(){me.getAllCategories().length===0?me._instance.forceDisable():me._notifyDataChanged()};this.saveCategory(defaultCategory,defaultCategoryCreationCallback)},_addCategory:function(categoryModel){categoryModel.isDefault()&&(this.defaultCategory=categoryModel);this._categoryList.push(categoryModel)},_movePlacesToCategory:function(oldCategoryId,newCategoryId,callback){var me=this,placesInDeleteCategory=this.getPlacesInCategory(oldCategoryId),i,callBackWrapper;if(placesInDeleteCategory.length==0){callback(!0);return}for(i=0;i<placesInDeleteCategory.length;i++)placesInDeleteCategory[i].setCategoryID(newCategoryId);callBackWrapper=function(success){me._notifyDataChanged();callback(success)};this.wfstStore.commitMyPlaces(placesInDeleteCategory,callBackWrapper)},_deletePlacesInCategory:function(categoryId,callback){for(var me,callBackWrapper,placesInDeleteCategory=this.getPlacesInCategory(categoryId),idList=[],i=0;i<placesInDeleteCategory.length;i++)idList.push(placesInDeleteCategory[i].getId());if(idList.length==0){callback(!0);return}me=this;callBackWrapper=function(success,list){if(success){for(var i=0;i<placesInDeleteCategory.length;i++)me._removeMyPlace(list[i]);me._notifyDataChanged()}callback(success)};this.wfstStore.deleteMyPlaces(idList,callBackWrapper)},parseDate:function(dateStr){var splitted;if(!dateStr||dateStr.length<10)return[];var year=dateStr.substring(0,4),month=dateStr.substring(5,7),day=dateStr.substring(8,10),returnValue=[day+"."+month+"."+year],time="";if(dateStr.length==29){time=dateStr.substring(11);splitted=time.split("+");time=splitted[0];time=time.split(".")[0];var timeComps=time.split(":"),hour=timeComps[0],min=timeComps[1],sec=timeComps[2];time=hour+":"+min+":"+sec;returnValue.push(time)}return returnValue},getPlacesInCategory:function(categoryId){for(var placesInCategory=[],i=0;i<this._placesList.length;i++)this._placesList[i].getCategoryID()==categoryId&&placesInCategory.push(this._placesList[i]);return placesInCategory},deleteCategory:function(categoryId,movePlacesToDefault,callback){var me=this,callBackWrapper=function(success){success?me._deleteEmptyCategory(categoryId,callback):callback(success)},defaultCategory;movePlacesToDefault===!0?(defaultCategory=me.getDefaultCategory(),me._movePlacesToCategory(categoryId,defaultCategory.getId(),callBackWrapper)):me._deletePlacesInCategory(categoryId,callBackWrapper)},_deleteEmptyCategory:function(categoryId,callback){var me=this,callBackWrapper=function(success,list){success&&me._removeCategory(list[0]);callback(success);me._notifyDataChanged()};this.wfstStore.deleteCategories([categoryId],callBackWrapper)},_removeCategory:function(categoryId){for(var i=0;i<this._categoryList.length;i++)if(this._categoryList[i].getId()==categoryId){this._categoryList.splice(i,1);break}},saveCategory:function(categoryModel,callback){var me=this,isNew=!categoryModel.getId(),callBackWrapper=function(success,list){if(isNew&&success)me._addCategory(list[0]);else{var category=me.findCategory(list[0].getId());category?(category.setName(categoryModel.getName()),category.setDotSize(categoryModel.getDotSize()),category.setDotColor(categoryModel.getDotColor()),category.setLineWidth(categoryModel.getLineWidth()),category.setLineColor(categoryModel.getLineColor()),category.setAreaLineWidth(categoryModel.getAreaLineWidth()),category.setAreaLineColor(categoryModel.getAreaLineColor()),category.setAreaFillColor(categoryModel.getAreaFillColor())):success=!1}me._notifyDataChanged();callback(success,list[0],isNew)};this.wfstStore.commitCategories([categoryModel],callBackWrapper)},getAllCategories:function(){return this._categoryList},getDefaultCategory:function(){return this.defaultCategory},_addMyPlace:function(myplaceModel){var id,i;if(!myplaceModel.getId()){for(id=0,i=0;i<this._placesList.length;++i)this._placesList[i].getId()>id&&(id=this._placesList[i].getId());myplaceModel.setId(id+1)}this._placesList.push(myplaceModel)},_removeMyPlace:function(placeId){var index=this.findBy(this._placesList,"id",placeId);index!==-1&&this._placesList.splice(index,1)},_notifyDataChanged:function(){var event=this._sandbox.getEventBuilder("LupaPisteMyPlaces.MyPlacesChangedEvent")();this._sandbox.notifyAll(event)},deleteMyPlace:function(placeId,callback){var me=this,callBackWrapper=function(success,list){success&&(me._removeMyPlace(list[0]),me._notifyDataChanged());callback(success,list[0])};this.wfstStore.deleteMyPlaces([placeId],callBackWrapper);var sandbox=Oskari.$("sandbox"),eventBuilder=sandbox.getEventBuilder("Lupapiste.PlaceSaved"),event=eventBuilder(me.getAllMyPlaces());sandbox.notifyAll(event)},findMyPlaceByLonLat:function(lonlat,zoom){for(var olGeometry,hoverOnPlace,tolerance,places=[],myPlacesList=this.getAllMyPlaces(),i=0;i<myPlacesList.length;++i)olGeometry=myPlacesList[i].getGeometry(),hoverOnPlace=!1,"OpenLayers.Geometry.Point"===olGeometry.CLASS_NAME?(tolerance=720-zoom*zoom*5,zoom>10?tolerance=5:zoom>8?tolerance=20:zoom>5&&(tolerance=50),hoverOnPlace=olGeometry.atPoint(lonlat,tolerance,tolerance)):hoverOnPlace=olGeometry.atPoint(lonlat),hoverOnPlace&&places.push(myPlacesList[i]);return places},findMyPlace:function(id){var index=this.findBy(this._placesList,"id",id);return index!==-1?this._placesList[index]:null},findCategory:function(id){var index=this.findBy(this._categoryList,"id",id);return index!==-1?this._categoryList[index]:null},findBy:function(list,attrName,attrValue){for(var i=0;i<list.length;i++)if(list[i][attrName]===attrValue)return i;return-1},saveMyPlace:function(myplaceModel,callback){var me=this,isNew=!myplaceModel.getId(),callBackWrapper=function(success,list){if(isNew&&success)me._addMyPlace(list[0]);else{var myplace=me.findMyPlace(list[0].getId());myplace?(myplace.setName(myplaceModel.getName()),myplace.setDescription(myplaceModel.getDescription()),myplace.setLink(myplaceModel.getLink()),myplace.setCategoryID(myplaceModel.getCategoryID()),myplace.setGeometry(myplaceModel.getGeometry()),myplace.setUpdateDate(list[0].getUpdateDate()),myplace.setArea(myplaceModel.getArea()),myplace.setHeight(myplaceModel.getHeight()),myplace.setLength(myplaceModel.getLength)):success=!1}me._notifyDataChanged();callback(success,list[0],isNew)};this.wfstStore.commitMyPlaces([myplaceModel],callBackWrapper);var sandbox=Oskari.$("sandbox"),eventBuilder=sandbox.getEventBuilder("Lupapiste.PlaceSaved"),event=eventBuilder(me.getAllMyPlaces());sandbox.notifyAll(event)},saveMyPlaces:function(places,cb){var me=this,callback=function(success,list){if(success)for(ix in list){var item=list[ix];me._addMyPlace(item)}me._notifyDataChanged();_.isFunction(cb)&&cb(success,list)};this.wfstStore.commitMyPlaces(places,callback);var sandbox=this._sandbox,eventBuilder=sandbox.getEventBuilder("Lupapiste.PlaceSaved"),event=eventBuilder(me.getAllMyPlaces());sandbox.notifyAll(event)},getAllMyPlaces:function(){return this._placesList},publishCategory:function(categoryId,makePublic,callback){var category=this.findCategory(categoryId),me,ajaxUrl;category||callback(!1);me=this;ajaxUrl=this._sandbox.getAjaxUrl()}},{protocol:["Oskari.mapframework.service.Service"]});Oskari.clazz.define("Oskari.lupapiste.bundle.myplaces2.service.MyPlacesWFSTStore",function(url,uuid){this.uuid=uuid;this.protocols={};this.url=url},{connect:function(){var url=this.url;this.protocols.categories=new OpenLayers.Protocol.WFS({version:"1.1.0",srsName:"EPSG:3067",featureType:"categories",featureNS:"http://www.paikkatietoikkuna.fi",url:url});this.protocols.my_places=new OpenLayers.Protocol.WFS({version:"1.1.0",srsName:"EPSG:3067",geometryName:"geometry",featureType:"my_places",featureNS:"http://www.paikkatietoikkuna.fi",url:url})},getCategories:function(cb){var list=[],category=Oskari.clazz.create("Oskari.lupapiste.bundle.myplaces2.model.MyPlacesCategory");category.setId("123");category.setDefault(!0);category.setName("Lupapiste");category.setUUID("1234");list.push(category);cb&&cb(list)},_handleCategoriesResponse:function(response,cb){var uuid=this.uuid,feats=response.features,list,n;if(feats==null||feats.length==0){cb&&cb();return}for(list=[],n=0;n<feats.length;n++){var f=feats[n],featAtts=f.attributes,id=this._parseNumericId(f.fid),category=Oskari.clazz.create("Oskari.lupapiste.bundle.myplaces2.model.MyPlacesCategory");category.setId(id);category.setDefault("true"===featAtts["default"]);category.setName(featAtts.category_name);category.setLineWidth(featAtts.stroke_width);category.setLineColor(this._formatColorFromServer(featAtts.stroke_color));category.setAreaLineWidth(featAtts.border_width);category.setAreaLineColor(this._formatColorFromServer(featAtts.border_color));category.setAreaFillColor(this._formatColorFromServer(featAtts.fill_color));category.setDotColor(this._formatColorFromServer(featAtts.dot_color));category.setDotSize(featAtts.dot_size);category.setUUID(uuid);featAtts.publisher_name&&category.setPublic(!0);list.push(category)}cb&&cb(list)},_formatColorFromServer:function(color){return color.charAt(0)=="#"?color.substring(1):color},_prefixColorForServer:function(color){return color.charAt(0)!="#"?"#"+color:color},commitCategories:function(list){for(var uuid=this.uuid,p=this.protocols.categories,me=this,features=[],l=0;l<list.length;l++){var m=list[l],m_id=m.getId(),featAtts={category_name:m.getName(),"default":m.isDefault(),stroke_width:m.getLineWidth(),stroke_color:this._prefixColorForServer(m.getLineColor()),border_width:m.getAreaLineWidth(),border_color:this._prefixColorForServer(m.getAreaLineColor()),fill_color:this._prefixColorForServer(m.getAreaFillColor()),dot_color:this._prefixColorForServer(m.getDotColor()),dot_size:m.getDotSize(),uuid:uuid},feat=new OpenLayers.Feature.Vector(null,featAtts);m_id?(feat.fid=p.featureType+"."+m_id,feat.state=OpenLayers.State.UPDATE):feat.toState(OpenLayers.State.INSERT);features.push(feat)}},_handleCommitCategoriesResponse:function(response,list,cb){var i,len,id;if(response.success()){var features=response.reqFeatures,state,feature,insertIds=response.insertIds||[];for(i=0,len=features.length;i<len;++i)feature=features[i],state=feature.state,state&&(state==OpenLayers.State.INSERT&&(feature.fid=insertIds[i],feature.attributes.id=feature.fid,id=this._parseNumericId(feature.fid),list[i].setId(id)),feature.state=null);cb(!0,list)}else cb(!1,list)},deleteCategories:function(list,callback){for(var m_id,featAtts,feat,me,p=this.protocols.categories,uuid=this.uuid,features=[],l=0;l<list.length;l++)(m_id=list[l],m_id)&&(featAtts={uuid:uuid},feat=new OpenLayers.Feature.Vector(null,featAtts),feat.fid=p.featureType+"."+m_id,feat.state=OpenLayers.State.DELETE,features.push(feat));me=this;p.commit(features,{callback:function(response){me._handleDeleteCategoriesResponse(response,list,callback)}})},_handleDeleteCategoriesResponse:function(response,list,cb){response.success()?cb(!0,list):cb(!1,list)},_parseNumericId:function(geoserverFid){return geoserverFid.split(".")[1]},getMyPlaces:function(){var uuid=this.uuid,uuidFilter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"uuid",value:uuid}),p=this.protocols.my_places,me=this},_handleMyPlacesResponse:function(response,cb){var uuid=this.uuid,feats=response.features,list,n;if(feats==null||feats.length==0){cb&&cb();return}for(list=[],n=0;n<feats.length;n++){var f=feats[n],featAtts=f.attributes,id=this._parseNumericId(f.fid),place=Oskari.clazz.create("Oskari.lupapiste.bundle.myplaces2.model.MyPlace");place.setId(id);place.setName(featAtts.name);place.setDescription(featAtts.place_desc);place.setHeight(featAtts.height);place.setLink(featAtts.link);place.setCategoryID(featAtts.category_id);place.setCreateDate(featAtts.created);place.setUpdateDate(featAtts.updated);place.setGeometry(f.geometry);place.setUUID(uuid);place.setArea(featAtts.area);place.setLength(featAtts.length);list.push(place)}cb&&cb(list)},getMyPlacesByIdList:function(idList){var uuid=this.uuid,p=this.protocols.my_places,filter=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"uuid",value:uuid}),new OpenLayers.Filter.FeatureId({fids:idList})]}),me=this},commitMyPlaces:function(list,callback){for(var me,p=this.protocols.my_places,uuid=this.uuid,features=[],l=0;l<list.length;l++){var m=list[l],m_id=m.getId(),geom=m.getGeometry(),featAtts={name:m.getName(),place_desc:m.getDescription(),link:m.getLink(),category_id:m.getCategoryID(),height:m.getHeight(),area:m.getArea(),length:m.getLength(),uuid:uuid},feat=new OpenLayers.Feature.Vector(geom,featAtts);m_id?(feat.fid=p.featureType+"."+m_id,feat.state=OpenLayers.State.UPDATE):feat.toState(OpenLayers.State.INSERT);features.push(feat)}me=this;callback(!0,list)},_handleCommitMyPlacesResponse:function(response,list,cb){var i,len,id,modelUpdateCb;if(response.success()){var features=response.reqFeatures,state,feature,insertIds=response.insertIds||[],formattedIdList=[];for(i=0,len=features.length;i<len;++i)feature=features[i],state=feature.state,state&&(state==OpenLayers.State.INSERT?(feature.fid=insertIds[i],feature.attributes.id=feature.fid,id=this._parseNumericId(feature.fid),list[i].setId(id),formattedIdList.push(id)):formattedIdList.push(list[i].getId()),feature.state=null);modelUpdateCb=function(pList){cb(!0,pList)};this.getMyPlacesByIdList(formattedIdList,modelUpdateCb)}else cb(!1,list)},deleteMyPlaces:function(list,callback){for(var m_id,featAtts,feat,me,p=this.protocols.my_places,uuid=this.uuid,features=[],l=0;l<list.length;l++)(m_id=list[l],m_id)&&(featAtts={uuid:uuid},feat=new OpenLayers.Feature.Vector(null,featAtts),feat.fid=p.featureType+"."+m_id,feat.state=OpenLayers.State.DELETE,features.push(feat));me=this;callback(!0,list)},_handleDeleteMyPlacesResponse:function(response,list,cb){response.success()?cb(!0,list):cb(!1,list)},disconnect:function(){}});Oskari.clazz.define("Oskari.lupapiste.bundle.myplaces2.view.MainView",function(instance){this.instance=instance;this.popupId="myplacesForm";this.form=undefined},{__name:"MyPlacesMainView",getName:function(){return this.__name},getSandbox:function(){return this.instance.sandbox},init:function(){},start:function(){var me=this,sandbox=this.instance.sandbox,mapModule,drawPlugin;sandbox.register(me);for(p in me.eventHandlers)sandbox.registerForEventByName(me,p);mapModule=sandbox.findRegisteredModuleInstance("MainMapModule");drawPlugin=Oskari.clazz.create("Oskari.lupapiste.bundle.myplaces2.plugin.DrawPlugin");mapModule.registerPlugin(drawPlugin);mapModule.startPlugin(drawPlugin);this.drawPlugin=drawPlugin},stop:function(){var sandbox=this.instance.sandbox;for(p in this.eventHandlers)sandbox.unregisterFromEventByName(this,p);sandbox.unregister(this)},onEvent:function(event){var handler=this.eventHandlers[event.getName()];if(handler)return handler.apply(this,[event])},eventHandlers:{"Toolbar.ToolSelectedEvent":function(){this._cleanupPopup()},"LupaPisteMyPlaces.FinishedDrawingEvent":function(event){this._handleFinishedDrawingEvent(event)},"LupaPisteMyPlaces.MyPlaceSelectedEvent":function(event){if(event.getPlace()!=null){var sandbox=this.instance.sandbox,request=sandbox.getRequestBuilder("LupaPisteMyPlaces.EditPlaceRequest")(event.getPlace());sandbox.request(this.getName(),request)}}},_handleFinishedDrawingEvent:function(event){var center=event.getDrawing().getCentroid(),lonlat={lon:center.x,lat:center.y};this.showPlaceForm(lonlat)},showPlaceForm:function(location,place){var me=this,sandbox=this.instance.sandbox,loc,content,i,currentForm,request;sandbox.postRequestByName("DisableMapKeyboardMovementRequest");loc=this.instance.getLocalization();this.form=Oskari.clazz.create("Oskari.lupapiste.bundle.myplaces2.view.PlaceForm",this.instance);var categories=this.instance.getService().getAllCategories(),drawing=this.drawPlugin.getDrawing(),param=null;if(drawing instanceof OpenLayers.Geometry.Polygon&&(param={place:{area:Math.round(drawing.getArea())}},this.form.setValues(param)),drawing instanceof OpenLayers.Geometry.LineString&&(param={place:{length:Math.round(drawing.getLength())}},this.form.setValues(param)),place&&(param={place:{id:place.getId(),name:place.getName(),link:place.getLink(),desc:place.getDescription(),category:place.getCategoryID(),area:place.getArea(),height:place.getHeight(),length:place.getLength()}},this.form.setValues(param)),content=[{html:me.form.getForm(categories),useButtons:!0,primaryButton:loc.buttons.save,actions:{}}],!(drawing instanceof OpenLayers.Geometry.Polygon))for(i=0;i<content.length;++i)currentForm=content[i].html,currentForm.find("input[name=area]").parent().css("display","none"),currentForm.find("input[name=placewidth]").parent().css("display","block");if(!(drawing instanceof OpenLayers.Geometry.LineString))for(i=0;i<content.length;++i)currentForm=content[i].html,currentForm.find("input[name=length]").parent().css("display","none");content[0].actions[loc.buttons.cancel]=function(){me._cleanupPopup();var toolbarRequest=me.instance.sandbox.getRequestBuilder("Toolbar.SelectToolButtonRequest")();me.instance.sandbox.request(me,toolbarRequest)};content[0].actions[loc.buttons.save]=function(){me._saveForm()};place&&(content[0].actions[loc.buttons.deleteButton]=function(){me._deletePlace()});request=sandbox.getRequestBuilder("InfoBox.ShowInfoBoxRequest")(this.popupId,loc.placeform.title,content,location,!0);sandbox.request(me.getName(),request)},_validateForm:function(values){var errors=[],categoryHandler=this.instance.getCategoryHandler(),errors=categoryHandler.validateCategoryFormValues(values.category),loc=this.instance.getLocalization("validation");return values.place.name?categoryHandler.hasIllegalChars(values.place.name)&&errors.push({name:"name",error:loc.placeNameIllegal}):errors.push({name:"name",error:loc.placeName}),categoryHandler.hasIllegalChars(values.place.desc)&&errors.push({name:"desc",error:loc.descIllegal}),isNaN(values.place.height)&&errors.push({name:"height",error:loc.heightNotANumber}),isNaN(values.place.length)&&errors.push({name:"length",error:loc.lengthNotANumber}),values.place.width.length>0&&(isNaN(values.place.width)||parseFloat(values.place.width)<0)&&errors.push({name:"width",error:loc.widthNotANumber}),errors},_showValidationErrorMessage:function(errors){for(var row,loc=this.instance.getLocalization(),dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup"),okBtn=dialog.createCloseButton(loc.buttons.ok),content=jQuery("<ul><\/ul>"),i=0;i<errors.length;++i)row=jQuery("<li><\/li>"),row.append(errors[i].error),content.append(row);dialog.show(loc.validation.title,content,[okBtn])},_saveForm:function(){var me,formValues,errors,category,serviceCallback;if(this.form){if(me=this,formValues=this.form.getValues(),typeof formValues.place.height!="undefined"&&(formValues.place.height=formValues.place.height.replace(",",".")),errors=this._validateForm(formValues),errors.length!=0){this._showValidationErrorMessage(errors);return}formValues.category?(category=this.instance.getCategoryHandler().getCategoryFromFormValues(formValues.category),serviceCallback=function(blnSuccess,model,blnNew){if(blnSuccess)formValues.place.category=model.getId(),me.__savePlace(formValues.place);else{var loc=me.instance.getLocalization("notification").error;blnNew?me.instance.showMessage(loc.error.title,loc.error.addCategory):me.instance.showMessage(loc.error.title,loc.error.editCategory)}},this.instance.getService().saveCategory(category,serviceCallback)):this.__savePlace(formValues.place)}},__savePlace:function(values){var me=this,loc,place,oldCategory,drawnGeometry,sandbox,serviceCallback;if(!values){loc=me.instance.getLocalization("notification").error;me.instance.showMessage(loc.title,loc.savePlace);return}if(place=Oskari.clazz.create("Oskari.lupapiste.bundle.myplaces2.model.MyPlace"),oldCategory=-1,values.id&&(place=this.instance.getService().findMyPlace(values.id),oldCategory=place.getCategoryID()),place.setId(values.id),place.setName(values.name),place.setLink(values.link),place.setDescription(values.desc),place.setCategoryID(values.category),place.setArea(values.area),place.setHeight(values.height),place.setLength(values.length),drawnGeometry=this.drawPlugin.getDrawing(),place.setGeometry(drawnGeometry),values.width.length>0&&!isNaN(values.width)&&parseFloat(values.width)>0){var jsts_parser=new jsts.io.OpenLayersParser,geom=jsts_parser.read(drawnGeometry),quadrantSegments=undefined,endCapStyle=geom instanceof jsts.geom.Point?jsts.operation.buffer.BufferParameters.CAP_ROUND:jsts.operation.buffer.BufferParameters.CAP_FLAT,jsts_result_geom=geom.buffer(parseFloat(values.width)/2,quadrantSegments,endCapStyle),buffered=jsts_parser.write(jsts_result_geom);place.setGeometry(buffered);place.setLength("");place.setArea(Math.round(buffered.getArea()))}sandbox=this.instance.sandbox;serviceCallback=function(blnSuccess){var dialog,loc;if(blnSuccess){var map=sandbox.findRegisteredModuleInstance("MainMapModule").getMap(),lyr=map.getLayersByName("LupapisteVectors")[0],feature=new OpenLayers.Feature.Vector;feature.geometry=place.getGeometry();feature.attributes.id=place.getId();feature.attributes.name=place.getName();feature.attributes.link=place.getLink();feature.attributes.desc=place.getDescription();feature.attributes.height=place.getHeight();feature.attributes.category=place.getCategoryID();feature.attributes.area=place.getArea();feature.attributes.length=place.getLength();lyr.getFeaturesByAttribute("id",place.getId())&&lyr.removeFeatures(lyr.getFeaturesByAttribute("id",place.getId()));lyr.addFeatures([feature]);me._cleanupPopup();dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup");loc=me.instance.getLocalization("notification").placeAdded;dialog.show(loc.title,loc.message);dialog.fadeout();me.drawPlugin.stopDrawing()}else loc=me.instance.getLocalization("notification").error,me.instance.showMessage(loc.title,loc.savePlace)};this.instance.getService().saveMyPlace(place,serviceCallback)},_cleanupPopup:function(){if(this.form){var sandbox=this.instance.sandbox,request=sandbox.getRequestBuilder("InfoBox.HideInfoBoxRequest")(this.popupId);sandbox.request(this,request);this.form.destroy();this.form=undefined;sandbox.postRequestByName("EnableMapKeyboardMovementRequest");this.instance.enableGfi(!0)}},_deletePlace:function(){var formValues=this.form.getValues(),me=this,sandbox=this.instance.sandbox,loc=me.instance.getLocalization("notification"),dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup"),okBtn=Oskari.clazz.create("Oskari.userinterface.component.Button"),cancelBtn,confirmMsg;okBtn.setTitle(loc.placeDelete.btnDelete);okBtn.addClass("primary");okBtn.setHandler(function(){dialog.close();var service=sandbox.getService("Oskari.lupapiste.bundle.myplaces2.service.MyPlacesService"),callback=function(isSuccess,featureId){var map,layer,feature;isSuccess?(map=sandbox.findRegisteredModuleInstance("MainMapModule").getMap(),layer=map.getLayersByName("LupapisteVectors")[0],layer&&(feature=layer.getFeaturesByAttribute("id",featureId)[0],layer.removeFeatures(feature),me._cleanupPopup(),me.drawPlugin.stopDrawing()),dialog.show(loc.placeDelete.title,loc.placeDelete.success)):dialog.show(loc.placeDelete.title,loc.error.deletePlace);dialog.fadeout()};service.deleteMyPlace(formValues.place.id,callback)});cancelBtn=dialog.createCloseButton(loc.placeDelete.cancel);confirmMsg=loc.placeDelete.confirm;dialog.show(loc.placeDelete.title,confirmMsg,[cancelBtn,okBtn]);dialog.makeModal()}},{protocol:["Oskari.mapframework.module.Module"]});Oskari.clazz.define("Oskari.lupapiste.bundle.myplaces2.view.PlaceForm",function(instance){this.instance=instance;this.newCategoryId="-new-";this.placeId=undefined;this.initialValues=undefined;var loc=instance.getLocalization("placeform");this.template=jQuery('<div class="myplacesform"><div class="field"><div class="help icon-info" title="'+loc.tooltip+'"><\/div>'+loc.placename.label+'<br/><input type="text" name="placename" placeholder="'+loc.placename.placeholder+'"/><\/div><div class="field" style="visibility:hidden;display:none;"><input type="text" name="placelink" placeholder="'+loc.placelink.placeholder+'"/><\/div><div class="field">'+loc.placedesc.label+'<br/><textarea name="placedesc" placeholder="'+loc.placedesc.placeholder+'"><\/textarea><\/div><div class="field" style="visibility:hidden;display:none;"><label for="category">'+loc.category.label+'<\/label><br clear="all" /><select name="category" autofocus><\/select><\/div><div class="field">'+loc.placeheight.label+'<br/><input type="text" name="placeheight" placeholder="'+loc.placeheight.placeholder+'"/><\/div><div class="field" style="display:none;">'+loc.placewidth.label+'<br/><input type="text" name="placewidth" placeholder="'+loc.placewidth.placeholder+'"/><\/div><div class="field">'+loc.area.label+'<br/><input type="text" name="area" placeholder="" /><\/div><div class="field">'+loc.length.label+'<br/><input type="text" name="length" placeholder="" /><\/div><\/div>');this.templateOption=jQuery("<option><\/option>");this.categoryForm=undefined},{getForm:function(categories){var ui=this.template.clone(),loc,selection,i,cat,option;if(ui.find("textarea[name=placedesc]").val(""),ui.find("textarea[name=placedesc]").text(""),loc=this.instance.getLocalization("placeform"),categories){for(selection=ui.find("select[name=category]"),option=this.templateOption.clone(),option.append(loc.category["new"]),option.attr("value",this.newCategoryId),selection.append(option),i=0;i<categories.length;++i)cat=categories[i],option=this.templateOption.clone(),option.append(cat.getName()),option.attr("value",cat.getId()),this.initialValues&&this.initialValues.place&&this.initialValues.place.category?this.initialValues.place.category==cat.getId()&&option.attr("selected","selected"):cat.isDefault()&&option.attr("selected","selected"),selection.append(option);this._bindCategoryChange()}return this.initialValues&&(ui.find("input[name=placename]").attr("value",this.initialValues.place.name),ui.find("input[name=placelink]").attr("value",this.initialValues.place.link),ui.find("textarea[name=placedesc]").append(this.initialValues.place.desc),ui.find("input[name=area]").attr("value",this.initialValues.place.area),ui.find("input[name=length]").attr("value",this.initialValues.place.length),ui.find("input[name=placeheight]").attr("value",this.initialValues.place.height)),ui},getValues:function(){var values={},onScreenForm=this._getOnScreenForm(),placeName,placeLink;if(onScreenForm.length>0){placeName=onScreenForm.find("input[name=placename]").val();placeLink=onScreenForm.find("input[name=placelink]").val();placeLink&&((placeLink.indexOf("://")==-1||placeLink.indexOf("://")>6)&&(placeLink="http://"+placeLink),placeLink=placeLink.replace("<",""),placeLink=placeLink.replace(">",""));var placeDesc=onScreenForm.find("textarea[name=placedesc]").val(),placeHeight=onScreenForm.find("input[name=placeheight]").val(),categorySelection=onScreenForm.find("select[name=category]").val(),area=onScreenForm.find("input[name=area]").val(),length=onScreenForm.find("input[name=length]").val(),width=onScreenForm.find("input[name=placewidth]").val();values.place={name:placeName,link:placeLink,desc:placeDesc,category:categorySelection,area:area,length:length,height:placeHeight,width:width};this.placeId&&(values.place.id=this.placeId)}return this.categoryForm&&(values.category=this.categoryForm.getValues()),values},setValues:function(data){this.placeId=data.place.id;var onScreenForm=this._getOnScreenForm();onScreenForm.length>0&&(onScreenForm.find("input[name=placename]").val(data.place.name),onScreenForm.find("input[name=placelink]").val(data.place.link),onScreenForm.find("textarea[name=placedesc]").val(data.place.desc),onScreenForm.find("select[name=category]").val(data.place.category),onScreenForm.find("input[name=area]").val(data.place.area),onScreenForm.find("input[name=length]").val(data.place.length),onScreenForm.find("input[name=placeHeight]").val(data.place.height));this.initialValues=data},_bindCategoryChange:function(){var me=this,onScreenForm=this._getOnScreenForm();onScreenForm.find("select[name=category]").live("change",function(){var value=jQuery(this).val(),form=me._getOnScreenForm();value==me.newCategoryId?(me.categoryForm=Oskari.clazz.create("Oskari.lupapiste.bundle.myplaces2.view.CategoryForm",me.instance),form.append(me.categoryForm.getForm())):me.categoryForm&&(me.categoryForm.destroy(),me.categoryForm=undefined)})},destroy:function(){var onScreenForm=this._getOnScreenForm();onScreenForm.find("select[name=category]").die();this.categoryForm&&(this.categoryForm.destroy(),this.categoryForm=undefined)},_getOnScreenForm:function(){return jQuery("div.myplacesform")}});Oskari.clazz.define("Oskari.lupapiste.bundle.myplaces2.view.CategoryForm",function(instance){this.instance=instance;jscolor.dir="/Oskari/libraries/jscolor/";var loc=instance.getLocalization("categoryform");this.template=jQuery('<div class="myplacescategoryform"><div class="field"><label for="categoryname">'+loc.name.label+'<\/label><br clear="all" /><input type="text" name="categoryname" placeholder="'+loc.name.placeholder+'"/><\/div><div class="field drawing"><label>'+loc.drawing.label+'<\/label><br clear="all" /><table><\/table><\/div><\/div>');this.templateTableRow=jQuery("<tr><\/tr>");this.templateTableCell=jQuery("<td><\/td>");this.templateTextInput=jQuery('<input type="text"/>');this.defaults={dotSize:4,dotColor:"cc9900",lineSize:2,lineColor:"cc9900",areaLineSize:2,areaLineColor:"cc9900",areaFillColor:"ffdc00"};this.categoryId=undefined;this.initialValues=undefined},{getForm:function(){var ui=this.template.clone(),table=ui.find("div.drawing table"),dotColor,lineColor,areaLineColor,areaFillColor;return this._populatePointTool(table),this._populateLineTool(table),this._populateAreaTool(table),this.initialValues&&(ui.find("input[name=categoryname]").attr("value",this.initialValues.name),ui.find("input[name=dotSize]").attr("value",this.initialValues.dot.size),dotColor=ui.find("input[name=dotColor]"),dotColor.attr("value",this.initialValues.dot.color),new jscolor.color(dotColor[0]),ui.find("input[name=lineSize]").attr("value",this.initialValues.line.size),lineColor=ui.find("input[name=lineColor]"),lineColor.attr("value",this.initialValues.line.color),new jscolor.color(lineColor[0]),ui.find("input[name=areaLineSize]").attr("value",this.initialValues.area.size),areaLineColor=ui.find("input[name=areaLineColor]"),areaLineColor.attr("value",this.initialValues.area.lineColor),new jscolor.color(areaLineColor[0]),areaFillColor=ui.find("input[name=areaFillColor]"),areaFillColor.attr("value",this.initialValues.area.fillColor),new jscolor.color(areaFillColor[0])),ui},getValues:function(){var values={},onScreenForm=this._getOnScreenForm(),catName,dotSize,dotColor,lineSize,lineColor;if(onScreenForm.length>0){catName=onScreenForm.find("input[name=categoryname]").val();values.name=catName;this.categoryId&&(values.id=this.categoryId);dotSize=onScreenForm.find("input[name=dotSize]").val();dotColor=onScreenForm.find("input[name=dotColor]").val();values.dot={size:dotSize,color:dotColor};lineSize=onScreenForm.find("input[name=lineSize]").val();lineColor=onScreenForm.find("input[name=lineColor]").val();values.line={size:lineSize,color:lineColor};var areaLineSize=onScreenForm.find("input[name=areaLineSize]").val(),areaLineColor=onScreenForm.find("input[name=areaLineColor]").val(),areaFillColor=onScreenForm.find("input[name=areaFillColor]").val();values.area={size:areaLineSize,lineColor:areaLineColor,fillColor:areaFillColor}}return values},setValues:function(data){this.categoryId=data.id;var onScreenForm=this._getOnScreenForm();onScreenForm.length>0&&(onScreenForm.find("input[name=categoryname]").val(data.name),onScreenForm.find("input[name=dotSize]").val(data.dot.size),onScreenForm.find("input[name=dotColor]").val(data.dot.color),onScreenForm.find("input[name=lineSize]").val(data.line.size),onScreenForm.find("input[name=lineColor]").val(data.line.color),onScreenForm.find("input[name=areaLineSize]").val(data.area.size),onScreenForm.find("input[name=areaLineColor]").val(data.area.lineColor),onScreenForm.find("input[name=areaFillColor]").val(data.area.fillColor));this.initialValues=data},_createInput:function(name,value,classes){var input=this.templateTextInput.clone();return input.attr("name",name),input.attr("value",value),classes&&input.attr("class",classes),classes=="oskaricolor"&&(input.picker=new jscolor.color(input[0])),input},_populatePointTool:function(table){var loc=this.instance.getLocalization("categoryform").drawing.point,labelRow=this.templateTableRow.clone(),title,label,toolRow,pointColorpicker,size;for(title in loc)label=this.templateTableCell.clone(),label.append(loc[title]),labelRow.append(label);labelRow.append(this.templateTableCell.clone());toolRow=this.templateTableRow.clone();toolRow.append(this.templateTableCell.clone());pointColorpicker=this.templateTableCell.clone();pointColorpicker.append(this._createInput("dotColor",this.defaults.dotColor,"oskaricolor"));toolRow.append(pointColorpicker);size=this.templateTableCell.clone();size.append(this._createInput("dotSize",this.defaults.dotSize));toolRow.append(size);toolRow.append(this.templateTableCell.clone());table.append(labelRow);table.append(toolRow)},_populateLineTool:function(table){var loc=this.instance.getLocalization("categoryform").drawing.line,labelRow=this.templateTableRow.clone(),title,label,toolRow,lineColorpicker,size;for(title in loc)label=this.templateTableCell.clone(),label.append(loc[title]),labelRow.append(label);labelRow.append(this.templateTableCell.clone());toolRow=this.templateTableRow.clone();toolRow.append(this.templateTableCell.clone());lineColorpicker=this.templateTableCell.clone();lineColorpicker.append(this._createInput("lineColor",this.defaults.lineColor,"oskaricolor"));toolRow.append(lineColorpicker);size=this.templateTableCell.clone();size.append(this._createInput("lineSize",this.defaults.lineSize));toolRow.append(size);toolRow.append(this.templateTableCell.clone());table.append(labelRow);table.append(toolRow)},_populateAreaTool:function(table){var loc=this.instance.getLocalization("categoryform").drawing.area,labelRow=this.templateTableRow.clone(),title,label,toolRow,areaColorpicker,lineColorpicker,size;for(title in loc)label=this.templateTableCell.clone(),label.append(loc[title]),labelRow.append(label);toolRow=this.templateTableRow.clone();toolRow.append(this.templateTableCell.clone());areaColorpicker=this.templateTableCell.clone();areaColorpicker.append(this._createInput("areaFillColor",this.defaults.areaFillColor,"oskaricolor"));toolRow.append(areaColorpicker);lineColorpicker=this.templateTableCell.clone();lineColorpicker.append(this._createInput("areaLineColor",this.defaults.areaLineColor,"oskaricolor"));toolRow.append(lineColorpicker);size=this.templateTableCell.clone();size.append(this._createInput("areaLineSize",this.defaults.areaLineSize));toolRow.append(size);table.append(labelRow);table.append(toolRow)},_getOnScreenForm:function(){return jQuery("div.myplacescategoryform")},destroy:function(){var onScreenForm=this._getOnScreenForm();onScreenForm.remove()}});Oskari.clazz.define("Oskari.lupapiste.bundle.myplaces2.ButtonHandler",function(instance){this.instance=instance;this.buttonGroup="myplaces";this.ignoreEvents=!1;this.dialog=null;var me=this;this.buttons={point:{iconCls:"myplaces-draw-point",tooltip:"",sticky:!0,callback:function(){me.startNewDrawing({drawMode:"point"})}},line:{iconCls:"myplaces-draw-line",tooltip:"",sticky:!0,callback:function(){me.startNewDrawing({drawMode:"line"})}},area:{iconCls:"myplaces-draw-area",tooltip:"",sticky:!0,callback:function(){me.startNewDrawing({drawMode:"area"})}},circle:{iconCls:"myplaces-draw-circle",tooltip:"",sticky:!0,callback:function(){me.startNewDrawing({drawMode:"circle"})}},ellipse:{iconCls:"myplaces-draw-ellipse",tooltip:"",sticky:!0,callback:function(){me.startNewDrawing({drawMode:"ellipse"})}}};this.templateGuide=jQuery('<div><div class="guide"><\/div><div class="buttons"><div class="cancel button"><\/div><div class="finish button"><\/div><\/div><\/div>');this.templateHelper=jQuery('<div class="drawHelper"><div class="infoText"><\/div><div class="measurementResult"><\/div><\/div>')},{__name:"MyPlacesButtonHandler",getName:function(){return this.__name},_isButtonConfigured:function(pId,pGroup){return this.instance.conf&&(this.instance.conf[pGroup]===!1||this.instance.conf[pGroup]&&this.instance.conf[pGroup][pId]===!1)?!1:!0},init:function(){var loc=this.instance.getLocalization("tools"),user=this.instance.sandbox.getUser(),guestPostfix=" - "+this.instance.getLocalization("guest").loginShort,tool,tooltip;for(tool in this.buttons)tooltip=loc[tool].tooltip,user.isLoggedIn()||(tooltip=tooltip+guestPostfix),this.buttons[tool].tooltip=tooltip},start:function(){var me=this,sandbox=this.instance.sandbox,reqBuilder,tool,user;sandbox.register(me);for(p in me.eventHandlers)sandbox.registerForEventByName(me,p);reqBuilder=sandbox.getRequestBuilder("Toolbar.AddToolButtonRequest");for(tool in this.buttons)this._isButtonConfigured(tool,this.buttonGroup)&&sandbox.request(this,reqBuilder(tool,this.buttonGroup,this.buttons[tool]));user=this.instance.sandbox.getUser();user.isLoggedIn()||this.disableButtons()},disableButtons:function(){var sandbox=this.instance.sandbox,stateReqBuilder=sandbox.getRequestBuilder("Toolbar.ToolButtonStateRequest");sandbox.request(this,stateReqBuilder(undefined,this.buttonGroup,!1))},startNewDrawing:function(config){var event=this.instance.sandbox.getEventBuilder("LupaPisteMyPlaces.MyPlaceSelectedEvent")();this.instance.sandbox.notifyAll(event);this.sendDrawRequest(config);this.instance.enableGfi(!1)},sendDrawRequest:function(config){var me=this,startRequest=this.instance.sandbox.getRequestBuilder("LupaPisteMyPlaces.StartDrawingRequest")(config);this.instance.sandbox.request(this,startRequest);config.geometry||this._showDrawHelper(config.drawMode)},_showDrawHelper:function(drawMode){var me=this,locTool=this.instance.getLocalization("tools")[drawMode],locBtns=this.instance.getLocalization("buttons"),title=this.instance.getLocalization("title"),message=locTool["new"],dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup"),buttons,cancelBtn,content,measureResult,finishBtn;this.dialog=dialog;buttons=[];cancelBtn=Oskari.clazz.create("Oskari.userinterface.component.Button");cancelBtn.setTitle(locBtns.cancel);cancelBtn.setHandler(function(){var toolbarRequest=me.instance.sandbox.getRequestBuilder("Toolbar.SelectToolButtonRequest")();me.instance.sandbox.request(me,toolbarRequest);me.sendStopDrawRequest(!0)});buttons.push(cancelBtn);content=this.templateHelper.clone();content.find("div.infoText").html(message);measureResult=content.find("div.measurementResult");drawMode!="point"&&drawMode!="circle"&&drawMode!="ellipse"?(finishBtn=Oskari.clazz.create("Oskari.userinterface.component.Button"),finishBtn.setTitle(locBtns.finish),finishBtn.addClass("primary"),finishBtn.setHandler(function(){me.sendStopDrawRequest()}),buttons.push(finishBtn),measureResult.html(locTool.noResult)):measureResult.remove();dialog.show(title,content,buttons);dialog.addClass("myplaces2");dialog.moveTo("#toolbar div.toolrow[tbgroup=default-myplaces]","top")},sendStopDrawRequest:function(isCancel){var me=this,request=this.instance.sandbox.getRequestBuilder("LupaPisteMyPlaces.StopDrawingRequest")(isCancel);this.instance.sandbox.request(this,request);this.dialog&&this.dialog.close()},stop:function(){jQuery("div.myplaces2 div.button").die()},onEvent:function(event){var handler=this.eventHandlers[event.getName()];if(handler)return handler.apply(this,[event])},eventHandlers:{"Toolbar.ToolSelectedEvent":function(){this.ignoreEvents||(this.sendStopDrawRequest(!0),this.instance.enableGfi(!0))},"LupaPisteMyPlaces.MyPlaceSelectedEvent":function(event){if(!event.getPlace()){var toolbarRequest=this.instance.sandbox.getRequestBuilder("Toolbar.SelectToolButtonRequest")();this.instance.sandbox.request(this,toolbarRequest)}},"LupaPisteMyPlaces.FinishedDrawingEvent":function(){this.ignoreEvents=!0;var toolbarRequest=this.instance.sandbox.getRequestBuilder("Toolbar.SelectToolButtonRequest")();this.instance.sandbox.request(this,toolbarRequest);this.ignoreEvents=!1;this.instance.enableGfi(!1);this.dialog&&this.dialog.close()},"LupaPisteMyPlaces.ActiveDrawingEvent":function(event){var geom=event.getDrawing(),mode=event.getDrawMode(),resultText=this.instance.formatMeasurementResult(geom,mode),content;this.dialog&&(content=this.dialog.getJqueryContent(),content.find("div.measurementResult").html(resultText))}}},{protocol:["Oskari.mapframework.module.Module"]});Oskari.clazz.define("Oskari.lupapiste.bundle.myplaces2.CategoryHandler",function(instance){this.instance=instance;this.initialLoad=!0;this.validateTool=Oskari.clazz.create("Oskari.userinterface.component.FormInput")},{__name:"MyPlacesCategoryHandler",getName:function(){return this.__name},init:function(){},start:function(){var me=this,sandbox=me.instance.sandbox,user=sandbox.getUser(),p;if(user.isLoggedIn()){sandbox.register(me);for(p in me.eventHandlers)sandbox.registerForEventByName(me,p)}},stop:function(){},onEvent:function(event){var handler=this.eventHandlers[event.getName()];if(handler)return handler.apply(this,[event])},eventHandlers:{"LupaPisteMyPlaces.MyPlacesChangedEvent":function(){this._handlePlacesChanged()}},_handlePlacesChanged:function(){for(var sandbox=this.instance.sandbox,mapLayerService=sandbox.getService("Oskari.mapframework.service.MapLayerService"),categories=this.instance.getService().getAllCategories(),mapLayers=mapLayerService.getAllLayersByMetaType(this.instance.idPrefix),catIdx,cat,found,layer,layerConf,json,myplacesLayer,i=0;i<mapLayers.length;++i){for(layer=mapLayers[i],found=!1,catIdx=0;catIdx<categories.length;++catIdx)cat=categories[catIdx],this._getMapLayerId(cat.getId())===layer.getId()&&(found=!0);found||(sandbox.requestByName(this.getName(),"RemoveMapLayerRequest",[layer.getId()]),mapLayerService.removeLayer(layer.getId()))}for(catIdx=0;catIdx<categories.length;++catIdx){for(cat=categories[catIdx],found=!1,i=0;i<mapLayers.length;++i)this._getMapLayerId(cat.getId())===mapLayers[i].getId()&&(found=!0,cat.getName()!==mapLayers[i].getName()&&(layerConf={name:cat.getName()},mapLayerService.updateLayer(mapLayers[i].getId(),layerConf)));found||(json=this._getMapLayerJson(cat),myplacesLayer=mapLayerService.createMapLayer(json),mapLayerService.addLayer(myplacesLayer))}this.initialLoad&&(this._processStartupLinkLayers(sandbox),this.initialLoad=!1)},addLayerToMap:function(categoryId){var layerId=this._getMapLayerId(categoryId),layer=this.sandbox.findMapLayerFromSelectedMapLayers(layerId),request;layer||(request=this.sandbox.getRequestBuilder("AddMapLayerRequest")(layerId,!0),this.sandbox.request(this.getName(),request))},addLayerToService:function(category){var mapLayerService=this._sandbox.getService("Oskari.mapframework.service.MapLayerService"),json=this._getMapLayerJson(category),myplacesLayer=mapLayerService.createMapLayer(json);mapLayerService.addLayer(myplacesLayer)},_getMapLayerId:function(categoryId){if(!categoryId){var defCat=this.myPlacesService.getDefaultCategory();categoryId=defCat?defCat.getId():"-99"}return this.instance.idPrefix+"_"+categoryId},_getMapLayerJson:function(categoryModel){var baseJson=this._getMapLayerJsonBase();return baseJson.wmsUrl=this.instance.conf.wmsUrl+categoryModel.getId()+"&",baseJson.name=categoryModel.getName(),baseJson.id=this._getMapLayerId(categoryModel.getId()),baseJson.permissions=categoryModel.isPublic()?{publish:"publication_permission_ok"}:{publish:"no_publication_permission"},baseJson},_getMapLayerJsonBase:function(){var catLoc=this.instance.getLocalization("category");return{wmsName:"ows:my_places_categories",type:"wmslayer",isQueryable:!0,opacity:50,metaType:this.instance.idPrefix,orgName:catLoc.organization,inspire:catLoc.inspire}},_processStartupLinkLayers:function(sandbox){var mapLayers=sandbox.getRequestParameter("mapLayers"),layerStrings,keepLayersOrder,i,rb,r;if(mapLayers!==null&&mapLayers!=="")for(layerStrings=mapLayers.split(","),keepLayersOrder=!0,i=0;i<layerStrings.length;i++){var splitted=layerStrings[i].split("+"),layerId=splitted[0],opacity=splitted[1];layerId!==null&&layerId.indexOf(this.instance.idPrefix)!==-1&&(rb=null,r=null,rb=sandbox.getRequestBuilder("AddMapLayerRequest"),r=rb(layerId,keepLayersOrder),sandbox.request(this.getName(),r),rb=sandbox.getRequestBuilder("ChangeMapLayerOpacityRequest"),r=rb(layerId,opacity),sandbox.request(this.getName(),r))}},editCategory:function(category){var me=this,form,values,cancelBtn;this.instance.sandbox.postRequestByName("DisableMapKeyboardMovementRequest");form=Oskari.clazz.create("Oskari.lupapiste.bundle.myplaces2.view.CategoryForm",me.instance);values={name:category.getName(),id:category.getId(),dot:{size:category.getDotSize(),color:category.getDotColor()},line:{size:category.getLineWidth(),color:category.getLineColor()},area:{size:category.getAreaLineWidth(),lineColor:category.getAreaLineColor(),fillColor:category.getAreaFillColor()}};form.setValues(values);var content=form.getForm(),dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup"),buttons=[],saveBtn=Oskari.clazz.create("Oskari.userinterface.component.Button"),btnLoc=this.instance.getLocalization("buttons"),catLoc=this.instance.getLocalization("categoryform").edit;saveBtn.setTitle(btnLoc.save);saveBtn.addClass("primary");saveBtn.setHandler(function(){var values=form.getValues(),errors=me.validateCategoryFormValues(values),category;if(errors.length!==0){me.showValidationErrorMessage(errors);return}category=me.getCategoryFromFormValues(values);me.saveCategory(category);dialog.close();me.instance.sandbox.postRequestByName("EnableMapKeyboardMovementRequest")});cancelBtn=Oskari.clazz.create("Oskari.userinterface.component.Button");cancelBtn.setTitle(btnLoc.cancel);cancelBtn.setHandler(function(){dialog.close()});buttons.push(cancelBtn);buttons.push(saveBtn);dialog.show(catLoc.title,content,buttons);dialog.moveTo("div.personaldata ul li select","right");dialog.makeModal()},showValidationErrorMessage:function(errors){var loc=this.instance.getLocalization(),dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup"),okBtn=Oskari.clazz.create("Oskari.userinterface.component.Button"),content,i,row;for(okBtn.setTitle(loc.buttons.ok),okBtn.addClass("primary"),okBtn.setHandler(function(){dialog.close(!0)}),content=jQuery("<ul><\/ul>"),i=0;i<errors.length;++i)row=jQuery("<li><\/li>"),row.append(errors[i].error),content.append(row);dialog.show(loc.validation.title,content,[okBtn])},_showMessage:function(title,message){var loc=this.instance.getLocalization(),dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup"),okBtn=Oskari.clazz.create("Oskari.userinterface.component.Button");okBtn.setTitle(loc.buttons.ok);okBtn.addClass("primary");okBtn.setHandler(function(){dialog.close(!0)});dialog.show(title,message,[okBtn])},hasIllegalChars:function(value){return this.validateTool.setValue(value),!this.validateTool.checkValue()},_validateNumber:function(value,min,max){return this.validateTool.validateNumberRange(value,min,max)},_isColor:function(value){return this.validateTool.validateHexColor(value)},validateCategoryFormValues:function(values){var errors=[],loc;return values?(loc=this.instance.getLocalization("validation"),values.name?this.hasIllegalChars(values.name)&&errors.push({field:"name",error:loc.categoryNameIllegal}):errors.push({field:"name",error:loc.categoryName}),this._validateNumber(values.dot.size,1,50)||errors.push({field:"dotSize",error:loc.dotSize}),this._isColor(values.dot.color)||errors.push({field:"dotColor",error:loc.dotColor}),this._validateNumber(values.line.size,1,50)||errors.push({field:"lineSize",error:loc.lineSize}),this._isColor(values.line.color)||errors.push({field:"lineColor",error:loc.lineColor}),this._validateNumber(values.area.size,0,50)||errors.push({field:"areaLineSize",error:loc.areaLineSize}),this._isColor(values.area.lineColor)||errors.push({field:"areaLineColor",error:loc.areaLineColor}),this._isColor(values.area.fillColor)||errors.push({field:"areaFillColor",error:loc.areaFillColor}),errors):errors},getCategoryFromFormValues:function(values){var category=Oskari.clazz.create("Oskari.lupapiste.bundle.myplaces2.model.MyPlacesCategory");return category.setName(values.name),category.setId(values.id),category.setDotSize(values.dot.size),category.setDotColor(values.dot.color),category.setLineWidth(values.line.size),category.setLineColor(values.line.color),category.setAreaLineWidth(values.area.size),category.setAreaLineColor(values.area.lineColor),category.setAreaFillColor(values.area.fillColor),category},saveCategory:function(category){var me=this,loc=me.instance.getLocalization("notification"),serviceCallback=function(blnSuccess,model,blnNew){var dialog,layerId,request;blnSuccess?(dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup"),dialog.show(loc.categorySaved.title,loc.categorySaved.message),dialog.fadeout(),layerId=me._getMapLayerId(category.getId()),request=me.instance.sandbox.getRequestBuilder("MapModulePlugin.MapLayerUpdateRequest")(layerId,!0),me.instance.sandbox.request(me,request)):blnNew?me.instance.showMessage(loc.error.title,loc.error.addCategory):me.instance.showMessage(loc.error.title,loc.error.editCategory)};this.instance.getService().saveCategory(category,serviceCallback)},confirmDeleteCategory:function(category){var me=this,btnLoc=me.instance.getLocalization("buttons"),service=this.instance.getService(),defaultCategory=service.getDefaultCategory(),dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup"),loc,deleteBtn,okBtn,content,moveBtn,locParams;if(defaultCategory.getId()==category.getId()){loc=me.instance.getLocalization();okBtn=dialog.createCloseButton(loc.buttons.ok);dialog.show(loc.notification.error.title,loc.notification.error.deleteDefault,[okBtn]);return}var places=service.getPlacesInCategory(category.getId()),buttons=[],cancelBtn=dialog.createCloseButton(btnLoc.cancel);buttons.push(cancelBtn);loc=me.instance.getLocalization("notification");content="";places.length>0?(deleteBtn=Oskari.clazz.create("Oskari.userinterface.component.Button"),deleteBtn.setTitle(btnLoc.deleteCategoryAndPlaces),deleteBtn.setHandler(function(){dialog.close();me._deleteCategory(category,!1)}),buttons.push(deleteBtn),moveBtn=Oskari.clazz.create("Oskari.userinterface.component.Button"),moveBtn.setTitle(btnLoc.movePlaces),moveBtn.addClass("primary"),moveBtn.setHandler(function(){dialog.close();me._deleteCategory(category,!0)}),buttons.push(moveBtn),locParams=[category.getName(),places.length,defaultCategory.getName()],content=this._formatMessage(loc.categoryDelete.deleteConfirmMove,locParams)):(deleteBtn=Oskari.clazz.create("Oskari.userinterface.component.Button"),deleteBtn.setTitle(btnLoc.deleteCategory),deleteBtn.addClass("primary"),buttons.push(deleteBtn),deleteBtn.setHandler(function(){dialog.close();me._deleteCategory(category,!1)}),content=this._formatMessage(loc.categoryDelete.deleteConfirm,[category.getName()]));dialog.show(loc.categoryDelete.title,content,buttons);dialog.makeModal()},_formatMessage:function(msg,params){for(var formatted=msg,i=0;i<params.length;++i)formatted=formatted.replace("{"+i+"}",params[i]);return formatted},_deleteCategory:function(category,movePlaces){var me=this,catId=category.getId(),callBackWrapper=function(success){me._deleteCategoryCallback(success,movePlaces,catId)},service=this.instance.getService();service.deleteCategory(catId,movePlaces,callBackWrapper)},_deleteCategoryCallback:function(success,movePlaces){var me=this,dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup"),service=me.instance.getService(),loc,okBtn;if(success){if(movePlaces){var defCat=service.getDefaultCategory(),layerId=this._getMapLayerId(defCat.getId()),request=this.instance.sandbox.getRequestBuilder("MapModulePlugin.MapLayerUpdateRequest")(layerId,!0);this.instance.sandbox.request(this,request)}loc=me.instance.getLocalization();dialog.show(loc.notification.categoryDelete.title,loc.notification.categoryDelete.deleted);dialog.fadeout()}else loc=me.instance.getLocalization(),okBtn=dialog.createCloseButton(btnLoc.buttons.ok),dialog.show(loc.notification.error.title,loc.notification.error.deleteCategory,[okBtn])},confirmPublishCategory:function(category,makePublic){var me=this,loc=me.instance.getLocalization(),dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup"),service=this.instance.getService(),buttons=[],cancelBtn=dialog.createCloseButton(loc.buttons.cancel),operationalBtn,locParams,msg;buttons.push(cancelBtn);operationalBtn=Oskari.clazz.create("Oskari.userinterface.component.Button");operationalBtn.addClass("primary");operationalBtn.setHandler(function(){service.publishCategory(category.getId(),makePublic,function(wasSuccess){me._handlePublishCategory(category,makePublic,wasSuccess)});dialog.close()});buttons.push(operationalBtn);locParams=[category.getName()];makePublic?(operationalBtn.setTitle(loc.buttons.changeToPublic),msg=this._formatMessage(loc.notification.categoryToPublic.message,locParams),dialog.show(loc.notification.categoryToPublic.title,msg,buttons)):(operationalBtn.setTitle(loc.buttons.changeToPrivate),msg=this._formatMessage(loc.notification.categoryToPrivate.message,locParams),dialog.show(loc.notification.categoryToPrivate.title,msg,buttons))},_handlePublishCategory:function(category,makePublic,wasSuccess){var loc,event;if(!wasSuccess){loc=this.instance.getLocalization("notification");this._showMessage(loc.error.title,loc.error.generic);return}var sandbox=this.instance.sandbox,mapLayerService=sandbox.getService("Oskari.mapframework.service.MapLayerService"),layerId=this._getMapLayerId(category.getId()),mapLayer=mapLayerService.findMapLayer(layerId);if(!mapLayer){loc=this.instance.getLocalization("notification");this._showMessage(loc.error.title,loc.error.generic);return}makePublic?mapLayer.addPermission("publish","publication_permission_ok"):mapLayer.addPermission("publish","no_publication_permission");event=sandbox.getEventBuilder("MapLayerEvent")(layerId,"update");sandbox.notifyAll(event)}},{protocol:["Oskari.mapframework.module.Module"]});Oskari.clazz.define("Oskari.lupapiste.bundle.myplaces2.MyPlacesBundleInstance",function(){this._localization=null;this.sandbox=null;this.buttons=undefined;this.categoryHandler=undefined;this.myPlacesService=undefined;this.idPrefix="myplaces"},{__name:"MyPlaces2",getName:function(){return this.__name},getSandbox:function(){return this.sandbox},getLocalization:function(key){return(this._localization||(this._localization=Oskari.getLocalization(this.getName())),key)?this._localization&&this._localization[key]?this._localization[key]:key:this._localization},showMessage:function(title,message){var loc=this.getLocalization(),dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup"),okBtn=Oskari.clazz.create("Oskari.userinterface.component.Button");okBtn.setTitle(loc.buttons.ok);okBtn.addClass("primary");okBtn.setHandler(function(){dialog.close(!0)});dialog.show(title,message,[okBtn])},forceDisable:function(){this.buttons.disableButtons();var loc=this.getLocalization();this.showMessage(loc.category.organization+" - "+loc.notification.error.title,loc.notification.error.generic)},enableGfi:function(blnEnable){var gfiReqBuilder=this.sandbox.getRequestBuilder("MapModulePlugin.GetFeatureInfoActivationRequest");gfiReqBuilder&&this.sandbox.request(this.buttons,gfiReqBuilder(blnEnable))},getService:function(){return this.myPlacesService},getDrawPlugin:function(){return this.view.drawPlugin},getCategoryHandler:function(){return this.categoryHandler},getMainView:function(){return this.view},update:function(){},start:function(){var sandbox=Oskari.$("sandbox"),me,user,defaultCategoryName,actionUrl;(this.sandbox=sandbox,me=this,sandbox.printDebug("Initializing my places module..."),this.buttons=Oskari.clazz.create("Oskari.lupapiste.bundle.myplaces2.ButtonHandler",this),this.buttons.start(),user=sandbox.getUser(),user.isLoggedIn())&&(this.categoryHandler=Oskari.clazz.create("Oskari.lupapiste.bundle.myplaces2.CategoryHandler",this),this.categoryHandler.start(),defaultCategoryName=this.getLocalization("category").defaultName,actionUrl=this.conf.queryUrl,this.myPlacesService=Oskari.clazz.create("Oskari.lupapiste.bundle.myplaces2.service.MyPlacesService",actionUrl,user.getUuid(),sandbox,defaultCategoryName,this),this.sandbox.registerService(this.myPlacesService),this.myPlacesService.init(),this.view=Oskari.clazz.create("Oskari.lupapiste.bundle.myplaces2.view.MainView",this),this.view.start(),this.editRequestHandler=Oskari.clazz.create("Oskari.lupapiste.bundle.myplaces2.request.EditRequestHandler",sandbox,me),sandbox.addRequestHandler("LupaPisteMyPlaces.EditPlaceRequest",this.editRequestHandler),sandbox.addRequestHandler("LupaPisteMyPlaces.EditCategoryRequest",this.editRequestHandler),sandbox.addRequestHandler("LupaPisteMyPlaces.DeleteCategoryRequest",this.editRequestHandler),sandbox.addRequestHandler("LupaPisteMyPlaces.PublishCategoryRequest",this.editRequestHandler))},stop:function(){this.sandbox=null},formatMeasurementResult:function(geometry,drawMode){var measurement,unit;if(drawMode==="area")measurement=Math.round(100*geometry.getArea())/100,unit=" m",measurement>=1e6&&(measurement=Math.round(measurement)/1e6,unit=" km");else if(drawMode==="line")measurement=Math.round(100*geometry.getLength())/100,unit=" m",measurement>=1e3&&(measurement=Math.round(measurement)/1e3,unit=" km");else return"";return(measurement+unit).replace(".",",")}},{protocol:["Oskari.bundle.BundleInstance"]});
/**
 * jscolor, JavaScript Color Picker
 *
 * @version 1.3.13
 * @license GNU Lesser General Public License, http://www.gnu.org/copyleft/lesser.html
 * @author  Jan Odvarko, http://odvarko.cz
 * @created 2008-06-15
 * @updated 2012-01-19
 * @link    http://jscolor.com
 */
jscolor={dir:"",bindClass:"color",binding:!0,preloading:!0,install:function(){jscolor.addEvent(window,"load",jscolor.init)},init:function(){jscolor.binding&&jscolor.bind();jscolor.preloading&&jscolor.preload()},getDir:function(){if(!jscolor.dir){var detected=jscolor.detectDir();jscolor.dir=detected!==!1?detected:"jscolor/"}return jscolor.dir},detectDir:function(){for(var src,srcAbs,base=location.href,e=document.getElementsByTagName("base"),i=0;i<e.length;i+=1)e[i].href&&(base=e[i].href);for(e=document.getElementsByTagName("script"),i=0;i<e.length;i+=1)if(e[i].src&&/(^|\/)jscolor\.js([?#].*)?$/i.test(e[i].src))return src=new jscolor.URI(e[i].src),srcAbs=src.toAbsolute(base),srcAbs.path=srcAbs.path.replace(/[^\/]+$/,""),srcAbs.query=null,srcAbs.fragment=null,srcAbs.toString();return!1},bind:function(){for(var m,prop,matchClass=new RegExp("(^|\\s)("+jscolor.bindClass+")\\s*(\\{[^}]*\\})?","i"),e=document.getElementsByTagName("input"),i=0;i<e.length;i+=1)if(!e[i].color&&e[i].className&&(m=e[i].className.match(matchClass))){if(prop={},m[3])try{eval("prop="+m[3])}catch(eInvalidProp){}e[i].color=new jscolor.color(e[i],prop)}},preload:function(){for(var fn in jscolor.imgRequire)jscolor.imgRequire.hasOwnProperty(fn)&&jscolor.loadImage(fn)},images:{pad:[181,101],sld:[16,101],cross:[15,15],arrow:[7,11]},imgRequire:{},imgLoaded:{},requireImage:function(filename){jscolor.imgRequire[filename]=!0},loadImage:function(filename){jscolor.imgLoaded[filename]||(jscolor.imgLoaded[filename]=new Image,jscolor.imgLoaded[filename].src=jscolor.getDir()+filename)},fetchElement:function(mixed){return typeof mixed=="string"?document.getElementById(mixed):mixed},addEvent:function(el,evnt,func){el.addEventListener?el.addEventListener(evnt,func,!1):el.attachEvent&&el.attachEvent("on"+evnt,func)},fireEvent:function(el,evnt){var ev;el&&(document.createEvent?(ev=document.createEvent("HTMLEvents"),ev.initEvent(evnt,!0,!0),el.dispatchEvent(ev)):document.createEventObject?(ev=document.createEventObject(),el.fireEvent("on"+evnt,ev)):el["on"+evnt]&&el["on"+evnt]())},getElementPos:function(e){var e1=e,e2=e,x=0,y=0;if(e1.offsetParent)do x+=e1.offsetLeft,y+=e1.offsetTop;while(e1=e1.offsetParent);while((e2=e2.parentNode)&&e2.nodeName.toUpperCase()!=="BODY")x-=e2.scrollLeft,y-=e2.scrollTop;return[x,y]},getElementSize:function(e){return[e.offsetWidth,e.offsetHeight]},getRelMousePos:function(e){var x=0,y=0;return e||(e=window.event),typeof e.offsetX=="number"?(x=e.offsetX,y=e.offsetY):typeof e.layerX=="number"&&(x=e.layerX,y=e.layerY),{x:x,y:y}},getViewPos:function(){return typeof window.pageYOffset=="number"?[window.pageXOffset,window.pageYOffset]:document.body&&(document.body.scrollLeft||document.body.scrollTop)?[document.body.scrollLeft,document.body.scrollTop]:document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)?[document.documentElement.scrollLeft,document.documentElement.scrollTop]:[0,0]},getViewSize:function(){return typeof window.innerWidth=="number"?[window.innerWidth,window.innerHeight]:document.body&&(document.body.clientWidth||document.body.clientHeight)?[document.body.clientWidth,document.body.clientHeight]:document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?[document.documentElement.clientWidth,document.documentElement.clientHeight]:[0,0]},URI:function(uri){function removeDotSegments(path){for(var out="",rm;path;)path.substr(0,3)==="../"||path.substr(0,2)==="./"?path=path.replace(/^\.+/,"").substr(1):path.substr(0,3)==="/./"||path==="/."?path="/"+path.substr(3):path.substr(0,4)==="/../"||path==="/.."?(path="/"+path.substr(4),out=out.replace(/\/?[^\/]*$/,"")):path==="."||path===".."?path="":(rm=path.match(/^\/?[^\/]*/)[0],path=path.substr(rm.length),out=out+rm);return out}this.scheme=null;this.authority=null;this.path="";this.query=null;this.fragment=null;this.parse=function(uri){var m=uri.match(/^(([A-Za-z][0-9A-Za-z+.-]*)(:))?((\/\/)([^\/?#]*))?([^?#]*)((\?)([^#]*))?((#)(.*))?/);return this.scheme=m[3]?m[2]:null,this.authority=m[5]?m[6]:null,this.path=m[7],this.query=m[9]?m[10]:null,this.fragment=m[12]?m[13]:null,this};this.toString=function(){var result="";return this.scheme!==null&&(result=result+this.scheme+":"),this.authority!==null&&(result=result+"//"+this.authority),this.path!==null&&(result=result+this.path),this.query!==null&&(result=result+"?"+this.query),this.fragment!==null&&(result=result+"#"+this.fragment),result};this.toAbsolute=function(base){var base=new jscolor.URI(base),r=this,t=new jscolor.URI;return base.scheme===null?!1:(r.scheme!==null&&r.scheme.toLowerCase()===base.scheme.toLowerCase()&&(r.scheme=null),r.scheme!==null?(t.scheme=r.scheme,t.authority=r.authority,t.path=removeDotSegments(r.path),t.query=r.query):(r.authority!==null?(t.authority=r.authority,t.path=removeDotSegments(r.path),t.query=r.query):(r.path===""?(t.path=base.path,t.query=r.query!==null?r.query:base.query):(r.path.substr(0,1)==="/"?t.path=removeDotSegments(r.path):(t.path=base.authority!==null&&base.path===""?"/"+r.path:base.path.replace(/[^\/]+$/,"")+r.path,t.path=removeDotSegments(t.path)),t.query=r.query),t.authority=base.authority),t.scheme=base.scheme),t.fragment=r.fragment,t)};uri&&this.parse(uri)},color:function(target,prop){function RGB_HSV(r,g,b){var n=Math.min(Math.min(r,g),b),v=Math.max(Math.max(r,g),b),m=v-n,h;return m===0?[null,0,v]:(h=r===n?3+(b-g)/m:g===n?5+(r-b)/m:1+(g-r)/m,[h===6?0:h,m/v,v])}function HSV_RGB(h,s,v){if(h===null)return[v,v,v];var i=Math.floor(h),f=i%2?h-i:1-(h-i),m=v*(1-s),n=v*(1-s*f);switch(i){case 6:case 0:return[v,n,m];case 1:return[n,v,m];case 2:return[m,v,n];case 3:return[m,n,v];case 4:return[n,m,v];case 5:return[v,m,n]}}function removePicker(){delete jscolor.picker.owner;document.getElementsByTagName("body")[0].removeChild(jscolor.picker.boxB)}function drawPicker(x,y){function setBtnBorder(){var insetColors=THIS.pickerInsetColor.split(/\s+/),pickerOutsetColor=insetColors.length<2?insetColors[0]:insetColors[1]+" "+insetColors[0]+" "+insetColors[0]+" "+insetColors[1];p.btn.style.borderColor=pickerOutsetColor}var i,segSize,seg,p,dims,padImg;if(!jscolor.picker){for(jscolor.picker={box:document.createElement("div"),boxB:document.createElement("div"),pad:document.createElement("div"),padB:document.createElement("div"),padM:document.createElement("div"),sld:document.createElement("div"),sldB:document.createElement("div"),sldM:document.createElement("div"),btn:document.createElement("div"),btnS:document.createElement("span"),btnT:document.createTextNode(THIS.pickerCloseText)},i=0,segSize=4;i<jscolor.images.sld[1];i+=segSize)seg=document.createElement("div"),seg.style.height=segSize+"px",seg.style.fontSize="1px",seg.style.lineHeight="0",jscolor.picker.sld.appendChild(seg);jscolor.picker.sldB.appendChild(jscolor.picker.sld);jscolor.picker.box.appendChild(jscolor.picker.sldB);jscolor.picker.box.appendChild(jscolor.picker.sldM);jscolor.picker.padB.appendChild(jscolor.picker.pad);jscolor.picker.box.appendChild(jscolor.picker.padB);jscolor.picker.box.appendChild(jscolor.picker.padM);jscolor.picker.btnS.appendChild(jscolor.picker.btnT);jscolor.picker.btn.appendChild(jscolor.picker.btnS);jscolor.picker.box.appendChild(jscolor.picker.btn);jscolor.picker.boxB.appendChild(jscolor.picker.box)}p=jscolor.picker;p.box.onmouseup=p.box.onmouseout=function(){target.focus()};p.box.onmousedown=function(){abortBlur=!0};p.box.onmousemove=function(e){(holdPad||holdSld)&&(holdPad&&setPad(e),holdSld&&setSld(e),document.selection?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges(),dispatchImmediateChange())};p.padM.onmouseup=p.padM.onmouseout=function(){holdPad&&(holdPad=!1,jscolor.fireEvent(valueElement,"change"))};p.padM.onmousedown=function(e){switch(modeID){case 0:THIS.hsv[2]===0&&THIS.fromHSV(null,null,1);break;case 1:THIS.hsv[1]===0&&THIS.fromHSV(null,1,null)}holdPad=!0;setPad(e);dispatchImmediateChange()};p.sldM.onmouseup=p.sldM.onmouseout=function(){holdSld&&(holdSld=!1,jscolor.fireEvent(valueElement,"change"))};p.sldM.onmousedown=function(e){holdSld=!0;setSld(e);dispatchImmediateChange()};dims=getPickerDims(THIS);p.box.style.width=dims[0]+"px";p.box.style.height=dims[1]+"px";p.boxB.style.position="absolute";p.boxB.style.clear="both";p.boxB.style.left=x+"px";p.boxB.style.top=y+"px";p.boxB.style.zIndex=THIS.pickerZIndex;p.boxB.style.border=THIS.pickerBorder+"px solid";p.boxB.style.borderColor=THIS.pickerBorderColor;p.boxB.style.background=THIS.pickerFaceColor;p.pad.style.width=jscolor.images.pad[0]+"px";p.pad.style.height=jscolor.images.pad[1]+"px";p.padB.style.position="absolute";p.padB.style.left=THIS.pickerFace+"px";p.padB.style.top=THIS.pickerFace+"px";p.padB.style.border=THIS.pickerInset+"px solid";p.padB.style.borderColor=THIS.pickerInsetColor;p.padM.style.position="absolute";p.padM.style.left="0";p.padM.style.top="0";p.padM.style.width=THIS.pickerFace+2*THIS.pickerInset+jscolor.images.pad[0]+jscolor.images.arrow[0]+"px";p.padM.style.height=p.box.style.height;p.padM.style.cursor="crosshair";p.sld.style.overflow="hidden";p.sld.style.width=jscolor.images.sld[0]+"px";p.sld.style.height=jscolor.images.sld[1]+"px";p.sldB.style.display=THIS.slider?"block":"none";p.sldB.style.position="absolute";p.sldB.style.right=THIS.pickerFace+"px";p.sldB.style.top=THIS.pickerFace+"px";p.sldB.style.border=THIS.pickerInset+"px solid";p.sldB.style.borderColor=THIS.pickerInsetColor;p.sldM.style.display=THIS.slider?"block":"none";p.sldM.style.position="absolute";p.sldM.style.right="0";p.sldM.style.top="0";p.sldM.style.width=jscolor.images.sld[0]+jscolor.images.arrow[0]+THIS.pickerFace+2*THIS.pickerInset+"px";p.sldM.style.height=p.box.style.height;try{p.sldM.style.cursor="pointer"}catch(eOldIE){p.sldM.style.cursor="hand"}p.btn.style.display=THIS.pickerClosable?"block":"none";p.btn.style.position="absolute";p.btn.style.left=THIS.pickerFace+"px";p.btn.style.bottom=THIS.pickerFace+"px";p.btn.style.padding="0 15px";p.btn.style.height="18px";p.btn.style.border=THIS.pickerInset+"px solid";setBtnBorder();p.btn.style.color=THIS.pickerButtonColor;p.btn.style.font="12px sans-serif";p.btn.style.textAlign="center";try{p.btn.style.cursor="pointer"}catch(eOldIE){p.btn.style.cursor="hand"}p.btn.onmousedown=function(){THIS.hidePicker()};p.btnS.style.lineHeight=p.btn.style.height;switch(modeID){case 0:padImg="hs.png";break;case 1:padImg="hv.png"}p.padM.style.backgroundImage="url('"+jscolor.getDir()+"cross.gif')";p.padM.style.backgroundRepeat="no-repeat";p.sldM.style.backgroundImage="url('"+jscolor.getDir()+"arrow.gif')";p.sldM.style.backgroundRepeat="no-repeat";p.pad.style.backgroundImage="url('"+jscolor.getDir()+padImg+"')";p.pad.style.backgroundRepeat="no-repeat";p.pad.style.backgroundPosition="0 0";redrawPad();redrawSld();jscolor.picker.owner=THIS;document.getElementsByTagName("body")[0].appendChild(p.boxB)}function getPickerDims(o){return[2*o.pickerInset+2*o.pickerFace+jscolor.images.pad[0]+(o.slider?2*o.pickerInset+2*jscolor.images.arrow[0]+jscolor.images.sld[0]:0),o.pickerClosable?4*o.pickerInset+3*o.pickerFace+jscolor.images.pad[1]+o.pickerButtonHeight:2*o.pickerInset+2*o.pickerFace+jscolor.images.pad[1]]}function redrawPad(){var yComponent,x,y,seg,rgb,i;switch(modeID){case 0:yComponent=1;break;case 1:yComponent=2}x=Math.round(THIS.hsv[0]/6*(jscolor.images.pad[0]-1));y=Math.round((1-THIS.hsv[yComponent])*(jscolor.images.pad[1]-1));jscolor.picker.padM.style.backgroundPosition=THIS.pickerFace+THIS.pickerInset+x-Math.floor(jscolor.images.cross[0]/2)+"px "+(THIS.pickerFace+THIS.pickerInset+y-Math.floor(jscolor.images.cross[1]/2))+"px";seg=jscolor.picker.sld.childNodes;switch(modeID){case 0:for(rgb=HSV_RGB(THIS.hsv[0],THIS.hsv[1],1),i=0;i<seg.length;i+=1)seg[i].style.backgroundColor="rgb("+rgb[0]*(1-i/seg.length)*100+"%,"+rgb[1]*(1-i/seg.length)*100+"%,"+rgb[2]*(1-i/seg.length)*100+"%)";break;case 1:var rgb,s,c=[THIS.hsv[2],0,0],i=Math.floor(THIS.hsv[0]),f=i%2?THIS.hsv[0]-i:1-(THIS.hsv[0]-i);switch(i){case 6:case 0:rgb=[0,1,2];break;case 1:rgb=[1,0,2];break;case 2:rgb=[2,0,1];break;case 3:rgb=[2,1,0];break;case 4:rgb=[1,2,0];break;case 5:rgb=[0,2,1]}for(i=0;i<seg.length;i+=1)s=1-1/(seg.length-1)*i,c[1]=c[0]*(1-s*f),c[2]=c[0]*(1-s),seg[i].style.backgroundColor="rgb("+c[rgb[0]]*100+"%,"+c[rgb[1]]*100+"%,"+c[rgb[2]]*100+"%)"}}function redrawSld(){var yComponent,y;switch(modeID){case 0:yComponent=2;break;case 1:yComponent=1}y=Math.round((1-THIS.hsv[yComponent])*(jscolor.images.sld[1]-1));jscolor.picker.sldM.style.backgroundPosition="0 "+(THIS.pickerFace+THIS.pickerInset+y-Math.floor(jscolor.images.arrow[1]/2))+"px"}function isPickerOwner(){return jscolor.picker&&jscolor.picker.owner===THIS}function blurTarget(){valueElement===target&&THIS.importColor();THIS.pickerOnfocus&&THIS.hidePicker()}function blurValue(){valueElement!==target&&THIS.importColor()}function setPad(e){var mpos=jscolor.getRelMousePos(e),x=mpos.x-THIS.pickerFace-THIS.pickerInset,y=mpos.y-THIS.pickerFace-THIS.pickerInset;switch(modeID){case 0:THIS.fromHSV(x*(6/(jscolor.images.pad[0]-1)),1-y/(jscolor.images.pad[1]-1),null,leaveSld);break;case 1:THIS.fromHSV(x*(6/(jscolor.images.pad[0]-1)),null,1-y/(jscolor.images.pad[1]-1),leaveSld)}}function setSld(e){var mpos=jscolor.getRelMousePos(e),y=mpos.y-THIS.pickerFace-THIS.pickerInset;switch(modeID){case 0:THIS.fromHSV(null,null,1-y/(jscolor.images.sld[1]-1),leavePad);break;case 1:THIS.fromHSV(null,1-y/(jscolor.images.sld[1]-1),null,leavePad)}}function dispatchImmediateChange(){if(THIS.onImmediateChange)if(typeof THIS.onImmediateChange=="string")eval(THIS.onImmediateChange);else THIS.onImmediateChange(THIS)}var p,updateField;this.required=!0;this.adjust=!0;this.hash=!1;this.caps=!0;this.slider=!0;this.valueElement=target;this.styleElement=target;this.onImmediateChange=null;this.hsv=[0,0,1];this.rgb=[1,1,1];this.pickerOnfocus=!0;this.pickerMode="HSV";this.pickerPosition="bottom";this.pickerSmartPosition=!0;this.pickerButtonHeight=20;this.pickerClosable=!1;this.pickerCloseText="Close";this.pickerButtonColor="ButtonText";this.pickerFace=10;this.pickerFaceColor="ThreeDFace";this.pickerBorder=1;this.pickerBorderColor="ThreeDHighlight ThreeDShadow ThreeDShadow ThreeDHighlight";this.pickerInset=1;this.pickerInsetColor="ThreeDShadow ThreeDHighlight ThreeDHighlight ThreeDShadow";this.pickerZIndex=1e4;for(p in prop)prop.hasOwnProperty(p)&&(this[p]=prop[p]);this.hidePicker=function(){isPickerOwner()&&removePicker()};this.showPicker=function(){var l,pp;if(!isPickerOwner()){var tp=jscolor.getElementPos(target),ts=jscolor.getElementSize(target),vp=jscolor.getViewPos(),vs=jscolor.getViewSize(),ps=getPickerDims(this),a,b,c;switch(this.pickerPosition.toLowerCase()){case"left":a=1;b=0;c=-1;break;case"right":a=1;b=0;c=1;break;case"top":a=0;b=1;c=-1;break;default:a=0;b=1;c=1}l=(ts[b]+ps[b])/2;pp=this.pickerSmartPosition?[-vp[a]+tp[a]+ps[a]>vs[a]?-vp[a]+tp[a]+ts[a]/2>vs[a]/2&&tp[a]+ts[a]-ps[a]>=0?tp[a]+ts[a]-ps[a]:tp[a]:tp[a],-vp[b]+tp[b]+ts[b]+ps[b]-l+l*c>vs[b]?-vp[b]+tp[b]+ts[b]/2>vs[b]/2&&tp[b]+ts[b]-l-l*c>=0?tp[b]+ts[b]-l-l*c:tp[b]+ts[b]-l+l*c:tp[b]+ts[b]-l+l*c>=0?tp[b]+ts[b]-l+l*c:tp[b]+ts[b]-l-l*c]:[tp[a],tp[b]+ts[b]-l+l*c];drawPicker(pp[a],pp[b])}};this.importColor=function(){valueElement?this.adjust?!this.required&&/^\s*$/.test(valueElement.value)?(valueElement.value="",styleElement.style.backgroundImage=styleElement.jscStyle.backgroundImage,styleElement.style.backgroundColor=styleElement.jscStyle.backgroundColor,styleElement.style.color=styleElement.jscStyle.color,this.exportColor(leaveValue|leaveStyle)):this.fromString(valueElement.value)||this.exportColor():this.fromString(valueElement.value,leaveValue)||(styleElement.style.backgroundImage=styleElement.jscStyle.backgroundImage,styleElement.style.backgroundColor=styleElement.jscStyle.backgroundColor,styleElement.style.color=styleElement.jscStyle.color,this.exportColor(leaveValue|leaveStyle)):this.exportColor()};this.exportColor=function(flags){if(!(flags&leaveValue)&&valueElement){var value=this.toString();this.caps&&(value=value.toUpperCase());this.hash&&(value="#"+value);valueElement.value=value}flags&leaveStyle||!styleElement||(styleElement.style.backgroundImage="none",styleElement.style.backgroundColor="#"+this.toString(),styleElement.style.color=.213*this.rgb[0]+.715*this.rgb[1]+.072*this.rgb[2]<.5?"#FFF":"#000");flags&leavePad||!isPickerOwner()||redrawPad();flags&leaveSld||!isPickerOwner()||redrawSld()};this.fromHSV=function(h,s,v,flags){h<0&&(h=0)||h>6&&(h=6);s<0&&(s=0)||s>1&&(s=1);v<0&&(v=0)||v>1&&(v=1);this.rgb=HSV_RGB(h===null?this.hsv[0]:this.hsv[0]=h,s===null?this.hsv[1]:this.hsv[1]=s,v===null?this.hsv[2]:this.hsv[2]=v);this.exportColor(flags)};this.fromRGB=function(r,g,b,flags){r<0&&(r=0)||r>1&&(r=1);g<0&&(g=0)||g>1&&(g=1);b<0&&(b=0)||b>1&&(b=1);var hsv=RGB_HSV(r===null?this.rgb[0]:this.rgb[0]=r,g===null?this.rgb[1]:this.rgb[1]=g,b===null?this.rgb[2]:this.rgb[2]=b);hsv[0]!==null&&(this.hsv[0]=hsv[0]);hsv[2]!==0&&(this.hsv[1]=hsv[1]);this.hsv[2]=hsv[2];this.exportColor(flags)};this.fromString=function(hex,flags){var m=hex.match(/^\W*([0-9A-F]{3}([0-9A-F]{3})?)\W*$/i);return m?(m[1].length===6?this.fromRGB(parseInt(m[1].substr(0,2),16)/255,parseInt(m[1].substr(2,2),16)/255,parseInt(m[1].substr(4,2),16)/255,flags):this.fromRGB(parseInt(m[1].charAt(0)+m[1].charAt(0),16)/255,parseInt(m[1].charAt(1)+m[1].charAt(1),16)/255,parseInt(m[1].charAt(2)+m[1].charAt(2),16)/255,flags),!0):!1};this.toString=function(){return(256|Math.round(255*this.rgb[0])).toString(16).substr(1)+(256|Math.round(255*this.rgb[1])).toString(16).substr(1)+(256|Math.round(255*this.rgb[2])).toString(16).substr(1)};var THIS=this,modeID=this.pickerMode.toLowerCase()==="hvs"?1:0,abortBlur=!1,valueElement=jscolor.fetchElement(this.valueElement),styleElement=jscolor.fetchElement(this.styleElement),holdPad=!1,holdSld=!1,leaveValue=1,leaveStyle=2,leavePad=4,leaveSld=8;jscolor.addEvent(target,"focus",function(){THIS.pickerOnfocus&&THIS.showPicker()});jscolor.addEvent(target,"blur",function(){abortBlur?abortBlur=!1:window.setTimeout(function(){abortBlur||blurTarget();abortBlur=!1},0)});valueElement&&(updateField=function(){THIS.fromString(valueElement.value,leaveValue);dispatchImmediateChange()},jscolor.addEvent(valueElement,"keyup",updateField),jscolor.addEvent(valueElement,"input",updateField),jscolor.addEvent(valueElement,"blur",blurValue),valueElement.setAttribute("autocomplete","off"));styleElement&&(styleElement.jscStyle={backgroundImage:styleElement.style.backgroundImage,backgroundColor:styleElement.style.backgroundColor,color:styleElement.style.color});switch(modeID){case 0:jscolor.requireImage("hs.png");break;case 1:jscolor.requireImage("hv.png")}jscolor.requireImage("cross.gif");jscolor.requireImage("arrow.gif");this.importColor()}};jscolor.install();Oskari.registerLocalization({lang:"fi",key:"MyPlaces2",value:{title:"Kohteet",desc:"",category:{defaultName:"Oma karttataso",organization:"Omat kohteet",inspire:"Kohteet"},guest:{loginShort:"Kirjaudu sisn kyttksesi"},tools:{point:{tooltip:"Lis piste","new":"Lis piste klikkaamalla karttaa.",edit:"Siirr pistett raahaamalla.",save:"Tallenna sijainti"},line:{tooltip:"Lis viiva","new":"Lis viivan taitepiste klikkaamalla karttaa. Lopeta piirto tuplaklikkauksella tai painamalla 'Lopeta piirto'.",edit:"Muokkaa viivaa raahaamalla viivan taitepisteit.",save:"Tallenna muoto",noResult:"0 m"},area:{tooltip:"Lis alue","new":"Lis alueen taitepisteet klikkaamalla karttaa. Lopeta piirto tuplaklikkauksella tai painamalla 'Lopeta piirto'.",edit:"Muokkaa muotoa raahaamalla reunaviivan taitepisteit.",save:"Tallenna muoto",noResult:"0 m"},circle:{tooltip:"Lis ympyr","new":"Lis ympyr raahamalla kartalla. Lopeta piirto vapauttamalla hiiren painike.",edit:"Muokkaa muotoa raahaamalla reunaviivan taitepisteit.",save:"Tallenna muoto"},ellipse:{tooltip:"Lis ellipsi","new":"Lis ellipsi raahamalla kartalla. Lopeta piirto vapauttamalla hiiren painike.",edit:"Muokkaa muotoa raahaamalla reunaviivan taitepisteit.",save:"Tallenna muoto"}},buttons:{ok:"OK",cancel:"Peruuta",finish:"Lopeta piirto",save:"Tallenna",deleteButton:"Poista",movePlaces:"Siirr kohteet ja poista",deleteCategory:"Poista",deleteCategoryAndPlaces:"Poista kohteineen",changeToPublic:"Muuta julkiseksi",changeToPrivate:"Muuta yksityiseksi"},placeform:{title:"Kohteen tiedot",tooltip:"Kun list kohteen kartalle, se tallentuu Omiin tietoihisi. Anna kohteelle nimi ja kuvaus.",placename:{placeholder:"Anna kohteelle nimi",label:"Kohteen nimi"},placelink:{placeholder:"Anna URL-osoite"},placedesc:{placeholder:"Kuvaile kohdetta",label:"Kohteen kuvaus"},category:{label:"Karttataso","new":"Uusi taso..."},placeheight:{placeholder:"Anna korkeus tai syvyys",label:"Kohteen korkeus / syvyys metreiss"},placewidth:{placeholder:"Anna leveys",label:"Kohteen leveys (muuttaa kohteen alueeksi)"},area:{label:"Pinta-ala (m2)"},length:{label:"Pituus (m)"}},categoryform:{name:{label:"Nimi",placeholder:"Anna tasolle nimi"},drawing:{label:"Piirtojlki",point:{label:"Piste",color:"Vri",size:"Koko"},line:{label:"Viiva",color:"Vri",size:"Paksuus"},area:{label:"Alue",fillcolor:"Tyttvri",linecolor:"Viivan vri",size:"Viivan paksuus"}},edit:{title:"Muokkaa karttatasoa",save:"Tallenna",cancel:"Peruuta"}},notification:{placeAdded:{title:"Kohde tallennettu",message:"Lydt kohteen Omat Tiedot -valikosta."},placeDelete:{title:"Kohteen poistaminen",confirm:"Haluatko poistaa kohteen?",btnDelete:"Poista",btnCancel:"Peruuta",success:"Kohde on poistettu.",cancel:"Peruuta"},categorySaved:{title:"Karttataso tallennettu",message:"Karttatason muutokset on tallennettu."},categoryDelete:{title:"Karttatason poisto",deleteConfirmMove:"Karttataso: {0} sislt kohteita {1} kpl. Haluatko poistaa tason ja siirt sen kohteet oletuskarttatasolle {2}?",deleteConfirm:"Haluatko poistaa karttatason {0}?",deleted:"Karttataso poistettu."},categoryToPublic:{title:"Muuta karttataso julkiseksi",message:'Olet muuttamassa karttatasoa "{0}" julkiseksi. Voit jakaa julkisen karttatason verkossa tai julkaista sen karttana toiseen verkkopalveluun. Muut kyttjt voivat mys katsoa karttatasoa Paikkatietoikkunassa.'},categoryToPrivate:{title:"Muuta karttataso yksityiseksi",message:'Olet muuttamassa karttatasoa "{0}" yksityiseksi. Tmn jlkeen et voi jakaa tai julkaista karttana, eivtk muut kyttjt ne sit Paikkatietoikkunassa.'},error:{addCategory:"Tason tallennus eponnistui. Kohdetta ei ole tallennettu.",editCategory:"Tason tallennus eponnistui.",savePlace:"Kohteen tallentaminen ei onnistunut.",deletePlace:"Kohteen poistaminen eponnistui. Kokeile uudestaan myhemmin.",title:"Virhe!",generic:"Jrjestelmss tapahtui virhe. Yrit uudelleen myhemmin.",deleteCategory:"Virhe poistossa!",deleteDefault:"Oletuskarttatasoa ei voi poistaa."}},validation:{title:"Tiedoissa puutteita:",placeName:"Kohteen nimi puuttuu.",categoryName:"Tason nimi puuttuu.",placeNameIllegal:"Kohteen nimess on luvattomia merkkej. Sallittuja merkkej ovat kaikki suomen kielen aakkoset, numerot sek vlilynti ja yhdysmerkki.",descIllegal:"Kohteen kuvauksessa on luvattomia merkkej. Sallittuja merkkej ovat kaikki suomen kielen aakkoset, numerot sek vlilynti ja yhdysmerkki.",categoryNameIllegal:"Tason nimess on luvattomia merkkej. Sallittuja merkkej ovat kaikki suomen kielen aakkoset, numerot sek vlilynti ja yhdysmerkki.",dotSize:"Pisteen koko ei ole sallituissa rajoissa (1-50).",dotColor:"Pisteen vri virheellinen.",lineSize:"Viivan koko ei ole sallituissa rajoissa (1-50).",lineColor:"Viivan vri virheellinen.",areaLineSize:"Alueen viivan koko ei ole sallituissa rajoissa (0-50).",areaLineColor:"Alueen viivan vri virheellinen.",areaFillColor:"Alueen tyttvri virheellinen.",heightNotANumber:"Korkeus/syvyys arvon on oltava numero.",lengthNotANumber:"Pituus arvon on oltava numero.",widthNotANumber:"Leveys arvon on oltava positiivinen numero."}}});Oskari.registerLocalization({lang:"sv",key:"MyPlaces2",value:{title:"Objekt",desc:"",category:{defaultName:"Mitt kartlager",organization:"Mina objekt",inspire:"Objekt"},guest:{loginShort:"Logga in fr att anvnda"},tools:{point:{tooltip:"Tillgg punkt","new":"Tillgg punkt genom att klicka p kartan.",edit:"Flytta p punkten genom att klicka och dra.",save:"Lagra lge"},line:{tooltip:"Tillgg linje","new":"Tillgg en brytningspunkt p linjen genom att klicka p kartan. Sluta rita genom att dubbelklicka eller klicka p 'Sluta rita'.",edit:"Editera linjen genom att klicka och dra brytningspunkterna.",save:"Lagra form",noResult:"0 m"},area:{tooltip:"Tillgg omrde","new":"Tillgg omrdets hrnpunkter genom att klicka p kartan. Sluta rita genom att dubbelklicka eller klicka p 'Sluta rita'.",edit:"Editera omrdets form genom att klicka och dra brytningspunkterna p omkretslinjen.",save:"Lagra form",noResult:"0 m"},circle:{tooltip:"Add circle","new":"Draw a circle by clicking the map and dragging. Stop drawing by releasing the mouse button.",edit:"Edit the shape of the circle by clicking and dragging the break points on its edge line.",save:"Save shape"},ellipse:{tooltip:"Add ellipse","new":"Draw an ellipse by clicking the map and dragging. Stop drawing by releasing the mouse button.",edit:"Edit the shape of the ellipse by clicking and dragging the break points on its edge line.",save:"Save shape"}},buttons:{ok:"OK",cancel:"Tillbaka",finish:"Sluta rita",save:"Lagra",deleteButton:"Ta bort",movePlaces:"Flytta objekt och ta bort",deleteCategory:"Ta bort",deleteCategoryAndPlaces:"Ta bort kategori inklusive objekt",changeToPublic:"ndra till offentlig",changeToPrivate:"ndra till privat"},placeform:{title:"Uppgifter om objektet",tooltip:"Nr du lgger ett objekt p kartan lagras det i dina objekt. Ge objektet ett namn och en beskrivning.",placename:{placeholder:"Namnge objektet",label:""},placelink:{placeholder:"Ge URL-address"},placedesc:{placeholder:"Beskriv objektet",label:""},category:{label:"Kartlager","new":"Ny niv..."},placeheight:{placeholder:"Ge en hjd eller djup",label:""},placewidth:{placeholder:"Ge en bredd",label:""},area:{label:"Areal (m2)"},length:{label:"Lngd (m)"}},categoryform:{name:{label:"Namn",placeholder:"Namnge kartlagret"},drawing:{label:"Stil",point:{label:"Punkt",color:"Frg",size:"Storlek"},line:{label:"Linje",color:"Frg",size:"Tjocklek"},area:{label:"Omrde",fillcolor:"Ifyllnadsfrg",linecolor:"Linjens frg",size:"Linjens tjocklek"}},edit:{title:"Editera kartlagret",save:"Lagra",cancel:"Tillbaka"}},notification:{placeAdded:{title:"Objektet har lagrats",message:"Objektet finns i menyn Mina uppgifter"},placeDelete:{title:"Ta bort objekt",confirm:"Vill du ta bort detta objekt?",btnDelete:"Ta bort",btnCancel:"Tillbaka",success:"Objektet har tagits bort.",cancel:"Tillbaka"},categorySaved:{title:"Kartlagret har lagrats",message:"ndringar i kartlagret har lagrats"},categoryDelete:{title:"Ta bort kartlager",deleteConfirmMove:"Kartlager: {0} innehller {1} st. objekt. Vill du ta bort nivn och flytta objekten p den till det frvalda kartlagret {2} ?",deleteConfirm:"Vill du ta bort kartlagret {0}?",deleted:"Kartlagret borttaget"},categoryToPublic:{title:"Offentliggr kartlagret",message:'Du hller p att offentliggra kartlagret "{0}". Du kan skicka lnkar till ett offentligt kartlager till andra internetanvndare eller inbdda det som en karta i en annan webbtjnst. Andra anvndare kan ven titta p kartlagret i Paikkatietoikkuna.'},categoryToPrivate:{title:"Gr kartlagret privat",message:'Du hller p att gra kartlagret "{0}" privat. Efter detta kan du inte lngre skicka lnkar frn kart-lagret eller inbdda det som en karta, andra anvndare kan inte heller titta p det i Paikkatietoikkuna.'},error:{addCategory:"Kartlagret kunde inte lagras. Objektet har inte lagrats.",editCategory:"Kartlagret kunde inte lagras.",savePlace:"Objektet kunde inte lagras.",deletePlace:"Objektet kunde inte tas bort. Prova p nytt senare.",title:"Fel!",generic:"Systemfel. Frsk p nytt senare.",deleteCategory:"Fel i borttagningen!",deleteDefault:"Den frvalda kartlagret kan inte tas bort."}},validation:{title:"Brister i uppgifterna:",placeName:"Objektets namn saknas.",categoryName:"kartlagrets namn saknas.",placeNameIllegal:"I objekts namnet ingr otilltna tecken. Tilltna r alla bokstver i det svenska alfabetet, siffror, mellanslag och bindestreck.",descIllegal:"I objekts beskrivning ingr otilltna tecken. Tilltna r alla bokstver i det svenska alfabetet, siffror, mellanslag och bindestreck.",categoryNameIllegal:"I kartlagers beskrivning ingr otilltna tecken. Tilltna r alla bokstver i det svenska alfabetet, siffror, mellanslag och bindestreck.",dotSize:"Punkternas storlek r utanfr de tilltna grnserna (1-50).",dotColor:"Punktens frg r felaktig.",lineSize:"Linjens storlek r utanfr de tilltna grnserna (1-50).",lineColor:"Linjens frg r felaktig.",areaLineSize:"Omrdets konturlinje r utanfr de tilltna grnserna (0-50).",areaLineColor:"Frgen p omrdets omkretslinje r felaktig.",areaFillColor:"Omrdets ifyllnadsfrg r felaktig.",heightNotANumber:"Den hojd/djup varde maste vara ett nummer.",lengthNotANumber:"Den lngd varde maste vara ett nummer.",widthNotANumber:"Den bredd varde maste vara ett positivt nummer."}}});Oskari.registerLocalization({lang:"en",key:"MyPlaces2",value:{title:"Places",desc:"",category:{defaultName:"My map layer",organization:"My places",inspire:"Places"},guest:{loginShort:"Log in to use"},tools:{point:{tooltip:"Add point","new":"Add point by clicking the map.",edit:"Move point by clicking and dragging.",save:"Save location"},line:{tooltip:"Add line","new":"Add a break point on the line by clicking the map. Stop drawing by double clicking or by clicking 'Finish drawing'.",edit:"Edit the line by clicking and dragging its break points.",save:"Save shape",noResult:"0 m"},area:{tooltip:"Add area","new":"Add break points to your area polygon by clicking the map. Stop drawing by double clicking or by clicking 'Finish drawing'.",edit:"Edit the shape of the area by clicking and dragging the break points on its edge line.",save:"Save shape",noResult:"0 m"},circle:{tooltip:"Add circle","new":"Draw a circle by clicking the map and dragging. Stop drawing by releasing the mouse button.",edit:"Edit the shape of the circle by clicking and dragging the break points on its edge line.",save:"Save shape"},ellipse:{tooltip:"Add ellipse","new":"Draw an ellipse by clicking the map and dragging. Stop drawing by releasing the mouse button.",edit:"Edit the shape of the ellipse by clicking and dragging the break points on its edge line.",save:"Save shape"}},buttons:{ok:"OK",cancel:"Cancel",finish:"Finish drawing",save:"Save",deleteButton:"Delete",movePlaces:"Move places and delete",deleteCategory:"Delete",deleteCategoryAndPlaces:"Delete category and places",changeToPublic:"Make public",changeToPrivate:"Make private"},placeform:{title:"Place data",tooltip:"A place put on the map will be saved in My places. Give the place a name and describe it.",placename:{placeholder:"Give the place a name",label:"Place name"},placelink:{placeholder:"Give a URL"},placedesc:{placeholder:"Describe the place",label:"Place description"},category:{label:"Map layer","new":"New layer..."},placeheight:{placeholder:"Give a height or depth",label:"Place height / depth in meters"},placewidth:{placeholder:"Give a width",label:"Place width (turns feature to area)"},area:{label:"Area (m2)"},length:{label:"Length (m)"}},categoryform:{name:{label:"Name",placeholder:"Give the map layer a name"},drawing:{label:"Style",point:{label:"Point",color:"Colour",size:"Size"},line:{label:"Line",color:"Colour",size:"Thickness"},area:{label:"Area",fillcolor:"Fill-in colour",linecolor:"Line colour",size:"Line thickness"}},edit:{title:"Edit map layer",save:"Save",cancel:"Back"}},notification:{placeAdded:{title:"The place has been saved",message:"The place can be found in the My data menu"},placeDelete:{title:"Delete place",confirm:"Do you want to delete this place?",btnDelete:"Delete",btnCancel:"Cancel",success:"The place has been deleted.",cancel:"Cancel"},categorySaved:{title:"Map layer saved",message:"Map layer edits saved"},categoryDelete:{title:"Delete map layer",deleteConfirmMove:"Map layer {0} contains {1} objects. Do you want to delete the map layer and move the places on it to the default map layer {2} ?",deleteConfirm:"Delete map layer {0}?",deleted:"Map layer deleted"},categoryToPublic:{title:"Make map layer public",message:'You are making the map layer "{0}" public. You can share links to a public map layer with other internet users or embed the map layer as a map window on another website. Other users can also view the map layer in Paikkatietoikkuna.'},categoryToPrivate:{title:"Make map layer private",message:'You are making the map layer "{0}" private. After this it will no longer be possible to share it with other users or embed it on another website. Other users can no longer view the map layer in Paikkatietoikkuna.'},error:{addCategory:"The map layer could not be saved. The place has not been saved.",editCategory:"The map layer could not be saved.",savePlace:"The place could not be saved.",deletePlace:"The place could not be deleted. Please try again later.",title:"Error!",generic:"System error. Please try again later.",deleteCategory:"Error occurred while deleting!",deleteDefault:"The default map layer cannot be deleted."}},validation:{title:"Data contains errors:",placeName:"Place name missing.",categoryName:"Map layer name missing.",placeNameIllegal:"The object name contains disallowed characters. Allowed characters are the letters a-z as well as ,  and , numbers, backspaces and hyphens.",descIllegal:"The object description contains disallowed characters. Allowed characters are the letters a-z as well as ,  and , numbers, backspaces and hyphens.",categoryNameIllegal:"The layer description contains disallowed characters. Allowed characters are the letters a-z as well as ,  and , numbers, backspaces and hyphens.",dotSize:"The dot size does not fit the size limits (1-50).",dotColor:"Wrong dot colour.",lineSize:"The line size does not fit the size limits (1-50).",lineColor:"Wrong line colour.",areaLineSize:"The area edge size does not fit the limits (0-50).",areaLineColor:"Wrong area edge line colour.",areaFillColor:"Wrong fill-in colour.",heightNotANumber:"The height/depth value must be a number.",lengthNotANumber:"The length value must be a number.",widthNotANumber:"The width value must be a positive number."}}});Oskari.clazz.define("Oskari.lupapiste.bundle.lupakartta.lupakarttaBundle",function(){},{create:function(){var me=this;return Oskari.clazz.create("Oskari.lupapiste.bundle.lupakartta.lupakarttaInstance")},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupakartta/instance.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupakartta/plugin/Markers.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupakartta/request/ClearMapRequest.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupakartta/request/ClearMapRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupakartta/request/AddMarkerRequest.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupakartta/request/AddMarkerRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupakartta/event/PlaceSaved.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupakartta/event/FeaturesAdded.js"},{type:"text/javascript",src:"../../../../libraries/jsts/javascript.util.js"},{type:"text/javascript",src:"../../../../libraries/jsts/jsts.js"},{type:"text/css",src:"../../../../resources/lupapiste/bundle/lupakartta/css/lupakartta.css"}]},bundle:{manifest:{"Bundle-Identifier":"lupakartta","Bundle-Name":"lupakartta","Bundle-Author":[{Name:"ev",Organisation:"sito.fi",Temporal:{Start:"2012",End:"2013"},Copyleft:{License:{"License-Name":"","License-Online-Resource":""}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}},dependencies:[]});Oskari.bundle_manager.installBundleClass("lupakartta","Oskari.lupapiste.bundle.lupakartta.lupakarttaBundle");Oskari.clazz.define("Oskari.lupapiste.bundle.lupakartta.lupakarttaInstance",function(){this.sandbox=null},{__name:"lupakartta",jemma:{},getName:function(){return this.__name},getParameter:function(){return null},_isButtonConfigured:function(pId,pGroup){return this.conf&&(this.conf[pGroup]===!1||this.conf[pGroup]&&this.conf[pGroup][pId]===!1)?!1:!0},applicationId:null,start:function(){var me=this,sandbox,reqBuilder,tool,p,mapmodule,markersplugin,requestBuilder,request,selectControl;this.conf&&this.conf.id&&(this.applicationId=this.conf.id);sandbox=Oskari.$("sandbox");this.sandbox=sandbox;this.buttonGroup="lupakartta";this.buttons={closebutton:{iconCls:"lupakartta-close",tooltip:{fi:"Sulje kartta",sv:"Stng karta",en:"Close map"}[Oskari.getLang()],sticky:!1,callback:function(){window.close()},text:!0}};sandbox.register(me);for(p in me.eventHandlers)p&&sandbox.registerForEventByName(me,p);reqBuilder=sandbox.getRequestBuilder("Toolbar.AddToolButtonRequest");for(tool in this.buttons)this._isButtonConfigured(tool,this.buttonGroup)&&sandbox.request(this,reqBuilder(tool,this.buttonGroup,this.buttons[tool]));for(p in me.hubEventHandlers)p&&(me.hubEventHandlers[p].id=hub.subscribe(p,me.hubEventHandlers[p]));$(window).on("beforeunload",function(){for(var p in me.hubEventHandlers)p&&hub.unsubscribe(me.hubEventHandlers[p].id);hub.send("oskari-map-uninitialized")});mapmodule=this.sandbox.findRegisteredModuleInstance("MainMapModule");markersplugin=Oskari.clazz.create("Oskari.lupapiste.bundle.lupakartta.plugin.MarkersPlugin");mapmodule.registerPlugin(markersplugin);mapmodule.startPlugin(markersplugin);requestBuilder=sandbox.getRequestBuilder("DisableMapKeyboardMovementRequest");request=requestBuilder();sandbox.request("lupakartta",request);var map=sandbox.findRegisteredModuleInstance("MainMapModule").getMap(),styleMap=new OpenLayers.StyleMap({pointRadius:6,fillOpacity:.35,fillColor:"#3CB8EA",strokeColor:"#0000FF",strokeWidth:3,label:"${height}",fontSize:"20px"}),layerVectors=new OpenLayers.Layer.Vector("LupapisteVectors",{styleMap:styleMap});map.addLayer(layerVectors);selectControl=new OpenLayers.Control.SelectFeature(layerVectors,{onSelect:function(feature){if(feature.attributes.id!=null){var event=sandbox.getEventBuilder("LupaPisteMyPlaces.MyPlaceSelectedEvent")(feature.attributes.id);sandbox.notifyAll(event)}}});map.addControl(selectControl);selectControl.activate();sandbox.addRequestHandler("MapModulePlugin.GetFeatureInfoActivationRequest",{handleRequest:function(){}});var visibilityRequestBuilder=sandbox.getRequestBuilder("MapModulePlugin.MapLayerVisibilityRequest"),request,layers=sandbox.findAllSelectedMapLayers();jQuery.each(layers,function(){this.isVisible()&&(request=visibilityRequestBuilder(this.getId(),!1),sandbox.request("lupakartta",request),request=visibilityRequestBuilder(this.getId(),!0),sandbox.request("lupakartta",request))});hub.send("oskari-map-initialized")},init:function(){return null},getJemma:function(key){var me=this;return me.jemma[key]},setJemma:function(key,val){var me=this;return me.jemma[key]=val,!0},updatePrintableContent:function(){var sandbox=Oskari.$("sandbox"),eventBuilder=sandbox.getEventBuilder("Printout.PrintableContentEvent"),printEvent,map=sandbox.findRegisteredModuleInstance("MainMapModule").getMap(),layer=map.getLayersByName("LupapisteVectors")[0],jsonFormat,json;eventBuilder&&(jsonFormat=new OpenLayers.Format.GeoJSON,json=jsonFormat.write(layer.features),printEvent=eventBuilder(this.getName(),null,null,json),sandbox.notifyAll(printEvent))},stop:function(){},update:function(){},onEvent:function(event){var me=this,handler=me.eventHandlers[event.getName()];if(handler)return handler.apply(this,[event])},hubEventHandlers:{"oskari-set-layers":function(e){for(var sandbox=Oskari.$("sandbox"),i=0,layer,visible;e[i];)layer=sandbox.findMapLayerFromAllAvailable(e[i].name),layer!=null&&(e[i].action=="remove"?sandbox.postRequestByName("RemoveMapLayerRequest",[layer.getId()]):(sandbox.postRequestByName("AddMapLayerRequest",[layer.getId(),!1,layer.isBaseLayer()]),visible=!1,e[i].visible=="true"&&(visible=!0),sandbox.postRequestByName("MapModulePlugin.MapLayerVisibilityRequest",[e[i].name,visible]))),i++},"oskari-show-layers":function(e){for(var sandbox=Oskari.$("sandbox"),requestBuilder=sandbox.getRequestBuilder("MapModulePlugin.MapLayerVisibilityRequest"),i=0,visible,request;e[i];)visible=!1,e[i].visible=="true"&&(visible=!0),request=requestBuilder(e[i].name,visible),sandbox.request("lupakartta",request),i++},"oskari-center-map":function(e){var sandbox=Oskari.$("sandbox"),bounds,requestBuilder,request,i,mapmodule,markersPlugin,origCenter,minBbox;sandbox.printDebug("[Oskari.lupapiste.bundle.lupakartta.lupakarttaInstance] map-show-markers-request");e.clear!==undefined&&e.clear&&(requestBuilder=sandbox.getRequestBuilder("lupakartta.ClearMapRequest"),request=requestBuilder(),sandbox.request("lupakartta",request));for(i in e.data)e.data[i].location!=undefined&&(requestBuilder=sandbox.getRequestBuilder("lupakartta.AddMarkerRequest"),request=requestBuilder(e.data[i].location.x,e.data[i].location.y,e.data[i].id,e.data[i].events,e.data[i].iconUrl),sandbox.request("lupakartta",request));mapmodule=sandbox.findRegisteredModuleInstance("MainMapModule");markersPlugin=mapmodule.getPluginInstance("lupakartta.MarkersPlugin");bounds=markersPlugin.getMapMarkerBounds();bounds=bounds.scale(1.1);origCenter=bounds.getCenterLonLat();minBbox=500;Oskari.app.appConfig.lupakartta.conf.zoomMinBbox&&(minBbox=Oskari.app.appConfig.lupakartta.conf.zoomMinBbox/2);bounds.extend(origCenter.add(minBbox,minBbox));bounds.extend(origCenter.add(-minBbox,-minBbox));requestBuilder=sandbox.getRequestBuilder("MapMoveRequest");request=requestBuilder(bounds.getCenterLonLat().lon,bounds.getCenterLonLat().lat,bounds);sandbox.request("lupakartta",request)},"inforequest-map-start":function(e){var sandbox=Oskari.$("sandbox"),config,me,requestBuilder,request;sandbox.printDebug("[Oskari.lupapiste.bundle.lupakartta.lupakarttaInstance] draw-request "+e.drawMode);config={drawMode:e.drawMode};me=sandbox.findRegisteredModuleInstance("lupakartta");me.setJemma("currentdrawmode","inforequest_"+e.drawMode);e.clear!==undefined&&e.clear&&(requestBuilder=sandbox.getRequestBuilder("lupakartta.ClearMapRequest"),request=requestBuilder(),sandbox.request("lupakartta",request));requestBuilder=sandbox.getRequestBuilder("LupaPisteMyPlaces.StartDrawingRequest");request=requestBuilder(config);sandbox.request("lupakartta",request)},"map-get-geometry-request":function(){var sandbox=Oskari.$("sandbox"),requestBuilder,request;sandbox.printDebug("[Oskari.lupapiste.bundle.lupakartta.lupakarttaInstance] map-stop-editing-request");requestBuilder=sandbox.getRequestBuilder("LupaPisteMyPlaces.GetGeometryRequest");request=requestBuilder(function(ee){var me=Oskari.$("sandbox").findRegisteredModuleInstance("lupakartta");hub.send("oskari-save-drawings",{data:{drawings:JSON.stringify([ee]),id:me.applicationId}})});sandbox.request("lupakartta",request)},"map-stop-editing-request":function(){var requestBuilder=sandbox.getRequestBuilder("LupaPisteMyPlaces.StopDrawingRequest"),request=requestBuilder();sandbox.request("lupakartta",request)},"map-draw-start":function(e){var sandbox=Oskari.$("sandbox"),wkt,features,config,me,requestBuilder,request;if(sandbox.printDebug("[Oskari.lupapiste.bundle.lupakartta.lupakarttaInstance] draw-request "+e.drawMode),config={drawMode:e.drawMode},e.drawing&&(wkt=new OpenLayers.Format.WKT,features=wkt.read(e.drawing),features&&(features.constructor!=Array&&(features=[features]),config={drawMode:e.drawMode,geometry:features[0].geometry})),me=sandbox.findRegisteredModuleInstance("lupakartta"),me.setJemma("currentdrawmode","draw_"+e.drawMode),e.clear!==undefined&&e.clear&&(requestBuilder=sandbox.getRequestBuilder("lupakartta.ClearMapRequest"),request=requestBuilder(),sandbox.request("lupakartta",request)),e.drawMode=="mapwindow"){var bounds=sandbox.findRegisteredModuleInstance("MainMapModule").getMap().calculateBounds(),drawing=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(bounds.left,bounds.bottom),new OpenLayers.Geometry.Point(bounds.right,bounds.bottom),new OpenLayers.Geometry.Point(bounds.right,bounds.top),new OpenLayers.Geometry.Point(bounds.left,bounds.top)])]),config={drawMode:"area",geometry:drawing};requestBuilder=sandbox.getRequestBuilder("LupaPisteMyPlaces.StartDrawingRequest");request=requestBuilder(config);sandbox.request("lupakartta",request);requestBuilder=sandbox.getRequestBuilder("LupaPisteMyPlaces.StopDrawingRequest");request=requestBuilder();sandbox.request("lupakartta",request)}else requestBuilder=sandbox.getRequestBuilder("LupaPisteMyPlaces.StartDrawingRequest"),request=requestBuilder(config),sandbox.request("lupakartta",request)},"map-clear-request":function(){var sandbox=Oskari.$("sandbox"),requestBuilder,request,me;sandbox.printDebug("[Oskari.lupapiste.bundle.lupakartta.lupakarttaInstance] map-clear-request");requestBuilder=sandbox.getRequestBuilder("lupakartta.ClearMapRequest");request=requestBuilder();sandbox.request("lupakartta",request);me=sandbox.findRegisteredModuleInstance("lupakartta");me.updatePrintableContent()},"map-update-size":function(){var sandbox=Oskari.$("sandbox"),mapmodule,center,requestBuilder,request;sandbox.printDebug("[Oskari.lupapiste.bundle.lupakartta.lupakarttaInstance] map-update-size");mapmodule=sandbox.findRegisteredModuleInstance("MainMapModule");center=mapmodule.getMap().getCenter();mapmodule.getMap().updateSize();requestBuilder=sandbox.getRequestBuilder("MapMoveRequest");request=requestBuilder(center.lon,center.lat);sandbox.request("lupakartta",request)},"map-set-center":function(e){var sandbox=Oskari.$("sandbox");sandbox.printDebug("[Oskari.lupapiste.bundle.lupakartta.lupakarttaInstance] map-set-center");var mapmodule=sandbox.findRegisteredModuleInstance("MainMapModule"),requestBuilder=sandbox.getRequestBuilder("MapMoveRequest"),request=requestBuilder(e.x,e.y,e.zoom);sandbox.request("lupakartta",request)},"oskari-show-shapes":function(e){var sandbox=Oskari.$("sandbox"),map=sandbox.findRegisteredModuleInstance("MainMapModule").getMap(),layer=map.getLayersByName("LupapisteVectors")[0],service=sandbox.getService("Oskari.lupapiste.bundle.myplaces2.service.MyPlacesService"),places,i,drawing,place,style,wkt,feature,features,attributes,me;if(e.clear)for(layer.removeAllFeatures(),places=service.getAllMyPlaces(),i=0;i<places.length;++i)service._removeMyPlace(places[i].getId()),service._notifyDataChanged();for(i=0;i<e.drawings.length;++i)drawing=e.drawings[i],place=Oskari.clazz.create("Oskari.lupapiste.bundle.myplaces2.model.MyPlace"),place.setId(drawing.id),place.setName(drawing.name),place.setDescription(drawing.desc),place.setCategoryID(drawing.category),place.setArea(drawing.area),place.setHeight(drawing.height),place.setLength(drawing.length),style=null,typeof e.style!="undefined"&&e.style!==null&&(style=jQuery.extend({},e.style),style.label=style.label||place.getHeight(),style.fontSize=style.fontSize||"20px"),wkt=new OpenLayers.Format.WKT,features=wkt.read(drawing.geometry),features&&(attributes={id:place.getId(),name:place.getName(),desc:place.getDescription(),category:place.getCategoryID(),area:place.getArea(),length:place.getLength(),height:place.getHeight()},features.constructor!=Array?(feature=new OpenLayers.Feature.Vector(features.geometry,attributes,style),place.setGeometry(features.geometry)):(feature=new OpenLayers.Feature.Vector(features[0].geometry,attributes,style),place.setGeometry(features[0].geometry))),layer.getFeatureBy("id",place.getId())&&layer.removeFeatures([layer.getFeatureBy("id",place.getId())]),feature&&feature.geometry&&(layer.addFeatures([feature]),service._removeMyPlace(place.getId()),service._addMyPlace(place),service._notifyDataChanged());me=sandbox.findRegisteredModuleInstance("lupakartta");me.updatePrintableContent()}},eventHandlers:{"Lupapiste.FeaturesAdded":function(event){for(var drawings=[],features=event.getFeatures(),i=0;i<features.length;++i)drawings.push({id:features[i].attributes.id,name:features[i].attributes.name,desc:"",category:features[i].attributes.category,geometry:features[i].geometry.toString(),area:"",height:"",length:""});hub.send("oskari-save-drawings",{data:{drawings:JSON.stringify(drawings),applicationId:this.applicationId}});this.updatePrintableContent()},"Lupapiste.PlaceSaved":function(event){for(var drawings=[],places=event.getPlaces(),i=0;i<places.length;++i)drawings.push({id:places[i].getId(),name:places[i].getName(),desc:places[i].getDescription(),category:places[i].getCategoryID(),geometry:places[i].getGeometry().toString(),area:places[i].getArea(),height:places[i].getHeight(),length:places[i].getLength()});hub.send("oskari-save-drawings",{data:{drawings:JSON.stringify(drawings),applicationId:this.applicationId}});this.updatePrintableContent()},"LupaPisteMyPlaces.FinishedDrawingEvent_":function(event){var requestBuilder,request,i;if(this.getJemma("currentdrawmode").indexOf("inforequest_")==0&&(requestBuilder=this.sandbox.getRequestBuilder("lupakartta.AddMarkerRequest"),request=requestBuilder(event._drawing.x,event._drawing.y,null,null,"http://www.openlayers.org/dev/img/marker-green.png"),this.sandbox.request("lupakartta",request),requestBuilder=this.sandbox.getRequestBuilder("LupaPisteMyPlaces.StopDrawingRequest"),request=requestBuilder(),this.sandbox.request("lupakartta",request),hub.send("inforequest-map-click",{data:{location:{x:event._drawing.x,y:event._drawing.y}}})),this.getJemma("currentdrawmode").indexOf("inforequest_")<0){requestBuilder=this.sandbox.getRequestBuilder("LupaPisteMyPlaces.StopDrawingRequest");request=requestBuilder(!0);this.sandbox.request("lupakartta",request);hub.send("oskari-show-shapes",{drawing:event._drawing.toString(),clear:!1});var drawings=[],sandbox=Oskari.$("sandbox"),map=sandbox.findRegisteredModuleInstance("MainMapModule").getMap(),layer=map.getLayersByName("LupapisteVectors");for(i=0;i<layer[0].features.length;++i)drawings.push(layer[0].features[i]);hub.send("oskari-save-drawings",{data:{drawings:JSON.stringify(drawings),applicationId:this.applicationId}});this.updatePrintableContent()}}}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.mapframework.request.Request","Oskari.userinterface.Stateful"]});Oskari.clazz.define("Oskari.lupapiste.bundle.lupakartta.plugin.MarkersPlugin",function(){this.mapModule=null;this.pluginName=null;this._sandbox=null;this._map=null},{__name:"lupakartta.MarkersPlugin",_markers:[],getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(mapModule){this.mapModule=mapModule;this.pluginName=mapModule.getName()+this.__name},init:function(sandbox){var me=this;this.requestHandlers={clearMapHandler:Oskari.clazz.create("Oskari.lupapiste.bundle.lupakartta.request.ClearMapRequestHandler",sandbox,me),addMarkerHandler:Oskari.clazz.create("Oskari.lupapiste.bundle.lupakartta.request.AddMarkerRequestHandler",sandbox,me)}},register:function(){},unregister:function(){},startPlugin:function(sandbox){var me=this,p;me._sandbox=sandbox;me._map=me.getMapModule().getMap();me.createMapMarkersLayer();sandbox.register(me);for(p in me.eventHandlers)sandbox.registerForEventByName(me,p);sandbox.addRequestHandler("lupakartta.ClearMapRequest",me.requestHandlers.clearMapHandler);sandbox.addRequestHandler("lupakartta.AddMarkerRequest",me.requestHandlers.addMarkerHandler)},stopPlugin:function(sandbox){for(var p in this.eventHandlers)sandbox.unregisterFromEventByName(this,p);sandbox.removeRequestHandler("lupakartta.ClearMapRequest",this.requestHandlers.clearMapHandler);sandbox.removeRequestHandler("lupakartta.AddMarkerRequest",this.requestHandlers.addMarkerHandler);sandbox.unregister(this);this._map=null;this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{AfterHideMapMarkerEvent:function(event){this.afterHideMapMarkerEvent(event)}},onEvent:function(event){return this.eventHandlers[event.getName()].apply(this,[event])},createMapMarkersLayer:function(){var sandbox=this._sandbox,layerMarkers=new OpenLayers.Layer.Markers("LupapisteMarkers");this._map.addLayer(layerMarkers);this._map.setLayerIndex(layerMarkers,1e3)},afterHideMapMarkerEvent:function(){var markerLayer=this._map.getLayersByName("LupapisteMarkers");markerLayer!==null&&markerLayer!==undefined&&markerLayer[0]!==null&&markerLayer[0]!==undefined&&markerLayer[0].setVisibility(!1)},clearMapMarkers:function(){var markerLayer=this._map.getLayersByName("LupapisteMarkers");markerLayer!==null&&markerLayer!==undefined&&markerLayer[0]!==null&&markerLayer[0]!==undefined&&markerLayer[0].clearMarkers();this._markers.length=0},getMapMarkerBounds:function(){var markerLayer=this._map.getLayersByName("LupapisteMarkers");if(markerLayer!==null&&markerLayer!==undefined&&markerLayer[0]!==null&&markerLayer[0]!==undefined)return markerLayer[0].getDataExtent()},addMapMarker:function(x,y,id,events,iconUrl){id||(id=this._markers.length+1,id="id"+id);iconUrl||(iconUrl="http://www.openlayers.org/dev/img/marker.png");var markerLayer=this._map.getLayersByName("LupapisteMarkers"),size=new OpenLayers.Size(21,25),offset=new OpenLayers.Pixel(-(size.w/2),-size.h),icon=new OpenLayers.Icon(iconUrl,size,offset),marker=new OpenLayers.Marker(new OpenLayers.LonLat(x,y),icon),i;if(this._markers[id]=marker,events)for(i in events)marker.events.register(i,marker,events[i]);markerLayer[0].addMarker(marker)}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.lupapiste.bundle.lupakartta.request.ClearMapRequest",function(){this._creator=null},{__name:"lupakartta.ClearMapRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.lupapiste.bundle.lupakartta.request.ClearMapRequestHandler",function(sandbox,markersPlugin){this.sandbox=sandbox;this.markersPlugin=markersPlugin},{handleRequest:function(){this.sandbox.printDebug("[Oskari.lupapiste.bundle.lupakartta.request.ClearMapRequestHandler] Clear map");this.markersPlugin.clearMapMarkers()}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.lupapiste.bundle.lupakartta.request.AddMarkerRequest",function(x,y,id,events,iconUrl){this._creator=null;this._x=x;this._y=y;this._id=id;this._events=events;this._iconUrl=iconUrl},{__name:"lupakartta.AddMarkerRequest",getName:function(){return this.__name},getX:function(){return this._x},getY:function(){return this._y},getID:function(){return this._id},getEvents:function(){return this._events},getIconUrl:function(){return this._iconUrl}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.lupapiste.bundle.lupakartta.request.AddMarkerRequestHandler",function(sandbox,markersPlugin){this.sandbox=sandbox;this.markersPlugin=markersPlugin},{handleRequest:function(core,request){this.sandbox.printDebug("[Oskari.lupapiste.bundle.lupakartta.request.AddMarkerRequestHandler] Add Marker");this.markersPlugin.addMapMarker(request.getX(),request.getY(),request.getID(),request.getEvents(),request.getIconUrl())}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.lupapiste.bundle.lupakartta.event.PlaceSaved",function(places){this._places=places},{__name:"Lupapiste.PlaceSaved",getName:function(){return this.__name},getPlaces:function(){return this._places}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.lupapiste.bundle.lupakartta.event.FeaturesAdded",function(features){this._features=features},{__name:"Lupapiste.FeaturesAdded",getName:function(){return this.__name},getFeatures:function(){return this._features}},{protocol:["Oskari.mapframework.event.Event"]}),function(){var e=function(t,n){var r=e.resolve(t,n||"/"),i=e.modules[r],s,o;if(!i)throw new Error("Failed to resolve module "+t+", tried "+r);return s=e.cache[r],o=s?s.exports:i(),o};e.paths=[];e.modules={};e.cache={};e.extensions=[".js",".coffee",".json"];e._core={assert:!0,events:!0,fs:!0,path:!0,vm:!0};e.resolve=function(){return function(t,n){function u(t){var n,i;if(t=r.normalize(t),e.modules[t])return t;for(n=0;n<e.extensions.length;n++)if(i=e.extensions[n],e.modules[t+i])return t+i}function a(t){var n,i,s,o;if(t=t.replace(/\/+$/,""),n=r.normalize(t+"/package.json"),e.modules[n])if(i=e.modules[n](),s=i.browserify,typeof s=="object"&&s.main){if(o=u(r.resolve(t,s.main)),o)return o}else if(typeof s=="string"){if(o=u(r.resolve(t,s)),o)return o}else if(i.main&&(o=u(r.resolve(t,i.main)),o))return o;return u(t+"/index")}function f(e,t){for(var i,o,s,n=l(t),r=0;r<n.length;r++){if(i=n[r],s=u(i+"/"+e),s)return s;if(o=a(i+"/"+e),o)return o}return s=u(e),s?s:void 0}function l(e){var t,n,i,s;for(t=e==="/"?[""]:r.normalize(e).split("/"),n=[],i=t.length-1;i>=0;i--)t[i]!=="node_modules"&&(s=t.slice(0,i+1).join("/")+"/node_modules",n.push(s));return n}var r,i,s,o;if(n||(n="/"),e._core[t])return t;if(r=e.modules.path(),n=r.resolve("/",n),i=n||"/",t.match(/^(?:\.\.?\/|\/)/)&&(s=u(r.resolve(i,t))||a(r.resolve(i,t)),s))return s;if(o=f(t,i),o)return o;throw new Error("Cannot find module '"+t+"'");}}();e.alias=function(t,n){var r=e.modules.path(),i=null,o,u,a,f,l;try{i=e.resolve(t+"/package.json","/")}catch(s){i=e.resolve(t,"/")}for(o=r.dirname(i),u=(Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t})(e.modules),a=0;a<u.length;a++)f=u[a],f.slice(0,o.length+1)===o+"/"?(l=f.slice(o.length),e.modules[n+l]=e.modules[o+l]):f===o&&(e.modules[n]=e.modules[o])},function(){var t={},n=typeof window!="undefined"?window:{},r=!1;e.define=function(i,s){var o,u,a;!r&&e.modules.__browserify_process&&(t=e.modules.__browserify_process(),r=!0);o=e._core[i]?"":e.modules.path().dirname(i);u=function(t){var n=e(t,o),r=e.cache[e.resolve(t,o)];return r&&r.parent===null&&(r.parent=a),n};u.resolve=function(t){return e.resolve(t,o)};u.modules=e.modules;u.define=e.define;u.cache=e.cache;a={id:i,filename:i,exports:{},loaded:!1,parent:null};e.modules[i]=function(){return e.cache[i]=a,s.call(a.exports,u,a,a.exports,o,i,t,n),a.loaded=!0,a.exports}}}();e.define("path",function(e,t,n,r,i,s){function u(e,t){for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}function a(e,t){for(var i,n=0,r=e.length;r>=0;r--)i=e[r],i=="."?e.splice(r,1):i===".."?(e.splice(r,1),n++):n&&(e.splice(r,1),n--);if(t)for(;n--;n)e.unshift("..");return e}var f=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;n.resolve=function(){for(var r,e="",t=!1,n=arguments.length;n>=-1&&!t;n--)(r=n>=0?arguments[n]:s.cwd(),typeof r=="string"&&r)&&(e=r+"/"+e,t=r.charAt(0)==="/");return e=a(u(e.split("/"),function(e){return!!e}),!t).join("/"),(t?"/":"")+e||"."};n.normalize=function(e){var t=e.charAt(0)==="/",n=e.slice(-1)==="/";return e=a(u(e.split("/"),function(e){return!!e}),!t).join("/"),!e&&!t&&(e="."),e&&n&&(e+="/"),(t?"/":"")+e};n.join=function(){var e=Array.prototype.slice.call(arguments,0);return n.normalize(u(e,function(e){return e&&typeof e=="string"}).join("/"))};n.dirname=function(e){var t=f.exec(e)[1]||"";return t?t.length===1||!1&&t.length<=3&&t.charAt(1)===":"?t:t.substring(0,t.length-1):"."};n.basename=function(e,t){var n=f.exec(e)[2]||"";return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n};n.extname=function(e){return f.exec(e)[3]||""}});e.define("__browserify_process",function(e,t,n,r,i,s){var s=t.exports={};s.nextTick=function(){var e=typeof window!="undefined"&&window.setImmediate,t=typeof window!="undefined"&&window.postMessage&&window.addEventListener,n;return e?window.setImmediate:t?(n=[],window.addEventListener("message",function(e){if(e.source===window&&e.data==="browserify-tick"&&(e.stopPropagation(),n.length>0)){var t=n.shift();t()}},!0),function(t){n.push(t);window.postMessage("browserify-tick","*")}):function(t){setTimeout(t,0)}}();s.title="browser";s.browser=!0;s.env={};s.argv=[];s.binding=function(t){if(t==="evals")return e("vm");throw new Error("No such module. (Possibly not yet loaded)");},function(){var t="/",n;s.cwd=function(){return t};s.chdir=function(r){n||(n=e("path"));t=n.resolve(r,t)}}()});e.define("/ArrayList.js",function(e,t){function h(){this.array=[];arguments[0]instanceof u&&this.addAll(arguments[0])}var u=e("./Collection"),a=e("./List"),f=e("./IndexOutOfBoundsException"),l=e("./NoSuchElementException"),c=e("./OperationNotSupported");h.prototype=new a;h.prototype.array=null;h.prototype.add=function(e){return this.array.push(e),!0};h.prototype.addAll=function(e){for(var t=e.iterator();t.hasNext();)this.add(t.next());return!0};h.prototype.set=function(e,t){var n=this.array[e];return this.array[e]=t,n};h.prototype.iterator=function(){return new h.Iterator(this)};h.prototype.get=function(e){if(e<0||e>=this.size())throw new f;return this.array[e]};h.prototype.isEmpty=function(){return this.array.length===0};h.prototype.size=function(){return this.array.length};h.prototype.toArray=function(){for(var e=[],t=0,n=this.array.length;t<n;t++)e.push(this.array[t]);return e};h.prototype.remove=function(e){for(var t=!1,n=0,r=this.array.length;n<r;n++)if(this.array[n]===e){this.array.splice(n,1);t=!0;break}return t};h.Iterator=function(e){this.arrayList=e};h.Iterator.prototype.arrayList=null;h.Iterator.prototype.position=0;h.Iterator.prototype.next=function(){if(this.position===this.arrayList.size())throw new l;return this.arrayList.get(this.position++)};h.Iterator.prototype.hasNext=function(){return this.position<this.arrayList.size()?!0:!1};h.Iterator.prototype.remove=function(){throw new c;};t.exports=h});e.define("/Collection.js",function(e,t){function a(){}var u=e("./Iterator");a.prototype.add=function(){};a.prototype.addAll=function(){};a.prototype.isEmpty=function(){};a.prototype.iterator=function(){};a.prototype.size=function(){};a.prototype.toArray=function(){};a.prototype.remove=function(){};t.exports=a});e.define("/Iterator.js",function(e,t){function u(){}u.prototype.hasNext=function(){};u.prototype.next=function(){};u.prototype.remove=function(){};t.exports=u});e.define("/List.js",function(e,t){function a(){}var u=e("./Collection");a.prototype=new u;a.prototype.get=function(){};a.prototype.set=function(){};a.prototype.isEmpty=function(){};t.exports=a});e.define("/IndexOutOfBoundsException.js",function(e,t){function u(e){this.message=e||""}u.prototype=new Error;u.prototype.name="IndexOutOfBoundsException";t.exports=u});e.define("/NoSuchElementException.js",function(e,t){function u(e){this.message=e||""}u.prototype=new Error;u.prototype.name="NoSuchElementException";t.exports=u});e.define("/OperationNotSupported.js",function(e,t){function u(e){this.message=e||""}u.prototype=new Error;u.prototype.name="OperationNotSupported";t.exports=u});e.define("/Arrays.js",function(e,t){function u(){}u.sort=function(){var e=arguments[0],t,n,r,i,s;if(arguments.length===1){e.sort();return}if(arguments.length===2)r=arguments[1],i=function(e,t){return r.compare(e,t)},e.sort(i);else{if(arguments.length===3){for(n=e.slice(arguments[1],arguments[2]),n.sort(),s=e.slice(0,arguments[1]).concat(n,e.slice(arguments[2],e.length)),e.splice(0,e.length),t=0;t<s.length;t++)e.push(s[t]);return}if(arguments.length===4){for(n=e.slice(arguments[1],arguments[2]),r=arguments[3],i=function(e,t){return r.compare(e,t)},n.sort(i),s=e.slice(0,arguments[1]).concat(n,e.slice(arguments[2],e.length)),e.splice(0,e.length),t=0;t<s.length;t++)e.push(s[t]);return}}};u.asList=function(e){for(var t=new javascript.util.ArrayList,n=0,r=e.length;n<r;n++)t.add(e[n]);return t};t.exports=u});e.define("/EmptyStackException.js",function(e,t){function u(e){this.message=e||""}u.prototype=new Error;u.prototype.name="EmptyStackException";t.exports=u});e.define("/HashMap.js",function(e,t){function f(){this.object={}}var u=e("./Map"),a=e("./ArrayList");f.prototype=new u;f.prototype.object=null;f.prototype.get=function(e){return this.object[e]||null};f.prototype.put=function(e,t){return this.object[e]=t,t};f.prototype.values=function(){var e=new javascript.util.ArrayList;for(var t in this.object)this.object.hasOwnProperty(t)&&e.add(this.object[t]);return e};f.prototype.size=function(){return this.values().size()};t.exports=f});e.define("/Map.js",function(e,t){function u(){}u.prototype.get=function(){};u.prototype.put=function(){};u.prototype.size=function(){};u.prototype.values=function(){};t.exports=u});e.define("/Set.js",function(e,t){function a(){}var u=e("./Collection");a.prototype=new u;a.prototype.contains=function(){};t.exports=a});e.define("/HashSet.js",function(e,t){function c(){this.array=[];arguments[0]instanceof u&&this.addAll(arguments[0])}var u=e("./Collection"),a=e("./Set"),f=e("./OperationNotSupported"),l=e("./NoSuchElementException");c.prototype=new a;c.prototype.array=null;c.prototype.contains=function(e){for(var r,t=0,n=this.array.length;t<n;t++)if(r=this.array[t],r===e)return!0;return!1};c.prototype.add=function(e){return this.contains(e)?!1:(this.array.push(e),!0)};c.prototype.addAll=function(e){for(var t=e.iterator();t.hasNext();)this.add(t.next());return!0};c.prototype.remove=function(){throw new f;};c.prototype.size=function(){return this.array.length};c.prototype.isEmpty=function(){return this.array.length===0};c.prototype.toArray=function(){for(var e=[],t=0,n=this.array.length;t<n;t++)e.push(this.array[t]);return e};c.prototype.iterator=function(){return new c.Iterator(this)};c.Iterator=function(e){this.hashSet=e};c.Iterator.prototype.hashSet=null;c.Iterator.prototype.position=0;c.Iterator.prototype.next=function(){if(this.position===this.hashSet.size())throw new l;return this.hashSet.array[this.position++]};c.Iterator.prototype.hasNext=function(){return this.position<this.hashSet.size()?!0:!1};c.Iterator.prototype.remove=function(){throw new javascript.util.OperationNotSupported;};t.exports=c});e.define("/SortedMap.js",function(e,t){function a(){}var u=e("./Map");a.prototype=new u;t.exports=a});e.define("/SortedSet.js",function(e,t){function a(){}var u=e("./Set");a.prototype=new u;t.exports=a});e.define("/Stack.js",function(e,t){function f(){this.array=[]}var u=e("./List"),a=e("./EmptyStackException");f.prototype=new u;f.prototype.array=null;f.prototype.push=function(e){return this.array.push(e),e};f.prototype.pop=function(){if(this.array.length===0)throw new a;return this.array.pop()};f.prototype.peek=function(){if(this.array.length===0)throw new a;return this.array[this.array.length-1]};f.prototype.empty=function(){return this.array.length===0?!0:!1};f.prototype.isEmpty=function(){return this.empty()};f.prototype.search=function(e){return this.array.indexOf(e)};f.prototype.size=function(){return this.array.length};f.prototype.toArray=function(){for(var e=[],t=0,n=this.array.length;t<n;t++)e.push(this.array[t]);return e};t.exports=f});e.define("/TreeMap.js",function(e,t){function l(){this.array=[]}var u=e("./Map"),a=e("./SortedMap"),f=e("./ArrayList");l.prototype=new u;l.prototype.array=null;l.prototype.get=function(e){for(var r,t=0,n=this.array.length;t<n;t++)if(r=this.array[t],r.key.compareTo(e)===0)return r.value;return null};l.prototype.put=function(e,t){var n=this.get(e),r,i,s,o;if(n)return r=n.value,n.value=t,r;for(i={key:e,value:t},s=0,o=this.array.length;s<o;s++)if(n=this.array[s],n.key.compareTo(e)===1)return this.array.splice(s,0,i),null;return this.array.push({key:e,value:t}),null};l.prototype.values=function(){for(var e=new javascript.util.ArrayList,t=0,n=this.array.length;t<n;t++)e.add(this.array[t].value);return e};l.prototype.size=function(){return this.values().size()};t.exports=l});e.define("/TreeSet.js",function(e,t){function c(){this.array=[];arguments[0]instanceof u&&this.addAll(arguments[0])}var u=e("./Collection"),a=e("./SortedSet"),f=e("./OperationNotSupported"),l=e("./NoSuchElementException");c.prototype=new a;c.prototype.array=null;c.prototype.contains=function(e){for(var r,t=0,n=this.array.length;t<n;t++)if(r=this.array[t],r.compareTo(e)===0)return!0;return!1};c.prototype.add=function(e){var t,n,r;if(this.contains(e))return!1;for(t=0,n=this.array.length;t<n;t++)if(r=this.array[t],r.compareTo(e)===1)return this.array.splice(t,0,e),!0;return this.array.push(e),!0};c.prototype.addAll=function(e){for(var t=e.iterator();t.hasNext();)this.add(t.next());return!0};c.prototype.remove=function(){throw new f;};c.prototype.size=function(){return this.array.length};c.prototype.isEmpty=function(){return this.array.length===0};c.prototype.toArray=function(){for(var e=[],t=0,n=this.array.length;t<n;t++)e.push(this.array[t]);return e};c.prototype.iterator=function(){return new c.Iterator(this)};c.Iterator=function(e){this.treeSet=e};c.Iterator.prototype.treeSet=null;c.Iterator.prototype.position=0;c.Iterator.prototype.next=function(){if(this.position===this.treeSet.size())throw new l;return this.treeSet.array[this.position++]};c.Iterator.prototype.hasNext=function(){return this.position<this.treeSet.size()?!0:!1};c.Iterator.prototype.remove=function(){throw new javascript.util.OperationNotSupported;};t.exports=c});e.define("/javascript.util.js",function(e,t,n,r,i,s,o){var u={},a;u.util={};u.util.version="0.10.0";u.util.ArrayList=e("./ArrayList");u.util.Arrays=e("./Arrays");u.util.Collection=e("./Collection");u.util.EmptyStackException=e("./EmptyStackException");u.util.HashMap=e("./HashMap");u.util.IndexOutOfBoundsException=e("./IndexOutOfBoundsException");u.util.Iterator=e("./Iterator");u.util.List=e("./List");u.util.Map=e("./Map");u.util.NoSuchElementException=e("./NoSuchElementException");u.util.OperationNotSupported=e("./OperationNotSupported");u.util.Set=e("./Set");u.util.HashSet=e("./HashSet");u.util.SortedMap=e("./SortedMap");u.util.SortedSet=e("./SortedSet");u.util.Stack=e("./Stack");u.util.TreeMap=e("./TreeMap");u.util.TreeSet=e("./TreeSet");this.javascript=u;a=typeof window!="undefined"?window:o;a.javascript=u});e("/javascript.util.js")}();jsts={version:"0.13.2",algorithm:{distance:{},locate:{}},error:{},geom:{util:{}},geomgraph:{index:{}},index:{bintree:{},chain:{},kdtree:{},quadtree:{},strtree:{}},io:{},noding:{snapround:{}},operation:{buffer:{},distance:{},overlay:{snap:{}},polygonize:{},relate:{},union:{},valid:{}},planargraph:{},simplify:{},triangulate:{quadedge:{}},util:{}};typeof String.prototype.trim!="function"&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});jsts.abstractFunc=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.error={};jsts.error.IllegalArgumentError=function(message){this.name="IllegalArgumentError";this.message=message};jsts.error.IllegalArgumentError.prototype=new Error;jsts.error.TopologyError=function(message,pt){this.name="TopologyError";this.message=pt?message+" [ "+pt+" ]":message};jsts.error.TopologyError.prototype=new Error;jsts.error.AbstractMethodInvocationError=function(){this.name="AbstractMethodInvocationError";this.message="Abstract method called, should be implemented in subclass."};jsts.error.AbstractMethodInvocationError.prototype=new Error;jsts.error.NotImplementedError=function(){this.name="NotImplementedError";this.message="This method has not yet been implemented."};jsts.error.NotImplementedError.prototype=new Error;jsts.error.NotRepresentableError=function(message){this.name="NotRepresentableError";this.message=message};jsts.error.NotRepresentableError.prototype=new Error;jsts.error.LocateFailureError=function(message){this.name="LocateFailureError";this.message=message};jsts.error.LocateFailureError.prototype=new Error;typeof module!="undefined"&&(module.exports=jsts);jsts.geom.GeometryFilter=function(){};jsts.geom.GeometryFilter.prototype.filter=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.geom.util.PolygonExtracter=function(comps){this.comps=comps};jsts.geom.util.PolygonExtracter.prototype=new jsts.geom.GeometryFilter;jsts.geom.util.PolygonExtracter.prototype.comps=null;jsts.geom.util.PolygonExtracter.getPolygons=function(geom,list){return list===undefined&&(list=[]),geom instanceof jsts.geom.Polygon?list.push(geom):geom instanceof jsts.geom.GeometryCollection&&geom.apply(new jsts.geom.util.PolygonExtracter(list)),list};jsts.geom.util.PolygonExtracter.prototype.filter=function(geom){geom instanceof jsts.geom.Polygon&&this.comps.push(geom)};jsts.io.WKTParser=function(geometryFactory){this.geometryFactory=geometryFactory||new jsts.geom.GeometryFactory;this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/}};jsts.io.WKTParser.prototype.read=function(wkt){var geometry,type,str,matches;if(wkt=wkt.replace(/[\n\r]/g," "),matches=this.regExes.typeStr.exec(wkt),wkt.search("EMPTY")!==-1&&(matches=this.regExes.emptyTypeStr.exec(wkt),matches[2]=undefined),matches&&(type=matches[1].toLowerCase(),str=matches[2],this.parse[type]&&(geometry=this.parse[type].apply(this,[str]))),geometry===undefined)throw new Error("Could not parse WKT "+wkt);return geometry};jsts.io.WKTParser.prototype.write=function(geometry){return this.extractGeometry(geometry)};jsts.io.WKTParser.prototype.extractGeometry=function(geometry){var type=geometry.CLASS_NAME.split(".")[2].toLowerCase(),wktType;return this.extract[type]?(wktType=type.toUpperCase(),geometry.isEmpty()?wktType+" EMPTY":wktType+"("+this.extract[type].apply(this,[geometry])+")"):null};jsts.io.WKTParser.prototype.extract={coordinate:function(coordinate){return coordinate.x+" "+coordinate.y},point:function(point){return point.coordinate.x+" "+point.coordinate.y},multipoint:function(multipoint){for(var array=[],i=0,len=multipoint.geometries.length;i<len;++i)array.push("("+this.extract.point.apply(this,[multipoint.geometries[i]])+")");return array.join(",")},linestring:function(linestring){for(var array=[],i=0,len=linestring.points.length;i<len;++i)array.push(this.extract.coordinate.apply(this,[linestring.points[i]]));return array.join(",")},multilinestring:function(multilinestring){for(var array=[],i=0,len=multilinestring.geometries.length;i<len;++i)array.push("("+this.extract.linestring.apply(this,[multilinestring.geometries[i]])+")");return array.join(",")},polygon:function(polygon){var array=[],i,len;for(array.push("("+this.extract.linestring.apply(this,[polygon.shell])+")"),i=0,len=polygon.holes.length;i<len;++i)array.push("("+this.extract.linestring.apply(this,[polygon.holes[i]])+")");return array.join(",")},multipolygon:function(multipolygon){for(var array=[],i=0,len=multipolygon.geometries.length;i<len;++i)array.push("("+this.extract.polygon.apply(this,[multipolygon.geometries[i]])+")");return array.join(",")},geometrycollection:function(collection){for(var array=[],i=0,len=collection.geometries.length;i<len;++i)array.push(this.extractGeometry.apply(this,[collection.geometries[i]]));return array.join(",")}};jsts.io.WKTParser.prototype.parse={point:function(str){if(str===undefined)return this.geometryFactory.createPoint(null);var coords=str.trim().split(this.regExes.spaces);return this.geometryFactory.createPoint(new jsts.geom.Coordinate(coords[0],coords[1]))},multipoint:function(str){var point,points,components,i,len;if(str===undefined)return this.geometryFactory.createMultiPoint(null);for(points=str.trim().split(","),components=[],i=0,len=points.length;i<len;++i)point=points[i].replace(this.regExes.trimParens,"$1"),components.push(this.parse.point.apply(this,[point]));return this.geometryFactory.createMultiPoint(components)},linestring:function(str){var points,components,coords,i,len;if(str===undefined)return this.geometryFactory.createLineString(null);for(points=str.trim().split(","),components=[],i=0,len=points.length;i<len;++i)coords=points[i].trim().split(this.regExes.spaces),components.push(new jsts.geom.Coordinate(coords[0],coords[1]));return this.geometryFactory.createLineString(components)},linearring:function(str){var points,components,coords,i,len;if(str===undefined)return this.geometryFactory.createLinearRing(null);for(points=str.trim().split(","),components=[],i=0,len=points.length;i<len;++i)coords=points[i].trim().split(this.regExes.spaces),components.push(new jsts.geom.Coordinate(coords[0],coords[1]));return this.geometryFactory.createLinearRing(components)},multilinestring:function(str){var line,lines,components,i,len;if(str===undefined)return this.geometryFactory.createMultiLineString(null);for(lines=str.trim().split(this.regExes.parenComma),components=[],i=0,len=lines.length;i<len;++i)line=lines[i].replace(this.regExes.trimParens,"$1"),components.push(this.parse.linestring.apply(this,[line]));return this.geometryFactory.createMultiLineString(components)},polygon:function(str){var ring,linestring,linearring,rings,shell,holes,i,len;if(str===undefined)return this.geometryFactory.createPolygon(null);for(rings=str.trim().split(this.regExes.parenComma),holes=[],i=0,len=rings.length;i<len;++i)ring=rings[i].replace(this.regExes.trimParens,"$1"),linestring=this.parse.linestring.apply(this,[ring]),linearring=this.geometryFactory.createLinearRing(linestring.points),i===0?shell=linearring:holes.push(linearring);return this.geometryFactory.createPolygon(shell,holes)},multipolygon:function(str){var polygon,polygons,components,i,len;if(str===undefined)return this.geometryFactory.createMultiPolygon(null);for(polygons=str.trim().split(this.regExes.doubleParenComma),components=[],i=0,len=polygons.length;i<len;++i)polygon=polygons[i].replace(this.regExes.trimParens,"$1"),components.push(this.parse.polygon.apply(this,[polygon]));return this.geometryFactory.createMultiPolygon(components)},geometrycollection:function(str){var wktArray,components,i,len;if(str===undefined)return this.geometryFactory.createGeometryCollection(null);for(str=str.replace(/,\s*([A-Za-z])/g,"|$1"),wktArray=str.trim().split("|"),components=[],i=0,len=wktArray.length;i<len;++i)components.push(jsts.io.WKTParser.prototype.read.apply(this,[wktArray[i]]));return this.geometryFactory.createGeometryCollection(components)}};jsts.index.ItemVisitor=function(){};jsts.index.ItemVisitor.prototype.visitItem=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.algorithm.CGAlgorithms=function(){};jsts.algorithm.CGAlgorithms.CLOCKWISE=-1;jsts.algorithm.CGAlgorithms.RIGHT=jsts.algorithm.CGAlgorithms.CLOCKWISE;jsts.algorithm.CGAlgorithms.COUNTERCLOCKWISE=1;jsts.algorithm.CGAlgorithms.LEFT=jsts.algorithm.CGAlgorithms.COUNTERCLOCKWISE;jsts.algorithm.CGAlgorithms.COLLINEAR=0;jsts.algorithm.CGAlgorithms.STRAIGHT=jsts.algorithm.CGAlgorithms.COLLINEAR;jsts.algorithm.CGAlgorithms.orientationIndex=function(p1,p2,q){var dx1,dy1,dx2,dy2;return dx1=p2.x-p1.x,dy1=p2.y-p1.y,dx2=q.x-p2.x,dy2=q.y-p2.y,jsts.algorithm.RobustDeterminant.signOfDet2x2(dx1,dy1,dx2,dy2)};jsts.algorithm.CGAlgorithms.isPointInRing=function(p,ring){return jsts.algorithm.CGAlgorithms.locatePointInRing(p,ring)!==jsts.geom.Location.EXTERIOR};jsts.algorithm.CGAlgorithms.locatePointInRing=function(p,ring){return jsts.algorithm.RayCrossingCounter.locatePointInRing(p,ring)};jsts.algorithm.CGAlgorithms.isOnLine=function(p,pt){var lineIntersector,i,il,p0,p1;for(lineIntersector=new jsts.algorithm.RobustLineIntersector,i=1,il=pt.length;i<il;i++)if(p0=pt[i-1],p1=pt[i],lineIntersector.computeIntersection(p,p0,p1),lineIntersector.hasIntersection())return!0;return!1};jsts.algorithm.CGAlgorithms.isCCW=function(ring){var nPts,hiPt,hiIndex,p,iPrev,iNext,prev,next,i,disc,isCCW;if(nPts=ring.length-1,nPts<3)throw new jsts.IllegalArgumentError("Ring has fewer than 3 points, so orientation cannot be determined");for(hiPt=ring[0],hiIndex=0,i=1,i;i<=nPts;i++)p=ring[i],p.y>hiPt.y&&(hiPt=p,hiIndex=i);iPrev=hiIndex;do iPrev=iPrev-1,iPrev<0&&(iPrev=nPts);while(ring[iPrev].equals2D(hiPt)&&iPrev!==hiIndex);iNext=hiIndex;do iNext=(iNext+1)%nPts;while(ring[iNext].equals2D(hiPt)&&iNext!==hiIndex);return(prev=ring[iPrev],next=ring[iNext],prev.equals2D(hiPt)||next.equals2D(hiPt)||prev.equals2D(next))?!1:(disc=jsts.algorithm.CGAlgorithms.computeOrientation(prev,hiPt,next),isCCW=!1,disc===0?prev.x>next.x:disc>0)};jsts.algorithm.CGAlgorithms.computeOrientation=function(p1,p2,q){return jsts.algorithm.CGAlgorithms.orientationIndex(p1,p2,q)};jsts.algorithm.CGAlgorithms.distancePointLine=function(p,A,B){if(A instanceof jsts.geom.Coordinate||jsts.algorithm.CGAlgorithms.distancePointLine2.apply(this,arguments),A.x===B.x&&A.y===B.y)return p.distance(A);var r,s;return(r=((p.x-A.x)*(B.x-A.x)+(p.y-A.y)*(B.y-A.y))/((B.x-A.x)*(B.x-A.x)+(B.y-A.y)*(B.y-A.y)),r<=0)?p.distance(A):r>=1?p.distance(B):(s=((A.y-p.y)*(B.x-A.x)-(A.x-p.x)*(B.y-A.y))/((B.x-A.x)*(B.x-A.x)+(B.y-A.y)*(B.y-A.y)),Math.abs(s)*Math.sqrt((B.x-A.x)*(B.x-A.x)+(B.y-A.y)*(B.y-A.y)))};jsts.algorithm.CGAlgorithms.distancePointLinePerpendicular=function(p,A,B){var s=((A.y-p.y)*(B.x-A.x)-(A.x-p.x)*(B.y-A.y))/((B.x-A.x)*(B.x-A.x)+(B.y-A.y)*(B.y-A.y));return Math.abs(s)*Math.sqrt((B.x-A.x)*(B.x-A.x)+(B.y-A.y)*(B.y-A.y))};jsts.algorithm.CGAlgorithms.distancePointLine2=function(p,line){var minDistance,i,il,dist;if(line.length===0)throw new jsts.error.IllegalArgumentError("Line array must contain at least one vertex");for(minDistance=p.distance(line[0]),i=0,il=line.length-1;i<il;i++)dist=jsts.algorithm.CGAlgorithms.distancePointLine(p,line[i],line[i+1]),dist<minDistance&&(minDistance=dist);return minDistance};jsts.algorithm.CGAlgorithms.distanceLineLine=function(A,B,C,D){if(A.equals(B))return jsts.algorithm.CGAlgorithms.distancePointLine(A,C,D);if(C.equals(D))return jsts.algorithm.CGAlgorithms.distancePointLine(D,A,B);var r_top,r_bot,s_top,s_bot,s,r;return(r_top=(A.y-C.y)*(D.x-C.x)-(A.x-C.x)*(D.y-C.y),r_bot=(B.x-A.x)*(D.y-C.y)-(B.y-A.y)*(D.x-C.x),s_top=(A.y-C.y)*(B.x-A.x)-(A.x-C.x)*(B.y-A.y),s_bot=(B.x-A.x)*(D.y-C.y)-(B.y-A.y)*(D.x-C.x),r_bot===0||s_bot===0)?Math.min(jsts.algorithm.CGAlgorithms.distancePointLine(A,C,D),Math.min(jsts.algorithm.CGAlgorithms.distancePointLine(B,C,D),Math.min(jsts.algorithm.CGAlgorithms.distancePointLine(C,A,B),jsts.algorithm.CGAlgorithms.distancePointLine(D,A,B)))):(s=s_top/s_bot,r=r_top/r_bot,r<0||r>1||s<0||s>1)?Math.min(jsts.algorithm.CGAlgorithms.distancePointLine(A,C,D),Math.min(jsts.algorithm.CGAlgorithms.distancePointLine(B,C,D),Math.min(jsts.algorithm.CGAlgorithms.distancePointLine(C,A,B),jsts.algorithm.CGAlgorithms.distancePointLine(D,A,B)))):0};jsts.algorithm.CGAlgorithms.signedArea=function(ring){if(ring.length<3)return 0;var sum,i,il,bx,by,cx,cy;for(sum=0,i=0,il=ring.length-1;i<il;i++)bx=ring[i].x,by=ring[i].y,cx=ring[i+1].x,cy=ring[i+1].y,sum+=(bx+cx)*(cy-by);return-sum/2};jsts.algorithm.CGAlgorithms.signedArea=function(ring){var n,sum,p,bx,by,i,cx,cy;if(n=ring.length,n<3)return 0;for(sum=0,p=ring[0],bx=p.x,by=p.y,i=1;i<n;i++)p=ring[i],cx=p.x,cy=p.y,sum+=(bx+cx)*(cy-by),bx=cx,by=cy;return-sum/2};jsts.algorithm.CGAlgorithms.computeLength=function(pts){var n=pts.length,len,x0,y0,x1,y1,dx,dy,p,i,il;if(n<=1)return 0;for(len=0,p=pts[0],x0=p.x,y0=p.y,i=1,il=n,i;i<n;i++)p=pts[i],x1=p.x,y1=p.y,dx=x1-x0,dy=y1-y0,len+=Math.sqrt(dx*dx+dy*dy),x0=x1,y0=y1;return len};jsts.algorithm.CGAlgorithms.length=function(){};jsts.algorithm.Angle=function(){};jsts.algorithm.Angle.PI_TIMES_2=2*Math.PI;jsts.algorithm.Angle.PI_OVER_2=Math.PI/2;jsts.algorithm.Angle.PI_OVER_4=Math.PI/4;jsts.algorithm.Angle.COUNTERCLOCKWISE=jsts.algorithm.CGAlgorithms.prototype.COUNTERCLOCKWISE;jsts.algorithm.Angle.CLOCKWISE=jsts.algorithm.CGAlgorithms.prototype.CLOCKWISE;jsts.algorithm.Angle.NONE=jsts.algorithm.CGAlgorithms.prototype.COLLINEAR;jsts.algorithm.Angle.toDegrees=function(radians){return radians*180/Math.PI};jsts.algorithm.Angle.toRadians=function(angleDegrees){return angleDegrees*Math.PI/180};jsts.algorithm.Angle.angle=function(){return arguments.length===1?jsts.algorithm.Angle.angleFromOrigo(arguments[0]):jsts.algorithm.Angle.angleBetweenCoords(arguments[0],arguments[1])};jsts.algorithm.Angle.angleBetweenCoords=function(p0,p1){var dx,dy;return dx=p1.x-p0.x,dy=p1.y-p0.y,Math.atan2(dy,dx)};jsts.algorithm.Angle.angleFromOrigo=function(p){return Math.atan2(p.y,p.x)};jsts.algorithm.Angle.isAcute=function(p0,p1,p2){var dx0,dy0,dx1,dy1,dotprod;return dx0=p0.x-p1.x,dy0=p0.y-p1.y,dx1=p2.x-p1.x,dy1=p2.y-p1.y,dotprod=dx0*dx1+dy0*dy1,dotprod>0};jsts.algorithm.Angle.isObtuse=function(p0,p1,p2){var dx0,dy0,dx1,dy1,dotprod;return dx0=p0.x-p1.x,dy0=p0.y-p1.y,dx1=p2.x-p1.x,dy1=p2.y-p1.y,dotprod=dx0*dx1+dy0*dy1,dotprod<0};jsts.algorithm.Angle.angleBetween=function(tip1,tail,tip2){var a1,a2;return a1=jsts.algorithm.Angle.angle(tail,tip1),a2=jsts.algorithm.Angle.angle(tail,tip2),jsts.algorithm.Angle.diff(a1,a2)};jsts.algorithm.Angle.angleBetweenOriented=function(tip1,tail,tip2){var a1,a2,angDel;return(a1=jsts.algorithm.Angle.angle(tail,tip1),a2=jsts.algorithm.Angle.angle(tail,tip2),angDel=a2-a1,angDel<=-Math.PI)?angDel+jsts.algorithm.Angle.PI_TIMES_2:angDel>Math.PI?angDel-jsts.algorithm.Angle.PI_TIMES_2:angDel};jsts.algorithm.Angle.interiorAngle=function(p0,p1,p2){var anglePrev,angleNext;return anglePrev=jsts.algorithm.Angle.angle(p1,p0),angleNext=jsts.algorithm.Angle.angle(p1,p2),Math.abs(angleNext-anglePrev)};jsts.algorithm.Angle.getTurn=function(ang1,ang2){var crossproduct=Math.sin(ang2-ang1);return crossproduct>0?jsts.algorithm.Angle.COUNTERCLOCKWISE:crossproduct<0?jsts.algorithm.Angle.CLOCKWISE:jsts.algorithm.Angle.NONE};jsts.algorithm.Angle.normalize=function(angle){while(angle>Math.PI)angle-=jsts.algorithm.Angle.PI_TIMES_2;while(angle<=-Math.PI)angle+=jsts.algorithm.Angle.PI_TIMES_2;return angle};jsts.algorithm.Angle.normalizePositive=function(angle){if(angle<0){while(angle<0)angle+=jsts.algorithm.Angle.PI_TIMES_2;angle>=jsts.algorithm.Angle.PI_TIMES_2&&(angle=0)}else{while(angle>=jsts.algorithm.Angle.PI_TIMES_2)angle-=jsts.algorithm.Angle.PI_TIMES_2;angle<0&&(angle=0)}return angle};jsts.algorithm.Angle.diff=function(ang1,ang2){var delAngle;return delAngle=ang1<ang2?ang2-ang1:ang1-ang2,delAngle>Math.PI&&(delAngle=2*Math.PI-delAngle),delAngle};jsts.geom.GeometryComponentFilter=function(){};jsts.geom.GeometryComponentFilter.prototype.filter=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.geom.util.LinearComponentExtracter=function(lines,isForcedToLineString){this.lines=lines;this.isForcedToLineString=isForcedToLineString};jsts.geom.util.LinearComponentExtracter.prototype=new jsts.geom.GeometryComponentFilter;jsts.geom.util.LinearComponentExtracter.prototype.lines=null;jsts.geom.util.LinearComponentExtracter.prototype.isForcedToLineString=!1;jsts.geom.util.LinearComponentExtracter.getLines=function(geoms,lines){var i,g;if(arguments.length==1)return jsts.geom.util.LinearComponentExtracter.getLines5.apply(this,arguments);if(arguments.length==2&&typeof lines=="boolean")return jsts.geom.util.LinearComponentExtracter.getLines6.apply(this,arguments);if(arguments.length==2&&geoms instanceof jsts.geom.Geometry)return jsts.geom.util.LinearComponentExtracter.getLines3.apply(this,arguments);if(arguments.length==3&&geoms instanceof jsts.geom.Geometry)return jsts.geom.util.LinearComponentExtracter.getLines4.apply(this,arguments);if(arguments.length==3)return jsts.geom.util.LinearComponentExtracter.getLines2.apply(this,arguments);for(i=0;i<geoms.length;i++)g=geoms[i],jsts.geom.util.LinearComponentExtracter.getLines3(g,lines);return lines};jsts.geom.util.LinearComponentExtracter.getLines2=function(geoms,lines,forceToLineString){for(var g,i=0;i<geoms.length;i++)g=geoms[i],jsts.geom.util.LinearComponentExtracter.getLines4(g,lines,forceToLineString);return lines};jsts.geom.util.LinearComponentExtracter.getLines3=function(geom,lines){return geom instanceof LineString?lines.add(geom):geom.apply(new jsts.geom.util.LinearComponentExtracter(lines)),lines};jsts.geom.util.LinearComponentExtracter.getLines4=function(geom,lines,forceToLineString){return geom.apply(new jsts.geom.util.LinearComponentExtracter(lines,forceToLineString)),lines};jsts.geom.util.LinearComponentExtracter.getLines5=function(geom){return jsts.geom.util.LinearComponentExtracter.getLines6(geom,!1)};jsts.geom.util.LinearComponentExtracter.getLines6=function(geom,forceToLineString){var lines=[];return geom.apply(new jsts.geom.util.LinearComponentExtracter(lines,forceToLineString)),lines};jsts.geom.util.LinearComponentExtracter.prototype.setForceToLineString=function(isForcedToLineString){this.isForcedToLineString=isForcedToLineString};jsts.geom.util.LinearComponentExtracter.prototype.filter=function(geom){if(this.isForcedToLineString&&geom instanceof jsts.geom.LinearRing){var line=geom.getFactory().createLineString(geom.getCoordinateSequence());this.lines.push(line);return}(geom instanceof jsts.geom.LineString||geom instanceof jsts.geom.LinearRing)&&this.lines.push(geom)};jsts.geom.Location=function(){};jsts.geom.Location.INTERIOR=0;jsts.geom.Location.BOUNDARY=1;jsts.geom.Location.EXTERIOR=2;jsts.geom.Location.NONE=-1;jsts.geom.Location.toLocationSymbol=function(locationValue){switch(locationValue){case jsts.geom.Location.EXTERIOR:return"e";case jsts.geom.Location.BOUNDARY:return"b";case jsts.geom.Location.INTERIOR:return"i";case jsts.geom.Location.NONE:return"-"}throw new jsts.IllegalArgumentError("Unknown location value: "+locationValue);},function(){jsts.io.GeoJSONReader=function(geometryFactory){this.geometryFactory=geometryFactory||new jsts.geom.GeometryFactory;this.precisionModel=this.geometryFactory.getPrecisionModel();this.parser=new jsts.io.GeoJSONParser(this.geometryFactory)};jsts.io.GeoJSONReader.prototype.read=function(geoJson){var geometry=this.parser.read(geoJson);return this.precisionModel.getType()===jsts.geom.PrecisionModel.FIXED&&this.reducePrecision(geometry),geometry};jsts.io.GeoJSONReader.prototype.reducePrecision=function(geometry){var i,len;if(geometry.coordinate)this.precisionModel.makePrecise(geometry.coordinate);else if(geometry.points)for(i=0,len=geometry.points.length;i<len;i++)this.precisionModel.makePrecise(geometry.points[i]);else if(geometry.geometries)for(i=0,len=geometry.geometries.length;i<len;i++)this.reducePrecision(geometry.geometries[i])}}();jsts.geom.Geometry=function(factory){this.factory=factory};jsts.geom.Geometry.prototype.envelope=null;jsts.geom.Geometry.prototype.factory=null;jsts.geom.Geometry.prototype.getGeometryType=function(){return"Geometry"};jsts.geom.Geometry.hasNonEmptyElements=function(geometries){for(var i=0;i<geometries.length;i++)if(!geometries[i].isEmpty())return!0;return!1};jsts.geom.Geometry.hasNullElements=function(array){for(var i=0;i<array.length;i++)if(array[i]===null)return!0;return!1};jsts.geom.Geometry.prototype.getFactory=function(){return(this.factory===null||this.factory===undefined)&&(this.factory=new jsts.geom.GeometryFactory),this.factory};jsts.geom.Geometry.prototype.getNumGeometries=function(){return 1};jsts.geom.Geometry.prototype.getGeometryN=function(){return this};jsts.geom.Geometry.prototype.getPrecisionModel=function(){return this.getFactory().getPrecisionModel()};jsts.geom.Geometry.prototype.getCoordinate=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.geom.Geometry.prototype.getCoordinates=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.geom.Geometry.prototype.getNumPoints=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.geom.Geometry.prototype.isSimple=function(){this.checkNotGeometryCollection(this);var op=new jsts.operation.IsSimpleOp(this);return op.isSimple()};jsts.geom.Geometry.prototype.isValid=function(){var isValidOp=new jsts.operation.valid.IsValidOp(this);return isValidOp.isValid()};jsts.geom.Geometry.prototype.isEmpty=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.geom.Geometry.prototype.distance=function(g){return jsts.operation.distance.DistanceOp.distance(this,g)};jsts.geom.Geometry.prototype.isWithinDistance=function(geom,distance){var envDist=this.getEnvelopeInternal().distance(geom.getEnvelopeInternal());return envDist>distance?!1:DistanceOp.isWithinDistance(this,geom,distance)};jsts.geom.Geometry.prototype.isRectangle=function(){return!1};jsts.geom.Geometry.prototype.getArea=function(){return 0};jsts.geom.Geometry.prototype.getLength=function(){return 0};jsts.geom.Geometry.prototype.getCentroid=function(){if(this.isEmpty())return null;var cent,centPt=null,dim=this.getDimension();return dim===0?(cent=new jsts.algorithm.CentroidPoint,cent.add(this),centPt=cent.getCentroid()):dim===1?(cent=new jsts.algorithm.CentroidLine,cent.add(this),centPt=cent.getCentroid()):(cent=new jsts.algorithm.CentroidArea,cent.add(this),centPt=cent.getCentroid()),this.createPointFromInternalCoord(centPt,this)};jsts.geom.Geometry.prototype.getInteriorPoint=function(){var intPt,interiorPt=null,dim=this.getDimension();return dim===0?(intPt=new jsts.algorithm.InteriorPointPoint(this),interiorPt=intPt.getInteriorPoint()):dim===1?(intPt=new jsts.algorithm.InteriorPointLine(this),interiorPt=intPt.getInteriorPoint()):(intPt=new jsts.algorithm.InteriorPointArea(this),interiorPt=intPt.getInteriorPoint()),this.createPointFromInternalCoord(interiorPt,this)};jsts.geom.Geometry.prototype.getDimension=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.geom.Geometry.prototype.getBoundary=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.geom.Geometry.prototype.getBoundaryDimension=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.geom.Geometry.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())};jsts.geom.Geometry.prototype.getEnvelopeInternal=function(){return this.envelope===null&&(this.envelope=this.computeEnvelopeInternal()),this.envelope};jsts.geom.Geometry.prototype.disjoint=function(g){return!this.intersects(g)};jsts.geom.Geometry.prototype.touches=function(g){return this.getEnvelopeInternal().intersects(g.getEnvelopeInternal())?this.relate(g).isTouches(this.getDimension(),g.getDimension()):!1};jsts.geom.Geometry.prototype.intersects=function(g){return this.getEnvelopeInternal().intersects(g.getEnvelopeInternal())?this.isRectangle()?RectangleIntersects.intersects(this,g):g.isRectangle()?RectangleIntersects.intersects(g,this):this.relate(g).isIntersects():!1};jsts.geom.Geometry.prototype.crosses=function(g){return this.getEnvelopeInternal().intersects(g.getEnvelopeInternal())?this.relate(g).isCrosses(this.getDimension(),g.getDimension()):!1};jsts.geom.Geometry.prototype.within=function(g){return g.contains(this)};jsts.geom.Geometry.prototype.contains=function(g){return this.getEnvelopeInternal().contains(g.getEnvelopeInternal())?this.isRectangle()?RectangleContains.contains(this,g):this.relate(g).isContains():!1};jsts.geom.Geometry.prototype.overlaps=function(g){return this.getEnvelopeInternal().intersects(g.getEnvelopeInternal())?this.relate(g).isOverlaps(this.getDimension(),g.getDimension()):!1};jsts.geom.Geometry.prototype.covers=function(g){return this.getEnvelopeInternal().covers(g.getEnvelopeInternal())?this.isRectangle()?!0:this.relate(g).isCovers():!1};jsts.geom.Geometry.prototype.coveredBy=function(g){return g.covers(this)};jsts.geom.Geometry.prototype.relate=function(g,intersectionPattern){return arguments.length===1?this.relate2.apply(this,arguments):this.relate2(g).matches(intersectionPattern)};jsts.geom.Geometry.prototype.relate2=function(g){return this.checkNotGeometryCollection(this),this.checkNotGeometryCollection(g),jsts.operation.relate.RelateOp.relate(this,g)};jsts.geom.Geometry.prototype.equalsTopo=function(g){return this.getEnvelopeInternal().equals(g.getEnvelopeInternal())?this.relate(g).isEquals(this.getDimension(),g.getDimension()):!1};jsts.geom.Geometry.prototype.equals=function(o){return o instanceof jsts.geom.Geometry||o instanceof jsts.geom.LinearRing||o instanceof jsts.geom.Polygon||o instanceof jsts.geom.GeometryCollection||o instanceof jsts.geom.MultiPoint||o instanceof jsts.geom.MultiLineString||o instanceof jsts.geom.MultiPolygon?this.equalsExact(o):!1};jsts.geom.Geometry.prototype.buffer=function(distance,quadrantSegments,endCapStyle){var params=new jsts.operation.buffer.BufferParameters(quadrantSegments,endCapStyle);return jsts.operation.buffer.BufferOp.bufferOp2(this,distance,params)};jsts.geom.Geometry.prototype.convexHull=function(){return new jsts.algorithm.ConvexHull(this).getConvexHull()};jsts.geom.Geometry.prototype.intersection=function(other){if(this.isEmpty()||other.isEmpty())return this.getFactory().createGeometryCollection(null);if(this.isGeometryCollection(this))var g2=other;return this.checkNotGeometryCollection(this),this.checkNotGeometryCollection(other),jsts.operation.overlay.snap.SnapIfNeededOverlayOp.overlayOp(this,other,jsts.operation.overlay.OverlayOp.INTERSECTION)};jsts.geom.Geometry.prototype.union=function(other){return arguments.length===0?jsts.operation.union.UnaryUnionOp.union(this):this.isEmpty()?other.clone():other.isEmpty()?this.clone():(this.checkNotGeometryCollection(this),this.checkNotGeometryCollection(other),jsts.operation.overlay.snap.SnapIfNeededOverlayOp.overlayOp(this,other,jsts.operation.overlay.OverlayOp.UNION))};jsts.geom.Geometry.prototype.difference=function(other){return this.isEmpty()?this.getFactory().createGeometryCollection(null):other.isEmpty()?this.clone():(this.checkNotGeometryCollection(this),this.checkNotGeometryCollection(other),jsts.operation.overlay.snap.SnapIfNeededOverlayOp.overlayOp(this,other,jsts.operation.overlay.OverlayOp.DIFFERENCE))};jsts.geom.Geometry.prototype.symDifference=function(other){return this.isEmpty()?other.clone():other.isEmpty()?this.clone():(this.checkNotGeometryCollection(this),this.checkNotGeometryCollection(other),jsts.operation.overlay.snap.SnapIfNeededOverlayOp.overlayOp(this,other,jsts.operation.overlay.OverlayOp.SYMDIFFERENCE))};jsts.geom.Geometry.prototype.equalsExact=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.geom.Geometry.prototype.equalsNorm=function(g){return g===null||g===undefined?!1:this.norm().equalsExact(g.norm())};jsts.geom.Geometry.prototype.apply=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.geom.Geometry.prototype.clone=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.geom.Geometry.prototype.normalize=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.geom.Geometry.prototype.norm=function(){var copy=this.clone();return copy.normalize(),copy};jsts.geom.Geometry.prototype.compareTo=function(o){var other=o;return this.getClassSortIndex()!==other.getClassSortIndex()?this.getClassSortIndex()-other.getClassSortIndex():this.isEmpty()&&other.isEmpty()?0:this.isEmpty()?-1:other.isEmpty()?1:this.compareToSameClass(o)};jsts.geom.Geometry.prototype.isEquivalentClass=function(other){return this instanceof jsts.geom.Point&&other instanceof jsts.geom.Point?!0:this instanceof jsts.geom.LineString&&other instanceof jsts.geom.LineString|other instanceof jsts.geom.LinearRing||this instanceof jsts.geom.LinearRing&&other instanceof jsts.geom.LineString|other instanceof jsts.geom.LinearRing||this instanceof jsts.geom.Polygon&&other instanceof jsts.geom.Polygon||this instanceof jsts.geom.MultiPoint&&other instanceof jsts.geom.MultiPoint||this instanceof jsts.geom.MultiLineString&&other instanceof jsts.geom.MultiLineString||this instanceof jsts.geom.MultiPolygon&&other instanceof jsts.geom.MultiPolygon||this instanceof jsts.geom.GeometryCollection&&other instanceof jsts.geom.GeometryCollection?!0:!1};jsts.geom.Geometry.prototype.checkNotGeometryCollection=function(g){if(g.isGeometryCollectionBase())throw new jsts.error.IllegalArgumentError("This method does not support GeometryCollection");};jsts.geom.Geometry.prototype.isGeometryCollection=function(){return this instanceof jsts.geom.GeometryCollection};jsts.geom.Geometry.prototype.isGeometryCollectionBase=function(){return this.CLASS_NAME==="jsts.geom.GeometryCollection"};jsts.geom.Geometry.prototype.computeEnvelopeInternal=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.geom.Geometry.prototype.compareToSameClass=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.geom.Geometry.prototype.compare=function(a,b){for(var i=a.iterator(),j=b.iterator();i.hasNext()&&j.hasNext();){var aElement=i.next(),bElement=j.next(),comparison=aElement.compareTo(bElement);if(comparison!==0)return comparison}return i.hasNext()?1:j.hasNext()?-1:0};jsts.geom.Geometry.prototype.equal=function(a,b,tolerance){return tolerance===undefined||tolerance===null||tolerance===0?a.equals(b):a.distance(b)<=tolerance};jsts.geom.Geometry.prototype.getClassSortIndex=function(){for(var sortedClasses=[jsts.geom.Point,jsts.geom.MultiPoint,jsts.geom.LineString,jsts.geom.LinearRing,jsts.geom.MultiLineString,jsts.geom.Polygon,jsts.geom.MultiPolygon,jsts.geom.GeometryCollection],i=0;i<sortedClasses.length;i++)if(this instanceof sortedClasses[i])return i;return jsts.util.Assert.shouldNeverReachHere("Class not supported: "+this),-1};jsts.geom.Geometry.prototype.toString=function(){return(new jsts.io.WKTWriter).write(this)};jsts.geom.Geometry.prototype.createPointFromInternalCoord=function(coord,exemplar){return exemplar.getPrecisionModel().makePrecise(coord),exemplar.getFactory().createPoint(coord)},function(){jsts.geom.Coordinate=function(x,y){typeof x=="number"?(this.x=x,this.y=y):x instanceof jsts.geom.Coordinate?(this.x=parseFloat(x.x),this.y=parseFloat(x.y)):x===undefined||x===null?(this.x=0,this.y=0):typeof x=="string"&&(this.x=parseFloat(x),this.y=parseFloat(y))};jsts.geom.Coordinate.prototype.setCoordinate=function(other){this.x=other.x;this.y=other.y};jsts.geom.Coordinate.prototype.clone=function(){return new jsts.geom.Coordinate(this.x,this.y)};jsts.geom.Coordinate.prototype.distance=function(p){var dx=this.x-p.x,dy=this.y-p.y;return Math.sqrt(dx*dx+dy*dy)};jsts.geom.Coordinate.prototype.equals2D=function(other){return this.x!==other.x?!1:this.y!==other.y?!1:!0};jsts.geom.Coordinate.prototype.equals=function(other){return!other instanceof jsts.geom.Coordinate||other===undefined?!1:this.equals2D(other)};jsts.geom.Coordinate.prototype.compareTo=function(other){return this.x<other.x?-1:this.x>other.x?1:this.y<other.y?-1:this.y>other.y?1:0};jsts.geom.Coordinate.prototype.toString=function(){return"("+this.x+", "+this.y+")"}}();jsts.geom.Envelope=function(){jsts.geom.Envelope.prototype.init.apply(this,arguments)};jsts.geom.Envelope.prototype.minx=null;jsts.geom.Envelope.prototype.maxx=null;jsts.geom.Envelope.prototype.miny=null;jsts.geom.Envelope.prototype.maxy=null;jsts.geom.Envelope.prototype.init=function(){typeof arguments[0]=="number"&&arguments.length===4?this.initFromValues(arguments[0],arguments[1],arguments[2],arguments[3]):arguments[0]instanceof jsts.geom.Coordinate&&arguments.length===1?this.initFromCoordinate(arguments[0]):arguments[0]instanceof jsts.geom.Coordinate&&arguments.length===2?this.initFromCoordinates(arguments[0],arguments[1]):arguments[0]instanceof jsts.geom.Envelope&&arguments.length===1?this.initFromEnvelope(arguments[0]):this.setToNull()};jsts.geom.Envelope.prototype.initFromValues=function(x1,x2,y1,y2){x1<x2?(this.minx=x1,this.maxx=x2):(this.minx=x2,this.maxx=x1);y1<y2?(this.miny=y1,this.maxy=y2):(this.miny=y2,this.maxy=y1)};jsts.geom.Envelope.prototype.initFromCoordinates=function(p1,p2){this.initFromValues(p1.x,p2.x,p1.y,p2.y)};jsts.geom.Envelope.prototype.initFromCoordinate=function(p){this.initFromValues(p.x,p.x,p.y,p.y)};jsts.geom.Envelope.prototype.initFromEnvelope=function(env){this.minx=env.minx;this.maxx=env.maxx;this.miny=env.miny;this.maxy=env.maxy};jsts.geom.Envelope.prototype.setToNull=function(){this.minx=0;this.maxx=-1;this.miny=0;this.maxy=-1};jsts.geom.Envelope.prototype.isNull=function(){return this.maxx<this.minx};jsts.geom.Envelope.prototype.getHeight=function(){return this.isNull()?0:this.maxy-this.miny};jsts.geom.Envelope.prototype.getWidth=function(){return this.isNull()?0:this.maxx-this.minx};jsts.geom.Envelope.prototype.getMinX=function(){return this.minx};jsts.geom.Envelope.prototype.getMaxX=function(){return this.maxx};jsts.geom.Envelope.prototype.getMinY=function(){return this.miny};jsts.geom.Envelope.prototype.getMaxY=function(){return this.maxy};jsts.geom.Envelope.prototype.getArea=function(){return this.getWidth()*this.getHeight()};jsts.geom.Envelope.prototype.expandToInclude=function(){arguments[0]instanceof jsts.geom.Coordinate?this.expandToIncludeCoordinate(arguments[0]):arguments[0]instanceof jsts.geom.Envelope?this.expandToIncludeEnvelope(arguments[0]):this.expandToIncludeValues(arguments[0],arguments[1])};jsts.geom.Envelope.prototype.expandToIncludeCoordinate=function(p){this.expandToIncludeValues(p.x,p.y)};jsts.geom.Envelope.prototype.expandToIncludeValues=function(x,y){this.isNull()?(this.minx=x,this.maxx=x,this.miny=y,this.maxy=y):(x<this.minx&&(this.minx=x),x>this.maxx&&(this.maxx=x),y<this.miny&&(this.miny=y),y>this.maxy&&(this.maxy=y))};jsts.geom.Envelope.prototype.expandToIncludeEnvelope=function(other){other.isNull()||(this.isNull()?(this.minx=other.getMinX(),this.maxx=other.getMaxX(),this.miny=other.getMinY(),this.maxy=other.getMaxY()):(other.minx<this.minx&&(this.minx=other.minx),other.maxx>this.maxx&&(this.maxx=other.maxx),other.miny<this.miny&&(this.miny=other.miny),other.maxy>this.maxy&&(this.maxy=other.maxy)))};jsts.geom.Envelope.prototype.expandBy=function(){arguments.length===1?this.expandByDistance(arguments[0]):this.expandByDistances(arguments[0],arguments[1])};jsts.geom.Envelope.prototype.expandByDistance=function(distance){this.expandByDistances(distance,distance)};jsts.geom.Envelope.prototype.expandByDistances=function(deltaX,deltaY){this.isNull()||(this.minx-=deltaX,this.maxx+=deltaX,this.miny-=deltaY,this.maxy+=deltaY,(this.minx>this.maxx||this.miny>this.maxy)&&this.setToNull())};jsts.geom.Envelope.prototype.translate=function(transX,transY){this.isNull()||this.init(this.minx+transX,this.maxx+transX,this.miny+transY,this.maxy+transY)};jsts.geom.Envelope.prototype.centre=function(){return this.isNull()?null:new jsts.geom.Coordinate((this.minx+this.maxx)/2,(this.miny+this.maxy)/2)};jsts.geom.Envelope.prototype.intersection=function(env){if(this.isNull()||env.isNull()||!this.intersects(env))return new jsts.geom.Envelope;var intMinX=this.minx>env.minx?this.minx:env.minx,intMinY=this.miny>env.miny?this.miny:env.miny,intMaxX=this.maxx<env.maxx?this.maxx:env.maxx,intMaxY=this.maxy<env.maxy?this.maxy:env.maxy;return new jsts.geom.Envelope(intMinX,intMaxX,intMinY,intMaxY)};jsts.geom.Envelope.prototype.intersects=function(){return arguments[0]instanceof jsts.geom.Envelope?this.intersectsEnvelope(arguments[0]):arguments[0]instanceof jsts.geom.Coordinate?this.intersectsCoordinate(arguments[0]):this.intersectsValues(arguments[0],arguments[1])};jsts.geom.Envelope.prototype.intersectsEnvelope=function(other){if(this.isNull()||other.isNull())return!1;return!(other.minx>this.maxx||other.maxx<this.minx||other.miny>this.maxy||other.maxy<this.miny)};jsts.geom.Envelope.prototype.intersectsCoordinate=function(p){return this.intersectsValues(p.x,p.y)};jsts.geom.Envelope.prototype.intersectsValues=function(x,y){return this.isNull()?!1:!(x>this.maxx||x<this.minx||y>this.maxy||y<this.miny)};jsts.geom.Envelope.prototype.contains=function(){return arguments[0]instanceof jsts.geom.Envelope?this.containsEnvelope(arguments[0]):arguments[0]instanceof jsts.geom.Coordinate?this.containsCoordinate(arguments[0]):this.containsValues(arguments[0],arguments[1])};jsts.geom.Envelope.prototype.containsEnvelope=function(other){return this.coversEnvelope(other)};jsts.geom.Envelope.prototype.containsCoordinate=function(p){return this.coversCoordinate(p)};jsts.geom.Envelope.prototype.containsValues=function(x,y){return this.coversValues(x,y)};jsts.geom.Envelope.prototype.covers=function(){p instanceof jsts.geom.Envelope?this.coversEnvelope(arguments[0]):p instanceof jsts.geom.Coordinate?this.coversCoordinate(arguments[0]):this.coversValues(arguments[0],arguments[1])};jsts.geom.Envelope.prototype.coversValues=function(x,y){return this.isNull()?!1:x>=this.minx&&x<=this.maxx&&y>=this.miny&&y<=this.maxy};jsts.geom.Envelope.prototype.coversCoordinate=function(p){return this.coversValues(p.x,p.y)};jsts.geom.Envelope.prototype.coversEnvelope=function(other){return this.isNull()||other.isNull()?!1:other.minx>=this.minx&&other.maxx<=this.maxx&&other.miny>=this.miny&&other.maxy<=this.maxy};jsts.geom.Envelope.prototype.distance=function(env){var dx,dy;return this.intersects(env)?0:(dx=0,this.maxx<env.minx&&(dx=env.minx-this.maxx),this.minx>env.maxx&&(dx=this.minx-env.maxx),dy=0,this.maxy<env.miny&&(dy=env.miny-this.maxy),this.miny>env.maxy&&(dy=this.miny-env.maxy),dx===0)?dy:dy===0?dx:Math.sqrt(dx*dx+dy*dy)};jsts.geom.Envelope.prototype.equals=function(other){return this.isNull()?other.isNull():this.maxx===other.maxx&&this.maxy===other.maxy&&this.minx===other.minx&&this.miny===other.miny};jsts.geom.Envelope.prototype.toString=function(){return"Env["+this.minx+" : "+this.maxx+", "+this.miny+" : "+this.maxy+"]"};jsts.geom.Envelope.intersects=function(p1,p2,q){if(arguments.length===4)return jsts.geom.Envelope.intersectsEnvelope(arguments[0],arguments[1],arguments[2],arguments[3]);var xc1=p1.x<p2.x?p1.x:p2.x,xc2=p1.x>p2.x?p1.x:p2.x,yc1=p1.y<p2.y?p1.y:p2.y,yc2=p1.y>p2.y?p1.y:p2.y;return q.x>=xc1&&q.x<=xc2&&q.y>=yc1&&q.y<=yc2?!0:!1};jsts.geom.Envelope.intersectsEnvelope=function(p1,p2,q1,q2){var minq=Math.min(q1.x,q2.x),maxq=Math.max(q1.x,q2.x),minp=Math.min(p1.x,p2.x),maxp=Math.max(p1.x,p2.x);return minp>maxq?!1:maxp<minq?!1:(minq=Math.min(q1.y,q2.y),maxq=Math.max(q1.y,q2.y),minp=Math.min(p1.y,p2.y),maxp=Math.max(p1.y,p2.y),minp>maxq)?!1:maxp<minq?!1:!0};jsts.geom.Envelope.prototype.clone=function(){return new jsts.geom.Envelope(this.minx,this.maxx,this.miny,this.maxy)};jsts.geom.util.GeometryCombiner=function(geoms){this.geomFactory=jsts.geom.util.GeometryCombiner.extractFactory(geoms);this.inputGeoms=geoms};jsts.geom.util.GeometryCombiner.combine=function(geoms){if(arguments.length>1)return this.combine2.apply(this,arguments);var combiner=new jsts.geom.util.GeometryCombiner(geoms);return combiner.combine()};jsts.geom.util.GeometryCombiner.combine2=function(){var arrayList=new javascript.util.ArrayList,combiner;return Array.prototype.slice.call(arguments).forEach(function(a){arrayList.add(a)}),combiner=new jsts.geom.util.GeometryCombiner(arrayList),combiner.combine()};jsts.geom.util.GeometryCombiner.prototype.geomFactory=null;jsts.geom.util.GeometryCombiner.prototype.skipEmpty=!1;jsts.geom.util.GeometryCombiner.prototype.inputGeoms;jsts.geom.util.GeometryCombiner.extractFactory=function(geoms){return geoms.isEmpty()?null:geoms.iterator().next().getFactory()};jsts.geom.util.GeometryCombiner.prototype.combine=function(){for(var elems=new javascript.util.ArrayList,g,i=this.inputGeoms.iterator();i.hasNext();)g=i.next(),this.extractElements(g,elems);return elems.size()===0?this.geomFactory!==null?geomFactory.createGeometryCollection(null):null:this.geomFactory.buildGeometry(elems)};jsts.geom.util.GeometryCombiner.prototype.extractElements=function(geom,elems){var i,elemGeom;if(geom!==null)for(i=0;i<geom.getNumGeometries();i++)(elemGeom=geom.getGeometryN(i),this.skipEmpty&&elemGeom.isEmpty())||elems.add(elemGeom)};jsts.geom.PrecisionModel=function(modelType){if(typeof modelType=="number"){this.modelType=jsts.geom.PrecisionModel.FIXED;this.scale=modelType;return}this.modelType=modelType||jsts.geom.PrecisionModel.FLOATING;this.modelType===jsts.geom.PrecisionModel.FIXED&&(this.scale=1)};jsts.geom.PrecisionModel.FLOATING="FLOATING";jsts.geom.PrecisionModel.FIXED="FIXED";jsts.geom.PrecisionModel.FLOATING_SINGLE="FLOATING_SINGLE";jsts.geom.PrecisionModel.prototype.scale=null;jsts.geom.PrecisionModel.prototype.modelType=null;jsts.geom.PrecisionModel.prototype.isFloating=function(){return this.modelType===jsts.geom.PrecisionModel.FLOATING||this.modelType===jsts.geom.PrecisionModel.FLOATING_SINLGE};jsts.geom.PrecisionModel.prototype.getScale=function(){return this.scale};jsts.geom.PrecisionModel.prototype.getType=function(){return this.modelType};jsts.geom.PrecisionModel.prototype.equals=function(){return!0};jsts.geom.PrecisionModel.prototype.makePrecise=function(val){if(val instanceof jsts.geom.Coordinate){this.makePrecise2(val);return}return isNaN(val)?val:this.modelType===jsts.geom.PrecisionModel.FIXED?Math.round(val*this.scale)/this.scale:val};jsts.geom.PrecisionModel.prototype.makePrecise2=function(coord){this.modelType!==jsts.geom.PrecisionModel.FLOATING&&(coord.x=this.makePrecise(coord.x),coord.y=this.makePrecise(coord.y))};jsts.geom.PrecisionModel.prototype.compareTo=function(o){var other=o;return 0};jsts.geom.CoordinateFilter=function(){};jsts.geom.CoordinateFilter.prototype.filter=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.geom.Point=function(coordinate,factory){(this.factory=factory,coordinate!==undefined)&&(this.coordinate=coordinate)};jsts.geom.Point.prototype=new jsts.geom.Geometry;jsts.geom.Point.constructor=jsts.geom.Point;jsts.geom.Point.CLASS_NAME="jsts.geom.Point";jsts.geom.Point.prototype.coordinate=null;jsts.geom.Point.prototype.getX=function(){return this.coordinate.x};jsts.geom.Point.prototype.getY=function(){return this.coordinate.y};jsts.geom.Point.prototype.getCoordinate=function(){return this.coordinate};jsts.geom.Point.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.coordinate]};jsts.geom.Point.prototype.isEmpty=function(){return this.coordinate===null};jsts.geom.Point.prototype.equalsExact=function(other,tolerance){return this.isEquivalentClass(other)?this.isEmpty()&&other.isEmpty()?!0:this.equal(other.getCoordinate(),this.getCoordinate(),tolerance):!1};jsts.geom.Point.prototype.getNumPoints=function(){return this.isEmpty()?0:1};jsts.geom.Point.prototype.isSimple=function(){return!0};jsts.geom.Point.prototype.getBoundary=function(){return new jsts.geom.GeometryCollection(null)};jsts.geom.Point.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new jsts.geom.Envelope:new jsts.geom.Envelope(this.coordinate)};jsts.geom.Point.prototype.apply=function(filter){if(filter instanceof jsts.geom.GeometryFilter||filter instanceof jsts.geom.GeometryComponentFilter)filter.filter(this);else if(filter instanceof jsts.geom.CoordinateFilter){if(this.isEmpty())return;filter.filter(this.getCoordinate())}};jsts.geom.Point.prototype.clone=function(){return new jsts.geom.Point(this.coordinate.clone(),this.factory)};jsts.geom.Point.prototype.getDimension=function(){return 0};jsts.geom.Point.prototype.getBoundaryDimension=function(){return jsts.geom.Dimension.FALSE};jsts.geom.Point.prototype.reverse=function(){return this.clone()};jsts.geom.Point.prototype.isValid=function(){return jsts.operation.valid.IsValidOp.isValid(this.getCoordinate())?!0:!1};jsts.geom.Point.prototype.normalize=function(){};jsts.geom.Point.prototype.compareToSameClass=function(other){var point=other;return this.getCoordinate().compareTo(point.getCoordinate())};jsts.geom.Point.prototype.getGeometryType=function(){return"Point"};jsts.geom.Point.prototype.hashCode=function(){return"Point_"+this.coordinate.hashCode()};jsts.geom.Point.prototype.CLASS_NAME="jsts.geom.Point";jsts.geomgraph.EdgeIntersection=function(coord,segmentIndex,dist){this.coord=new jsts.geom.Coordinate(coord);this.segmentIndex=segmentIndex;this.dist=dist};jsts.geomgraph.EdgeIntersection.prototype.coord=null;jsts.geomgraph.EdgeIntersection.prototype.segmentIndex=null;jsts.geomgraph.EdgeIntersection.prototype.dist=null;jsts.geomgraph.EdgeIntersection.prototype.getCoordinate=function(){return this.coord};jsts.geomgraph.EdgeIntersection.prototype.getSegmentIndex=function(){return this.segmentIndex};jsts.geomgraph.EdgeIntersection.prototype.getDistance=function(){return this.dist};jsts.geomgraph.EdgeIntersection.prototype.compareTo=function(other){return this.compare(other.segmentIndex,other.dist)};jsts.geomgraph.EdgeIntersection.prototype.compare=function(segmentIndex,dist){return this.segmentIndex<segmentIndex?-1:this.segmentIndex>segmentIndex?1:this.dist<dist?-1:this.dist>dist?1:0};jsts.geomgraph.EdgeIntersection.prototype.isEndPoint=function(maxSegmentIndex){return this.segmentIndex===0&&this.dist===0?!0:this.segmentIndex===maxSegmentIndex?!0:!1};jsts.geomgraph.EdgeIntersection.prototype.toString=function(){return""+this.segmentIndex+this.dist},function(){var EdgeIntersection=jsts.geomgraph.EdgeIntersection,TreeMap=javascript.util.TreeMap;jsts.geomgraph.EdgeIntersectionList=function(edge){this.nodeMap=new TreeMap;this.edge=edge};jsts.geomgraph.EdgeIntersectionList.prototype.nodeMap=null;jsts.geomgraph.EdgeIntersectionList.prototype.edge=null;jsts.geomgraph.EdgeIntersectionList.prototype.isIntersection=function(pt){for(var ei,it=this.iterator();it.hasNext();)if(ei=it.next(),ei.coord.equals(pt))return!0;return!1};jsts.geomgraph.EdgeIntersectionList.prototype.add=function(intPt,segmentIndex,dist){var eiNew=new EdgeIntersection(intPt,segmentIndex,dist),ei=this.nodeMap.get(eiNew);return ei!==null?ei:(this.nodeMap.put(eiNew,eiNew),eiNew)};jsts.geomgraph.EdgeIntersectionList.prototype.iterator=function(){return this.nodeMap.values().iterator()};jsts.geomgraph.EdgeIntersectionList.prototype.addEndpoints=function(){var maxSegIndex=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0);this.add(this.edge.pts[maxSegIndex],maxSegIndex,0)};jsts.geomgraph.EdgeIntersectionList.prototype.addSplitEdges=function(edgeList){var it,eiPrev,ei,newEdge;for(this.addEndpoints(),it=this.iterator(),eiPrev=it.next();it.hasNext();)ei=it.next(),newEdge=this.createSplitEdge(eiPrev,ei),edgeList.add(newEdge),eiPrev=ei};jsts.geomgraph.EdgeIntersectionList.prototype.createSplitEdge=function(ei0,ei1){var npts=ei1.segmentIndex-ei0.segmentIndex+2,lastSegStartPt=this.edge.pts[ei1.segmentIndex],useIntPt1=ei1.dist>0||!ei1.coord.equals2D(lastSegStartPt),pts,ipt,i;for(useIntPt1||npts--,pts=[],ipt=0,pts[ipt++]=new jsts.geom.Coordinate(ei0.coord),i=ei0.segmentIndex+1;i<=ei1.segmentIndex;i++)pts[ipt++]=this.edge.pts[i];return useIntPt1&&(pts[ipt]=ei1.coord),new jsts.geomgraph.Edge(pts,new jsts.geomgraph.Label(this.edge.label))}}(),function(){var AssertionFailedException=function(message){this.message=message};AssertionFailedException.prototype=new Error;AssertionFailedException.prototype.name="AssertionFailedException";jsts.util.AssertionFailedException=AssertionFailedException}(),function(){var AssertionFailedException=jsts.util.AssertionFailedException;jsts.util.Assert=function(){};jsts.util.Assert.isTrue=function(assertion,message){if(!assertion)if(message===null)throw new AssertionFailedException;else throw new AssertionFailedException(message);};jsts.util.Assert.equals=function(expectedValue,actualValue,message){if(!actualValue.equals(expectedValue))throw new AssertionFailedException("Expected "+expectedValue+" but encountered "+actualValue+(message!=null?": "+message:""));};jsts.util.Assert.shouldNeverReachHere=function(message){throw new AssertionFailedException("Should never reach here"+(message!=null?": "+message:""));}}(),function(){var Location=jsts.geom.Location,Assert=jsts.util.Assert,ArrayList=javascript.util.ArrayList;jsts.operation.relate.RelateComputer=function(arg){this.li=new jsts.algorithm.RobustLineIntersector;this.ptLocator=new jsts.algorithm.PointLocator;this.nodes=new jsts.geomgraph.NodeMap(new jsts.operation.relate.RelateNodeFactory);this.isolatedEdges=new ArrayList;this.arg=arg};jsts.operation.relate.RelateComputer.prototype.li=null;jsts.operation.relate.RelateComputer.prototype.ptLocator=null;jsts.operation.relate.RelateComputer.prototype.arg=null;jsts.operation.relate.RelateComputer.prototype.nodes=null;jsts.operation.relate.RelateComputer.prototype.im=null;jsts.operation.relate.RelateComputer.prototype.isolatedEdges=null;jsts.operation.relate.RelateComputer.prototype.invalidPoint=null;jsts.operation.relate.RelateComputer.prototype.computeIM=function(){var im=new jsts.geom.IntersectionMatrix,intersector,eeBuilder,ee0,ee1;return(im.set(Location.EXTERIOR,Location.EXTERIOR,2),!this.arg[0].getGeometry().getEnvelopeInternal().intersects(this.arg[1].getGeometry().getEnvelopeInternal()))?(this.computeDisjointIM(im),im):(this.arg[0].computeSelfNodes(this.li,!1),this.arg[1].computeSelfNodes(this.li,!1),intersector=this.arg[0].computeEdgeIntersections(this.arg[1],this.li,!1),this.computeIntersectionNodes(0),this.computeIntersectionNodes(1),this.copyNodesAndLabels(0),this.copyNodesAndLabels(1),this.labelIsolatedNodes(),this.computeProperIntersectionIM(intersector,im),eeBuilder=new jsts.operation.relate.EdgeEndBuilder,ee0=eeBuilder.computeEdgeEnds(this.arg[0].getEdgeIterator()),this.insertEdgeEnds(ee0),ee1=eeBuilder.computeEdgeEnds(this.arg[1].getEdgeIterator()),this.insertEdgeEnds(ee1),this.labelNodeEdges(),this.labelIsolatedEdges(0,1),this.labelIsolatedEdges(1,0),this.updateIM(im),im)};jsts.operation.relate.RelateComputer.prototype.insertEdgeEnds=function(ee){for(var e,i=ee.iterator();i.hasNext();)e=i.next(),this.nodes.add(e)};jsts.operation.relate.RelateComputer.prototype.computeProperIntersectionIM=function(intersector,im){var dimA=this.arg[0].getGeometry().getDimension(),dimB=this.arg[1].getGeometry().getDimension(),hasProper=intersector.hasProperIntersection(),hasProperInterior=intersector.hasProperInteriorIntersection();dimA===2&&dimB===2?hasProper&&im.setAtLeast("212101212"):dimA===2&&dimB===1?(hasProper&&im.setAtLeast("FFF0FFFF2"),hasProperInterior&&im.setAtLeast("1FFFFF1FF")):dimA===1&&dimB===2?(hasProper&&im.setAtLeast("F0FFFFFF2"),hasProperInterior&&im.setAtLeast("1F1FFFFFF")):dimA===1&&dimB===1&&hasProperInterior&&im.setAtLeast("0FFFFFFFF")};jsts.operation.relate.RelateComputer.prototype.copyNodesAndLabels=function(argIndex){for(var graphNode,newNode,i=this.arg[argIndex].getNodeIterator();i.hasNext();)graphNode=i.next(),newNode=this.nodes.addNode(graphNode.getCoordinate()),newNode.setLabel(argIndex,graphNode.getLabel().getLocation(argIndex))};jsts.operation.relate.RelateComputer.prototype.computeIntersectionNodes=function(argIndex){for(var e,eLoc,eiIt,ei,n,i=this.arg[argIndex].getEdgeIterator();i.hasNext();)for(e=i.next(),eLoc=e.getLabel().getLocation(argIndex),eiIt=e.getEdgeIntersectionList().iterator();eiIt.hasNext();)ei=eiIt.next(),n=this.nodes.addNode(ei.coord),eLoc===Location.BOUNDARY?n.setLabelBoundary(argIndex):n.getLabel().isNull(argIndex)&&n.setLabel(argIndex,Location.INTERIOR)};jsts.operation.relate.RelateComputer.prototype.labelIntersectionNodes=function(argIndex){for(var e,eLoc,eiIt,ei,n,i=this.arg[argIndex].getEdgeIterator();i.hasNext();)for(e=i.next(),eLoc=e.getLabel().getLocation(argIndex),eiIt=e.getEdgeIntersectionList().iterator();eiIt.hasNext();)ei=eiIt.next(),n=this.nodes.find(ei.coord),n.getLabel().isNull(argIndex)&&(eLoc===Location.BOUNDARY?n.setLabelBoundary(argIndex):n.setLabel(argIndex,Location.INTERIOR))};jsts.operation.relate.RelateComputer.prototype.computeDisjointIM=function(im){var ga=this.arg[0].getGeometry(),gb;ga.isEmpty()||(im.set(Location.INTERIOR,Location.EXTERIOR,ga.getDimension()),im.set(Location.BOUNDARY,Location.EXTERIOR,ga.getBoundaryDimension()));gb=this.arg[1].getGeometry();gb.isEmpty()||(im.set(Location.EXTERIOR,Location.INTERIOR,gb.getDimension()),im.set(Location.EXTERIOR,Location.BOUNDARY,gb.getBoundaryDimension()))};jsts.operation.relate.RelateComputer.prototype.labelNodeEdges=function(){for(var node,ni=this.nodes.iterator();ni.hasNext();)node=ni.next(),node.getEdges().computeLabelling(this.arg)};jsts.operation.relate.RelateComputer.prototype.updateIM=function(im){for(var e,ni,node,ei=this.isolatedEdges.iterator();ei.hasNext();)e=ei.next(),e.updateIM(im);for(ni=this.nodes.iterator();ni.hasNext();)node=ni.next(),node.updateIM(im),node.updateIMFromEdges(im)};jsts.operation.relate.RelateComputer.prototype.labelIsolatedEdges=function(thisIndex,targetIndex){for(var e,ei=this.arg[thisIndex].getEdgeIterator();ei.hasNext();)e=ei.next(),e.isIsolated()&&(this.labelIsolatedEdge(e,targetIndex,this.arg[targetIndex].getGeometry()),this.isolatedEdges.add(e))};jsts.operation.relate.RelateComputer.prototype.labelIsolatedEdge=function(e,targetIndex,target){if(target.getDimension()>0){var loc=this.ptLocator.locate(e.getCoordinate(),target);e.getLabel().setAllLocations(targetIndex,loc)}else e.getLabel().setAllLocations(targetIndex,Location.EXTERIOR)};jsts.operation.relate.RelateComputer.prototype.labelIsolatedNodes=function(){for(var n,label,ni=this.nodes.iterator();ni.hasNext();)n=ni.next(),label=n.getLabel(),Assert.isTrue(label.getGeometryCount()>0,"node with empty label found"),n.isIsolated()&&(label.isNull(0)?this.labelIsolatedNode(n,0):this.labelIsolatedNode(n,1))};jsts.operation.relate.RelateComputer.prototype.labelIsolatedNode=function(n,targetIndex){var loc=this.ptLocator.locate(n.getCoordinate(),this.arg[targetIndex].getGeometry());n.getLabel().setAllLocations(targetIndex,loc)}}(),function(){var Assert=jsts.util.Assert;jsts.geomgraph.GraphComponent=function(label){this.label=label};jsts.geomgraph.GraphComponent.prototype.label=null;jsts.geomgraph.GraphComponent.prototype._isInResult=!1;jsts.geomgraph.GraphComponent.prototype._isCovered=!1;jsts.geomgraph.GraphComponent.prototype._isCoveredSet=!1;jsts.geomgraph.GraphComponent.prototype._isVisited=!1;jsts.geomgraph.GraphComponent.prototype.getLabel=function(){return this.label};jsts.geomgraph.GraphComponent.prototype.setLabel=function(label){if(arguments.length===2){this.setLabel2.apply(this,arguments);return}this.label=label};jsts.geomgraph.GraphComponent.prototype.setInResult=function(isInResult){this._isInResult=isInResult};jsts.geomgraph.GraphComponent.prototype.isInResult=function(){return this._isInResult};jsts.geomgraph.GraphComponent.prototype.setCovered=function(isCovered){this._isCovered=isCovered;this._isCoveredSet=!0};jsts.geomgraph.GraphComponent.prototype.isCovered=function(){return this._isCovered};jsts.geomgraph.GraphComponent.prototype.isCoveredSet=function(){return this._isCoveredSet};jsts.geomgraph.GraphComponent.prototype.isVisited=function(){return this._isVisited};jsts.geomgraph.GraphComponent.prototype.setVisited=function(isVisited){this._isVisited=isVisited};jsts.geomgraph.GraphComponent.prototype.getCoordinate=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.geomgraph.GraphComponent.prototype.computeIM=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.geomgraph.GraphComponent.prototype.isIsolated=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.geomgraph.GraphComponent.prototype.updateIM=function(im){Assert.isTrue(this.label.getGeometryCount()>=2,"found partial label");this.computeIM(im)}}();jsts.geomgraph.Node=function(coord,edges){this.coord=coord;this.edges=edges;this.label=new jsts.geomgraph.Label(0,jsts.geom.Location.NONE)};jsts.geomgraph.Node.prototype=new jsts.geomgraph.GraphComponent;jsts.geomgraph.Node.prototype.coord=null;jsts.geomgraph.Node.prototype.edges=null;jsts.geomgraph.Node.prototype.isIsolated=function(){return this.label.getGeometryCount()==1};jsts.geomgraph.Node.prototype.setLabel2=function(argIndex,onLocation){this.label===null?this.label=new jsts.geomgraph.Label(argIndex,onLocation):this.label.setLocation(argIndex,onLocation)};jsts.geomgraph.Node.prototype.setLabelBoundary=function(argIndex){var loc=jsts.geom.Location.NONE,newLoc;this.label!==null&&(loc=this.label.getLocation(argIndex));switch(loc){case jsts.geom.Location.BOUNDARY:newLoc=jsts.geom.Location.INTERIOR;break;case jsts.geom.Location.INTERIOR:newLoc=jsts.geom.Location.BOUNDARY;break;default:newLoc=jsts.geom.Location.BOUNDARY}this.label.setLocation(argIndex,newLoc)};jsts.geomgraph.Node.prototype.add=function(e){this.edges.insert(e);e.setNode(this)};jsts.geomgraph.Node.prototype.getCoordinate=function(){return this.coord};jsts.geomgraph.Node.prototype.getEdges=function(){return this.edges};jsts.geomgraph.Node.prototype.isIncidentEdgeInResult=function(){for(var de,it=this.getEdges().getEdges().iterator();it.hasNext();)if(de=it.next(),de.getEdge().isInResult())return!0;return!1},function(){var EdgeRing=function(factory){this.deList=new javascript.util.ArrayList;this.factory=factory};EdgeRing.findEdgeRingContaining=function(testEr,shellList){for(var isContained,testRing=testEr.getRing(),testEnv=testRing.getEnvelopeInternal(),testPt=testRing.getCoordinateN(0),minShell=null,minEnv=null,it=shellList.iterator();it.hasNext();){var tryShell=it.next(),tryRing=tryShell.getRing(),tryEnv=tryRing.getEnvelopeInternal();(minShell!=null&&(minEnv=minShell.getRing().getEnvelopeInternal()),isContained=!1,tryEnv.equals(testEnv))||(testPt=jsts.geom.CoordinateArrays.ptNotInList(testRing.getCoordinates(),tryRing.getCoordinates()),tryEnv.contains(testEnv)&&jsts.algorithm.CGAlgorithms.isPointInRing(testPt,tryRing.getCoordinates())&&(isContained=!0),isContained&&(minShell==null||minEnv.contains(tryEnv))&&(minShell=tryShell))}return minShell};EdgeRing.ptNotInList=function(testPts,pts){for(var testPt,i=0;i<testPts.length;i++)if(testPt=testPts[i],!isInList(testPt,pts))return testPt;return null};EdgeRing.isInList=function(pt,pts){for(var i=0;i<pts.length;i++)if(pt.equals(pts[i]))return!0;return!1};EdgeRing.prototype.factory=null;EdgeRing.prototype.deList=null;EdgeRing.prototype.ring=null;EdgeRing.prototype.ringPts=null;EdgeRing.prototype.holes=null;EdgeRing.prototype.add=function(de){this.deList.add(de)};EdgeRing.prototype.isHole=function(){var ring=this.getRing();return jsts.algorithm.CGAlgorithms.isCCW(ring.getCoordinates())};EdgeRing.prototype.addHole=function(hole){this.holes==null&&(this.holes=new javascript.util.ArrayList);this.holes.add(hole)};EdgeRing.prototype.getPolygon=function(){var holeLR=null,i;if(this.holes!=null)for(holeLR=[],i=0;i<this.holes.size();i++)holeLR[i]=this.holes.get(i);return this.factory.createPolygon(this.ring,holeLR)};EdgeRing.prototype.isValid=function(){return(this.getCoordinates(),this.ringPts.length<=3)?!1:(this.getRing(),this.ring.isValid())};EdgeRing.prototype.getCoordinates=function(){var coordList,i,de,edge;if(this.ringPts==null){for(coordList=new jsts.geom.CoordinateList,i=this.deList.iterator();i.hasNext();)de=i.next(),edge=de.getEdge(),EdgeRing.addEdge(edge.getLine().getCoordinates(),de.getEdgeDirection(),coordList);this.ringPts=coordList.toCoordinateArray()}return this.ringPts};EdgeRing.prototype.getLineString=function(){return this.getCoordinates(),this.factory.createLineString(this.ringPts)};EdgeRing.prototype.getRing=function(){if(this.ring!=null)return this.ring;this.getCoordinates();this.ringPts.length<3&&console.log(this.ringPts);try{this.ring=this.factory.createLinearRing(this.ringPts)}catch(ex){console.log(this.ringPts)}return this.ring};EdgeRing.addEdge=function(coords,isForward,coordList){var i;if(isForward)for(i=0;i<coords.length;i++)coordList.add(coords[i],!1);else for(i=coords.length-1;i>=0;i--)coordList.add(coords[i],!1)};jsts.operation.polygonize.EdgeRing=EdgeRing}(),function(){var GraphComponent=function(){};GraphComponent.setVisited=function(i,visited){while(i.hasNext()){var comp=i.next();comp.setVisited(visited)}};GraphComponent.setMarked=function(i,marked){while(i.hasNext()){var comp=i.next();comp.setMarked(marked)}};GraphComponent.getComponentWithVisitedState=function(i,visitedState){while(i.hasNext()){var comp=i.next();if(comp.isVisited()==visitedState)return comp}return null};GraphComponent.prototype._isMarked=!1;GraphComponent.prototype._isVisited=!1;GraphComponent.prototype.data;GraphComponent.prototype.isVisited=function(){return this._isVisited};GraphComponent.prototype.setVisited=function(isVisited){this._isVisited=isVisited};GraphComponent.prototype.isMarked=function(){return this._isMarked};GraphComponent.prototype.setMarked=function(isMarked){this._isMarked=isMarked};GraphComponent.prototype.setContext=function(data){this.data=data};GraphComponent.prototype.getContext=function(){return data};GraphComponent.prototype.setData=function(data){this.data=data};GraphComponent.prototype.getData=function(){return data};GraphComponent.prototype.isRemoved=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.planargraph.GraphComponent=GraphComponent}(),function(){var GraphComponent=jsts.planargraph.GraphComponent,Edge=function(de0,de1){de0!==undefined&&this.setDirectedEdges(de0,de1)};Edge.prototype=new GraphComponent;Edge.prototype.dirEdge=null;Edge.prototype.setDirectedEdges=function(de0,de1){this.dirEdge=[de0,de1];de0.setEdge(this);de1.setEdge(this);de0.setSym(de1);de1.setSym(de0);de0.getFromNode().addOutEdge(de0);de1.getFromNode().addOutEdge(de1)};Edge.prototype.getDirEdge=function(i){return i instanceof jsts.planargraph.Node&&this.getDirEdge2(i),this.dirEdge[i]};Edge.prototype.getDirEdge2=function(fromNode){return this.dirEdge[0].getFromNode()==fromNode?this.dirEdge[0]:this.dirEdge[1].getFromNode()==fromNode?this.dirEdge[1]:null};Edge.prototype.getOppositeNode=function(node){return this.dirEdge[0].getFromNode()==node?this.dirEdge[0].getToNode():this.dirEdge[1].getFromNode()==node?this.dirEdge[1].getToNode():null};Edge.prototype.remove=function(){this.dirEdge=null};Edge.prototype.isRemoved=function(){return dirEdge==null};jsts.planargraph.Edge=Edge}();jsts.operation.polygonize.PolygonizeEdge=function(line){this.line=line};jsts.operation.polygonize.PolygonizeEdge.prototype=new jsts.planargraph.Edge;jsts.operation.polygonize.PolygonizeEdge.prototype.line=null;jsts.operation.polygonize.PolygonizeEdge.prototype.getLine=function(){return this.line},function(){var ArrayList=javascript.util.ArrayList,GraphComponent=jsts.planargraph.GraphComponent,DirectedEdge=function(from,to,directionPt,edgeDirection){if(from!==undefined){this.from=from;this.to=to;this.edgeDirection=edgeDirection;this.p0=from.getCoordinate();this.p1=directionPt;var dx=this.p1.x-this.p0.x,dy=this.p1.y-this.p0.y;this.quadrant=jsts.geomgraph.Quadrant.quadrant(dx,dy);this.angle=Math.atan2(dy,dx)}};DirectedEdge.prototype=new GraphComponent;DirectedEdge.toEdges=function(dirEdges){for(var edges=new ArrayList,i=dirEdges.iterator();i.hasNext();)edges.add(i.next().parentEdge);return edges};DirectedEdge.prototype.parentEdge=null;DirectedEdge.prototype.from=null;DirectedEdge.prototype.to=null;DirectedEdge.prototype.p0=null;DirectedEdge.prototype.p1=null;DirectedEdge.prototype.sym=null;DirectedEdge.prototype.edgeDirection=null;DirectedEdge.prototype.quadrant=null;DirectedEdge.prototype.angle=null;DirectedEdge.prototype.getEdge=function(){return this.parentEdge};DirectedEdge.prototype.setEdge=function(parentEdge){this.parentEdge=parentEdge};DirectedEdge.prototype.getQuadrant=function(){return this.quadrant};DirectedEdge.prototype.getDirectionPt=function(){return this.p1};DirectedEdge.prototype.getEdgeDirection=function(){return this.edgeDirection};DirectedEdge.prototype.getFromNode=function(){return this.from};DirectedEdge.prototype.getToNode=function(){return this.to};DirectedEdge.prototype.getCoordinate=function(){return this.from.getCoordinate()};DirectedEdge.prototype.getAngle=function(){return this.angle};DirectedEdge.prototype.getSym=function(){return this.sym};DirectedEdge.prototype.setSym=function(sym){this.sym=sym};DirectedEdge.prototype.remove=function(){this.sym=null;this.parentEdge=null};DirectedEdge.prototype.isRemoved=function(){return this.parentEdge==null};DirectedEdge.prototype.compareTo=function(obj){var de=obj;return this.compareDirection(de)};DirectedEdge.prototype.compareDirection=function(e){return this.quadrant>e.quadrant?1:this.quadrant<e.quadrant?-1:jsts.algorithm.CGAlgorithms.computeOrientation(e.p0,e.p1,this.p1)};jsts.planargraph.DirectedEdge=DirectedEdge}(),function(){var DirectedEdge=jsts.planargraph.DirectedEdge,PolygonizeDirectedEdge=function(){DirectedEdge.apply(this,arguments)};PolygonizeDirectedEdge.prototype=new DirectedEdge;PolygonizeDirectedEdge.prototype.edgeRing=null;PolygonizeDirectedEdge.prototype.next=null;PolygonizeDirectedEdge.prototype.label=-1;PolygonizeDirectedEdge.prototype.getLabel=function(){return this.label};PolygonizeDirectedEdge.prototype.setLabel=function(label){this.label=label};PolygonizeDirectedEdge.prototype.getNext=function(){return this.next};PolygonizeDirectedEdge.prototype.setNext=function(next){this.next=next};PolygonizeDirectedEdge.prototype.isInRing=function(){return this.edgeRing!=null};PolygonizeDirectedEdge.prototype.setRing=function(edgeRing){this.edgeRing=edgeRing};jsts.operation.polygonize.PolygonizeDirectedEdge=PolygonizeDirectedEdge}(),function(){var ArrayList=javascript.util.ArrayList,DirectedEdgeStar=function(){this.outEdges=new ArrayList};DirectedEdgeStar.prototype.outEdges=null;DirectedEdgeStar.prototype.sorted=!1;DirectedEdgeStar.prototype.add=function(de){this.outEdges.add(de);this.sorted=!1};DirectedEdgeStar.prototype.remove=function(de){this.outEdges.remove(de)};DirectedEdgeStar.prototype.iterator=function(){return this.sortEdges(),this.outEdges.iterator()};DirectedEdgeStar.prototype.getDegree=function(){return this.outEdges.size()};DirectedEdgeStar.prototype.getCoordinate=function(){var it=iterator(),e;return it.hasNext()?(e=it.next(),e.getCoordinate()):null};DirectedEdgeStar.prototype.getEdges=function(){return this.sortEdges(),this.outEdges};DirectedEdgeStar.prototype.sortEdges=function(){if(!this.sorted){var array=this.outEdges.toArray();array.sort(function(a,b){return a.compareTo(b)});this.outEdges=javascript.util.Arrays.asList(array);this.sorted=!0}};DirectedEdgeStar.prototype.getIndex=function(edge){var i,de;if(edge instanceof jsts.planargraph.DirectedEdge)return this.getIndex2(edge);if(typeof edge=="number")return this.getIndex3(edge);for(this.sortEdges(),i=0;i<this.outEdges.size();i++)if(de=this.outEdges.get(i),de.getEdge()==edge)return i;return-1};DirectedEdgeStar.prototype.getIndex2=function(dirEdge){var i,de;for(this.sortEdges(),i=0;i<this.outEdges.size();i++)if(de=this.outEdges.get(i),de==dirEdge)return i;return-1};DirectedEdgeStar.prototype.getIndex3=function(i){var modi=toInt(i%this.outEdges.size());return modi<0&&(modi+=this.outEdges.size()),modi};DirectedEdgeStar.prototype.getNextEdge=function(dirEdge){var i=this.getIndex(dirEdge);return this.outEdges.get(getIndex(i+1))};DirectedEdgeStar.prototype.getNextCWEdge=function(dirEdge){var i=this.getIndex(dirEdge);return this.outEdges.get(getIndex(i-1))};jsts.planargraph.DirectedEdgeStar=DirectedEdgeStar}(),function(){var GraphComponent=jsts.planargraph.GraphComponent,DirectedEdgeStar=jsts.planargraph.DirectedEdgeStar,Node=function(pt,deStar){this.pt=pt;this.deStar=deStar||new DirectedEdgeStar};Node.prototype=new GraphComponent;Node.getEdgesBetween=function(node0,node1){var edges0=DirectedEdge.toEdges(node0.getOutEdges().getEdges()),commonEdges=new javascript.util.HashSet(edges0),edges1=DirectedEdge.toEdges(node1.getOutEdges().getEdges());return commonEdges.retainAll(edges1),commonEdges};Node.prototype.pt=null;Node.prototype.deStar=null;Node.prototype.getCoordinate=function(){return this.pt};Node.prototype.addOutEdge=function(de){this.deStar.add(de)};Node.prototype.getOutEdges=function(){return this.deStar};Node.prototype.getDegree=function(){return this.deStar.getDegree()};Node.prototype.getIndex=function(edge){return this.deStar.getIndex(edge)};Node.prototype.remove=function(de){if(de===undefined)return this.remove2();this.deStar.remove(de)};Node.prototype.remove2=function(){this.pt=null};Node.prototype.isRemoved=function(){return this.pt==null};jsts.planargraph.Node=Node}(),function(){var NodeMap=function(){this.nodeMap=new javascript.util.TreeMap};NodeMap.prototype.nodeMap=null;NodeMap.prototype.add=function(n){return this.nodeMap.put(n.getCoordinate(),n),n};NodeMap.prototype.remove=function(pt){return this.nodeMap.remove(pt)};NodeMap.prototype.find=function(coord){return this.nodeMap.get(coord)};NodeMap.prototype.iterator=function(){return this.nodeMap.values().iterator()};NodeMap.prototype.values=function(){return this.nodeMap.values()};jsts.planargraph.NodeMap=NodeMap}(),function(){var ArrayList=javascript.util.ArrayList,PlanarGraph=function(){this.edges=new javascript.util.HashSet;this.dirEdges=new javascript.util.HashSet;this.nodeMap=new jsts.planargraph.NodeMap};PlanarGraph.prototype.edges=null;PlanarGraph.prototype.dirEdges=null;PlanarGraph.prototype.nodeMap=null;PlanarGraph.prototype.findNode=function(pt){return this.nodeMap.find(pt)};PlanarGraph.prototype.add=function(node){if(node instanceof jsts.planargraph.Edge)return this.add2(node);if(node instanceof jsts.planargraph.DirectedEdge)return this.add3(node);this.nodeMap.add(node)};PlanarGraph.prototype.add2=function(edge){this.edges.add(edge);this.add(edge.getDirEdge(0));this.add(edge.getDirEdge(1))};PlanarGraph.prototype.add3=function(dirEdge){this.dirEdges.add(dirEdge)};PlanarGraph.prototype.nodeIterator=function(){return this.nodeMap.iterator()};PlanarGraph.prototype.contains=function(e){return e instanceof jsts.planargraph.DirectedEdge?this.contains2(e):this.edges.contains(e)};PlanarGraph.prototype.contains2=function(de){return this.dirEdges.contains(de)};PlanarGraph.prototype.getNodes=function(){return this.nodeMap.values()};PlanarGraph.prototype.dirEdgeIterator=function(){return this.dirEdges.iterator()};PlanarGraph.prototype.edgeIterator=function(){return this.edges.iterator()};PlanarGraph.prototype.getEdges=function(){return this.edges};PlanarGraph.prototype.remove=function(edge){if(edge instanceof jsts.planargraph.DirectedEdge)return this.remove2(edge);this.remove(edge.getDirEdge(0));this.remove(edge.getDirEdge(1));this.edges.remove(edge);this.edge.remove()};PlanarGraph.prototype.remove2=function(de){if(de instanceof jsts.planargraph.Node)return this.remove3(de);var sym=de.getSym();sym!=null&&sym.setSym(null);de.getFromNode().remove(de);de.remove();this.dirEdges.remove(de)};PlanarGraph.prototype.remove3=function(node){for(var de,sym,edge,outEdges=node.getOutEdges().getEdges(),i=outEdges.iterator();i.hasNext();)de=i.next(),sym=de.getSym(),sym!=null&&this.remove(sym),this.dirEdges.remove(de),edge=de.getEdge(),edge!=null&&this.edges.remove(edge);this.nodeMap.remove(node.getCoordinate());node.remove()};PlanarGraph.prototype.findNodesOfDegree=function(degree){for(var node,nodesFound=new ArrayList,i=this.nodeIterator();i.hasNext();)node=i.next(),node.getDegree()==degree&&nodesFound.add(node);return nodesFound};jsts.planargraph.PlanarGraph=PlanarGraph}(),function(){var ArrayList=javascript.util.ArrayList,Stack=javascript.util.Stack,HashSet=javascript.util.HashSet,Assert=jsts.util.Assert,EdgeRing=jsts.operation.polygonize.EdgeRing,PolygonizeEdge=jsts.operation.polygonize.PolygonizeEdge,PolygonizeDirectedEdge=jsts.operation.polygonize.PolygonizeDirectedEdge,PlanarGraph=jsts.planargraph.PlanarGraph,Node=jsts.planargraph.Node,PolygonizeGraph=function(factory){PlanarGraph.apply(this);this.factory=factory};PolygonizeGraph.prototype=new PlanarGraph;PolygonizeGraph.getDegreeNonDeleted=function(node){for(var de,edges=node.getOutEdges().getEdges(),degree=0,i=edges.iterator();i.hasNext();)de=i.next(),de.isMarked()||degree++;return degree};PolygonizeGraph.getDegree=function(node,label){for(var de,edges=node.getOutEdges().getEdges(),degree=0,i=edges.iterator();i.hasNext();)de=i.next(),de.getLabel()==label&&degree++;return degree};PolygonizeGraph.deleteAllEdges=function(node){for(var de,sym,edges=node.getOutEdges().getEdges(),i=edges.iterator();i.hasNext();)de=i.next(),de.setMarked(!0),sym=de.getSym(),sym!=null&&sym.setMarked(!0)};PolygonizeGraph.prototype.factory=null;PolygonizeGraph.prototype.addEdge=function(line){var linePts;if(!line.isEmpty()&&(linePts=jsts.geom.CoordinateArrays.removeRepeatedPoints(line.getCoordinates()),!(linePts.length<2))){var startPt=linePts[0],endPt=linePts[linePts.length-1],nStart=this.getNode(startPt),nEnd=this.getNode(endPt),de0=new PolygonizeDirectedEdge(nStart,nEnd,linePts[1],!0),de1=new PolygonizeDirectedEdge(nEnd,nStart,linePts[linePts.length-2],!1),edge=new PolygonizeEdge(line);edge.setDirectedEdges(de0,de1);this.add(edge)}};PolygonizeGraph.prototype.getNode=function(pt){var node=this.findNode(pt);return node==null&&(node=new Node(pt),this.add(node)),node};PolygonizeGraph.prototype.computeNextCWEdges=function(){for(var node,iNode=this.nodeIterator();iNode.hasNext();)node=iNode.next(),PolygonizeGraph.computeNextCWEdges(node)};PolygonizeGraph.prototype.convertMaximalToMinimalEdgeRings=function(ringEdges){for(var iNode,node,i=ringEdges.iterator();i.hasNext();){var de=i.next(),label=de.getLabel(),intNodes=PolygonizeGraph.findIntersectionNodes(de,label);if(intNodes!=null)for(iNode=intNodes.iterator();iNode.hasNext();)node=iNode.next(),PolygonizeGraph.computeNextCCWEdges(node,label)}};PolygonizeGraph.findIntersectionNodes=function(startDE,label){var de=startDE,intNodes=null,node;do node=de.getFromNode(),PolygonizeGraph.getDegree(node,label)>1&&(intNodes==null&&(intNodes=new ArrayList),intNodes.add(node)),de=de.getNext(),Assert.isTrue(de!=null,"found null DE in ring"),Assert.isTrue(de==startDE||!de.isInRing(),"found DE already in ring");while(de!=startDE);return intNodes};PolygonizeGraph.prototype.getEdgeRings=function(){var maximalRings,edgeRingList,i,de,er;for(this.computeNextCWEdges(),PolygonizeGraph.label(this.dirEdges,-1),maximalRings=PolygonizeGraph.findLabeledEdgeRings(this.dirEdges),this.convertMaximalToMinimalEdgeRings(maximalRings),edgeRingList=new ArrayList,i=this.dirEdges.iterator();i.hasNext();)(de=i.next(),de.isMarked())||de.isInRing()||(er=this.findEdgeRing(de),edgeRingList.add(er));return edgeRingList};PolygonizeGraph.findLabeledEdgeRings=function(dirEdges){for(var de,edges,edgeRingStarts=new ArrayList,currLabel=1,i=dirEdges.iterator();i.hasNext();)(de=i.next(),de.isMarked())||de.getLabel()>=0||(edgeRingStarts.add(de),edges=PolygonizeGraph.findDirEdgesInRing(de),PolygonizeGraph.label(edges,currLabel),currLabel++);return edgeRingStarts};PolygonizeGraph.prototype.deleteCutEdges=function(){var cutLines,i,de,sym,e;for(this.computeNextCWEdges(),PolygonizeGraph.findLabeledEdgeRings(this.dirEdges),cutLines=new ArrayList,i=this.dirEdges.iterator();i.hasNext();)(de=i.next(),de.isMarked())||(sym=de.getSym(),de.getLabel()==sym.getLabel()&&(de.setMarked(!0),sym.setMarked(!0),e=de.getEdge(),cutLines.add(e.getLine())));return cutLines};PolygonizeGraph.label=function(dirEdges,label){for(var de,i=dirEdges.iterator();i.hasNext();)de=i.next(),de.setLabel(label)};PolygonizeGraph.computeNextCWEdges=function(node){for(var outDE,sym,deStar=node.getOutEdges(),startDE=null,prevDE=null,i=deStar.getEdges().iterator();i.hasNext();)(outDE=i.next(),outDE.isMarked())||(startDE==null&&(startDE=outDE),prevDE!=null&&(sym=prevDE.getSym(),sym.setNext(outDE)),prevDE=outDE);prevDE!=null&&(sym=prevDE.getSym(),sym.setNext(startDE))};PolygonizeGraph.computeNextCCWEdges=function(node,label){for(var inDE,deStar=node.getOutEdges(),firstOutDE=null,prevInDE=null,edges=deStar.getEdges(),i=edges.size()-1;i>=0;i--){var de=edges.get(i),sym=de.getSym(),outDE=null;(de.getLabel()==label&&(outDE=de),inDE=null,sym.getLabel()==label&&(inDE=sym),outDE!=null||inDE!=null)&&(inDE!=null&&(prevInDE=inDE),outDE!=null&&(prevInDE!=null&&(prevInDE.setNext(outDE),prevInDE=null),firstOutDE==null&&(firstOutDE=outDE)))}prevInDE!=null&&(Assert.isTrue(firstOutDE!=null),prevInDE.setNext(firstOutDE))};PolygonizeGraph.findDirEdgesInRing=function(startDE){var de=startDE,edges=new ArrayList;do edges.add(de),de=de.getNext(),Assert.isTrue(de!=null,"found null DE in ring"),Assert.isTrue(de==startDE||!de.isInRing(),"found DE already in ring");while(de!=startDE);return edges};PolygonizeGraph.prototype.findEdgeRing=function(startDE){var de=startDE,er=new EdgeRing(this.factory);do er.add(de),de.setRing(er),de=de.getNext(),Assert.isTrue(de!=null,"found null DE in ring"),Assert.isTrue(de==startDE||!de.isInRing(),"found DE already in ring");while(de!=startDE);return er};PolygonizeGraph.prototype.deleteDangles=function(){for(var node,nodeOutEdges,de,sym,e,toNode,nodesToRemove=this.findNodesOfDegree(1),dangleLines=new HashSet,nodeStack=new Stack,i=nodesToRemove.iterator();i.hasNext();)nodeStack.push(i.next());while(!nodeStack.isEmpty())for(node=nodeStack.pop(),PolygonizeGraph.deleteAllEdges(node),nodeOutEdges=node.getOutEdges().getEdges(),i=nodeOutEdges.iterator();i.hasNext();)de=i.next(),de.setMarked(!0),sym=de.getSym(),sym!=null&&sym.setMarked(!0),e=de.getEdge(),dangleLines.add(e.getLine()),toNode=de.getToNode(),PolygonizeGraph.getDegreeNonDeleted(toNode)==1&&nodeStack.push(toNode);return dangleLines};PolygonizeGraph.prototype.computeDepthParity=function(){for(;;){var de=null;if(de==null)return;this.computeDepthParity(de)}};PolygonizeGraph.prototype.computeDepthParity=function(){};jsts.operation.polygonize.PolygonizeGraph=PolygonizeGraph}();jsts.index.strtree.Interval=function(){var other;if(arguments.length===1)return other=arguments[0],jsts.index.strtree.Interval(other.min,other.max);arguments.length===2&&(jsts.util.Assert.isTrue(this.min<=this.max),this.min=arguments[0],this.max=arguments[1])};jsts.index.strtree.Interval.prototype.min=null;jsts.index.strtree.Interval.prototype.max=null;jsts.index.strtree.Interval.prototype.getCentre=function(){return(this.min+this.max)/2};jsts.index.strtree.Interval.prototype.expandToInclude=function(other){return this.max=Math.max(this.max,other.max),this.min=Math.min(this.min,other.min),this};jsts.index.strtree.Interval.prototype.intersects=function(other){return!(other.min>this.max||other.max<this.min)};jsts.index.strtree.Interval.prototype.equals=function(o){return(o instanceof jsts.index.strtree.Interval)?(other=o,this.min===other.min&&this.max===other.max):!1};jsts.geom.GeometryFactory=function(precisionModel){this.precisionModel=precisionModel||new jsts.geom.PrecisionModel};jsts.geom.GeometryFactory.prototype.precisionModel=null;jsts.geom.GeometryFactory.prototype.getPrecisionModel=function(){return this.precisionModel};jsts.geom.GeometryFactory.prototype.createPoint=function(coordinate){return new jsts.geom.Point(coordinate,this)};jsts.geom.GeometryFactory.prototype.createLineString=function(coordinates){return new jsts.geom.LineString(coordinates,this)};jsts.geom.GeometryFactory.prototype.createLinearRing=function(coordinates){return new jsts.geom.LinearRing(coordinates,this)};jsts.geom.GeometryFactory.prototype.createPolygon=function(shell,holes){return new jsts.geom.Polygon(shell,holes,this)};jsts.geom.GeometryFactory.prototype.createMultiPoint=function(points){if(points&&points[0]instanceof jsts.geom.Coordinate){for(var converted=[],i=0;i<points.length;i++)converted.push(this.createPoint(points[i]));points=converted}return new jsts.geom.MultiPoint(points,this)};jsts.geom.GeometryFactory.prototype.createMultiLineString=function(lineStrings){return new jsts.geom.MultiLineString(lineStrings,this)};jsts.geom.GeometryFactory.prototype.createMultiPolygon=function(polygons){return new jsts.geom.MultiPolygon(polygons,this)};jsts.geom.GeometryFactory.prototype.buildGeometry=function(geomList){for(var geom,partClass,geom0,isCollection,geomClass=null,isHeterogeneous=!1,hasGeometryCollection=!1,i=geomList.iterator();i.hasNext();)geom=i.next(),partClass=geom.CLASS_NAME,geomClass===null&&(geomClass=partClass),partClass===geomClass||(isHeterogeneous=!0),geom.isGeometryCollectionBase()&&(hasGeometryCollection=!0);if(geomClass===null)return this.createGeometryCollection(null);if(isHeterogeneous||hasGeometryCollection)return this.createGeometryCollection(geomList.toArray());if(geom0=geomList.get(0),isCollection=geomList.size()>1,isCollection){if(geom0 instanceof jsts.geom.Polygon)return this.createMultiPolygon(geomList.toArray());if(geom0 instanceof jsts.geom.LineString)return this.createMultiLineString(geomList.toArray());if(geom0 instanceof jsts.geom.Point)return this.createMultiPoint(geomList.toArray());jsts.util.Assert.shouldNeverReachHere("Unhandled class: "+geom0)}return geom0};jsts.geom.GeometryFactory.prototype.createGeometryCollection=function(geometries){return new jsts.geom.GeometryCollection(geometries,this)};jsts.geom.GeometryFactory.prototype.toGeometry=function(envelope){return envelope.isNull()?this.createPoint(null):envelope.getMinX()===envelope.getMaxX()&&envelope.getMinY()===envelope.getMaxY()?this.createPoint(new jsts.geom.Coordinate(envelope.getMinX(),envelope.getMinY())):envelope.getMinX()===envelope.getMaxX()||envelope.getMinY()===envelope.getMaxY()?this.createLineString([new jsts.geom.Coordinate(envelope.getMinX(),envelope.getMinY()),new jsts.geom.Coordinate(envelope.getMaxX(),envelope.getMaxY())]):this.createPolygon(this.createLinearRing([new jsts.geom.Coordinate(envelope.getMinX(),envelope.getMinY()),new jsts.geom.Coordinate(envelope.getMinX(),envelope.getMaxY()),new jsts.geom.Coordinate(envelope.getMaxX(),envelope.getMaxY()),new jsts.geom.Coordinate(envelope.getMaxX(),envelope.getMinY()),new jsts.geom.Coordinate(envelope.getMinX(),envelope.getMinY())]),null)};jsts.index.quadtree.NodeBase=function(){this.subnode=new Array(4);this.subnode[0]=null;this.subnode[1]=null;this.subnode[2]=null;this.subnode[3]=null;this.items=[]};jsts.index.quadtree.NodeBase.prototype.getSubnodeIndex=function(env,centre){var subnodeIndex=-1;return env.getMinX()>=centre.x&&(env.getMinY()>=centre.y&&(subnodeIndex=3),env.getMaxY()<=centre.y&&(subnodeIndex=1)),env.getMaxX()<=centre.x&&(env.getMinY()>=centre.y&&(subnodeIndex=2),env.getMaxY()<=centre.y&&(subnodeIndex=0)),subnodeIndex};jsts.index.quadtree.NodeBase.prototype.getItems=function(){return this.items};jsts.index.quadtree.NodeBase.prototype.hasItems=function(){return this.items.length>0};jsts.index.quadtree.NodeBase.prototype.add=function(item){this.items.push(item)};jsts.index.quadtree.NodeBase.prototype.remove=function(itemEnv,item){var found,i;if(!this.isSearchMatch(itemEnv))return!1;for(found=!1,i=0,i;i<4;i++)if(this.subnode[i]!==null&&(found=this.subnode[i].remove(itemEnv,item),found)){this.subnode[i].isPrunable()&&(this.subnode[i]=null);break}if(found)return found;if(this.items.indexOf(item)!==-1){for(i=this.items.length-1;i>=0;i--)this.items[i]===item&&this.items.splice(i,1);found=!0}return found};jsts.index.quadtree.NodeBase.prototype.isPrunable=function(){return!(this.hasChildren()||this.hasItems())};jsts.index.quadtree.NodeBase.prototype.hasChildren=function(){var i=0;for(i;i<4;i++)if(this.subnode[i]!==null)return!0;return!1};jsts.index.quadtree.NodeBase.prototype.isEmpty=function(){var isEmpty=!0,i;for(this.items.length>0&&(isEmpty=!1),i=0,i;i<4;i++)this.subnode[i]!==null&&(this.subnode[i].isEmpty()||(isEmpty=!1));return isEmpty};jsts.index.quadtree.NodeBase.prototype.addAllItems=function(resultItems){resultItems=resultItems.concat(this.items);var i=0;for(i;i<4;i++)this.subnode[i]!==null&&(resultItems=this.subnode[i].addAllItems(resultItems));return resultItems};jsts.index.quadtree.NodeBase.prototype.addAllItemsFromOverlapping=function(searchEnv,resultItems){if(this.isSearchMatch(searchEnv)){resultItems=resultItems.concat(this.items);var i=0;for(i;i<4;i++)this.subnode[i]!==null&&(resultItems=this.subnode[i].addAllItemsFromOverlapping(searchEnv,resultItems))}};jsts.index.quadtree.NodeBase.prototype.visit=function(searchEnv,visitor){if(this.isSearchMatch(searchEnv)){this.visitItems(searchEnv,visitor);var i=0;for(i;i<4;i++)this.subnode[i]!==null&&this.subnode[i].visit(searchEnv,visitor)}};jsts.index.quadtree.NodeBase.prototype.visitItems=function(env,visitor){var i=0,il=this.items.length;for(i;i<il;i++)visitor.visitItem(this.items[i])};jsts.index.quadtree.NodeBase.prototype.depth=function(){var maxSubDepth=0,i=0,sqd;for(i;i<4;i++)this.subnode[i]!==null&&(sqd=this.subnode[i].depth(),sqd>maxSubDepth&&(maxSubDepth=sqd));return maxSubDepth+1};jsts.index.quadtree.NodeBase.prototype.size=function(){var subSize=0,i=0;for(i;i<4;i++)this.subnode[i]!==null&&(subSize+=this.subnode[i].size());return subSize+this.items.length};jsts.index.quadtree.NodeBase.prototype.getNodeCount=function(){var subSize=0,i=0;for(i;i<4;i++)this.subnode[i]!==null&&(subSize+=this.subnode[i].size());return subSize+1};jsts.index.quadtree.Node=function(env,level){jsts.index.quadtree.NodeBase.prototype.constructor.apply(this,arguments);this.env=env;this.level=level;this.centre=new jsts.geom.Coordinate;this.centre.x=(env.getMinX()+env.getMaxX())/2;this.centre.y=(env.getMinY()+env.getMaxY())/2};jsts.index.quadtree.Node.prototype=new jsts.index.quadtree.NodeBase;jsts.index.quadtree.Node.createNode=function(env){var key;return key=new jsts.index.quadtree.Key(env),new jsts.index.quadtree.Node(key.getEnvelope(),key.getLevel())};jsts.index.quadtree.Node.createExpanded=function(node,addEnv){var expandEnv=new jsts.geom.Envelope(addEnv),largerNode;return node!==null&&expandEnv.expandToInclude(node.env),largerNode=jsts.index.quadtree.Node.createNode(expandEnv),node!==null&&largerNode.insertNode(node),largerNode};jsts.index.quadtree.Node.prototype.getEnvelope=function(){return this.env};jsts.index.quadtree.Node.prototype.isSearchMatch=function(searchEnv){return this.env.intersects(searchEnv)};jsts.index.quadtree.Node.prototype.getNode=function(searchEnv){var subnodeIndex=this.getSubnodeIndex(searchEnv,this.centre),node;return subnodeIndex!==-1?(node=this.getSubnode(subnodeIndex),node.getNode(searchEnv)):this};jsts.index.quadtree.Node.prototype.find=function(searchEnv){var subnodeIndex=this.getSubnodeIndex(searchEnv,this.centre),node;return subnodeIndex===-1?this:this.subnode[subnodeIndex]!==null?(node=this.subnode[subnodeIndex],node.find(searchEnv)):this};jsts.index.quadtree.Node.prototype.insertNode=function(node){var index=this.getSubnodeIndex(node.env,this.centre),childNode;node.level===this.level-1?this.subnode[index]=node:(childNode=this.createSubnode(index),childNode.insertNode(node),this.subnode[index]=childNode)};jsts.index.quadtree.Node.prototype.getSubnode=function(index){return this.subnode[index]===null&&(this.subnode[index]=this.createSubnode(index)),this.subnode[index]};jsts.index.quadtree.Node.prototype.createSubnode=function(index){var minx=0,maxx=0,miny=0,maxy=0,sqEnv;switch(index){case 0:minx=this.env.getMinX();maxx=this.centre.x;miny=this.env.getMinY();maxy=this.centre.y;break;case 1:minx=this.centre.x;maxx=this.env.getMaxX();miny=this.env.getMinY();maxy=this.centre.y;break;case 2:minx=this.env.getMinX();maxx=this.centre.x;miny=this.centre.y;maxy=this.env.getMaxY();break;case 3:minx=this.centre.x;maxx=this.env.getMaxX();miny=this.centre.y;maxy=this.env.getMaxY()}return sqEnv=new jsts.geom.Envelope(minx,maxx,miny,maxy),new jsts.index.quadtree.Node(sqEnv,this.level-1)},function(){jsts.geomgraph.Position=function(){};jsts.geomgraph.Position.ON=0;jsts.geomgraph.Position.LEFT=1;jsts.geomgraph.Position.RIGHT=2;jsts.geomgraph.Position.opposite=function(position){return position===jsts.geomgraph.Position.LEFT?jsts.geomgraph.Position.RIGHT:position===jsts.geomgraph.Position.RIGHT?jsts.geomgraph.Position.LEFT:position}}();jsts.geomgraph.TopologyLocation=function(){var gl,i,on,location;if(this.location=[],arguments.length===3){var on=arguments[0],left=arguments[1],right=arguments[2];this.init(3);this.location[jsts.geomgraph.Position.ON]=on;this.location[jsts.geomgraph.Position.LEFT]=left;this.location[jsts.geomgraph.Position.RIGHT]=right}else if(arguments[0]instanceof jsts.geomgraph.TopologyLocation){if(gl=arguments[0],this.init(gl.location.length),gl!=null)for(i=0;i<this.location.length;i++)this.location[i]=gl.location[i]}else typeof arguments[0]=="number"?(on=arguments[0],this.init(1),this.location[jsts.geomgraph.Position.ON]=on):arguments[0]instanceof Array&&(location=arguments[0],this.init(location.length))};jsts.geomgraph.TopologyLocation.prototype.location=null;jsts.geomgraph.TopologyLocation.prototype.init=function(size){this.location[size-1]=null;this.setAllLocations(jsts.geom.Location.NONE)};jsts.geomgraph.TopologyLocation.prototype.get=function(posIndex){return posIndex<this.location.length?this.location[posIndex]:jsts.geom.Location.NONE};jsts.geomgraph.TopologyLocation.prototype.isNull=function(){for(var i=0;i<this.location.length;i++)if(this.location[i]!==jsts.geom.Location.NONE)return!1;return!0};jsts.geomgraph.TopologyLocation.prototype.isAnyNull=function(){for(var i=0;i<this.location.length;i++)if(this.location[i]===jsts.geom.Location.NONE)return!0;return!1};jsts.geomgraph.TopologyLocation.prototype.isEqualOnSide=function(le,locIndex){return this.location[locIndex]==le.location[locIndex]};jsts.geomgraph.TopologyLocation.prototype.isArea=function(){return this.location.length>1};jsts.geomgraph.TopologyLocation.prototype.isLine=function(){return this.location.length===1};jsts.geomgraph.TopologyLocation.prototype.flip=function(){if(!(this.location.length<=1)){var temp=this.location[jsts.geomgraph.Position.LEFT];this.location[jsts.geomgraph.Position.LEFT]=this.location[jsts.geomgraph.Position.RIGHT];this.location[jsts.geomgraph.Position.RIGHT]=temp}};jsts.geomgraph.TopologyLocation.prototype.setAllLocations=function(locValue){for(var i=0;i<this.location.length;i++)this.location[i]=locValue};jsts.geomgraph.TopologyLocation.prototype.setAllLocationsIfNull=function(locValue){for(var i=0;i<this.location.length;i++)this.location[i]===jsts.geom.Location.NONE&&(this.location[i]=locValue)};jsts.geomgraph.TopologyLocation.prototype.setLocation=function(locIndex,locValue){locValue!==undefined?this.location[locIndex]=locValue:this.setLocation(jsts.geomgraph.Position.ON,locIndex)};jsts.geomgraph.TopologyLocation.prototype.getLocations=function(){return location};jsts.geomgraph.TopologyLocation.prototype.setLocations=function(on,left,right){this.location[jsts.geomgraph.Position.ON]=on;this.location[jsts.geomgraph.Position.LEFT]=left;this.location[jsts.geomgraph.Position.RIGHT]=right};jsts.geomgraph.TopologyLocation.prototype.allPositionsEqual=function(loc){for(var i=0;i<this.location.length;i++)if(this.location[i]!==loc)return!1;return!0};jsts.geomgraph.TopologyLocation.prototype.merge=function(gl){var newLoc,i;for(gl.location.length>this.location.length&&(newLoc=[],newLoc[jsts.geomgraph.Position.ON]=this.location[jsts.geomgraph.Position.ON],newLoc[jsts.geomgraph.Position.LEFT]=jsts.geom.Location.NONE,newLoc[jsts.geomgraph.Position.RIGHT]=jsts.geom.Location.NONE,this.location=newLoc),i=0;i<this.location.length;i++)this.location[i]===jsts.geom.Location.NONE&&i<gl.location.length&&(this.location[i]=gl.location[i])};jsts.geomgraph.Label=function(){this.elt=[];var geomIndex,onLoc,leftLoc,lbl,rightLoc;arguments.length===4?(geomIndex=arguments[0],onLoc=arguments[1],leftLoc=arguments[2],rightLoc=arguments[3],this.elt[0]=new jsts.geomgraph.TopologyLocation(jsts.geom.Location.NONE,jsts.geom.Location.NONE,jsts.geom.Location.NONE),this.elt[1]=new jsts.geomgraph.TopologyLocation(jsts.geom.Location.NONE,jsts.geom.Location.NONE,jsts.geom.Location.NONE),this.elt[geomIndex].setLocations(onLoc,leftLoc,rightLoc)):arguments.length===3?(onLoc=arguments[0],leftLoc=arguments[1],rightLoc=arguments[2],this.elt[0]=new jsts.geomgraph.TopologyLocation(onLoc,leftLoc,rightLoc),this.elt[1]=new jsts.geomgraph.TopologyLocation(onLoc,leftLoc,rightLoc)):arguments.length===2?(geomIndex=arguments[0],onLoc=arguments[1],this.elt[0]=new jsts.geomgraph.TopologyLocation(jsts.geom.Location.NONE),this.elt[1]=new jsts.geomgraph.TopologyLocation(jsts.geom.Location.NONE),this.elt[geomIndex].setLocation(onLoc)):arguments[0]instanceof jsts.geomgraph.Label?(lbl=arguments[0],this.elt[0]=new jsts.geomgraph.TopologyLocation(lbl.elt[0]),this.elt[1]=new jsts.geomgraph.TopologyLocation(lbl.elt[1])):typeof arguments[0]=="number"&&(onLoc=arguments[0],this.elt[0]=new jsts.geomgraph.TopologyLocation(onLoc),this.elt[1]=new jsts.geomgraph.TopologyLocation(onLoc))};jsts.geomgraph.Label.toLineLabel=function(label){for(var lineLabel=new jsts.geomgraph.Label(jsts.geom.Location.NONE),i=0;i<2;i++)lineLabel.setLocation(i,label.getLocation(i));return lineLabel};jsts.geomgraph.Label.prototype.elt=null;jsts.geomgraph.Label.prototype.flip=function(){this.elt[0].flip();this.elt[1].flip()};jsts.geomgraph.Label.prototype.getLocation=function(geomIndex,posIndex){return arguments.length==1?this.getLocation2.apply(this,arguments):this.elt[geomIndex].get(posIndex)};jsts.geomgraph.Label.prototype.getLocation2=function(geomIndex){return this.elt[geomIndex].get(jsts.geomgraph.Position.ON)};jsts.geomgraph.Label.prototype.setLocation=function(geomIndex,posIndex,location){if(arguments.length==2){this.setLocation2.apply(this,arguments);return}this.elt[geomIndex].setLocation(posIndex,location)};jsts.geomgraph.Label.prototype.setLocation2=function(geomIndex,location){this.elt[geomIndex].setLocation(jsts.geomgraph.Position.ON,location)};jsts.geomgraph.Label.prototype.setAllLocations=function(geomIndex,location){this.elt[geomIndex].setAllLocations(location)};jsts.geomgraph.Label.prototype.setAllLocationsIfNull=function(geomIndex,location){if(arguments.length==1){this.setAllLocationsIfNull2.apply(this,arguments);return}this.elt[geomIndex].setAllLocationsIfNull(location)};jsts.geomgraph.Label.prototype.setAllLocationsIfNull2=function(location){this.setAllLocationsIfNull(0,location);this.setAllLocationsIfNull(1,location)};jsts.geomgraph.Label.prototype.merge=function(lbl){for(var i=0;i<2;i++)this.elt[i]===null&&lbl.elt[i]!==null?this.elt[i]=new jsts.geomgraph.TopologyLocation(lbl.elt[i]):this.elt[i].merge(lbl.elt[i])};jsts.geomgraph.Label.prototype.getGeometryCount=function(){var count=0;return this.elt[0].isNull()||count++,this.elt[1].isNull()||count++,count};jsts.geomgraph.Label.prototype.isNull=function(geomIndex){return this.elt[geomIndex].isNull()};jsts.geomgraph.Label.prototype.isAnyNull=function(geomIndex){return this.elt[geomIndex].isAnyNull()};jsts.geomgraph.Label.prototype.isArea=function(){return arguments.length==1?this.isArea2(arguments[0]):this.elt[0].isArea()||this.elt[1].isArea()};jsts.geomgraph.Label.prototype.isArea2=function(geomIndex){return this.elt[geomIndex].isArea()};jsts.geomgraph.Label.prototype.isLine=function(geomIndex){return this.elt[geomIndex].isLine()};jsts.geomgraph.Label.prototype.isEqualOnSide=function(lbl,side){return this.elt[0].isEqualOnSide(lbl.elt[0],side)&&this.elt[1].isEqualOnSide(lbl.elt[1],side)};jsts.geomgraph.Label.prototype.allPositionsEqual=function(geomIndex,loc){return this.elt[geomIndex].allPositionsEqual(loc)};jsts.geomgraph.Label.prototype.toLine=function(geomIndex){this.elt[geomIndex].isArea()&&(this.elt[geomIndex]=new jsts.geomgraph.TopologyLocation(this.elt[geomIndex].location[0]))};jsts.geomgraph.EdgeRing=function(start,geometryFactory){this.edges=[];this.pts=[];this.holes=[];this.label=new jsts.geomgraph.Label(jsts.geom.Location.NONE);this.geometryFactory=geometryFactory;start&&(this.computePoints(start),this.computeRing())};jsts.geomgraph.EdgeRing.prototype.startDe=null;jsts.geomgraph.EdgeRing.prototype.maxNodeDegree=-1;jsts.geomgraph.EdgeRing.prototype.edges=null;jsts.geomgraph.EdgeRing.prototype.pts=null;jsts.geomgraph.EdgeRing.prototype.label=null;jsts.geomgraph.EdgeRing.prototype.ring=null;jsts.geomgraph.EdgeRing.prototype._isHole=null;jsts.geomgraph.EdgeRing.prototype.shell=null;jsts.geomgraph.EdgeRing.prototype.holes=null;jsts.geomgraph.EdgeRing.prototype.geometryFactory=null;jsts.geomgraph.EdgeRing.prototype.isIsolated=function(){return this.label.getGeometryCount()==1};jsts.geomgraph.EdgeRing.prototype.isHole=function(){return this._isHole};jsts.geomgraph.EdgeRing.prototype.getCoordinate=function(i){return this.pts[i]};jsts.geomgraph.EdgeRing.prototype.getLinearRing=function(){return this.ring};jsts.geomgraph.EdgeRing.prototype.getLabel=function(){return this.label};jsts.geomgraph.EdgeRing.prototype.isShell=function(){return this.shell===null};jsts.geomgraph.EdgeRing.prototype.getShell=function(){return this.shell};jsts.geomgraph.EdgeRing.prototype.setShell=function(shell){this.shell=shell;shell!==null&&shell.addHole(this)};jsts.geomgraph.EdgeRing.prototype.addHole=function(ring){this.holes.push(ring)};jsts.geomgraph.EdgeRing.prototype.toPolygon=function(){for(var holeLR=[],i=0;i<this.holes.length;i++)holeLR[i]=this.holes[i].getLinearRing();return this.geometryFactory.createPolygon(this.getLinearRing(),holeLR)};jsts.geomgraph.EdgeRing.prototype.computeRing=function(){var coord,i;if(this.ring===null){for(coord=[],i=0;i<this.pts.length;i++)coord[i]=this.pts[i];this.ring=this.geometryFactory.createLinearRing(coord);this._isHole=jsts.algorithm.CGAlgorithms.isCCW(this.ring.getCoordinates())}};jsts.geomgraph.EdgeRing.prototype.getNext=function(){throw new jsts.error.AbstractInvocationError;};jsts.geomgraph.EdgeRing.prototype.setEdgeRing=function(){throw new jsts.error.AbstractInvocationError;};jsts.geomgraph.EdgeRing.prototype.getEdges=function(){return this.edges};jsts.geomgraph.EdgeRing.prototype.computePoints=function(start){var de,isFirstEdge,label;this.startDe=start;de=start;isFirstEdge=!0;do{if(de===null)throw new jsts.error.TopologyError("Found null DirectedEdge");if(de.getEdgeRing()===this)throw new jsts.error.TopologyError("Directed Edge visited twice during ring-building at "+de.getCoordinate());this.edges.push(de);label=de.getLabel();jsts.util.Assert.isTrue(label.isArea());this.mergeLabel(label);this.addPoints(de.getEdge(),de.isForward(),isFirstEdge);isFirstEdge=!1;this.setEdgeRing(de,this);de=this.getNext(de)}while(de!==this.startDe)};jsts.geomgraph.EdgeRing.prototype.getMaxNodeDegree=function(){return this.maxNodeDegree<0&&this.computeMaxNodeDegree(),this.maxNodeDegree};jsts.geomgraph.EdgeRing.prototype.computeMaxNodeDegree=function(){var de,node,degree;this.maxNodeDegree=0;de=this.startDe;do node=de.getNode(),degree=node.getEdges().getOutgoingDegree(this),degree>this.maxNodeDegree&&(this.maxNodeDegree=degree),de=this.getNext(de);while(de!==this.startDe);this.maxNodeDegree*=2};jsts.geomgraph.EdgeRing.prototype.setInResult=function(){var de=this.startDe;do de.getEdge().setInResult(!0),de=de.getNext();while(de!=this.startDe)};jsts.geomgraph.EdgeRing.prototype.mergeLabel=function(deLabel){this.mergeLabel2(deLabel,0);this.mergeLabel2(deLabel,1)};jsts.geomgraph.EdgeRing.prototype.mergeLabel2=function(deLabel,geomIndex){var loc=deLabel.getLocation(geomIndex,jsts.geomgraph.Position.RIGHT);if(loc!=jsts.geom.Location.NONE&&this.label.getLocation(geomIndex)===jsts.geom.Location.NONE){this.label.setLocation(geomIndex,loc);return}};jsts.geomgraph.EdgeRing.prototype.addPoints=function(edge,isForward,isFirstEdge){var edgePts=edge.getCoordinates(),startIndex,i;if(isForward)for(startIndex=1,isFirstEdge&&(startIndex=0),i=startIndex;i<edgePts.length;i++)this.pts.push(edgePts[i]);else for(startIndex=edgePts.length-2,isFirstEdge&&(startIndex=edgePts.length-1),i=startIndex;i>=0;i--)this.pts.push(edgePts[i])};jsts.geomgraph.EdgeRing.prototype.containsPoint=function(p){var shell=this.getLinearRing(),env=shell.getEnvelopeInternal(),i,hole;if(!env.contains(p)||!jsts.algorithm.CGAlgorithms.isPointInRing(p,shell.getCoordinates()))return!1;for(i=0;i<this.holes.length;i++)if(hole=this.holes[i],hole.containsPoint(p))return!1;return!0};jsts.geom.Dimension=function(){};jsts.geom.Dimension.P=0;jsts.geom.Dimension.L=1;jsts.geom.Dimension.A=2;jsts.geom.Dimension.FALSE=-1;jsts.geom.Dimension.TRUE=-2;jsts.geom.Dimension.DONTCARE=-3;jsts.geom.Dimension.toDimensionSymbol=function(dimensionValue){switch(dimensionValue){case jsts.geom.Dimension.FALSE:return"F";case jsts.geom.Dimension.TRUE:return"T";case jsts.geom.Dimension.DONTCARE:return"*";case jsts.geom.Dimension.P:return"0";case jsts.geom.Dimension.L:return"1";case jsts.geom.Dimension.A:return"2"}throw new jsts.IllegalArgumentError("Unknown dimension value: "+dimensionValue);};jsts.geom.Dimension.toDimensionValue=function(dimensionSymbol){switch(dimensionSymbol.toUpperCase()){case"F":return jsts.geom.Dimension.FALSE;case"T":return jsts.geom.Dimension.TRUE;case"*":return jsts.geom.Dimension.DONTCARE;case"0":return jsts.geom.Dimension.P;case"1":return jsts.geom.Dimension.L;case"2":return jsts.geom.Dimension.A}throw new jsts.error.IllegalArgumentError("Unknown dimension symbol: "+dimensionSymbol);},function(){var Dimension=jsts.geom.Dimension;jsts.geom.LineString=function(points,factory){this.factory=factory;this.points=points||[]};jsts.geom.LineString.prototype=new jsts.geom.Geometry;jsts.geom.LineString.constructor=jsts.geom.LineString;jsts.geom.LineString.prototype.points=null;jsts.geom.LineString.prototype.getCoordinates=function(){return this.points};jsts.geom.LineString.prototype.getCoordinateSequence=function(){return this.points};jsts.geom.LineString.prototype.getCoordinateN=function(n){return this.points[n]};jsts.geom.LineString.prototype.getCoordinate=function(){return this.isEmpty()?null:this.getCoordinateN(0)};jsts.geom.LineString.prototype.getDimension=function(){return 1};jsts.geom.LineString.prototype.getBoundaryDimension=function(){return this.isClosed()?Dimension.FALSE:0};jsts.geom.LineString.prototype.isEmpty=function(){return this.points.length===0};jsts.geom.LineString.prototype.getNumPoints=function(){return this.points.length};jsts.geom.LineString.prototype.getPointN=function(n){return this.getFactory().createPoint(this.points[n])};jsts.geom.LineString.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)};jsts.geom.LineString.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)};jsts.geom.LineString.prototype.isClosed=function(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.points.length-1))};jsts.geom.LineString.prototype.isRing=function(){return this.isClosed()&&this.isSimple()};jsts.geom.LineString.prototype.getGeometryType=function(){return"LineString"};jsts.geom.LineString.prototype.getLength=function(){return jsts.algorithm.CGAlgorithms.computeLength(this.points)};jsts.geom.LineString.prototype.getBoundary=function(){return new jsts.operation.BoundaryOp(this).getBoundary()};jsts.geom.LineString.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new jsts.geom.Envelope;var env=new jsts.geom.Envelope;return this.points.forEach(function(component){env.expandToInclude(component)}),env};jsts.geom.LineString.prototype.equalsExact=function(other,tolerance){return this.isEquivalentClass(other)?this.points.length!==other.points.length?!1:this.isEmpty()&&other.isEmpty()?!0:this.points.reduce(function(equal,point,i){return equal&&jsts.geom.Geometry.prototype.equal(point,other.points[i],tolerance)}):!1};jsts.geom.LineString.prototype.isEquivalentClass=function(other){return other instanceof jsts.geom.LineString};jsts.geom.LineString.prototype.compareToSameClass=function(o){for(var line=o,i=0,il=this.points.length,j=0,jl=line.points.length,comparison;i<il&&j<jl;){if(comparison=this.points[i].compareTo(line.points[j]),comparison!==0)return comparison;i++;j++}return i<il?1:j<jl?-1:0};jsts.geom.LineString.prototype.apply=function(filter){if(filter instanceof jsts.geom.GeometryFilter||filter instanceof jsts.geom.GeometryComponentFilter)filter.filter(this);else if(filter instanceof jsts.geom.CoordinateFilter)for(var i=0,len=this.points.length;i<len;i++)filter.filter(this.points[i]);else filter instanceof jsts.geom.CoordinateSequenceFilter&&this.apply2.apply(this,arguments)};jsts.geom.LineString.prototype.apply2=function(filter){if(this.points.length!==0){for(var i=0;i<this.points.length;i++)if(filter.filter(this.points,i),filter.isDone())break;filter.isGeometryChanged()}};jsts.geom.LineString.prototype.clone=function(){for(var points=[],i=0,len=this.points.length;i<len;i++)points.push(this.points[i].clone());return this.factory.createLineString(points)};jsts.geom.LineString.prototype.normalize=function(){var i,il,j,ci,cj,len;for(len=this.points.length,il=parseInt(len/2),i=0;i<il;i++)if(j=len-1-i,ci=this.points[i],cj=this.points[j],!ci.equals(cj)){ci.compareTo(cj)>0&&this.points.reverse();return}};jsts.geom.LineString.prototype.CLASS_NAME="jsts.geom.LineString"}(),function(){jsts.geom.LinearRing=function(){jsts.geom.LineString.apply(this,arguments)};jsts.geom.LinearRing.prototype=new jsts.geom.LineString;jsts.geom.LinearRing.constructor=jsts.geom.LinearRing;jsts.geom.LinearRing.prototype.getBoundaryDimension=function(){return jsts.geom.Dimension.FALSE};jsts.geom.LinearRing.prototype.isSimple=function(){return!0};jsts.geom.LinearRing.prototype.getGeometryType=function(){return"LinearRing"};jsts.geom.LinearRing.MINIMUM_VALID_SIZE=4;jsts.geom.LinearRing.prototype.CLASS_NAME="jsts.geom.LinearRing"}();jsts.geomgraph.NodeFactory=function(){};jsts.geomgraph.NodeFactory.prototype.createNode=function(coord){return new jsts.geomgraph.Node(coord,null)};jsts.operation.overlay.OverlayNodeFactory=function(){};jsts.operation.overlay.OverlayNodeFactory.prototype=new jsts.geomgraph.NodeFactory;jsts.operation.overlay.OverlayNodeFactory.constructor=jsts.operation.overlay.OverlayNodeFactory;jsts.operation.overlay.OverlayNodeFactory.prototype.createNode=function(coord){return new jsts.geomgraph.Node(coord,new jsts.geomgraph.DirectedEdgeStar)};jsts.operation.buffer.SubgraphDepthLocater=function(subgraphs){this.subgraphs=[];this.seg=new jsts.geom.LineSegment;this.subgraphs=subgraphs};jsts.operation.buffer.SubgraphDepthLocater.prototype.subgraphs=null;jsts.operation.buffer.SubgraphDepthLocater.prototype.seg=null;jsts.operation.buffer.SubgraphDepthLocater.prototype.getDepth=function(p){var stabbedSegments=this.findStabbedSegments(p),ds;return stabbedSegments.length===0?0:(stabbedSegments.sort(),ds=stabbedSegments[0],ds.leftDepth)};jsts.operation.buffer.SubgraphDepthLocater.prototype.findStabbedSegments=function(stabbingRayLeftPt){var stabbedSegments,i,bsg,env;if(arguments.length===3){this.findStabbedSegments2.apply(this,arguments);return}for(stabbedSegments=[],i=0;i<this.subgraphs.length;i++)(bsg=this.subgraphs[i],env=bsg.getEnvelope(),stabbingRayLeftPt.y<env.getMinY()||stabbingRayLeftPt.y>env.getMaxY())||this.findStabbedSegments2(stabbingRayLeftPt,bsg.getDirectedEdges(),stabbedSegments);return stabbedSegments};jsts.operation.buffer.SubgraphDepthLocater.prototype.findStabbedSegments2=function(stabbingRayLeftPt,dirEdges,stabbedSegments){var i,de;if(arguments[1]instanceof jsts.geomgraph.DirectedEdge){this.findStabbedSegments3(stabbingRayLeftPt,dirEdges,stabbedSegments);return}for(i=dirEdges.iterator();i.hasNext();)(de=i.next(),de.isForward())&&this.findStabbedSegments3(stabbingRayLeftPt,de,stabbedSegments)};jsts.operation.buffer.SubgraphDepthLocater.prototype.findStabbedSegments3=function(stabbingRayLeftPt,dirEdge,stabbedSegments){for(var maxx,depth,ds,pts=dirEdge.getEdge().getCoordinates(),i=0;i<pts.length-1;i++)(this.seg.p0=pts[i],this.seg.p1=pts[i+1],this.seg.p0.y>this.seg.p1.y&&this.seg.reverse(),maxx=Math.max(this.seg.p0.x,this.seg.p1.x),maxx<stabbingRayLeftPt.x)||this.seg.isHorizontal()||stabbingRayLeftPt.y<this.seg.p0.y||stabbingRayLeftPt.y>this.seg.p1.y||jsts.algorithm.CGAlgorithms.computeOrientation(this.seg.p0,this.seg.p1,stabbingRayLeftPt)!==jsts.algorithm.CGAlgorithms.RIGHT&&(depth=dirEdge.getDepth(jsts.geomgraph.Position.LEFT),this.seg.p0.equals(pts[i])||(depth=dirEdge.getDepth(jsts.geomgraph.Position.RIGHT)),ds=new jsts.operation.buffer.SubgraphDepthLocater.DepthSegment(this.seg,depth),stabbedSegments.push(ds))};jsts.operation.buffer.SubgraphDepthLocater.DepthSegment=function(seg,depth){this.upwardSeg=new jsts.geom.LineSegment(seg);this.leftDepth=depth};jsts.operation.buffer.SubgraphDepthLocater.DepthSegment.prototype.upwardSeg=null;jsts.operation.buffer.SubgraphDepthLocater.DepthSegment.prototype.leftDepth=null;jsts.operation.buffer.SubgraphDepthLocater.DepthSegment.prototype.compareTo=function(obj){var other=obj,orientIndex=this.upwardSeg.orientationIndex(other.upwardSeg);return(orientIndex===0&&(orientIndex=-1*other.upwardSeg.orientationIndex(upwardSeg)),orientIndex!==0)?orientIndex:this.compareX(this.upwardSeg,other.upwardSeg)};jsts.operation.buffer.SubgraphDepthLocater.DepthSegment.prototype.compareX=function(seg0,seg1){var compare0=seg0.p0.compareTo(seg1.p0);return compare0!==0?compare0:seg0.p1.compareTo(seg1.p1)};jsts.simplify.LineSegmentIndex=function(){this.index=new jsts.index.quadtree.Quadtree};jsts.simplify.LineSegmentIndex.prototype.index=null;jsts.simplify.LineSegmentIndex.prototype.add=function(line){var segs,i,seg;if(line instanceof jsts.geom.LineSegment){this.add2(line);return}for(segs=line.getSegments(),i=0;i<segs.length;i++)seg=segs[i],this.add2(seg)};jsts.simplify.LineSegmentIndex.prototype.add2=function(seg){this.index.insert(new jsts.geom.Envelope(seg.p0,seg.p1),seg)};jsts.simplify.LineSegmentIndex.prototype.remove=function(seg){this.index.remove(new jsts.geom.Envelope(seg.p0,seg.p1),seg)};jsts.simplify.LineSegmentIndex.prototype.query=function(querySeg){var env=new jsts.geom.Envelope(querySeg.p0,querySeg.p1),visitor=new jsts.simplify.LineSegmentIndex.LineSegmentVisitor(querySeg);return this.index.query(env,visitor),visitor.getItems()};jsts.simplify.LineSegmentIndex.LineSegmentVisitor=function(querySeg){this.items=[];this.querySeg=querySeg};jsts.simplify.LineSegmentIndex.LineSegmentVisitor.prototype=new jsts.index.ItemVisitor;jsts.simplify.LineSegmentIndex.LineSegmentVisitor.prototype.querySeg=null;jsts.simplify.LineSegmentIndex.LineSegmentVisitor.prototype.items=null;jsts.simplify.LineSegmentIndex.LineSegmentVisitor.prototype.visitItem=function(item){var seg=item;jsts.geom.Envelope.intersects(seg.p0,seg.p1,this.querySeg.p0,this.querySeg.p1)&&this.items.push(item)};jsts.simplify.LineSegmentIndex.LineSegmentVisitor.prototype.getItems=function(){return this.items};jsts.geomgraph.EdgeEndStar=function(){this.edgeMap=new javascript.util.TreeMap;this.edgeList=null;this.ptInAreaLocation=[jsts.geom.Location.NONE,jsts.geom.Location.NONE]};jsts.geomgraph.EdgeEndStar.prototype.edgeMap=null;jsts.geomgraph.EdgeEndStar.prototype.edgeList=null;jsts.geomgraph.EdgeEndStar.prototype.ptInAreaLocation=null;jsts.geomgraph.EdgeEndStar.prototype.insert=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.geomgraph.EdgeEndStar.prototype.insertEdgeEnd=function(e,obj){this.edgeMap.put(e,obj);this.edgeList=null};jsts.geomgraph.EdgeEndStar.prototype.getCoordinate=function(){var it=this.iterator(),e;return it.hasNext()?(e=it.next(),e.getCoordinate()):null};jsts.geomgraph.EdgeEndStar.prototype.getDegree=function(){return this.edgeMap.size()};jsts.geomgraph.EdgeEndStar.prototype.iterator=function(){return this.getEdges().iterator()};jsts.geomgraph.EdgeEndStar.prototype.getEdges=function(){return this.edgeList===null&&(this.edgeList=new javascript.util.ArrayList(this.edgeMap.values())),this.edgeList};jsts.geomgraph.EdgeEndStar.prototype.getNextCW=function(ee){this.getEdges();var i=this.edgeList.indexOf(ee),iNextCW=i-1;return i===0&&(iNextCW=this.edgeList.length-1),this.edgeList[iNextCW]};jsts.geomgraph.EdgeEndStar.prototype.computeLabelling=function(geomGraph){var hasDimensionalCollapseEdge,it,e,label,geomi,loc,p;for(this.computeEdgeEndLabels(geomGraph[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1),hasDimensionalCollapseEdge=[!1,!1],it=this.iterator();it.hasNext();)for(e=it.next(),label=e.getLabel(),geomi=0;geomi<2;geomi++)label.isLine(geomi)&&label.getLocation(geomi)===jsts.geom.Location.BOUNDARY&&(hasDimensionalCollapseEdge[geomi]=!0);for(it=this.iterator();it.hasNext();)for(e=it.next(),label=e.getLabel(),geomi=0;geomi<2;geomi++)label.isAnyNull(geomi)&&(loc=jsts.geom.Location.NONE,hasDimensionalCollapseEdge[geomi]?loc=jsts.geom.Location.EXTERIOR:(p=e.getCoordinate(),loc=this.getLocation(geomi,p,geomGraph)),label.setAllLocationsIfNull(geomi,loc))};jsts.geomgraph.EdgeEndStar.prototype.computeEdgeEndLabels=function(boundaryNodeRule){for(var ee,it=this.iterator();it.hasNext();)ee=it.next(),ee.computeLabel(boundaryNodeRule)};jsts.geomgraph.EdgeEndStar.prototype.getLocation=function(geomIndex,p,geom){return this.ptInAreaLocation[geomIndex]===jsts.geom.Location.NONE&&(this.ptInAreaLocation[geomIndex]=jsts.algorithm.locate.SimplePointInAreaLocator.locate(p,geom[geomIndex].getGeometry())),this.ptInAreaLocation[geomIndex]};jsts.geomgraph.EdgeEndStar.prototype.isAreaLabelsConsistent=function(geomGraph){return this.computeEdgeEndLabels(geomGraph.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)};jsts.geomgraph.EdgeEndStar.prototype.checkAreaLabelsConsistent=function(geomIndex){var edges=this.getEdges(),currLoc,it,e,label,leftLoc,rightLoc;if(edges.size()<=0)return!0;var lastEdgeIndex=edges.size()-1,startLabel=edges.get(lastEdgeIndex).getLabel(),startLoc=startLabel.getLocation(geomIndex,jsts.geomgraph.Position.LEFT);for(jsts.util.Assert.isTrue(startLoc!=jsts.geom.Location.NONE,"Found unlabelled area edge"),currLoc=startLoc,it=this.iterator();it.hasNext();){if((e=it.next(),label=e.getLabel(),jsts.util.Assert.isTrue(label.isArea(geomIndex),"Found non-area edge"),leftLoc=label.getLocation(geomIndex,jsts.geomgraph.Position.LEFT),rightLoc=label.getLocation(geomIndex,jsts.geomgraph.Position.RIGHT),leftLoc===rightLoc)||rightLoc!==currLoc)return!1;currLoc=leftLoc}return!0};jsts.geomgraph.EdgeEndStar.prototype.propagateSideLabels=function(geomIndex){for(var currLoc,e,label,leftLoc,rightLoc,startLoc=jsts.geom.Location.NONE,it=this.iterator();it.hasNext();)e=it.next(),label=e.getLabel(),label.isArea(geomIndex)&&label.getLocation(geomIndex,jsts.geomgraph.Position.LEFT)!==jsts.geom.Location.NONE&&(startLoc=label.getLocation(geomIndex,jsts.geomgraph.Position.LEFT));if(startLoc!==jsts.geom.Location.NONE)for(currLoc=startLoc,it=this.iterator();it.hasNext();)if(e=it.next(),label=e.getLabel(),label.getLocation(geomIndex,jsts.geomgraph.Position.ON)===jsts.geom.Location.NONE&&label.setLocation(geomIndex,jsts.geomgraph.Position.ON,currLoc),label.isArea(geomIndex))if(leftLoc=label.getLocation(geomIndex,jsts.geomgraph.Position.LEFT),rightLoc=label.getLocation(geomIndex,jsts.geomgraph.Position.RIGHT),rightLoc!==jsts.geom.Location.NONE){if(rightLoc!==currLoc)throw new jsts.error.TopologyError("side location conflict",e.getCoordinate());leftLoc===jsts.geom.Location.NONE&&jsts.util.Assert.shouldNeverReachHere("found single null side (at "+e.getCoordinate()+")");currLoc=leftLoc}else jsts.util.Assert.isTrue(label.getLocation(geomIndex,jsts.geomgraph.Position.LEFT)===jsts.geom.Location.NONE,"found single null side"),label.setLocation(geomIndex,jsts.geomgraph.Position.RIGHT,currLoc),label.setLocation(geomIndex,jsts.geomgraph.Position.LEFT,currLoc)};jsts.geomgraph.EdgeEndStar.prototype.findIndex=function(eSearch){var i,e;for(this.iterator(),i=0;i<this.edgeList.size();i++)if(e=this.edgeList.get(i),e===eSearch)return i;return-1};jsts.operation.relate.EdgeEndBundleStar=function(){jsts.geomgraph.EdgeEndStar.apply(this,arguments)};jsts.operation.relate.EdgeEndBundleStar.prototype=new jsts.geomgraph.EdgeEndStar;jsts.operation.relate.EdgeEndBundleStar.prototype.insert=function(e){var eb=this.edgeMap.get(e);eb===null?(eb=new jsts.operation.relate.EdgeEndBundle(e),this.insertEdgeEnd(e,eb)):eb.insert(e)};jsts.operation.relate.EdgeEndBundleStar.prototype.updateIM=function(im){for(var esb,it=this.iterator();it.hasNext();)esb=it.next(),esb.updateIM(im)},function(){jsts.geom.Polygon=function(shell,holes,factory){this.shell=shell||factory.createLinearRing(null);this.holes=holes||[];this.factory=factory};jsts.geom.Polygon.prototype=new jsts.geom.Geometry;jsts.geom.Polygon.constructor=jsts.geom.Polygon;jsts.geom.Polygon.prototype.getCoordinate=function(){return this.shell.getCoordinate()};jsts.geom.Polygon.prototype.getCoordinates=function(){var x,i,childCoordinates,j;if(this.isEmpty())return[];var coordinates=[],k=-1,shellCoordinates=this.shell.getCoordinates();for(x=0;x<shellCoordinates.length;x++)k++,coordinates[k]=shellCoordinates[x];for(i=0;i<this.holes.length;i++)for(childCoordinates=this.holes[i].getCoordinates(),j=0;j<childCoordinates.length;j++)k++,coordinates[k]=childCoordinates[j];return coordinates};jsts.geom.Polygon.prototype.isEmpty=function(){return this.shell.isEmpty()};jsts.geom.Polygon.prototype.getExteriorRing=function(){return this.shell};jsts.geom.Polygon.prototype.getInteriorRingN=function(n){return this.holes[n]};jsts.geom.Polygon.prototype.getNumInteriorRing=function(){return this.holes.length};jsts.geom.Polygon.prototype.getArea=function(){var area=0,i;for(area+=Math.abs(jsts.algorithm.CGAlgorithms.signedArea(this.shell.getCoordinateSequence())),i=0;i<this.holes.length;i++)area-=Math.abs(jsts.algorithm.CGAlgorithms.signedArea(this.holes[i].getCoordinateSequence()));return area};jsts.geom.Polygon.prototype.getLength=function(){var len=0,i;for(len+=this.shell.getLength(),i=0;i<this.holes.length;i++)len+=this.holes[i].getLength();return len};jsts.geom.Polygon.prototype.getBoundary=function(){var rings,i,len;if(this.isEmpty())return this.getFactory().createMultiLineString(null);for(rings=[],rings[0]=this.shell.clone(),i=0,len=this.holes.length;i<len;i++)rings[i+1]=this.holes[i].clone();return rings.length<=1?rings[0]:this.getFactory().createMultiLineString(rings)};jsts.geom.Polygon.prototype.computeEnvelopeInternal=function(){return this.shell.getEnvelopeInternal()};jsts.geom.Polygon.prototype.getDimension=function(){return 2};jsts.geom.Polygon.prototype.getBoundaryDimension=function(){return 1};jsts.geom.Polygon.prototype.equalsExact=function(other,tolerance){if(!this.isEquivalentClass(other))return!1;if(this.isEmpty()&&other.isEmpty())return!0;if(this.isEmpty()!==other.isEmpty()||!this.shell.equalsExact(other.shell,tolerance)||this.holes.length!==other.holes.length||this.holes.length!==other.holes.length)return!1;for(var i=0;i<this.holes.length;i++)if(!this.holes[i].equalsExact(other.holes[i],tolerance))return!1;return!0};jsts.geom.Polygon.prototype.compareToSameClass=function(o){return this.shell.compareToSameClass(o.shell)};jsts.geom.Polygon.prototype.apply=function(filter){var i,len;if(filter instanceof jsts.geom.GeometryComponentFilter)for(filter.filter(this),this.shell.apply(filter),i=0,len=this.holes.length;i<len;i++)this.holes[i].apply(filter);else if(filter instanceof jsts.geom.GeometryFilter)filter.filter(this);else if(filter instanceof jsts.geom.CoordinateFilter)for(this.shell.apply(filter),i=0,len=this.holes.length;i<len;i++)this.holes[i].apply(filter);else filter instanceof jsts.geom.CoordinateSequenceFilter&&this.apply2.apply(this,arguments)};jsts.geom.Polygon.prototype.apply2=function(filter){if(this.shell.apply(filter),!filter.isDone())for(var i=0;i<this.holes.length;i++)if(this.holes[i].apply(filter),filter.isDone())break;filter.isGeometryChanged()};jsts.geom.Polygon.prototype.clone=function(){for(var holes=[],i=0,len=this.holes.length;i<len;i++)holes.push(this.holes[i].clone());return this.factory.createPolygon(this.shell.clone(),holes)};jsts.geom.Polygon.prototype.normalize=function(){this.normalize2(this.shell,!0);for(var i=0,len=this.holes.length;i<len;i++)this.normalize2(this.holes[i],!1);this.holes.sort()};jsts.geom.Polygon.prototype.normalize2=function(ring,clockwise){if(!ring.isEmpty()){var uniqueCoordinates=ring.points.slice(0,ring.points.length-1),minCoordinate=jsts.geom.CoordinateArrays.minCoordinate(ring.points);jsts.geom.CoordinateArrays.scroll(uniqueCoordinates,minCoordinate);ring.points=uniqueCoordinates.concat();ring.points[uniqueCoordinates.length]=uniqueCoordinates[0];jsts.algorithm.CGAlgorithms.isCCW(ring.points)===clockwise&&ring.points.reverse()}};jsts.geom.Polygon.prototype.CLASS_NAME="jsts.geom.Polygon"}();jsts.algorithm.distance.DistanceToPoint=function(){};jsts.algorithm.distance.DistanceToPoint.computeDistance=function(geom,pt,ptDist){var gc,i,g;if(geom instanceof jsts.geom.LineString)jsts.algorithm.distance.DistanceToPoint.computeDistance2(geom,pt,ptDist);else if(geom instanceof jsts.geom.Polygon)jsts.algorithm.distance.DistanceToPoint.computeDistance4(geom,pt,ptDist);else if(geom instanceof jsts.geom.GeometryCollection)for(gc=geom,i=0;i<gc.getNumGeometries();i++)g=gc.getGeometryN(i),jsts.algorithm.distance.DistanceToPoint.computeDistance(g,pt,ptDist);else ptDist.setMinimum(geom.getCoordinate(),pt)};jsts.algorithm.distance.DistanceToPoint.computeDistance2=function(line,pt,ptDist){for(var closestPt,tempSegment=new jsts.geom.LineSegment,coords=line.getCoordinates(),i=0;i<coords.length-1;i++)tempSegment.setCoordinates(coords[i],coords[i+1]),closestPt=tempSegment.closestPoint(pt),ptDist.setMinimum(closestPt,pt)};jsts.algorithm.distance.DistanceToPoint.computeDistance3=function(segment,pt,ptDist){var closestPt=segment.closestPoint(pt);ptDist.setMinimum(closestPt,pt)};jsts.algorithm.distance.DistanceToPoint.computeDistance4=function(poly,pt,ptDist){jsts.algorithm.distance.DistanceToPoint.computeDistance2(poly.getExteriorRing(),pt,ptDist);for(var i=0;i<poly.getNumInteriorRing();i++)jsts.algorithm.distance.DistanceToPoint.computeDistance2(poly.getInteriorRingN(i),pt,ptDist)};jsts.index.strtree.Boundable=function(){};jsts.index.strtree.Boundable.prototype.getBounds=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.index.strtree.ItemBoundable=function(bounds,item){this.bounds=bounds;this.item=item};jsts.index.strtree.ItemBoundable.prototype=new jsts.index.strtree.Boundable;jsts.index.strtree.ItemBoundable.constructor=jsts.index.strtree.ItemBoundable;jsts.index.strtree.ItemBoundable.prototype.bounds=null;jsts.index.strtree.ItemBoundable.prototype.item=null;jsts.index.strtree.ItemBoundable.prototype.getBounds=function(){return this.bounds};jsts.index.strtree.ItemBoundable.prototype.getItem=function(){return this.item};jsts.noding.SegmentPointComparator=function(){};jsts.noding.SegmentPointComparator.compare=function(octant,p0,p1){if(p0.equals2D(p1))return 0;var xSign=jsts.noding.SegmentPointComparator.relativeSign(p0.x,p1.x),ySign=jsts.noding.SegmentPointComparator.relativeSign(p0.y,p1.y);switch(octant){case 0:return jsts.noding.SegmentPointComparator.compareValue(xSign,ySign);case 1:return jsts.noding.SegmentPointComparator.compareValue(ySign,xSign);case 2:return jsts.noding.SegmentPointComparator.compareValue(ySign,-xSign);case 3:return jsts.noding.SegmentPointComparator.compareValue(-xSign,ySign);case 4:return jsts.noding.SegmentPointComparator.compareValue(-xSign,-ySign);case 5:return jsts.noding.SegmentPointComparator.compareValue(-ySign,-xSign);case 6:return jsts.noding.SegmentPointComparator.compareValue(-ySign,xSign);case 7:return jsts.noding.SegmentPointComparator.compareValue(xSign,-ySign)}return 0};jsts.noding.SegmentPointComparator.relativeSign=function(x0,x1){return x0<x1?-1:x0>x1?1:0};jsts.noding.SegmentPointComparator.compareValue=function(compareSign0,compareSign1){return compareSign0<0?-1:compareSign0>0?1:compareSign1<0?-1:compareSign1>0?1:0};jsts.operation.IsSimpleOp=function(geom){this.geom=geom};jsts.operation.IsSimpleOp.prototype.geom=null;jsts.operation.IsSimpleOp.prototype.isClosedEndpointsInInterior=!0;jsts.operation.IsSimpleOp.prototype.nonSimpleLocation=null;jsts.operation.IsSimpleOp.prototype.IsSimpleOp=function(geom){this.geom=geom};jsts.operation.IsSimpleOp.prototype.isSimple=function(){return(this.nonSimpleLocation=null,this.geom instanceof jsts.geom.LineString)?this.isSimpleLinearGeometry(this.geom):this.geom instanceof jsts.geom.MultiLineString?this.isSimpleLinearGeometry(this.geom):this.geom instanceof jsts.geom.MultiPoint?this.isSimpleMultiPoint(this.geom):!0};jsts.operation.IsSimpleOp.prototype.isSimpleMultiPoint=function(mp){var points,i,pt,p,j,point;if(mp.isEmpty())return!0;for(points=[],i=0;i<mp.getNumGeometries();i++){for(pt=mp.getGeometryN(i),p=pt.getCoordinate(),j=0;j<points.length;j++)if(point=points[j],p.equals2D(point))return this.nonSimpleLocation=p,!1;points.push(p)}return!0};jsts.operation.IsSimpleOp.prototype.isSimpleLinearGeometry=function(geom){if(geom.isEmpty())return!0;var graph=new jsts.geomgraph.GeometryGraph(0,geom),li=new jsts.algorithm.RobustLineIntersector,si=graph.computeSelfNodes(li,!0);return si.hasIntersection()?si.hasProperIntersection()?(this.nonSimpleLocation=si.getProperIntersectionPoint(),!1):this.hasNonEndpointIntersection(graph)?!1:this.isClosedEndpointsInInterior&&this.hasClosedEndpointIntersection(graph)?!1:!0:!0};jsts.operation.IsSimpleOp.prototype.hasNonEndpointIntersection=function(graph){for(var e,maxSegmentIndex,eiIt,ei,i=graph.getEdgeIterator();i.hasNext();)for(e=i.next(),maxSegmentIndex=e.getMaximumSegmentIndex(),eiIt=e.getEdgeIntersectionList().iterator();eiIt.hasNext();)if(ei=eiIt.next(),!ei.isEndPoint(maxSegmentIndex))return this.nonSimpleLocation=ei.getCoordinate(),!0;return!1};jsts.operation.IsSimpleOp.prototype.hasClosedEndpointIntersection=function(graph){for(var p1,eiInfo,endPoints=new javascript.util.TreeMap,i=graph.getEdgeIterator();i.hasNext();){var e=i.next(),maxSegmentIndex=e.getMaximumSegmentIndex(),isClosed=e.isClosed(),p0=e.getCoordinate(0);this.addEndpoint(endPoints,p0,isClosed);p1=e.getCoordinate(e.getNumPoints()-1);this.addEndpoint(endPoints,p1,isClosed)}for(i=endPoints.values().iterator();i.hasNext();)if(eiInfo=i.next(),eiInfo.isClosed&&eiInfo.degree!=2)return this.nonSimpleLocation=eiInfo.getCoordinate(),!0;return!1};jsts.operation.IsSimpleOp.EndpointInfo=function(pt){this.pt=pt;this.isClosed=!1;this.degree=0};jsts.operation.IsSimpleOp.EndpointInfo.prototype.pt=null;jsts.operation.IsSimpleOp.EndpointInfo.prototype.isClosed=null;jsts.operation.IsSimpleOp.EndpointInfo.prototype.degree=null;jsts.operation.IsSimpleOp.EndpointInfo.prototype.getCoordinate=function(){return this.pt};jsts.operation.IsSimpleOp.EndpointInfo.prototype.addEndpoint=function(isClosed){this.degree++;this.isClosed=this.isClosed||isClosed};jsts.operation.IsSimpleOp.prototype.addEndpoint=function(endPoints,p,isClosed){var eiInfo=endPoints.get(p);eiInfo===null&&(eiInfo=new jsts.operation.IsSimpleOp.EndpointInfo(p),endPoints.put(p,eiInfo));eiInfo.addEndpoint(isClosed)},function(){var LineStringSnapper=function(){this.snapTolerance=0;this.seg=new jsts.geom.LineSegment;this.allowSnappingToSourceVertices=!1;this.isClosed=!1;this.srcPts=[];arguments[0]instanceof jsts.geom.LineString?this.initFromLine.apply(this,arguments):this.initFromPoints.apply(this,arguments)};LineStringSnapper.prototype.initFromLine=function(srcLine,snapTolerance){this.initFromPoints(srcLine.getCoordinates(),snapTolerance)};LineStringSnapper.prototype.initFromPoints=function(srcPts,snapTolerance){this.srcPts=srcPts;this.isClosed=this.calcIsClosed(srcPts);this.snapTolerance=snapTolerance};LineStringSnapper.prototype.setAllowSnappingToSourceVertices=function(allowSnappingToSourceVertices){this.allowSnappingToSourceVertices=allowSnappingToSourceVertices};LineStringSnapper.prototype.calcIsClosed=function(pts){return pts.length<=1?!1:pts[0].equals(pts[pts.length-1])};LineStringSnapper.prototype.snapTo=function(snapPts){var coordList=new jsts.geom.CoordinateList(this.srcPts);return this.snapVertices(coordList,snapPts),this.snapSegments(coordList,snapPts),coordList.toCoordinateArray()};LineStringSnapper.prototype.snapVertices=function(srcCoords,snapPts){var end=this.isClosed?srcCoords.size()-1:srcCoords.size(),i=0,srcPt,snapVert;for(i;i<end;i++)srcPt=srcCoords.get(i),snapVert=this.findSnapForVertex(srcPt,snapPts),snapVert!==null&&(srcCoords.set(i,new jsts.geom.Coordinate(snapVert)),i===0&&this.isClosed&&srcCoords.set(srcCoords.size()-1,new jsts.geom.Coordinate(snapVert)))};LineStringSnapper.prototype.findSnapForVertex=function(pt,snapPts){for(var i=0,il=snapPts.length,i=0;i<il;i++){if(pt.equals(snapPts[i]))return null;if(pt.distance(snapPts[i])<this.snapTolerance)return snapPts[i]}return null};LineStringSnapper.prototype.snapSegments=function(srcCoords,snapPts){if(snapPts.length!==0){var distinctPtCount=snapPts.length,i,snapPt,index;for(snapPts.length>1&&snapPts[0].equals2D(snapPts[snapPts.length-1])&&(distinctPtCount=snapPts.length-1),i=0,i;i<distinctPtCount;i++)snapPt=snapPts[i],index=this.findSegmentIndexToSnap(snapPt,srcCoords),index>=0&&srcCoords.add(index+1,new jsts.geom.Coordinate(snapPt),!1)}};LineStringSnapper.prototype.findSegmentIndexToSnap=function(snapPt,srcCoords){var minDist=Number.MAX_VALUE,snapIndex=-1,i=0,dist;for(i;i<srcCoords.size()-1;i++){if(this.seg.p0=srcCoords.get(i),this.seg.p1=srcCoords.get(i+1),this.seg.p0.equals(snapPt)||this.seg.p1.equals(snapPt))if(this.allowSnappingToSourceVertices)continue;else return-1;dist=this.seg.distance(snapPt);dist<this.snapTolerance&&dist<minDist&&(minDist=dist,snapIndex=i)}return snapIndex};jsts.operation.overlay.snap.LineStringSnapper=LineStringSnapper}(),function(){var ArrayList=javascript.util.ArrayList,GeometryComponentFilter=jsts.geom.GeometryComponentFilter,LineString=jsts.geom.LineString,EdgeRing=jsts.operation.polygonize.EdgeRing,PolygonizeGraph=jsts.operation.polygonize.PolygonizeGraph,Polygonizer=function(){var that=this,LineStringAdder=function(){};LineStringAdder.prototype=new GeometryComponentFilter;LineStringAdder.prototype.filter=function(g){g instanceof LineString&&that.add(g)};this.lineStringAdder=new LineStringAdder;this.dangles=new ArrayList;this.cutEdges=new ArrayList;this.invalidRingLines=new ArrayList};Polygonizer.prototype.lineStringAdder=null;Polygonizer.prototype.graph=null;Polygonizer.prototype.dangles=null;Polygonizer.prototype.cutEdges=null;Polygonizer.prototype.invalidRingLines=null;Polygonizer.prototype.holeList=null;Polygonizer.prototype.shellList=null;Polygonizer.prototype.polyList=null;Polygonizer.prototype.add=function(geomList){var i,geometry;if(geomList instanceof jsts.geom.LineString)return this.add3(geomList);if(geomList instanceof jsts.geom.Geometry)return this.add2(geomList);for(i=geomList.iterator();i.hasNext();)geometry=i.next(),this.add2(geometry)};Polygonizer.prototype.add2=function(g){g.apply(this.lineStringAdder)};Polygonizer.prototype.add3=function(line){this.graph==null&&(this.graph=new PolygonizeGraph(line.getFactory()));this.graph.addEdge(line)};Polygonizer.prototype.getPolygons=function(){return this.polygonize(),this.polyList};Polygonizer.prototype.getDangles=function(){return this.polygonize(),this.dangles};Polygonizer.prototype.getCutEdges=function(){return this.polygonize(),this.cutEdges};Polygonizer.prototype.getInvalidRingLines=function(){return this.polygonize(),this.invalidRingLines};Polygonizer.prototype.polygonize=function(){var edgeRingList,validEdgeRingList,i,er;if(this.polyList==null&&(this.polyList=new ArrayList,this.graph!=null))for(this.dangles=this.graph.deleteDangles(),this.cutEdges=this.graph.deleteCutEdges(),edgeRingList=this.graph.getEdgeRings(),validEdgeRingList=new ArrayList,this.invalidRingLines=new ArrayList,this.findValidRings(edgeRingList,validEdgeRingList,this.invalidRingLines),this.findShellsAndHoles(validEdgeRingList),Polygonizer.assignHolesToShells(this.holeList,this.shellList),this.polyList=new ArrayList,i=this.shellList.iterator();i.hasNext();)er=i.next(),this.polyList.add(er.getPolygon())};Polygonizer.prototype.findValidRings=function(edgeRingList,validEdgeRingList,invalidRingList){for(var er,i=edgeRingList.iterator();i.hasNext();)er=i.next(),er.isValid()?validEdgeRingList.add(er):invalidRingList.add(er.getLineString())};Polygonizer.prototype.findShellsAndHoles=function(edgeRingList){var i,er;for(this.holeList=new ArrayList,this.shellList=new ArrayList,i=edgeRingList.iterator();i.hasNext();)er=i.next(),er.isHole()?this.holeList.add(er):this.shellList.add(er)};Polygonizer.assignHolesToShells=function(holeList,shellList){for(var holeER,i=holeList.iterator();i.hasNext();)holeER=i.next(),Polygonizer.assignHoleToShell(holeER,shellList)};Polygonizer.assignHoleToShell=function(holeER,shellList){var shell=EdgeRing.findEdgeRingContaining(holeER,shellList);shell!=null&&shell.addHole(holeER.getRing())};jsts.operation.polygonize.Polygonizer=Polygonizer}();jsts.geomgraph.index.EdgeSetIntersector=function(){};jsts.geomgraph.index.EdgeSetIntersector.prototype.computeIntersections=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.geomgraph.index.EdgeSetIntersector.prototype.computeIntersections2=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.geomgraph.index.SimpleMCSweepLineIntersector=function(){throw new jsts.error.NotImplementedError;};jsts.geomgraph.index.SimpleMCSweepLineIntersector.prototype=new jsts.geomgraph.index.EdgeSetIntersector;jsts.algorithm.locate.SimplePointInAreaLocator=function(geom){this.geom=geom};jsts.algorithm.locate.SimplePointInAreaLocator.locate=function(p,geom){return geom.isEmpty()?jsts.geom.Location.EXTERIOR:jsts.algorithm.locate.SimplePointInAreaLocator.containsPoint(p,geom)?jsts.geom.Location.INTERIOR:jsts.geom.Location.EXTERIOR};jsts.algorithm.locate.SimplePointInAreaLocator.containsPoint=function(p,geom){var i,g2;if(geom instanceof jsts.geom.Polygon)return jsts.algorithm.locate.SimplePointInAreaLocator.containsPointInPolygon(p,geom);if(geom instanceof jsts.geom.GeometryCollection||geom instanceof jsts.geom.MultiPoint||geom instanceof jsts.geom.MultiLineString||geom instanceof jsts.geom.MultiPolygon)for(i=0;i<geom.geometries.length;i++)if(g2=geom.geometries[i],g2!==geom&&jsts.algorithm.locate.SimplePointInAreaLocator.containsPoint(p,g2))return!0;return!1};jsts.algorithm.locate.SimplePointInAreaLocator.containsPointInPolygon=function(p,poly){var shell,i,hole;if(poly.isEmpty()||(shell=poly.getExteriorRing(),!jsts.algorithm.locate.SimplePointInAreaLocator.isPointInRing(p,shell)))return!1;for(i=0;i<poly.getNumInteriorRing();i++)if(hole=poly.getInteriorRingN(i),jsts.algorithm.locate.SimplePointInAreaLocator.isPointInRing(p,hole))return!1;return!0};jsts.algorithm.locate.SimplePointInAreaLocator.isPointInRing=function(p,ring){return ring.getEnvelopeInternal().intersects(p)?jsts.algorithm.CGAlgorithms.isPointInRing(p,ring.getCoordinates()):!1};jsts.algorithm.locate.SimplePointInAreaLocator.prototype.geom=null;jsts.algorithm.locate.SimplePointInAreaLocator.prototype.locate=function(p){return jsts.algorithm.locate.SimplePointInAreaLocator.locate(p,geom)},function(){var Location=jsts.geom.Location,Position=jsts.geomgraph.Position,EdgeEndStar=jsts.geomgraph.EdgeEndStar,Assert=jsts.util.Assert;jsts.geomgraph.DirectedEdgeStar=function(){jsts.geomgraph.EdgeEndStar.call(this)};jsts.geomgraph.DirectedEdgeStar.prototype=new EdgeEndStar;jsts.geomgraph.DirectedEdgeStar.constructor=jsts.geomgraph.DirectedEdgeStar;jsts.geomgraph.DirectedEdgeStar.prototype.resultAreaEdgeList=null;jsts.geomgraph.DirectedEdgeStar.prototype.label=null;jsts.geomgraph.DirectedEdgeStar.prototype.insert=function(ee){var de=ee;this.insertEdgeEnd(de,de)};jsts.geomgraph.DirectedEdgeStar.prototype.getLabel=function(){return this.label};jsts.geomgraph.DirectedEdgeStar.prototype.getOutgoingDegree=function(){for(var de,degree=0,it=this.iterator();it.hasNext();)de=it.next(),de.isInResult()&&degree++;return degree};jsts.geomgraph.DirectedEdgeStar.prototype.getOutgoingDegree=function(er){for(var de,degree=0,it=this.iterator();it.hasNext();)de=it.next(),de.getEdgeRing()===er&&degree++;return degree};jsts.geomgraph.DirectedEdgeStar.prototype.getRightmostEdge=function(){var edges=this.getEdges(),size=edges.size(),de0,nonHorizontalEdge;if(size<1)return null;if(de0=edges.get(0),size==1)return de0;var deLast=edges.get(size-1),quad0=de0.getQuadrant(),quad1=deLast.getQuadrant();if(jsts.geomgraph.Quadrant.isNorthern(quad0)&&jsts.geomgraph.Quadrant.isNorthern(quad1))return de0;if(jsts.geomgraph.Quadrant.isNorthern(quad0)||jsts.geomgraph.Quadrant.isNorthern(quad1)){if(nonHorizontalEdge=null,de0.getDy()!=0)return de0;if(deLast.getDy()!=0)return deLast}else return deLast;return Assert.shouldNeverReachHere("found two horizontal edges incident on node"),null};jsts.geomgraph.DirectedEdgeStar.prototype.computeLabelling=function(geom){var it,i,eLoc;for(EdgeEndStar.prototype.computeLabelling.call(this,geom),this.label=new jsts.geomgraph.Label(Location.NONE),it=this.iterator();it.hasNext();){var ee=it.next(),e=ee.getEdge(),eLabel=e.getLabel();for(i=0;i<2;i++)eLoc=eLabel.getLocation(i),(eLoc===Location.INTERIOR||eLoc===Location.BOUNDARY)&&this.label.setLocation(i,Location.INTERIOR)}};jsts.geomgraph.DirectedEdgeStar.prototype.mergeSymLabels=function(){for(var de,label,it=this.iterator();it.hasNext();)de=it.next(),label=de.getLabel(),label.merge(de.getSym().getLabel())};jsts.geomgraph.DirectedEdgeStar.prototype.updateLabelling=function(nodeLabel){for(var de,label,it=this.iterator();it.hasNext();)de=it.next(),label=de.getLabel(),label.setAllLocationsIfNull(0,nodeLabel.getLocation(0)),label.setAllLocationsIfNull(1,nodeLabel.getLocation(1))};jsts.geomgraph.DirectedEdgeStar.prototype.getResultAreaEdges=function(){var it,de;if(this.resultAreaEdgeList!==null)return this.resultAreaEdgeList;for(this.resultAreaEdgeList=new javascript.util.ArrayList,it=this.iterator();it.hasNext();)de=it.next(),(de.isInResult()||de.getSym().isInResult())&&this.resultAreaEdgeList.add(de);return this.resultAreaEdgeList};jsts.geomgraph.DirectedEdgeStar.prototype.SCANNING_FOR_INCOMING=1;jsts.geomgraph.DirectedEdgeStar.prototype.LINKING_TO_OUTGOING=2;jsts.geomgraph.DirectedEdgeStar.prototype.linkResultDirectedEdges=function(){var i,nextOut,nextIn;this.getResultAreaEdges();var firstOut=null,incoming=null,state=this.SCANNING_FOR_INCOMING;for(i=0;i<this.resultAreaEdgeList.size();i++)if(nextOut=this.resultAreaEdgeList.get(i),nextIn=nextOut.getSym(),nextOut.getLabel().isArea()){firstOut===null&&nextOut.isInResult()&&(firstOut=nextOut);switch(state){case this.SCANNING_FOR_INCOMING:if(!nextIn.isInResult())continue;incoming=nextIn;state=this.LINKING_TO_OUTGOING;break;case this.LINKING_TO_OUTGOING:if(!nextOut.isInResult())continue;incoming.setNext(nextOut);state=this.SCANNING_FOR_INCOMING}}if(state===this.LINKING_TO_OUTGOING){if(firstOut===null)throw new jsts.error.TopologyError("no outgoing dirEdge found",this.getCoordinate());Assert.isTrue(firstOut.isInResult(),"unable to link last incoming dirEdge");incoming.setNext(firstOut)}};jsts.geomgraph.DirectedEdgeStar.prototype.linkMinimalDirectedEdges=function(er){for(var nextOut,nextIn,firstOut=null,incoming=null,state=this.SCANNING_FOR_INCOMING,i=this.resultAreaEdgeList.size()-1;i>=0;i--){nextOut=this.resultAreaEdgeList.get(i);nextIn=nextOut.getSym();firstOut===null&&nextOut.getEdgeRing()===er&&(firstOut=nextOut);switch(state){case this.SCANNING_FOR_INCOMING:if(nextIn.getEdgeRing()!=er)continue;incoming=nextIn;state=this.LINKING_TO_OUTGOING;break;case this.LINKING_TO_OUTGOING:if(nextOut.getEdgeRing()!==er)continue;incoming.setNextMin(nextOut);state=this.SCANNING_FOR_INCOMING}}state===this.LINKING_TO_OUTGOING&&(Assert.isTrue(firstOut!==null,"found null for first outgoing dirEdge"),Assert.isTrue(firstOut.getEdgeRing()===er,"unable to link last incoming dirEdge"),incoming.setNextMin(firstOut))};jsts.geomgraph.DirectedEdgeStar.prototype.linkAllDirectedEdges=function(){var prevOut,firstIn,i,nextOut,nextIn;for(this.getEdges(),prevOut=null,firstIn=null,i=this.edgeList.size()-1;i>=0;i--)nextOut=this.edgeList.get(i),nextIn=nextOut.getSym(),firstIn===null&&(firstIn=nextIn),prevOut!==null&&nextIn.setNext(prevOut),prevOut=nextOut;firstIn.setNext(prevOut)};jsts.geomgraph.DirectedEdgeStar.prototype.findCoveredLineEdges=function(){for(var currLoc,nextOut,nextIn,startLoc=Location.NONE,it=this.iterator();it.hasNext();)if(nextOut=it.next(),nextIn=nextOut.getSym(),!nextOut.isLineEdge()){if(nextOut.isInResult()){startLoc=Location.INTERIOR;break}if(nextIn.isInResult()){startLoc=Location.EXTERIOR;break}}if(startLoc!==Location.NONE)for(currLoc=startLoc,it=this.iterator();it.hasNext();)nextOut=it.next(),nextIn=nextOut.getSym(),nextOut.isLineEdge()?nextOut.getEdge().setCovered(currLoc===Location.INTERIOR):(nextOut.isInResult()&&(currLoc=Location.EXTERIOR),nextIn.isInResult()&&(currLoc=Location.INTERIOR))};jsts.geomgraph.DirectedEdgeStar.prototype.computeDepths=function(de){if(arguments.length===2){this.computeDepths2.apply(this,arguments);return}var edgeIndex=this.findIndex(de),label=de.getLabel(),startDepth=de.getDepth(Position.LEFT),targetLastDepth=de.getDepth(Position.RIGHT),nextDepth=this.computeDepths2(edgeIndex+1,this.edgeList.size(),startDepth),lastDepth=this.computeDepths2(0,edgeIndex,nextDepth);if(lastDepth!=targetLastDepth)throw new jsts.error.TopologyError("depth mismatch at "+de.getCoordinate());};jsts.geomgraph.DirectedEdgeStar.prototype.computeDepths2=function(startIndex,endIndex,startDepth){for(var nextDe,label,currDepth=startDepth,i=startIndex;i<endIndex;i++)nextDe=this.edgeList.get(i),label=nextDe.getLabel(),nextDe.setEdgeDepths(Position.RIGHT,currDepth),currDepth=nextDe.getDepth(Position.LEFT);return currDepth}}();jsts.algorithm.CentroidLine=function(){this.centSum=new jsts.geom.Coordinate};jsts.algorithm.CentroidLine.prototype.centSum=null;jsts.algorithm.CentroidLine.prototype.totalLength=0;jsts.algorithm.CentroidLine.prototype.add=function(geom){var poly,gc,i;if(geom instanceof Array){this.add2.apply(this,arguments);return}if(geom instanceof jsts.geom.LineString)this.add(geom.getCoordinates());else if(geom instanceof jsts.geom.Polygon)for(poly=geom,this.add(poly.getExteriorRing().getCoordinates()),i=0;i<poly.getNumInteriorRing();i++)this.add(poly.getInteriorRingN(i).getCoordinates());else if(geom instanceof jsts.geom.GeometryCollection||geom instanceof jsts.geom.MultiPoint||geom instanceof jsts.geom.MultiLineString||geom instanceof jsts.geom.MultiPolygon)for(gc=geom,i=0;i<gc.getNumGeometries();i++)this.add(gc.getGeometryN(i))};jsts.algorithm.CentroidLine.prototype.getCentroid=function(){var cent=new jsts.geom.Coordinate;return cent.x=this.centSum.x/this.totalLength,cent.y=this.centSum.y/this.totalLength,cent};jsts.algorithm.CentroidLine.prototype.add2=function(pts){for(var segmentLen,midx,midy,i=0;i<pts.length-1;i++)segmentLen=pts[i].distance(pts[i+1]),this.totalLength+=segmentLen,midx=(pts[i].x+pts[i+1].x)/2,this.centSum.x+=segmentLen*midx,midy=(pts[i].y+pts[i+1].y)/2,this.centSum.y+=segmentLen*midy};jsts.algorithm.PointLocator=function(boundaryRule){this.boundaryRule=boundaryRule?boundaryRule:jsts.algorithm.BoundaryNodeRule.OGC_SFS_BOUNDARY_RULE};jsts.algorithm.PointLocator.prototype.boundaryRule=null;jsts.algorithm.PointLocator.prototype.isIn=null;jsts.algorithm.PointLocator.prototype.numBoundaries=null;jsts.algorithm.PointLocator.prototype.intersects=function(p,geom){return this.locate(p,geom)!==jsts.geom.Location.EXTERIOR};jsts.algorithm.PointLocator.prototype.locate=function(p,geom){return geom.isEmpty()?jsts.geom.Location.EXTERIOR:geom instanceof jsts.geom.Point?this.locate2(p,geom):geom instanceof jsts.geom.LineString?this.locate3(p,geom):geom instanceof jsts.geom.Polygon?this.locate4(p,geom):(this.isIn=!1,this.numBoundaries=0,this.computeLocation(p,geom),this.boundaryRule.isInBoundary(this.numBoundaries))?jsts.geom.Location.BOUNDARY:this.numBoundaries>0||this.isIn?jsts.geom.Location.INTERIOR:jsts.geom.Location.EXTERIOR};jsts.algorithm.PointLocator.prototype.computeLocation=function(p,geom){var ml,l,mpoly,poly,i,part;if(geom instanceof jsts.geom.Point||geom instanceof jsts.geom.LineString||geom instanceof jsts.geom.Polygon)this.updateLocationInfo(this.locate(p,geom));else if(geom instanceof jsts.geom.MultiLineString)for(ml=geom,i=0;i<ml.getNumGeometries();i++)l=ml.getGeometryN(i),this.updateLocationInfo(this.locate(p,l));else if(geom instanceof jsts.geom.MultiPolygon)for(mpoly=geom,i=0;i<mpoly.getNumGeometries();i++)poly=mpoly.getGeometryN(i),this.updateLocationInfo(this.locate(p,poly));else if(geom instanceof jsts.geom.MultiPoint||geom instanceof jsts.geom.GeometryCollection)for(i=0;i<geom.getNumGeometries();i++)part=geom.getGeometryN(i),part!==geom&&this.computeLocation(p,part)};jsts.algorithm.PointLocator.prototype.updateLocationInfo=function(loc){loc===jsts.geom.Location.INTERIOR&&(this.isIn=!0);loc===jsts.geom.Location.BOUNDARY&&this.numBoundaries++};jsts.algorithm.PointLocator.prototype.locate2=function(p,pt){var ptCoord=pt.getCoordinate();return ptCoord.equals2D(p)?jsts.geom.Location.INTERIOR:jsts.geom.Location.EXTERIOR};jsts.algorithm.PointLocator.prototype.locate3=function(p,l){if(!l.getEnvelopeInternal().intersects(p))return jsts.geom.Location.EXTERIOR;var pt=l.getCoordinates();return!l.isClosed()&&(p.equals(pt[0])||p.equals(pt[pt.length-1]))?jsts.geom.Location.BOUNDARY:jsts.algorithm.CGAlgorithms.isOnLine(p,pt)?jsts.geom.Location.INTERIOR:jsts.geom.Location.EXTERIOR};jsts.algorithm.PointLocator.prototype.locateInPolygonRing=function(p,ring){return ring.getEnvelopeInternal().intersects(p)?jsts.algorithm.CGAlgorithms.locatePointInRing(p,ring.getCoordinates()):jsts.geom.Location.EXTERIOR};jsts.algorithm.PointLocator.prototype.locate4=function(p,poly){var shell,shellLoc,i,hole,holeLoc;if(poly.isEmpty()||(shell=poly.getExteriorRing(),shellLoc=this.locateInPolygonRing(p,shell),shellLoc===jsts.geom.Location.EXTERIOR))return jsts.geom.Location.EXTERIOR;if(shellLoc===jsts.geom.Location.BOUNDARY)return jsts.geom.Location.BOUNDARY;for(i=0;i<poly.getNumInteriorRing();i++){if(hole=poly.getInteriorRingN(i),holeLoc=this.locateInPolygonRing(p,hole),holeLoc===jsts.geom.Location.INTERIOR)return jsts.geom.Location.EXTERIOR;if(holeLoc===jsts.geom.Location.BOUNDARY)return jsts.geom.Location.BOUNDARY}return jsts.geom.Location.INTERIOR},function(){var ArrayList=javascript.util.ArrayList,TreeMap=javascript.util.TreeMap;jsts.geomgraph.EdgeList=function(){this.edges=new ArrayList;this.ocaMap=new TreeMap};jsts.geomgraph.EdgeList.prototype.edges=null;jsts.geomgraph.EdgeList.prototype.ocaMap=null;jsts.geomgraph.EdgeList.prototype.add=function(e){this.edges.add(e);var oca=new jsts.noding.OrientedCoordinateArray(e.getCoordinates());this.ocaMap.put(oca,e)};jsts.geomgraph.EdgeList.prototype.addAll=function(edgeColl){for(var i=edgeColl.iterator();i.hasNext();)this.add(i.next())};jsts.geomgraph.EdgeList.prototype.getEdges=function(){return this.edges};jsts.geomgraph.EdgeList.prototype.findEqualEdge=function(e){var oca=new jsts.noding.OrientedCoordinateArray(e.getCoordinates());return this.ocaMap.get(oca)};jsts.geomgraph.EdgeList.prototype.getEdges=function(){return this.edges};jsts.geomgraph.EdgeList.prototype.iterator=function(){return this.edges.iterator()};jsts.geomgraph.EdgeList.prototype.get=function(i){return this.edges.get(i)};jsts.geomgraph.EdgeList.prototype.findEdgeIndex=function(e){for(var i=0;i<this.edges.size();i++)if(this.edges.get(i).equals(e))return i;return-1}}(),function(){var Location=jsts.geom.Location,ArrayList=javascript.util.ArrayList,TreeMap=javascript.util.TreeMap;jsts.geomgraph.NodeMap=function(nodeFactory){this.nodeMap=new TreeMap;this.nodeFact=nodeFactory};jsts.geomgraph.NodeMap.prototype.nodeMap=null;jsts.geomgraph.NodeMap.prototype.nodeFact=null;jsts.geomgraph.NodeMap.prototype.addNode=function(arg){var node,coord,n;return arg instanceof jsts.geom.Coordinate?(coord=arg,node=this.nodeMap.get(coord),node===null&&(node=this.nodeFact.createNode(coord),this.nodeMap.put(coord,node)),node):arg instanceof jsts.geomgraph.Node?(n=arg,coord=n.getCoordinate(),node=this.nodeMap.get(coord),node===null)?(this.nodeMap.put(coord,n),n):(node.mergeLabel(n),node):void 0};jsts.geomgraph.NodeMap.prototype.add=function(e){var p=e.getCoordinate(),n=this.addNode(p);n.add(e)};jsts.geomgraph.NodeMap.prototype.find=function(coord){return this.nodeMap.get(coord)};jsts.geomgraph.NodeMap.prototype.values=function(){return this.nodeMap.values()};jsts.geomgraph.NodeMap.prototype.iterator=function(){return this.values().iterator()};jsts.geomgraph.NodeMap.prototype.getBoundaryNodes=function(geomIndex){for(var node,bdyNodes=new ArrayList,i=this.iterator();i.hasNext();)node=i.next(),node.getLabel().getLocation(geomIndex)===Location.BOUNDARY&&bdyNodes.add(node);return bdyNodes}}(),function(){var ArrayList=javascript.util.ArrayList;jsts.geomgraph.PlanarGraph=function(nodeFactory){this.edges=new ArrayList;this.edgeEndList=new ArrayList;this.nodes=new jsts.geomgraph.NodeMap(nodeFactory||new jsts.geomgraph.NodeFactory)};jsts.geomgraph.PlanarGraph.prototype.edges=null;jsts.geomgraph.PlanarGraph.prototype.nodes=null;jsts.geomgraph.PlanarGraph.prototype.edgeEndList=null;jsts.geomgraph.PlanarGraph.linkResultDirectedEdges=function(nodes){for(var node,nodeit=nodes.iterator();nodeit.hasNext();)node=nodeit.next(),node.getEdges().linkResultDirectedEdges()};jsts.geomgraph.PlanarGraph.prototype.getEdgeIterator=function(){return this.edges.iterator()};jsts.geomgraph.PlanarGraph.prototype.getEdgeEnds=function(){return this.edgeEndList};jsts.geomgraph.PlanarGraph.prototype.isBoundaryNode=function(geomIndex,coord){var node=this.nodes.find(coord),label;return node===null?!1:(label=node.getLabel(),label!==null&&label.getLocation(geomIndex)===jsts.geom.Location.BOUNDARY)?!0:!1};jsts.geomgraph.PlanarGraph.prototype.insertEdge=function(e){this.edges.add(e)};jsts.geomgraph.PlanarGraph.prototype.add=function(e){this.nodes.add(e);this.edgeEndList.add(e)};jsts.geomgraph.PlanarGraph.prototype.getNodeIterator=function(){return this.nodes.iterator()};jsts.geomgraph.PlanarGraph.prototype.getNodes=function(){return this.nodes.values()};jsts.geomgraph.PlanarGraph.prototype.addNode=function(node){return this.nodes.addNode(node)};jsts.geomgraph.PlanarGraph.prototype.addEdges=function(edgesToAdd){for(var e,de1,de2,it=edgesToAdd.iterator();it.hasNext();)e=it.next(),this.edges.add(e),de1=new jsts.geomgraph.DirectedEdge(e,!0),de2=new jsts.geomgraph.DirectedEdge(e,!1),de1.setSym(de2),de2.setSym(de1),this.add(de1),this.add(de2)};jsts.geomgraph.PlanarGraph.prototype.linkResultDirectedEdges=function(){for(var node,nodeit=this.nodes.iterator();nodeit.hasNext();)node=nodeit.next(),node.getEdges().linkResultDirectedEdges()};jsts.geomgraph.PlanarGraph.prototype.findEdgeInSameDirection=function(p0,p1){var i=0,il=this.edges.size(),e,eCoord;for(i;i<il;i++)if((e=this.edges.get(i),eCoord=e.getCoordinates(),this.matchInSameDirection(p0,p1,eCoord[0],eCoord[1]))||this.matchInSameDirection(p0,p1,eCoord[eCoord.length-1],eCoord[eCoord.length-2]))return e;return null};jsts.geomgraph.PlanarGraph.prototype.matchInSameDirection=function(p0,p1,ep0,ep1){return p0.equals(ep0)?jsts.algorithm.CGAlgorithms.computeOrientation(p0,p1,ep1)===jsts.algorithm.CGAlgorithms.COLLINEAR&&jsts.geomgraph.Quadrant.quadrant(p0,p1)===jsts.geomgraph.Quadrant.quadrant(ep0,ep1)?!0:!1:!1};jsts.geomgraph.PlanarGraph.prototype.findEdgeEnd=function(e){for(var ee,i=this.getEdgeEnds().iterator();i.hasNext();)if(ee=i.next(),ee.getEdge()===e)return ee;return null}}();jsts.algorithm.LineIntersector=function(){this.inputLines=[[],[]];this.intPt=[null,null];this.pa=this.intPt[0];this.pb=this.intPt[1];this.result=jsts.algorithm.LineIntersector.NO_INTERSECTION};jsts.algorithm.LineIntersector.NO_INTERSECTION=0;jsts.algorithm.LineIntersector.POINT_INTERSECTION=1;jsts.algorithm.LineIntersector.COLLINEAR_INTERSECTION=2;jsts.algorithm.LineIntersector.prototype.setPrecisionModel=function(precisionModel){this.precisionModel=precisionModel};jsts.algorithm.LineIntersector.prototype.getEndpoint=function(segmentIndex,ptIndex){return this.inputLines[segmentIndex][ptIndex]};jsts.algorithm.LineIntersector.computeEdgeDistance=function(p,p0,p1){var dx=Math.abs(p1.x-p0.x),dy=Math.abs(p1.y-p0.y),dist=-1,pdx,pdy;if(p.equals(p0)?dist=0:p.equals(p1)?dist=dx>dy?dx:dy:(pdx=Math.abs(p.x-p0.x),pdy=Math.abs(p.y-p0.y),dist=dx>dy?pdx:pdy,dist!==0||p.equals(p0)||(dist=Math.max(pdx,pdy))),dist===0&&!p.equals(p0))throw new jsts.error.IllegalArgumentError("Bad distance calculation");return dist};jsts.algorithm.LineIntersector.nonRobustComputeEdgeDistance=function(p,p1){var dx=p.x-p1.x,dy=p.y-p1.y,dist=Math.sqrt(dx*dx+dy*dy);if(!(dist===0&&!p.equals(p1)))throw new jsts.error.IllegalArgumentError("Invalid distance calculation");return dist};jsts.algorithm.LineIntersector.prototype.result=null;jsts.algorithm.LineIntersector.prototype.inputLines=null;jsts.algorithm.LineIntersector.prototype.intPt=null;jsts.algorithm.LineIntersector.prototype.intLineIndex=null;jsts.algorithm.LineIntersector.prototype._isProper=null;jsts.algorithm.LineIntersector.prototype.pa=null;jsts.algorithm.LineIntersector.prototype.pb=null;jsts.algorithm.LineIntersector.prototype.precisionModel=null;jsts.algorithm.LineIntersector.prototype.computeIntersection=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.algorithm.LineIntersector.prototype.isCollinear=function(){return this.result===jsts.algorithm.LineIntersector.COLLINEAR_INTERSECTION};jsts.algorithm.LineIntersector.prototype.computeIntersection=function(p1,p2,p3,p4){this.inputLines[0][0]=p1;this.inputLines[0][1]=p2;this.inputLines[1][0]=p3;this.inputLines[1][1]=p4;this.result=this.computeIntersect(p1,p2,p3,p4)};jsts.algorithm.LineIntersector.prototype.computeIntersect=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.algorithm.LineIntersector.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper};jsts.algorithm.LineIntersector.prototype.hasIntersection=function(){return this.result!==jsts.algorithm.LineIntersector.NO_INTERSECTION};jsts.algorithm.LineIntersector.prototype.getIntersectionNum=function(){return this.result};jsts.algorithm.LineIntersector.prototype.getIntersection=function(intIndex){return this.intPt[intIndex]};jsts.algorithm.LineIntersector.prototype.computeIntLineIndex=function(){this.intLineIndex===null&&(this.intLineIndex=[[],[]],this.computeIntLineIndex(0),this.computeIntLineIndex(1))};jsts.algorithm.LineIntersector.prototype.isIntersection=function(pt){for(var i=0;i<this.result;i++)if(this.intPt[i].equals2D(pt))return!0;return!1};jsts.algorithm.LineIntersector.prototype.isInteriorIntersection=function(){return arguments.length===1?this.isInteriorIntersection2.apply(this,arguments):this.isInteriorIntersection(0)?!0:this.isInteriorIntersection(1)?!0:!1};jsts.algorithm.LineIntersector.prototype.isInteriorIntersection2=function(inputLineIndex){for(var i=0;i<this.result;i++)if(!(this.intPt[i].equals2D(this.inputLines[inputLineIndex][0])||this.intPt[i].equals2D(this.inputLines[inputLineIndex][1])))return!0;return!1};jsts.algorithm.LineIntersector.prototype.isProper=function(){return this.hasIntersection()&&this._isProper};jsts.algorithm.LineIntersector.prototype.getIntersectionAlongSegment=function(segmentIndex,intIndex){return this.computeIntLineIndex(),this.intPt[intLineIndex[segmentIndex][intIndex]]};jsts.algorithm.LineIntersector.prototype.getIndexAlongSegment=function(segmentIndex,intIndex){return this.computeIntLineIndex(),this.intLineIndex[segmentIndex][intIndex]};jsts.algorithm.LineIntersector.prototype.computeIntLineIndex=function(segmentIndex){var dist0=this.getEdgeDistance(segmentIndex,0),dist1=this.getEdgeDistance(segmentIndex,1);dist0>dist1?(this.intLineIndex[segmentIndex][0]=0,this.intLineIndex[segmentIndex][1]=1):(this.intLineIndex[segmentIndex][0]=1,this.intLineIndex[segmentIndex][1]=0)};jsts.algorithm.LineIntersector.prototype.getEdgeDistance=function(segmentIndex,intIndex){return jsts.algorithm.LineIntersector.computeEdgeDistance(this.intPt[intIndex],this.inputLines[segmentIndex][0],this.inputLines[segmentIndex][1])};jsts.algorithm.RobustLineIntersector=function(){jsts.algorithm.RobustLineIntersector.prototype.constructor.call(this)};jsts.algorithm.RobustLineIntersector.prototype=new jsts.algorithm.LineIntersector;jsts.algorithm.RobustLineIntersector.prototype.computeIntersection=function(p,p1,p2){if(arguments.length===4){jsts.algorithm.LineIntersector.prototype.computeIntersection.apply(this,arguments);return}if(this._isProper=!1,jsts.geom.Envelope.intersects(p1,p2,p)&&jsts.algorithm.CGAlgorithms.orientationIndex(p1,p2,p)===0&&jsts.algorithm.CGAlgorithms.orientationIndex(p2,p1,p)===0){this._isProper=!0;(p.equals(p1)||p.equals(p2))&&(this._isProper=!1);this.result=jsts.algorithm.LineIntersector.POINT_INTERSECTION;return}this.result=jsts.algorithm.LineIntersector.NO_INTERSECTION};jsts.algorithm.RobustLineIntersector.prototype.computeIntersect=function(p1,p2,q1,q2){var Pq1,Pq2,Qp1,Qp2,collinear;return(this._isProper=!1,!jsts.geom.Envelope.intersects(p1,p2,q1,q2))?jsts.algorithm.LineIntersector.NO_INTERSECTION:(Pq1=jsts.algorithm.CGAlgorithms.orientationIndex(p1,p2,q1),Pq2=jsts.algorithm.CGAlgorithms.orientationIndex(p1,p2,q2),Pq1>0&&Pq2>0||Pq1<0&&Pq2<0)?jsts.algorithm.LineIntersector.NO_INTERSECTION:(Qp1=jsts.algorithm.CGAlgorithms.orientationIndex(q1,q2,p1),Qp2=jsts.algorithm.CGAlgorithms.orientationIndex(q1,q2,p2),Qp1>0&&Qp2>0||Qp1<0&&Qp2<0)?jsts.algorithm.LineIntersector.NO_INTERSECTION:(collinear=Pq1===0&&Pq2===0&&Qp1===0&&Qp2===0,collinear)?this.computeCollinearIntersection(p1,p2,q1,q2):(Pq1===0||Pq2===0||Qp1===0||Qp2===0?(this._isProper=!1,p1.equals2D(q1)||p1.equals2D(q2)?this.intPt[0]=p1:p2.equals2D(q1)||p2.equals2D(q2)?this.intPt[0]=p2:Pq1===0?this.intPt[0]=new jsts.geom.Coordinate(q1):Pq2===0?this.intPt[0]=new jsts.geom.Coordinate(q2):Qp1===0?this.intPt[0]=new jsts.geom.Coordinate(p1):Qp2===0&&(this.intPt[0]=new jsts.geom.Coordinate(p2))):(this._isProper=!0,this.intPt[0]=this.intersection(p1,p2,q1,q2)),jsts.algorithm.LineIntersector.POINT_INTERSECTION)};jsts.algorithm.RobustLineIntersector.prototype.computeCollinearIntersection=function(p1,p2,q1,q2){var p1q1p2=jsts.geom.Envelope.intersects(p1,p2,q1),p1q2p2=jsts.geom.Envelope.intersects(p1,p2,q2),q1p1q2=jsts.geom.Envelope.intersects(q1,q2,p1),q1p2q2=jsts.geom.Envelope.intersects(q1,q2,p2);return p1q1p2&&p1q2p2?(this.intPt[0]=q1,this.intPt[1]=q2,jsts.algorithm.LineIntersector.COLLINEAR_INTERSECTION):q1p1q2&&q1p2q2?(this.intPt[0]=p1,this.intPt[1]=p2,jsts.algorithm.LineIntersector.COLLINEAR_INTERSECTION):p1q1p2&&q1p1q2?(this.intPt[0]=q1,this.intPt[1]=p1,q1.equals(p1)&&!p1q2p2&&!q1p2q2?jsts.algorithm.LineIntersector.POINT_INTERSECTION:jsts.algorithm.LineIntersector.COLLINEAR_INTERSECTION):p1q1p2&&q1p2q2?(this.intPt[0]=q1,this.intPt[1]=p2,q1.equals(p2)&&!p1q2p2&&!q1p1q2?jsts.algorithm.LineIntersector.POINT_INTERSECTION:jsts.algorithm.LineIntersector.COLLINEAR_INTERSECTION):p1q2p2&&q1p1q2?(this.intPt[0]=q2,this.intPt[1]=p1,q2.equals(p1)&&!p1q1p2&&!q1p2q2?jsts.algorithm.LineIntersector.POINT_INTERSECTION:jsts.algorithm.LineIntersector.COLLINEAR_INTERSECTION):p1q2p2&&q1p2q2?(this.intPt[0]=q2,this.intPt[1]=p2,q2.equals(p2)&&!p1q1p2&&!q1p1q2?jsts.algorithm.LineIntersector.POINT_INTERSECTION:jsts.algorithm.LineIntersector.COLLINEAR_INTERSECTION):jsts.algorithm.LineIntersector.NO_INTERSECTION};jsts.algorithm.RobustLineIntersector.prototype.intersection=function(p1,p2,q1,q2){var intPt=this.intersectionWithNormalization(p1,p2,q1,q2);return this.isInSegmentEnvelopes(intPt)||(intPt=jsts.algorithm.CentralEndpointIntersector.getIntersection(p1,p2,q1,q2)),this.precisionModel!==null&&this.precisionModel.makePrecise(intPt),intPt};jsts.algorithm.RobustLineIntersector.prototype.intersectionWithNormalization=function(p1,p2,q1,q2){var n1=new jsts.geom.Coordinate(p1),n2=new jsts.geom.Coordinate(p2),n3=new jsts.geom.Coordinate(q1),n4=new jsts.geom.Coordinate(q2),normPt=new jsts.geom.Coordinate,intPt;return this.normalizeToEnvCentre(n1,n2,n3,n4,normPt),intPt=this.safeHCoordinateIntersection(n1,n2,n3,n4),intPt.x+=normPt.x,intPt.y+=normPt.y,intPt};jsts.algorithm.RobustLineIntersector.prototype.safeHCoordinateIntersection=function(p1,p2,q1,q2){var intPt=null;try{intPt=jsts.algorithm.HCoordinate.intersection(p1,p2,q1,q2)}catch(e){if(e instanceof jsts.error.NotRepresentableError)intPt=jsts.algorithm.CentralEndpointIntersector.getIntersection(p1,p2,q1,q2);else throw e;}return intPt};jsts.algorithm.RobustLineIntersector.prototype.normalizeToMinimum=function(n1,n2,n3,n4,normPt){normPt.x=this.smallestInAbsValue(n1.x,n2.x,n3.x,n4.x);normPt.y=this.smallestInAbsValue(n1.y,n2.y,n3.y,n4.y);n1.x-=normPt.x;n1.y-=normPt.y;n2.x-=normPt.x;n2.y-=normPt.y;n3.x-=normPt.x;n3.y-=normPt.y;n4.x-=normPt.x;n4.y-=normPt.y};jsts.algorithm.RobustLineIntersector.prototype.normalizeToEnvCentre=function(n00,n01,n10,n11,normPt){var minX0=n00.x<n01.x?n00.x:n01.x,minY0=n00.y<n01.y?n00.y:n01.y,maxX0=n00.x>n01.x?n00.x:n01.x,maxY0=n00.y>n01.y?n00.y:n01.y,minX1=n10.x<n11.x?n10.x:n11.x,minY1=n10.y<n11.y?n10.y:n11.y,maxX1=n10.x>n11.x?n10.x:n11.x,maxY1=n10.y>n11.y?n10.y:n11.y,intMinX=minX0>minX1?minX0:minX1,intMaxX=maxX0<maxX1?maxX0:maxX1,intMinY=minY0>minY1?minY0:minY1,intMaxY=maxY0<maxY1?maxY0:maxY1,intMidX=(intMinX+intMaxX)/2,intMidY=(intMinY+intMaxY)/2;normPt.x=intMidX;normPt.y=intMidY;n00.x-=normPt.x;n00.y-=normPt.y;n01.x-=normPt.x;n01.y-=normPt.y;n10.x-=normPt.x;n10.y-=normPt.y;n11.x-=normPt.x;n11.y-=normPt.y};jsts.algorithm.RobustLineIntersector.prototype.smallestInAbsValue=function(x1,x2,x3,x4){var x=x1,xabs=Math.abs(x);return Math.abs(x2)<xabs&&(x=x2,xabs=Math.abs(x2)),Math.abs(x3)<xabs&&(x=x3,xabs=Math.abs(x3)),Math.abs(x4)<xabs&&(x=x4),x};jsts.algorithm.RobustLineIntersector.prototype.isInSegmentEnvelopes=function(intPt){var env0=new jsts.geom.Envelope(this.inputLines[0][0],this.inputLines[0][1]),env1=new jsts.geom.Envelope(this.inputLines[1][0],this.inputLines[1][1]);return env0.contains(intPt)&&env1.contains(intPt)};jsts.noding.SegmentIntersector=function(){};jsts.noding.SegmentIntersector.prototype.processIntersections=jsts.abstractFunc;jsts.noding.SegmentIntersector.prototype.isDone=jsts.abstractFunc,function(){var SegmentIntersector=jsts.noding.SegmentIntersector,ArrayList=javascript.util.ArrayList;jsts.noding.InteriorIntersectionFinder=function(li){this.li=li;this.intersections=new ArrayList;this.interiorIntersection=null};jsts.noding.InteriorIntersectionFinder.prototype=new SegmentIntersector;jsts.noding.InteriorIntersectionFinder.constructor=jsts.noding.InteriorIntersectionFinder;jsts.noding.InteriorIntersectionFinder.prototype.findAllIntersections=!1;jsts.noding.InteriorIntersectionFinder.prototype.isCheckEndSegmentsOnly=!1;jsts.noding.InteriorIntersectionFinder.prototype.li=null;jsts.noding.InteriorIntersectionFinder.prototype.interiorIntersection=null;jsts.noding.InteriorIntersectionFinder.prototype.intSegments=null;jsts.noding.InteriorIntersectionFinder.prototype.intersections=null;jsts.noding.InteriorIntersectionFinder.prototype.setFindAllIntersections=function(findAllIntersections){this.findAllIntersections=findAllIntersections};jsts.noding.InteriorIntersectionFinder.prototype.getIntersections=function(){return intersections};jsts.noding.InteriorIntersectionFinder.prototype.setCheckEndSegmentsOnly=function(isCheckEndSegmentsOnly){this.isCheckEndSegmentsOnly=isCheckEndSegmentsOnly};jsts.noding.InteriorIntersectionFinder.prototype.hasIntersection=function(){return this.interiorIntersection!=null};jsts.noding.InteriorIntersectionFinder.prototype.getInteriorIntersection=function(){return this.interiorIntersection};jsts.noding.InteriorIntersectionFinder.prototype.getIntersectionSegments=function(){return this.intSegments};jsts.noding.InteriorIntersectionFinder.prototype.processIntersections=function(e0,segIndex0,e1,segIndex1){var isEndSegPresent;if(!this.hasIntersection()&&(e0!=e1||segIndex0!=segIndex1)&&(!this.isCheckEndSegmentsOnly||(isEndSegPresent=this.isEndSegment(e0,segIndex0)||isEndSegment(e1,segIndex1),isEndSegPresent))){var p00=e0.getCoordinates()[segIndex0],p01=e0.getCoordinates()[segIndex0+1],p10=e1.getCoordinates()[segIndex1],p11=e1.getCoordinates()[segIndex1+1];this.li.computeIntersection(p00,p01,p10,p11);this.li.hasIntersection()&&this.li.isInteriorIntersection()&&(this.intSegments=[],this.intSegments[0]=p00,this.intSegments[1]=p01,this.intSegments[2]=p10,this.intSegments[3]=p11,this.interiorIntersection=this.li.getIntersection(0),this.intersections.add(this.interiorIntersection))}};jsts.noding.InteriorIntersectionFinder.prototype.isEndSegment=function(segStr,index){return index==0?!0:index>=segStr.size()-2?!0:!1};jsts.noding.InteriorIntersectionFinder.prototype.isDone=function(){return this.findAllIntersections?!1:this.interiorIntersection!=null}}(),function(){jsts.noding.Noder=function(){};jsts.noding.Noder.prototype.computeNodes=jsts.abstractFunc;jsts.noding.Noder.prototype.getNodedSubstrings=jsts.abstractFunc}(),function(){var Noder=jsts.noding.Noder;jsts.noding.SinglePassNoder=function(){};jsts.noding.SinglePassNoder.prototype=new Noder;jsts.noding.SinglePassNoder.constructor=jsts.noding.SinglePassNoder;jsts.noding.SinglePassNoder.prototype.segInt=null;jsts.noding.SinglePassNoder.prototype.setSegmentIntersector=function(segInt){this.segInt=segInt}}();jsts.index.SpatialIndex=function(){};jsts.index.SpatialIndex.prototype.insert=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.index.SpatialIndex.prototype.query=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.index.SpatialIndex.prototype.remove=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.index.strtree.AbstractSTRtree=function(nodeCapacity){nodeCapacity!==undefined&&(this.itemBoundables=[],jsts.util.Assert.isTrue(nodeCapacity>1,"Node capacity must be greater than 1"),this.nodeCapacity=nodeCapacity)};jsts.index.strtree.AbstractSTRtree.IntersectsOp=function(){};jsts.index.strtree.AbstractSTRtree.IntersectsOp.prototype.intersects=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.index.strtree.AbstractSTRtree.prototype.root=null;jsts.index.strtree.AbstractSTRtree.prototype.built=!1;jsts.index.strtree.AbstractSTRtree.prototype.itemBoundables=null;jsts.index.strtree.AbstractSTRtree.prototype.nodeCapacity=null;jsts.index.strtree.AbstractSTRtree.prototype.build=function(){jsts.util.Assert.isTrue(!this.built);this.root=this.itemBoundables.length===0?this.createNode(0):this.createHigherLevels(this.itemBoundables,-1);this.built=!0};jsts.index.strtree.AbstractSTRtree.prototype.createNode=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.index.strtree.AbstractSTRtree.prototype.createParentBoundables=function(childBoundables,newLevel){var parentBoundables,sortedChildBoundables,i,childBoundable;for(jsts.util.Assert.isTrue(!(childBoundables.length===0)),parentBoundables=[],parentBoundables.push(this.createNode(newLevel)),sortedChildBoundables=[],i=0;i<childBoundables.length;i++)sortedChildBoundables.push(childBoundables[i]);for(sortedChildBoundables.sort(this.getComparator()),i=0;i<sortedChildBoundables.length;i++)childBoundable=sortedChildBoundables[i],this.lastNode(parentBoundables).getChildBoundables().length===this.getNodeCapacity()&&parentBoundables.push(this.createNode(newLevel)),this.lastNode(parentBoundables).addChildBoundable(childBoundable);return parentBoundables};jsts.index.strtree.AbstractSTRtree.prototype.lastNode=function(nodes){return nodes[nodes.length-1]};jsts.index.strtree.AbstractSTRtree.prototype.compareDoubles=function(a,b){return a>b?1:a<b?-1:0};jsts.index.strtree.AbstractSTRtree.prototype.createHigherLevels=function(boundablesOfALevel,level){jsts.util.Assert.isTrue(!(boundablesOfALevel.length===0));var parentBoundables=this.createParentBoundables(boundablesOfALevel,level+1);return parentBoundables.length===1?parentBoundables[0]:this.createHigherLevels(parentBoundables,level+1)};jsts.index.strtree.AbstractSTRtree.prototype.getRoot=function(){return this.built||this.build(),this.root};jsts.index.strtree.AbstractSTRtree.prototype.getNodeCapacity=function(){return this.nodeCapacity};jsts.index.strtree.AbstractSTRtree.prototype.size=function(){return arguments.length===1?this.size2(arguments[0]):(this.built||this.build(),this.itemBoundables.length===0)?0:this.size2(root)};jsts.index.strtree.AbstractSTRtree.prototype.size2=function(node){for(var childBoundable,size=0,childBoundables=node.getChildBoundables(),i=0;i<childBoundables.length;i++)childBoundable=childBoundables[i],childBoundable instanceof jsts.index.strtree.AbstractNode?size+=this.size(childBoundable):childBoundable instanceof jsts.index.strtree.ItemBoundable&&(size+=1);return size};jsts.index.strtree.AbstractSTRtree.prototype.depth=function(){return arguments.length===1?this.depth2(arguments[0]):(this.built||this.build(),this.itemBoundables.length===0)?0:this.depth2(root)};jsts.index.strtree.AbstractSTRtree.prototype.depth2=function(){for(var childBoundable,childDepth,maxChildDepth=0,childBoundables=node.getChildBoundables(),i=0;i<childBoundables.length;i++)childBoundable=childBoundables[i],childBoundable instanceof jsts.index.strtree.AbstractNode&&(childDepth=this.depth(childBoundable),childDepth>maxChildDepth&&(maxChildDepth=childDepth));return maxChildDepth+1};jsts.index.strtree.AbstractSTRtree.prototype.insert=function(bounds,item){jsts.util.Assert.isTrue(!this.built,"Cannot insert items into an STR packed R-tree after it has been built.");this.itemBoundables.push(new jsts.index.strtree.ItemBoundable(bounds,item))};jsts.index.strtree.AbstractSTRtree.prototype.query=function(searchBounds){arguments.length>1&&this.query2.apply(this,arguments);this.built||this.build();var matches=[];return this.itemBoundables.length===0?(jsts.util.Assert.isTrue(this.root.getBounds()===null),matches):(this.getIntersectsOp().intersects(this.root.getBounds(),searchBounds)&&this.query3(searchBounds,this.root,matches),matches)};jsts.index.strtree.AbstractSTRtree.prototype.query2=function(searchBounds,visitor){arguments.length>2&&this.query3.apply(this,arguments);this.built||this.build();this.itemBoundables.length===0&&jsts.util.Assert.isTrue(this.root.getBounds()===null);this.getIntersectsOp().intersects(this.root.getBounds(),searchBounds)&&this.query4(searchBounds,this.root,visitor)};jsts.index.strtree.AbstractSTRtree.prototype.query3=function(searchBounds,node,matches){var childBoundables,i,childBoundable;for(arguments[2]instanceof Array||this.query4.apply(this,arguments),childBoundables=node.getChildBoundables(),i=0;i<childBoundables.length;i++)(childBoundable=childBoundables[i],this.getIntersectsOp().intersects(childBoundable.getBounds(),searchBounds))&&(childBoundable instanceof jsts.index.strtree.AbstractNode?this.query3(searchBounds,childBoundable,matches):childBoundable instanceof jsts.index.strtree.ItemBoundable?matches.push(childBoundable.getItem()):jsts.util.Assert.shouldNeverReachHere())};jsts.index.strtree.AbstractSTRtree.prototype.query4=function(searchBounds,node,visitor){for(var childBoundable,childBoundables=node.getChildBoundables(),i=0;i<childBoundables.length;i++)(childBoundable=childBoundables[i],this.getIntersectsOp().intersects(childBoundable.getBounds(),searchBounds))&&(childBoundable instanceof jsts.index.strtree.AbstractNode?this.query4(searchBounds,childBoundable,visitor):childBoundable instanceof jsts.index.strtree.ItemBoundable?visitor.visitItem(childBoundable.getItem()):jsts.util.Assert.shouldNeverReachHere())};jsts.index.strtree.AbstractSTRtree.prototype.getIntersectsOp=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.index.strtree.AbstractSTRtree.prototype.itemsTree=function(){if(arguments.length===1)return this.itemsTree2.apply(this,arguments);this.built||this.build();var valuesTree=this.itemsTree2(this.root);return valuesTree===null?[]:valuesTree};jsts.index.strtree.AbstractSTRtree.prototype.itemsTree2=function(node){for(var childBoundable,valuesTreeForChild,valuesTreeForNode=[],childBoundables=node.getChildBoundables(),i=0;i<childBoundables.length;i++)childBoundable=childBoundables[i],childBoundable instanceof jsts.index.strtree.AbstractNode?(valuesTreeForChild=this.itemsTree(childBoundable),valuesTreeForChild!=null&&valuesTreeForNode.push(valuesTreeForChild)):childBoundable instanceof jsts.index.strtree.ItemBoundable?valuesTreeForNode.push(childBoundable.getItem()):jsts.util.Assert.shouldNeverReachHere();return valuesTreeForNode.length<=0?null:valuesTreeForNode};jsts.index.strtree.AbstractSTRtree.prototype.remove=function(searchBounds,item){return(this.built||this.build(),this.itemBoundables.length===0&&jsts.util.Assert.isTrue(this.root.getBounds()==null),this.getIntersectsOp().intersects(this.root.getBounds(),searchBounds))?this.remove2(searchBounds,this.root,item):!1};jsts.index.strtree.AbstractSTRtree.prototype.remove2=function(searchBounds,node,item){var found=this.removeItem(node,item),childToPrune,childBoundables,i,childBoundable;if(found)return!0;for(childToPrune=null,childBoundables=node.getChildBoundables(),i=0;i<childBoundables.length;i++)if((childBoundable=childBoundables[i],this.getIntersectsOp().intersects(childBoundable.getBounds(),searchBounds))&&childBoundable instanceof jsts.index.strtree.AbstractNode&&(found=this.remove(searchBounds,childBoundable,item),found)){childToPrune=childBoundable;break}return childToPrune!=null&&childToPrune.getChildBoundables().length===0&&childBoundables.splice(childBoundables.indexOf(childToPrune),1),found};jsts.index.strtree.AbstractSTRtree.prototype.removeItem=function(node,item){for(var childBoundable,childToRemove=null,childBoundables=node.getChildBoundables(),i=0;i<childBoundables.length;i++)childBoundable=childBoundables[i],childBoundable instanceof jsts.index.strtree.ItemBoundable&&childBoundable.getItem()===item&&(childToRemove=childBoundable);return childToRemove!==null?(childBoundables.splice(childBoundables.indexOf(childToRemove),1),!0):!1};jsts.index.strtree.AbstractSTRtree.prototype.boundablesAtLevel=function(level){if(arguments.length>1){this.boundablesAtLevel2.apply(this,arguments);return}var boundables=[];return this.boundablesAtLevel2(level,this.root,boundables),boundables};jsts.index.strtree.AbstractSTRtree.prototype.boundablesAtLevel2=function(level,top,boundables){var childBoundables,i,boundable;if(jsts.util.Assert.isTrue(level>-2),top.getLevel()===level){boundables.add(top);return}for(childBoundables=node.getChildBoundables(),i=0;i<childBoundables.length;i++)boundable=childBoundables[i],boundable instanceof jsts.index.strtree.AbstractNode?this.boundablesAtLevel(level,boundable,boundables):(jsts.util.Assert.isTrue(boundable instanceof jsts.index.strtree.ItemBoundable),level===-1&&boundables.add(boundable));return};jsts.index.strtree.AbstractSTRtree.prototype.getComparator=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.index.strtree.STRtree=function(nodeCapacity){nodeCapacity=nodeCapacity||jsts.index.strtree.STRtree.DEFAULT_NODE_CAPACITY;jsts.index.strtree.AbstractSTRtree.call(this,nodeCapacity)};jsts.index.strtree.STRtree.prototype=new jsts.index.strtree.AbstractSTRtree;jsts.index.strtree.STRtree.constructor=jsts.index.strtree.STRtree;jsts.index.strtree.STRtree.prototype.xComparator=function(o1,o2){return jsts.index.strtree.AbstractSTRtree.prototype.compareDoubles(jsts.index.strtree.STRtree.prototype.centreX(o1.getBounds()),jsts.index.strtree.STRtree.prototype.centreX(o2.getBounds()))};jsts.index.strtree.STRtree.prototype.yComparator=function(o1,o2){return jsts.index.strtree.AbstractSTRtree.prototype.compareDoubles(jsts.index.strtree.STRtree.prototype.centreY(o1.getBounds()),jsts.index.strtree.STRtree.prototype.centreY(o2.getBounds()))};jsts.index.strtree.STRtree.prototype.centreX=function(e){return jsts.index.strtree.STRtree.prototype.avg(e.getMinX(),e.getMaxX())};jsts.index.strtree.STRtree.prototype.centreY=function(e){return jsts.index.strtree.STRtree.prototype.avg(e.getMinY(),e.getMaxY())};jsts.index.strtree.STRtree.prototype.avg=function(a,b){return(a+b)/2};jsts.index.strtree.STRtree.prototype.intersectsOp={intersects:function(aBounds,bBounds){return aBounds.intersects(bBounds)}};jsts.index.strtree.STRtree.prototype.createParentBoundables=function(childBoundables,newLevel){var minLeafCount,sortedChildBoundables,i,verticalSlices;for(jsts.util.Assert.isTrue(!(childBoundables.length===0)),minLeafCount=Math.ceil(childBoundables.length/this.getNodeCapacity()),sortedChildBoundables=[],i=0;i<childBoundables.length;i++)sortedChildBoundables.push(childBoundables[i]);return sortedChildBoundables.sort(this.xComparator),verticalSlices=this.verticalSlices(sortedChildBoundables,Math.ceil(Math.sqrt(minLeafCount))),this.createParentBoundablesFromVerticalSlices(verticalSlices,newLevel)};jsts.index.strtree.STRtree.prototype.createParentBoundablesFromVerticalSlices=function(verticalSlices,newLevel){var parentBoundables,i;for(jsts.util.Assert.isTrue(verticalSlices.length>0),parentBoundables=[],i=0;i<verticalSlices.length;i++)parentBoundables=parentBoundables.concat(this.createParentBoundablesFromVerticalSlice(verticalSlices[i],newLevel));return parentBoundables};jsts.index.strtree.STRtree.prototype.createParentBoundablesFromVerticalSlice=function(childBoundables,newLevel){return jsts.index.strtree.AbstractSTRtree.prototype.createParentBoundables.call(this,childBoundables,newLevel)};jsts.index.strtree.STRtree.prototype.verticalSlices=function(childBoundables,sliceCount){for(var sliceCapacity=Math.ceil(childBoundables.length/sliceCount),slices=[],i=0,boundablesAddedToSlice,childBoundable,j=0;j<sliceCount;j++)for(slices[j]=[],boundablesAddedToSlice=0;i<childBoundables.length&&boundablesAddedToSlice<sliceCapacity;)childBoundable=childBoundables[i++],slices[j].push(childBoundable),boundablesAddedToSlice++;return slices};jsts.index.strtree.STRtree.DEFAULT_NODE_CAPACITY=10;jsts.index.strtree.STRtree.prototype.createNode=function(level){var abstractNode=new jsts.index.strtree.AbstractNode(level);return abstractNode.computeBounds=function(){for(var childBoundable,bounds=null,childBoundables=this.getChildBoundables(),i=0;i<childBoundables.length;i++)childBoundable=childBoundables[i],bounds===null?bounds=new jsts.geom.Envelope(childBoundable.getBounds()):bounds.expandToInclude(childBoundable.getBounds());return bounds},abstractNode};jsts.index.strtree.STRtree.prototype.getIntersectsOp=function(){return this.intersectsOp};jsts.index.strtree.STRtree.prototype.insert=function(itemEnv,item){itemEnv.isNull()||jsts.index.strtree.AbstractSTRtree.prototype.insert.call(this,itemEnv,item)};jsts.index.strtree.STRtree.prototype.query=function(){return jsts.index.strtree.AbstractSTRtree.prototype.query.apply(this,arguments)};jsts.index.strtree.STRtree.prototype.remove=function(itemEnv,item){return jsts.index.strtree.AbstractSTRtree.prototype.remove.call(this,itemEnv,item)};jsts.index.strtree.STRtree.prototype.size=function(){return jsts.index.strtree.AbstractSTRtree.prototype.size.call(this)};jsts.index.strtree.STRtree.prototype.depth=function(){return jsts.index.strtree.AbstractSTRtree.prototype.depth.call(this)};jsts.index.strtree.STRtree.prototype.getComparator=function(){return this.yComparator};jsts.index.strtree.STRtree.prototype.nearestNeighbour=function(itemDist){var bp=new jsts.index.strtree.BoundablePair(this.getRoot(),this.getRoot(),itemDist);return this.nearestNeighbour4(bp)};jsts.index.strtree.STRtree.prototype.nearestNeighbour2=function(env,item,itemDist){var bnd=new jsts.index.strtree.ItemBoundable(env,item),bp=new jsts.index.strtree.BoundablePair(this.getRoot(),bnd,itemDist);return this.nearestNeighbour4(bp)[0]};jsts.index.strtree.STRtree.prototype.nearestNeighbour3=function(tree,itemDist){var bp=new jsts.index.strtree.BoundablePair(this.getRoot(),tree.getRoot(),itemDist);return this.nearestNeighbour4(bp)};jsts.index.strtree.STRtree.prototype.nearestNeighbour4=function(initBndPair){return this.nearestNeighbour5(initBndPair,Double.POSITIVE_INFINITY)};jsts.index.strtree.STRtree.prototype.nearestNeighbour5=function(initBndPair,maxDistance){var distanceLowerBound=maxDistance,minPair=null,priQ=[],bndPair,currentDistance;for(priQ.push(initBndPair);!priQ.isEmpty()&&distanceLowerBound>0;){if(bndPair=priQ.pop(),currentDistance=bndPair.getDistance(),currentDistance>=distanceLowerBound)break;bndPair.isLeaves()?(distanceLowerBound=currentDistance,minPair=bndPair):bndPair.expandToQueue(priQ,distanceLowerBound)}return[minPair.getBoundable(0).getItem(),minPair.getBoundable(1).getItem()]};jsts.noding.SegmentString=function(){};jsts.noding.SegmentString.prototype.getData=jsts.abstractFunc;jsts.noding.SegmentString.prototype.setData=jsts.abstractFunc;jsts.noding.SegmentString.prototype.size=jsts.abstractFunc;jsts.noding.SegmentString.prototype.getCoordinate=jsts.abstractFunc;jsts.noding.SegmentString.prototype.getCoordinates=jsts.abstractFunc;jsts.noding.SegmentString.prototype.isClosed=jsts.abstractFunc;jsts.noding.NodableSegmentString=function(){};jsts.noding.NodableSegmentString.prototype=new jsts.noding.SegmentString;jsts.noding.NodableSegmentString.prototype.addIntersection=jsts.abstractFunc;jsts.noding.NodedSegmentString=function(pts,data){this.nodeList=new jsts.noding.SegmentNodeList(this);this.pts=pts;this.data=data};jsts.noding.NodedSegmentString.prototype=new jsts.noding.NodableSegmentString;jsts.noding.NodedSegmentString.constructor=jsts.noding.NodedSegmentString;jsts.noding.NodedSegmentString.getNodedSubstrings=function(segStrings){if(arguments.length===2){jsts.noding.NodedSegmentString.getNodedSubstrings2.apply(this,arguments);return}var resultEdgelist=new javascript.util.ArrayList;return jsts.noding.NodedSegmentString.getNodedSubstrings2(segStrings,resultEdgelist),resultEdgelist};jsts.noding.NodedSegmentString.getNodedSubstrings2=function(segStrings,resultEdgelist){for(var ss,i=segStrings.iterator();i.hasNext();)ss=i.next(),ss.getNodeList().addSplitEdges(resultEdgelist)};jsts.noding.NodedSegmentString.prototype.nodeList=null;jsts.noding.NodedSegmentString.prototype.pts=null;jsts.noding.NodedSegmentString.prototype.data=null;jsts.noding.NodedSegmentString.prototype.getData=function(){return this.data};jsts.noding.NodedSegmentString.prototype.setData=function(data){this.data=data};jsts.noding.NodedSegmentString.prototype.getNodeList=function(){return this.nodeList};jsts.noding.NodedSegmentString.prototype.size=function(){return this.pts.length};jsts.noding.NodedSegmentString.prototype.getCoordinate=function(i){return this.pts[i]};jsts.noding.NodedSegmentString.prototype.getCoordinates=function(){return this.pts};jsts.noding.NodedSegmentString.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])};jsts.noding.NodedSegmentString.prototype.getSegmentOctant=function(index){return index===this.pts.length-1?-1:this.safeOctant(this.getCoordinate(index),this.getCoordinate(index+1))};jsts.noding.NodedSegmentString.prototype.safeOctant=function(p0,p1){return p0.equals2D(p1)?0:jsts.noding.Octant.octant(p0,p1)};jsts.noding.NodedSegmentString.prototype.addIntersections=function(li,segmentIndex,geomIndex){for(var i=0;i<li.getIntersectionNum();i++)this.addIntersection(li,segmentIndex,geomIndex,i)};jsts.noding.NodedSegmentString.prototype.addIntersection=function(li,segmentIndex,geomIndex,intIndex){if(li instanceof jsts.geom.Coordinate){this.addIntersection2.apply(this,arguments);return}var intPt=new jsts.geom.Coordinate(li.getIntersection(intIndex));this.addIntersection2(intPt,segmentIndex)};jsts.noding.NodedSegmentString.prototype.addIntersection2=function(intPt,segmentIndex){this.addIntersectionNode(intPt,segmentIndex)};jsts.noding.NodedSegmentString.prototype.addIntersectionNode=function(intPt,segmentIndex){var normalizedSegmentIndex=segmentIndex,nextSegIndex=normalizedSegmentIndex+1,nextPt;return nextSegIndex<this.pts.length&&(nextPt=this.pts[nextSegIndex],intPt.equals2D(nextPt)&&(normalizedSegmentIndex=nextSegIndex)),this.nodeList.add(intPt,normalizedSegmentIndex)};jsts.noding.NodedSegmentString.prototype.toString=function(){var geometryFactory=new jsts.geom.GeometryFactory;return(new jsts.io.WKTWriter).write(geometryFactory.createLineString(this.pts))};jsts.index.chain.MonotoneChainBuilder=function(){};jsts.index.chain.MonotoneChainBuilder.toIntArray=function(list){for(var array=[],i=0;i<list.length;i++)array[i]=list[i];return array};jsts.index.chain.MonotoneChainBuilder.getChains=function(pts){return arguments.length===2?jsts.index.chain.MonotoneChainBuilder.getChains2.apply(this,arguments):jsts.index.chain.MonotoneChainBuilder.getChains2(pts,null)};jsts.index.chain.MonotoneChainBuilder.getChains2=function(pts,context){for(var mc,mcList=[],startIndex=jsts.index.chain.MonotoneChainBuilder.getChainStartIndices(pts),i=0;i<startIndex.length-1;i++)mc=new jsts.index.chain.MonotoneChain(pts,startIndex[i],startIndex[i+1],context),mcList.push(mc);return mcList};jsts.index.chain.MonotoneChainBuilder.getChainStartIndices=function(pts){var start=0,startIndexList=[],last;startIndexList.push(start);do last=jsts.index.chain.MonotoneChainBuilder.findChainEnd(pts,start),startIndexList.push(last),start=last;while(start<pts.length-1);return jsts.index.chain.MonotoneChainBuilder.toIntArray(startIndexList)};jsts.index.chain.MonotoneChainBuilder.findChainEnd=function(pts,start){for(var safeStart=start,chainQuad,last,quad;safeStart<pts.length-1&&pts[safeStart].equals2D(pts[safeStart+1]);)safeStart++;if(safeStart>=pts.length-1)return pts.length-1;for(chainQuad=jsts.geomgraph.Quadrant.quadrant(pts[safeStart],pts[safeStart+1]),last=start+1;last<pts.length;){if(!pts[last-1].equals2D(pts[last])&&(quad=jsts.geomgraph.Quadrant.quadrant(pts[last-1],pts[last]),quad!==chainQuad))break;last++}return last-1};jsts.geom.LineSegment=function(p0,p1){if(p0===undefined){this.p0=new jsts.geom.Coordinate;this.p1=new jsts.geom.Coordinate;return}this.p0=p0;this.p1=p1};jsts.geom.LineSegment.prototype.p0=null;jsts.geom.LineSegment.prototype.p1=null;jsts.geom.LineSegment.prototype.getLength=function(){return this.p0.distance(this.p1)};jsts.geom.LineSegment.prototype.isHorizontal=function(){return this.p0.y===this.p1.y};jsts.geom.LineSegment.prototype.isVertical=function(){return this.p0.x===this.p1.x};jsts.geom.LineSegment.prototype.reverse=function(){var temp=this.p0;this.p0=this.p1;this.p1=temp};jsts.geom.LineSegment.prototype.projectionFactor=function(p){if(p.equals(this.p0))return 0;if(p.equals(this.p1))return 1;var dx=this.p1.x-this.p0.x,dy=this.p1.y-this.p0.y,len2=dx*dx+dy*dy;return((p.x-this.p0.x)*dx+(p.y-this.p0.y)*dy)/len2};jsts.geom.LineSegment.prototype.closestPoint=function(p){var factor=this.projectionFactor(p),dist0,dist1;return factor>0&&factor<1?this.project(p):(dist0=this.p0.distance(p),dist1=this.p1.distance(p),dist0<dist1)?this.p0:this.p1};jsts.geom.LineSegment.prototype.closestPoints=function(line){var intPt=this.intersection(line),close01,close10,close11;if(intPt!==null)return[intPt,intPt];var closestPt=[],minDistance=Number.MAX_VALUE,dist,close00=this.closestPoint(line.p0);return minDistance=close00.distance(line.p0),closestPt[0]=close00,closestPt[1]=line.p0,close01=this.closestPoint(line.p1),dist=close01.distance(line.p1),dist<minDistance&&(minDistance=dist,closestPt[0]=close01,closestPt[1]=line.p1),close10=line.closestPoint(this.p0),dist=close10.distance(this.p0),dist<minDistance&&(minDistance=dist,closestPt[0]=this.p0,closestPt[1]=close10),close11=line.closestPoint(this.p1),dist=close11.distance(this.p1),dist<minDistance&&(minDistance=dist,closestPt[0]=this.p1,closestPt[1]=close11),closestPt};jsts.geom.LineSegment.prototype.intersection=function(line){var li=new jsts.algorithm.RobustLineIntersector;return(li.computeIntersection(this.p0,this.p1,line.p0,line.p1),li.hasIntersection())?li.getIntersection(0):null};jsts.geom.LineSegment.prototype.project=function(p){if(p.equals(this.p0)||p.equals(this.p1))return new jsts.geom.Coordinate(p);var r=this.projectionFactor(p),coord=new jsts.geom.Coordinate;return coord.x=this.p0.x+r*(this.p1.x-this.p0.x),coord.y=this.p0.y+r*(this.p1.y-this.p0.y),coord};jsts.geom.LineSegment.prototype.setCoordinates=function(ls){if(ls instanceof jsts.geom.Coordinate){this.setCoordinates2.apply(this,arguments);return}this.setCoordinates2(ls.p0,ls.p1)};jsts.geom.LineSegment.prototype.setCoordinates2=function(p0,p1){this.p0.x=p0.x;this.p0.y=p0.y;this.p1.x=p1.x;this.p1.y=p1.y};jsts.geom.LineSegment.prototype.distance=function(p){return jsts.algorithm.CGAlgorithms.distancePointLine(p,this.p0,this.p1)};jsts.index.chain.MonotoneChainOverlapAction=function(){this.tempEnv1=new jsts.geom.Envelope;this.tempEnv2=new jsts.geom.Envelope;this.overlapSeg1=new jsts.geom.LineSegment;this.overlapSeg2=new jsts.geom.LineSegment};jsts.index.chain.MonotoneChainOverlapAction.prototype.tempEnv1=null;jsts.index.chain.MonotoneChainOverlapAction.prototype.tempEnv2=null;jsts.index.chain.MonotoneChainOverlapAction.prototype.overlapSeg1=null;jsts.index.chain.MonotoneChainOverlapAction.prototype.overlapSeg2=null;jsts.index.chain.MonotoneChainOverlapAction.prototype.overlap=function(mc1,start1,mc2,start2){this.mc1.getLineSegment(start1,this.overlapSeg1);this.mc2.getLineSegment(start2,this.overlapSeg2);this.overlap2(this.overlapSeg1,this.overlapSeg2)};jsts.index.chain.MonotoneChainOverlapAction.prototype.overlap2=function(){},function(){var MonotoneChainOverlapAction=jsts.index.chain.MonotoneChainOverlapAction,SinglePassNoder=jsts.noding.SinglePassNoder,STRtree=jsts.index.strtree.STRtree,NodedSegmentString=jsts.noding.NodedSegmentString,MonotoneChainBuilder=jsts.index.chain.MonotoneChainBuilder,SegmentOverlapAction=function(si){this.si=si};SegmentOverlapAction.prototype=new MonotoneChainOverlapAction;SegmentOverlapAction.constructor=SegmentOverlapAction;SegmentOverlapAction.prototype.si=null;SegmentOverlapAction.prototype.overlap=function(mc1,start1,mc2,start2){var ss1=mc1.getContext(),ss2=mc2.getContext();this.si.processIntersections(ss1,start1,ss2,start2)};jsts.noding.MCIndexNoder=function(){this.monoChains=[];this.index=new STRtree};jsts.noding.MCIndexNoder.prototype=new SinglePassNoder;jsts.noding.MCIndexNoder.constructor=jsts.noding.MCIndexNoder;jsts.noding.MCIndexNoder.prototype.monoChains=null;jsts.noding.MCIndexNoder.prototype.index=null;jsts.noding.MCIndexNoder.prototype.idCounter=0;jsts.noding.MCIndexNoder.prototype.nodedSegStrings=null;jsts.noding.MCIndexNoder.prototype.nOverlaps=0;jsts.noding.MCIndexNoder.prototype.getMonotoneChains=function(){return this.monoChains};jsts.noding.MCIndexNoder.prototype.getIndex=function(){return this.index};jsts.noding.MCIndexNoder.prototype.getNodedSubstrings=function(){return NodedSegmentString.getNodedSubstrings(this.nodedSegStrings)};jsts.noding.MCIndexNoder.prototype.computeNodes=function(inputSegStrings){this.nodedSegStrings=inputSegStrings;for(var i=inputSegStrings.iterator();i.hasNext();)this.add(i.next());this.intersectChains()};jsts.noding.MCIndexNoder.prototype.intersectChains=function(){for(var queryChain,overlapChains,j,testChain,overlapAction=new SegmentOverlapAction(this.segInt),i=0;i<this.monoChains.length;i++)for(queryChain=this.monoChains[i],overlapChains=this.index.query(queryChain.getEnvelope()),j=0;j<overlapChains.length;j++)if(testChain=overlapChains[j],testChain.getId()>queryChain.getId()&&(queryChain.computeOverlaps(testChain,overlapAction),this.nOverlaps++),this.segInt.isDone())return};jsts.noding.MCIndexNoder.prototype.add=function(segStr){for(var mc,segChains=MonotoneChainBuilder.getChains(segStr.getCoordinates(),segStr),i=0;i<segChains.length;i++)mc=segChains[i],mc.setId(this.idCounter++),this.index.insert(mc.getEnvelope(),mc),this.monoChains.push(mc)}}(),function(){var RobustLineIntersector=jsts.algorithm.RobustLineIntersector,InteriorIntersectionFinder=jsts.noding.InteriorIntersectionFinder,MCIndexNoder=jsts.noding.MCIndexNoder;jsts.noding.FastNodingValidator=function(segStrings){this.li=new RobustLineIntersector;this.segStrings=segStrings};jsts.noding.FastNodingValidator.prototype.li=null;jsts.noding.FastNodingValidator.prototype.segStrings=null;jsts.noding.FastNodingValidator.prototype.findAllIntersections=!1;jsts.noding.FastNodingValidator.prototype.segInt=null;jsts.noding.FastNodingValidator.prototype._isValid=!0;jsts.noding.FastNodingValidator.prototype.setFindAllIntersections=function(findAllIntersections){this.findAllIntersections=findAllIntersections};jsts.noding.FastNodingValidator.prototype.getIntersections=function(){return segInt.getIntersections()};jsts.noding.FastNodingValidator.prototype.isValid=function(){return this.execute(),this._isValid};jsts.noding.FastNodingValidator.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var intSegs=this.segInt.getIntersectionSegments();return"found non-noded intersection between "+jsts.io.WKTWriter.toLineString(intSegs[0],intSegs[1])+" and "+jsts.io.WKTWriter.toLineString(intSegs[2],intSegs[3])};jsts.noding.FastNodingValidator.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new jsts.error.TopologyError(this.getErrorMessage(),this.segInt.getInteriorIntersection());};jsts.noding.FastNodingValidator.prototype.execute=function(){this.segInt==null&&this.checkInteriorIntersections()};jsts.noding.FastNodingValidator.prototype.checkInteriorIntersections=function(){this._isValid=!0;this.segInt=new InteriorIntersectionFinder(this.li);this.segInt.setFindAllIntersections(this.findAllIntersections);var noder=new MCIndexNoder;if(noder.setSegmentIntersector(this.segInt),noder.computeNodes(this.segStrings),this.segInt.hasIntersection()){this._isValid=!1;return}}}(),function(){jsts.noding.BasicSegmentString=function(pts,data){this.pts=pts;this.data=data};jsts.noding.BasicSegmentString.prototype=new jsts.noding.SegmentString;jsts.noding.BasicSegmentString.prototype.pts=null;jsts.noding.BasicSegmentString.prototype.data=null;jsts.noding.BasicSegmentString.prototype.getData=function(){return this.data};jsts.noding.BasicSegmentString.prototype.setData=function(data){this.data=data};jsts.noding.BasicSegmentString.prototype.size=function(){return this.pts.length};jsts.noding.BasicSegmentString.prototype.getCoordinate=function(i){return this.pts[i]};jsts.noding.BasicSegmentString.prototype.getCoordinates=function(){return this.pts};jsts.noding.BasicSegmentString.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])};jsts.noding.BasicSegmentString.prototype.getSegmentOctant=function(index){return index==this.pts.length-1?-1:jsts.noding.Octant.octant(this.getCoordinate(index),this.getCoordinate(index+1))}}(),function(){var FastNodingValidator=jsts.noding.FastNodingValidator,BasicSegmentString=jsts.noding.BasicSegmentString,ArrayList=javascript.util.ArrayList;jsts.geomgraph.EdgeNodingValidator=function(edges){this.nv=new FastNodingValidator(jsts.geomgraph.EdgeNodingValidator.toSegmentStrings(edges))};jsts.geomgraph.EdgeNodingValidator.checkValid=function(edges){var validator=new jsts.geomgraph.EdgeNodingValidator(edges);validator.checkValid()};jsts.geomgraph.EdgeNodingValidator.toSegmentStrings=function(edges){for(var e,segStrings=new ArrayList,i=edges.iterator();i.hasNext();)e=i.next(),segStrings.add(new BasicSegmentString(e.getCoordinates(),e));return segStrings};jsts.geomgraph.EdgeNodingValidator.prototype.nv=null;jsts.geomgraph.EdgeNodingValidator.prototype.checkValid=function(){this.nv.checkValid()}}();jsts.operation.GeometryGraphOperation=function(g0,g1,boundaryNodeRule){if(this.li=new jsts.algorithm.RobustLineIntersector,this.arg=[],g0!==undefined){if(g1===undefined){this.setComputationPrecision(g0.getPrecisionModel());this.arg[0]=new jsts.geomgraph.GeometryGraph(0,g0);return}boundaryNodeRule=boundaryNodeRule||jsts.algorithm.BoundaryNodeRule.OGC_SFS_BOUNDARY_RULE;g0.getPrecisionModel().compareTo(g1.getPrecisionModel())>=0?this.setComputationPrecision(g0.getPrecisionModel()):this.setComputationPrecision(g1.getPrecisionModel());this.arg[0]=new jsts.geomgraph.GeometryGraph(0,g0,boundaryNodeRule);this.arg[1]=new jsts.geomgraph.GeometryGraph(1,g1,boundaryNodeRule)}};jsts.operation.GeometryGraphOperation.prototype.li=null;jsts.operation.GeometryGraphOperation.prototype.resultPrecisionModel=null;jsts.operation.GeometryGraphOperation.prototype.arg=null;jsts.operation.GeometryGraphOperation.prototype.getArgGeometry=function(i){return arg[i].getGeometry()};jsts.operation.GeometryGraphOperation.prototype.setComputationPrecision=function(pm){this.resultPrecisionModel=pm;this.li.setPrecisionModel(this.resultPrecisionModel)};jsts.operation.overlay.PolygonBuilder=function(geometryFactory){this.shellList=[];this.geometryFactory=geometryFactory};jsts.operation.overlay.PolygonBuilder.prototype.geometryFactory=null;jsts.operation.overlay.PolygonBuilder.prototype.shellList=null;jsts.operation.overlay.PolygonBuilder.prototype.add=function(graph){if(arguments.length===2){this.add2.apply(this,arguments);return}this.add2(graph.getEdgeEnds(),graph.getNodes())};jsts.operation.overlay.PolygonBuilder.prototype.add2=function(dirEdges,nodes){jsts.geomgraph.PlanarGraph.linkResultDirectedEdges(nodes);var maxEdgeRings=this.buildMaximalEdgeRings(dirEdges),freeHoleList=[],edgeRings=this.buildMinimalEdgeRings(maxEdgeRings,this.shellList,freeHoleList);this.sortShellsAndHoles(edgeRings,this.shellList,freeHoleList);this.placeFreeHoles(this.shellList,freeHoleList)};jsts.operation.overlay.PolygonBuilder.prototype.getPolygons=function(){return this.computePolygons(this.shellList)};jsts.operation.overlay.PolygonBuilder.prototype.buildMaximalEdgeRings=function(dirEdges){for(var de,er,maxEdgeRings=[],it=dirEdges.iterator();it.hasNext();)de=it.next(),de.isInResult()&&de.getLabel().isArea()&&de.getEdgeRing()==null&&(er=new jsts.operation.overlay.MaximalEdgeRing(de,this.geometryFactory),maxEdgeRings.push(er),er.setInResult());return maxEdgeRings};jsts.operation.overlay.PolygonBuilder.prototype.buildMinimalEdgeRings=function(maxEdgeRings,shellList,freeHoleList){for(var er,minEdgeRings,shell,edgeRings=[],i=0;i<maxEdgeRings.length;i++)er=maxEdgeRings[i],er.getMaxNodeDegree()>2?(er.linkDirectedEdgesForMinimalEdgeRings(),minEdgeRings=er.buildMinimalRings(),shell=this.findShell(minEdgeRings),shell!==null?(this.placePolygonHoles(shell,minEdgeRings),shellList.push(shell)):freeHoleList=freeHoleList.concat(minEdgeRings)):edgeRings.push(er);return edgeRings};jsts.operation.overlay.PolygonBuilder.prototype.findShell=function(minEdgeRings){for(var er,shellCount=0,shell=null,i=0;i<minEdgeRings.length;i++)er=minEdgeRings[i],er.isHole()||(shell=er,shellCount++);return jsts.util.Assert.isTrue(shellCount<=1,"found two shells in MinimalEdgeRing list"),shell};jsts.operation.overlay.PolygonBuilder.prototype.placePolygonHoles=function(shell,minEdgeRings){for(var er,i=0;i<minEdgeRings.length;i++)er=minEdgeRings[i],er.isHole()&&er.setShell(shell)};jsts.operation.overlay.PolygonBuilder.prototype.sortShellsAndHoles=function(edgeRings,shellList,freeHoleList){for(var er,i=0;i<edgeRings.length;i++)er=edgeRings[i],er.isHole()?freeHoleList.push(er):shellList.push(er)};jsts.operation.overlay.PolygonBuilder.prototype.placeFreeHoles=function(shellList,freeHoleList){for(var hole,shell,i=0;i<freeHoleList.length;i++)if(hole=freeHoleList[i],hole.getShell()==null){if(shell=this.findEdgeRingContaining(hole,shellList),shell===null)throw new jsts.error.TopologyError("unable to assign hole to a shell",hole.getCoordinate(0));hole.setShell(shell)}};jsts.operation.overlay.PolygonBuilder.prototype.findEdgeRingContaining=function(testEr,shellList){for(var isContained,testRing=testEr.getLinearRing(),testEnv=testRing.getEnvelopeInternal(),testPt=testRing.getCoordinateN(0),minShell=null,minEnv=null,i=0;i<shellList.length;i++){var tryShell=shellList[i],tryRing=tryShell.getLinearRing(),tryEnv=tryRing.getEnvelopeInternal();minShell!==null&&(minEnv=minShell.getLinearRing().getEnvelopeInternal());isContained=!1;tryEnv.contains(testEnv)&&jsts.algorithm.CGAlgorithms.isPointInRing(testPt,tryRing.getCoordinates())&&(isContained=!0);isContained&&(minShell==null||minEnv.contains(tryEnv))&&(minShell=tryShell)}return minShell};jsts.operation.overlay.PolygonBuilder.prototype.computePolygons=function(shellList){for(var er,poly,resultPolyList=new javascript.util.ArrayList,i=0;i<shellList.length;i++)er=shellList[i],poly=er.toPolygon(this.geometryFactory),resultPolyList.add(poly);return resultPolyList};jsts.operation.overlay.PolygonBuilder.prototype.containsPoint=function(p){for(var er,i=0;i<this.shellList.length;i++)if(er=this.shellList[i],er.containsPoint(p))return!0;return!1},function(){var Assert=jsts.util.Assert,ArrayList=javascript.util.ArrayList,LineBuilder=function(op,geometryFactory,ptLocator){this.lineEdgesList=new ArrayList;this.resultLineList=new ArrayList;this.op=op;this.geometryFactory=geometryFactory;this.ptLocator=ptLocator};LineBuilder.prototype.op=null;LineBuilder.prototype.geometryFactory=null;LineBuilder.prototype.ptLocator=null;LineBuilder.prototype.lineEdgesList=null;LineBuilder.prototype.resultLineList=null;LineBuilder.prototype.build=function(opCode){return this.findCoveredLineEdges(),this.collectLines(opCode),this.buildLines(opCode),this.resultLineList};LineBuilder.prototype.findCoveredLineEdges=function(){for(var node,it,de,e,isCovered,nodeit=this.op.getGraph().getNodes().iterator();nodeit.hasNext();)node=nodeit.next(),node.getEdges().findCoveredLineEdges();for(it=this.op.getGraph().getEdgeEnds().iterator();it.hasNext();)de=it.next(),e=de.getEdge(),de.isLineEdge()&&!e.isCoveredSet()&&(isCovered=this.op.isCoveredByA(de.getCoordinate()),e.setCovered(isCovered))};LineBuilder.prototype.collectLines=function(opCode){for(var de,it=this.op.getGraph().getEdgeEnds().iterator();it.hasNext();)de=it.next(),this.collectLineEdge(de,opCode,this.lineEdgesList),this.collectBoundaryTouchEdge(de,opCode,this.lineEdgesList)};LineBuilder.prototype.collectLineEdge=function(de,opCode,edges){var label=de.getLabel(),e=de.getEdge();de.isLineEdge()&&(de.isVisited()||!jsts.operation.overlay.OverlayOp.isResultOfOp(label,opCode)||e.isCovered()||(edges.add(e),de.setVisitedEdge(!0)))};LineBuilder.prototype.collectBoundaryTouchEdge=function(de,opCode,edges){var label=de.getLabel();de.isLineEdge()||de.isVisited()||de.isInteriorAreaEdge()||de.getEdge().isInResult()||(Assert.isTrue(!(de.isInResult()||de.getSym().isInResult())||!de.getEdge().isInResult()),jsts.operation.overlay.OverlayOp.isResultOfOp(label,opCode)&&opCode===jsts.operation.overlay.OverlayOp.INTERSECTION&&(edges.add(de.getEdge()),de.setVisitedEdge(!0)))};LineBuilder.prototype.buildLines=function(){for(var it=this.lineEdgesList.iterator();it.hasNext();){var e=it.next(),label=e.getLabel(),line=this.geometryFactory.createLineString(e.getCoordinates());this.resultLineList.add(line);e.setInResult(!0)}};LineBuilder.prototype.labelIsolatedLines=function(edgesList){for(var e,label,it=edgesList.iterator();it.hasNext();)e=it.next(),label=e.getLabel(),e.isIsolated()&&(label.isNull(0)?this.labelIsolatedLine(e,0):this.labelIsolatedLine(e,1))};LineBuilder.prototype.labelIsolatedLine=function(e,targetIndex){var loc=ptLocator.locate(e.getCoordinate(),op.getArgGeometry(targetIndex));e.getLabel().setLocation(targetIndex,loc)};jsts.operation.overlay.LineBuilder=LineBuilder}(),function(){var ArrayList=javascript.util.ArrayList,PointBuilder=function(op,geometryFactory){this.resultPointList=new ArrayList;this.op=op;this.geometryFactory=geometryFactory};PointBuilder.prototype.op=null;PointBuilder.prototype.geometryFactory=null;PointBuilder.prototype.resultPointList=null;PointBuilder.prototype.build=function(opCode){return this.extractNonCoveredResultNodes(opCode),this.resultPointList};PointBuilder.prototype.extractNonCoveredResultNodes=function(opCode){for(var n,label,nodeit=this.op.getGraph().getNodes().iterator();nodeit.hasNext();)(n=nodeit.next(),n.isInResult())||n.isIncidentEdgeInResult()||(n.getEdges().getDegree()===0||opCode===jsts.operation.overlay.OverlayOp.INTERSECTION)&&(label=n.getLabel(),jsts.operation.overlay.OverlayOp.isResultOfOp(label,opCode)&&this.filterCoveredNodeToPoint(n))};PointBuilder.prototype.filterCoveredNodeToPoint=function(n){var coord=n.getCoordinate(),pt;this.op.isCoveredByLA(coord)||(pt=this.geometryFactory.createPoint(coord),this.resultPointList.add(pt))};jsts.operation.overlay.PointBuilder=PointBuilder}(),function(){var PointLocator=jsts.algorithm.PointLocator,Location=jsts.geom.Location,EdgeList=jsts.geomgraph.EdgeList,Label=jsts.geomgraph.Label,PlanarGraph=jsts.geomgraph.PlanarGraph,Position=jsts.geomgraph.Position,EdgeNodingValidator=jsts.geomgraph.EdgeNodingValidator,GeometryGraphOperation=jsts.operation.GeometryGraphOperation,OverlayNodeFactory=jsts.operation.overlay.OverlayNodeFactory,PolygonBuilder=jsts.operation.overlay.PolygonBuilder,LineBuilder=jsts.operation.overlay.LineBuilder,PointBuilder=jsts.operation.overlay.PointBuilder,Assert=jsts.util.Assert,ArrayList=javascript.util.ArrayList;jsts.operation.overlay.OverlayOp=function(g0,g1){this.ptLocator=new PointLocator;this.edgeList=new EdgeList;this.resultPolyList=new ArrayList;this.resultLineList=new ArrayList;this.resultPointList=new ArrayList;GeometryGraphOperation.call(this,g0,g1);this.graph=new PlanarGraph(new OverlayNodeFactory);this.geomFact=g0.getFactory()};jsts.operation.overlay.OverlayOp.prototype=new GeometryGraphOperation;jsts.operation.overlay.OverlayOp.constructor=jsts.operation.overlay.OverlayOp;jsts.operation.overlay.OverlayOp.INTERSECTION=1;jsts.operation.overlay.OverlayOp.UNION=2;jsts.operation.overlay.OverlayOp.DIFFERENCE=3;jsts.operation.overlay.OverlayOp.SYMDIFFERENCE=4;jsts.operation.overlay.OverlayOp.overlayOp=function(geom0,geom1,opCode){var gov=new jsts.operation.overlay.OverlayOp(geom0,geom1);return gov.getResultGeometry(opCode)};jsts.operation.overlay.OverlayOp.isResultOfOp=function(label,opCode){if(arguments.length===3)return jsts.operation.overlay.OverlayOp.isResultOfOp2.apply(this,arguments);var loc0=label.getLocation(0),loc1=label.getLocation(1);return jsts.operation.overlay.OverlayOp.isResultOfOp2(loc0,loc1,opCode)};jsts.operation.overlay.OverlayOp.isResultOfOp2=function(loc0,loc1,opCode){loc0==Location.BOUNDARY&&(loc0=Location.INTERIOR);loc1==Location.BOUNDARY&&(loc1=Location.INTERIOR);switch(opCode){case jsts.operation.overlay.OverlayOp.INTERSECTION:return loc0==Location.INTERIOR&&loc1==Location.INTERIOR;case jsts.operation.overlay.OverlayOp.UNION:return loc0==Location.INTERIOR||loc1==Location.INTERIOR;case jsts.operation.overlay.OverlayOp.DIFFERENCE:return loc0==Location.INTERIOR&&loc1!=Location.INTERIOR;case jsts.operation.overlay.OverlayOp.SYMDIFFERENCE:return loc0==Location.INTERIOR&&loc1!=Location.INTERIOR||loc0!=Location.INTERIOR&&loc1==Location.INTERIOR}return!1};jsts.operation.overlay.OverlayOp.prototype.ptLocator=null;jsts.operation.overlay.OverlayOp.prototype.geomFact=null;jsts.operation.overlay.OverlayOp.prototype.resultGeom=null;jsts.operation.overlay.OverlayOp.prototype.graph=null;jsts.operation.overlay.OverlayOp.prototype.edgeList=null;jsts.operation.overlay.OverlayOp.prototype.resultPolyList=null;jsts.operation.overlay.OverlayOp.prototype.resultLineList=null;jsts.operation.overlay.OverlayOp.prototype.resultPointList=null;jsts.operation.overlay.OverlayOp.prototype.getResultGeometry=function(funcCode){return this.computeOverlay(funcCode),this.resultGeom};jsts.operation.overlay.OverlayOp.prototype.getGraph=function(){return this.graph};jsts.operation.overlay.OverlayOp.prototype.computeOverlay=function(opCode){var baseSplitEdges,splitEdges,polyBuilder,lineBuilder,pointBuilder;this.copyPoints(0);this.copyPoints(1);this.arg[0].computeSelfNodes(this.li,!1);this.arg[1].computeSelfNodes(this.li,!1);this.arg[0].computeEdgeIntersections(this.arg[1],this.li,!0);baseSplitEdges=new ArrayList;this.arg[0].computeSplitEdges(baseSplitEdges);this.arg[1].computeSplitEdges(baseSplitEdges);splitEdges=baseSplitEdges;this.insertUniqueEdges(baseSplitEdges);this.computeLabelsFromDepths();this.replaceCollapsedEdges();EdgeNodingValidator.checkValid(this.edgeList.getEdges());this.graph.addEdges(this.edgeList.getEdges());this.computeLabelling();this.labelIncompleteNodes();this.findResultAreaEdges(opCode);this.cancelDuplicateResultEdges();polyBuilder=new PolygonBuilder(this.geomFact);polyBuilder.add(this.graph);this.resultPolyList=polyBuilder.getPolygons();lineBuilder=new LineBuilder(this,this.geomFact,this.ptLocator);this.resultLineList=lineBuilder.build(opCode);pointBuilder=new PointBuilder(this,this.geomFact,this.ptLocator);this.resultPointList=pointBuilder.build(opCode);this.resultGeom=this.computeGeometry(this.resultPointList,this.resultLineList,this.resultPolyList,opCode)};jsts.operation.overlay.OverlayOp.prototype.insertUniqueEdges=function(edges){for(var e,i=edges.iterator();i.hasNext();)e=i.next(),this.insertUniqueEdge(e)};jsts.operation.overlay.OverlayOp.prototype.insertUniqueEdge=function(e){var existingEdge=this.edgeList.findEqualEdge(e),existingLabel,labelToMerge,depth;existingEdge!==null?(existingLabel=existingEdge.getLabel(),labelToMerge=e.getLabel(),existingEdge.isPointwiseEqual(e)||(labelToMerge=new Label(e.getLabel()),labelToMerge.flip()),depth=existingEdge.getDepth(),depth.isNull()&&depth.add(existingLabel),depth.add(labelToMerge),existingLabel.merge(labelToMerge)):this.edgeList.add(e)};jsts.operation.overlay.OverlayOp.prototype.computeLabelsFromDepths=function(){for(var i,it=this.edgeList.iterator();it.hasNext();){var e=it.next(),lbl=e.getLabel(),depth=e.getDepth();if(!depth.isNull())for(depth.normalize(),i=0;i<2;i++)lbl.isNull(i)||!lbl.isArea()||depth.isNull(i)||(depth.getDelta(i)==0?lbl.toLine(i):(Assert.isTrue(!depth.isNull(i,Position.LEFT),"depth of LEFT side has not been initialized"),lbl.setLocation(i,Position.LEFT,depth.getLocation(i,Position.LEFT)),Assert.isTrue(!depth.isNull(i,Position.RIGHT),"depth of RIGHT side has not been initialized"),lbl.setLocation(i,Position.RIGHT,depth.getLocation(i,Position.RIGHT))))}};jsts.operation.overlay.OverlayOp.prototype.replaceCollapsedEdges=function(){for(var e,newEdges=new ArrayList,it=this.edgeList.iterator();it.hasNext();)e=it.next(),e.isCollapsed()&&(it.remove(),newEdges.add(e.getCollapsedEdge()));this.edgeList.addAll(newEdges)};jsts.operation.overlay.OverlayOp.prototype.copyPoints=function(argIndex){for(var graphNode,newNode,i=this.arg[argIndex].getNodeIterator();i.hasNext();)graphNode=i.next(),newNode=this.graph.addNode(graphNode.getCoordinate()),newNode.setLabel(argIndex,graphNode.getLabel().getLocation(argIndex))};jsts.operation.overlay.OverlayOp.prototype.computeLabelling=function(){for(var node,nodeit=this.graph.getNodes().iterator();nodeit.hasNext();)node=nodeit.next(),node.getEdges().computeLabelling(this.arg);this.mergeSymLabels();this.updateNodeLabelling()};jsts.operation.overlay.OverlayOp.prototype.mergeSymLabels=function(){for(var node,nodeit=this.graph.getNodes().iterator();nodeit.hasNext();)node=nodeit.next(),node.getEdges().mergeSymLabels()};jsts.operation.overlay.OverlayOp.prototype.updateNodeLabelling=function(){for(var node,lbl,nodeit=this.graph.getNodes().iterator();nodeit.hasNext();)node=nodeit.next(),lbl=node.getEdges().getLabel(),node.getLabel().merge(lbl)};jsts.operation.overlay.OverlayOp.prototype.labelIncompleteNodes=function(){for(var n,label,nodeCount=0,ni=this.graph.getNodes().iterator();ni.hasNext();)n=ni.next(),label=n.getLabel(),n.isIsolated()&&(nodeCount++,label.isNull(0)?this.labelIncompleteNode(n,0):this.labelIncompleteNode(n,1)),n.getEdges().updateLabelling(label)};jsts.operation.overlay.OverlayOp.prototype.labelIncompleteNode=function(n,targetIndex){var loc=this.ptLocator.locate(n.getCoordinate(),this.arg[targetIndex].getGeometry());n.getLabel().setLocation(targetIndex,loc)};jsts.operation.overlay.OverlayOp.prototype.findResultAreaEdges=function(opCode){for(var de,label,it=this.graph.getEdgeEnds().iterator();it.hasNext();)de=it.next(),label=de.getLabel(),label.isArea()&&!de.isInteriorAreaEdge()&&jsts.operation.overlay.OverlayOp.isResultOfOp(label.getLocation(0,Position.RIGHT),label.getLocation(1,Position.RIGHT),opCode)&&de.setInResult(!0)};jsts.operation.overlay.OverlayOp.prototype.cancelDuplicateResultEdges=function(){for(var de,sym,it=this.graph.getEdgeEnds().iterator();it.hasNext();)de=it.next(),sym=de.getSym(),de.isInResult()&&sym.isInResult()&&(de.setInResult(!1),sym.setInResult(!1))};jsts.operation.overlay.OverlayOp.prototype.isCoveredByLA=function(coord){return this.isCovered(coord,this.resultLineList)?!0:this.isCovered(coord,this.resultPolyList)?!0:!1};jsts.operation.overlay.OverlayOp.prototype.isCoveredByA=function(coord){return this.isCovered(coord,this.resultPolyList)?!0:!1};jsts.operation.overlay.OverlayOp.prototype.isCovered=function(coord,geomList){for(var geom,loc,it=geomList.iterator();it.hasNext();)if(geom=it.next(),loc=this.ptLocator.locate(coord,geom),loc!=Location.EXTERIOR)return!0;return!1};jsts.operation.overlay.OverlayOp.prototype.computeGeometry=function(resultPointList,resultLineList,resultPolyList){var geomList=new ArrayList;return geomList.addAll(resultPointList),geomList.addAll(resultLineList),geomList.addAll(resultPolyList),this.geomFact.buildGeometry(geomList)};jsts.operation.overlay.OverlayOp.prototype.createEmptyResult=function(opCode){var result=null;switch(resultDimension(opCode,this.arg[0].getGeometry(),this.arg[1].getGeometry())){case-1:result=geomFact.createGeometryCollection();break;case 0:result=geomFact.createPoint(null);break;case 1:result=geomFact.createLineString(null);break;case 2:result=geomFact.createPolygon(null,null)}return result};jsts.operation.overlay.OverlayOp.prototype.resultDimension=function(opCode,g0,g1){var dim0=g0.getDimension(),dim1=g1.getDimension(),resultDimension=-1;switch(opCode){case jsts.operation.overlay.OverlayOp.INTERSECTION:resultDimension=Math.min(dim0,dim1);break;case jsts.operation.overlay.OverlayOp.UNION:resultDimension=Math.max(dim0,dim1);break;case jsts.operation.overlay.OverlayOp.DIFFERENCE:resultDimension=dim0;break;case jsts.operation.overlay.OverlayOp.SYMDIFFERENCE:resultDimension=Math.max(dim0,dim1)}return resultDimension}}(),function(){var NodeBase=function(){this.items=new javascript.util.ArrayList;this.subnode=[null,null]};NodeBase.getSubnodeIndex=function(interval,centre){var subnodeIndex=-1;return interval.min>=centre&&(subnodeIndex=1),interval.max<=centre&&(subnodeIndex=0),subnodeIndex};NodeBase.prototype.getItems=function(){return this.items};NodeBase.prototype.add=function(item){this.items.add(item)};NodeBase.prototype.addAllItems=function(items){items.addAll(this.items);var i=0;for(i;i<2;i++)this.subnode[i]!==null&&this.subnode[i].addAllItems(items);return items};NodeBase.prototype.addAllItemsFromOverlapping=function(interval,resultItems){(interval===null||this.isSearchMatch(interval))&&(resultItems.addAll(this.items),this.subnode[0]!==null&&this.subnode[0].addAllItemsFromOverlapping(interval,resultItems),this.subnode[1]!==null&&this.subnode[1].addAllItemsFromOverlapping(interval,resultItems))};NodeBase.prototype.remove=function(itemInterval,item){if(!this.isSearchMatch(itemInterval))return!1;var found=!1,i=0;for(i;i<2;i++)if(this.subnode[i]!==null&&(found=this.subnode[i].remove(itemInterval,item),found)){this.subnode[i].isPrunable()&&(this.subnode[i]=null);break}return found?found:this.items.remove(item)};NodeBase.prototype.isPrunable=function(){return!(this.hasChildren()||this.hasItems())};NodeBase.prototype.hasChildren=function(){var i=0;for(i;i<2;i++)if(this.subnode[i]!==null)return!0;return!1};NodeBase.prototype.hasItems=function(){return!this.items.isEmpty()};NodeBase.prototype.depth=function(){var maxSubDepth=0,i=0,sqd;for(i;i<2;i++)this.subnode[i]!==null&&(sqd=this.subnode[i].depth(),sqd>maxSubDepth&&(maxSubDepth=sqd));return maxSubDepth+1};NodeBase.prototype.size=function(){var subSize=0,i=0;for(i;i<2;i++)this.subnode[i]!==null&&(subSize+=this.subnode[i].size());return subSize+this.items.size()};NodeBase.prototype.nodeSize=function(){var subSize=0,i=0;for(i;i<2;i++)this.subnode[i]!==null&&(subSize+=this.subnode[i].nodeSize());return subSize+1};jsts.index.bintree.NodeBase=NodeBase}(),function(){var Interval=function(){if(this.min=0,this.max=0,arguments.length===1){var interval=arguments[0];this.init(interval.min,interval.max)}else arguments.length===2&&this.init(arguments[0],arguments[1])};Interval.prototype.init=function(min,max){this.min=min;this.max=max;min>max&&(this.min=max,this.max=min)};Interval.prototype.getMin=function(){return this.min};Interval.prototype.getMax=function(){return this.max};Interval.prototype.getWidth=function(){return this.max-this.min};Interval.prototype.expandToInclude=function(interval){interval.max>this.max&&(this.max=interval.max);interval.min<this.min&&(this.min=interval.min)};Interval.prototype.overlaps=function(){return arguments.length===1?this.overlapsInterval.apply(this,arguments):this.overlapsMinMax.apply(this,arguments)};Interval.prototype.overlapsInterval=function(interval){return this.overlaps(interval.min,interval.max)};Interval.prototype.overlapsMinMax=function(min,max){return this.min>max||this.max<min?!1:!0};Interval.prototype.contains=function(){var interval;return arguments[0]instanceof jsts.index.bintree.Interval?(interval=arguments[0],this.containsMinMax(interval.min,interval.max)):arguments.length===1?this.containsPoint(arguments[0]):this.containsMinMax(arguments[0],arguments[1])};Interval.prototype.containsMinMax=function(min,max){return min>=this.min&&max<=this.max};Interval.prototype.containsPoint=function(p){return p>=this.min&&p<=this.max};jsts.index.bintree.Interval=Interval}();jsts.index.DoubleBits=function(){};jsts.index.DoubleBits.powerOf2=function(exp){return Math.pow(2,exp)};jsts.index.DoubleBits.exponent=function(d){return jsts.index.DoubleBits.CVTFWD(64,d)-1023};jsts.index.DoubleBits.CVTFWD=function(NumW,Qty){var Sign,Expo,Mant,Bin,nb01="",ExW={32:8,64:11}[NumW],MtW=NumW-ExW-1;if(Bin||(Sign=Qty<0||1/Qty<0,isFinite(Qty)||(Bin={32:{d:127,c:128,b:0,a:0},64:{d:32752,c:0,b:0,a:0}}[NumW],Sign&&(Bin.d+=1<<NumW/4-1),Expo=Math.pow(2,ExW)-1,Mant=0)),!Bin){for(Expo={32:127,64:1023}[NumW],Mant=Math.abs(Qty);Mant>=2;)Expo++,Mant/=2;while(Mant<1&&Expo>0)Expo--,Mant*=2;Expo<=0&&(Mant/=2,nb01="Zero or Denormal");NumW===32&&Expo>254&&(nb01="Too big for Single",Bin={d:Sign?255:127,c:128,b:0,a:0},Expo=Math.pow(2,ExW)-1,Mant=0)}return Expo},function(){var DoubleBits=jsts.index.DoubleBits,Interval=jsts.index.bintree.Interval,Key=function(interval){this.pt=0;this.level=0;this.computeKey(interval)};Key.computeLevel=function(interval){var dx=interval.getWidth();return DoubleBits.exponent(dx)+1};Key.prototype.getPoint=function(){return this.pt};Key.prototype.getLevel=function(){return this.level};Key.prototype.getInterval=function(){return this.interval};Key.prototype.computeKey=function(itemInterval){for(this.level=Key.computeLevel(itemInterval),this.interval=new Interval,this.computeInterval(this.level,itemInterval);!this.interval.contains(itemInterval);)this.level+=1,this.computeInterval(this.level,itemInterval)};Key.prototype.computeInterval=function(level,itemInterval){var size=DoubleBits.powerOf2(level);this.pt=Math.floor(itemInterval.getMin()/size)*size;this.interval.init(this.pt,this.pt+size)};jsts.index.bintree.Key=Key}(),function(){var NodeBase=jsts.index.bintree.NodeBase,Key=jsts.index.bintree.Key,Interval=jsts.index.bintree.Interval,Node=function(interval,level){this.items=new javascript.util.ArrayList;this.subnode=[null,null];this.interval=interval;this.level=level;this.centre=(interval.getMin()+interval.getMax())/2};Node.prototype=new NodeBase;Node.constructor=Node;Node.createNode=function(itemInterval){var key;return key=new Key(itemInterval),new Node(key.getInterval(),key.getLevel())};Node.createExpanded=function(node,addInterval){var expandInt,largerNode;return expandInt=new Interval(addInterval),node!==null&&expandInt.expandToInclude(node.interval),largerNode=Node.createNode(expandInt),node!==null&&largerNode.insert(node),largerNode};Node.prototype.getInterval=function(){return this.interval};Node.prototype.isSearchMatch=function(itemInterval){return itemInterval.overlaps(this.interval)};Node.prototype.getNode=function(searchInterval){var subnodeIndex=NodeBase.getSubnodeIndex(searchInterval,this.centre),node;return subnodeIndex!=-1?(node=this.getSubnode(subnodeIndex),node.getNode(searchInterval)):this};Node.prototype.find=function(searchInterval){var subnodeIndex=NodeBase.getSubnodeIndex(searchInterval,this.centre),node;return subnodeIndex===-1?this:this.subnode[subnodeIndex]!==null?(node=this.subnode[subnodeIndex],node.find(searchInterval)):this};Node.prototype.insert=function(node){var index=NodeBase.getSubnodeIndex(node.interval,this.centre),childNode;node.level===this.level-1?this.subnode[index]=node:(childNode=this.createSubnode(index),childNode.insert(node),this.subnode[index]=childNode)};Node.prototype.getSubnode=function(index){return this.subnode[index]===null&&(this.subnode[index]=this.createSubnode(index)),this.subnode[index]};Node.prototype.createSubnode=function(index){var min,max,subInt;min=0;max=0;switch(index){case 0:min=this.interval.getMin();max=this.centre;break;case 1:min=this.centre;max=this.interval.getMax()}return subInt=new Interval(min,max),new Node(subInt,this.level-1)};jsts.index.bintree.Node=Node}(),function(){var Node=jsts.index.bintree.Node,NodeBase=jsts.index.bintree.NodeBase,Root=function(){this.subnode=[null,null];this.items=new javascript.util.ArrayList};Root.prototype=new jsts.index.bintree.NodeBase;Root.constructor=Root;Root.origin=0;Root.prototype.insert=function(itemInterval,item){var index=NodeBase.getSubnodeIndex(itemInterval,Root.origin),node,largerNode;if(index===-1){this.add(item);return}node=this.subnode[index];node!==null&&node.getInterval().contains(itemInterval)||(largerNode=Node.createExpanded(node,itemInterval),this.subnode[index]=largerNode);this.insertContained(this.subnode[index],itemInterval,item)};Root.prototype.insertContained=function(tree,itemInterval,item){var isZeroArea,node;isZeroArea=jsts.index.IntervalSize.isZeroWidth(itemInterval.getMin(),itemInterval.getMax());node=isZeroArea?tree.find(itemInterval):tree.getNode(itemInterval);node.add(item)};Root.prototype.isSearchMatch=function(){return!0};jsts.index.bintree.Root=Root}(),function(){var Interval=jsts.index.bintree.Interval,Root=jsts.index.bintree.Root,Bintree=function(){this.root=new Root;this.minExtent=1};Bintree.ensureExtent=function(itemInterval,minExtent){var min,max;return(min=itemInterval.getMin(),max=itemInterval.getMax(),min!==max)?itemInterval:(min===max&&(min=min-minExtent/2,max=min+minExtent/2),new Interval(min,max))};Bintree.prototype.depth=function(){return this.root!==null?this.root.depth():0};Bintree.prototype.size=function(){return this.root!==null?this.root.size():0};Bintree.prototype.nodeSize=function(){return this.root!==null?this.root.nodeSize():0};Bintree.prototype.insert=function(itemInterval,item){this.collectStats(itemInterval);var insertInterval=Bintree.ensureExtent(itemInterval,this.minExtent);this.root.insert(insertInterval,item)};Bintree.prototype.remove=function(itemInterval,item){var insertInterval=Bintree.ensureExtent(itemInterval,this.minExtent);return this.root.remove(insertInterval,item)};Bintree.prototype.iterator=function(){var foundItems=new javascript.util.ArrayList;return this.root.addAllItems(foundItems),foundItems.iterator()};Bintree.prototype.query=function(){if(arguments.length===2)this.queryAndAdd(arguments[0],arguments[1]);else{var x=arguments[0];return!x instanceof Interval&&(x=new Interval(x,x)),this.queryInterval(x)}};Bintree.prototype.queryInterval=function(interval){var foundItems=new javascript.util.ArrayList;return this.query(interval,foundItems),foundItems};Bintree.prototype.queryAndAdd=function(interval,foundItems){this.root.addAllItemsFromOverlapping(interval,foundItems)};Bintree.prototype.collectStats=function(interval){var del=interval.getWidth();del<this.minExtent&&del>0&&(this.minExtent=del)};jsts.index.bintree.Bintree=Bintree}();jsts.index.IntervalSize=function(){};jsts.index.IntervalSize.MIN_BINARY_EXPONENT=-50;jsts.index.IntervalSize.isZeroWidth=function(min,max){var width=max-min,maxAbs,scaledInterval,level;return width===0?!0:(maxAbs=Math.max(Math.abs(min),Math.abs(max)),scaledInterval=width/maxAbs,level=jsts.index.DoubleBits.exponent(scaledInterval),level<=jsts.index.IntervalSize.MIN_BINARY_EXPONENT)};jsts.geomgraph.index.SimpleEdgeSetIntersector=function(){};jsts.geomgraph.index.SimpleEdgeSetIntersector.prototype=new jsts.geomgraph.index.EdgeSetIntersector;jsts.geomgraph.index.SimpleEdgeSetIntersector.prototype.nOverlaps=0;jsts.geomgraph.index.SimpleEdgeSetIntersector.prototype.computeIntersections=function(edges,si,testAllSegments){var i0,edge0,i1,edge1;if(si instanceof javascript.util.List){this.computeIntersections2.apply(this,arguments);return}for(this.nOverlaps=0,i0=edges.iterator();i0.hasNext();)for(edge0=i0.next(),i1=edges.iterator();i1.hasNext();)edge1=i1.next(),(testAllSegments||edge0!=edge1)&&this.computeIntersects(edge0,edge1,si)};jsts.geomgraph.index.SimpleEdgeSetIntersector.prototype.computeIntersections2=function(edges0,edges1,si){var i0,edge0,i1,edge1;for(this.nOverlaps=0,i0=edges0.iterator();i0.hasNext();)for(edge0=i0.next(),i1=edges1.iterator();i1.hasNext();)edge1=i1.next(),this.computeIntersects(edge0,edge1,si)};jsts.geomgraph.index.SimpleEdgeSetIntersector.prototype.computeIntersects=function(e0,e1,si){for(var pts0=e0.getCoordinates(),pts1=e1.getCoordinates(),i1,i0=0;i0<pts0.length-1;i0++)for(i1=0;i1<pts1.length-1;i1++)si.addIntersections(e0,i0,e1,i1)};jsts.index.ArrayListVisitor=function(){this.items=[]};jsts.index.ArrayListVisitor.prototype.visitItem=function(item){this.items.push(item)};jsts.index.ArrayListVisitor.prototype.getItems=function(){return this.items},function(){var ArrayList=javascript.util.ArrayList,GeometryTransformer=function(){};GeometryTransformer.prototype.inputGeom=null;GeometryTransformer.prototype.factory=null;GeometryTransformer.prototype.pruneEmptyGeometry=!0;GeometryTransformer.prototype.preserveGeometryCollectionType=!0;GeometryTransformer.prototype.preserveCollections=!1;GeometryTransformer.prototype.reserveType=!1;GeometryTransformer.prototype.getInputGeometry=function(){return this.inputGeom};GeometryTransformer.prototype.transform=function(inputGeom){if(this.inputGeom=inputGeom,this.factory=inputGeom.getFactory(),inputGeom instanceof jsts.geom.Point)return this.transformPoint(inputGeom,null);if(inputGeom instanceof jsts.geom.MultiPoint)return this.transformMultiPoint(inputGeom,null);if(inputGeom instanceof jsts.geom.LinearRing)return this.transformLinearRing(inputGeom,null);if(inputGeom instanceof jsts.geom.LineString)return this.transformLineString(inputGeom,null);if(inputGeom instanceof jsts.geom.MultiLineString)return this.transformMultiLineString(inputGeom,null);if(inputGeom instanceof jsts.geom.Polygon)return this.transformPolygon(inputGeom,null);if(inputGeom instanceof jsts.geom.MultiPolygon)return this.transformMultiPolygon(inputGeom,null);if(inputGeom instanceof jsts.geom.GeometryCollection)return this.transformGeometryCollection(inputGeom,null);throw new jsts.error.IllegalArgumentException("Unknown Geometry subtype: "+inputGeom.getClass().getName());};GeometryTransformer.prototype.createCoordinateSequence=function(coords){return this.factory.getCoordinateSequenceFactory().create(coords)};GeometryTransformer.prototype.copy=function(seq){return seq.clone()};GeometryTransformer.prototype.transformCoordinates=function(coords){return this.copy(coords)};GeometryTransformer.prototype.transformPoint=function(geom){return this.factory.createPoint(this.transformCoordinates(geom.getCoordinateSequence(),geom))};GeometryTransformer.prototype.transformMultiPoint=function(geom){for(var transformGeom,transGeomList=new ArrayList,i=0;i<geom.getNumGeometries();i++)(transformGeom=this.transformPoint(geom.getGeometryN(i),geom),transformGeom!=null)&&(transformGeom.isEmpty()||transGeomList.add(transformGeom));return this.factory.buildGeometry(transGeomList)};GeometryTransformer.prototype.transformLinearRing=function(geom){var seq=this.transformCoordinates(geom.getCoordinateSequence(),geom),seqSize=seq.length;return seqSize>0&&seqSize<4&&!this.preserveType?this.factory.createLineString(seq):this.factory.createLinearRing(seq)};GeometryTransformer.prototype.transformLineString=function(geom){return this.factory.createLineString(this.transformCoordinates(geom.getCoordinateSequence(),geom))};GeometryTransformer.prototype.transformMultiLineString=function(geom){for(var transformGeom,transGeomList=new ArrayList,i=0;i<geom.getNumGeometries();i++)(transformGeom=this.transformLineString(geom.getGeometryN(i),geom),transformGeom!=null)&&(transformGeom.isEmpty()||transGeomList.add(transformGeom));return this.factory.buildGeometry(transGeomList)};GeometryTransformer.prototype.transformPolygon=function(geom){var isAllValidLinearRings=!0,shell=this.transformLinearRing(geom.getExteriorRing(),geom),holes,i,hole,components;for(shell!=null&&shell instanceof jsts.geom.LinearRing&&!shell.isEmpty()||(isAllValidLinearRings=!1),holes=new ArrayList,i=0;i<geom.getNumInteriorRing();i++)(hole=this.transformLinearRing(geom.getInteriorRingN(i),geom),hole==null||hole.isEmpty())||(hole instanceof jsts.geom.LinearRing||(isAllValidLinearRings=!1),holes.add(hole));return isAllValidLinearRings?this.factory.createPolygon(shell,holes.toArray()):(components=new ArrayList,shell!=null&&components.add(shell),components.addAll(holes),this.factory.buildGeometry(components))};GeometryTransformer.prototype.transformMultiPolygon=function(geom){for(var transformGeom,transGeomList=new ArrayList,i=0;i<geom.getNumGeometries();i++)(transformGeom=this.transformPolygon(geom.getGeometryN(i),geom),transformGeom!=null)&&(transformGeom.isEmpty()||transGeomList.add(transformGeom));return this.factory.buildGeometry(transGeomList)};GeometryTransformer.prototype.transformGeometryCollection=function(geom){for(var transformGeom,transGeomList=new ArrayList,i=0;i<geom.getNumGeometries();i++)(transformGeom=this.transform(geom.getGeometryN(i)),transformGeom!=null)&&(this.pruneEmptyGeometry&&transformGeom.isEmpty()||transGeomList.add(transformGeom));return this.preserveGeometryCollectionType?this.factory.createGeometryCollection(GeometryFactory.toGeometryArray(transGeomList)):this.factory.buildGeometry(transGeomList)};jsts.geom.util.GeometryTransformer=GeometryTransformer}(),function(){var LineStringSnapper=jsts.operation.overlay.snap.LineStringSnapper,PrecisionModel=jsts.geom.PrecisionModel,TreeSet=javascript.util.TreeSet,SnapTransformer=function(snapTolerance,snapPts,isSelfSnap){this.snapTolerance=snapTolerance;this.snapPts=snapPts;this.isSelfSnap=isSelfSnap||!1},GeometrySnapper;SnapTransformer.prototype=new jsts.geom.util.GeometryTransformer;SnapTransformer.prototype.snapTolerance=null;SnapTransformer.prototype.snapPts=null;SnapTransformer.prototype.isSelfSnap=!1;SnapTransformer.prototype.transformCoordinates=function(coords){var srcPts=coords;return this.snapLine(srcPts,this.snapPts)};SnapTransformer.prototype.snapLine=function(srcPts,snapPts){var snapper=new LineStringSnapper(srcPts,this.snapTolerance);return snapper.setAllowSnappingToSourceVertices(this.isSelfSnap),snapper.snapTo(snapPts)};GeometrySnapper=function(srcGeom){this.srcGeom=srcGeom};GeometrySnapper.SNAP_PRECISION_FACTOR=1e-9;GeometrySnapper.computeOverlaySnapTolerance=function(g){var snapTolerance,pm,fixedSnapTol;return arguments.length===2?GeometrySnapper.computeOverlaySnapTolerance2.apply(this,arguments):(snapTolerance=this.computeSizeBasedSnapTolerance(g),pm=g.getPrecisionModel(),pm.getType()==PrecisionModel.FIXED&&(fixedSnapTol=2/pm.getScale()/1.415,fixedSnapTol>snapTolerance&&(snapTolerance=fixedSnapTol)),snapTolerance)};GeometrySnapper.computeSizeBasedSnapTolerance=function(g){var env=g.getEnvelopeInternal(),minDimension=Math.min(env.getHeight(),env.getWidth());return minDimension*GeometrySnapper.SNAP_PRECISION_FACTOR};GeometrySnapper.computeOverlaySnapTolerance2=function(g0,g1){return Math.min(this.computeOverlaySnapTolerance(g0),this.computeOverlaySnapTolerance(g1))};GeometrySnapper.snap=function(g0,g1,snapTolerance){var snapGeom=[],snapper0=new GeometrySnapper(g0),snapper1;return snapGeom[0]=snapper0.snapTo(g1,snapTolerance),snapper1=new GeometrySnapper(g1),snapGeom[1]=snapper1.snapTo(snapGeom[0],snapTolerance),snapGeom};GeometrySnapper.snapToSelf=function(g0,snapTolerance,cleanResult){var snapper0=new GeometrySnapper(g0);return snapper0.snapToSelf(snapTolerance,cleanResult)};GeometrySnapper.prototype.srcGeom=null;GeometrySnapper.prototype.snapTo=function(snapGeom,snapTolerance){var snapPts=this.extractTargetCoordinates(snapGeom),snapTrans=new SnapTransformer(snapTolerance,snapPts);return snapTrans.transform(this.srcGeom)};GeometrySnapper.prototype.snapToSelf=function(snapTolerance,cleanResult){var snapPts=this.extractTargetCoordinates(srcGeom),snapTrans=new SnapTransformer(snapTolerance,snapPts,!0),snappedGeom=snapTrans.transform(srcGeom),result=snappedGeom;return cleanResult&&result instanceof Polygonal&&(result=snappedGeom.buffer(0)),result};GeometrySnapper.prototype.extractTargetCoordinates=function(g){for(var ptSet=new TreeSet,pts=g.getCoordinates(),i=0;i<pts.length;i++)ptSet.add(pts[i]);return ptSet.toArray()};GeometrySnapper.prototype.computeSnapTolerance=function(ringPts){var minSegLen=this.computeMinimumSegmentLength(ringPts);return minSegLen/10};GeometrySnapper.prototype.computeMinimumSegmentLength=function(pts){for(var segLen,minSegLen=Number.MAX_VALUE,i=0;i<pts.length-1;i++)segLen=pts[i].distance(pts[i+1]),segLen<minSegLen&&(minSegLen=segLen);return minSegLen};jsts.operation.overlay.snap.GeometrySnapper=GeometrySnapper}(),function(){var OverlayOp=jsts.operation.overlay.OverlayOp,GeometrySnapper=jsts.operation.overlay.snap.GeometrySnapper,SnapOverlayOp=function(g1,g2){this.geom=[];this.geom[0]=g1;this.geom[1]=g2;this.computeSnapTolerance()};SnapOverlayOp.overlayOp=function(g0,g1,opCode){var op=new SnapOverlayOp(g0,g1);return op.getResultGeometry(opCode)};SnapOverlayOp.intersection=function(g0,g1){return this.overlayOp(g0,g1,OverlayOp.INTERSECTION)};SnapOverlayOp.union=function(g0,g1){return this.overlayOp(g0,g1,OverlayOp.UNION)};SnapOverlayOp.difference=function(g0,g1){return overlayOp(g0,g1,OverlayOp.DIFFERENCE)};SnapOverlayOp.symDifference=function(g0,g1){return overlayOp(g0,g1,OverlayOp.SYMDIFFERENCE)};SnapOverlayOp.prototype.geom=null;SnapOverlayOp.prototype.snapTolerance=null;SnapOverlayOp.prototype.computeSnapTolerance=function(){this.snapTolerance=GeometrySnapper.computeOverlaySnapTolerance(this.geom[0],this.geom[1])};SnapOverlayOp.prototype.getResultGeometry=function(opCode){var prepGeom=this.snap(this.geom),result=OverlayOp.overlayOp(prepGeom[0],prepGeom[1],opCode);return this.prepareResult(result)};SnapOverlayOp.prototype.selfSnap=function(geom){var snapper0=new GeometrySnapper(geom);return snapper0.snapTo(geom,this.snapTolerance)};SnapOverlayOp.prototype.snap=function(geom){var remGeom=geom;return GeometrySnapper.snap(remGeom[0],remGeom[1],this.snapTolerance)};SnapOverlayOp.prototype.prepareResult=function(geom){return geom};SnapOverlayOp.prototype.cbr=null;SnapOverlayOp.prototype.removeCommonBits=function(){this.cbr=new jsts.precision.CommonBitsRemover;this.cbr.add(this.geom[0]);this.cbr.add(this.geom[1]);var remGeom=[];return remGeom[0]=cbr.removeCommonBits(this.geom[0].clone()),remGeom[1]=cbr.removeCommonBits(this.geom[1].clone()),remGeom};jsts.operation.overlay.snap.SnapOverlayOp=SnapOverlayOp}();jsts.noding.Octant=function(){throw jsts.error.AbstractMethodInvocationError();};jsts.noding.Octant.octant=function(dx,dy){if(dx instanceof jsts.geom.Coordinate)return jsts.noding.Octant.octant2.apply(this,arguments);if(dx===0&&dy===0)throw new jsts.error.IllegalArgumentError("Cannot compute the octant for point ( "+dx+", "+dy+" )");var adx=Math.abs(dx),ady=Math.abs(dy);return dx>=0?dy>=0?adx>=ady?0:1:adx>=ady?7:6:dy>=0?adx>=ady?3:2:adx>=ady?4:5};jsts.noding.Octant.octant2=function(p0,p1){var dx=p1.x-p0.x,dy=p1.y-p0.y;if(dx===0&&dy===0)throw new jsts.error.IllegalArgumentError("Cannot compute the octant for two identical points "+p0);return jsts.noding.Octant.octant(dx,dy)};jsts.operation.union.UnionInteracting=function(g0,g1){this.g0=g0;this.g1=g1;this.geomFactory=g0.getFactory();this.interacts0=[];this.interacts1=[]};jsts.operation.union.UnionInteracting.union=function(g0,g1){var uue=new jsts.operation.union.UnionInteracting(g0,g1);return uue.union()};jsts.operation.union.UnionInteracting.prototype.geomFactory=null;jsts.operation.union.UnionInteracting.prototype.g0=null;jsts.operation.union.UnionInteracting.prototype.g1=null;jsts.operation.union.UnionInteracting.prototype.interacts0=null;jsts.operation.union.UnionInteracting.prototype.interacts1=null;jsts.operation.union.UnionInteracting.prototype.union=function(){var int0,int1;this.computeInteracting();int0=this.extractElements(this.g0,this.interacts0,!0);int1=this.extractElements(this.g1,this.interacts1,!0);int0.isEmpty()||int1.isEmpty();var union=in0.union(int1),disjoint0=this.extractElements(this.g0,this.interacts0,!1),disjoint1=this.extractElements(this.g1,this.interacts1,!1);return jsts.geom.util.GeometryCombiner.combine(union,disjoint0,disjoint1)};jsts.operation.union.UnionInteracting.prototype.bufferUnion=function(g0,g1){var factory=g0.getFactory(),gColl=factory.createGeometryCollection([g0,g1]);return gColl.buffer(0)};jsts.operation.union.UnionInteracting.prototype.computeInteracting=function(elem0){var elem,interactsWithAny,i,l,elem1,interacts;if(elem0){for(interactsWithAny=!1,i=0,l=g1.getNumGeometries();i<l;i++)elem1=this.g1.getGeometryN(i),interacts=elem1.getEnvelopeInternal().intersects(elem0.getEnvelopeInternal()),interacts&&(this.interacts1[i]=!0,interactsWithAny=!0);return interactsWithAny}for(i=0,l=this.g0.getNumGeometries();i<l;i++)elem=this.g0.getGeometryN(i),this.interacts0[i]=this.computeInteracting(elem)};jsts.operation.union.UnionInteracting.prototype.extractElements=function(geom,interacts,isInteracting){for(var elem,extractedGeoms=[],i=0,l=geom.getNumGeometries();i<l;i++)elem=geom.getGeometryN(i),interacts[i]===isInteracting&&extractedGeoms.push(elem);return this.geomFactory.buildGeometry(extractedGeoms)};jsts.io.OpenLayersParser=function(geometryFactory){this.geometryFactory=geometryFactory||new jsts.geom.GeometryFactory};jsts.io.OpenLayersParser.prototype.read=function(geometry){return geometry.CLASS_NAME==="OpenLayers.Geometry.Point"?this.convertFromPoint(geometry):geometry.CLASS_NAME==="OpenLayers.Geometry.LineString"?this.convertFromLineString(geometry):geometry.CLASS_NAME==="OpenLayers.Geometry.LinearRing"?this.convertFromLinearRing(geometry):geometry.CLASS_NAME==="OpenLayers.Geometry.Polygon"?this.convertFromPolygon(geometry):geometry.CLASS_NAME==="OpenLayers.Geometry.MultiPoint"?this.convertFromMultiPoint(geometry):geometry.CLASS_NAME==="OpenLayers.Geometry.MultiLineString"?this.convertFromMultiLineString(geometry):geometry.CLASS_NAME==="OpenLayers.Geometry.MultiPolygon"?this.convertFromMultiPolygon(geometry):geometry.CLASS_NAME==="OpenLayers.Geometry.Collection"?this.convertFromCollection(geometry):void 0};jsts.io.OpenLayersParser.prototype.convertFromPoint=function(point){return this.geometryFactory.createPoint(new jsts.geom.Coordinate(point.x,point.y))};jsts.io.OpenLayersParser.prototype.convertFromLineString=function(lineString){for(var coordinates=[],i=0;i<lineString.components.length;i++)coordinates.push(new jsts.geom.Coordinate(lineString.components[i].x,lineString.components[i].y));return this.geometryFactory.createLineString(coordinates)};jsts.io.OpenLayersParser.prototype.convertFromLinearRing=function(linearRing){for(var coordinates=[],i=0;i<linearRing.components.length;i++)coordinates.push(new jsts.geom.Coordinate(linearRing.components[i].x,linearRing.components[i].y));return this.geometryFactory.createLinearRing(coordinates)};jsts.io.OpenLayersParser.prototype.convertFromPolygon=function(polygon){for(var shell=null,holes=[],linearRing,i=0;i<polygon.components.length;i++)linearRing=this.convertFromLinearRing(polygon.components[i]),i===0?shell=linearRing:holes.push(linearRing);return this.geometryFactory.createPolygon(shell,holes)};jsts.io.OpenLayersParser.prototype.convertFromMultiPoint=function(multiPoint){for(var points=[],i=0;i<multiPoint.components.length;i++)points.push(this.convertFromPoint(multiPoint.components[i]));return this.geometryFactory.createMultiPoint(points)};jsts.io.OpenLayersParser.prototype.convertFromMultiLineString=function(multiLineString){for(var lineStrings=[],i=0;i<multiLineString.components.length;i++)lineStrings.push(this.convertFromLineString(multiLineString.components[i]));return this.geometryFactory.createMultiLineString(lineStrings)};jsts.io.OpenLayersParser.prototype.convertFromMultiPolygon=function(multiPolygon){for(var polygons=[],i=0;i<multiPolygon.components.length;i++)polygons.push(this.convertFromPolygon(multiPolygon.components[i]));return this.geometryFactory.createMultiPolygon(polygons)};jsts.io.OpenLayersParser.prototype.convertFromCollection=function(collection){for(var geometries=[],i=0;i<collection.components.length;i++)geometries.push(this.convertFrom(collection.components[i]));return this.geometryFactory.createGeometryCollection(geometries)};jsts.io.OpenLayersParser.prototype.write=function(geometry){return geometry.CLASS_NAME==="jsts.geom.Point"?this.convertToPoint(geometry.coordinate):geometry.CLASS_NAME==="jsts.geom.LineString"?this.convertToLineString(geometry):geometry.CLASS_NAME==="jsts.geom.LinearRing"?this.convertToLinearRing(geometry):geometry.CLASS_NAME==="jsts.geom.Polygon"?this.convertToPolygon(geometry):geometry.CLASS_NAME==="jsts.geom.MultiPoint"?this.convertToMultiPoint(geometry):geometry.CLASS_NAME==="jsts.geom.MultiLineString"?this.convertToMultiLineString(geometry):geometry.CLASS_NAME==="jsts.geom.MultiPolygon"?this.convertToMultiPolygon(geometry):geometry.CLASS_NAME==="jsts.geom.GeometryCollection"?this.convertToCollection(geometry):void 0};jsts.io.OpenLayersParser.prototype.convertToPoint=function(coordinate){return new OpenLayers.Geometry.Point(coordinate.x,coordinate.y)};jsts.io.OpenLayersParser.prototype.convertToLineString=function(lineString){for(var points=[],coordinate,i=0;i<lineString.points.length;i++)coordinate=lineString.points[i],points.push(this.convertToPoint(coordinate));return new OpenLayers.Geometry.LineString(points)};jsts.io.OpenLayersParser.prototype.convertToLinearRing=function(linearRing){for(var points=[],coordinate,i=0;i<linearRing.points.length;i++)coordinate=linearRing.points[i],points.push(this.convertToPoint(coordinate));return new OpenLayers.Geometry.LinearRing(points)};jsts.io.OpenLayersParser.prototype.convertToPolygon=function(polygon){var i,rings=[],ring;for(rings.push(this.convertToLinearRing(polygon.shell)),i=0;i<polygon.holes.length;i++)ring=polygon.holes[i],rings.push(this.convertToLinearRing(ring));return new OpenLayers.Geometry.Polygon(rings)};jsts.io.OpenLayersParser.prototype.convertToMultiPoint=function(multiPoint){for(var points=[],coordinate,i=0;i<multiPoint.geometries.length;i++)coordinate=multiPoint.geometries[i].coordinate,points.push(new OpenLayers.Geometry.Point(coordinate.x,coordinate.y));return new OpenLayers.Geometry.MultiPoint(points)};jsts.io.OpenLayersParser.prototype.convertToMultiLineString=function(multiLineString){for(var lineStrings=[],i=0;i<multiLineString.geometries.length;i++)lineStrings.push(this.convertToLineString(multiLineString.geometries[i]));return new OpenLayers.Geometry.MultiLineString(lineStrings)};jsts.io.OpenLayersParser.prototype.convertToMultiPolygon=function(multiPolygon){for(var polygons=[],i=0;i<multiPolygon.geometries.length;i++)polygons.push(this.convertToPolygon(multiPolygon.geometries[i]));return new OpenLayers.Geometry.MultiPolygon(polygons)};jsts.io.OpenLayersParser.prototype.convertToCollection=function(geometryCollection){for(var geometries=[],geometry,geometryOpenLayers,i=0;i<geometryCollection.geometries.length;i++)geometry=geometryCollection.geometries[i],geometryOpenLayers=this.write(geometry),geometries.push(geometryOpenLayers);return new OpenLayers.Geometry.Collection(geometries)};jsts.operation.union.PointGeometryUnion=function(pointGeom,otherGeom){this.pointGeom=pointGeom;this.otherGeom=otherGeom;this.geomFact=otherGeom.getFactory()};jsts.operation.union.PointGeometryUnion.union=function(pointGeom,otherGeom){var unioner=new jsts.operation.union.PointGeometryUnion(pointGeom,otherGeom);return unioner.union()};jsts.operation.union.PointGeometryUnion.prototype.pointGeom=null;jsts.operation.union.PointGeometryUnion.prototype.otherGeom=null;jsts.operation.union.PointGeometryUnion.prototype.geomFact=null;jsts.operation.union.PointGeometryUnion.prototype.union=function(){for(var include,j,ptComp,coords,locator=new jsts.algorithm.PointLocator,exteriorCoords=[],i=0,l=this.pointGeom.getNumGeometries();i<l;i++){var point=this.pointGeom.getGeometryN(i),coord=point.getCoordinate(),loc=locator.locate(coord,this.otherGeom);if(loc===jsts.geom.Location.EXTERIOR){for(include=!0,j=exteriorCoords.length;i--;)if(exteriorCoords[j].equals(coord)){include=!1;break}include&&exteriorCoords.push(coord)}}return(exteriorCoords.sort(function(x,y){return x.compareTo(y)}),exteriorCoords.length===0)?this.otherGeom:(ptComp=null,coords=jsts.geom.CoordinateArrays.toCoordinateArray(exteriorCoords),ptComp=coords.length===1?this.geomFact.createPoint(coords[0]):this.geomFact.createMultiPoint(coords),jsts.geom.util.GeometryCombiner.combine(ptComp,this.otherGeom))};jsts.noding.IntersectionFinderAdder=function(li){this.li=li;this.interiorIntersections=new javascript.util.ArrayList};jsts.noding.IntersectionFinderAdder.prototype=new jsts.noding.SegmentIntersector;jsts.noding.IntersectionFinderAdder.constructor=jsts.noding.IntersectionFinderAdder;jsts.noding.IntersectionFinderAdder.prototype.li=null;jsts.noding.IntersectionFinderAdder.prototype.interiorIntersections=null;jsts.noding.IntersectionFinderAdder.prototype.getInteriorIntersections=function(){return this.interiorIntersections};jsts.noding.IntersectionFinderAdder.prototype.processIntersections=function(e0,segIndex0,e1,segIndex1){var intIndex;if(e0!==e1||segIndex0!==segIndex1){var p00=e0.getCoordinates()[segIndex0],p01=e0.getCoordinates()[segIndex0+1],p10=e1.getCoordinates()[segIndex1],p11=e1.getCoordinates()[segIndex1+1];if(this.li.computeIntersection(p00,p01,p10,p11),this.li.hasIntersection()&&this.li.isInteriorIntersection()){for(intIndex=0;intIndex<this.li.getIntersectionNum();intIndex++)this.interiorIntersections.add(this.li.getIntersection(intIndex));e0.addIntersections(this.li,segIndex0,0);e1.addIntersections(this.li,segIndex1,1)}}};jsts.noding.IntersectionFinderAdder.prototype.isDone=function(){return!1};jsts.operation.valid.ConnectedInteriorTester=function(geomGraph){this.geomGraph=geomGraph;this.geometryFactory=new jsts.geom.GeometryFactory;this.disconnectedRingcoord=null};jsts.operation.valid.ConnectedInteriorTester.findDifferentPoint=function(coord,pt){var i=0,il=coord.length;for(i;i<il;i++)if(!coord[i].equals(pt))return coord[i];return null};jsts.operation.valid.ConnectedInteriorTester.prototype.getCoordinate=function(){return this.disconnectedRingcoord};jsts.operation.valid.ConnectedInteriorTester.prototype.isInteriorsConnected=function(){var splitEdges=new javascript.util.ArrayList,graph,edgeRings;return this.geomGraph.computeSplitEdges(splitEdges),graph=new jsts.geomgraph.PlanarGraph(new jsts.operation.overlay.OverlayNodeFactory),graph.addEdges(splitEdges),this.setInteriorEdgesInResult(graph),graph.linkResultDirectedEdges(),edgeRings=this.buildEdgeRings(graph.getEdgeEnds()),this.visitShellInteriors(this.geomGraph.getGeometry(),graph),!this.hasUnvisitedShellEdge(edgeRings)};jsts.operation.valid.ConnectedInteriorTester.prototype.setInteriorEdgesInResult=function(graph){for(var it=graph.getEdgeEnds().iterator(),de;it.hasNext();)de=it.next(),de.getLabel().getLocation(0,jsts.geomgraph.Position.RIGHT)==jsts.geom.Location.INTERIOR&&de.setInResult(!0)};jsts.operation.valid.ConnectedInteriorTester.prototype.buildEdgeRings=function(dirEdges){for(var de,er,edgeRings=new javascript.util.ArrayList,it=dirEdges.iterator();it.hasNext();)if(de=it.next(),de.isInResult()&&de.getEdgeRing()==null){er=new jsts.operation.overlay.MaximalEdgeRing(de,this.geometryFactory);er.linkDirectedEdgesForMinimalEdgeRings();var minEdgeRings=er.buildMinimalRings(),i=0,il=minEdgeRings.length;for(i;i<il;i++)edgeRings.add(minEdgeRings[i])}return edgeRings};jsts.operation.valid.ConnectedInteriorTester.prototype.visitShellInteriors=function(g,graph){var mp,i,p;if(g instanceof jsts.geom.Polygon&&(p=g,this.visitInteriorRing(p.getExteriorRing(),graph)),g instanceof jsts.geom.MultiPolygon)for(mp=g,i=0;i<mp.getNumGeometries();i++)p=mp.getGeometryN(i),this.visitInteriorRing(p.getExteriorRing(),graph)};jsts.operation.valid.ConnectedInteriorTester.prototype.visitInteriorRing=function(ring,graph){var pts=ring.getCoordinates(),pt0=pts[0],pt1=jsts.operation.valid.ConnectedInteriorTester.findDifferentPoint(pts,pt0),e=graph.findEdgeInSameDirection(pt0,pt1),de=graph.findEdgeEnd(e),intDe=null;de.getLabel().getLocation(0,jsts.geomgraph.Position.RIGHT)==jsts.geom.Location.INTERIOR?intDe=de:de.getSym().getLabel().getLocation(0,jsts.geomgraph.Position.RIGHT)==jsts.geom.Location.INTERIOR&&(intDe=de.getSym());this.visitLinkedDirectedEdges(intDe)};jsts.operation.valid.ConnectedInteriorTester.prototype.visitLinkedDirectedEdges=function(start){var startDe=start,de=start;do de.setVisited(!0),de=de.getNext();while(de!=startDe)};jsts.operation.valid.ConnectedInteriorTester.prototype.hasUnvisitedShellEdge=function(edgeRings){for(var er,edges,de,j,i=0;i<edgeRings.size();i++)if((er=edgeRings.get(i),!er.isHole())&&(edges=er.getEdges(),de=edges[0],de.getLabel().getLocation(0,jsts.geomgraph.Position.RIGHT)==jsts.geom.Location.INTERIOR))for(j=0;j<edges.length;j++)if(de=edges[j],!de.isVisited())return disconnectedRingcoord=de.getCoordinate(),!0;return!1};jsts.algorithm.InteriorPointLine=function(geometry){this.centroid;this.minDistance=Number.MAX_VALUE;this.interiorPoint=null;this.centroid=geometry.getCentroid().getCoordinate();this.addInterior(geometry);this.interiorPoint==null&&this.addEndpoints(geometry)};jsts.algorithm.InteriorPointLine.prototype.getInteriorPoint=function(){return this.interiorPoint};jsts.algorithm.InteriorPointLine.prototype.addInterior=function(geometry){if(geometry instanceof jsts.geom.LineString)this.addInteriorCoord(geometry.getCoordinates());else if(geometry instanceof jsts.geom.GeometryCollection)for(var i=0;i<geometry.getNumGeometries();i++)this.addInterior(geometry.getGeometryN(i))};jsts.algorithm.InteriorPointLine.prototype.addInteriorCoord=function(pts){for(var i=1;i<pts.length-1;i++)this.add(pts[i])};jsts.algorithm.InteriorPointLine.prototype.addEndpoints=function(geometry){if(geometry instanceof jsts.geom.LineString)this.addEndpointsCoord(geometry.getCoordinates());else if(geometry instanceof jsts.geom.GeometryCollection)for(var i=0;i<geometry.getNumGeometries();i++)this.addEndpoints(geometry.getGeometryN(i))};jsts.algorithm.InteriorPointLine.prototype.addEndpointsCoord=function(pts){this.add(pts[0]);this.add(pts[pts.length-1])};jsts.algorithm.InteriorPointLine.prototype.add=function(point){var dist=point.distance(this.centroid);dist<this.minDistance&&(this.interiorPoint=new jsts.geom.Coordinate(point),this.minDistance=dist)};jsts.index.chain.MonotoneChainSelectAction=function(){this.tempEnv1=new jsts.geom.Envelope;this.selectedSegment=new jsts.geom.LineSegment};jsts.index.chain.MonotoneChainSelectAction.prototype.tempEnv1=null;jsts.index.chain.MonotoneChainSelectAction.prototype.selectedSegment=null;jsts.index.chain.MonotoneChainSelectAction.prototype.select=function(mc,start){mc.getLineSegment(start,this.selectedSegment);this.select2(this.selectedSegment)};jsts.index.chain.MonotoneChainSelectAction.prototype.select2=function(){};jsts.algorithm.MCPointInRing=function(ring){this.ring=ring;this.tree=null;this.crossings=0;this.interval=new jsts.index.bintree.Interval;this.buildIndex()};jsts.algorithm.MCPointInRing.MCSelecter=function(p,parent){this.parent=parent;this.p=p};jsts.algorithm.MCPointInRing.MCSelecter.prototype=new jsts.index.chain.MonotoneChainSelectAction;jsts.algorithm.MCPointInRing.MCSelecter.prototype.constructor=jsts.algorithm.MCPointInRing.MCSelecter;jsts.algorithm.MCPointInRing.MCSelecter.prototype.select2=function(ls){this.parent.testLineSegment.apply(this.parent,[this.p,ls])};jsts.algorithm.MCPointInRing.prototype.buildIndex=function(){var pts,mcList,i,mc,mcEnv;for(this.tree=new jsts.index.bintree.Bintree,pts=jsts.geom.CoordinateArrays.removeRepeatedPoints(this.ring.getCoordinates()),mcList=jsts.index.chain.MonotoneChainBuilder.getChains(pts),i=0;i<mcList.length;i++)mc=mcList[i],mcEnv=mc.getEnvelope(),this.interval.min=mcEnv.getMinY(),this.interval.max=mcEnv.getMaxY(),this.tree.insert(this.interval,mc)};jsts.algorithm.MCPointInRing.prototype.isInside=function(pt){var rayEnv,segs,mcSelecter,i,mc;for(this.crossings=0,rayEnv=new jsts.geom.Envelope(-Number.MAX_VALUE,Number.MAX_VALUE,pt.y,pt.y),this.interval.min=pt.y,this.interval.max=pt.y,segs=this.tree.query(this.interval),mcSelecter=new jsts.algorithm.MCPointInRing.MCSelecter(pt,this),i=segs.iterator();i.hasNext();)mc=i.next(),this.testMonotoneChain(rayEnv,mcSelecter,mc);return this.crossings%2==1?!0:!1};jsts.algorithm.MCPointInRing.prototype.testMonotoneChain=function(rayEnv,mcSelecter,mc){mc.select(rayEnv,mcSelecter)};jsts.algorithm.MCPointInRing.prototype.testLineSegment=function(p,seg){var xInt,x1,y1,x2,y2,p1,p2;p1=seg.p0;p2=seg.p1;x1=p1.x-p.x;y1=p1.y-p.y;x2=p2.x-p.x;y2=p2.y-p.y;(y1>0&&y2<=0||y2>0&&y1<=0)&&(xInt=jsts.algorithm.RobustDeterminant.signOfDet2x2(x1,y1,x2,y2)/(y2-y1),0<xInt&&this.crossings++)};jsts.operation.valid.TopologyValidationError=function(errorType,pt){this.errorType=errorType;this.pt=null;pt!=null&&(this.pt=pt.clone())};jsts.operation.valid.TopologyValidationError.HOLE_OUTSIDE_SHELL=2;jsts.operation.valid.TopologyValidationError.NESTED_HOLES=3;jsts.operation.valid.TopologyValidationError.DISCONNECTED_INTERIOR=4;jsts.operation.valid.TopologyValidationError.SELF_INTERSECTION=5;jsts.operation.valid.TopologyValidationError.RING_SELF_INTERSECTION=6;jsts.operation.valid.TopologyValidationError.NESTED_SHELLS=7;jsts.operation.valid.TopologyValidationError.DUPLICATE_RINGS=8;jsts.operation.valid.TopologyValidationError.TOO_FEW_POINTS=9;jsts.operation.valid.TopologyValidationError.INVALID_COORDINATE=10;jsts.operation.valid.TopologyValidationError.RING_NOT_CLOSED=11;jsts.operation.valid.TopologyValidationError.prototype.errMsg=["Topology Validation Error","Repeated Point","Hole lies outside shell","Holes are nested","Interior is disconnected","Self-intersection","Ring Self-intersection","Nested shells","Duplicate Rings","Too few distinct points in geometry component","Invalid Coordinate","Ring is not closed"];jsts.operation.valid.TopologyValidationError.prototype.getCoordinate=function(){return this.pt};jsts.operation.valid.TopologyValidationError.prototype.getErrorType=function(){return this.errorType};jsts.operation.valid.TopologyValidationError.prototype.getMessage=function(){return this.errMsg[this.errorType]};jsts.operation.valid.TopologyValidationError.prototype.toString=function(){var locStr="";return this.pt!=null?(locStr=" at or near point "+this.pt,this.getMessage()+locStr):locStr},function(){var Geometry=jsts.geom.Geometry,TreeSet=javascript.util.TreeSet,Arrays=javascript.util.Arrays;jsts.geom.GeometryCollection=function(geometries,factory){this.geometries=geometries||[];this.factory=factory};jsts.geom.GeometryCollection.prototype=new Geometry;jsts.geom.GeometryCollection.constructor=jsts.geom.GeometryCollection;jsts.geom.GeometryCollection.prototype.isEmpty=function(){for(var geometry,i=0,len=this.geometries.length;i<len;i++)if(geometry=this.getGeometryN(i),!geometry.isEmpty())return!1;return!0};jsts.geom.Geometry.prototype.getArea=function(){for(var area=0,i=0,len=this.geometries.length;i<len;i++)area+=this.getGeometryN(i).getArea();return area};jsts.geom.Geometry.prototype.getLength=function(){for(var length=0,i=0,len=this.geometries.length;i<len;i++)length+=this.getGeometryN(i).getLength();return length};jsts.geom.GeometryCollection.prototype.getCoordinate=function(){return this.isEmpty()?null:this.getGeometryN(0).getCoordinate()};jsts.geom.GeometryCollection.prototype.getCoordinates=function(){for(var geometry,childCoordinates,j,coordinates=[],k=-1,i=0,len=this.geometries.length;i<len;i++)for(geometry=this.getGeometryN(i),childCoordinates=geometry.getCoordinates(),j=0;j<childCoordinates.length;j++)k++,coordinates[k]=childCoordinates[j];return coordinates};jsts.geom.GeometryCollection.prototype.getNumGeometries=function(){return this.geometries.length};jsts.geom.GeometryCollection.prototype.getGeometryN=function(n){var geometry=this.geometries[n];return geometry instanceof jsts.geom.Coordinate&&(geometry=new jsts.geom.Point(geometry)),geometry};jsts.geom.GeometryCollection.prototype.equalsExact=function(other,tolerance){var i,len,geometry;if(!this.isEquivalentClass(other)||this.geometries.length!==other.geometries.length)return!1;for(i=0,len=this.geometries.length;i<len;i++)if(geometry=this.getGeometryN(i),!geometry.equalsExact(other.getGeometryN(i),tolerance))return!1;return!0};jsts.geom.GeometryCollection.prototype.clone=function(){for(var geometries=[],i=0,len=this.geometries.length;i<len;i++)geometries.push(this.geometries[i].clone());return this.factory.createGeometryCollection(geometries)};jsts.geom.GeometryCollection.prototype.normalize=function(){for(var i=0,len=this.geometries.length;i<len;i++)this.getGeometryN(i).normalize();this.geometries.sort()};jsts.geom.GeometryCollection.prototype.compareToSameClass=function(o){var theseElements=new TreeSet(Arrays.asList(this.geometries)),otherElements=new TreeSet(Arrays.asList(o.geometries));return this.compare(theseElements,otherElements)};jsts.geom.GeometryCollection.prototype.apply=function(filter){var i,len;if(filter instanceof jsts.geom.GeometryFilter||filter instanceof jsts.geom.GeometryComponentFilter)for(filter.filter(this),i=0,len=this.geometries.length;i<len;i++)this.getGeometryN(i).apply(filter);else if(filter instanceof jsts.geom.CoordinateFilter)for(i=0,len=this.geometries.length;i<len;i++)this.getGeometryN(i).apply(filter);else filter instanceof jsts.geom.CoordinateSequenceFilter&&this.apply2.apply(this,arguments)};jsts.geom.GeometryCollection.prototype.apply2=function(filter){if(this.geometries.length!=0){for(var i=0;i<this.geometries.length;i++)if(this.geometries[i].apply(filter),filter.isDone())break;filter.isGeometryChanged()}};jsts.geom.GeometryCollection.prototype.getDimension=function(){for(var geometry,dimension=jsts.geom.Dimension.FALSE,i=0,len=this.geometries.length;i<len;i++)geometry=this.getGeometryN(i),dimension=Math.max(dimension,geometry.getDimension());return dimension};jsts.geom.GeometryCollection.prototype.computeEnvelopeInternal=function(){for(var geometry,envelope=new jsts.geom.Envelope,i=0,len=this.geometries.length;i<len;i++)geometry=this.getGeometryN(i),envelope.expandToInclude(geometry.getEnvelopeInternal());return envelope};jsts.geom.GeometryCollection.prototype.CLASS_NAME="jsts.geom.GeometryCollection"}(),function(){jsts.geom.MultiPolygon=function(geometries,factory){this.geometries=geometries||[];this.factory=factory};jsts.geom.MultiPolygon.prototype=new jsts.geom.GeometryCollection;jsts.geom.MultiPolygon.constructor=jsts.geom.MultiPolygon;jsts.geom.MultiPolygon.prototype.getBoundary=function(){var allRings,i,polygon,rings,j;if(this.isEmpty())return this.getFactory().createMultiLineString(null);for(allRings=[],i=0;i<this.geometries.length;i++)for(polygon=this.geometries[i],rings=polygon.getBoundary(),j=0;j<rings.getNumGeometries();j++)allRings.push(rings.getGeometryN(j));return this.getFactory().createMultiLineString(allRings)};jsts.geom.MultiPolygon.prototype.equalsExact=function(other,tolerance){return this.isEquivalentClass(other)?jsts.geom.GeometryCollection.prototype.equalsExact.call(this,other,tolerance):!1};jsts.geom.MultiPolygon.prototype.CLASS_NAME="jsts.geom.MultiPolygon"}();jsts.noding.snapround.HotPixel=function(pt,scaleFactor,li){this.corner=[];this.originalPt=pt;this.pt=pt;this.scaleFactor=scaleFactor;this.li=li;this.scaleFactor!==1&&(this.pt=new jsts.geom.Coordinate(this.scale(pt.x),this.scale(pt.y)),this.p0Scaled=new jsts.geom.Coordinate,this.p1Scaled=new jsts.geom.Coordinate);this.initCorners(this.pt)};jsts.noding.snapround.HotPixel.prototype.li=null;jsts.noding.snapround.HotPixel.prototype.pt=null;jsts.noding.snapround.HotPixel.prototype.originalPt=null;jsts.noding.snapround.HotPixel.prototype.ptScaled=null;jsts.noding.snapround.HotPixel.prototype.p0Scaled=null;jsts.noding.snapround.HotPixel.prototype.p1Scaled=null;jsts.noding.snapround.HotPixel.prototype.scaleFactor=undefined;jsts.noding.snapround.HotPixel.prototype.minx=undefined;jsts.noding.snapround.HotPixel.prototype.maxx=undefined;jsts.noding.snapround.HotPixel.prototype.miny=undefined;jsts.noding.snapround.HotPixel.prototype.maxy=undefined;jsts.noding.snapround.HotPixel.prototype.corner=null;jsts.noding.snapround.HotPixel.prototype.safeEnv=null;jsts.noding.snapround.HotPixel.prototype.getCoordinate=function(){return this.originalPt};jsts.noding.snapround.HotPixel.SAFE_ENV_EXPANSION_FACTOR=.75;jsts.noding.snapround.HotPixel.prototype.getSafeEnvelope=function(){if(this.safeEnv===null){var safeTolerance=jsts.noding.snapround.HotPixel.SAFE_ENV_EXPANSION_FACTOR/this.scaleFactor;this.safeEnv=new jsts.geom.Envelope(this.originalPt.x-safeTolerance,this.originalPt.x+safeTolerance,this.originalPt.y-safeTolerance,this.originalPt.y+safeTolerance)}return this.safeEnv};jsts.noding.snapround.HotPixel.prototype.initCorners=function(pt){var tolerance=.5;this.minx=pt.x-tolerance;this.maxx=pt.x+tolerance;this.miny=pt.y-tolerance;this.maxy=pt.y+tolerance;this.corner[0]=new jsts.geom.Coordinate(this.maxx,this.maxy);this.corner[1]=new jsts.geom.Coordinate(this.minx,this.maxy);this.corner[2]=new jsts.geom.Coordinate(this.minx,this.miny);this.corner[3]=new jsts.geom.Coordinate(this.maxx,this.miny)};jsts.noding.snapround.HotPixel.prototype.scale=function(val){return Math.round(val*this.scaleFactor)};jsts.noding.snapround.HotPixel.prototype.intersects=function(p0,p1){return this.scaleFactor===1?this.intersectsScaled(p0,p1):(this.copyScaled(p0,this.p0Scaled),this.copyScaled(p1,this.p1Scaled),this.intersectsScaled(this.p0Scaled,this.p1Scaled))};jsts.noding.snapround.HotPixel.prototype.copyScaled=function(p,pScaled){pScaled.x=this.scale(p.x);pScaled.y=this.scale(p.y)};jsts.noding.snapround.HotPixel.prototype.intersectsScaled=function(p0,p1){var segMinx=Math.min(p0.x,p1.x),segMaxx=Math.max(p0.x,p1.x),segMiny=Math.min(p0.y,p1.y),segMaxy=Math.max(p0.y,p1.y),isOutsidePixelEnv=this.maxx<segMinx||this.minx>segMaxx||this.maxy<segMiny||this.miny>segMaxy,intersects;return isOutsidePixelEnv?!1:(intersects=this.intersectsToleranceSquare(p0,p1),jsts.util.Assert.isTrue(!(isOutsidePixelEnv&&intersects),"Found bad envelope test"),intersects)};jsts.noding.snapround.HotPixel.prototype.intersectsToleranceSquare=function(p0,p1){var intersectsLeft=!1,intersectsBottom=!1;return(this.li.computeIntersection(p0,p1,this.corner[0],this.corner[1]),this.li.isProper())?!0:(this.li.computeIntersection(p0,p1,this.corner[1],this.corner[2]),this.li.isProper())?!0:(this.li.hasIntersection()&&(intersectsLeft=!0),this.li.computeIntersection(p0,p1,this.corner[2],this.corner[3]),this.li.isProper())?!0:(this.li.hasIntersection()&&(intersectsBottom=!0),this.li.computeIntersection(p0,p1,this.corner[3],this.corner[0]),this.li.isProper())?!0:intersectsLeft&&intersectsBottom?!0:p0.equals(this.pt)?!0:p1.equals(this.pt)?!0:!1};jsts.noding.snapround.HotPixel.prototype.intersectsPixelClosure=function(p0,p1){return(this.li.computeIntersection(p0,p1,this.corner[0],this.corner[1]),this.li.hasIntersection())?!0:(this.li.computeIntersection(p0,p1,this.corner[1],this.corner[2]),this.li.hasIntersection())?!0:(this.li.computeIntersection(p0,p1,this.corner[2],this.corner[3]),this.li.hasIntersection())?!0:(this.li.computeIntersection(p0,p1,this.corner[3],this.corner[0]),this.li.hasIntersection())?!0:!1};jsts.noding.snapround.HotPixel.prototype.addSnappedNode=function(segStr,segIndex){var p0=segStr.getCoordinate(segIndex),p1=segStr.getCoordinate(segIndex+1);return this.intersects(p0,p1)?(segStr.addIntersection(this.getCoordinate(),segIndex),!0):!1};jsts.operation.buffer.BufferInputLineSimplifier=function(inputLine){this.inputLine=inputLine};jsts.operation.buffer.BufferInputLineSimplifier.simplify=function(inputLine,distanceTol){var simp=new jsts.operation.buffer.BufferInputLineSimplifier(inputLine);return simp.simplify(distanceTol)};jsts.operation.buffer.BufferInputLineSimplifier.INIT=0;jsts.operation.buffer.BufferInputLineSimplifier.DELETE=1;jsts.operation.buffer.BufferInputLineSimplifier.KEEP=1;jsts.operation.buffer.BufferInputLineSimplifier.prototype.inputLine=null;jsts.operation.buffer.BufferInputLineSimplifier.prototype.distanceTol=null;jsts.operation.buffer.BufferInputLineSimplifier.prototype.isDeleted=null;jsts.operation.buffer.BufferInputLineSimplifier.prototype.angleOrientation=jsts.algorithm.CGAlgorithms.COUNTERCLOCKWISE;jsts.operation.buffer.BufferInputLineSimplifier.prototype.simplify=function(distanceTol){this.distanceTol=Math.abs(distanceTol);distanceTol<0&&(this.angleOrientation=jsts.algorithm.CGAlgorithms.CLOCKWISE);this.isDeleted=[];this.isDeleted.length=this.inputLine.length;var isChanged=!1;do isChanged=this.deleteShallowConcavities();while(isChanged);return this.collapseLine()};jsts.operation.buffer.BufferInputLineSimplifier.prototype.deleteShallowConcavities=function(){for(var index=1,maxIndex=this.inputLine.length-1,midIndex=this.findNextNonDeletedIndex(index),lastIndex=this.findNextNonDeletedIndex(midIndex),isChanged=!1,isMiddleVertexDeleted;lastIndex<this.inputLine.length;)isMiddleVertexDeleted=!1,this.isDeletable(index,midIndex,lastIndex,this.distanceTol)&&(this.isDeleted[midIndex]=jsts.operation.buffer.BufferInputLineSimplifier.DELETE,isMiddleVertexDeleted=!0,isChanged=!0),index=isMiddleVertexDeleted?lastIndex:midIndex,midIndex=this.findNextNonDeletedIndex(index),lastIndex=this.findNextNonDeletedIndex(midIndex);return isChanged};jsts.operation.buffer.BufferInputLineSimplifier.prototype.findNextNonDeletedIndex=function(index){for(var next=index+1;next<this.inputLine.length&&this.isDeleted[next]===jsts.operation.buffer.BufferInputLineSimplifier.DELETE;)next++;return next};jsts.operation.buffer.BufferInputLineSimplifier.prototype.collapseLine=function(){for(var coordList=[],i=0;i<this.inputLine.length;i++)this.isDeleted[i]!==jsts.operation.buffer.BufferInputLineSimplifier.DELETE&&coordList.push(this.inputLine[i]);return coordList};jsts.operation.buffer.BufferInputLineSimplifier.prototype.isDeletable=function(i0,i1,i2,distanceTol){var p0=this.inputLine[i0],p1=this.inputLine[i1],p2=this.inputLine[i2];return this.isConcave(p0,p1,p2)?this.isShallow(p0,p1,p2,distanceTol)?this.isShallowSampled(p0,p1,i0,i2,distanceTol):!1:!1};jsts.operation.buffer.BufferInputLineSimplifier.prototype.isShallowConcavity=function(p0,p1,p2,distanceTol){var orientation=jsts.algorithm.CGAlgorithms.computeOrientation(p0,p1,p2),isAngleToSimplify=orientation===this.angleOrientation,dist;return isAngleToSimplify?(dist=jsts.algorithm.CGAlgorithms.distancePointLine(p1,p0,p2),dist<distanceTol):!1};jsts.operation.buffer.BufferInputLineSimplifier.NUM_PTS_TO_CHECK=10;jsts.operation.buffer.BufferInputLineSimplifier.prototype.isShallowSampled=function(p0,p2,i0,i2,distanceTol){var inc=parseInt((i2-i0)/jsts.operation.buffer.BufferInputLineSimplifier.NUM_PTS_TO_CHECK),i;for(inc<=0&&(inc=1),i=i0;i<i2;i+=inc)if(!this.isShallow(p0,p2,this.inputLine[i],distanceTol))return!1;return!0};jsts.operation.buffer.BufferInputLineSimplifier.prototype.isShallow=function(p0,p1,p2,distanceTol){var dist=jsts.algorithm.CGAlgorithms.distancePointLine(p1,p0,p2);return dist<distanceTol};jsts.operation.buffer.BufferInputLineSimplifier.prototype.isConcave=function(p0,p1,p2){var orientation=jsts.algorithm.CGAlgorithms.computeOrientation(p0,p1,p2);return orientation===this.angleOrientation};jsts.geom.CoordinateList=function(coord,allowRepeated){javascript.util.ArrayList.apply(this,arguments);allowRepeated=allowRepeated===undefined?!0:allowRepeated;coord!==undefined&&this.add(coord,allowRepeated)};jsts.geom.CoordinateList.prototype=new javascript.util.ArrayList;jsts.geom.CoordinateList.prototype.add=function(){return arguments.length>1?this.addCoordinates.apply(this,arguments):javascript.util.ArrayList.prototype.add.apply(this,arguments)};jsts.geom.CoordinateList.prototype.addCoordinates=function(coord,allowRepeated,direction){var i;if(coord instanceof jsts.geom.Coordinate)return this.addCoordinate.apply(this,arguments);if(typeof coord=="number")return this.insertCoordinate.apply(this,arguments);if(direction=direction||!0,direction)for(i=0;i<coord.length;i++)this.addCoordinate(coord[i],allowRepeated);else for(i=coord.length-1;i>=0;i--)this.addCoordinate(coord[i],allowRepeated);return!0};jsts.geom.CoordinateList.prototype.addCoordinate=function(coord,allowRepeated){if(!allowRepeated&&this.size()>=1){var last=this.get(this.size()-1);if(last.equals2D(coord))return}this.add(coord)};jsts.geom.CoordinateList.prototype.insertCoordinate=function(index,coord,allowRepeated){var before,after;if(!allowRepeated){if(before=index>0?index-1:-1,before!==-1&&this.get(before).equals2D(coord))return;if(after=index<this.size()-1?index+1:-1,after!==-1&&this.get(after).equals2D(coord))return}this.array.splice(index,0,coord)};jsts.geom.CoordinateList.prototype.closeRing=function(){this.size()>0&&this.addCoordinate(new jsts.geom.Coordinate(this.get(0)),!1)};jsts.geom.CoordinateList.prototype.toArray=function(){var i,il,arr;for(i=0,il=this.size(),arr=[],i;i<il;i++)arr[i]=this.get(i);return arr};jsts.geom.CoordinateList.prototype.toCoordinateArray=function(){return this.toArray()};jsts.operation.buffer.OffsetSegmentGenerator=function(precisionModel,bufParams,distance){this.seg0=new jsts.geom.LineSegment;this.seg1=new jsts.geom.LineSegment;this.offset0=new jsts.geom.LineSegment;this.offset1=new jsts.geom.LineSegment;this.precisionModel=precisionModel;this.bufParams=bufParams;this.li=new jsts.algorithm.RobustLineIntersector;this.filletAngleQuantum=Math.PI/2/bufParams.getQuadrantSegments();this.bufParams.getQuadrantSegments()>=8&&this.bufParams.getJoinStyle()===jsts.operation.buffer.BufferParameters.JOIN_ROUND&&(this.closingSegLengthFactor=jsts.operation.buffer.OffsetSegmentGenerator.MAX_CLOSING_SEG_LEN_FACTOR);this.init(distance)};jsts.operation.buffer.OffsetSegmentGenerator.OFFSET_SEGMENT_SEPARATION_FACTOR=.001;jsts.operation.buffer.OffsetSegmentGenerator.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001;jsts.operation.buffer.OffsetSegmentGenerator.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6;jsts.operation.buffer.OffsetSegmentGenerator.MAX_CLOSING_SEG_LEN_FACTOR=80;jsts.operation.buffer.OffsetSegmentGenerator.prototype.maxCurveSegmentError=0;jsts.operation.buffer.OffsetSegmentGenerator.prototype.filletAngleQuantum=null;jsts.operation.buffer.OffsetSegmentGenerator.prototype.closingSegLengthFactor=1;jsts.operation.buffer.OffsetSegmentGenerator.prototype.segList=null;jsts.operation.buffer.OffsetSegmentGenerator.prototype.distance=0;jsts.operation.buffer.OffsetSegmentGenerator.prototype.precisionModel=null;jsts.operation.buffer.OffsetSegmentGenerator.prototype.bufParams=null;jsts.operation.buffer.OffsetSegmentGenerator.prototype.li=null;jsts.operation.buffer.OffsetSegmentGenerator.prototype.s0=null;jsts.operation.buffer.OffsetSegmentGenerator.prototype.s1=null;jsts.operation.buffer.OffsetSegmentGenerator.prototype.s2=null;jsts.operation.buffer.OffsetSegmentGenerator.prototype.seg0=null;jsts.operation.buffer.OffsetSegmentGenerator.prototype.seg1=null;jsts.operation.buffer.OffsetSegmentGenerator.prototype.offset0=null;jsts.operation.buffer.OffsetSegmentGenerator.prototype.offset1=null;jsts.operation.buffer.OffsetSegmentGenerator.prototype.side=0;jsts.operation.buffer.OffsetSegmentGenerator.prototype.hasNarrowConcaveAngle=!1;jsts.operation.buffer.OffsetSegmentGenerator.prototype.hasNarrowConcaveAngle=function(){return this.hasNarrowConcaveAngle};jsts.operation.buffer.OffsetSegmentGenerator.prototype.init=function(distance){this.distance=distance;this.maxCurveSegmentError=this.distance*(1-Math.cos(this.filletAngleQuantum/2));this.segList=new jsts.operation.buffer.OffsetSegmentString;this.segList.setPrecisionModel(this.precisionModel);this.segList.setMinimumVertexDistance(this.distance*jsts.operation.buffer.OffsetSegmentGenerator.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)};jsts.operation.buffer.OffsetSegmentGenerator.prototype.initSideSegments=function(s1,s2,side){this.s1=s1;this.s2=s2;this.side=side;this.seg1.setCoordinates(this.s1,this.s2);this.computeOffsetSegment(this.seg1,this.side,this.distance,this.offset1)};jsts.operation.buffer.OffsetSegmentGenerator.prototype.getCoordinates=function(){return this.segList.getCoordinates()};jsts.operation.buffer.OffsetSegmentGenerator.prototype.closeRing=function(){this.segList.closeRing()};jsts.operation.buffer.OffsetSegmentGenerator.prototype.addSegments=function(pt,isForward){this.segList.addPts(pt,isForward)};jsts.operation.buffer.OffsetSegmentGenerator.prototype.addFirstSegment=function(){this.segList.addPt(this.offset1.p0)};jsts.operation.buffer.OffsetSegmentGenerator.prototype.addLastSegment=function(){this.segList.addPt(this.offset1.p1)};jsts.operation.buffer.OffsetSegmentGenerator.prototype.addNextSegment=function(p,addStartPoint){if(this.s0=this.s1,this.s1=this.s2,this.s2=p,this.seg0.setCoordinates(this.s0,this.s1),this.computeOffsetSegment(this.seg0,this.side,this.distance,this.offset0),this.seg1.setCoordinates(this.s1,this.s2),this.computeOffsetSegment(this.seg1,this.side,this.distance,this.offset1),!this.s1.equals(this.s2)){var orientation=jsts.algorithm.CGAlgorithms.computeOrientation(this.s0,this.s1,this.s2),outsideTurn=orientation===jsts.algorithm.CGAlgorithms.CLOCKWISE&&this.side===jsts.geomgraph.Position.LEFT||orientation===jsts.algorithm.CGAlgorithms.COUNTERCLOCKWISE&&this.side===jsts.geomgraph.Position.RIGHT;orientation==0?this.addCollinear(addStartPoint):outsideTurn?this.addOutsideTurn(orientation,addStartPoint):this.addInsideTurn(orientation,addStartPoint)}};jsts.operation.buffer.OffsetSegmentGenerator.prototype.addCollinear=function(addStartPoint){this.li.computeIntersection(this.s0,this.s1,this.s1,this.s2);var numInt=this.li.getIntersectionNum();numInt>=2&&(this.bufParams.getJoinStyle()===jsts.operation.buffer.BufferParameters.JOIN_BEVEL||this.bufParams.getJoinStyle()===jsts.operation.buffer.BufferParameters.JOIN_MITRE?(addStartPoint&&this.segList.addPt(this.offset0.p1),this.segList.addPt(this.offset1.p0)):this.addFillet(this.s1,this.offset0.p1,this.offset1.p0,jsts.algorithm.CGAlgorithms.CLOCKWISE,this.distance))};jsts.operation.buffer.OffsetSegmentGenerator.prototype.addOutsideTurn=function(orientation,addStartPoint){if(this.offset0.p1.distance(this.offset1.p0)<this.distance*jsts.operation.buffer.OffsetSegmentGenerator.OFFSET_SEGMENT_SEPARATION_FACTOR){this.segList.addPt(this.offset0.p1);return}this.bufParams.getJoinStyle()===jsts.operation.buffer.BufferParameters.JOIN_MITRE?this.addMitreJoin(this.s1,this.offset0,this.offset1,this.distance):this.bufParams.getJoinStyle()===jsts.operation.buffer.BufferParameters.JOIN_BEVEL?this.addBevelJoin(this.offset0,this.offset1):(addStartPoint&&this.segList.addPt(this.offset0.p1),this.addFillet(this.s1,this.offset0.p1,this.offset1.p0,orientation,this.distance),this.segList.addPt(this.offset1.p0))};jsts.operation.buffer.OffsetSegmentGenerator.prototype.addInsideTurn=function(){var mid0,mid1;this.li.computeIntersection(this.offset0.p0,this.offset0.p1,this.offset1.p0,this.offset1.p1);this.li.hasIntersection()?this.segList.addPt(this.li.getIntersection(0)):(this.hasNarrowConcaveAngle=!0,this.offset0.p1.distance(this.offset1.p0)<this.distance*jsts.operation.buffer.OffsetSegmentGenerator.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR?this.segList.addPt(this.offset0.p1):(this.segList.addPt(this.offset0.p1),this.closingSegLengthFactor>0?(mid0=new jsts.geom.Coordinate((this.closingSegLengthFactor*this.offset0.p1.x+this.s1.x)/(this.closingSegLengthFactor+1),(this.closingSegLengthFactor*this.offset0.p1.y+this.s1.y)/(this.closingSegLengthFactor+1)),this.segList.addPt(mid0),mid1=new jsts.geom.Coordinate((this.closingSegLengthFactor*this.offset1.p0.x+this.s1.x)/(this.closingSegLengthFactor+1),(this.closingSegLengthFactor*this.offset1.p0.y+this.s1.y)/(this.closingSegLengthFactor+1)),this.segList.addPt(mid1)):this.segList.addPt(this.s1),this.segList.addPt(this.offset1.p0)))};jsts.operation.buffer.OffsetSegmentGenerator.prototype.computeOffsetSegment=function(seg,side,distance,offset){var sideSign=side===jsts.geomgraph.Position.LEFT?1:-1,dx=seg.p1.x-seg.p0.x,dy=seg.p1.y-seg.p0.y,len=Math.sqrt(dx*dx+dy*dy),ux=sideSign*distance*dx/len,uy=sideSign*distance*dy/len;offset.p0.x=seg.p0.x-uy;offset.p0.y=seg.p0.y+ux;offset.p1.x=seg.p1.x-uy;offset.p1.y=seg.p1.y+ux};jsts.operation.buffer.OffsetSegmentGenerator.prototype.addLineEndCap=function(p0,p1){var seg=new jsts.geom.LineSegment(p0,p1),offsetL=new jsts.geom.LineSegment,offsetR,squareCapSideOffset,squareCapLOffset,squareCapROffset;this.computeOffsetSegment(seg,jsts.geomgraph.Position.LEFT,this.distance,offsetL);offsetR=new jsts.geom.LineSegment;this.computeOffsetSegment(seg,jsts.geomgraph.Position.RIGHT,this.distance,offsetR);var dx=p1.x-p0.x,dy=p1.y-p0.y,angle=Math.atan2(dy,dx);switch(this.bufParams.getEndCapStyle()){case jsts.operation.buffer.BufferParameters.CAP_ROUND:this.segList.addPt(offsetL.p1);this.addFillet(p1,angle+Math.PI/2,angle-Math.PI/2,jsts.algorithm.CGAlgorithms.CLOCKWISE,this.distance);this.segList.addPt(offsetR.p1);break;case jsts.operation.buffer.BufferParameters.CAP_FLAT:this.segList.addPt(offsetL.p1);this.segList.addPt(offsetR.p1);break;case jsts.operation.buffer.BufferParameters.CAP_SQUARE:squareCapSideOffset=new jsts.geom.Coordinate;squareCapSideOffset.x=Math.abs(this.distance)*Math.cos(angle);squareCapSideOffset.y=Math.abs(this.distance)*Math.sin(angle);squareCapLOffset=new jsts.geom.Coordinate(offsetL.p1.x+squareCapSideOffset.x,offsetL.p1.y+squareCapSideOffset.y);squareCapROffset=new jsts.geom.Coordinate(offsetR.p1.x+squareCapSideOffset.x,offsetR.p1.y+squareCapSideOffset.y);this.segList.addPt(squareCapLOffset);this.segList.addPt(squareCapROffset)}};jsts.operation.buffer.OffsetSegmentGenerator.prototype.addMitreJoin=function(p,offset0,offset1,distance){var intPt=null,mitreRatio;try{intPt=jsts.algorithm.HCoordinate.intersection(offset0.p0,offset0.p1,offset1.p0,offset1.p1);mitreRatio=distance<=0?1:intPt.distance(p)/Math.abs(distance);mitreRatio>this.bufParams.getMitreLimit()&&(this.isMitreWithinLimit=!1)}catch(e){e instanceof jsts.error.NotRepresentableError&&(intPt=new jsts.geom.Coordinate(0,0),this.isMitreWithinLimit=!1)}this.segList.addPt(intPt)};jsts.operation.buffer.OffsetSegmentGenerator.prototype.addLimitedMitreJoin=function(offset0,offset1,distance,mitreLimit){var basePt=this.seg0.p1,ang0=jsts.algorithm.Angle.angle(basePt,this.seg0.p0),ang1=jsts.algorithm.Angle.angle(basePt,this.seg1.p1),angDiff=jsts.algorithm.Angle.angleBetweenOriented(this.seg0.p0,basePt,this.seg1.p1),angDiffHalf=angDiff/2,midAng=jsts.algorithm.Angle.normalize(ang0+angDiffHalf),mitreMidAng=jsts.algorithm.Angle.normalize(midAng+Math.PI),mitreDist=mitreLimit*distance,bevelDelta=mitreDist*Math.abs(Math.sin(angDiffHalf)),bevelHalfLen=distance-bevelDelta,bevelMidX=basePt.x+mitreDist*Math.cos(mitreMidAng),bevelMidY=basePt.y+mitreDist*Math.sin(mitreMidAng),bevelMidPt=new jsts.geom.Coordinate(bevelMidX,bevelMidY),mitreMidLine=new jsts.geom.LineSegment(basePt,bevelMidPt),bevelEndLeft=mitreMidLine.pointAlongOffset(1,bevelHalfLen),bevelEndRight=mitreMidLine.pointAlongOffset(1,-bevelHalfLen);this.side==jsts.geomgraph.Position.LEFT?(this.segList.addPt(bevelEndLeft),this.segList.addPt(bevelEndRight)):(this.segList.addPt(bevelEndRight),this.segList.addPt(bevelEndLeft))};jsts.operation.buffer.OffsetSegmentGenerator.prototype.addBevelJoin=function(offset0,offset1){this.segList.addPt(offset0.p1);this.segList.addPt(offset1.p0)};jsts.operation.buffer.OffsetSegmentGenerator.prototype.addFillet=function(p,p0,p1,direction,radius){if(!(p1 instanceof jsts.geom.Coordinate)){this.addFillet2.apply(this,arguments);return}var dx0=p0.x-p.x,dy0=p0.y-p.y,startAngle=Math.atan2(dy0,dx0),dx1=p1.x-p.x,dy1=p1.y-p.y,endAngle=Math.atan2(dy1,dx1);direction===jsts.algorithm.CGAlgorithms.CLOCKWISE?startAngle<=endAngle&&(startAngle+=2*Math.PI):startAngle>=endAngle&&(startAngle-=2*Math.PI);this.segList.addPt(p0);this.addFillet(p,startAngle,endAngle,direction,radius);this.segList.addPt(p1)};jsts.operation.buffer.OffsetSegmentGenerator.prototype.addFillet2=function(p,startAngle,endAngle,direction,radius){var directionFactor=direction===jsts.algorithm.CGAlgorithms.CLOCKWISE?-1:1,totalAngle=Math.abs(startAngle-endAngle),nSegs=parseInt(totalAngle/this.filletAngleQuantum+.5),initAngle,currAngleInc,currAngle,pt,angle;if(!(nSegs<1))for(initAngle=0,currAngleInc=totalAngle/nSegs,currAngle=initAngle,pt=new jsts.geom.Coordinate;currAngle<totalAngle;)angle=startAngle+directionFactor*currAngle,pt.x=p.x+radius*Math.cos(angle),pt.y=p.y+radius*Math.sin(angle),this.segList.addPt(pt),currAngle+=currAngleInc};jsts.operation.buffer.OffsetSegmentGenerator.prototype.createCircle=function(p){var pt=new jsts.geom.Coordinate(p.x+this.distance,p.y);this.segList.addPt(pt);this.addFillet(p,0,2*Math.PI,-1,this.distance);this.segList.closeRing()};jsts.operation.buffer.OffsetSegmentGenerator.prototype.createSquare=function(p){this.segList.addPt(new jsts.geom.Coordinate(p.x+distance,p.y+distance));this.segList.addPt(new jsts.geom.Coordinate(p.x+distance,p.y-distance));this.segList.addPt(new jsts.geom.Coordinate(p.x-distance,p.y-distance));this.segList.addPt(new jsts.geom.Coordinate(p.x-distance,p.y+distance));this.segList.closeRing()};jsts.operation.overlay.MaximalEdgeRing=function(start,geometryFactory){jsts.geomgraph.EdgeRing.call(this,start,geometryFactory)};jsts.operation.overlay.MaximalEdgeRing.prototype=new jsts.geomgraph.EdgeRing;jsts.operation.overlay.MaximalEdgeRing.constructor=jsts.operation.overlay.MaximalEdgeRing;jsts.operation.overlay.MaximalEdgeRing.prototype.getNext=function(de){return de.getNext()};jsts.operation.overlay.MaximalEdgeRing.prototype.setEdgeRing=function(de,er){de.setEdgeRing(er)};jsts.operation.overlay.MaximalEdgeRing.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var de=this.startDe,node;do node=de.getNode(),node.getEdges().linkMinimalDirectedEdges(this),de=de.getNext();while(de!=this.startDe)};jsts.operation.overlay.MaximalEdgeRing.prototype.buildMinimalRings=function(){var minEdgeRings=[],de=this.startDe,minEr;do de.getMinEdgeRing()===null&&(minEr=new jsts.operation.overlay.MinimalEdgeRing(de,this.geometryFactory),minEdgeRings.push(minEr)),de=de.getNext();while(de!=this.startDe);return minEdgeRings};jsts.algorithm.CentroidPoint=function(){this.centSum=new jsts.geom.Coordinate};jsts.algorithm.CentroidPoint.prototype.ptCount=0;jsts.algorithm.CentroidPoint.prototype.centSum=null;jsts.algorithm.CentroidPoint.prototype.add=function(geom){var gc,i;if(geom instanceof jsts.geom.Point)this.add2(geom.getCoordinate());else if(geom instanceof jsts.geom.GeometryCollection||geom instanceof jsts.geom.MultiPoint||geom instanceof jsts.geom.MultiLineString||geom instanceof jsts.geom.MultiPolygon)for(gc=geom,i=0;i<gc.getNumGeometries();i++)this.add(gc.getGeometryN(i))};jsts.algorithm.CentroidPoint.prototype.add2=function(pt){this.ptCount+=1;this.centSum.x+=pt.x;this.centSum.y+=pt.y};jsts.algorithm.CentroidPoint.prototype.getCentroid=function(){var cent=new jsts.geom.Coordinate;return cent.x=this.centSum.x/this.ptCount,cent.y=this.centSum.y/this.ptCount,cent};jsts.operation.distance.ConnectedElementLocationFilter=function(locations){this.locations=locations};jsts.operation.distance.ConnectedElementLocationFilter.prototype=new jsts.geom.GeometryFilter;jsts.operation.distance.ConnectedElementLocationFilter.prototype.locations=null;jsts.operation.distance.ConnectedElementLocationFilter.getLocations=function(geom){var locations=[];return geom.apply(new jsts.operation.distance.ConnectedElementLocationFilter(locations)),locations};jsts.operation.distance.ConnectedElementLocationFilter.prototype.filter=function(geom){(geom instanceof jsts.geom.Point||geom instanceof jsts.geom.LineString||geom instanceof jsts.geom.Polygon)&&this.locations.push(new jsts.operation.distance.GeometryLocation(geom,0,geom.getCoordinate()))},function(){var ArrayList=javascript.util.ArrayList;jsts.operation.relate.EdgeEndBuilder=function(){};jsts.operation.relate.EdgeEndBuilder.prototype.computeEdgeEnds=function(edges){var l,i,e;if(arguments.length==2){this.computeEdgeEnds2.apply(this,arguments);return}for(l=new ArrayList,i=edges;i.hasNext();)e=i.next(),this.computeEdgeEnds2(e,l);return l};jsts.operation.relate.EdgeEndBuilder.prototype.computeEdgeEnds2=function(edge,l){var eiList=edge.getEdgeIntersectionList(),eiNext;eiList.addEndpoints();var it=eiList.iterator(),eiPrev=null,eiCurr=null;if(it.hasNext()){eiNext=it.next();do eiPrev=eiCurr,eiCurr=eiNext,eiNext=null,it.hasNext()&&(eiNext=it.next()),eiCurr!==null&&(this.createEdgeEndForPrev(edge,l,eiCurr,eiPrev),this.createEdgeEndForNext(edge,l,eiCurr,eiNext));while(eiCurr!==null)}};jsts.operation.relate.EdgeEndBuilder.prototype.createEdgeEndForPrev=function(edge,l,eiCurr,eiPrev){var iPrev=eiCurr.segmentIndex,pPrev,label,e;if(eiCurr.dist===0){if(iPrev===0)return;iPrev--}pPrev=edge.getCoordinate(iPrev);eiPrev!==null&&eiPrev.segmentIndex>=iPrev&&(pPrev=eiPrev.coord);label=new jsts.geomgraph.Label(edge.getLabel());label.flip();e=new jsts.geomgraph.EdgeEnd(edge,eiCurr.coord,pPrev,label);l.add(e)};jsts.operation.relate.EdgeEndBuilder.prototype.createEdgeEndForNext=function(edge,l,eiCurr,eiNext){var iNext=eiCurr.segmentIndex+1,pNext,e;iNext>=edge.getNumPoints()&&eiNext===null||(pNext=edge.getCoordinate(iNext),eiNext!==null&&eiNext.segmentIndex===eiCurr.segmentIndex&&(pNext=eiNext.coord),e=new jsts.geomgraph.EdgeEnd(edge,eiCurr.coord,pNext,new jsts.geomgraph.Label(edge.getLabel())),l.add(e))}}(),function(){jsts.io.GeoJSONParser=function(geometryFactory){this.geometryFactory=geometryFactory||new jsts.geom.GeometryFactory;this.geometryTypes=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"]};jsts.io.GeoJSONParser.prototype.read=function(json){var obj,type;if(obj=typeof json=="string"?JSON.parse(json):json,type=obj.type,!this.parse[type])throw new Error("Unknown GeoJSON type: "+obj.type);return this.geometryTypes.indexOf(type)!=-1?this.parse[type].apply(this,[obj.coordinates]):type==="GeometryCollection"?this.parse[type].apply(this,[obj.geometries]):this.parse[type].apply(this,[obj])};jsts.io.GeoJSONParser.prototype.parse={Feature:function(obj){var feature={},key,type;for(key in obj)feature[key]=obj[key];if(obj.geometry){if(type=obj.geometry.type,!this.parse[type])throw new Error("Unknown GeoJSON type: "+obj.type);feature.geometry=this.read(obj.geometry)}return obj.bbox&&(feature.bbox=this.parse.bbox.apply(this,[obj.bbox])),feature},FeatureCollection:function(obj){var featureCollection={},i;if(obj.features)for(featureCollection.features=[],i=0;i<obj.features.length;++i)featureCollection.features.push(this.read(obj.features[i]));return obj.bbox&&(featureCollection.bbox=this.parse.bbox.apply(this,[obj.bbox])),featureCollection},coordinates:function(array){for(var sub,coordinates=[],i=0;i<array.length;++i)sub=array[i],coordinates.push(new jsts.geom.Coordinate(sub[0],sub[1]));return coordinates},bbox:function(array){return this.geometryFactory.createLinearRing([new jsts.geom.Coordinate(array[0],array[1]),new jsts.geom.Coordinate(array[2],array[1]),new jsts.geom.Coordinate(array[2],array[3]),new jsts.geom.Coordinate(array[0],array[3]),new jsts.geom.Coordinate(array[0],array[1])])},Point:function(array){var coordinate=new jsts.geom.Coordinate(array[0],array[1]);return this.geometryFactory.createPoint(coordinate)},MultiPoint:function(array){for(var points=[],i=0;i<array.length;++i)points.push(this.parse.Point.apply(this,[array[i]]));return this.geometryFactory.createMultiPoint(points)},LineString:function(array){var coordinates=this.parse.coordinates.apply(this,[array]);return this.geometryFactory.createLineString(coordinates)},MultiLineString:function(array){for(var lineStrings=[],i=0;i<array.length;++i)lineStrings.push(this.parse.LineString.apply(this,[array[i]]));return this.geometryFactory.createMultiLineString(lineStrings)},Polygon:function(array){for(var shellCoordinates=this.parse.coordinates.apply(this,[array[0]]),shell=this.geometryFactory.createLinearRing(shellCoordinates),holes=[],i=1;i<array.length;++i){var hole=array[i],coordinates=this.parse.coordinates.apply(this,[hole]),linearRing=this.geometryFactory.createLinearRing(coordinates);holes.push(linearRing)}return this.geometryFactory.createPolygon(shell,holes)},MultiPolygon:function(array){for(var polygon,polygons=[],i=0;i<array.length;++i)polygon=array[i],polygons.push(this.parse.Polygon.apply(this,[polygon]));return this.geometryFactory.createMultiPolygon(polygons)},GeometryCollection:function(array){for(var geometry,geometries=[],i=0;i<array.length;++i)geometry=array[i],geometries.push(this.read(geometry));return this.geometryFactory.createGeometryCollection(geometries)}};jsts.io.GeoJSONParser.prototype.write=function(geometry){var type=geometry.CLASS_NAME.slice(10);if(!this.extract[type])throw new Error("Geometry is not supported");return this.extract[type].apply(this,[geometry])};jsts.io.GeoJSONParser.prototype.extract={coordinate:function(coordinate){return[coordinate.x,coordinate.y]},Point:function(point){var array=this.extract.coordinate.apply(this,[point.coordinate]);return{type:"Point",coordinates:array}},MultiPoint:function(multipoint){for(var point,geoJson,array=[],i=0;i<multipoint.geometries.length;++i)point=multipoint.geometries[i],geoJson=this.extract.Point.apply(this,[point]),array.push(geoJson.coordinates);return{type:"MultiPoint",coordinates:array}},LineString:function(linestring){for(var coordinate,array=[],i=0;i<linestring.points.length;++i)coordinate=linestring.points[i],array.push(this.extract.coordinate.apply(this,[coordinate]));return{type:"LineString",coordinates:array}},MultiLineString:function(multilinestring){for(var linestring,geoJson,array=[],i=0;i<multilinestring.geometries.length;++i)linestring=multilinestring.geometries[i],geoJson=this.extract.LineString.apply(this,[linestring]),array.push(geoJson.coordinates);return{type:"MultiLineString",coordinates:array}},Polygon:function(polygon){var array=[],shellGeoJson=this.extract.LineString.apply(this,[polygon.shell]),i,hole,holeGeoJson;for(array.push(shellGeoJson.coordinates),i=0;i<polygon.holes.length;++i)hole=polygon.holes[i],holeGeoJson=this.extract.LineString.apply(this,[hole]),array.push(holeGeoJson.coordinates);return{type:"Polygon",coordinates:array}},MultiPolygon:function(multipolygon){for(var polygon,geoJson,array=[],i=0;i<multipolygon.geometries.length;++i)polygon=multipolygon.geometries[i],geoJson=this.extract.Polygon.apply(this,[polygon]),array.push(geoJson.coordinates);return{type:"MultiPolygon",coordinates:array}},GeometryCollection:function(collection){for(var geometry,type,array=[],i=0;i<collection.geometries.length;++i)geometry=collection.geometries[i],type=geometry.CLASS_NAME.slice(10),array.push(this.extract[type].apply(this,[geometry]));return{type:"GeometryCollection",geometries:array}}}}();jsts.triangulate.quadedge.Vertex=function(){arguments.length===1?this.initFromCoordinate(arguments[0]):this.initFromXY(arguments[0],arguments[1])};jsts.triangulate.quadedge.Vertex.LEFT=0;jsts.triangulate.quadedge.Vertex.RIGHT=1;jsts.triangulate.quadedge.Vertex.BEYOND=2;jsts.triangulate.quadedge.Vertex.BEHIND=3;jsts.triangulate.quadedge.Vertex.BETWEEN=4;jsts.triangulate.quadedge.Vertex.ORIGIN=5;jsts.triangulate.quadedge.Vertex.DESTINATION=6;jsts.triangulate.quadedge.Vertex.prototype.initFromXY=function(x,y){this.p=new jsts.geom.Coordinate(x,y)};jsts.triangulate.quadedge.Vertex.prototype.initFromCoordinate=function(_p){this.p=new jsts.geom.Coordinate(_p)};jsts.triangulate.quadedge.Vertex.prototype.getX=function(){return this.p.x};jsts.triangulate.quadedge.Vertex.prototype.getY=function(){return this.p.y};jsts.triangulate.quadedge.Vertex.prototype.getZ=function(){return this.p.z};jsts.triangulate.quadedge.Vertex.prototype.setZ=function(z){this.p.z=z};jsts.triangulate.quadedge.Vertex.prototype.getCoordinate=function(){return this.p};jsts.triangulate.quadedge.Vertex.prototype.toString=function(){return"POINT ("+this.p.x+" "+this.p.y+")"};jsts.triangulate.quadedge.Vertex.prototype.equals=function(){return arguments.length===1?this.equalsExact(arguments[0]):this.equalsWithTolerance(arguments[0],arguments[1])};jsts.triangulate.quadedge.Vertex.prototype.equalsExact=function(other){return this.p.x===other.getX()&&this.p.y===other.getY()};jsts.triangulate.quadedge.Vertex.prototype.equalsWithTolerance=function(other,tolerance){return this.p.distance(other.getCoordinate())<tolerance};jsts.triangulate.quadedge.Vertex.prototype.classify=function(p0,p1){var p2,a,b,sa;return(p2=this,a=p1.sub(p0),b=p2.sub(p0),sa=a.crossProduct(b),sa>0)?jsts.triangulate.quadedge.Vertex.LEFT:sa<0?jsts.triangulate.quadedge.Vertex.RIGHT:a.getX()*b.getX()<0||a.getY()*b.getY()<0?jsts.triangulate.quadedge.Vertex.BEHIND:a.magn()<b.magn()?jsts.triangulate.quadedge.Vertex.BEYOND:p0.equals(p2)?jsts.triangulate.quadedge.Vertex.ORIGIN:p1.equals(p2)?jsts.triangulate.quadedge.Vertex.DESTINATION:jsts.triangulate.quadedge.Vertex.BETWEEN};jsts.triangulate.quadedge.Vertex.prototype.crossProduct=function(v){return this.p.x*v.getY()-this.p.y*v.getX()};jsts.triangulate.quadedge.Vertex.prototype.dot=function(v){return this.p.x*v.getX()+this.p.y*v.getY()};jsts.triangulate.quadedge.Vertex.prototype.times=function(c){return new jsts.triangulate.quadedge.Vertex(c*this.p.x,c*this.p.y)};jsts.triangulate.quadedge.Vertex.prototype.sum=function(v){return new jsts.triangulate.quadedge.Vertex(this.p.x+v.getX(),this.p.y+v.getY())};jsts.triangulate.quadedge.Vertex.prototype.sub=function(v){return new jsts.triangulate.quadedge.Vertex(this.p.x-v.getX(),this.p.y-v.getY())};jsts.triangulate.quadedge.Vertex.prototype.magn=function(){return Math.sqrt(this.p.x*this.p.x+this.p.y*this.p.y)};jsts.triangulate.quadedge.Vertex.prototype.cross=function(){return new Vertex(this.p.y,-this.p.x)};jsts.triangulate.quadedge.Vertex.prototype.isInCircle=function(a,b,c){return jsts.triangulate.quadedge.TrianglePredicate.isInCircleRobust(a.p,b.p,c.p,this.p)};jsts.triangulate.quadedge.Vertex.prototype.isCCW=function(b,c){return(b.p.x-this.p.x)*(c.p.y-this.p.y)-(b.p.y-this.p.y)*(c.p.x-this.p.x)>0};jsts.triangulate.quadedge.Vertex.prototype.rightOf=function(e){return this.isCCW(e.dest(),e.orig())};jsts.triangulate.quadedge.Vertex.prototype.leftOf=function(e){return this.isCCW(e.orig(),e.dest())};jsts.triangulate.quadedge.Vertex.prototype.bisector=function(a,b){var dx,dy,l1,l2;return dx=b.getX()-a.getX(),dy=b.getY()-a.getY(),l1=new jsts.algorithm.HCoordinate(a.getX()+dx/2,a.getY()+dy/2,1),l2=new jsts.algorithm.HCoordinate(a.getX()-dy+dx/2,a.getY()+dx+dy/2,1),new jsts.algorithm.HCoordinate(l1,l2)};jsts.triangulate.quadedge.Vertex.prototype.distance=function(v1,v2){return v1.p.distance(v2.p)};jsts.triangulate.quadedge.Vertex.prototype.circumRadiusRatio=function(b,c){var x,radius,edgeLength,el;return x=this.circleCenter(b,c),radius=this.distance(x,b),edgeLength=this.distance(this,b),el=this.distance(b,c),el<edgeLength&&(edgeLength=el),el=this.distance(c,this),el<edgeLength&&(edgeLength=el),radius/edgeLength};jsts.triangulate.quadedge.Vertex.prototype.midPoint=function(a){var xm,ym;return xm=(this.p.x+a.getX())/2,ym=(this.p.y+a.getY())/2,new jsts.triangulate.quadedge.Vertex(xm,ym)};jsts.triangulate.quadedge.Vertex.prototype.circleCenter=function(b,c){var a,cab,cbc,hcc,cc;a=new jsts.triangulate.quadedge.Vertex(this.getX(),this.getY());cab=this.bisector(a,b);cbc=this.bisector(b,c);hcc=new jsts.algorithm.HCoordinate(cab,cbc);cc=null;try{cc=new jsts.triangulate.quadedge.Vertex(hcc.getX(),hcc.getY())}catch(err){}return cc};jsts.operation.valid.IsValidOp=function(parentGeometry){this.parentGeometry=parentGeometry;this.isSelfTouchingRingFormingHoleValid=!1;this.validErr=null};jsts.operation.valid.IsValidOp.isValid=function(arg){if(arguments[0]instanceof jsts.geom.Coordinate)return isNaN(arg.x)?!1:!isFinite(arg.x)&&!isNaN(arg.x)?!1:isNaN(arg.y)?!1:!isFinite(arg.y)&&!isNaN(arg.y)?!1:!0;var isValidOp=new jsts.operation.valid.IsValidOp(arg);return isValidOp.isValid()};jsts.operation.valid.IsValidOp.findPtNotNode=function(testCoords,searchRing,graph){for(var pt,searchEdge=graph.findEdge(searchRing),eiList=searchEdge.getEdgeIntersectionList(),i=0;i<testCoords.length;i++)if(pt=testCoords[i],!eiList.isIntersection(pt))return pt;return null};jsts.operation.valid.IsValidOp.prototype.setSelfTouchingRingFormingHoleValid=function(isValid){this.isSelfTouchingRingFormingHoleValid=isValid};jsts.operation.valid.IsValidOp.prototype.isValid=function(){return this.checkValid(this.parentGeometry),this.validErr==null};jsts.operation.valid.IsValidOp.prototype.getValidationError=function(){return this.checkValid(this.parentGeometry),this.validErr};jsts.operation.valid.IsValidOp.prototype.checkValid=function(g){if(this.validErr=null,!g.isEmpty())if(g instanceof jsts.geom.Point)this.checkValidPoint(g);else if(g instanceof jsts.geom.MultiPoint)this.checkValidMultiPoint(g);else if(g instanceof jsts.geom.LinearRing)this.checkValidLinearRing(g);else if(g instanceof jsts.geom.LineString)this.checkValidLineString(g);else if(g instanceof jsts.geom.Polygon)this.checkValidPolygon(g);else if(g instanceof jsts.geom.MultiPolygon)this.checkValidMultiPolygon(g);else if(g instanceof jsts.geom.GeometryCollection)this.checkValidGeometryCollection(g);else throw g.constructor;};jsts.operation.valid.IsValidOp.prototype.checkValidPoint=function(g){this.checkInvalidCoordinates(g.getCoordinates())};jsts.operation.valid.IsValidOp.prototype.checkValidMultiPoint=function(g){this.checkInvalidCoordinates(g.getCoordinates())};jsts.operation.valid.IsValidOp.prototype.checkValidLineString=function(g){if(this.checkInvalidCoordinates(g.getCoordinates()),this.validErr==null){var graph=new jsts.geomgraph.GeometryGraph(0,g);this.checkTooFewPoints(graph)}};jsts.operation.valid.IsValidOp.prototype.checkValidLinearRing=function(g){var graph,li;(this.checkInvalidCoordinates(g.getCoordinates()),this.validErr==null)&&(this.checkClosedRing(g),this.validErr==null)&&(graph=new jsts.geomgraph.GeometryGraph(0,g),this.checkTooFewPoints(graph),this.validErr==null)&&(li=new jsts.algorithm.RobustLineIntersector,graph.computeSelfNodes(li,!0),this.checkNoSelfIntersectingRings(graph))};jsts.operation.valid.IsValidOp.prototype.checkValidPolygon=function(g){if((this.checkInvalidCoordinates(g),this.validErr==null)&&(this.checkClosedRings(g),this.validErr==null)){var graph=new jsts.geomgraph.GeometryGraph(0,g);(this.checkTooFewPoints(graph),this.validErr==null)&&(this.checkConsistentArea(graph),this.validErr==null)&&(this.isSelfTouchingRingFormingHoleValid||(this.checkNoSelfIntersectingRings(graph),this.validErr==null))&&(this.checkHolesInShell(g,graph),this.validErr==null)&&(this.checkHolesNotNested(g,graph),this.validErr==null)&&this.checkConnectedInteriors(graph)}};jsts.operation.valid.IsValidOp.prototype.checkValidMultiPolygon=function(g){for(var graph,p,il=g.getNumGeometries(),i=0;i<il;i++){if(p=g.getGeometryN(i),this.checkInvalidCoordinates(p),this.validErr!=null)return;if(this.checkClosedRings(p),this.validErr!=null)return}if((graph=new jsts.geomgraph.GeometryGraph(0,g),this.checkTooFewPoints(graph),this.validErr==null)&&(this.checkConsistentArea(graph),this.validErr==null)&&(this.isSelfTouchingRingFormingHoleValid||(this.checkNoSelfIntersectingRings(graph),this.validErr==null))){for(i=0;i<g.getNumGeometries();i++)if(p=g.getGeometryN(i),this.checkHolesInShell(p,graph),this.validErr!=null)return;for(i=0;i<g.getNumGeometries();i++)if(p=g.getGeometryN(i),this.checkHolesNotNested(p,graph),this.validErr!=null)return;(this.checkShellsNotNested(g,graph),this.validErr==null)&&this.checkConnectedInteriors(graph)}};jsts.operation.valid.IsValidOp.prototype.checkValidGeometryCollection=function(gc){for(var g,i=0;i<gc.getNumGeometries();i++)if(g=gc.getGeometryN(i),this.checkValid(g),this.validErr!=null)return};jsts.operation.valid.IsValidOp.prototype.checkInvalidCoordinates=function(arg){var poly,coords,i;if(arg instanceof jsts.geom.Polygon){if(poly=arg,this.checkInvalidCoordinates(poly.getExteriorRing().getCoordinates()),this.validErr!=null)return;for(i=0;i<poly.getNumInteriorRing();i++)if(this.checkInvalidCoordinates(poly.getInteriorRingN(i).getCoordinates()),this.validErr!=null)return}else for(coords=arg,i=0;i<coords.length;i++)if(!jsts.operation.valid.IsValidOp.isValid(coords[i])){this.validErr=new jsts.operation.valid.TopologyValidationError(jsts.operation.valid.TopologyValidationError.INVALID_COORDINATE,coords[i]);return}};jsts.operation.valid.IsValidOp.prototype.checkClosedRings=function(poly){if(this.checkClosedRing(poly.getExteriorRing()),this.validErr==null)for(var i=0;i<poly.getNumInteriorRing();i++)if(this.checkClosedRing(poly.getInteriorRingN(i)),this.validErr!=null)return};jsts.operation.valid.IsValidOp.prototype.checkClosedRing=function(ring){if(!ring.isClosed()){var pt=null;ring.getNumPoints()>=1&&(pt=ring.getCoordinateN(0));this.validErr=new jsts.operation.valid.TopologyValidationError(jsts.operation.valid.TopologyValidationError.RING_NOT_CLOSED,pt)}};jsts.operation.valid.IsValidOp.prototype.checkTooFewPoints=function(graph){if(graph.hasTooFewPoints){this.validErr=new jsts.operation.valid.TopologyValidationError(jsts.operation.valid.TopologyValidationError.TOO_FEW_POINTS,graph.getInvalidPoint());return}};jsts.operation.valid.IsValidOp.prototype.checkConsistentArea=function(graph){var cat=new jsts.operation.valid.ConsistentAreaTester(graph),isValidArea=cat.isNodeConsistentArea();if(!isValidArea){this.validErr=new jsts.operation.valid.TopologyValidationError(jsts.operation.valid.TopologyValidationError.SELF_INTERSECTION,cat.getInvalidPoint());return}cat.hasDuplicateRings()&&(this.validErr=new jsts.operation.valid.TopologyValidationError(jsts.operation.valid.TopologyValidationError.DUPLICATE_RINGS,cat.getInvalidPoint()))};jsts.operation.valid.IsValidOp.prototype.checkNoSelfIntersectingRings=function(graph){for(var e,i=graph.getEdgeIterator();i.hasNext();)if(e=i.next(),this.checkNoSelfIntersectingRing(e.getEdgeIntersectionList()),this.validErr!=null)return};jsts.operation.valid.IsValidOp.prototype.checkNoSelfIntersectingRing=function(eiList){for(var ei,nodeSet=[],isFirst=!0,i=eiList.iterator();i.hasNext();){if(ei=i.next(),isFirst){isFirst=!1;continue}if(nodeSet.indexOf(ei.coord)>=0){this.validErr=new jsts.operation.valid.TopologyValidationError(jsts.operation.valid.TopologyValidationError.RING_SELF_INTERSECTION,ei.coord);return}nodeSet.push(ei.coord)}};jsts.operation.valid.IsValidOp.prototype.checkHolesInShell=function(p,graph){for(var hole,holePt,outside,shell=p.getExteriorRing(),pir=new jsts.algorithm.MCPointInRing(shell),i=0;i<p.getNumInteriorRing();i++){if(hole=p.getInteriorRingN(i),holePt=jsts.operation.valid.IsValidOp.findPtNotNode(hole.getCoordinates(),shell,graph),holePt==null)return;if(outside=!pir.isInside(holePt),outside){this.validErr=new jsts.operation.valid.TopologyValidationError(jsts.operation.valid.TopologyValidationError.HOLE_OUTSIDE_SHELL,holePt);return}}};jsts.operation.valid.IsValidOp.prototype.checkHolesNotNested=function(p,graph){for(var innerHole,isNonNested,nestedTester=new jsts.operation.valid.IndexedNestedRingTester(graph),i=0;i<p.getNumInteriorRing();i++)innerHole=p.getInteriorRingN(i),nestedTester.add(innerHole);isNonNested=nestedTester.isNonNested();isNonNested||(this.validErr=new jsts.operation.valid.TopologyValidationError(jsts.operation.valid.TopologyValidationError.NESTED_HOLES,nestedTester.getNestedPoint()))};jsts.operation.valid.IsValidOp.prototype.checkShellsNotNested=function(mp,graph){for(var p,shell,j,p2,i=0;i<mp.getNumGeometries();i++)for(p=mp.getGeometryN(i),shell=p.getExteriorRing(),j=0;j<mp.getNumGeometries();j++)if(i!=j&&(p2=mp.getGeometryN(j),this.checkShellNotNested(shell,p2,graph),this.validErr!=null))return};jsts.operation.valid.IsValidOp.prototype.checkShellNotNested=function(shell,p,graph){var shellPts=shell.getCoordinates(),polyShell=p.getExteriorRing(),polyPts=polyShell.getCoordinates(),shellPt=jsts.operation.valid.IsValidOp.findPtNotNode(shellPts,polyShell,graph),insidePolyShell,badNestedPt,i,hole;if(shellPt!=null&&(insidePolyShell=jsts.algorithm.CGAlgorithms.isPointInRing(shellPt,polyPts),insidePolyShell)){if(p.getNumInteriorRing()<=0){this.validErr=new jsts.operation.valid.TopologyValidationError(jsts.operation.valid.TopologyValidationError.NESTED_SHELLS,shellPt);return}for(badNestedPt=null,i=0;i<p.getNumInteriorRing();i++)if(hole=p.getInteriorRingN(i),badNestedPt=this.checkShellInsideHole(shell,hole,graph),badNestedPt==null)return;this.validErr=new jsts.operation.valid.TopologyValidationError(jsts.operation.valid.TopologyValidationError.NESTED_SHELLS,badNestedPt)}};jsts.operation.valid.IsValidOp.prototype.checkShellInsideHole=function(shell,hole,graph){var shellPts=shell.getCoordinates(),holePts=hole.getCoordinates(),shellPt=jsts.operation.valid.IsValidOp.findPtNotNode(shellPts,hole,graph),insideHole,holePt,insideShell;return shellPt!=null&&(insideHole=jsts.algorithm.CGAlgorithms.isPointInRing(shellPt,holePts),!insideHole)?shellPt:(holePt=jsts.operation.valid.IsValidOp.findPtNotNode(holePts,shell,graph),holePt!=null)?(insideShell=jsts.algorithm.CGAlgorithms.isPointInRing(holePt,shellPts),insideShell)?holePt:null:(jsts.util.Assert.shouldNeverReachHere("points in shell and hole appear to be equal"),null)};jsts.operation.valid.IsValidOp.prototype.checkConnectedInteriors=function(graph){var cit=new jsts.operation.valid.ConnectedInteriorTester(graph);cit.isInteriorsConnected()||(this.validErr=new jsts.operation.valid.TopologyValidationError(jsts.operation.valid.TopologyValidationError.DISCONNECTED_INTERIOR,cit.getCoordinate()))};jsts.algorithm.RobustDeterminant=function(){};jsts.algorithm.RobustDeterminant.signOfDet2x2=function(x1,y1,x2,y2){var sign,swap,k,count;if(count=0,sign=1,x1===0||y2===0)return y1===0||x2===0?0:y1>0?x2>0?-sign:sign:x2>0?sign:-sign;if(y1===0||x2===0)return y2>0?x1>0?sign:-sign:x1>0?-sign:sign;if(0<y1?0<y2?y1>y2&&(sign=-sign,swap=x1,x1=x2,x2=swap,swap=y1,y1=y2,y2=swap):y1<=-y2?(sign=-sign,x2=-x2,y2=-y2):(swap=x1,x1=-x2,x2=swap,swap=y1,y1=-y2,y2=swap):0<y2?-y1<=y2?(sign=-sign,x1=-x1,y1=-y1):(swap=-x1,x1=x2,x2=swap,swap=-y1,y1=y2,y2=swap):y1>=y2?(x1=-x1,y1=-y1,x2=-x2,y2=-y2):(sign=-sign,swap=-x1,x1=-x2,x2=swap,swap=-y1,y1=-y2,y2=swap),0<x1)if(0<x2){if(x1>x2)return sign}else return sign;else{if(0<x2)return-sign;if(x1>=x2)sign=-sign,x1=-x1,x2=-x2;else return-sign}for(;;){if(count=count+1,k=Math.floor(x2/x1),x2=x2-k*x1,y2=y2-k*y1,y2<0)return-sign;if(y2>y1)return sign;if(x1>x2+x2){if(y1<y2+y2)return sign}else{if(y1>y2+y2)return-sign;x2=x1-x2;y2=y1-y2;sign=-sign}if(y2===0)return x2===0?0:-sign;if(x2===0||(k=Math.floor(x1/x2),x1=x1-k*x2,y1=y1-k*y2,y1<0))return sign;if(y1>y2)return-sign;if(x2>x1+x1){if(y2<y1+y1)return-sign}else{if(y2>y1+y1)return sign;x1=x2-x1;y1=y2-y1;sign=-sign}if(y1===0)return x1===0?0:sign;if(x1===0)return-sign}};jsts.algorithm.RobustDeterminant.orientationIndex=function(p1,p2,q){var dx1=p2.x-p1.x,dy1=p2.y-p1.y,dx2=q.x-p2.x,dy2=q.y-p2.y;return jsts.algorithm.RobustDeterminant.signOfDet2x2(dx1,dy1,dx2,dy2)},function(){jsts.triangulate.quadedge.QuadEdge=function(){this.rot=null;this.vertex=null;this.next=null;this.data=null};var QuadEdge=jsts.triangulate.quadedge.QuadEdge;jsts.triangulate.quadedge.QuadEdge.makeEdge=function(o,d){var q0,q1,q2,q3,base;return q0=new QuadEdge,q1=new QuadEdge,q2=new QuadEdge,q3=new QuadEdge,q0.rot=q1,q1.rot=q2,q2.rot=q3,q3.rot=q0,q0.setNext(q0),q1.setNext(q3),q2.setNext(q2),q3.setNext(q1),base=q0,base.setOrig(o),base.setDest(d),base};jsts.triangulate.quadedge.QuadEdge.connect=function(a,b){var e=QuadEdge.makeEdge(a.dest(),b.orig());return QuadEdge.splice(e,a.lNext()),QuadEdge.splice(e.sym(),b),e};jsts.triangulate.quadedge.QuadEdge.splice=function(a,b){var alpha,beta,t1,t2,t3,t4;alpha=a.oNext().rot;beta=b.oNext().rot;t1=b.oNext();t2=a.oNext();t3=beta.oNext();t4=alpha.oNext();a.setNext(t1);b.setNext(t2);alpha.setNext(t3);beta.setNext(t4)};jsts.triangulate.quadedge.QuadEdge.swap=function(e){var a,b;a=e.oPrev();b=e.sym().oPrev();QuadEdge.splice(e,a);QuadEdge.splice(e.sym(),b);QuadEdge.splice(e,a.lNext());QuadEdge.splice(e.sym(),b.lNext());e.setOrig(a.dest());e.setDest(b.dest())};jsts.triangulate.quadedge.QuadEdge.prototype.getPrimary=function(){return this.orig().getCoordinate().compareTo(this.dest().getCoordinate())<=0?this:this.sym()};jsts.triangulate.quadedge.QuadEdge.prototype.setData=function(data){this.data=data};jsts.triangulate.quadedge.QuadEdge.prototype.getData=function(){return this.data};jsts.triangulate.quadedge.QuadEdge.prototype.delete_jsts=function(){this.rot=null};jsts.triangulate.quadedge.QuadEdge.prototype.isLive=function(){return this.rot!==null};jsts.triangulate.quadedge.QuadEdge.prototype.setNext=function(next){this.next=next};jsts.triangulate.quadedge.QuadEdge.prototype.invRot=function(){return this.rot.sym()};jsts.triangulate.quadedge.QuadEdge.prototype.sym=function(){return this.rot.rot};jsts.triangulate.quadedge.QuadEdge.prototype.oNext=function(){return this.next};jsts.triangulate.quadedge.QuadEdge.prototype.oPrev=function(){return this.rot.next.rot};jsts.triangulate.quadedge.QuadEdge.prototype.dNext=function(){return this.sym().oNext().sym()};jsts.triangulate.quadedge.QuadEdge.prototype.dPrev=function(){return this.invRot().oNext().invRot()};jsts.triangulate.quadedge.QuadEdge.prototype.lNext=function(){return this.invRot().oNext().rot};jsts.triangulate.quadedge.QuadEdge.prototype.lPrev=function(){return this.next.sym()};jsts.triangulate.quadedge.QuadEdge.prototype.rNext=function(){return this.rot.next.invRot()};jsts.triangulate.quadedge.QuadEdge.prototype.rPrev=function(){return this.sym().oNext()};jsts.triangulate.quadedge.QuadEdge.prototype.setOrig=function(o){this.vertex=o};jsts.triangulate.quadedge.QuadEdge.prototype.setDest=function(d){this.sym().setOrig(d)};jsts.triangulate.quadedge.QuadEdge.prototype.orig=function(){return this.vertex};jsts.triangulate.quadedge.QuadEdge.prototype.dest=function(){return this.sym().orig()};jsts.triangulate.quadedge.QuadEdge.prototype.getLength=function(){return this.orig().getCoordinate().distance(dest().getCoordinate())};jsts.triangulate.quadedge.QuadEdge.prototype.equalsNonOriented=function(qe){return this.equalsOriented(qe)?!0:this.equalsOriented(qe.sym())?!0:!1};jsts.triangulate.quadedge.QuadEdge.prototype.equalsOriented=function(qe){return this.orig().getCoordinate().equals2D(qe.orig().getCoordinate())&&this.dest().getCoordinate().equals2D(qe.dest().getCoordinate())?!0:!1};jsts.triangulate.quadedge.QuadEdge.prototype.toLineSegment=function(){return new jsts.geom.LineSegment(this.vertex.getCoordinate(),this.dest().getCoordinate())};jsts.triangulate.quadedge.QuadEdge.prototype.toString=function(){var p0,p1;return p0=this.vertex.getCoordinate(),p1=this.dest().getCoordinate(),jsts.io.WKTWriter.toLineString(p0,p1)}}(),function(){var Assert=jsts.util.Assert;jsts.geomgraph.EdgeEnd=function(edge,p0,p1,label){this.edge=edge;p0&&p1&&this.init(p0,p1);label&&(this.label=label||null)};jsts.geomgraph.EdgeEnd.prototype.edge=null;jsts.geomgraph.EdgeEnd.prototype.label=null;jsts.geomgraph.EdgeEnd.prototype.node=null;jsts.geomgraph.EdgeEnd.prototype.p0=null;jsts.geomgraph.EdgeEnd.prototype.p1=null;jsts.geomgraph.EdgeEnd.prototype.dx=null;jsts.geomgraph.EdgeEnd.prototype.dy=null;jsts.geomgraph.EdgeEnd.prototype.quadrant=null;jsts.geomgraph.EdgeEnd.prototype.init=function(p0,p1){this.p0=p0;this.p1=p1;this.dx=p1.x-p0.x;this.dy=p1.y-p0.y;this.quadrant=jsts.geomgraph.Quadrant.quadrant(this.dx,this.dy);Assert.isTrue(!(this.dx===0&&this.dy===0),"EdgeEnd with identical endpoints found")};jsts.geomgraph.EdgeEnd.prototype.getEdge=function(){return this.edge};jsts.geomgraph.EdgeEnd.prototype.getLabel=function(){return this.label};jsts.geomgraph.EdgeEnd.prototype.getCoordinate=function(){return this.p0};jsts.geomgraph.EdgeEnd.prototype.getDirectedCoordinate=function(){return this.p1};jsts.geomgraph.EdgeEnd.prototype.getQuadrant=function(){return this.quadrant};jsts.geomgraph.EdgeEnd.prototype.getDx=function(){return this.dx};jsts.geomgraph.EdgeEnd.prototype.getDy=function(){return this.dy};jsts.geomgraph.EdgeEnd.prototype.setNode=function(node){this.node=node};jsts.geomgraph.EdgeEnd.prototype.getNode=function(){return this.node};jsts.geomgraph.EdgeEnd.prototype.compareTo=function(e){return this.compareDirection(e)};jsts.geomgraph.EdgeEnd.prototype.compareDirection=function(e){return this.dx===e.dx&&this.dy===e.dy?0:this.quadrant>e.quadrant?1:this.quadrant<e.quadrant?-1:jsts.algorithm.CGAlgorithms.computeOrientation(e.p0,e.p1,this.p1)};jsts.geomgraph.EdgeEnd.prototype.computeLabel=function(){}}();jsts.triangulate.quadedge.TrianglePredicate=function(){};jsts.triangulate.quadedge.TrianglePredicate.isInCircleNonRobust=function(a,b,c,p){return(a.x*a.x+a.y*a.y)*jsts.triangulate.quadedge.TrianglePredicate.triArea(b,c,p)-(b.x*b.x+b.y*b.y)*jsts.triangulate.quadedge.TrianglePredicate.triArea(a,c,p)+(c.x*c.x+c.y*c.y)*jsts.triangulate.quadedge.TrianglePredicate.triArea(a,b,p)-(p.x*p.x+p.y*p.y)*jsts.triangulate.quadedge.TrianglePredicate.triArea(a,b,c)>0};jsts.triangulate.quadedge.TrianglePredicate.isInCircleNormalized=function(a,b,c,p){var adx,ady,bdx,bdy,cdx,cdy,abdet,bcdet,cadet,alift,blift,clift,disc;return adx=a.x-p.x,ady=a.y-p.y,bdx=b.x-p.x,bdy=b.y-p.y,cdx=c.x-p.x,cdy=c.y-p.y,abdet=adx*bdy-bdx*ady,bcdet=bdx*cdy-cdx*bdy,cadet=cdx*ady-adx*cdy,alift=adx*adx+ady*ady,blift=bdx*bdx+bdy*bdy,clift=cdx*cdx+cdy*cdy,disc=alift*bcdet+blift*cadet+clift*abdet,disc>0};jsts.triangulate.quadedge.TrianglePredicate.triArea=function(a,b,c){return(b.x-a.x)*(c.y-a.y)-(b.y-a.y)*(c.x-a.x)};jsts.triangulate.quadedge.TrianglePredicate.isInCircleRobust=function(a,b,c,p){return jsts.triangulate.quadedge.TrianglePredicate.isInCircleNormalized(a,b,c,p)};jsts.triangulate.quadedge.TrianglePredicate.isInCircleDDSlow=function(a,b,c,p){var px,py,ax,ay,bx,by,cx,cy,aTerm,bTerm,cTerm,pTerm,sum;return px=jsts.math.DD.valueOf(p.x),py=jsts.math.DD.valueOf(p.y),ax=jsts.math.DD.valueOf(a.x),ay=jsts.math.DD.valueOf(a.y),bx=jsts.math.DD.valueOf(b.x),by=jsts.math.DD.valueOf(b.y),cx=jsts.math.DD.valueOf(c.x),cy=jsts.math.DD.valueOf(c.y),aTerm=ax.multiply(ax).add(ay.multiply(ay)).multiply(jsts.triangulate.quadedge.TrianglePredicate.triAreaDDSlow(bx,by,cx,cy,px,py)),bTerm=bx.multiply(bx).add(by.multiply(by)).multiply(jsts.triangulate.quadedge.TrianglePredicate.triAreaDDSlow(ax,ay,cx,cy,px,py)),cTerm=cx.multiply(cx).add(cy.multiply(cy)).multiply(jsts.triangulate.quadedge.TrianglePredicate.triAreaDDSlow(ax,ay,bx,by,px,py)),pTerm=px.multiply(px).add(py.multiply(py)).multiply(jsts.triangulate.quadedge.TrianglePredicate.triAreaDDSlow(ax,ay,bx,by,cx,cy)),sum=aTerm.subtract(bTerm).add(cTerm).subtract(pTerm),sum.doubleValue()>0};jsts.triangulate.quadedge.TrianglePredicate.triAreaDDSlow=function(ax,ay,bx,by,cx,cy){return bx.subtract(ax).multiply(cy.subtract(ay)).subtract(by.subtract(ay).multiply(cx.subtract(ax)))};jsts.triangulate.quadedge.TrianglePredicate.isInCircleDDFast=function(a,b,c,p){var aTerm,bTerm,cTerm,pTerm,sum;return aTerm=jsts.math.DD.sqr(a.x).selfAdd(jsts.math.DD.sqr(a.y)).selfMultiply(jsts.triangulate.quadedge.TrianglePredicate.triAreaDDFast(b,c,p)),bTerm=jsts.math.DD.sqr(b.x).selfAdd(jsts.math.DD.sqr(b.y)).selfMultiply(jsts.triangulate.quadedge.TrianglePredicate.triAreaDDFast(a,c,p)),cTerm=jsts.math.DD.sqr(c.x).selfAdd(jsts.math.DD.sqr(c.y)).selfMultiply(jsts.triangulate.quadedge.TrianglePredicate.triAreaDDFast(a,b,p)),pTerm=jsts.math.DD.sqr(p.x).selfAdd(jsts.math.DD.sqr(p.y)).selfMultiply(jsts.triangulate.quadedge.TrianglePredicate.triAreaDDFast(a,b,c)),sum=aTerm.selfSubtract(bTerm).selfAdd(cTerm).selfSubtract(pTerm),sum.doubleValue()>0};jsts.triangulate.quadedge.TrianglePredicate.triAreaDDFast=function(a,b,c){var t1,t2;return t1=jsts.math.DD.valueOf(b.x).selfSubtract(a.x).selfMultiply(jsts.math.DD.valueOf(c.y).selfSubtract(a.y)),t2=jsts.math.DD.valueOf(b.y).selSubtract(a.y).selfMultiply(jsts.math.DD.valueOf(c.x).selfSubtract(a.x)),t1.selfSubtract(t2)};jsts.triangulate.quadedge.TrianglePredicate.isInCircleDDNormalized=function(a,b,c,p){var adx,ady,bdx,bdy,cdx,cdy,abdet,bcdet,cadet,alift,blift,clift,sum;return adx=jsts.math.DD.valueOf(a.x).selfSubtract(p.x),ady=jsts.math.DD.valueOf(a.y).selfSubtract(p.y),bdx=jsts.math.DD.valueOf(b.x).selfSubtract(p.x),bdx=jsts.math.DD.valueOf(b.y).selfSubtract(p.y),cdx=jsts.math.DD.valueOf(c.x).selfSubtract(p.x),cdx=jsts.math.DD.valueOf(c.y).selfSubtract(p.y),abdet=adx.multiply(bdy).selfSubtract(bdx.multiply(ady)),bcdet=bdx.multiply(cdy).selfSubtract(cdx.multiply(bdy)),cadet=cdx.multiply(ady).selfSubtract(adx.multiply(cdy)),alift=adx.multiply(adx).selfAdd(ady.multiply(ady)),blift=bdx.multiply(bdx).selfAdd(bdy.multiply(bdy)),clift=cdx.multiply(cdx).selfAdd(cdy.multiply(cdy)),sum=alift.selfMultiply(bcdet).selfAdd(blift.selfMultiply(cadet)).selfAdd(clift.selfMultiply(abdet)),sum.doubleValue()>0};jsts.triangulate.quadedge.TrianglePredicate.isInCircleCC=function(a,b,c,p){var cc,ccRadius,pRadiusDiff;return cc=jsts.geom.Triangle.circumcentre(a,b,c),ccRadius=a.distance(cc),pRadiusDiff=p.distance(cc)-ccRadius,pRadiusDiff<=0};jsts.operation.buffer.RightmostEdgeFinder=function(){};jsts.operation.buffer.RightmostEdgeFinder.prototype.minIndex=-1;jsts.operation.buffer.RightmostEdgeFinder.prototype.minCoord=null;jsts.operation.buffer.RightmostEdgeFinder.prototype.minDe=null;jsts.operation.buffer.RightmostEdgeFinder.prototype.orientedDe=null;jsts.operation.buffer.RightmostEdgeFinder.prototype.getEdge=function(){return this.orientedDe};jsts.operation.buffer.RightmostEdgeFinder.prototype.getCoordinate=function(){return this.minCoord};jsts.operation.buffer.RightmostEdgeFinder.prototype.findEdge=function(dirEdgeList){for(var de,rightmostSide,i=dirEdgeList.iterator();i.hasNext();)(de=i.next(),de.isForward())&&this.checkForRightmostCoordinate(de);jsts.util.Assert.isTrue(this.minIndex!==0||this.minCoord.equals(this.minDe.getCoordinate()),"inconsistency in rightmost processing");this.minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex();this.orientedDe=this.minDe;rightmostSide=this.getRightmostSide(this.minDe,this.minIndex);rightmostSide==jsts.geomgraph.Position.LEFT&&(this.orientedDe=this.minDe.getSym())};jsts.operation.buffer.RightmostEdgeFinder.prototype.findRightmostEdgeAtNode=function(){var node=this.minDe.getNode(),star=node.getEdges();this.minDe=star.getRightmostEdge();this.minDe.isForward()||(this.minDe=this.minDe.getSym(),this.minIndex=this.minDe.getEdge().getCoordinates().length-1)};jsts.operation.buffer.RightmostEdgeFinder.prototype.findRightmostEdgeAtVertex=function(){var pts=this.minDe.getEdge().getCoordinates();jsts.util.Assert.isTrue(this.minIndex>0&&this.minIndex<pts.length,"rightmost point expected to be interior vertex of edge");var pPrev=pts[this.minIndex-1],pNext=pts[this.minIndex+1],orientation=jsts.algorithm.CGAlgorithms.computeOrientation(this.minCoord,pNext,pPrev),usePrev=!1;pPrev.y<this.minCoord.y&&pNext.y<this.minCoord.y&&orientation===jsts.algorithm.CGAlgorithms.COUNTERCLOCKWISE?usePrev=!0:pPrev.y>this.minCoord.y&&pNext.y>this.minCoord.y&&orientation===jsts.algorithm.CGAlgorithms.CLOCKWISE&&(usePrev=!0);usePrev&&(this.minIndex=this.minIndex-1)};jsts.operation.buffer.RightmostEdgeFinder.prototype.checkForRightmostCoordinate=function(de){for(var coord=de.getEdge().getCoordinates(),i=0;i<coord.length-1;i++)(this.minCoord===null||coord[i].x>this.minCoord.x)&&(this.minDe=de,this.minIndex=i,this.minCoord=coord[i])};jsts.operation.buffer.RightmostEdgeFinder.prototype.getRightmostSide=function(de,index){var side=this.getRightmostSideOfSegment(de,index);return side<0&&(side=this.getRightmostSideOfSegment(de,index-1)),side<0&&(this.minCoord=null,this.checkForRightmostCoordinate(de)),side};jsts.operation.buffer.RightmostEdgeFinder.prototype.getRightmostSideOfSegment=function(de,i){var e=de.getEdge(),coord=e.getCoordinates(),pos;return i<0||i+1>=coord.length?-1:coord[i].y==coord[i+1].y?-1:(pos=jsts.geomgraph.Position.LEFT,coord[i].y<coord[i+1].y&&(pos=jsts.geomgraph.Position.RIGHT),pos)},function(){jsts.triangulate.IncrementalDelaunayTriangulator=function(subdiv){this.subdiv=subdiv;this.isUsingTolerance=subdiv.getTolerance()>0};jsts.triangulate.IncrementalDelaunayTriangulator.prototype.insertSites=function(vertices){var i=0,il=vertices.length,v;for(i;i<il;i++)v=vertices[i],this.insertSite(v)};jsts.triangulate.IncrementalDelaunayTriangulator.prototype.insertSite=function(v){var e,base,startEdge,t;if(e=this.subdiv.locate(v),this.subdiv.isVertexOfEdge(e,v))return e;this.subdiv.isOnEdge(e,v.getCoordinate())&&(e=e.oPrev(),this.subdiv.delete_jsts(e.oNext()));base=this.subdiv.makeEdge(e.orig(),v);jsts.triangulate.quadedge.QuadEdge.splice(base,e);startEdge=base;do base=this.subdiv.connect(e,base.sym()),e=base.oPrev();while(e.lNext()!=startEdge);do if(t=e.oPrev(),t.dest().rightOf(e)&&v.isInCircle(e.orig(),t.dest(),e.dest()))jsts.triangulate.quadedge.QuadEdge.swap(e),e=e.oPrev();else{if(e.oNext()==startEdge)return base;e=e.oNext().lPrev()}while(1)}}();jsts.geomgraph.Edge=function(pts,label){this.pts=pts;this.label=label;this.eiList=new jsts.geomgraph.EdgeIntersectionList(this);this.depth=new jsts.geomgraph.Depth};jsts.geomgraph.Edge.prototype=new jsts.geomgraph.GraphComponent;jsts.geomgraph.Edge.constructor=jsts.geomgraph.Edge;jsts.geomgraph.Edge.updateIM=function(label,im){im.setAtLeastIfValid(label.getLocation(0,jsts.geomgraph.Position.ON),label.getLocation(1,jsts.geomgraph.Position.ON),1);label.isArea()&&(im.setAtLeastIfValid(label.getLocation(0,jsts.geomgraph.Position.LEFT),label.getLocation(1,jsts.geomgraph.Position.LEFT),2),im.setAtLeastIfValid(label.getLocation(0,jsts.geomgraph.Position.RIGHT),label.getLocation(1,jsts.geomgraph.Position.RIGHT),2))};jsts.geomgraph.Edge.prototype.pts=null;jsts.geomgraph.Edge.prototype.env=null;jsts.geomgraph.Edge.prototype.name=null;jsts.geomgraph.Edge.prototype.mce=null;jsts.geomgraph.Edge.prototype._isIsolated=!0;jsts.geomgraph.Edge.prototype.depth=null;jsts.geomgraph.Edge.prototype.depthDelta=0;jsts.geomgraph.Edge.prototype.eiList=null;jsts.geomgraph.Edge.prototype.getNumPoints=function(){return this.pts.length};jsts.geomgraph.Edge.prototype.getEnvelope=function(){if(this.env===null){this.env=new jsts.geom.Envelope;for(var i=0;i<this.pts.length;i++)this.env.expandToInclude(pts[i])}return env};jsts.geomgraph.Edge.prototype.getDepth=function(){return this.depth};jsts.geomgraph.Edge.prototype.getDepthDelta=function(){return this.depthDelta};jsts.geomgraph.Edge.prototype.setDepthDelta=function(depthDelta){this.depthDelta=depthDelta};jsts.geomgraph.Edge.prototype.getCoordinates=function(){return this.pts};jsts.geomgraph.Edge.prototype.getCoordinate=function(i){return i===undefined?this.pts.length>0?this.pts[0]:null:this.pts[i]};jsts.geomgraph.Edge.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])};jsts.geomgraph.Edge.prototype.setIsolated=function(isIsolated){this._isIsolated=isIsolated};jsts.geomgraph.Edge.prototype.isIsolated=function(){return this._isIsolated};jsts.geomgraph.Edge.prototype.addIntersections=function(li,segmentIndex,geomIndex){for(var i=0;i<li.getIntersectionNum();i++)this.addIntersection(li,segmentIndex,geomIndex,i)};jsts.geomgraph.Edge.prototype.addIntersection=function(li,segmentIndex,geomIndex,intIndex){var intPt=new jsts.geom.Coordinate(li.getIntersection(intIndex)),normalizedSegmentIndex=segmentIndex,dist=li.getEdgeDistance(geomIndex,intIndex),nextSegIndex=normalizedSegmentIndex+1,nextPt,ei;nextSegIndex<this.pts.length&&(nextPt=this.pts[nextSegIndex],intPt.equals2D(nextPt)&&(normalizedSegmentIndex=nextSegIndex,dist=0));ei=this.eiList.add(intPt,normalizedSegmentIndex,dist)};jsts.geomgraph.Edge.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1};jsts.geomgraph.Edge.prototype.getEdgeIntersectionList=function(){return this.eiList};jsts.geomgraph.Edge.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])};jsts.geomgraph.Edge.prototype.isCollapsed=function(){return this.label.isArea()?this.pts.length!=3?!1:this.pts[0].equals(this.pts[2])?!0:!1:!1};jsts.geomgraph.Edge.prototype.getCollapsedEdge=function(){var newPts=[];return newPts[0]=this.pts[0],newPts[1]=this.pts[1],new jsts.geomgraph.Edge(newPts,jsts.geomgraph.Label.toLineLabel(this.label))};jsts.geomgraph.Edge.prototype.computeIM=function(im){jsts.geomgraph.Edge.updateIM(this.label,im)};jsts.geomgraph.Edge.prototype.isPointwiseEqual=function(e){if(this.pts.length!=e.pts.length)return!1;for(var i=0;i<this.pts.length;i++)if(!this.pts[i].equals2D(e.pts[i]))return!1;return!0};jsts.algorithm.CentroidArea=function(){this.basePt=null;this.triangleCent3=new jsts.geom.Coordinate;this.centSum=new jsts.geom.Coordinate;this.cg3=new jsts.geom.Coordinate};jsts.algorithm.CentroidArea.prototype.basePt=null;jsts.algorithm.CentroidArea.prototype.triangleCent3=null;jsts.algorithm.CentroidArea.prototype.areasum2=0;jsts.algorithm.CentroidArea.prototype.cg3=null;jsts.algorithm.CentroidArea.prototype.centSum=null;jsts.algorithm.CentroidArea.prototype.totalLength=0;jsts.algorithm.CentroidArea.prototype.add=function(geom){var poly,gc,i;if(geom instanceof jsts.geom.Polygon)poly=geom,this.setBasePoint(poly.getExteriorRing().getCoordinateN(0)),this.add3(poly);else if(geom instanceof jsts.geom.GeometryCollection||geom instanceof jsts.geom.MultiPolygon)for(gc=geom,i=0;i<gc.getNumGeometries();i++)this.add(gc.getGeometryN(i));else geom instanceof Array&&this.add2(geom)};jsts.algorithm.CentroidArea.prototype.add2=function(ring){this.setBasePoint(ring[0]);this.addShell(ring)};jsts.algorithm.CentroidArea.prototype.getCentroid=function(){var cent=new jsts.geom.Coordinate;return Math.abs(this.areasum2)>0?(cent.x=this.cg3.x/3/this.areasum2,cent.y=this.cg3.y/3/this.areasum2):(cent.x=this.centSum.x/this.totalLength,cent.y=this.centSum.y/this.totalLength),cent};jsts.algorithm.CentroidArea.prototype.setBasePoint=function(basePt){this.basePt==null&&(this.basePt=basePt)};jsts.algorithm.CentroidArea.prototype.add3=function(poly){this.addShell(poly.getExteriorRing().getCoordinates());for(var i=0;i<poly.getNumInteriorRing();i++)this.addHole(poly.getInteriorRingN(i).getCoordinates())};jsts.algorithm.CentroidArea.prototype.addShell=function(pts){for(var isPositiveArea=!jsts.algorithm.CGAlgorithms.isCCW(pts),i=0;i<pts.length-1;i++)this.addTriangle(this.basePt,pts[i],pts[i+1],isPositiveArea);this.addLinearSegments(pts)};jsts.algorithm.CentroidArea.prototype.addHole=function(pts){for(var isPositiveArea=jsts.algorithm.CGAlgorithms.isCCW(pts),i=0;i<pts.length-1;i++)this.addTriangle(this.basePt,pts[i],pts[i+1],isPositiveArea);this.addLinearSegments(pts)};jsts.algorithm.CentroidArea.prototype.addTriangle=function(p0,p1,p2,isPositiveArea){var sign=isPositiveArea?1:-1,area2;jsts.algorithm.CentroidArea.centroid3(p0,p1,p2,this.triangleCent3);area2=jsts.algorithm.CentroidArea.area2(p0,p1,p2);this.cg3.x+=sign*area2*this.triangleCent3.x;this.cg3.y+=sign*area2*this.triangleCent3.y;this.areasum2+=sign*area2};jsts.algorithm.CentroidArea.centroid3=function(p1,p2,p3,c){c.x=p1.x+p2.x+p3.x;c.y=p1.y+p2.y+p3.y;return};jsts.algorithm.CentroidArea.area2=function(p1,p2,p3){return(p2.x-p1.x)*(p3.y-p1.y)-(p3.x-p1.x)*(p2.y-p1.y)};jsts.algorithm.CentroidArea.prototype.addLinearSegments=function(pts){for(var segmentLen,midx,midy,i=0;i<pts.length-1;i++)segmentLen=pts[i].distance(pts[i+1]),this.totalLength+=segmentLen,midx=(pts[i].x+pts[i+1].x)/2,this.centSum.x+=segmentLen*midx,midy=(pts[i].y+pts[i+1].y)/2,this.centSum.y+=segmentLen*midy};jsts.index.quadtree.Root=function(){jsts.index.quadtree.NodeBase.prototype.constructor.apply(this,arguments);this.origin=new jsts.geom.Coordinate(0,0)};jsts.index.quadtree.Root.prototype=new jsts.index.quadtree.NodeBase;jsts.index.quadtree.Root.prototype.insert=function(itemEnv,item){var index=this.getSubnodeIndex(itemEnv,this.origin),node,largerNode;if(index===-1){this.add(item);return}node=this.subnode[index];node!==null&&node.getEnvelope().contains(itemEnv)||(largerNode=jsts.index.quadtree.Node.createExpanded(node,itemEnv),this.subnode[index]=largerNode);this.insertContained(this.subnode[index],itemEnv,item)};jsts.index.quadtree.Root.prototype.insertContained=function(tree,itemEnv,item){var isZeroX,isZeroY,node;isZeroX=jsts.index.IntervalSize.isZeroWidth(itemEnv.getMinX(),itemEnv.getMaxX());isZeroY=jsts.index.IntervalSize.isZeroWidth(itemEnv.getMinY(),itemEnv.getMaxY());node=isZeroX||isZeroY?tree.find(itemEnv):tree.getNode(itemEnv);node.add(item)};jsts.index.quadtree.Root.prototype.isSearchMatch=function(){return!0};jsts.noding.SegmentNodeList=function(edge){this.nodeMap=new javascript.util.TreeMap;this.edge=edge};jsts.noding.SegmentNodeList.prototype.nodeMap=null;jsts.noding.SegmentNodeList.prototype.iterator=function(){return this.nodeMap.values().iterator()};jsts.noding.SegmentNodeList.prototype.edge=null;jsts.noding.SegmentNodeList.prototype.getEdge=function(){return this.edge};jsts.noding.SegmentNodeList.prototype.add=function(intPt,segmentIndex){var eiNew=new jsts.noding.SegmentNode(this.edge,intPt,segmentIndex,this.edge.getSegmentOctant(segmentIndex)),ei=this.nodeMap.get(eiNew);return ei!==null?(jsts.util.Assert.isTrue(ei.coord.equals2D(intPt),"Found equal nodes with different coordinates"),ei):(this.nodeMap.put(eiNew,eiNew),eiNew)};jsts.noding.SegmentNodeList.prototype.addEndpoints=function(){var maxSegIndex=this.edge.size()-1;this.add(this.edge.getCoordinate(0),0);this.add(this.edge.getCoordinate(maxSegIndex),maxSegIndex)};jsts.noding.SegmentNodeList.prototype.addCollapsedNodes=function(){var collapsedVertexIndexes=[],i,vertexIndex;for(this.findCollapsesFromInsertedNodes(collapsedVertexIndexes),this.findCollapsesFromExistingVertices(collapsedVertexIndexes),i=0;i<collapsedVertexIndexes.length;i++)vertexIndex=collapsedVertexIndexes[i],this.add(this.edge.getCoordinate(vertexIndex),vertexIndex)};jsts.noding.SegmentNodeList.prototype.findCollapsesFromExistingVertices=function(collapsedVertexIndexes){for(var i=0;i<this.edge.size()-2;i++){var p0=this.edge.getCoordinate(i),p1=this.edge.getCoordinate(i+1),p2=this.edge.getCoordinate(i+2);p0.equals2D(p2)&&collapsedVertexIndexes.push(i+1)}};jsts.noding.SegmentNodeList.prototype.findCollapsesFromInsertedNodes=function(collapsedVertexIndexes){for(var collapsedVertexIndex=[null],it=this.iterator(),eiPrev=it.next(),ei,isCollapsed;it.hasNext();)ei=it.next(),isCollapsed=this.findCollapseIndex(eiPrev,ei,collapsedVertexIndex),isCollapsed&&collapsedVertexIndexes.push(collapsedVertexIndex[0]),eiPrev=ei};jsts.noding.SegmentNodeList.prototype.findCollapseIndex=function(ei0,ei1,collapsedVertexIndex){if(!ei0.coord.equals2D(ei1.coord))return!1;var numVerticesBetween=ei1.segmentIndex-ei0.segmentIndex;return(ei1.isInterior()||numVerticesBetween--,numVerticesBetween===1)?(collapsedVertexIndex[0]=ei0.segmentIndex+1,!0):!1};jsts.noding.SegmentNodeList.prototype.addSplitEdges=function(edgeList){var it,eiPrev,ei,newEdge;for(this.addEndpoints(),this.addCollapsedNodes(),it=this.iterator(),eiPrev=it.next();it.hasNext();)ei=it.next(),newEdge=this.createSplitEdge(eiPrev,ei),edgeList.add(newEdge),eiPrev=ei};jsts.noding.SegmentNodeList.prototype.checkSplitEdgesCorrectness=function(splitEdges){var edgePts=edge.getCoordinates(),split0=splitEdges[0],pt0=split0.getCoordinate(0);if(!pt0.equals2D(edgePts[0]))throw new Error("bad split edge start point at "+pt0);var splitn=splitEdges[splitEdges.length-1],splitnPts=splitn.getCoordinates(),ptn=splitnPts[splitnPts.length-1];if(!ptn.equals2D(edgePts[edgePts.length-1]))throw new Error("bad split edge end point at "+ptn);};jsts.noding.SegmentNodeList.prototype.createSplitEdge=function(ei0,ei1){var npts=ei1.segmentIndex-ei0.segmentIndex+2,lastSegStartPt=this.edge.getCoordinate(ei1.segmentIndex),useIntPt1=ei1.isInterior()||!ei1.coord.equals2D(lastSegStartPt),pts,ipt,i;for(useIntPt1||npts--,pts=[],ipt=0,pts[ipt++]=new jsts.geom.Coordinate(ei0.coord),i=ei0.segmentIndex+1;i<=ei1.segmentIndex;i++)pts[ipt++]=this.edge.getCoordinate(i);return useIntPt1&&(pts[ipt]=ei1.coord),new jsts.noding.NodedSegmentString(pts,this.edge.getData())};jsts.operation.union.CascadedPolygonUnion=function(polys){this.inputPolys=polys};jsts.operation.union.CascadedPolygonUnion.union=function(polys){var op=new jsts.operation.union.CascadedPolygonUnion(polys);return op.union()};jsts.operation.union.CascadedPolygonUnion.prototype.inputPolys;jsts.operation.union.CascadedPolygonUnion.prototype.geomFactory=null;jsts.operation.union.CascadedPolygonUnion.prototype.STRTREE_NODE_CAPACITY=4;jsts.operation.union.CascadedPolygonUnion.prototype.union=function(){var index,i,l,item,itemTree,unionAll;if(this.inputPolys.length===0)return null;for(this.geomFactory=this.inputPolys[0].getFactory(),index=new jsts.index.strtree.STRtree(this.STRTREE_NODE_CAPACITY),i=0,l=this.inputPolys.length;i<l;i++)item=this.inputPolys[i],index.insert(item.getEnvelopeInternal(),item);return itemTree=index.itemsTree(),unionAll=this.unionTree(itemTree),unionAll};jsts.operation.union.CascadedPolygonUnion.prototype.unionTree=function(geomTree){var geoms=this.reduceToGeometries(geomTree);return this.binaryUnion(geoms)};jsts.operation.union.CascadedPolygonUnion.prototype.binaryUnion=function(geoms,start,end){var g0;if(start=start||0,end=end||geoms.length,end-start<=1)return g0=this.getGeometry(geoms,start),this.unionSafe(g0,null);if(end-start==2)return this.unionSafe(this.getGeometry(geoms,start),this.getGeometry(geoms,start+1));var mid=parseInt((end+start)/2),g0=this.binaryUnion(geoms,start,mid),g1=this.binaryUnion(geoms,mid,end);return this.unionSafe(g0,g1)};jsts.operation.union.CascadedPolygonUnion.prototype.getGeometry=function(list,index){return index>=list.length?null:list[index]};jsts.operation.union.CascadedPolygonUnion.prototype.reduceToGeometries=function(geomTree){for(var o,geom,geoms=[],i=0,l=geomTree.length;i<l;i++)o=geomTree[i],geom=null,o instanceof Array?geom=this.unionTree(o):o instanceof jsts.geom.Geometry&&(geom=o),geoms.push(geom);return geoms};jsts.operation.union.CascadedPolygonUnion.prototype.unionSafe=function(g0,g1){return g0===null&&g1===null?null:g0===null?g1.clone():g1===null?g0.clone():this.unionOptimized(g0,g1)};jsts.operation.union.CascadedPolygonUnion.prototype.unionOptimized=function(g0,g1){var g0Env=g0.getEnvelopeInternal(),g1Env=g1.getEnvelopeInternal(),commonEnv;return g0Env.intersects(g1Env)?g0.getNumGeometries<=1&&g1.getNumGeometries<=1?this.unionActual(g0,g1):(commonEnv=g0Env.intersection(g1Env),this.unionUsingEnvelopeIntersection(g0,g1,commonEnv)):jsts.geom.util.GeometryCombiner.combine(g0,g1)};jsts.operation.union.CascadedPolygonUnion.prototype.unionUsingEnvelopeIntersection=function(g0,g1,common){var disjointPolys=new javascript.util.ArrayList,g0Int=this.extractByEnvelope(common,g0,disjointPolys),g1Int=this.extractByEnvelope(common,g1,disjointPolys),union=this.unionActual(g0Int,g1Int);return disjointPolys.add(union),jsts.geom.util.GeometryCombiner.combine(disjointPolys)};jsts.operation.union.CascadedPolygonUnion.prototype.extractByEnvelope=function(env,geom,disjointGeoms){for(var elem,intersectingGeoms=new javascript.util.ArrayList,i=0;i<geom.getNumGeometries();i++)elem=geom.getGeometryN(i),elem.getEnvelopeInternal().intersects(env)?intersectingGeoms.add(elem):disjointGeoms.add(elem);return this.geomFactory.buildGeometry(intersectingGeoms)};jsts.operation.union.CascadedPolygonUnion.prototype.unionActual=function(g0,g1){return g0.union(g1)},function(){jsts.geom.MultiPoint=function(points,factory){this.geometries=points||[];this.factory=factory};jsts.geom.MultiPoint.prototype=new jsts.geom.GeometryCollection;jsts.geom.MultiPoint.constructor=jsts.geom.MultiPoint;jsts.geom.MultiPoint.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)};jsts.geom.MultiPoint.prototype.getGeometryN=function(n){return this.geometries[n]};jsts.geom.MultiPoint.prototype.equalsExact=function(other,tolerance){return this.isEquivalentClass(other)?jsts.geom.GeometryCollection.prototype.equalsExact.call(this,other,tolerance):!1};jsts.geom.MultiPoint.prototype.CLASS_NAME="jsts.geom.MultiPoint"}();jsts.operation.distance.DistanceOp=function(g0,g1,terminateDistance){this.ptLocator=new jsts.algorithm.PointLocator;this.geom=[];this.geom[0]=g0;this.geom[1]=g1;this.terminateDistance=terminateDistance};jsts.operation.distance.DistanceOp.prototype.geom=null;jsts.operation.distance.DistanceOp.prototype.terminateDistance=0;jsts.operation.distance.DistanceOp.prototype.ptLocator=null;jsts.operation.distance.DistanceOp.prototype.minDistanceLocation=null;jsts.operation.distance.DistanceOp.prototype.minDistance=Number.MAX_VALUE;jsts.operation.distance.DistanceOp.distance=function(g0,g1){var distOp=new jsts.operation.distance.DistanceOp(g0,g1,0);return distOp.distance()};jsts.operation.distance.DistanceOp.isWithinDistance=function(g0,g1,distance){var distOp=new jsts.operation.distance.DistanceOp(g0,g1,distance);return distOp.distance()<=distance};jsts.operation.distance.DistanceOp.nearestPoints=function(g0,g1){var distOp=new jsts.operation.distance.DistanceOp(g0,g1,0);return distOp.nearestPoints()};jsts.operation.distance.DistanceOp.prototype.distance=function(){if(this.geom[0]===null||this.geom[1]===null)throw new jsts.error.IllegalArgumentError("null geometries are not supported");return this.geom[0].isEmpty()||this.geom[1].isEmpty()?0:(this.computeMinDistance(),this.minDistance)};jsts.operation.distance.DistanceOp.prototype.nearestPoints=function(){this.computeMinDistance();return[this.minDistanceLocation[0].getCoordinate(),this.minDistanceLocation[1].getCoordinate()]};jsts.operation.distance.DistanceOp.prototype.nearestLocations=function(){return this.computeMinDistance(),this.minDistanceLocation};jsts.operation.distance.DistanceOp.prototype.updateMinDistance=function(locGeom,flip){locGeom[0]!==null&&(flip?(this.minDistanceLocation[0]=locGeom[1],this.minDistanceLocation[1]=locGeom[0]):(this.minDistanceLocation[0]=locGeom[0],this.minDistanceLocation[1]=locGeom[1]))};jsts.operation.distance.DistanceOp.prototype.computeMinDistance=function(){if(arguments.length>0){this.computeMinDistance2.apply(this,arguments);return}this.minDistanceLocation===null&&((this.minDistanceLocation=[],this.computeContainmentDistance(),this.minDistance<=this.terminateDistance)||this.computeFacetDistance())};jsts.operation.distance.DistanceOp.prototype.computeContainmentDistance=function(){if(arguments.length===2){this.computeContainmentDistance2.apply(this,arguments);return}if(arguments.length===3&&!arguments[0]instanceof jsts.operation.distance.GeometryLocation){this.computeContainmentDistance3.apply(this,arguments);return}if(arguments.length===3){this.computeContainmentDistance4.apply(this,arguments);return}var locPtPoly=[];(this.computeContainmentDistance2(0,locPtPoly),this.minDistance<=this.terminateDistance)||this.computeContainmentDistance2(1,locPtPoly)};jsts.operation.distance.DistanceOp.prototype.computeContainmentDistance2=function(polyGeomIndex,locPtPoly){var locationsIndex=1-polyGeomIndex,polys=jsts.geom.util.PolygonExtracter.getPolygons(this.geom[polyGeomIndex]),insideLocs;if(polys.length>0&&(insideLocs=jsts.operation.distance.ConnectedElementLocationFilter.getLocations(this.geom[locationsIndex]),this.computeContainmentDistance3(insideLocs,polys,locPtPoly),this.minDistance<=this.terminateDistance)){this.minDistanceLocation[locationsIndex]=locPtPoly[0];this.minDistanceLocation[polyGeomIndex]=locPtPoly[1];return}};jsts.operation.distance.DistanceOp.prototype.computeContainmentDistance3=function(locs,polys,locPtPoly){for(var loc,j,i=0;i<locs.length;i++)for(loc=locs[i],j=0;j<polys.length;j++)if(this.computeContainmentDistance4(loc,polys[j],locPtPoly),this.minDistance<=this.terminateDistance)return};jsts.operation.distance.DistanceOp.prototype.computeContainmentDistance4=function(ptLoc,poly,locPtPoly){var pt=ptLoc.getCoordinate();if(jsts.geom.Location.EXTERIOR!==this.ptLocator.locate(pt,poly)){this.minDistance=0;locPtPoly[0]=ptLoc;locPtPoly[1]=new jsts.operation.distance.GeometryLocation(poly,pt);return}};jsts.operation.distance.DistanceOp.prototype.computeFacetDistance=function(){var locGeom=[],lines0=jsts.geom.util.LinearComponentExtracter.getLines(this.geom[0]),lines1=jsts.geom.util.LinearComponentExtracter.getLines(this.geom[1]),pts0=jsts.geom.util.PointExtracter.getPoints(this.geom[0]),pts1=jsts.geom.util.PointExtracter.getPoints(this.geom[1]);(this.computeMinDistanceLines(lines0,lines1,locGeom),this.updateMinDistance(locGeom,!1),this.minDistance<=this.terminateDistance)||(locGeom[0]=null,locGeom[1]=null,this.computeMinDistanceLinesPoints(lines0,pts1,locGeom),this.updateMinDistance(locGeom,!1),this.minDistance<=this.terminateDistance)||(locGeom[0]=null,locGeom[1]=null,this.computeMinDistanceLinesPoints(lines1,pts0,locGeom),this.updateMinDistance(locGeom,!0),this.minDistance<=this.terminateDistance)||(locGeom[0]=null,locGeom[1]=null,this.computeMinDistancePoints(pts0,pts1,locGeom),this.updateMinDistance(locGeom,!1))};jsts.operation.distance.DistanceOp.prototype.computeMinDistanceLines=function(lines0,lines1,locGeom){for(var line0,j,line1,i=0;i<lines0.length;i++)for(line0=lines0[i],j=0;j<lines1.length;j++)if(line1=lines1[j],this.computeMinDistance(line0,line1,locGeom),this.minDistance<=this.terminateDistance)return};jsts.operation.distance.DistanceOp.prototype.computeMinDistancePoints=function(points0,points1,locGeom){for(var pt0,j,pt1,dist,i=0;i<points0.length;i++)for(pt0=points0[i],j=0;j<points1.length;j++)if(pt1=points1[j],dist=pt0.getCoordinate().distance(pt1.getCoordinate()),dist<this.minDistance&&(this.minDistance=dist,locGeom[0]=new jsts.operation.distance.GeometryLocation(pt0,0,pt0.getCoordinate()),locGeom[1]=new jsts.operation.distance.GeometryLocation(pt1,0,pt1.getCoordinate())),this.minDistance<=this.terminateDistance)return};jsts.operation.distance.DistanceOp.prototype.computeMinDistanceLinesPoints=function(lines,points,locGeom){for(var line,j,pt,i=0;i<lines.length;i++)for(line=lines[i],j=0;j<points.length;j++)if(pt=points[j],this.computeMinDistance(line,pt,locGeom),this.minDistance<=this.terminateDistance)return};jsts.operation.distance.DistanceOp.prototype.computeMinDistance2=function(line0,line1,locGeom){var coord0,coord1,i,j,dist;if(line1 instanceof jsts.geom.Point){this.computeMinDistance3(line0,line1,locGeom);return}if(!(line0.getEnvelopeInternal().distance(line1.getEnvelopeInternal())>this.minDistance))for(coord0=line0.getCoordinates(),coord1=line1.getCoordinates(),i=0;i<coord0.length-1;i++)for(j=0;j<coord1.length-1;j++){if(dist=jsts.algorithm.CGAlgorithms.distanceLineLine(coord0[i],coord0[i+1],coord1[j],coord1[j+1]),dist<this.minDistance){this.minDistance=dist;var seg0=new jsts.geom.LineSegment(coord0[i],coord0[i+1]),seg1=new jsts.geom.LineSegment(coord1[j],coord1[j+1]),closestPt=seg0.closestPoints(seg1);locGeom[0]=new jsts.operation.distance.GeometryLocation(line0,i,closestPt[0]);locGeom[1]=new jsts.operation.distance.GeometryLocation(line1,j,closestPt[1])}if(this.minDistance<=this.terminateDistance)return}};jsts.operation.distance.DistanceOp.prototype.computeMinDistance3=function(line,pt,locGeom){var coord0,coord,i,dist,seg,segClosestPoint;if(!(line.getEnvelopeInternal().distance(pt.getEnvelopeInternal())>this.minDistance))for(coord0=line.getCoordinates(),coord=pt.getCoordinate(),i=0;i<coord0.length-1;i++)if(dist=jsts.algorithm.CGAlgorithms.distancePointLine(coord,coord0[i],coord0[i+1]),dist<this.minDistance&&(this.minDistance=dist,seg=new jsts.geom.LineSegment(coord0[i],coord0[i+1]),segClosestPoint=seg.closestPoint(coord),locGeom[0]=new jsts.operation.distance.GeometryLocation(line,i,segClosestPoint),locGeom[1]=new jsts.operation.distance.GeometryLocation(pt,0,coord)),this.minDistance<=this.terminateDistance)return},function(){var HotPixelSnapAction=function(hotPixel,parentEdge,vertexIndex){this.hotPixel=hotPixel;this.parentEdge=parentEdge;this.vertexIndex=vertexIndex};HotPixelSnapAction.prototype=new jsts.index.chain.MonotoneChainSelectAction;HotPixelSnapAction.constructor=HotPixelSnapAction;HotPixelSnapAction.prototype.hotPixel=null;HotPixelSnapAction.prototype.parentEdge=null;HotPixelSnapAction.prototype.vertexIndex=null;HotPixelSnapAction.prototype._isNodeAdded=!1;HotPixelSnapAction.prototype.isNodeAdded=function(){return this._isNodeAdded};HotPixelSnapAction.prototype.select=function(mc,startIndex){var ss=mc.getContext();(this.parentEdge===null||ss!==this.parentEdge||startIndex!==this.vertexIndex)&&(this._isNodeAdded=this.hotPixel.addSnappedNode(ss,startIndex))};jsts.noding.snapround.MCIndexPointSnapper=function(index){this.index=index};jsts.noding.snapround.MCIndexPointSnapper.prototype.index=null;jsts.noding.snapround.MCIndexPointSnapper.prototype.snap=function(hotPixel,parentEdge,vertexIndex){if(arguments.length===1){this.snap2.apply(this,arguments);return}var pixelEnv=hotPixel.getSafeEnvelope(),hotPixelSnapAction=new HotPixelSnapAction(hotPixel,parentEdge,vertexIndex);return this.index.query(pixelEnv,{visitItem:function(testChain){testChain.select(pixelEnv,hotPixelSnapAction)}}),hotPixelSnapAction.isNodeAdded()};jsts.noding.snapround.MCIndexPointSnapper.prototype.snap2=function(hotPixel){return this.snap(hotPixel,null,-1)}}();jsts.noding.snapround.MCIndexSnapRounder=function(pm){this.pm=pm;this.li=new jsts.algorithm.RobustLineIntersector;this.li.setPrecisionModel(pm);this.scaleFactor=pm.getScale()};jsts.noding.snapround.MCIndexSnapRounder.prototype=new jsts.noding.Noder;jsts.noding.snapround.MCIndexSnapRounder.constructor=jsts.noding.snapround.MCIndexSnapRounder;jsts.noding.snapround.MCIndexSnapRounder.prototype.pm=null;jsts.noding.snapround.MCIndexSnapRounder.prototype.li=null;jsts.noding.snapround.MCIndexSnapRounder.prototype.scaleFactor=null;jsts.noding.snapround.MCIndexSnapRounder.prototype.noder=null;jsts.noding.snapround.MCIndexSnapRounder.prototype.pointSnapper=null;jsts.noding.snapround.MCIndexSnapRounder.prototype.nodedSegStrings=null;jsts.noding.snapround.MCIndexSnapRounder.prototype.getNodedSubstrings=function(){return jsts.noding.NodedSegmentString.getNodedSubstrings(this.nodedSegStrings)};jsts.noding.snapround.MCIndexSnapRounder.prototype.computeNodes=function(inputSegmentStrings){this.nodedSegStrings=inputSegmentStrings;this.noder=new jsts.noding.MCIndexNoder;this.pointSnapper=new jsts.noding.snapround.MCIndexPointSnapper(this.noder.getIndex());this.snapRound(inputSegmentStrings,this.li)};jsts.noding.snapround.MCIndexSnapRounder.prototype.snapRound=function(segStrings,li){var intersections=this.findInteriorIntersections(segStrings,li);this.computeIntersectionSnaps(intersections);this.computeVertexSnaps(segStrings)};jsts.noding.snapround.MCIndexSnapRounder.prototype.findInteriorIntersections=function(segStrings,li){var intFinderAdder=new jsts.noding.IntersectionFinderAdder(li);return this.noder.setSegmentIntersector(intFinderAdder),this.noder.computeNodes(segStrings),intFinderAdder.getInteriorIntersections()};jsts.noding.snapround.MCIndexSnapRounder.prototype.computeIntersectionSnaps=function(snapPts){for(var snapPt,hotPixel,it=snapPts.iterator();it.hasNext();)snapPt=it.next(),hotPixel=new jsts.noding.snapround.HotPixel(snapPt,this.scaleFactor,this.li),this.pointSnapper.snap(hotPixel)};jsts.noding.snapround.MCIndexSnapRounder.prototype.computeVertexSnaps=function(edges){var i0,edge0;if(edges instanceof jsts.noding.NodedSegmentString){this.computeVertexSnaps2.apply(this,arguments);return}for(i0=edges.iterator();i0.hasNext();)edge0=i0.next(),this.computeVertexSnaps(edge0)};jsts.noding.snapround.MCIndexSnapRounder.prototype.computeVertexSnaps2=function(e){for(var hotPixel,isNodeAdded,pts0=e.getCoordinates(),i=0;i<pts0.length-1;i++)hotPixel=new jsts.noding.snapround.HotPixel(pts0[i],this.scaleFactor,this.li),isNodeAdded=this.pointSnapper.snap(hotPixel,e,i),isNodeAdded&&e.addIntersection(pts0[i],i)};jsts.geomgraph.Quadrant=function(){};jsts.geomgraph.Quadrant.NE=0;jsts.geomgraph.Quadrant.NW=1;jsts.geomgraph.Quadrant.SW=2;jsts.geomgraph.Quadrant.SE=3;jsts.geomgraph.Quadrant.quadrant=function(dx,dy){if(dx instanceof jsts.geom.Coordinate)return jsts.geomgraph.Quadrant.quadrant2.apply(this,arguments);if(dx===0&&dy===0)throw new jsts.error.IllegalArgumentError("Cannot compute the quadrant for point ( "+dx+", "+dy+" )");return dx>=0?dy>=0?jsts.geomgraph.Quadrant.NE:jsts.geomgraph.Quadrant.SE:dy>=0?jsts.geomgraph.Quadrant.NW:jsts.geomgraph.Quadrant.SW};jsts.geomgraph.Quadrant.quadrant2=function(p0,p1){if(p1.x===p0.x&&p1.y===p0.y)throw new jsts.error.IllegalArgumentError("Cannot compute the quadrant for two identical points "+p0);return p1.x>=p0.x?p1.y>=p0.y?jsts.geomgraph.Quadrant.NE:jsts.geomgraph.Quadrant.SE:p1.y>=p0.y?jsts.geomgraph.Quadrant.NW:jsts.geomgraph.Quadrant.SW};jsts.geomgraph.Quadrant.isOpposite=function(quad1,quad2){if(quad1===quad2)return!1;var diff=(quad1-quad2+4)%4;return diff===2?!0:!1};jsts.geomgraph.Quadrant.commonHalfPlane=function(quad1,quad2){var diff,min,max;return quad1===quad2?quad1:(diff=(quad1-quad2+4)%4,diff===2)?-1:(min=quad1<quad2?quad1:quad2,max=quad1>quad2?quad1:quad2,min===0&&max===3)?3:min};jsts.geomgraph.Quadrant.isInHalfPlane=function(quad,halfPlane){return halfPlane===jsts.geomgraph.Quadrant.SE?quad===jsts.geomgraph.Quadrant.SE||quad===jsts.geomgraph.Quadrant.SW:quad===halfPlane||quad===halfPlane+1};jsts.geomgraph.Quadrant.isNorthern=function(quad){return quad===jsts.geomgraph.Quadrant.NE||quad===jsts.geomgraph.Quadrant.NW};jsts.operation.valid.ConsistentAreaTester=function(geomGraph){this.geomGraph=geomGraph;this.li=new jsts.algorithm.RobustLineIntersector;this.nodeGraph=new jsts.operation.relate.RelateNodeGraph;this.invalidPoint=null};jsts.operation.valid.ConsistentAreaTester.prototype.getInvalidPoint=function(){return this.invalidPoint};jsts.operation.valid.ConsistentAreaTester.prototype.isNodeConsistentArea=function(){var intersector=this.geomGraph.computeSelfNodes(this.li,!0);return intersector.hasProperIntersection()?(this.invalidPoint=intersector.getProperIntersectionPoint(),!1):(this.nodeGraph.build(this.geomGraph),this.isNodeEdgeAreaLabelsConsistent())};jsts.operation.valid.ConsistentAreaTester.prototype.isNodeEdgeAreaLabelsConsistent=function(){for(var node,nodeIt=this.nodeGraph.getNodeIterator();nodeIt.hasNext();)if(node=nodeIt.next(),!node.getEdges().isAreaLabelsConsistent(this.geomGraph))return this.invalidPoint=node.getCoordinate().clone(),!1;return!0};jsts.operation.valid.ConsistentAreaTester.prototype.hasDuplicateRings=function(){for(var node,i,eeb,nodeIt=this.nodeGraph.getNodeIterator();nodeIt.hasNext();)for(node=nodeIt.next(),i=node.getEdges().iterator();i.hasNext();)if(eeb=i.next(),eeb.getEdgeEnds().length>1)return invalidPoint=eeb.getEdge().getCoordinate(0),!0;return!1};jsts.index.strtree.AbstractNode=function(level){this.level=level;this.childBoundables=[]};jsts.index.strtree.AbstractNode.prototype=new jsts.index.strtree.Boundable;jsts.index.strtree.AbstractNode.constructor=jsts.index.strtree.AbstractNode;jsts.index.strtree.AbstractNode.prototype.childBoundables=null;jsts.index.strtree.AbstractNode.prototype.bounds=null;jsts.index.strtree.AbstractNode.prototype.level=null;jsts.index.strtree.AbstractNode.prototype.getChildBoundables=function(){return this.childBoundables};jsts.index.strtree.AbstractNode.prototype.computeBounds=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.index.strtree.AbstractNode.prototype.getBounds=function(){return this.bounds===null&&(this.bounds=this.computeBounds()),this.bounds};jsts.index.strtree.AbstractNode.prototype.getLevel=function(){return this.level};jsts.index.strtree.AbstractNode.prototype.addChildBoundable=function(childBoundable){this.childBoundables.push(childBoundable)},function(){var Location=jsts.geom.Location,Position=jsts.geomgraph.Position,EdgeEnd=jsts.geomgraph.EdgeEnd;jsts.geomgraph.DirectedEdge=function(edge,isForward){if(EdgeEnd.call(this,edge),this.depth=[0,-999,-999],this._isForward=isForward,isForward)this.init(edge.getCoordinate(0),edge.getCoordinate(1));else{var n=edge.getNumPoints()-1;this.init(edge.getCoordinate(n),edge.getCoordinate(n-1))}this.computeDirectedLabel()};jsts.geomgraph.DirectedEdge.prototype=new EdgeEnd;jsts.geomgraph.DirectedEdge.constructor=jsts.geomgraph.DirectedEdge;jsts.geomgraph.DirectedEdge.depthFactor=function(currLocation,nextLocation){return currLocation===Location.EXTERIOR&&nextLocation===Location.INTERIOR?1:currLocation===Location.INTERIOR&&nextLocation===Location.EXTERIOR?-1:0};jsts.geomgraph.DirectedEdge.prototype._isForward=null;jsts.geomgraph.DirectedEdge.prototype._isInResult=!1;jsts.geomgraph.DirectedEdge.prototype._isVisited=!1;jsts.geomgraph.DirectedEdge.prototype.sym=null;jsts.geomgraph.DirectedEdge.prototype.next=null;jsts.geomgraph.DirectedEdge.prototype.nextMin=null;jsts.geomgraph.DirectedEdge.prototype.edgeRing=null;jsts.geomgraph.DirectedEdge.prototype.minEdgeRing=null;jsts.geomgraph.DirectedEdge.prototype.depth=null;jsts.geomgraph.DirectedEdge.prototype.getEdge=function(){return this.edge};jsts.geomgraph.DirectedEdge.prototype.setInResult=function(isInResult){this._isInResult=isInResult};jsts.geomgraph.DirectedEdge.prototype.isInResult=function(){return this._isInResult};jsts.geomgraph.DirectedEdge.prototype.isVisited=function(){return this._isVisited};jsts.geomgraph.DirectedEdge.prototype.setVisited=function(isVisited){this._isVisited=isVisited};jsts.geomgraph.DirectedEdge.prototype.setEdgeRing=function(edgeRing){this.edgeRing=edgeRing};jsts.geomgraph.DirectedEdge.prototype.getEdgeRing=function(){return this.edgeRing};jsts.geomgraph.DirectedEdge.prototype.setMinEdgeRing=function(minEdgeRing){this.minEdgeRing=minEdgeRing};jsts.geomgraph.DirectedEdge.prototype.getMinEdgeRing=function(){return this.minEdgeRing};jsts.geomgraph.DirectedEdge.prototype.getDepth=function(position){return this.depth[position]};jsts.geomgraph.DirectedEdge.prototype.setDepth=function(position,depthVal){if(this.depth[position]!==-999&&this.depth[position]!==depthVal)throw new jsts.error.TopologyError("assigned depths do not match",this.getCoordinate());this.depth[position]=depthVal};jsts.geomgraph.DirectedEdge.prototype.getDepthDelta=function(){var depthDelta=this.edge.getDepthDelta();return this._isForward||(depthDelta=-depthDelta),depthDelta};jsts.geomgraph.DirectedEdge.prototype.setVisitedEdge=function(isVisited){this.setVisited(isVisited);this.sym.setVisited(isVisited)};jsts.geomgraph.DirectedEdge.prototype.getSym=function(){return this.sym};jsts.geomgraph.DirectedEdge.prototype.isForward=function(){return this._isForward};jsts.geomgraph.DirectedEdge.prototype.setSym=function(de){this.sym=de};jsts.geomgraph.DirectedEdge.prototype.getNext=function(){return this.next};jsts.geomgraph.DirectedEdge.prototype.setNext=function(next){this.next=next};jsts.geomgraph.DirectedEdge.prototype.getNextMin=function(){return this.nextMin};jsts.geomgraph.DirectedEdge.prototype.setNextMin=function(nextMin){this.nextMin=nextMin};jsts.geomgraph.DirectedEdge.prototype.isLineEdge=function(){var isLine=this.label.isLine(0)||this.label.isLine(1),isExteriorIfArea0=!this.label.isArea(0)||this.label.allPositionsEqual(0,Location.EXTERIOR),isExteriorIfArea1=!this.label.isArea(1)||this.label.allPositionsEqual(1,Location.EXTERIOR);return isLine&&isExteriorIfArea0&&isExteriorIfArea1};jsts.geomgraph.DirectedEdge.prototype.isInteriorAreaEdge=function(){for(var isInteriorAreaEdge=!0,i=0;i<2;i++)this.label.isArea(i)&&this.label.getLocation(i,Position.LEFT)===Location.INTERIOR&&this.label.getLocation(i,Position.RIGHT)===Location.INTERIOR||(isInteriorAreaEdge=!1);return isInteriorAreaEdge};jsts.geomgraph.DirectedEdge.prototype.computeDirectedLabel=function(){this.label=new jsts.geomgraph.Label(this.edge.getLabel());this._isForward||this.label.flip()};jsts.geomgraph.DirectedEdge.prototype.setEdgeDepths=function(position,depth){var depthDelta=this.getEdge().getDepthDelta(),directionFactor;this._isForward||(depthDelta=-depthDelta);directionFactor=1;position===Position.LEFT&&(directionFactor=-1);var oppositePos=Position.opposite(position),delta=depthDelta*directionFactor,oppositeDepth=depth+delta;this.setDepth(position,depth);this.setDepth(oppositePos,oppositeDepth)}}();jsts.operation.buffer.OffsetCurveBuilder=function(precisionModel,bufParams){this.precisionModel=precisionModel;this.bufParams=bufParams};jsts.operation.buffer.OffsetCurveBuilder.prototype.distance=0;jsts.operation.buffer.OffsetCurveBuilder.prototype.precisionModel=null;jsts.operation.buffer.OffsetCurveBuilder.prototype.bufParams=null;jsts.operation.buffer.OffsetCurveBuilder.prototype.getBufferParameters=function(){return this.bufParams};jsts.operation.buffer.OffsetCurveBuilder.prototype.getLineCurve=function(inputPts,distance){var posDistance,segGen,isRightSide;return(this.distance=distance,this.distance<0&&!this.bufParams.isSingleSided())?null:this.distance==0?null:(posDistance=Math.abs(this.distance),segGen=this.getSegGen(posDistance),inputPts.length<=1?this.computePointCurve(inputPts[0],segGen):this.bufParams.isSingleSided()?(isRightSide=distance<0,this.computeSingleSidedBufferCurve(inputPts,isRightSide,segGen)):this.computeLineBufferCurve(inputPts,segGen),segGen.getCoordinates())};jsts.operation.buffer.OffsetCurveBuilder.prototype.getRingCurve=function(inputPts,side,distance){if(this.distance=distance,inputPts.length<=2)return this.getLineCurve(inputPts,distance);if(this.distance==0)return jsts.operation.buffer.OffsetCurveBuilder.copyCoordinates(inputPts);var segGen=this.getSegGen(this.distance);return this.computeRingBufferCurve(inputPts,side,segGen),segGen.getCoordinates()};jsts.operation.buffer.OffsetCurveBuilder.prototype.getOffsetCurve=function(inputPts,distance){var curvePts;if(this.distance=distance,this.distance===0)return null;var isRightSide=this.distance<0,posDistance=Math.abs(this.distance),segGen=this.getSegGen(posDistance);return inputPts.length<=1?this.computePointCurve(inputPts[0],segGen):this.computeOffsetCurve(inputPts,isRightSide,segGen),curvePts=segGen.getCoordinates(),isRightSide&&curvePts.reverse(),curvePts};jsts.operation.buffer.OffsetCurveBuilder.copyCoordinates=function(pts){for(var copy=[],i=0;i<pts.length;i++)copy.push(pts[i].clone());return copy};jsts.operation.buffer.OffsetCurveBuilder.prototype.getSegGen=function(distance){return new jsts.operation.buffer.OffsetSegmentGenerator(this.precisionModel,this.bufParams,distance)};jsts.operation.buffer.OffsetCurveBuilder.SIMPLIFY_FACTOR=100;jsts.operation.buffer.OffsetCurveBuilder.simplifyTolerance=function(bufDistance){return bufDistance/jsts.operation.buffer.OffsetCurveBuilder.SIMPLIFY_FACTOR};jsts.operation.buffer.OffsetCurveBuilder.prototype.computePointCurve=function(pt,segGen){switch(this.bufParams.getEndCapStyle()){case jsts.operation.buffer.BufferParameters.CAP_ROUND:segGen.createCircle(pt);break;case jsts.operation.buffer.BufferParameters.CAP_SQUARE:segGen.createSquare(pt)}};jsts.operation.buffer.OffsetCurveBuilder.prototype.computeLineBufferCurve=function(inputPts,segGen){var distTol=jsts.operation.buffer.OffsetCurveBuilder.simplifyTolerance(this.distance),simp1=jsts.operation.buffer.BufferInputLineSimplifier.simplify(inputPts,distTol),n1=simp1.length-1,simp2,n2,i;for(segGen.initSideSegments(simp1[0],simp1[1],jsts.geomgraph.Position.LEFT),i=2;i<=n1;i++)segGen.addNextSegment(simp1[i],!0);for(segGen.addLastSegment(),segGen.addLineEndCap(simp1[n1-1],simp1[n1]),simp2=jsts.operation.buffer.BufferInputLineSimplifier.simplify(inputPts,-distTol),n2=simp2.length-1,segGen.initSideSegments(simp2[n2],simp2[n2-1],jsts.geomgraph.Position.LEFT),i=n2-2;i>=0;i--)segGen.addNextSegment(simp2[i],!0);segGen.addLastSegment();segGen.addLineEndCap(simp2[1],simp2[0]);segGen.closeRing()};jsts.operation.buffer.OffsetCurveBuilder.prototype.computeSingleSidedBufferCurve=function(inputPts,isRightSide,segGen){var distTol=jsts.operation.buffer.OffsetCurveBuilder.simplifyTolerance(this.distance),simp2,n2,simp1,n1,i;if(isRightSide)for(segGen.addSegments(inputPts,!0),simp2=jsts.operation.buffer.BufferInputLineSimplifier.simplify(inputPts,-distTol),n2=simp2.length-1,segGen.initSideSegments(simp2[n2],simp2[n2-1],jsts.geomgraph.Position.LEFT),segGen.addFirstSegment(),i=n2-2;i>=0;i--)segGen.addNextSegment(simp2[i],!0);else for(segGen.addSegments(inputPts,!1),simp1=jsts.operation.buffer.BufferInputLineSimplifier.simplify(inputPts,distTol),n1=simp1.length-1,segGen.initSideSegments(simp1[0],simp1[1],jsts.geomgraph.Position.LEFT),segGen.addFirstSegment(),i=2;i<=n1;i++)segGen.addNextSegment(simp1[i],!0);segGen.addLastSegment();segGen.closeRing()};jsts.operation.buffer.OffsetCurveBuilder.prototype.computeOffsetCurve=function(inputPts,isRightSide,segGen){var distTol=jsts.operation.buffer.OffsetCurveBuilder.simplifyTolerance(this.distance),simp2,n2,simp1,n1,i;if(isRightSide)for(simp2=jsts.operation.buffer.BufferInputLineSimplifier.simplify(inputPts,-distTol),n2=simp2.length-1,segGen.initSideSegments(simp2[n2],simp2[n2-1],jsts.geomgraph.Position.LEFT),segGen.addFirstSegment(),i=n2-2;i>=0;i--)segGen.addNextSegment(simp2[i],!0);else for(simp1=jsts.operation.buffer.BufferInputLineSimplifier.simplify(inputPts,distTol),n1=simp1.length-1,segGen.initSideSegments(simp1[0],simp1[1],jsts.geomgraph.Position.LEFT),segGen.addFirstSegment(),i=2;i<=n1;i++)segGen.addNextSegment(simp1[i],!0);segGen.addLastSegment()};jsts.operation.buffer.OffsetCurveBuilder.prototype.computeRingBufferCurve=function(inputPts,side,segGen){var distTol=jsts.operation.buffer.OffsetCurveBuilder.simplifyTolerance(this.distance),simp,n,i,addStartPoint;for(side===jsts.geomgraph.Position.RIGHT&&(distTol=-distTol),simp=jsts.operation.buffer.BufferInputLineSimplifier.simplify(inputPts,distTol),n=simp.length-1,segGen.initSideSegments(simp[n-1],simp[0],side),i=1;i<=n;i++)addStartPoint=i!==1,segGen.addNextSegment(simp[i],addStartPoint);segGen.closeRing()};jsts.index.strtree.SIRtree=function(nodeCapacity){nodeCapacity=nodeCapacity||10;jsts.index.strtree.AbstractSTRtree.call(this,nodeCapacity)};jsts.index.strtree.SIRtree.prototype=new jsts.index.strtree.AbstractSTRtree;jsts.index.strtree.SIRtree.constructor=jsts.index.strtree.SIRtree;jsts.index.strtree.SIRtree.prototype.comperator={compare:function(o1,o2){return o1.getBounds().getCentre()-o2.getBounds().getCentre()}};jsts.index.strtree.SIRtree.prototype.intersectionOp={intersects:function(aBounds,bBounds){return aBounds.intersects(bBounds)}};jsts.index.strtree.SIRtree.prototype.createNode=function(){var AbstractNode=function(){jsts.index.strtree.AbstractNode.apply(this,arguments)};return AbstractNode.prototype=new jsts.index.strtree.AbstractNode,AbstractNode.constructor=AbstractNode,AbstractNode.prototype.computeBounds=function(){for(var bounds=null,childBoundables=this.getChildBoundables(),childBoundable,i=0,l=childBoundables.length;i<l;i++)childBoundable=childBoundables[i],bounds===null?bounds=new jsts.index.strtree.Interval(childBoundable.getBounds()):bounds.expandToInclude(childBoundable.getBounds());return bounds},AbstractNode};jsts.index.strtree.SIRtree.prototype.insert=function(x1,x2,item){jsts.index.strtree.AbstractSTRtree.prototype.insert(new jsts.index.strtree.Interval(Math.min(x1,x2),Math.max(x1,x2)),item)};jsts.index.strtree.SIRtree.prototype.query=function(x1,x2){x2=x2||x1;jsts.index.strtree.AbstractSTRtree.prototype.query(new jsts.index.strtree.Interval(Math.min(x1,x2),Math.max(x1,x2)))};jsts.index.strtree.SIRtree.prototype.getIntersectsOp=function(){return this.intersectionOp};jsts.index.strtree.SIRtree.prototype.getComparator=function(){return this.comperator},function(){var Location=jsts.geom.Location;jsts.operation.relate.RelateNodeGraph=function(){this.nodes=new jsts.geomgraph.NodeMap(new jsts.operation.relate.RelateNodeFactory)};jsts.operation.relate.RelateNodeGraph.prototype.nodes=null;jsts.operation.relate.RelateNodeGraph.prototype.build=function(geomGraph){this.computeIntersectionNodes(geomGraph,0);this.copyNodesAndLabels(geomGraph,0);var eeBuilder=new jsts.operation.relate.EdgeEndBuilder,eeList=eeBuilder.computeEdgeEnds(geomGraph.getEdgeIterator());this.insertEdgeEnds(eeList)};jsts.operation.relate.RelateNodeGraph.prototype.computeIntersectionNodes=function(geomGraph,argIndex){for(var e,eLoc,eiIt,ei,n,edgeIt=geomGraph.getEdgeIterator();edgeIt.hasNext();)for(e=edgeIt.next(),eLoc=e.getLabel().getLocation(argIndex),eiIt=e.getEdgeIntersectionList().iterator();eiIt.hasNext();)ei=eiIt.next(),n=this.nodes.addNode(ei.coord),eLoc===Location.BOUNDARY?n.setLabelBoundary(argIndex):n.getLabel().isNull(argIndex)&&n.setLabel(argIndex,Location.INTERIOR)};jsts.operation.relate.RelateNodeGraph.prototype.copyNodesAndLabels=function(geomGraph,argIndex){for(var graphNode,newNode,nodeIt=geomGraph.getNodeIterator();nodeIt.hasNext();)graphNode=nodeIt.next(),newNode=this.nodes.addNode(graphNode.getCoordinate()),newNode.setLabel(argIndex,graphNode.getLabel().getLocation(argIndex))};jsts.operation.relate.RelateNodeGraph.prototype.insertEdgeEnds=function(ee){for(var e,i=ee.iterator();i.hasNext();)e=i.next(),this.nodes.add(e)};jsts.operation.relate.RelateNodeGraph.prototype.getNodeIterator=function(){return this.nodes.iterator()}}(),function(){var Location=jsts.geom.Location,Position=jsts.geomgraph.Position;jsts.geomgraph.Depth=function(){var i,j;for(this.depth=[[],[]],i=0;i<2;i++)for(j=0;j<3;j++)this.depth[i][j]=jsts.geomgraph.Depth.NULL_VALUE};jsts.geomgraph.Depth.NULL_VALUE=-1;jsts.geomgraph.Depth.depthAtLocation=function(location){return location===Location.EXTERIOR?0:location===Location.INTERIOR?1:jsts.geomgraph.Depth.NULL_VALUE};jsts.geomgraph.Depth.prototype.depth=null;jsts.geomgraph.Depth.prototype.getDepth=function(geomIndex,posIndex){return this.depth[geomIndex][posIndex]};jsts.geomgraph.Depth.prototype.setDepth=function(geomIndex,posIndex,depthValue){this.depth[geomIndex][posIndex]=depthValue};jsts.geomgraph.Depth.prototype.getLocation=function(geomIndex,posIndex){return this.depth[geomIndex][posIndex]<=0?Location.EXTERIOR:Location.INTERIOR};jsts.geomgraph.Depth.prototype.add=function(geomIndex,posIndex,location){location===Location.INTERIOR&&this.depth[geomIndex][posIndex]++};jsts.geomgraph.Depth.prototype.isNull=function(){var i,j;if(arguments.length>0)return this.isNull2.apply(this,arguments);for(i=0;i<2;i++)for(j=0;j<3;j++)if(this.depth[i][j]!==jsts.geomgraph.Depth.NULL_VALUE)return!1;return!0};jsts.geomgraph.Depth.prototype.isNull2=function(geomIndex){return arguments.length>1?this.isNull3.apply(this,arguments):this.depth[geomIndex][1]==jsts.geomgraph.Depth.NULL_VALUE};jsts.geomgraph.Depth.prototype.isNull3=function(geomIndex,posIndex){return this.depth[geomIndex][posIndex]==jsts.geomgraph.Depth.NULL_VALUE};jsts.geomgraph.Depth.prototype.add=function(lbl){for(var j,loc,i=0;i<2;i++)for(j=1;j<3;j++)loc=lbl.getLocation(i,j),(loc===Location.EXTERIOR||loc===Location.INTERIOR)&&(this.isNull(i,j)?this.depth[i][j]=jsts.geomgraph.Depth.depthAtLocation(loc):this.depth[i][j]+=jsts.geomgraph.Depth.depthAtLocation(loc))};jsts.geomgraph.Depth.prototype.getDelta=function(geomIndex){return this.depth[geomIndex][Position.RIGHT]-this.depth[geomIndex][Position.LEFT]};jsts.geomgraph.Depth.prototype.normalize=function(){for(var minDepth,j,newValue,i=0;i<2;i++)if(!this.isNull(i))for(minDepth=this.depth[i][1],this.depth[i][2]<minDepth&&(minDepth=this.depth[i][2]),minDepth<0&&(minDepth=0),j=1;j<3;j++)newValue=0,this.depth[i][j]>minDepth&&(newValue=1),this.depth[i][j]=newValue};jsts.geomgraph.Depth.prototype.toString=function(){return"A: "+this.depth[0][1]+","+this.depth[0][2]+" B: "+this.depth[1][1]+","+this.depth[1][2]}}();jsts.algorithm.BoundaryNodeRule=function(){};jsts.algorithm.BoundaryNodeRule.prototype.isInBoundary=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.algorithm.Mod2BoundaryNodeRule=function(){};jsts.algorithm.Mod2BoundaryNodeRule.prototype=new jsts.algorithm.BoundaryNodeRule;jsts.algorithm.Mod2BoundaryNodeRule.prototype.isInBoundary=function(boundaryCount){return boundaryCount%2==1};jsts.algorithm.BoundaryNodeRule.MOD2_BOUNDARY_RULE=new jsts.algorithm.Mod2BoundaryNodeRule;jsts.algorithm.BoundaryNodeRule.OGC_SFS_BOUNDARY_RULE=jsts.algorithm.BoundaryNodeRule.MOD2_BOUNDARY_RULE;jsts.geom.CoordinateSequenceFilter=function(){};jsts.geom.CoordinateSequenceFilter.prototype.filter=jsts.abstractFunc;jsts.geom.CoordinateSequenceFilter.prototype.isDone=jsts.abstractFunc;jsts.geom.CoordinateSequenceFilter.prototype.isGeometryChanged=jsts.abstractFunc;jsts.algorithm.distance.PointPairDistance=function(){this.pt=[new jsts.geom.Coordinate,new jsts.geom.Coordinate]};jsts.algorithm.distance.PointPairDistance.prototype.pt=null;jsts.algorithm.distance.PointPairDistance.prototype.distance=NaN;jsts.algorithm.distance.PointPairDistance.prototype.isNull=!0;jsts.algorithm.distance.PointPairDistance.prototype.initialize=function(p0,p1,distance){if(p0===undefined){this.isNull=!0;return}this.pt[0].setCoordinate(p0);this.pt[1].setCoordinate(p1);this.distance=distance!==undefined?distance:p0.distance(p1);this.isNull=!1};jsts.algorithm.distance.PointPairDistance.prototype.getDistance=function(){return this.distance};jsts.algorithm.distance.PointPairDistance.prototype.getCoordinates=function(){return this.pt};jsts.algorithm.distance.PointPairDistance.prototype.getCoordinate=function(i){return this.pt[i]};jsts.algorithm.distance.PointPairDistance.prototype.setMaximum=function(ptDist){if(arguments.length===2){this.setMaximum2.apply(this,arguments);return}this.setMaximum(ptDist.pt[0],ptDist.pt[1])};jsts.algorithm.distance.PointPairDistance.prototype.setMaximum2=function(p0,p1){if(this.isNull){this.initialize(p0,p1);return}var dist=p0.distance(p1);dist>this.distance&&this.initialize(p0,p1,dist)};jsts.algorithm.distance.PointPairDistance.prototype.setMinimum=function(ptDist){if(arguments.length===2){this.setMinimum2.apply(this,arguments);return}this.setMinimum(ptDist.pt[0],ptDist.pt[1])};jsts.algorithm.distance.PointPairDistance.prototype.setMinimum2=function(p0,p1){if(this.isNull){this.initialize(p0,p1);return}var dist=p0.distance(p1);dist<this.distance&&this.initialize(p0,p1,dist)},function(){var PointPairDistance=jsts.algorithm.distance.PointPairDistance,DistanceToPoint=jsts.algorithm.distance.DistanceToPoint,MaxPointDistanceFilter=function(geom){this.maxPtDist=new PointPairDistance;this.minPtDist=new PointPairDistance;this.euclideanDist=new DistanceToPoint;this.geom=geom},MaxDensifiedByFractionDistanceFilter;MaxPointDistanceFilter.prototype=new jsts.geom.CoordinateFilter;MaxPointDistanceFilter.prototype.maxPtDist=new PointPairDistance;MaxPointDistanceFilter.prototype.minPtDist=new PointPairDistance;MaxPointDistanceFilter.prototype.euclideanDist=new DistanceToPoint;MaxPointDistanceFilter.prototype.geom;MaxPointDistanceFilter.prototype.filter=function(pt){this.minPtDist.initialize();DistanceToPoint.computeDistance(this.geom,pt,this.minPtDist);this.maxPtDist.setMaximum(this.minPtDist)};MaxPointDistanceFilter.prototype.getMaxPointDistance=function(){return this.maxPtDist};MaxDensifiedByFractionDistanceFilter=function(geom,fraction){this.maxPtDist=new PointPairDistance;this.minPtDist=new PointPairDistance;this.geom=geom;this.numSubSegs=Math.round(1/fraction)};MaxDensifiedByFractionDistanceFilter.prototype=new jsts.geom.CoordinateSequenceFilter;MaxDensifiedByFractionDistanceFilter.prototype.maxPtDist=new PointPairDistance;MaxDensifiedByFractionDistanceFilter.prototype.minPtDist=new PointPairDistance;MaxDensifiedByFractionDistanceFilter.prototype.geom;MaxDensifiedByFractionDistanceFilter.prototype.numSubSegs=0;MaxDensifiedByFractionDistanceFilter.prototype.filter=function(seq,index){var i;if(index!=0){var p0=seq[index-1],p1=seq[index],delx=(p1.x-p0.x)/this.numSubSegs,dely=(p1.y-p0.y)/this.numSubSegs;for(i=0;i<this.numSubSegs;i++){var x=p0.x+i*delx,y=p0.y+i*dely,pt=new jsts.geom.Coordinate(x,y);this.minPtDist.initialize();DistanceToPoint.computeDistance(this.geom,pt,this.minPtDist);this.maxPtDist.setMaximum(this.minPtDist)}}};MaxDensifiedByFractionDistanceFilter.prototype.isGeometryChanged=function(){return!1};MaxDensifiedByFractionDistanceFilter.prototype.isDone=function(){return!1};MaxDensifiedByFractionDistanceFilter.prototype.getMaxPointDistance=function(){return this.maxPtDist};jsts.algorithm.distance.DiscreteHausdorffDistance=function(g0,g1){this.g0=g0;this.g1=g1;this.ptDist=new jsts.algorithm.distance.PointPairDistance};jsts.algorithm.distance.DiscreteHausdorffDistance.prototype.g0=null;jsts.algorithm.distance.DiscreteHausdorffDistance.prototype.g1=null;jsts.algorithm.distance.DiscreteHausdorffDistance.prototype.ptDist=null;jsts.algorithm.distance.DiscreteHausdorffDistance.prototype.densifyFrac=0;jsts.algorithm.distance.DiscreteHausdorffDistance.distance=function(g0,g1,densifyFrac){var dist=new jsts.algorithm.distance.DiscreteHausdorffDistance(g0,g1);return densifyFrac!==undefined&&dist.setDensifyFraction(densifyFrac),dist.distance()};jsts.algorithm.distance.DiscreteHausdorffDistance.prototype.setDensifyFraction=function(densifyFrac){if(densifyFrac>1||densifyFrac<=0)throw new jsts.error.IllegalArgumentError("Fraction is not in range (0.0 - 1.0]");this.densifyFrac=densifyFrac};jsts.algorithm.distance.DiscreteHausdorffDistance.prototype.distance=function(){return this.compute(this.g0,this.g1),ptDist.getDistance()};jsts.algorithm.distance.DiscreteHausdorffDistance.prototype.orientedDistance=function(){return this.computeOrientedDistance(this.g0,this.g1,this.ptDist),this.ptDist.getDistance()};jsts.algorithm.distance.DiscreteHausdorffDistance.prototype.getCoordinates=function(){return ptDist.getCoordinates()};jsts.algorithm.distance.DiscreteHausdorffDistance.prototype.compute=function(g0,g1){this.computeOrientedDistance(g0,g1,this.ptDist);this.computeOrientedDistance(g1,g0,this.ptDist)};jsts.algorithm.distance.DiscreteHausdorffDistance.prototype.computeOrientedDistance=function(discreteGeom,geom,ptDist){var distFilter=new MaxPointDistanceFilter(geom),fracFilter;discreteGeom.apply(distFilter);ptDist.setMaximum(distFilter.getMaxPointDistance());this.densifyFrac>0&&(fracFilter=new MaxDensifiedByFractionDistanceFilter(geom,this.densifyFrac),discreteGeom.apply(fracFilter),ptDist.setMaximum(fracFilter.getMaxPointDistance()))}}();jsts.operation.distance.GeometryLocation=function(component,segIndex,pt){this.component=component;this.segIndex=segIndex;this.pt=pt};jsts.operation.distance.GeometryLocation.INSIDE_AREA=-1;jsts.operation.distance.GeometryLocation.prototype.component=null;jsts.operation.distance.GeometryLocation.prototype.segIndex=null;jsts.operation.distance.GeometryLocation.prototype.pt=null;jsts.operation.distance.GeometryLocation.prototype.getGeometryComponent=function(){return this.component};jsts.operation.distance.GeometryLocation.prototype.getSegmentIndex=function(){return this.segIndex};jsts.operation.distance.GeometryLocation.prototype.getCoordinate=function(){return this.pt};jsts.operation.distance.GeometryLocation.prototype.isInsideArea=function(){return this.segIndex===jsts.operation.distance.GeometryLocation.INSIDE_AREA};jsts.geom.util.PointExtracter=function(pts){this.pts=pts};jsts.geom.util.PointExtracter.prototype=new jsts.geom.GeometryFilter;jsts.geom.util.PointExtracter.prototype.pts=null;jsts.geom.util.PointExtracter.getPoints=function(geom,list){return list===undefined&&(list=[]),geom instanceof jsts.geom.Point?list.push(geom):(geom instanceof jsts.geom.GeometryCollection||geom instanceof jsts.geom.MultiPoint||geom instanceof jsts.geom.MultiLineString||geom instanceof jsts.geom.MultiPolygon)&&geom.apply(new jsts.geom.util.PointExtracter(list)),list};jsts.geom.util.PointExtracter.prototype.filter=function(geom){geom instanceof jsts.geom.Point&&this.pts.push(geom)};jsts.noding.ScaledNoder=function(noder,scaleFactor,offsetX,offsetY){this.offsetX=offsetX?offsetX:0;this.offsetY=offsetY?offsetY:0;this.noder=noder;this.scaleFactor=scaleFactor;this.isScaled=!this.isIntegerPrecision()};jsts.noding.ScaledNoder.prototype=new jsts.noding.Noder;jsts.noding.ScaledNoder.constructor=jsts.noding.ScaledNoder;jsts.noding.ScaledNoder.prototype.noder=null;jsts.noding.ScaledNoder.prototype.scaleFactor=undefined;jsts.noding.ScaledNoder.prototype.offsetX=undefined;jsts.noding.ScaledNoder.prototype.offsetY=undefined;jsts.noding.ScaledNoder.prototype.isScaled=!1;jsts.noding.ScaledNoder.prototype.isIntegerPrecision=function(){return this.scaleFactor===1};jsts.noding.ScaledNoder.prototype.getNodedSubstrings=function(){var splitSS=this.noder.getNodedSubstrings();return this.isScaled&&this.rescale(splitSS),splitSS};jsts.noding.ScaledNoder.prototype.computeNodes=function(inputSegStrings){var intSegStrings=inputSegStrings;this.isScaled&&(intSegStrings=this.scale(inputSegStrings));this.noder.computeNodes(intSegStrings)};jsts.noding.ScaledNoder.prototype.scale=function(segStrings){var transformed,i,ss;if(segStrings instanceof Array)return this.scale2(segStrings);for(transformed=new javascript.util.ArrayList,i=segStrings.iterator();i.hasNext();)ss=i.next(),transformed.add(new jsts.noding.NodedSegmentString(this.scale(ss.getCoordinates()),ss.getData()));return transformed};jsts.noding.ScaledNoder.prototype.scale2=function(pts){for(var roundPts=[],i=0;i<pts.length;i++)roundPts[i]=new jsts.geom.Coordinate(Math.round((pts[i].x-this.offsetX)*this.scaleFactor),Math.round((pts[i].y-this.offsetY)*this.scaleFactor));return jsts.geom.CoordinateArrays.removeRepeatedPoints(roundPts)};jsts.noding.ScaledNoder.prototype.rescale=function(segStrings){var i,ss;if(segStrings instanceof Array){this.rescale2(segStrings);return}for(i=segStrings.iterator();i.hasNext();)ss=i.next(),this.rescale(ss.getCoordinates())};jsts.noding.ScaledNoder.prototype.rescale2=function(pts){for(var i=0;i<pts.length;i++)pts[i].x=pts[i].x/this.scaleFactor+this.offsetX,pts[i].y=pts[i].y/this.scaleFactor+this.offsetY};jsts.noding.IntersectionAdder=function(li){this.li=li};jsts.noding.IntersectionAdder.prototype=new jsts.noding.SegmentIntersector;jsts.noding.IntersectionAdder.constructor=jsts.noding.IntersectionAdder;jsts.noding.IntersectionAdder.isAdjacentSegments=function(i1,i2){return Math.abs(i1-i2)===1};jsts.noding.IntersectionAdder.prototype._hasIntersection=!1;jsts.noding.IntersectionAdder.prototype.hasProper=!1;jsts.noding.IntersectionAdder.prototype.hasProperInterior=!1;jsts.noding.IntersectionAdder.prototype.hasInterior=!1;jsts.noding.IntersectionAdder.prototype.properIntersectionPoint=null;jsts.noding.IntersectionAdder.prototype.li=null;jsts.noding.IntersectionAdder.prototype.isSelfIntersection=null;jsts.noding.IntersectionAdder.prototype.numIntersections=0;jsts.noding.IntersectionAdder.prototype.numInteriorIntersections=0;jsts.noding.IntersectionAdder.prototype.numProperIntersections=0;jsts.noding.IntersectionAdder.prototype.numTests=0;jsts.noding.IntersectionAdder.prototype.getLineIntersector=function(){return this.li};jsts.noding.IntersectionAdder.prototype.getProperIntersectionPoint=function(){return this.properIntersectionPoint};jsts.noding.IntersectionAdder.prototype.hasIntersection=function(){return this._hasIntersection};jsts.noding.IntersectionAdder.prototype.hasProperIntersection=function(){return this.hasProper};jsts.noding.IntersectionAdder.prototype.hasProperInteriorIntersection=function(){return this.hasProperInterior};jsts.noding.IntersectionAdder.prototype.hasInteriorIntersection=function(){return this.hasInterior};jsts.noding.IntersectionAdder.prototype.isTrivialIntersection=function(e0,segIndex0,e1,segIndex1){if(e0==e1&&this.li.getIntersectionNum()==1){if(jsts.noding.IntersectionAdder.isAdjacentSegments(segIndex0,segIndex1))return!0;if(e0.isClosed()){var maxSegIndex=e0.size()-1;if(segIndex0===0&&segIndex1===maxSegIndex||segIndex1===0&&segIndex0===maxSegIndex)return!0}}return!1};jsts.noding.IntersectionAdder.prototype.processIntersections=function(e0,segIndex0,e1,segIndex1){if(e0!==e1||segIndex0!==segIndex1){this.numTests++;var p00=e0.getCoordinates()[segIndex0],p01=e0.getCoordinates()[segIndex0+1],p10=e1.getCoordinates()[segIndex1],p11=e1.getCoordinates()[segIndex1+1];this.li.computeIntersection(p00,p01,p10,p11);this.li.hasIntersection()&&(this.numIntersections++,this.li.isInteriorIntersection()&&(this.numInteriorIntersections++,this.hasInterior=!0),this.isTrivialIntersection(e0,segIndex0,e1,segIndex1)||(this._hasIntersection=!0,e0.addIntersections(this.li,segIndex0,0),e1.addIntersections(this.li,segIndex1,1),this.li.isProper()&&(this.numProperIntersections++,this.hasProper=!0,this.hasProperInterior=!0)))}};jsts.noding.IntersectionAdder.prototype.isDone=function(){return!1};jsts.triangulate.VoronoiDiagramBuilder=function(){this.siteCoords=null;this.tolerance=0;this.subdiv=null;this.clipEnv=null;this.diagramEnv=null};jsts.triangulate.VoronoiDiagramBuilder.prototype.setSites=function(){var arg=arguments[0];arg instanceof jsts.geom.Geometry||arg instanceof jsts.geom.Coordinate||arg instanceof jsts.geom.Point||arg instanceof jsts.geom.MultiPoint||arg instanceof jsts.geom.LineString||arg instanceof jsts.geom.MultiLineString||arg instanceof jsts.geom.LinearRing||arg instanceof jsts.geom.Polygon||arg instanceof jsts.geom.MultiPolygon?this.setSitesByGeometry(arg):this.setSitesByArray(arg)};jsts.triangulate.VoronoiDiagramBuilder.prototype.setSitesByGeometry=function(geom){this.siteCoords=jsts.triangulate.DelaunayTriangulationBuilder.extractUniqueCoordinates(geom)};jsts.triangulate.VoronoiDiagramBuilder.prototype.setSitesByArray=function(coords){this.siteCoords=jsts.triangulate.DelaunayTriangulationBuilder.unique(coords)};jsts.triangulate.VoronoiDiagramBuilder.prototype.setClipEnvelope=function(clipEnv){this.clipEnv=clipEnv};jsts.triangulate.VoronoiDiagramBuilder.prototype.setTolerance=function(tolerance){this.tolerance=tolerance};jsts.triangulate.VoronoiDiagramBuilder.prototype.create=function(){if(this.subdiv===null){var siteEnv,expandBy,vertices,triangulator;siteEnv=jsts.triangulate.DelaunayTriangulationBuilder.envelope(this.siteCoords);this.diagramEnv=siteEnv;expandBy=Math.max(this.diagramEnv.getWidth(),this.diagramEnv.getHeight());this.diagramEnv.expandBy(expandBy);this.clipEnv!==null&&this.diagramEnv.expandToInclude(this.clipEnv);vertices=jsts.triangulate.DelaunayTriangulationBuilder.toVertices(this.siteCoords);this.subdiv=new jsts.triangulate.quadedge.QuadEdgeSubdivision(siteEnv,this.tolerance);triangulator=new jsts.triangulate.IncrementalDelaunayTriangulator(this.subdiv);triangulator.insertSites(vertices)}};jsts.triangulate.VoronoiDiagramBuilder.prototype.getSubdivision=function(){return this.create(),this.subdiv};jsts.triangulate.VoronoiDiagramBuilder.prototype.getDiagram=function(geomFact){this.create();var polys=this.subdiv.getVoronoiDiagram(geomFact);return this.clipGeometryCollection(polys,this.diagramEnv)};jsts.triangulate.VoronoiDiagramBuilder.prototype.clipGeometryCollection=function(geom,clipEnv){var clipPoly,clipped,i,il,g,result;for(clipPoly=geom.getFactory().toGeometry(clipEnv),clipped=[],i=0,il=geom.getNumGeometries(),i;i<il;i++)g=geom.getGeometryN(i),result=null,clipEnv.contains(g.getEnvelopeInternal())?result=g:clipEnv.intersects(g.getEnvelopeInternal())&&(result=clipPoly.intersection(g)),result===null||result.isEmpty()||clipped.push(result);return geom.getFactory().createGeometryCollection(clipped)};jsts.operation.valid.IndexedNestedRingTester=function(graph){this.graph=graph;this.rings=new javascript.util.ArrayList;this.totalEnv=new jsts.geom.Envelope;this.index=null;this.nestedPt=null};jsts.operation.valid.IndexedNestedRingTester.prototype.getNestedPoint=function(){return this.nestedPt};jsts.operation.valid.IndexedNestedRingTester.prototype.add=function(ring){this.rings.add(ring);this.totalEnv.expandToInclude(ring.getEnvelopeInternal())};jsts.operation.valid.IndexedNestedRingTester.prototype.isNonNested=function(){var i,j,searchRing,searchRingPts,innerRingPt,isInside;for(this.buildIndex(),i=0;i<this.rings.size();i++){var innerRing=this.rings.get(i),innerRingPts=innerRing.getCoordinates(),results=this.index.query(innerRing.getEnvelopeInternal());for(j=0;j<results.length;j++)if((searchRing=results[j],searchRingPts=searchRing.getCoordinates(),innerRing!=searchRing)&&innerRing.getEnvelopeInternal().intersects(searchRing.getEnvelopeInternal())&&(innerRingPt=jsts.operation.valid.IsValidOp.findPtNotNode(innerRingPts,searchRing,this.graph),innerRingPt!=null)&&(isInside=jsts.algorithm.CGAlgorithms.isPointInRing(innerRingPt,searchRingPts),isInside))return this.nestedPt=innerRingPt,!1}return!0};jsts.operation.valid.IndexedNestedRingTester.prototype.buildIndex=function(){var i,ring,env;for(this.index=new jsts.index.strtree.STRtree,i=0;i<this.rings.size();i++)ring=this.rings.get(i),env=ring.getEnvelopeInternal(),this.index.insert(env,ring)};jsts.noding.SegmentNode=function(segString,coord,segmentIndex,segmentOctant){this.segString=segString;this.coord=new jsts.geom.Coordinate(coord);this.segmentIndex=segmentIndex;this.segmentOctant=segmentOctant;this._isInterior=!coord.equals2D(segString.getCoordinate(segmentIndex))};jsts.noding.SegmentNode.prototype.segString=null;jsts.noding.SegmentNode.prototype.coord=null;jsts.noding.SegmentNode.prototype.segmentIndex=null;jsts.noding.SegmentNode.prototype.segmentOctant=null;jsts.noding.SegmentNode.prototype._isInterior=null;jsts.noding.SegmentNode.prototype.getCoordinate=function(){return this.coord};jsts.noding.SegmentNode.prototype.isInterior=function(){return this._isInterior};jsts.noding.SegmentNode.prototype.isEndPoint=function(){return this.segmentIndex===0&&!this._isInterior?!0:this.segmentIndex===this.maxSegmentIndex?!0:!1};jsts.noding.SegmentNode.prototype.compareTo=function(obj){var other=obj;return this.segmentIndex<other.segmentIndex?-1:this.segmentIndex>other.segmentIndex?1:this.coord.equals2D(other.coord)?0:jsts.noding.SegmentPointComparator.compare(this.segmentOctant,this.coord,other.coord)},function(){jsts.io.GeoJSONWriter=function(){this.parser=new jsts.io.GeoJSONParser(this.geometryFactory)};jsts.io.GeoJSONWriter.prototype.write=function(geometry){return this.parser.write(geometry)}}();jsts.index.quadtree.Quadtree=function(){this.root=new jsts.index.quadtree.Root;this.minExtent=1};jsts.index.quadtree.Quadtree.ensureExtent=function(itemEnv,minExtent){var minx,maxx,miny,maxy;return(minx=itemEnv.getMinX(),maxx=itemEnv.getMaxX(),miny=itemEnv.getMinY(),maxy=itemEnv.getMaxY(),minx!==maxx&&miny!==maxy)?itemEnv:(minx===maxx&&(minx=minx-minExtent/2,maxx=minx+minExtent/2),miny===maxy&&(miny=miny-minExtent/2,maxy=miny+minExtent/2),new jsts.geom.Envelope(minx,maxx,miny,maxy))};jsts.index.quadtree.Quadtree.prototype.depth=function(){return this.root.depth()};jsts.index.quadtree.Quadtree.prototype.size=function(){return this.root.size()};jsts.index.quadtree.Quadtree.prototype.insert=function(itemEnv,item){this.collectStats(itemEnv);var insertEnv=jsts.index.quadtree.Quadtree.ensureExtent(itemEnv,this.minExtent);this.root.insert(insertEnv,item)};jsts.index.quadtree.Quadtree.prototype.remove=function(itemEnv,item){var posEnv=jsts.index.quadtree.Quadtree.ensureExtent(itemEnv,this.minExtent);return this.root.remove(posEnv,item)};jsts.index.quadtree.Quadtree.prototype.query=function(){if(arguments.length===1)return jsts.index.quadtree.Quadtree.prototype.queryByEnvelope.apply(this,arguments);jsts.index.quadtree.Quadtree.prototype.queryWithVisitor.apply(this,arguments)};jsts.index.quadtree.Quadtree.prototype.queryByEnvelope=function(searchEnv){var visitor=new jsts.index.ArrayListVisitor;return this.query(searchEnv,visitor),visitor.getItems()};jsts.index.quadtree.Quadtree.prototype.queryWithVisitor=function(searchEnv,visitor){this.root.visit(searchEnv,visitor)};jsts.index.quadtree.Quadtree.prototype.queryAll=function(){return this.root.addAllItems([])};jsts.index.quadtree.Quadtree.prototype.collectStats=function(itemEnv){var delX=itemEnv.getWidth(),delY;delX<this.minExtent&&delX>0&&(this.minExtent=delX);delY=itemEnv.getHeight();delY<this.minExtent&&delY>0&&(this.minExtent=delY)};jsts.operation.relate.RelateNodeFactory=function(){};jsts.operation.relate.RelateNodeFactory.prototype=new jsts.geomgraph.NodeFactory;jsts.operation.relate.RelateNodeFactory.prototype.createNode=function(coord){return new jsts.operation.relate.RelateNode(coord,new jsts.operation.relate.EdgeEndBundleStar)};jsts.index.quadtree.Key=function(itemEnv){this.pt=new jsts.geom.Coordinate;this.level=0;this.env=null;this.computeKey(itemEnv)};jsts.index.quadtree.Key.computeQuadLevel=function(env){var dx,dy,dMax;return dx=env.getWidth(),dy=env.getHeight(),dMax=dx>dy?dx:dy,jsts.index.DoubleBits.exponent(dMax)+1};jsts.index.quadtree.Key.prototype.getPoint=function(){return this.pt};jsts.index.quadtree.Key.prototype.getLevel=function(){return this.level};jsts.index.quadtree.Key.prototype.getEnvelope=function(){return this.env};jsts.index.quadtree.Key.prototype.getCentre=function(){var x,y;return x=(this.env.getMinX()+this.env.getMaxX())/2,y=(this.env.getMinY()+this.env.getMaxY())/2,new jsts.geom.Coordinate(x,y)};jsts.index.quadtree.Key.prototype.computeKey=function(){arguments[0]instanceof jsts.geom.Envelope?this.computeKeyFromEnvelope(arguments[0]):this.computeKeyFromLevel(arguments[0],arguments[1])};jsts.index.quadtree.Key.prototype.computeKeyFromEnvelope=function(env){for(this.level=jsts.index.quadtree.Key.computeQuadLevel(env),this.env=new jsts.geom.Envelope,this.computeKey(this.level,env);!this.env.contains(env);)this.level+=1,this.computeKey(this.level,env)};jsts.index.quadtree.Key.prototype.computeKeyFromLevel=function(level,env){var quadSize=jsts.index.DoubleBits.powerOf2(level);this.pt.x=Math.floor(env.getMinX()/quadSize)*quadSize;this.pt.y=Math.floor(env.getMinY()/quadSize)*quadSize;this.env.init(this.pt.x,this.pt.x+quadSize,this.pt.y,this.pt.y+quadSize)};jsts.geom.CoordinateArrays=function(){throw new jsts.error.AbstractMethodInvocationError;};jsts.geom.CoordinateArrays.removeRepeatedPoints=function(coord){var coordList;return this.hasRepeatedPoints(coord)?(coordList=new jsts.geom.CoordinateList(coord,!1),coordList.toCoordinateArray()):coord};jsts.geom.CoordinateArrays.hasRepeatedPoints=function(coord){for(var i=1;i<coord.length;i++)if(coord[i-1].equals(coord[i]))return!0;return!1};jsts.geom.CoordinateArrays.ptNotInList=function(testPts,pts){for(var testPt,i=0;i<testPts.length;i++)if(testPt=testPts[i],jsts.geom.CoordinateArrays.indexOf(testPt,pts)<0)return testPt;return null};jsts.geom.CoordinateArrays.increasingDirection=function(pts){for(var j,comp,i=0;i<parseInt(pts.length/2);i++)if(j=pts.length-1-i,comp=pts[i].compareTo(pts[j]),comp!=0)return comp;return 1};jsts.geom.CoordinateArrays.minCoordinate=function(coordinates){for(var minCoord=null,i=0;i<coordinates.length;i++)(minCoord===null||minCoord.compareTo(coordinates[i])>0)&&(minCoord=coordinates[i]);return minCoord};jsts.geom.CoordinateArrays.scroll=function(coordinates,firstCoordinate){var i=jsts.geom.CoordinateArrays.indexOf(firstCoordinate,coordinates),newCoordinates;if(!(i<0))for(newCoordinates=coordinates.slice(i).concat(coordinates.slice(0,i)),i=0;i<newCoordinates.length;i++)coordinates[i]=newCoordinates[i]};jsts.geom.CoordinateArrays.indexOf=function(coordinate,coordinates){for(var i=0;i<coordinates.length;i++)if(coordinate.equals(coordinates[i]))return i;return-1};jsts.operation.overlay.MinimalEdgeRing=function(start,geometryFactory){jsts.geomgraph.EdgeRing.call(this,start,geometryFactory)};jsts.operation.overlay.MinimalEdgeRing.prototype=new jsts.geomgraph.EdgeRing;jsts.operation.overlay.MinimalEdgeRing.constructor=jsts.operation.overlay.MinimalEdgeRing;jsts.operation.overlay.MinimalEdgeRing.prototype.getNext=function(de){return de.getNextMin()};jsts.operation.overlay.MinimalEdgeRing.prototype.setEdgeRing=function(de,er){de.setMinEdgeRing(er)};jsts.triangulate.DelaunayTriangulationBuilder=function(){this.siteCoords=null;this.tolerance=0;this.subdiv=null};jsts.triangulate.DelaunayTriangulationBuilder.extractUniqueCoordinates=function(geom){if(geom===undefined||geom===null)return new jsts.geom.CoordinateList([],!1).toArray();var coords=geom.getCoordinates();return jsts.triangulate.DelaunayTriangulationBuilder.unique(coords)};jsts.triangulate.DelaunayTriangulationBuilder.unique=function(coords){coords.sort(function(a,b){return a.compareTo(b)});var coordList=new jsts.geom.CoordinateList(coords,!1);return coordList.toArray()};jsts.triangulate.DelaunayTriangulationBuilder.toVertices=function(coords){var verts=new Array(coords.length),i=0,il=coords.length,coord;for(i;i<il;i++)coord=coords[i],verts[i]=new jsts.triangulate.quadedge.Vertex(coord);return verts};jsts.triangulate.DelaunayTriangulationBuilder.envelope=function(coords){var env=new jsts.geom.Envelope,i=0,il=coords.length;for(i;i<il;i++)env.expandToInclude(coords[i]);return env};jsts.triangulate.DelaunayTriangulationBuilder.prototype.setSites=function(){var arg=arguments[0];arg instanceof jsts.geom.Geometry||arg instanceof jsts.geom.Coordinate||arg instanceof jsts.geom.Point||arg instanceof jsts.geom.MultiPoint||arg instanceof jsts.geom.LineString||arg instanceof jsts.geom.MultiLineString||arg instanceof jsts.geom.LinearRing||arg instanceof jsts.geom.Polygon||arg instanceof jsts.geom.MultiPolygon?this.setSitesFromGeometry(arg):this.setSitesFromCollection(arg)};jsts.triangulate.DelaunayTriangulationBuilder.prototype.setSitesFromGeometry=function(geom){this.siteCoords=jsts.triangulate.DelaunayTriangulationBuilder.extractUniqueCoordinates(geom)};jsts.triangulate.DelaunayTriangulationBuilder.prototype.setSitesFromCollection=function(coords){this.siteCoords=jsts.triangulate.DelaunayTriangulationBuilder.unique(coords)};jsts.triangulate.DelaunayTriangulationBuilder.prototype.setTolerance=function(tolerance){this.tolerance=tolerance};jsts.triangulate.DelaunayTriangulationBuilder.prototype.create=function(){if(this.subdiv===null){var siteEnv,vertices,triangulator;siteEnv=jsts.triangulate.DelaunayTriangulationBuilder.envelope(this.siteCoords);vertices=jsts.triangulate.DelaunayTriangulationBuilder.toVertices(this.siteCoords);this.subdiv=new jsts.triangulate.quadedge.QuadEdgeSubdivision(siteEnv,this.tolerance);triangulator=new jsts.triangulate.IncrementalDelaunayTriangulator(this.subdiv);triangulator.insertSites(vertices)}};jsts.triangulate.DelaunayTriangulationBuilder.prototype.getSubdivision=function(){return this.create(),this.subdiv};jsts.triangulate.DelaunayTriangulationBuilder.prototype.getEdges=function(geomFact){return this.create(),this.subdiv.getEdges(geomFact)};jsts.triangulate.DelaunayTriangulationBuilder.prototype.getTriangles=function(geomFact){return this.create(),this.subdiv.getTriangles(geomFact)};jsts.algorithm.RayCrossingCounter=function(p){this.p=p};jsts.algorithm.RayCrossingCounter.locatePointInRing=function(p,ring){for(var p1,p2,counter=new jsts.algorithm.RayCrossingCounter(p),i=1;i<ring.length;i++)if(p1=ring[i],p2=ring[i-1],counter.countSegment(p1,p2),counter.isOnSegment())return counter.getLocation();return counter.getLocation()};jsts.algorithm.RayCrossingCounter.prototype.p=null;jsts.algorithm.RayCrossingCounter.prototype.crossingCount=0;jsts.algorithm.RayCrossingCounter.prototype.isPointOnSegment=!1;jsts.algorithm.RayCrossingCounter.prototype.countSegment=function(p1,p2){var minx,maxx;if(!(p1.x<this.p.x)||!(p2.x<this.p.x)){if(this.p.x==p2.x&&this.p.y===p2.y){this.isPointOnSegment=!0;return}if(p1.y===this.p.y&&p2.y===this.p.y){minx=p1.x;maxx=p2.x;minx>maxx&&(minx=p2.x,maxx=p1.x);this.p.x>=minx&&this.p.x<=maxx&&(this.isPointOnSegment=!0);return}if(p1.y>this.p.y&&p2.y<=this.p.y||p2.y>this.p.y&&p1.y<=this.p.y){var x1=p1.x-this.p.x,y1=p1.y-this.p.y,x2=p2.x-this.p.x,y2=p2.y-this.p.y,xIntSign=jsts.algorithm.RobustDeterminant.signOfDet2x2(x1,y1,x2,y2);if(xIntSign===0){this.isPointOnSegment=!0;return}y2<y1&&(xIntSign=-xIntSign);xIntSign>0&&this.crossingCount++}}};jsts.algorithm.RayCrossingCounter.prototype.isOnSegment=function(){return jsts.geom.isPointOnSegment};jsts.algorithm.RayCrossingCounter.prototype.getLocation=function(){return this.isPointOnSegment?jsts.geom.Location.BOUNDARY:this.crossingCount%2==1?jsts.geom.Location.INTERIOR:jsts.geom.Location.EXTERIOR};jsts.algorithm.RayCrossingCounter.prototype.isPointInPolygon=function(){return this.getLocation()!==jsts.geom.Location.EXTERIOR};jsts.operation.BoundaryOp=function(geom,bnRule){this.geom=geom;this.geomFact=geom.getFactory();this.bnRule=bnRule||jsts.algorithm.BoundaryNodeRule.MOD2_BOUNDARY_RULE};jsts.operation.BoundaryOp.prototype.geom=null;jsts.operation.BoundaryOp.prototype.geomFact=null;jsts.operation.BoundaryOp.prototype.bnRule=null;jsts.operation.BoundaryOp.prototype.getBoundary=function(){return this.geom instanceof jsts.geom.LineString?this.boundaryLineString(this.geom):this.geom instanceof jsts.geom.MultiLineString?this.boundaryMultiLineString(this.geom):this.geom.getBoundary()};jsts.operation.BoundaryOp.prototype.getEmptyMultiPoint=function(){return this.geomFact.createMultiPoint(null)};jsts.operation.BoundaryOp.prototype.boundaryMultiLineString=function(mLine){if(this.geom.isEmpty())return this.getEmptyMultiPoint();var bdyPts=this.computeBoundaryCoordinates(mLine);return bdyPts.length==1?this.geomFact.createPoint(bdyPts[0]):this.geomFact.createMultiPoint(bdyPts)};jsts.operation.BoundaryOp.prototype.endpoints=null;jsts.operation.BoundaryOp.prototype.computeBoundaryCoordinates=function(mLine){var i,line,endpoint,bdyPts=[];for(this.endpoints=[],i=0;i<mLine.getNumGeometries();i++)(line=mLine.getGeometryN(i),line.getNumPoints()!=0)&&(this.addEndpoint(line.getCoordinateN(0)),this.addEndpoint(line.getCoordinateN(line.getNumPoints()-1)));for(i=0;i<this.endpoints.length;i++)endpoint=this.endpoints[i],this.bnRule.isInBoundary(endpoint.count)&&bdyPts.push(endpoint.coordinate);return bdyPts};jsts.operation.BoundaryOp.prototype.addEndpoint=function(pt){for(var endpoint,found=!1,i=0;i<this.endpoints.length;i++)if(endpoint=this.endpoints[i],endpoint.coordinate.equals(pt)){found=!0;break}found||(endpoint={},endpoint.coordinate=pt,endpoint.count=0,this.endpoints.push(endpoint));endpoint.count++};jsts.operation.BoundaryOp.prototype.boundaryLineString=function(line){if(this.geom.isEmpty())return this.getEmptyMultiPoint();if(line.isClosed()){var closedEndpointOnBoundary=this.bnRule.isInBoundary(2);return closedEndpointOnBoundary?line.getStartPoint():this.geomFact.createMultiPoint(null)}return this.geomFact.createMultiPoint([line.getStartPoint(),line.getEndPoint()])};jsts.operation.buffer.OffsetCurveSetBuilder=function(inputGeom,distance,curveBuilder){this.inputGeom=inputGeom;this.distance=distance;this.curveBuilder=curveBuilder;this.curveList=new javascript.util.ArrayList};jsts.operation.buffer.OffsetCurveSetBuilder.prototype.inputGeom=null;jsts.operation.buffer.OffsetCurveSetBuilder.prototype.distance=null;jsts.operation.buffer.OffsetCurveSetBuilder.prototype.curveBuilder=null;jsts.operation.buffer.OffsetCurveSetBuilder.prototype.curveList=null;jsts.operation.buffer.OffsetCurveSetBuilder.prototype.getCurves=function(){return this.add(this.inputGeom),this.curveList};jsts.operation.buffer.OffsetCurveSetBuilder.prototype.addCurve=function(coord,leftLoc,rightLoc){if(coord!=null&&!(coord.length<2)){var e=new jsts.noding.NodedSegmentString(coord,new jsts.geomgraph.Label(0,jsts.geom.Location.BOUNDARY,leftLoc,rightLoc));this.curveList.add(e)}};jsts.operation.buffer.OffsetCurveSetBuilder.prototype.add=function(g){if(!g.isEmpty())if(g instanceof jsts.geom.Polygon)this.addPolygon(g);else if(g instanceof jsts.geom.LineString)this.addLineString(g);else if(g instanceof jsts.geom.Point)this.addPoint(g);else if(g instanceof jsts.geom.MultiPoint)this.addCollection(g);else if(g instanceof jsts.geom.MultiLineString)this.addCollection(g);else if(g instanceof jsts.geom.MultiPolygon)this.addCollection(g);else if(g instanceof jsts.geom.GeometryCollection)this.addCollection(g);else throw new jsts.error.IllegalArgumentError;};jsts.operation.buffer.OffsetCurveSetBuilder.prototype.addCollection=function(gc){for(var g,i=0;i<gc.getNumGeometries();i++)g=gc.getGeometryN(i),this.add(g)};jsts.operation.buffer.OffsetCurveSetBuilder.prototype.addPoint=function(p){if(!(this.distance<=0)){var coord=p.getCoordinates(),curve=this.curveBuilder.getLineCurve(coord,this.distance);this.addCurve(curve,jsts.geom.Location.EXTERIOR,jsts.geom.Location.INTERIOR)}};jsts.operation.buffer.OffsetCurveSetBuilder.prototype.addLineString=function(line){if(!(this.distance<=0)||this.curveBuilder.getBufferParameters().isSingleSided()){var coord=jsts.geom.CoordinateArrays.removeRepeatedPoints(line.getCoordinates()),curve=this.curveBuilder.getLineCurve(coord,this.distance);this.addCurve(curve,jsts.geom.Location.EXTERIOR,jsts.geom.Location.INTERIOR)}};jsts.operation.buffer.OffsetCurveSetBuilder.prototype.addPolygon=function(p){var offsetDistance=this.distance,offsetSide=jsts.geomgraph.Position.LEFT,shell,shellCoord,i,hole,holeCoord;if((this.distance<0&&(offsetDistance=-this.distance,offsetSide=jsts.geomgraph.Position.RIGHT),shell=p.getExteriorRing(),shellCoord=jsts.geom.CoordinateArrays.removeRepeatedPoints(shell.getCoordinates()),!(this.distance<0)||!this.isErodedCompletely(shell,this.distance))&&(!(this.distance<=0)||!(shellCoord.length<3)))for(this.addPolygonRing(shellCoord,offsetDistance,offsetSide,jsts.geom.Location.EXTERIOR,jsts.geom.Location.INTERIOR),i=0;i<p.getNumInteriorRing();i++)(hole=p.getInteriorRingN(i),holeCoord=jsts.geom.CoordinateArrays.removeRepeatedPoints(hole.getCoordinates()),this.distance>0&&this.isErodedCompletely(hole,-this.distance))||this.addPolygonRing(holeCoord,offsetDistance,jsts.geomgraph.Position.opposite(offsetSide),jsts.geom.Location.INTERIOR,jsts.geom.Location.EXTERIOR)};jsts.operation.buffer.OffsetCurveSetBuilder.prototype.addPolygonRing=function(coord,offsetDistance,side,cwLeftLoc,cwRightLoc){var leftLoc,rightLoc,curve;offsetDistance==0&&coord.length<jsts.geom.LinearRing.MINIMUM_VALID_SIZE||(leftLoc=cwLeftLoc,rightLoc=cwRightLoc,coord.length>=jsts.geom.LinearRing.MINIMUM_VALID_SIZE&&jsts.algorithm.CGAlgorithms.isCCW(coord)&&(leftLoc=cwRightLoc,rightLoc=cwLeftLoc,side=jsts.geomgraph.Position.opposite(side)),curve=this.curveBuilder.getRingCurve(coord,side,offsetDistance),this.addCurve(curve,leftLoc,rightLoc))};jsts.operation.buffer.OffsetCurveSetBuilder.prototype.isErodedCompletely=function(ring,bufferDistance){var ringCoord=ring.getCoordinates(),env,envMinDimension;return ringCoord.length<4?bufferDistance<0:ringCoord.length==4?this.isTriangleErodedCompletely(ringCoord,bufferDistance):(env=ring.getEnvelopeInternal(),envMinDimension=Math.min(env.getHeight(),env.getWidth()),bufferDistance<0&&2*Math.abs(bufferDistance)>envMinDimension)?!0:!1};jsts.operation.buffer.OffsetCurveSetBuilder.prototype.isTriangleErodedCompletely=function(triangleCoord,bufferDistance){var tri=new jsts.geom.Triangle(triangleCoord[0],triangleCoord[1],triangleCoord[2]),inCentre=tri.inCentre(),distToCentre=jsts.algorithm.CGAlgorithms.distancePointLine(inCentre,tri.p0,tri.p1);return distToCentre<Math.abs(bufferDistance)};jsts.operation.buffer.BufferSubgraph=function(){this.dirEdgeList=new javascript.util.ArrayList;this.nodes=new javascript.util.ArrayList;this.finder=new jsts.operation.buffer.RightmostEdgeFinder};jsts.operation.buffer.BufferSubgraph.prototype.finder=null;jsts.operation.buffer.BufferSubgraph.prototype.dirEdgeList=null;jsts.operation.buffer.BufferSubgraph.prototype.nodes=null;jsts.operation.buffer.BufferSubgraph.prototype.rightMostCoord=null;jsts.operation.buffer.BufferSubgraph.prototype.env=null;jsts.operation.buffer.BufferSubgraph.prototype.getDirectedEdges=function(){return this.dirEdgeList};jsts.operation.buffer.BufferSubgraph.prototype.getNodes=function(){return this.nodes};jsts.operation.buffer.BufferSubgraph.prototype.getEnvelope=function(){var edgeEnv,it,dirEdge,pts,j;if(this.env===null){for(edgeEnv=new jsts.geom.Envelope,it=this.dirEdgeList.iterator();it.hasNext();)for(dirEdge=it.next(),pts=dirEdge.getEdge().getCoordinates(),j=0;j<pts.length-1;j++)edgeEnv.expandToInclude(pts[j]);this.env=edgeEnv}return this.env};jsts.operation.buffer.BufferSubgraph.prototype.getRightmostCoordinate=function(){return this.rightMostCoord};jsts.operation.buffer.BufferSubgraph.prototype.create=function(node){this.addReachable(node);this.finder.findEdge(this.dirEdgeList);this.rightMostCoord=this.finder.getCoordinate()};jsts.operation.buffer.BufferSubgraph.prototype.addReachable=function(startNode){var nodeStack=[],node;for(nodeStack.push(startNode);nodeStack.length!==0;)node=nodeStack.pop(),this.add(node,nodeStack)};jsts.operation.buffer.BufferSubgraph.prototype.add=function(node,nodeStack){var i,de,sym,symNode;for(node.setVisited(!0),this.nodes.add(node),i=node.getEdges().iterator();i.hasNext();)de=i.next(),this.dirEdgeList.add(de),sym=de.getSym(),symNode=sym.getNode(),symNode.isVisited()||nodeStack.push(symNode)};jsts.operation.buffer.BufferSubgraph.prototype.clearVisitedEdges=function(){for(var de,it=this.dirEdgeList.iterator();it.hasNext();)de=it.next(),de.setVisited(!1)};jsts.operation.buffer.BufferSubgraph.prototype.computeDepth=function(outsideDepth){this.clearVisitedEdges();var de=this.finder.getEdge(),n=de.getNode(),label=de.getLabel();de.setEdgeDepths(jsts.geomgraph.Position.RIGHT,outsideDepth);this.copySymDepths(de);this.computeDepths(de)};jsts.operation.buffer.BufferSubgraph.prototype.computeDepths=function(startEdge){var nodesVisited=[],nodeQueue=[],startNode=startEdge.getNode(),n,i,de,sym,adjNode;for(nodeQueue.push(startNode),nodesVisited.push(startNode),startEdge.setVisited(!0);nodeQueue.length!==0;)for(n=nodeQueue.shift(),nodesVisited.push(n),this.computeNodeDepth(n),i=n.getEdges().iterator();i.hasNext();)(de=i.next(),sym=de.getSym(),sym.isVisited())||(adjNode=sym.getNode(),nodesVisited.indexOf(adjNode)===-1&&(nodeQueue.push(adjNode),nodesVisited.push(adjNode)))};jsts.operation.buffer.BufferSubgraph.prototype.computeNodeDepth=function(n){for(var de,startEdge=null,i=n.getEdges().iterator();i.hasNext();)if(de=i.next(),de.isVisited()||de.getSym().isVisited()){startEdge=de;break}if(startEdge==null)throw new jsts.error.TopologyError("unable to find edge to compute depths at "+n.getCoordinate());for(n.getEdges().computeDepths(startEdge),i=n.getEdges().iterator();i.hasNext();)de=i.next(),de.setVisited(!0),this.copySymDepths(de)};jsts.operation.buffer.BufferSubgraph.prototype.copySymDepths=function(de){var sym=de.getSym();sym.setDepth(jsts.geomgraph.Position.LEFT,de.getDepth(jsts.geomgraph.Position.RIGHT));sym.setDepth(jsts.geomgraph.Position.RIGHT,de.getDepth(jsts.geomgraph.Position.LEFT))};jsts.operation.buffer.BufferSubgraph.prototype.findResultEdges=function(){for(var de,it=this.dirEdgeList.iterator();it.hasNext();)de=it.next(),de.getDepth(jsts.geomgraph.Position.RIGHT)>=1&&de.getDepth(jsts.geomgraph.Position.LEFT)<=0&&!de.isInteriorAreaEdge()&&de.setInResult(!0)};jsts.operation.buffer.BufferSubgraph.prototype.compareTo=function(o){var graph=o;return this.rightMostCoord.x<graph.rightMostCoord.x?-1:this.rightMostCoord.x>graph.rightMostCoord.x?1:0};jsts.geom.util.GeometryExtracter=function(clz,comps){this.clz=clz;this.comps=comps};jsts.geom.util.GeometryExtracter.prototype=new jsts.geom.GeometryFilter;jsts.geom.util.GeometryExtracter.prototype.clz=null;jsts.geom.util.GeometryExtracter.prototype.comps=null;jsts.geom.util.GeometryExtracter.extract=function(geom,clz,list){return list=list||new javascript.util.ArrayList,geom instanceof clz?list.add(geom):(geom instanceof jsts.geom.GeometryCollection||geom instanceof jsts.geom.MultiPoint||geom instanceof jsts.geom.MultiLineString||geom instanceof jsts.geom.MultiPolygon)&&geom.apply(new jsts.geom.util.GeometryExtracter(clz,list)),list};jsts.geom.util.GeometryExtracter.prototype.filter=function(geom){(this.clz===null||geom instanceof this.clz)&&this.comps.add(geom)},function(){var OverlayOp=jsts.operation.overlay.OverlayOp,SnapOverlayOp=jsts.operation.overlay.snap.SnapOverlayOp,SnapIfNeededOverlayOp=function(g1,g2){this.geom=[];this.geom[0]=g1;this.geom[1]=g2};SnapIfNeededOverlayOp.overlayOp=function(g0,g1,opCode){var op=new SnapIfNeededOverlayOp(g0,g1);return op.getResultGeometry(opCode)};SnapIfNeededOverlayOp.intersection=function(g0,g1){return overlayOp(g0,g1,OverlayOp.INTERSECTION)};SnapIfNeededOverlayOp.union=function(g0,g1){return overlayOp(g0,g1,OverlayOp.UNION)};SnapIfNeededOverlayOp.difference=function(g0,g1){return overlayOp(g0,g1,OverlayOp.DIFFERENCE)};SnapIfNeededOverlayOp.symDifference=function(g0,g1){return overlayOp(g0,g1,OverlayOp.SYMDIFFERENCE)};SnapIfNeededOverlayOp.prototype.geom=null;SnapIfNeededOverlayOp.prototype.getResultGeometry=function(opCode){var result=null,isSuccess=!1,savedException=null,isValid;try{result=OverlayOp.overlayOp(this.geom[0],this.geom[1],opCode);isValid=!0;isValid&&(isSuccess=!0)}catch(ex){savedException=ex}if(!isSuccess)try{result=SnapOverlayOp.overlayOp(this.geom[0],this.geom[1],opCode)}catch(ex){throw savedException;}return result};jsts.operation.overlay.snap.SnapIfNeededOverlayOp=SnapIfNeededOverlayOp}(),function(){var GeometryExtracter=jsts.geom.util.GeometryExtracter,CascadedPolygonUnion=jsts.operation.union.CascadedPolygonUnion,PointGeometryUnion=jsts.operation.union.PointGeometryUnion,OverlayOp=jsts.operation.overlay.OverlayOp,SnapIfNeededOverlayOp=jsts.operation.overlay.snap.SnapIfNeededOverlayOp,ArrayList=javascript.util.ArrayList;jsts.operation.union.UnaryUnionOp=function(geoms,geomFact){this.polygons=new ArrayList;this.lines=new ArrayList;this.points=new ArrayList;geomFact&&(this.geomFact=geomFact);this.extract(geoms)};jsts.operation.union.UnaryUnionOp.union=function(geoms,geomFact){var op=new jsts.operation.union.UnaryUnionOp(geoms,geomFact);return op.union()};jsts.operation.union.UnaryUnionOp.prototype.polygons=null;jsts.operation.union.UnaryUnionOp.prototype.lines=null;jsts.operation.union.UnaryUnionOp.prototype.points=null;jsts.operation.union.UnaryUnionOp.prototype.geomFact=null;jsts.operation.union.UnaryUnionOp.prototype.extract=function(geoms){var i,geom;if(geoms instanceof ArrayList)for(i=geoms.iterator();i.hasNext();)geom=i.next(),this.extract(geom);else this.geomFact===null&&(this.geomFact=geoms.getFactory()),GeometryExtracter.extract(geoms,jsts.geom.Polygon,this.polygons),GeometryExtracter.extract(geoms,jsts.geom.LineString,this.lines),GeometryExtracter.extract(geoms,jsts.geom.Point,this.points)};jsts.operation.union.UnaryUnionOp.prototype.union=function(){var unionPoints,ptGeom,unionLines,lineGeom,unionPolygons,unionLA,union;return this.geomFact===null?null:(unionPoints=null,this.points.size()>0&&(ptGeom=this.geomFact.buildGeometry(this.points),unionPoints=this.unionNoOpt(ptGeom)),unionLines=null,this.lines.size()>0&&(lineGeom=this.geomFact.buildGeometry(this.lines),unionLines=this.unionNoOpt(lineGeom)),unionPolygons=null,this.polygons.size()>0&&(unionPolygons=CascadedPolygonUnion.union(this.polygons)),unionLA=this.unionWithNull(unionLines,unionPolygons),union=null,union=unionPoints===null?unionLA:unionLA===null?unionPoints:PointGeometryUnion(unionPoints,unionLA),union===null)?this.geomFact.createGeometryCollection(null):union};jsts.operation.union.UnaryUnionOp.prototype.unionWithNull=function(g0,g1){return g0===null&&g1===null?null:g1===null?g0:g0===null?g1:g0.union(g1)};jsts.operation.union.UnaryUnionOp.prototype.unionNoOpt=function(g0){var empty=this.geomFact.createPoint(null);return SnapIfNeededOverlayOp.overlayOp(g0,empty,OverlayOp.UNION)}}();jsts.index.kdtree.KdNode=function(){this.left=null;this.right=null;this.count=1;arguments.length===2?this.initializeFromCoordinate.apply(this,arguments[0],arguments[1]):arguments.length===3&&this.initializeFromXY.apply(this,arguments[0],arguments[1],arguments[2])};jsts.index.kdtree.KdNode.prototype.initializeFromXY=function(x,y,data){this.p=new jsts.geom.Coordinate(x,y);this.data=data};jsts.index.kdtree.KdNode.prototype.initializeFromCoordinate=function(p,data){this.p=p;this.data=data};jsts.index.kdtree.KdNode.prototype.getX=function(){return this.p.x};jsts.index.kdtree.KdNode.prototype.getY=function(){return this.p.y};jsts.index.kdtree.KdNode.prototype.getCoordinate=function(){return this.p};jsts.index.kdtree.KdNode.prototype.getData=function(){return this.data};jsts.index.kdtree.KdNode.prototype.getLeft=function(){return this.left};jsts.index.kdtree.KdNode.prototype.getRight=function(){return this.right};jsts.index.kdtree.KdNode.prototype.increment=function(){this.count+=1};jsts.index.kdtree.KdNode.prototype.getCount=function(){return this.count};jsts.index.kdtree.KdNode.prototype.isRepeated=function(){return count>1};jsts.index.kdtree.KdNode.prototype.setLeft=function(left){this.left=left};jsts.index.kdtree.KdNode.prototype.setRight=function(right){this.right=right};jsts.algorithm.InteriorPointPoint=function(geometry){this.minDistance=Number.MAX_VALUE;this.interiorPoint=null;this.centroid=geometry.getCentroid().getCoordinate();this.add(geometry)};jsts.algorithm.InteriorPointPoint.prototype.add=function(geometry){if(geometry instanceof jsts.geom.Point)this.addPoint(geometry.getCoordinate());else if(geometry instanceof jsts.geom.GeometryCollection)for(var i=0;i<geometry.getNumGeometries();i++)this.add(geometry.getGeometryN(i))};jsts.algorithm.InteriorPointPoint.prototype.addPoint=function(point){var dist=point.distance(this.centroid);dist<this.minDistance&&(this.interiorPoint=new jsts.geom.Coordinate(point),this.minDistance=dist)};jsts.algorithm.InteriorPointPoint.prototype.getInteriorPoint=function(){return this.interiorPoint},function(){jsts.geom.MultiLineString=function(geometries,factory){this.geometries=geometries||[];this.factory=factory};jsts.geom.MultiLineString.prototype=new jsts.geom.GeometryCollection;jsts.geom.MultiLineString.constructor=jsts.geom.MultiLineString;jsts.geom.MultiLineString.prototype.getBoundary=function(){return new jsts.operation.BoundaryOp(this).getBoundary()};jsts.geom.MultiLineString.prototype.equalsExact=function(other,tolerance){return this.isEquivalentClass(other)?jsts.geom.GeometryCollection.prototype.equalsExact.call(this,other,tolerance):!1};jsts.geom.MultiLineString.prototype.CLASS_NAME="jsts.geom.MultiLineString"}();jsts.algorithm.InteriorPointArea=function(geometry){this.factory;this.interiorPoint=null;this.maxWidth=0;this.factory=geometry.getFactory();this.add(geometry)};jsts.algorithm.InteriorPointArea.avg=function(a,b){return(a+b)/2};jsts.algorithm.InteriorPointArea.prototype.getInteriorPoint=function(){return this.interiorPoint};jsts.algorithm.InteriorPointArea.prototype.add=function(geometry){if(geometry instanceof jsts.geom.Polygon)this.addPolygon(geometry);else if(geometry instanceof jsts.geom.GeometryCollection)for(var i=0;i<geometry.getNumGeometries();i++)this.add(geometry.getGeometryN(i))};jsts.algorithm.InteriorPointArea.prototype.addPolygon=function(geometry){var intPt,width,bisector,intersections,widestIntersection;geometry.isEmpty()||(width=0,bisector=this.horizontalBisector(geometry),bisector.getLength()==0?(width=0,intPt=bisector.getCoordinate()):(intersections=bisector.intersection(geometry),widestIntersection=this.widestGeometry(intersections),width=widestIntersection.getEnvelopeInternal().getWidth(),intPt=this.centre(widestIntersection.getEnvelopeInternal())),(this.interiorPoint==null||width>this.maxWidth)&&(this.interiorPoint=intPt,this.maxWidth=width))};jsts.algorithm.InteriorPointArea.prototype.widestGeometry=function(obj){var gc,widestGeometry,i;if(obj instanceof jsts.geom.GeometryCollection){if(gc=obj,gc.isEmpty())return gc;for(widestGeometry=gc.getGeometryN(0),i=1;i<gc.getNumGeometries();i++)gc.getGeometryN(i).getEnvelopeInternal().getWidth()>widestGeometry.getEnvelopeInternal().getWidth()&&(widestGeometry=gc.getGeometryN(i));return widestGeometry}if(obj instanceof jsts.geom.Geometry)return obj};jsts.algorithm.InteriorPointArea.prototype.horizontalBisector=function(geometry){var envelope=geometry.getEnvelopeInternal(),bisectY=jsts.algorithm.SafeBisectorFinder.getBisectorY(geometry);return this.factory.createLineString([new jsts.geom.Coordinate(envelope.getMinX(),bisectY),new jsts.geom.Coordinate(envelope.getMaxX(),bisectY)])};jsts.algorithm.InteriorPointArea.prototype.centre=function(envelope){return new jsts.geom.Coordinate(jsts.algorithm.InteriorPointArea.avg(envelope.getMinX(),envelope.getMaxX()),jsts.algorithm.InteriorPointArea.avg(envelope.getMinY(),envelope.getMaxY()))};jsts.algorithm.SafeBisectorFinder=function(poly){this.poly;this.centreY;this.hiY=Number.MAX_VALUE;this.loY=-Number.MAX_VALUE;this.poly=poly;this.hiY=poly.getEnvelopeInternal().getMaxY();this.loY=poly.getEnvelopeInternal().getMinY();this.centreY=jsts.algorithm.InteriorPointArea.avg(this.loY,this.hiY)};jsts.algorithm.SafeBisectorFinder.getBisectorY=function(poly){var finder=new jsts.algorithm.SafeBisectorFinder(poly);return finder.getBisectorY()};jsts.algorithm.SafeBisectorFinder.prototype.getBisectorY=function(){var i;for(this.process(this.poly.getExteriorRing()),i=0;i<this.poly.getNumInteriorRing();i++)this.process(this.poly.getInteriorRingN(i));return jsts.algorithm.InteriorPointArea.avg(this.hiY,this.loY)};jsts.algorithm.SafeBisectorFinder.prototype.process=function(line){for(var y,seq=line.getCoordinateSequence(),i=0;i<seq.length;i++)y=seq[i].y,this.updateInterval(y)};jsts.algorithm.SafeBisectorFinder.prototype.updateInterval=function(y){y<=this.centreY?y>this.loY&&(this.loY=y):y>this.centreY&&y<this.hiY&&(this.hiY=y)};jsts.operation.buffer.BufferParameters=function(quadrantSegments,endCapStyle,joinStyle,mitreLimit){quadrantSegments&&this.setQuadrantSegments(quadrantSegments);endCapStyle&&this.setEndCapStyle(endCapStyle);joinStyle&&this.setJoinStyle(joinStyle);mitreLimit&&this.setMitreLimit(mitreLimit)};jsts.operation.buffer.BufferParameters.CAP_ROUND=1;jsts.operation.buffer.BufferParameters.CAP_FLAT=2;jsts.operation.buffer.BufferParameters.CAP_SQUARE=3;jsts.operation.buffer.BufferParameters.JOIN_ROUND=1;jsts.operation.buffer.BufferParameters.JOIN_MITRE=2;jsts.operation.buffer.BufferParameters.JOIN_BEVEL=3;jsts.operation.buffer.BufferParameters.DEFAULT_QUADRANT_SEGMENTS=8;jsts.operation.buffer.BufferParameters.DEFAULT_MITRE_LIMIT=5;jsts.operation.buffer.BufferParameters.prototype.quadrantSegments=jsts.operation.buffer.BufferParameters.DEFAULT_QUADRANT_SEGMENTS;jsts.operation.buffer.BufferParameters.prototype.endCapStyle=jsts.operation.buffer.BufferParameters.CAP_ROUND;jsts.operation.buffer.BufferParameters.prototype.joinStyle=jsts.operation.buffer.BufferParameters.JOIN_ROUND;jsts.operation.buffer.BufferParameters.prototype.mitreLimit=jsts.operation.buffer.BufferParameters.DEFAULT_MITRE_LIMIT;jsts.operation.buffer.BufferParameters.prototype._isSingleSided=!1;jsts.operation.buffer.BufferParameters.prototype.getQuadrantSegments=function(){return this.quadrantSegments};jsts.operation.buffer.BufferParameters.prototype.setQuadrantSegments=function(quadrantSegments){this.quadrantSegments=quadrantSegments};jsts.operation.buffer.BufferParameters.prototype.setQuadrantSegments=function(quadSegs){this.quadrantSegments=quadSegs;this.quadrantSegments===0&&(this.joinStyle=jsts.operation.buffer.BufferParameters.JOIN_BEVEL);this.quadrantSegments<0&&(this.joinStyle=jsts.operation.buffer.BufferParameters.JOIN_MITRE,this.mitreLimit=Math.abs(this.quadrantSegments));quadSegs<=0&&(this.quadrantSegments=1);this.joinStyle!==jsts.operation.buffer.BufferParameters.JOIN_ROUND&&(this.quadrantSegments=jsts.operation.buffer.BufferParameters.DEFAULT_QUADRANT_SEGMENTS)};jsts.operation.buffer.BufferParameters.bufferDistanceError=function(quadSegs){var alpha=Math.PI/2/quadSegs;return 1-Math.cos(alpha/2)};jsts.operation.buffer.BufferParameters.prototype.getEndCapStyle=function(){return this.endCapStyle};jsts.operation.buffer.BufferParameters.prototype.setEndCapStyle=function(endCapStyle){this.endCapStyle=endCapStyle};jsts.operation.buffer.BufferParameters.prototype.getJoinStyle=function(){return this.joinStyle};jsts.operation.buffer.BufferParameters.prototype.setJoinStyle=function(joinStyle){this.joinStyle=joinStyle};jsts.operation.buffer.BufferParameters.prototype.getMitreLimit=function(){return this.mitreLimit};jsts.operation.buffer.BufferParameters.prototype.setMitreLimit=function(mitreLimit){this.mitreLimit=mitreLimit};jsts.operation.buffer.BufferParameters.prototype.setSingleSided=function(isSingleSided){this._isSingleSided=isSingleSided};jsts.operation.buffer.BufferParameters.prototype.isSingleSided=function(){return this._isSingleSided};jsts.operation.buffer.BufferBuilder=function(bufParams){this.bufParams=bufParams;this.edgeList=new jsts.geomgraph.EdgeList};jsts.operation.buffer.BufferBuilder.depthDelta=function(label){var lLoc=label.getLocation(0,jsts.geomgraph.Position.LEFT),rLoc=label.getLocation(0,jsts.geomgraph.Position.RIGHT);return lLoc===jsts.geom.Location.INTERIOR&&rLoc===jsts.geom.Location.EXTERIOR?1:lLoc===jsts.geom.Location.EXTERIOR&&rLoc===jsts.geom.Location.INTERIOR?-1:0};jsts.operation.buffer.BufferBuilder.prototype.bufParams=null;jsts.operation.buffer.BufferBuilder.prototype.workingPrecisionModel=null;jsts.operation.buffer.BufferBuilder.prototype.workingNoder=null;jsts.operation.buffer.BufferBuilder.prototype.geomFact=null;jsts.operation.buffer.BufferBuilder.prototype.graph=null;jsts.operation.buffer.BufferBuilder.prototype.edgeList=null;jsts.operation.buffer.BufferBuilder.prototype.setWorkingPrecisionModel=function(pm){this.workingPrecisionModel=pm};jsts.operation.buffer.BufferBuilder.prototype.setNoder=function(noder){this.workingNoder=noder};jsts.operation.buffer.BufferBuilder.prototype.buffer=function(g,distance){var precisionModel=this.workingPrecisionModel,subgraphList,polyBuilder,resultPolyList;precisionModel===null&&(precisionModel=g.getPrecisionModel());this.geomFact=g.getFactory();var curveBuilder=new jsts.operation.buffer.OffsetCurveBuilder(precisionModel,this.bufParams),curveSetBuilder=new jsts.operation.buffer.OffsetCurveSetBuilder(g,distance,curveBuilder),bufferSegStrList=curveSetBuilder.getCurves();return bufferSegStrList.size()<=0?this.createEmptyResultGeometry():(this.computeNodedEdges(bufferSegStrList,precisionModel),this.graph=new jsts.geomgraph.PlanarGraph(new jsts.operation.overlay.OverlayNodeFactory),this.graph.addEdges(this.edgeList.getEdges()),subgraphList=this.createSubgraphs(this.graph),polyBuilder=new jsts.operation.overlay.PolygonBuilder(this.geomFact),this.buildSubgraphs(subgraphList,polyBuilder),resultPolyList=polyBuilder.getPolygons(),resultPolyList.size()<=0)?this.createEmptyResultGeometry():this.geomFact.buildGeometry(resultPolyList)};jsts.operation.buffer.BufferBuilder.prototype.getNoder=function(precisionModel){if(this.workingNoder!==null)return this.workingNoder;var noder=new jsts.noding.MCIndexNoder,li=new jsts.algorithm.RobustLineIntersector;return li.setPrecisionModel(precisionModel),noder.setSegmentIntersector(new jsts.noding.IntersectionAdder(li)),noder};jsts.operation.buffer.BufferBuilder.prototype.computeNodedEdges=function(bufferSegStrList,precisionModel){var noder=this.getNoder(precisionModel),nodedSegStrings,i;for(noder.computeNodes(bufferSegStrList),nodedSegStrings=noder.getNodedSubstrings(),i=nodedSegStrings.iterator();i.hasNext();){var segStr=i.next(),oldLabel=segStr.getData(),edge=new jsts.geomgraph.Edge(segStr.getCoordinates(),new jsts.geomgraph.Label(oldLabel));this.insertUniqueEdge(edge)}};jsts.operation.buffer.BufferBuilder.prototype.insertUniqueEdge=function(e){var existingEdge=this.edgeList.findEqualEdge(e),existingLabel,labelToMerge;if(existingEdge!=null){existingLabel=existingEdge.getLabel();labelToMerge=e.getLabel();existingEdge.isPointwiseEqual(e)||(labelToMerge=new jsts.geomgraph.Label(e.getLabel()),labelToMerge.flip());existingLabel.merge(labelToMerge);var mergeDelta=jsts.operation.buffer.BufferBuilder.depthDelta(labelToMerge),existingDelta=existingEdge.getDepthDelta(),newDelta=existingDelta+mergeDelta;existingEdge.setDepthDelta(newDelta)}else this.edgeList.add(e),e.setDepthDelta(jsts.operation.buffer.BufferBuilder.depthDelta(e.getLabel()))};jsts.operation.buffer.BufferBuilder.prototype.createSubgraphs=function(graph){for(var node,subgraph,compare,subgraphList=[],i=graph.getNodes().iterator();i.hasNext();)node=i.next(),node.isVisited()||(subgraph=new jsts.operation.buffer.BufferSubgraph,subgraph.create(node),subgraphList.push(subgraph));return compare=function(a,b){return a.compareTo(b)},subgraphList.sort(compare),subgraphList.reverse(),subgraphList};jsts.operation.buffer.BufferBuilder.prototype.buildSubgraphs=function(subgraphList,polyBuilder){for(var processedGraphs=[],i=0;i<subgraphList.length;i++){var subgraph=subgraphList[i],p=subgraph.getRightmostCoordinate(),locater=new jsts.operation.buffer.SubgraphDepthLocater(processedGraphs),outsideDepth=locater.getDepth(p);subgraph.computeDepth(outsideDepth);subgraph.findResultEdges();processedGraphs.push(subgraph);polyBuilder.add(subgraph.getDirectedEdges(),subgraph.getNodes())}};jsts.operation.buffer.BufferBuilder.convertSegStrings=function(it){for(var fact=new jsts.geom.GeometryFactory,lines=new javascript.util.ArrayList,ss,line;it.hasNext();)ss=it.next(),line=fact.createLineString(ss.getCoordinates()),lines.add(line);return fact.buildGeometry(lines)};jsts.operation.buffer.BufferBuilder.prototype.createEmptyResultGeometry=function(){return this.geomFact.createPolygon(null,null)};jsts.operation.relate.RelateOp=function(){jsts.operation.GeometryGraphOperation.apply(this,arguments);this._relate=new jsts.operation.relate.RelateComputer(this.arg)};jsts.operation.relate.RelateOp.prototype=new jsts.operation.GeometryGraphOperation;jsts.operation.relate.RelateOp.relate=function(a,b,boundaryNodeRule){var relOp=new jsts.operation.relate.RelateOp(a,b,boundaryNodeRule);return relOp.getIntersectionMatrix()};jsts.operation.relate.RelateOp.prototype._relate=null;jsts.operation.relate.RelateOp.prototype.getIntersectionMatrix=function(){return this._relate.computeIM()};jsts.index.chain.MonotoneChain=function(pts,start,end,context){this.pts=pts;this.start=start;this.end=end;this.context=context};jsts.index.chain.MonotoneChain.prototype.pts=null;jsts.index.chain.MonotoneChain.prototype.start=null;jsts.index.chain.MonotoneChain.prototype.end=null;jsts.index.chain.MonotoneChain.prototype.env=null;jsts.index.chain.MonotoneChain.prototype.context=null;jsts.index.chain.MonotoneChain.prototype.id=null;jsts.index.chain.MonotoneChain.prototype.setId=function(id){this.id=id};jsts.index.chain.MonotoneChain.prototype.getId=function(){return this.id};jsts.index.chain.MonotoneChain.prototype.getContext=function(){return this.context};jsts.index.chain.MonotoneChain.prototype.getEnvelope=function(){if(this.env==null){var p0=this.pts[this.start],p1=this.pts[this.end];this.env=new jsts.geom.Envelope(p0,p1)}return this.env};jsts.index.chain.MonotoneChain.prototype.getStartIndex=function(){return this.start};jsts.index.chain.MonotoneChain.prototype.getEndIndex=function(){return this.end};jsts.index.chain.MonotoneChain.prototype.getLineSegment=function(index,ls){ls.p0=this.pts[index];ls.p1=this.pts[index+1]};jsts.index.chain.MonotoneChain.prototype.getCoordinates=function(){for(var coord=[],index=0,i=this.start;i<=this.end;i++)coord[index++]=this.pts[i];return coord};jsts.index.chain.MonotoneChain.prototype.select=function(searchEnv,mcs){this.computeSelect2(searchEnv,this.start,this.end,mcs)};jsts.index.chain.MonotoneChain.prototype.computeSelect2=function(searchEnv,start0,end0,mcs){var p0=this.pts[start0],p1=this.pts[end0],mid;if(mcs.tempEnv1.init(p0,p1),end0-start0==1){mcs.select(this,start0);return}searchEnv.intersects(mcs.tempEnv1)&&(mid=parseInt((start0+end0)/2),start0<mid&&this.computeSelect2(searchEnv,start0,mid,mcs),mid<end0&&this.computeSelect2(searchEnv,mid,end0,mcs))};jsts.index.chain.MonotoneChain.prototype.computeOverlaps=function(mc,mco){if(arguments.length===6)return this.computeOverlaps2.apply(this,arguments);this.computeOverlaps2(this.start,this.end,mc,mc.start,mc.end,mco)};jsts.index.chain.MonotoneChain.prototype.computeOverlaps2=function(start0,end0,mc,start1,end1,mco){var p00=this.pts[start0],p01=this.pts[end0],p10=mc.pts[start1],p11=mc.pts[end1],mid0,mid1;if(end0-start0==1&&end1-start1==1){mco.overlap(this,start0,mc,start1);return}(mco.tempEnv1.init(p00,p01),mco.tempEnv2.init(p10,p11),mco.tempEnv1.intersects(mco.tempEnv2))&&(mid0=parseInt((start0+end0)/2),mid1=parseInt((start1+end1)/2),start0<mid0&&(start1<mid1&&this.computeOverlaps2(start0,mid0,mc,start1,mid1,mco),mid1<end1&&this.computeOverlaps2(start0,mid0,mc,mid1,end1,mco)),mid0<end0&&(start1<mid1&&this.computeOverlaps2(mid0,end0,mc,start1,mid1,mco),mid1<end1&&this.computeOverlaps2(mid0,end0,mc,mid1,end1,mco)))};jsts.algorithm.HCoordinate=function(){this.x=0;this.y=0;this.w=1;arguments.length===1?this.initFrom1Coordinate(arguments[0]):arguments.length===2&&arguments[0]instanceof jsts.geom.Coordinate?this.initFrom2Coordinates(arguments[0],arguments[1]):arguments.length===2&&arguments[0]instanceof jsts.algorithm.HCoordinate?this.initFrom2HCoordinates(arguments[0],arguments[1]):arguments.length===2?this.initFromXY(arguments[0],arguments[1]):arguments.length===3?this.initFromXYW(arguments[0],arguments[1],arguments[2]):arguments.length===4&&this.initFromXYW(arguments[0],arguments[1],arguments[2],arguments[3])};jsts.algorithm.HCoordinate.intersection=function(p1,p2,q1,q2){var px,py,pw,qx,qy,qw,x,y,w,xInt,yInt;if(px=p1.y-p2.y,py=p2.x-p1.x,pw=p1.x*p2.y-p2.x*p1.y,qx=q1.y-q2.y,qy=q2.x-q1.x,qw=q1.x*q2.y-q2.x*q1.y,x=py*qw-qy*pw,y=qx*pw-px*qw,w=px*qy-qx*py,xInt=x/w,yInt=y/w,!isFinite(xInt)||!isFinite(yInt))throw new jsts.error.NotRepresentableError;return new jsts.geom.Coordinate(xInt,yInt)};jsts.algorithm.HCoordinate.prototype.initFrom1Coordinate=function(p){this.x=p.x;this.y=p.y;this.w=1};jsts.algorithm.HCoordinate.prototype.initFrom2Coordinates=function(p1,p2){this.x=p1.y-p2.y;this.y=p2.x-p1.x;this.w=p1.x*p2.y-p2.x*p1.y};jsts.algorithm.HCoordinate.prototype.initFrom2HCoordinates=function(p1,p2){this.x=p1.y*p2.w-p2.y*p1.w;this.y=p2.x*p1.w-p1.x*p2.w;this.w=p1.x*p2.y-p2.x*p1.y};jsts.algorithm.HCoordinate.prototype.initFromXYW=function(x,y,w){this.x=x;this.y=y;this.w=w};jsts.algorithm.HCoordinate.prototype.initFromXY=function(x,y){this.x=x;this.y=y;this.w=1};jsts.algorithm.HCoordinate.prototype.initFrom4Coordinates=function(p1,p2,q1,q2){var px,py,pw,qx,qy,qw;px=p1.y-p2.y;py=p2.x-p1.x;pw=p1.x*p2.y-p2.x*p1.y;qx=q1.y-q2.y;qy=q2.x-q1.x;qw=q1.x*q2.y-q2.x*q1.y;this.x=py*qw-qy*pw;this.y=qx*pw-px*qw;this.w=px*qy-qx*py};jsts.algorithm.HCoordinate.prototype.getX=function(){var a=this.x/this.w;if(!isFinite(a))throw new jsts.error.NotRepresentableError;return a};jsts.algorithm.HCoordinate.prototype.getY=function(){var a=this.y/this.w;if(!isFinite(a))throw new jsts.error.NotRepresentableError;return a};jsts.algorithm.HCoordinate.prototype.getCoordinate=function(){var p=new jsts.geom.Coordinate;return p.x=this.getX(),p.y=this.getY(),p},function(){var Location=jsts.geom.Location,Dimension=jsts.geom.Dimension;jsts.geom.IntersectionMatrix=function(elements){var other=elements;elements===undefined||elements===null?(this.matrix=[[],[],[]],this.setAll(Dimension.FALSE)):typeof elements=="string"?this.set(elements):other instanceof jsts.geom.IntersectionMatrix&&(this.matrix[Location.INTERIOR][Location.INTERIOR]=other.matrix[Location.INTERIOR][Location.INTERIOR],this.matrix[Location.INTERIOR][Location.BOUNDARY]=other.matrix[Location.INTERIOR][Location.BOUNDARY],this.matrix[Location.INTERIOR][Location.EXTERIOR]=other.matrix[Location.INTERIOR][Location.EXTERIOR],this.matrix[Location.BOUNDARY][Location.INTERIOR]=other.matrix[Location.BOUNDARY][Location.INTERIOR],this.matrix[Location.BOUNDARY][Location.BOUNDARY]=other.matrix[Location.BOUNDARY][Location.BOUNDARY],this.matrix[Location.BOUNDARY][Location.EXTERIOR]=other.matrix[Location.BOUNDARY][Location.EXTERIOR],this.matrix[Location.EXTERIOR][Location.INTERIOR]=other.matrix[Location.EXTERIOR][Location.INTERIOR],this.matrix[Location.EXTERIOR][Location.BOUNDARY]=other.matrix[Location.EXTERIOR][Location.BOUNDARY],this.matrix[Location.EXTERIOR][Location.EXTERIOR]=other.matrix[Location.EXTERIOR][Location.EXTERIOR])};jsts.geom.IntersectionMatrix.prototype.matrix=null;jsts.geom.IntersectionMatrix.prototype.add=function(im){for(var j,i=0;i<3;i++)for(j=0;j<3;j++)this.setAtLeast(i,j,im.get(i,j))};jsts.geom.IntersectionMatrix.matches=function(actualDimensionValue,requiredDimensionSymbol){return typeof actualDimensionValue=="string"?jsts.geom.IntersectionMatrix.matches2.call(this,arguments):requiredDimensionSymbol==="*"?!0:requiredDimensionSymbol==="T"&&(actualDimensionValue>=0||actualDimensionValue===Dimension.TRUE)?!0:requiredDimensionSymbol==="F"&&actualDimensionValue===Dimension.FALSE?!0:requiredDimensionSymbol==="0"&&actualDimensionValue===Dimension.P?!0:requiredDimensionSymbol==="1"&&actualDimensionValue===Dimension.L?!0:requiredDimensionSymbol==="2"&&actualDimensionValue===Dimension.A?!0:!1};jsts.geom.IntersectionMatrix.matches2=function(actualDimensionSymbols,requiredDimensionSymbols){var m=new jsts.geom.IntersectionMatrix(actualDimensionSymbols);return m.matches(requiredDimensionSymbols)};jsts.geom.IntersectionMatrix.prototype.set=function(row,column,dimensionValue){if(typeof row=="string"){this.set2(row);return}this.matrix[row][column]=dimensionValue};jsts.geom.IntersectionMatrix.prototype.set2=function(dimensionSymbols){for(var row,col,i=0;i<dimensionSymbols.length();i++)row=i/3,col=i%3,this.matrix[row][col]=Dimension.toDimensionValue(dimensionSymbols.charAt(i))};jsts.geom.IntersectionMatrix.prototype.setAtLeast=function(row,column,minimumDimensionValue){if(arguments.length===1){this.setAtLeast2(arguments[0]);return}this.matrix[row][column]<minimumDimensionValue&&(this.matrix[row][column]=minimumDimensionValue)};jsts.geom.IntersectionMatrix.prototype.setAtLeastIfValid=function(row,column,minimumDimensionValue){row>=0&&column>=0&&this.setAtLeast(row,column,minimumDimensionValue)};jsts.geom.IntersectionMatrix.prototype.setAtLeast2=function(minimumDimensionSymbols){for(var row,col,i=0;i<minimumDimensionSymbols.length;i++)row=parseInt(i/3),col=parseInt(i%3),this.setAtLeast(row,col,jsts.geom.Dimension.toDimensionValue(minimumDimensionSymbols.charAt(i)))};jsts.geom.IntersectionMatrix.prototype.setAll=function(dimensionValue){for(var bi,ai=0;ai<3;ai++)for(bi=0;bi<3;bi++)this.matrix[ai][bi]=dimensionValue};jsts.geom.IntersectionMatrix.prototype.get=function(row,column){return this.matrix[row][column]};jsts.geom.IntersectionMatrix.prototype.isDisjoint=function(){return this.matrix[Location.INTERIOR][Location.INTERIOR]===Dimension.FALSE&&this.matrix[Location.INTERIOR][Location.BOUNDARY]===Dimension.FALSE&&this.matrix[Location.BOUNDARY][Location.INTERIOR]===Dimension.FALSE&&this.matrix[Location.BOUNDARY][Location.BOUNDARY]===Dimension.FALSE};jsts.geom.IntersectionMatrix.prototype.isIntersects=function(){return!this.isDisjoint()};jsts.geom.IntersectionMatrix.prototype.isTouches=function(dimensionOfGeometryA,dimensionOfGeometryB){return dimensionOfGeometryA>dimensionOfGeometryB?this.isTouches(dimensionOfGeometryB,dimensionOfGeometryA):dimensionOfGeometryA==Dimension.A&&dimensionOfGeometryB==Dimension.A||dimensionOfGeometryA==Dimension.L&&dimensionOfGeometryB==Dimension.L||dimensionOfGeometryA==Dimension.L&&dimensionOfGeometryB==Dimension.A||dimensionOfGeometryA==Dimension.P&&dimensionOfGeometryB==Dimension.A||dimensionOfGeometryA==Dimension.P&&dimensionOfGeometryB==Dimension.L?this.matrix[Location.INTERIOR][Location.INTERIOR]===Dimension.FALSE&&(jsts.geom.IntersectionMatrix.matches(this.matrix[Location.INTERIOR][Location.BOUNDARY],"T")||jsts.geom.IntersectionMatrix.matches(this.matrix[Location.BOUNDARY][Location.INTERIOR],"T")||jsts.geom.IntersectionMatrix.matches(this.matrix[Location.BOUNDARY][Location.BOUNDARY],"T")):!1};jsts.geom.IntersectionMatrix.prototype.isCrosses=function(dimensionOfGeometryA,dimensionOfGeometryB){return dimensionOfGeometryA==Dimension.P&&dimensionOfGeometryB==Dimension.L||dimensionOfGeometryA==Dimension.P&&dimensionOfGeometryB==Dimension.A||dimensionOfGeometryA==Dimension.L&&dimensionOfGeometryB==Dimension.A?jsts.geom.IntersectionMatrix.matches(this.matrix[Location.INTERIOR][Location.INTERIOR],"T")&&jsts.geom.IntersectionMatrix.matches(this.matrix[Location.INTERIOR][Location.EXTERIOR],"T"):dimensionOfGeometryA==Dimension.L&&dimensionOfGeometryB==Dimension.P||dimensionOfGeometryA==Dimension.A&&dimensionOfGeometryB==Dimension.P||dimensionOfGeometryA==Dimension.A&&dimensionOfGeometryB==Dimension.L?jsts.geom.IntersectionMatrix.matches(matrix[Location.INTERIOR][Location.INTERIOR],"T")&&jsts.geom.IntersectionMatrix.matches(this.matrix[Location.EXTERIOR][Location.INTERIOR],"T"):dimensionOfGeometryA===Dimension.L&&dimensionOfGeometryB===Dimension.L?this.matrix[Location.INTERIOR][Location.INTERIOR]===0:!1};jsts.geom.IntersectionMatrix.prototype.isWithin=function(){return jsts.geom.IntersectionMatrix.matches(this.matrix[Location.INTERIOR][Location.INTERIOR],"T")&&this.matrix[Location.INTERIOR][Location.EXTERIOR]==Dimension.FALSE&&this.matrix[Location.BOUNDARY][Location.EXTERIOR]==Dimension.FALSE};jsts.geom.IntersectionMatrix.prototype.isContains=function(){return jsts.geom.IntersectionMatrix.matches(this.matrix[Location.INTERIOR][Location.INTERIOR],"T")&&this.matrix[Location.EXTERIOR][Location.INTERIOR]==Dimension.FALSE&&this.matrix[Location.EXTERIOR][Location.BOUNDARY]==Dimension.FALSE};jsts.geom.IntersectionMatrix.prototype.isCovers=function(){var hasPointInCommon=jsts.geom.IntersectionMatrix.matches(this.matrix[Location.INTERIOR][Location.INTERIOR],"T")||jsts.geom.IntersectionMatrix.matches(this.matrix[Location.INTERIOR][Location.BOUNDARY],"T")||jsts.geom.IntersectionMatrix.matches(this.matrix[Location.BOUNDARY][Location.INTERIOR],"T")||jsts.geom.IntersectionMatrix.matches(this.matrix[Location.BOUNDARY][Location.BOUNDARY],"T");return hasPointInCommon&&this.matrix[Location.EXTERIOR][Location.INTERIOR]==Dimension.FALSE&&this.matrix[Location.EXTERIOR][Location.BOUNDARY]==Dimension.FALSE};jsts.geom.IntersectionMatrix.prototype.isCoveredBy=function(){var hasPointInCommon=jsts.geom.IntersectionMatrix.matches(this.matrix[Location.INTERIOR][Location.INTERIOR],"T")||jsts.geom.IntersectionMatrix.matches(this.matrix[Location.INTERIOR][Location.BOUNDARY],"T")||jsts.geom.IntersectionMatrix.matches(this.matrix[Location.BOUNDARY][Location.INTERIOR],"T")||jsts.geom.IntersectionMatrix.matches(this.matrix[Location.BOUNDARY][Location.BOUNDARY],"T");return hasPointInCommon&&this.matrix[Location.INTERIOR][Location.EXTERIOR]===Dimension.FALSE&&this.matrix[Location.BOUNDARY][Location.EXTERIOR]===Dimension.FALSE};jsts.geom.IntersectionMatrix.prototype.isEquals=function(dimensionOfGeometryA,dimensionOfGeometryB){return dimensionOfGeometryA!==dimensionOfGeometryB?!1:jsts.geom.IntersectionMatrix.matches(this.matrix[Location.INTERIOR][Location.INTERIOR],"T")&&this.matrix[Location.EXTERIOR][Location.INTERIOR]===Dimension.FALSE&&this.matrix[Location.INTERIOR][Location.EXTERIOR]===Dimension.FALSE&&this.matrix[Location.EXTERIOR][Location.BOUNDARY]===Dimension.FALSE&&this.matrix[Location.BOUNDARY][Location.EXTERIOR]===Dimension.FALSE};jsts.geom.IntersectionMatrix.prototype.isOverlaps=function(dimensionOfGeometryA,dimensionOfGeometryB){return dimensionOfGeometryA==Dimension.P&&dimensionOfGeometryB===Dimension.P||dimensionOfGeometryA==Dimension.A&&dimensionOfGeometryB===Dimension.A?jsts.geom.IntersectionMatrix.matches(this.matrix[Location.INTERIOR][Location.INTERIOR],"T")&&jsts.geom.IntersectionMatrix.matches(this.matrix[Location.INTERIOR][Location.EXTERIOR],"T")&&jsts.geom.IntersectionMatrix.matches(this.matrix[Location.EXTERIOR][Location.INTERIOR],"T"):dimensionOfGeometryA===Dimension.L&&dimensionOfGeometryB===Dimension.L?this.matrix[Location.INTERIOR][Location.INTERIOR]==1&&jsts.geom.IntersectionMatrix.matches(this.matrix[Location.INTERIOR][Location.EXTERIOR],"T")&&jsts.geom.IntersectionMatrix.matches(this.matrix[Location.EXTERIOR][Location.INTERIOR],"T"):!1};jsts.geom.IntersectionMatrix.prototype.matches=function(requiredDimensionSymbols){var ai,bi;if(requiredDimensionSymbols.length!=9)throw new jsts.error.IllegalArgumentException("Should be length 9: "+requiredDimensionSymbols);for(ai=0;ai<3;ai++)for(bi=0;bi<3;bi++)if(!jsts.geom.IntersectionMatrix.matches(this.matrix[ai][bi],requiredDimensionSymbols.charAt(3*ai+bi)))return!1;return!0};jsts.geom.IntersectionMatrix.prototype.transpose=function(){var temp=matrix[1][0];return this.matrix[1][0]=this.matrix[0][1],this.matrix[0][1]=temp,temp=this.matrix[2][0],this.matrix[2][0]=this.matrix[0][2],this.matrix[0][2]=temp,temp=this.matrix[2][1],this.matrix[2][1]=this.matrix[1][2],this.matrix[1][2]=temp,this};jsts.geom.IntersectionMatrix.prototype.toString=function(){for(var bi,buf="",ai=0;ai<3;ai++)for(bi=0;bi<3;bi++)buf+=Dimension.toDimensionSymbol(this.matrix[ai][bi]);return buf}}();jsts.triangulate.quadedge.LastFoundQuadEdgeLocator=function(subdiv){this.subdiv=subdiv;this.lastEdge=null;this.init()};jsts.triangulate.quadedge.LastFoundQuadEdgeLocator.prototype.init=function(){this.lastEdge=this.findEdge()};jsts.triangulate.quadedge.LastFoundQuadEdgeLocator.prototype.findEdge=function(){var edges=this.subdiv.getEdges();return edges[0]};jsts.triangulate.quadedge.LastFoundQuadEdgeLocator.prototype.locate=function(v){this.lastEdge.isLive()||this.init();var e=this.subdiv.locateFromEdge(v,this.lastEdge);return this.lastEdge=e,e};jsts.io.WKTWriter=function(){this.parser=new jsts.io.WKTParser(this.geometryFactory)};jsts.io.WKTWriter.prototype.write=function(geometry){return this.parser.write(geometry)};jsts.io.WKTWriter.toLineString=function(p0,p1){if(arguments.length!==2)throw new jsts.error.NotImplementedError;return"LINESTRING ( "+p0.x+" "+p0.y+", "+p1.x+" "+p1.y+" )"};jsts.io.WKTReader=function(geometryFactory){this.geometryFactory=geometryFactory||new jsts.geom.GeometryFactory;this.precisionModel=this.geometryFactory.getPrecisionModel();this.parser=new jsts.io.WKTParser(this.geometryFactory)};jsts.io.WKTReader.prototype.read=function(wkt){var geometry=this.parser.read(wkt);return this.precisionModel.getType()===jsts.geom.PrecisionModel.FIXED&&this.reducePrecision(geometry),geometry};jsts.io.WKTReader.prototype.reducePrecision=function(geometry){var i,len;if(geometry.coordinate)this.precisionModel.makePrecise(geometry.coordinate);else if(geometry.points)for(i=0,len=geometry.points.length;i<len;i++)this.precisionModel.makePrecise(geometry.points[i]);else if(geometry.geometries)for(i=0,len=geometry.geometries.length;i<len;i++)this.reducePrecision(geometry.geometries[i])};jsts.triangulate.quadedge.QuadEdgeSubdivision=function(env,tolerance){this.tolerance=tolerance;this.edgeCoincidenceTolerance=tolerance/jsts.triangulate.quadedge.QuadEdgeSubdivision.EDGE_COINCIDENCE_TOL_FACTOR;this.visitedKey=0;this.quadEdges=[];this.startingEdge;this.tolerance;this.edgeCoincidenceTolerance;this.frameEnv;this.locator=null;this.seg=new jsts.geom.LineSegment;this.triEdges=new Array(3);this.frameVertex=new Array(3);this.createFrame(env);this.startingEdge=this.initSubdiv();this.locator=new jsts.triangulate.quadedge.LastFoundQuadEdgeLocator(this)};jsts.triangulate.quadedge.QuadEdgeSubdivision.EDGE_COINCIDENCE_TOL_FACTOR=1e3;jsts.triangulate.quadedge.QuadEdgeSubdivision.getTriangleEdges=function(startQE,triEdge){if(triEdge[0]=startQE,triEdge[1]=triEdge[0].lNext(),triEdge[2]=triEdge[1].lNext(),triEdge[2].lNext()!=triEdge[0])throw new jsts.IllegalArgumentError("Edges do not form a triangle");};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.createFrame=function(env){var deltaX,deltaY,offset;deltaX=env.getWidth();deltaY=env.getHeight();offset=0;offset=deltaX>deltaY?deltaX*10:deltaY*10;this.frameVertex[0]=new jsts.triangulate.quadedge.Vertex((env.getMaxX()+env.getMinX())/2,env.getMaxY()+offset);this.frameVertex[1]=new jsts.triangulate.quadedge.Vertex(env.getMinX()-offset,env.getMinY()-offset);this.frameVertex[2]=new jsts.triangulate.quadedge.Vertex(env.getMaxX()+offset,env.getMinY()-offset);this.frameEnv=new jsts.geom.Envelope(this.frameVertex[0].getCoordinate(),this.frameVertex[1].getCoordinate());this.frameEnv.expandToInclude(this.frameVertex[2].getCoordinate())};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.initSubdiv=function(){var ea,eb,ec;return ea=this.makeEdge(this.frameVertex[0],this.frameVertex[1]),eb=this.makeEdge(this.frameVertex[1],this.frameVertex[2]),jsts.triangulate.quadedge.QuadEdge.splice(ea.sym(),eb),ec=this.makeEdge(this.frameVertex[2],this.frameVertex[0]),jsts.triangulate.quadedge.QuadEdge.splice(eb.sym(),ec),jsts.triangulate.quadedge.QuadEdge.splice(ec.sym(),ea),ea};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.getTolerance=function(){return this.tolerance};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.getEnvelope=function(){return new jsts.geom.Envelope(this.frameEnv)};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.getEdges=function(){return arguments.length>0?this.getEdgesByFactory(arguments[0]):this.quadEdges};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.setLocator=function(locator){this.locator=locator};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.makeEdge=function(o,d){var q=jsts.triangulate.quadedge.QuadEdge.makeEdge(o,d);return this.quadEdges.push(q),q};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.connect=function(a,b){var q=jsts.triangulate.quadedge.QuadEdge.connect(a,b);return this.quadEdges.push(q),q};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.delete_jsts=function(e){var eSym,eRot,eRotSym,idx;jsts.triangulate.quadedge.QuadEdge.splice(e,e.oPrev());jsts.triangulate.quadedge.QuadEdge.splice(e.sym(),e.sym().oPrev());e.eSym=e.sym();eRot=e.rot;eRotSym=e.rot.sym();idx=this.quadEdges.indexOf(e);idx!==-1&&this.quadEdges.splice(idx,1);idx=this.quadEdges.indexOf(eSym);idx!==-1&&this.quadEdges.splice(idx,1);idx=this.quadEdges.indexOf(eRot);idx!==-1&&this.quadEdges.splice(idx,1);idx=this.quadEdges.indexOf(eRotSym);idx!==-1&&this.quadEdges.splice(idx,1);e.delete_jsts();eSym.delete_jsts();eRot.delete_jsts();eRotSym.delete_jsts()};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.locateFromEdge=function(v,startEdge){for(var iter=0,maxIter=this.quadEdges.length,e=startEdge;;){if(iter++,iter>maxIter)throw new jsts.error.LocateFailureError(e.toLineSegment());if(v.equals(e.orig())||v.equals(e.dest()))break;else if(v.rightOf(e))e=e.sym();else if(v.rightOf(e.oNext()))if(v.rightOf(e.dPrev()))break;else e=e.dPrev();else e=e.oNext()}return e};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.locate=function(){return arguments.length===1?arguments[0]instanceof jsts.triangulate.quadedge.Vertex?this.locateByVertex(arguments[0]):this.locateByCoordinate(arguments[0]):this.locateByCoordinates(arguments[0],arguments[1])};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.locateByVertex=function(v){return this.locator.locate(v)};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.locateByCoordinate=function(p){return this.locator.locate(new jsts.triangulate.quadedge.Vertex(p))};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.locateByCoordinates=function(p0,p1){var base,locEdge,e=this.locator.locate(new jsts.triangulate.quadedge.Vertex(p0));if(e===null)return null;base=e;e.dest().getCoordinate().equals2D(p0)&&(base=e.sym());locEdge=base;do{if(locEdge.dest().getCoordinate().equals2D(p1))return locEdge;locEdge=locEdge.oNext()}while(locEdge!=base);return null};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.insertSite=function(v){var e,base,startEdge;if(e=this.locate(v),v.equals(e.orig(),this.tolerance)||v.equals(e.dest(),this.tolerance))return e;base=this.makeEdge(e.orig(),v);jsts.triangulate.quadedge.QuadEdge.splice(base,e);startEdge=base;do base=this.connect(e,base.sym()),e=base.oPrev();while(e.lNext()!=startEdge);return startEdge};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.isFrameEdge=function(e){return this.isFrameVertex(e.orig())||this.isFrameVertex(e.dest())?!0:!1};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.isFrameBorderEdge=function(e){var leftTri,rightTri,vLeftTriOther,vRightTriOther;return(leftTri=new Array(3),this.getTriangleEdges(e,leftTri),rightTri=new Array(3),this.getTriangleEdges(e.sym(),rightTri),vLeftTriOther=e.lNext().dest(),this.isFrameVertex(vLeftTriOther))?!0:(vRightTriOther=e.sym().lNext().dest(),this.isFrameVertex(vRightTriOther))?!0:!1};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.isFrameVertex=function(v){return v.equals(this.frameVertex[0])?!0:v.equals(this.frameVertex[1])?!0:v.equals(this.frameVertex[2])?!0:!1};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.isOnEdge=function(e,p){this.seg.setCoordinates(e.orig().getCoordinate(),e.dest().getCoordinate());var dist=this.seg.distance(p);return dist<this.edgeCoincidenceTolerance};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.isVertexOfEdge=function(e,v){return v.equals(e.orig(),this.tolerance)||v.equals(e.dest(),this.tolerance)?!0:!1};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.getVertices=function(includeFrame){var vertices=[],i,il,qe,v,vd;for(i=0,il=this.quadEdges.length,i;i<il;i++)qe=this.quadEdges[i],v=qe.orig(),(includeFrame||!this.isFrameVertex(v))&&vertices.push(v),vd=qe.dest(),(includeFrame||!this.isFrameVertex(vd))&&vertices.push(vd);return vertices};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.getVertexUniqueEdges=function(includeFrame){var edges,visitedVertices,i,il,qe,v,qd,vd;for(edges=[],visitedVertices=[],i=0,il=this.quadEdges.length,i;i<il;i++)qe=this.quadEdges[i],v=qe.orig(),visitedVertices.indexOf(v)===-1&&(visitedVertices.push(v),(includeFrame||!this.isFrameVertex(v))&&edges.push(qe)),qd=qe.sym(),vd=qd.orig(),visitedVertices.indexOf(vd)===-1&&(visitedVertices.push(vd),(includeFrame||!this.isFrameVertex(vd))&&edges.push(qd));return edges};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.getPrimaryEdges=function(includeFrame){this.visitedKey++;var edges,edgeStack,visitedEdges,edge,priQE;for(edges=[],edgeStack=[],edgeStack.push(this.startingEdge),visitedEdges=[];edgeStack.length>0;)edge=edgeStack.pop(),visitedEdges.indexOf(edge)===-1&&(priQE=edge.getPrimary(),(includeFrame||!this.isFrameEdge(priQE))&&edges.push(priQE),edgeStack.push(edge.oNext()),edgeStack.push(edge.sym().oNext()),visitedEdges.push(edge),visitedEdges.push(edge.sym()));return edges};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.visitTriangles=function(triVisitor,includeFrame){this.visitedKey++;var edgeStack,visitedEdges,edge,triEdges;for(edgeStack=[],edgeStack.push(this.startingEdge),visitedEdges=[];edgeStack.length>0;)edge=edgeStack.pop(),visitedEdges.indexOf(edge)===-1&&(triEdges=this.fetchTriangleToVisit(edge,edgeStack,includeFrame,visitedEdges),triEdges!==null&&triVisitor.visit(triEdges))};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.fetchTriangleToVisit=function(edge,edgeStack,includeFrame,visitedEdges){var curr,edgeCount,isFrame,sym;curr=edge;edgeCount=0;isFrame=!1;do this.triEdges[edgeCount]=curr,this.isFrameEdge(curr)&&(isFrame=!0),sym=curr.sym(),visitedEdges.indexOf(sym)===-1&&edgeStack.push(sym),visitedEdges.push(curr),edgeCount++,curr=curr.lNext();while(curr!==edge);return isFrame&&!includeFrame?null:this.triEdges};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.getTriangleEdges=function(includeFrame){var visitor=new jsts.triangulate.quadedge.TriangleEdgesListVisitor;return this.visitTriangles(visitor,includeFrame),visitor.getTriangleEdges()};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.getTriangleVertices=function(includeFrame){var visitor=new TriangleVertexListVisitor;return this.visitTriangles(visitor,includeFrame),visitor.getTriangleVertices()};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.getTriangleCoordinates=function(includeFrame){var visitor=new jsts.triangulate.quadedge.TriangleCoordinatesVisitor;return this.visitTriangles(visitor,includeFrame),visitor.getTriangles()};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.getEdgesByFactory=function(geomFact){var quadEdges,edges,i,il,qe,coords;for(quadEdges=this.getPrimaryEdges(!1),edges=[],i=0,il=quadEdges.length,i;i<il;i++)qe=quadEdges[i],coords=[],coords[0]=qe.orig().getCoordinate(),coords[1]=qe.dest().getCoordinate(),edges[i]=geomFact.createLineString(coords);return geomFact.createMultiLineString(edges)};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.getTriangles=function(geomFact){var triPtsList,tris,triPt,i,il;for(triPtsList=this.getTriangleCoordinates(!1),tris=new Array(triPtsList.length),i=0,il=triPtsList.length,i;i<il;i++)triPt=triPtsList[i],tris[i]=geomFact.createPolygon(geomFact.createLinearRing(triPt,null));return geomFact.createGeometryCollection(tris)};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.getVoronoiDiagram=function(geomFact){var vorCells=this.getVoronoiCellPolygons(geomFact);return geomFact.createGeometryCollection(vorCells)};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.getVoronoiCellPolygons=function(geomFact){this.visitTriangles(new jsts.triangulate.quadedge.TriangleCircumcentreVisitor,!0);var cells,edges,i,il,qe;for(cells=[],edges=this.getVertexUniqueEdges(!1),i=0,il=edges.length,i;i<il;i++)qe=edges[i],cells.push(this.getVoronoiCellPolygon(qe,geomFact));return cells};jsts.triangulate.quadedge.QuadEdgeSubdivision.prototype.getVoronoiCellPolygon=function(qe,geomFact){var cellPts,cc,coordList,cellPoly,v;cellPts=[];startQE=qe;do cc=qe.rot.orig().getCoordinate(),cellPts.push(cc),qe=qe.oPrev();while(qe!==startQE);return coordList=new jsts.geom.CoordinateList([],!1),coordList.add(cellPts,!1),coordList.closeRing(),coordList.size()<4&&coordList.add(coordList.get(coordList.size()-1),!0),cellPoly=geomFact.createPolygon(geomFact.createLinearRing(coordList.toArray()),null),v=startQE.orig(),cellPoly};jsts.triangulate.quadedge.TriangleCircumcentreVisitor=function(){};jsts.triangulate.quadedge.TriangleCircumcentreVisitor.prototype.visit=function(triEdges){var a,b,c,cc,ccVertex,i;for(a=triEdges[0].orig().getCoordinate(),b=triEdges[1].orig().getCoordinate(),c=triEdges[2].orig().getCoordinate(),cc=jsts.geom.Triangle.circumcentre(a,b,c),ccVertex=new jsts.triangulate.quadedge.Vertex(cc),i=0,i;i<3;i++)triEdges[i].rot.setOrig(ccVertex)};jsts.triangulate.quadedge.TriangleEdgesListVisitor=function(){this.triList=[]};jsts.triangulate.quadedge.TriangleEdgesListVisitor.prototype.visit=function(triEdges){var clone=triEdges.concat();this.triList.push(clone)};jsts.triangulate.quadedge.TriangleEdgesListVisitor.prototype.getTriangleEdges=function(){return this.triList};jsts.triangulate.quadedge.TriangleVertexListVisitor=function(){this.triList=[]};jsts.triangulate.quadedge.TriangleVertexListVisitor.prototype.visit=function(){var vertices=[];vertices.push(trieEdges[0].orig());vertices.push(trieEdges[1].orig());vertices.push(trieEdges[2].orig());this.triList.push(vertices)};jsts.triangulate.quadedge.TriangleVertexListVisitor.prototype.getTriangleVertices=function(){return this.triList};jsts.triangulate.quadedge.TriangleCoordinatesVisitor=function(){this.coordList=new jsts.geom.CoordinateList([],!1);this.triCoords=[]};jsts.triangulate.quadedge.TriangleCoordinatesVisitor.prototype.visit=function(triEdges){this.coordList=new jsts.geom.CoordinateList([],!1);var i=0,v,pts;for(i;i<3;i++)v=triEdges[i].orig(),this.coordList.add(v.getCoordinate());if(this.coordList.size()>0){if(this.coordList.closeRing(),pts=this.coordList.toArray(),pts.length!==4)return;this.triCoords.push(pts)}};jsts.triangulate.quadedge.TriangleCoordinatesVisitor.prototype.getTriangles=function(){return this.triCoords};jsts.operation.relate.EdgeEndBundle=function(){this.edgeEnds=[];var e=arguments[0]instanceof jsts.geomgraph.EdgeEnd?arguments[0]:arguments[1],edge=e.getEdge(),coord=e.getCoordinate(),dirCoord=e.getDirectedCoordinate(),label=new jsts.geomgraph.Label(e.getLabel());jsts.geomgraph.EdgeEnd.call(this,edge,coord,dirCoord,label);this.insert(e)};jsts.operation.relate.EdgeEndBundle.prototype=new jsts.geomgraph.EdgeEnd;jsts.operation.relate.EdgeEndBundle.prototype.edgeEnds=null;jsts.operation.relate.EdgeEndBundle.prototype.getLabel=function(){return this.label};jsts.operation.relate.EdgeEndBundle.prototype.getEdgeEnds=function(){return this.edgeEnds};jsts.operation.relate.EdgeEndBundle.prototype.insert=function(e){this.edgeEnds.push(e)};jsts.operation.relate.EdgeEndBundle.prototype.computeLabel=function(boundaryNodeRule){for(var e,isArea=!1,i=0;i<this.edgeEnds.length;i++)e=this.edgeEnds[i],e.getLabel().isArea()&&(isArea=!0);for(this.label=isArea?new jsts.geomgraph.Label(jsts.geom.Location.NONE,jsts.geom.Location.NONE,jsts.geom.Location.NONE):new jsts.geomgraph.Label(jsts.geom.Location.NONE),i=0;i<2;i++)this.computeLabelOn(i,boundaryNodeRule),isArea&&this.computeLabelSides(i)};jsts.operation.relate.EdgeEndBundle.prototype.computeLabelOn=function(geomIndex,boundaryNodeRule){for(var e,loc,boundaryCount=0,foundInterior=!1,i=0;i<this.edgeEnds.length;i++)e=this.edgeEnds[i],loc=e.getLabel().getLocation(geomIndex),loc==jsts.geom.Location.BOUNDARY&&boundaryCount++,loc==jsts.geom.Location.INTERIOR&&(foundInterior=!0);loc=jsts.geom.Location.NONE;foundInterior&&(loc=jsts.geom.Location.INTERIOR);boundaryCount>0&&(loc=jsts.geomgraph.GeometryGraph.determineBoundary(boundaryNodeRule,boundaryCount));this.label.setLocation(geomIndex,loc)};jsts.operation.relate.EdgeEndBundle.prototype.computeLabelSides=function(geomIndex){this.computeLabelSide(geomIndex,jsts.geomgraph.Position.LEFT);this.computeLabelSide(geomIndex,jsts.geomgraph.Position.RIGHT)};jsts.operation.relate.EdgeEndBundle.prototype.computeLabelSide=function(geomIndex,side){for(var e,loc,i=0;i<this.edgeEnds.length;i++)if(e=this.edgeEnds[i],e.getLabel().isArea()){if(loc=e.getLabel().getLocation(geomIndex,side),loc===jsts.geom.Location.INTERIOR){this.label.setLocation(geomIndex,side,jsts.geom.Location.INTERIOR);return}loc===jsts.geom.Location.EXTERIOR&&this.label.setLocation(geomIndex,side,jsts.geom.Location.EXTERIOR)}};jsts.operation.relate.EdgeEndBundle.prototype.updateIM=function(im){jsts.geomgraph.Edge.updateIM(this.label,im)};jsts.index.kdtree.KdTree=function(tolerance){var tol=0;tolerance!==undefined&&(tol=tolerance);this.root=null;this.last=null;this.numberOfNodes=0;this.tolerance=tol};jsts.index.kdtree.KdTree.prototype.insert=function(){return arguments.length===1?this.insertCoordinate.apply(this,arguments[0]):this.insertWithData.apply(this,arguments[0],arguments[1])};jsts.index.kdtree.KdTree.prototype.insertCoordinate=function(p){return this.insertWithData(p,null)};jsts.index.kdtree.KdTree.prototype.insertWithData=function(p,data){var isInTolerance,node;if(this.root===null)return this.root=new jsts.index.kdtree.KdNode(p,data),this.root;for(var currentNode=this.root,leafNode=this.root,isOddLevel=!0,isLessThan=!0;currentNode!==last;){if(isLessThan=isOddLevel?p.x<currentNode.getX():p.y<currentNode.getY(),leafNode=currentNode,currentNode=isLessThan?currentNode.getLeft():currentNode.getRight(),currentNode!==null&&(isInTolerance=p.distance(currentNode.getCoordinate())<=this.tolerance,isInTolerance))return currentNode.increment(),currentNode;isOddLevel=!isOddLevel}return this.numberOfNodes=numberOfNodes+1,node=new jsts.index.kdtree.KdNode(p,data),node.setLeft(this.last),node.setRight(this.last),isLessThan?leafNode.setLeft(node):leafNode.setRight(node),node};jsts.index.kdtree.KdTree.prototype.queryNode=function(currentNode,bottomNode,queryEnv,odd,result){var min,max,discriminant,searchLeft,searchRight;currentNode!==bottomNode&&(odd?(min=queryEnv.getMinX(),max=queryEnv.getMaxX(),discriminant=currentNode.getX()):(min=queryEnv.getMinY(),max=queryEnv.getMaxY(),discriminant=currentNode.getY()),searchLeft=min<discriminant,searchRight=discriminant<=max,searchLeft&&this.queryNode(currentNode.getLeft(),bottomNode,queryEnv,!odd,result),queryEnv.contains(currentNode.getCoordinate())&&result.add(currentNode),searchRight&&this.queryNode(currentNode.getRight(),bottomNode,queryEnv,!odd,result))};jsts.index.kdtree.KdTree.prototype.query=function(){return arguments.length===1?this.queryByEnvelope.apply(this,arguments[0]):this.queryWithArray.apply(this,arguments[0],arguments[1])};jsts.index.kdtree.KdTree.prototype.queryByEnvelope=function(queryEnv){var result=[];return this.queryNode(this.root,this.last,queryEnv,!0,result),result};jsts.index.kdtree.KdTree.prototype.queryWithArray=function(queryEnv,result){this.queryNode(this.root,this.last,queryEnv,!0,result)};jsts.geom.Triangle=function(p0,p1,p2){this.p0=p0;this.p1=p1;this.p2=p2};jsts.geom.Triangle.isAcute=function(a,b,c){return jsts.algorithm.Angle.isAcute(a,b,c)?jsts.algorithm.Angle.isAcute(b,c,a)?jsts.algorithm.Angle.isAcute(c,a,b)?!0:!1:!1:!1};jsts.geom.Triangle.perpendicularBisector=function(a,b){var dx,dy,l1,l2;return dx=b.x-a.x,dy=b.y-a.y,l1=new jsts.algorithm.HCoordinate(a.x+dx/2,a.y+dy/2,1),l2=new jsts.algorithm.HCoordinate(a.x-dy+dx/2,a.y+dx+dy/2,1),new jsts.algorithm.HCoordinate(l1,l2)};jsts.geom.Triangle.circumcentre=function(a,b,c){var cx,cy,ax,ay,bx,by,denom,numx,numy,ccx,ccy;return cx=c.x,cy=c.y,ax=a.x-cx,ay=a.y-cy,bx=b.x-cx,by=b.y-cy,denom=2*jsts.geom.Triangle.det(ax,ay,bx,by),numx=jsts.geom.Triangle.det(ay,ax*ax+ay*ay,by,bx*bx+by*by),numy=jsts.geom.Triangle.det(ax,ax*ax+ay*ay,bx,bx*bx+by*by),ccx=cx-numx/denom,ccy=cy+numy/denom,new jsts.geom.Coordinate(ccx,ccy)};jsts.geom.Triangle.det=function(m00,m01,m10,m11){return m00*m11-m01*m10};jsts.geom.Triangle.inCentre=function(a,b,c){var len0,len1,len2,circum,inCentreX,inCentreY;return len0=b.distance(c),len1=a.distance(c),len2=a.distance(b),circum=len0+len1+len2,inCentreX=(len0*a.x+len1*b.x+len2*c.x)/circum,inCentreY=(len0*a.y+len1*b.y+len2*c.y)/circum,new jsts.geom.Coordinate(inCentreX,inCentreY)};jsts.geom.Triangle.centroid=function(a,b,c){var x,y;return x=(a.x+b.x+c.x)/3,y=(a.y+b.y+c.y)/3,new jsts.geom.Coordinate(x,y)};jsts.geom.Triangle.longestSideLength=function(a,b,c){var lenAB,lenBC,lenCA,maxLen;return lenAB=a.distance(b),lenBC=b.distance(c),lenCA=c.distance(a),maxLen=lenAB,lenBC>maxLen&&(maxLen=lenBC),lenCA>maxLen&&(maxLen=lenCA),maxLen};jsts.geom.Triangle.angleBisector=function(a,b,c){var len0,len2,frac,dx,dy;return len0=b.distance(a),len2=b.distance(c),frac=len0/(len0+len2),dx=c.x-a.x,dy=c.y-a.y,new jsts.geom.Coordinate(a.x+frac*dx,a.y+frac*dy)};jsts.geom.Triangle.area=function(a,b,c){return Math.abs(((c.x-a.x)*(b.y-a.y)-(b.x-a.x)*(c.y-a.y))/2)};jsts.geom.Triangle.signedArea=function(a,b,c){return((c.x-a.x)*(b.y-a.y)-(b.x-a.x)*(c.y-a.y))/2};jsts.geom.Triangle.prototype.inCentre=function(){return jsts.geom.Triangle.inCentre(this.p0,this.p1,this.p2)};jsts.noding.OrientedCoordinateArray=function(pts){this.pts=pts;this._orientation=jsts.noding.OrientedCoordinateArray.orientation(pts)};jsts.noding.OrientedCoordinateArray.prototype.pts=null;jsts.noding.OrientedCoordinateArray.prototype._orientation=undefined;jsts.noding.OrientedCoordinateArray.orientation=function(pts){return jsts.geom.CoordinateArrays.increasingDirection(pts)===1};jsts.noding.OrientedCoordinateArray.prototype.compareTo=function(o1){var oca=o1;return jsts.noding.OrientedCoordinateArray.compareOriented(this.pts,this._orientation,oca.pts,oca._orientation)};jsts.noding.OrientedCoordinateArray.compareOriented=function(pts1,orientation1,pts2,orientation2){for(var dir1=orientation1?1:-1,dir2=orientation2?1:-1,limit1=orientation1?pts1.length:-1,limit2=orientation2?pts2.length:-1,i1=orientation1?0:pts1.length-1,i2=orientation2?0:pts2.length-1,compPt,done1,done2;;){if(compPt=pts1[i1].compareTo(pts2[i2]),compPt!==0)return compPt;if(i1+=dir1,i2+=dir2,done1=i1===limit1,done2=i2===limit2,done1&&!done2)return-1;if(!done1&&done2)return 1;if(done1&&done2)return 0}};jsts.algorithm.CentralEndpointIntersector=function(p00,p01,p10,p11){this.pts=[p00,p01,p10,p11];this.compute()};jsts.algorithm.CentralEndpointIntersector.getIntersection=function(p00,p01,p10,p11){var intor=new jsts.algorithm.CentralEndpointIntersector(p00,p01,p10,p11);return intor.getIntersection()};jsts.algorithm.CentralEndpointIntersector.prototype.pts=null;jsts.algorithm.CentralEndpointIntersector.prototype.intPt=null;jsts.algorithm.CentralEndpointIntersector.prototype.compute=function(){var centroid=jsts.algorithm.CentralEndpointIntersector.average(this.pts);this.intPt=this.findNearestPoint(centroid,this.pts)};jsts.algorithm.CentralEndpointIntersector.prototype.getIntersection=function(){return this.intPt};jsts.algorithm.CentralEndpointIntersector.average=function(pts){for(var avg=new jsts.geom.Coordinate,n=pts.length,i=0;i<n;i++)avg.x+=pts[i].x,avg.y+=pts[i].y;return n>0&&(avg.x/=n,avg.y/=n),avg};jsts.algorithm.CentralEndpointIntersector.prototype.findNearestPoint=function(p,pts){for(var minDist=Number.MAX_VALUE,result=null,dist,i=0;i<pts.length;i++)dist=p.distance(pts[i]),dist<minDist&&(minDist=dist,result=pts[i]);return result};jsts.operation.buffer.BufferOp=function(g,bufParams){this.argGeom=g;this.bufParams=bufParams?bufParams:new jsts.operation.buffer.BufferParameters};jsts.operation.buffer.BufferOp.MAX_PRECISION_DIGITS=12;jsts.operation.buffer.BufferOp.precisionScaleFactor=function(g,distance,maxPrecisionDigits){var env=g.getEnvelopeInternal(),envSize=Math.max(env.getHeight(),env.getWidth()),expandByDistance=distance>0?distance:0,bufEnvSize=envSize+2*expandByDistance,bufEnvLog10=Math.log(bufEnvSize)/Math.log(10)+1,minUnitLog10=bufEnvLog10-maxPrecisionDigits;return Math.pow(10,-minUnitLog10)};jsts.operation.buffer.BufferOp.bufferOp=function(g,distance){if(arguments.length>2)return jsts.operation.buffer.BufferOp.bufferOp2.apply(this,arguments);var gBuf=new jsts.operation.buffer.BufferOp(g);return gBuf.getResultGeometry(distance)};jsts.operation.buffer.BufferOp.bufferOp2=function(g,distance,params){if(arguments.length>3)return jsts.operation.buffer.BufferOp.bufferOp3.apply(this,arguments);var bufOp=new jsts.operation.buffer.BufferOp(g,params);return bufOp.getResultGeometry(distance)};jsts.operation.buffer.BufferOp.bufferOp3=function(g,distance,quadrantSegments){var bufOp;return arguments.length>4?jsts.operation.buffer.BufferOp.bufferOp4.apply(this,arguments):(bufOp=new jsts.operation.buffer.BufferOp(g),bufOp.setQuadrantSegments(quadrantSegments),bufOp.getResultGeometry(distance))};jsts.operation.buffer.BufferOp.bufferOp4=function(g,distance,quadrantSegments,endCapStyle){var bufOp=new jsts.operation.buffer.BufferOp(g);return bufOp.setQuadrantSegments(quadrantSegments),bufOp.setEndCapStyle(endCapStyle),bufOp.getResultGeometry(distance)};jsts.operation.buffer.BufferOp.prototype.argGeom=null;jsts.operation.buffer.BufferOp.prototype.distance=null;jsts.operation.buffer.BufferOp.prototype.bufParams=null;jsts.operation.buffer.BufferOp.prototype.resultGeometry=null;jsts.operation.buffer.BufferOp.prototype.setEndCapStyle=function(endCapStyle){this.bufParams.setEndCapStyle(endCapStyle)};jsts.operation.buffer.BufferOp.prototype.setQuadrantSegments=function(quadrantSegments){this.bufParams.setQuadrantSegments(quadrantSegments)};jsts.operation.buffer.BufferOp.prototype.getResultGeometry=function(dist){return this.distance=dist,this.computeGeometry(),this.resultGeometry};jsts.operation.buffer.BufferOp.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),this.resultGeometry===null){var argPM=this.argGeom.getPrecisionModel();argPM.getType()===jsts.geom.PrecisionModel.FIXED?this.bufferFixedPrecision(argPM):this.bufferReducedPrecision()}};jsts.operation.buffer.BufferOp.prototype.bufferReducedPrecision=function(){for(var saveException=null,precDigits=jsts.operation.buffer.BufferOp.MAX_PRECISION_DIGITS;precDigits>=0;precDigits--){try{this.bufferReducedPrecision2(precDigits)}catch(ex){saveException=ex}if(this.resultGeometry!==null)return}throw saveException;};jsts.operation.buffer.BufferOp.prototype.bufferOriginalPrecision=function(){try{var bufBuilder=new jsts.operation.buffer.BufferBuilder(this.bufParams);this.resultGeometry=bufBuilder.buffer(this.argGeom,this.distance)}catch(e){}};jsts.operation.buffer.BufferOp.prototype.bufferReducedPrecision2=function(precisionDigits){var sizeBasedScaleFactor=jsts.operation.buffer.BufferOp.precisionScaleFactor(this.argGeom,this.distance,precisionDigits),fixedPM=new jsts.geom.PrecisionModel(sizeBasedScaleFactor);this.bufferFixedPrecision(fixedPM)};jsts.operation.buffer.BufferOp.prototype.bufferFixedPrecision=function(fixedPM){var noder=new jsts.noding.ScaledNoder(new jsts.noding.snapround.MCIndexSnapRounder(new jsts.geom.PrecisionModel(1)),fixedPM.getScale()),bufBuilder=new jsts.operation.buffer.BufferBuilder(this.bufParams);bufBuilder.setWorkingPrecisionModel(fixedPM);bufBuilder.setNoder(noder);this.resultGeometry=bufBuilder.buffer(this.argGeom,this.distance)};jsts.operation.relate.RelateNode=function(){jsts.geomgraph.Node.apply(this,arguments)};jsts.operation.relate.RelateNode.prototype=new jsts.geomgraph.Node;jsts.operation.relate.RelateNode.prototype.computeIM=function(im){im.setAtLeastIfValid(this.label.getLocation(0),this.label.getLocation(1),0)};jsts.operation.relate.RelateNode.prototype.updateIMFromEdges=function(im){this.edges.updateIM(im)},function(){var Location=jsts.geom.Location,Position=jsts.geomgraph.Position,Assert=jsts.util.Assert;jsts.geomgraph.GeometryGraph=function(argIndex,parentGeom,boundaryNodeRule){jsts.geomgraph.PlanarGraph.call(this);this.lineEdgeMap=new javascript.util.HashMap;this.ptLocator=new jsts.algorithm.PointLocator;this.argIndex=argIndex;this.parentGeom=parentGeom;this.boundaryNodeRule=boundaryNodeRule||jsts.algorithm.BoundaryNodeRule.OGC_SFS_BOUNDARY_RULE;parentGeom!==null&&this.add(parentGeom)};jsts.geomgraph.GeometryGraph.prototype=new jsts.geomgraph.PlanarGraph;jsts.geomgraph.GeometryGraph.constructor=jsts.geomgraph.GeometryGraph;jsts.geomgraph.GeometryGraph.prototype.createEdgeSetIntersector=function(){return new jsts.geomgraph.index.SimpleEdgeSetIntersector};jsts.geomgraph.GeometryGraph.determineBoundary=function(boundaryNodeRule,boundaryCount){return boundaryNodeRule.isInBoundary(boundaryCount)?Location.BOUNDARY:Location.INTERIOR};jsts.geomgraph.GeometryGraph.prototype.parentGeom=null;jsts.geomgraph.GeometryGraph.prototype.lineEdgeMap=null;jsts.geomgraph.GeometryGraph.prototype.boundaryNodeRule=null;jsts.geomgraph.GeometryGraph.prototype.useBoundaryDeterminationRule=!0;jsts.geomgraph.GeometryGraph.prototype.argIndex=null;jsts.geomgraph.GeometryGraph.prototype.boundaryNodes=null;jsts.geomgraph.GeometryGraph.prototype.hasTooFewPoints=!1;jsts.geomgraph.GeometryGraph.prototype.invalidPoint=null;jsts.geomgraph.GeometryGraph.prototype.areaPtLocator=null;jsts.geomgraph.GeometryGraph.prototype.ptLocator=null;jsts.geomgraph.GeometryGraph.prototype.getGeometry=function(){return this.parentGeom};jsts.geomgraph.GeometryGraph.prototype.getBoundaryNodes=function(){return this.boundaryNodes===null&&(this.boundaryNodes=this.nodes.getBoundaryNodes(this.argIndex)),this.boundaryNodes};jsts.geomgraph.GeometryGraph.prototype.getBoundaryNodeRule=function(){return this.boundaryNodeRule};jsts.geomgraph.GeometryGraph.prototype.findEdge=function(line){return this.lineEdgeMap.get(line)};jsts.geomgraph.GeometryGraph.prototype.computeSplitEdges=function(edgelist){for(var e,i=this.edges.iterator();i.hasNext();)e=i.next(),e.eiList.addSplitEdges(edgelist)};jsts.geomgraph.GeometryGraph.prototype.add=function(g){if(!g.isEmpty())if(g instanceof jsts.geom.MultiPolygon&&(this.useBoundaryDeterminationRule=!1),g instanceof jsts.geom.Polygon)this.addPolygon(g);else if(g instanceof jsts.geom.LineString)this.addLineString(g);else if(g instanceof jsts.geom.Point)this.addPoint(g);else if(g instanceof jsts.geom.MultiPoint)this.addCollection(g);else if(g instanceof jsts.geom.MultiLineString)this.addCollection(g);else if(g instanceof jsts.geom.MultiPolygon)this.addCollection(g);else if(g instanceof jsts.geom.GeometryCollection)this.addCollection(g);else throw new jsts.error.IllegalArgumentError("Geometry type not supported.");};jsts.geomgraph.GeometryGraph.prototype.addCollection=function(gc){for(var g,i=0;i<gc.getNumGeometries();i++)g=gc.getGeometryN(i),this.add(g)};jsts.geomgraph.GeometryGraph.prototype.addEdge=function(e){this.insertEdge(e);var coord=e.getCoordinates();this.insertPoint(this.argIndex,coord[0],Location.BOUNDARY);this.insertPoint(this.argIndex,coord[coord.length-1],Location.BOUNDARY)};jsts.geomgraph.GeometryGraph.prototype.addPoint=function(p){var coord=p.getCoordinate();this.insertPoint(this.argIndex,coord,Location.INTERIOR)};jsts.geomgraph.GeometryGraph.prototype.addLineString=function(line){var coord=jsts.geom.CoordinateArrays.removeRepeatedPoints(line.getCoordinates()),e;if(coord.length<2){this.hasTooFewPoints=!0;this.invalidPoint=coords[0];return}e=new jsts.geomgraph.Edge(coord,new jsts.geomgraph.Label(this.argIndex,Location.INTERIOR));this.lineEdgeMap.put(line,e);this.insertEdge(e);Assert.isTrue(coord.length>=2,"found LineString with single point");this.insertBoundaryPoint(this.argIndex,coord[0]);this.insertBoundaryPoint(this.argIndex,coord[coord.length-1])};jsts.geomgraph.GeometryGraph.prototype.addPolygonRing=function(lr,cwLeft,cwRight){var coord,left,right,e;if(!lr.isEmpty()){if(coord=jsts.geom.CoordinateArrays.removeRepeatedPoints(lr.getCoordinates()),coord.length<4){this.hasTooFewPoints=!0;this.invalidPoint=coord[0];return}left=cwLeft;right=cwRight;jsts.algorithm.CGAlgorithms.isCCW(coord)&&(left=cwRight,right=cwLeft);e=new jsts.geomgraph.Edge(coord,new jsts.geomgraph.Label(this.argIndex,Location.BOUNDARY,left,right));this.lineEdgeMap.put(lr,e);this.insertEdge(e);this.insertPoint(this.argIndex,coord[0],Location.BOUNDARY)}};jsts.geomgraph.GeometryGraph.prototype.addPolygon=function(p){var i,hole;for(this.addPolygonRing(p.getExteriorRing(),Location.EXTERIOR,Location.INTERIOR),i=0;i<p.getNumInteriorRing();i++)hole=p.getInteriorRingN(i),this.addPolygonRing(hole,Location.INTERIOR,Location.EXTERIOR)};jsts.geomgraph.GeometryGraph.prototype.computeEdgeIntersections=function(g,li,includeProper){var si=new jsts.geomgraph.index.SegmentIntersector(li,includeProper,!0),esi;return si.setBoundaryNodes(this.getBoundaryNodes(),g.getBoundaryNodes()),esi=this.createEdgeSetIntersector(),esi.computeIntersections(this.edges,g.edges,si),si};jsts.geomgraph.GeometryGraph.prototype.computeSelfNodes=function(li,computeRingSelfNodes){var si=new jsts.geomgraph.index.SegmentIntersector(li,!0,!1),esi=this.createEdgeSetIntersector();return!computeRingSelfNodes&&(this.parentGeom instanceof jsts.geom.LinearRing||this.parentGeom instanceof jsts.geom.Polygon||this.parentGeom instanceof jsts.geom.MultiPolygon)?esi.computeIntersections(this.edges,si,!1):esi.computeIntersections(this.edges,si,!0),this.addSelfIntersectionNodes(this.argIndex),si};jsts.geomgraph.GeometryGraph.prototype.insertPoint=function(argIndex,coord,onLocation){var n=this.nodes.addNode(coord),lbl=n.getLabel();lbl==null?n.label=new jsts.geomgraph.Label(argIndex,onLocation):lbl.setLocation(argIndex,onLocation)};jsts.geomgraph.GeometryGraph.prototype.insertBoundaryPoint=function(argIndex,coord){var n=this.nodes.addNode(coord),lbl=n.getLabel(),boundaryCount=1,loc=Location.NONE,newLoc;lbl!==null&&(loc=lbl.getLocation(argIndex,Position.ON));loc===Location.BOUNDARY&&boundaryCount++;newLoc=jsts.geomgraph.GeometryGraph.determineBoundary(this.boundaryNodeRule,boundaryCount);lbl.setLocation(argIndex,newLoc)};jsts.geomgraph.GeometryGraph.prototype.addSelfIntersectionNodes=function(argIndex){for(var e,eLoc,eiIt,ei,i=this.edges.iterator();i.hasNext();)for(e=i.next(),eLoc=e.getLabel().getLocation(argIndex),eiIt=e.eiList.iterator();eiIt.hasNext();)ei=eiIt.next(),this.addSelfIntersectionNode(argIndex,ei.coord,eLoc)};jsts.geomgraph.GeometryGraph.prototype.addSelfIntersectionNode=function(argIndex,coord,loc){this.isBoundaryNode(argIndex,coord)||(loc===Location.BOUNDARY&&this.useBoundaryDeterminationRule?this.insertBoundaryPoint(argIndex,coord):this.insertPoint(argIndex,coord,loc))};jsts.geomgraph.GeometryGraph.prototype.getInvalidPoint=function(){return this.invalidPoint}}();jsts.operation.buffer.OffsetSegmentString=function(){this.ptList=[]};jsts.operation.buffer.OffsetSegmentString.prototype.ptList=null;jsts.operation.buffer.OffsetSegmentString.prototype.precisionModel=null;jsts.operation.buffer.OffsetSegmentString.prototype.minimimVertexDistance=0;jsts.operation.buffer.OffsetSegmentString.prototype.setPrecisionModel=function(precisionModel){this.precisionModel=precisionModel};jsts.operation.buffer.OffsetSegmentString.prototype.setMinimumVertexDistance=function(minimimVertexDistance){this.minimimVertexDistance=minimimVertexDistance};jsts.operation.buffer.OffsetSegmentString.prototype.addPt=function(pt){var bufPt=new jsts.geom.Coordinate(pt);(this.precisionModel.makePrecise(bufPt),this.isRedundant(bufPt))||this.ptList.push(bufPt)};jsts.operation.buffer.OffsetSegmentString.prototype.addPts=function(pt,isForward){var i;if(isForward)for(i=0;i<pt.length;i++)this.addPt(pt[i]);else for(i=pt.length-1;i>=0;i--)this.addPt(pt[i])};jsts.operation.buffer.OffsetSegmentString.prototype.isRedundant=function(pt){if(this.ptList.length<1)return!1;var lastPt=this.ptList[this.ptList.length-1],ptDist=pt.distance(lastPt);return ptDist<this.minimimVertexDistance?!0:!1};jsts.operation.buffer.OffsetSegmentString.prototype.closeRing=function(){if(!(this.ptList.length<1)){var startPt=new jsts.geom.Coordinate(this.ptList[0]),lastPt=this.ptList[this.ptList.length-1],last2Pt=null;(this.ptList.length>=2&&(last2Pt=this.ptList[this.ptList.length-2]),startPt.equals(lastPt))||this.ptList.push(startPt)}};jsts.operation.buffer.OffsetSegmentString.prototype.reverse=function(){};jsts.operation.buffer.OffsetSegmentString.prototype.getCoordinates=function(){return this.ptList},function(){var ArrayList=javascript.util.ArrayList,TreeSet=javascript.util.TreeSet,CoordinateFilter=jsts.geom.CoordinateFilter;jsts.util.UniqueCoordinateArrayFilter=function(){this.treeSet=new TreeSet;this.list=new ArrayList};jsts.util.UniqueCoordinateArrayFilter.prototype=new CoordinateFilter;jsts.util.UniqueCoordinateArrayFilter.prototype.treeSet=null;jsts.util.UniqueCoordinateArrayFilter.prototype.list=null;jsts.util.UniqueCoordinateArrayFilter.prototype.getCoordinates=function(){return this.list.toArray()};jsts.util.UniqueCoordinateArrayFilter.prototype.filter=function(coord){this.treeSet.contains(coord)||(this.list.add(coord),this.treeSet.add(coord))}}(),function(){var CGAlgorithms=jsts.algorithm.CGAlgorithms,UniqueCoordinateArrayFilter=jsts.util.UniqueCoordinateArrayFilter,Assert=jsts.util.Assert,Stack=javascript.util.Stack,ArrayList=javascript.util.ArrayList,Arrays=javascript.util.Arrays,RadialComparator=function(origin){this.origin=origin};RadialComparator.prototype.origin=null;RadialComparator.prototype.compare=function(o1,o2){var p1=o1,p2=o2;return RadialComparator.polarCompare(this.origin,p1,p2)};RadialComparator.polarCompare=function(o,p,q){var dxp=p.x-o.x,dyp=p.y-o.y,dxq=q.x-o.x,dyq=q.y-o.y,orient=CGAlgorithms.computeOrientation(o,p,q),op,oq;return orient==CGAlgorithms.COUNTERCLOCKWISE?1:orient==CGAlgorithms.CLOCKWISE?-1:(op=dxp*dxp+dyp*dyp,oq=dxq*dxq+dyq*dyq,op<oq)?-1:op>oq?1:0};jsts.algorithm.ConvexHull=function(){if(arguments.length===1){var geometry=arguments[0];this.inputPts=jsts.algorithm.ConvexHull.extractCoordinates(geometry);this.geomFactory=geometry.getFactory()}else this.pts=arguments[0],this.geomFactory=arguments[1]};jsts.algorithm.ConvexHull.prototype.geomFactory=null;jsts.algorithm.ConvexHull.prototype.inputPts=null;jsts.algorithm.ConvexHull.extractCoordinates=function(geom){var filter=new UniqueCoordinateArrayFilter;return geom.apply(filter),filter.getCoordinates()};jsts.algorithm.ConvexHull.prototype.getConvexHull=function(){var reducedPts;if(this.inputPts.length==0)return this.geomFactory.createGeometryCollection(null);if(this.inputPts.length==1)return this.geomFactory.createPoint(this.inputPts[0]);if(this.inputPts.length==2)return this.geomFactory.createLineString(this.inputPts);reducedPts=this.inputPts;this.inputPts.length>50&&(reducedPts=this.reduce(this.inputPts));var sortedPts=this.preSort(reducedPts),cHS=this.grahamScan(sortedPts),cH=cHS.toArray();return this.lineOrPolygon(cH)};jsts.algorithm.ConvexHull.prototype.reduce=function(inputPts){var polyPts=this.computeOctRing(inputPts),reducedSet,i,reducedPts;if(polyPts==null)return this.inputPts;for(reducedSet=new javascript.util.TreeSet,i=0;i<polyPts.length;i++)reducedSet.add(polyPts[i]);for(i=0;i<inputPts.length;i++)CGAlgorithms.isPointInRing(inputPts[i],polyPts)||reducedSet.add(inputPts[i]);return(reducedPts=reducedSet.toArray(),reducedPts.length<3)?this.padArray3(reducedPts):reducedPts};jsts.algorithm.ConvexHull.prototype.padArray3=function(pts){for(var pad=[],i=0;i<pad.length;i++)pad[i]=i<pts.length?pts[i]:pts[0];return pad};jsts.algorithm.ConvexHull.prototype.preSort=function(pts){for(var t,i=1;i<pts.length;i++)(pts[i].y<pts[0].y||pts[i].y==pts[0].y&&pts[i].x<pts[0].x)&&(t=pts[0],pts[0]=pts[i],pts[i]=t);return Arrays.sort(pts,1,pts.length,new RadialComparator(pts[0])),pts};jsts.algorithm.ConvexHull.prototype.grahamScan=function(c){var p,ps=new Stack,i;for(p=ps.push(c[0]),p=ps.push(c[1]),p=ps.push(c[2]),i=3;i<c.length;i++){for(p=ps.pop();!ps.empty()&&CGAlgorithms.computeOrientation(ps.peek(),p,c[i])>0;)p=ps.pop();p=ps.push(p);p=ps.push(c[i])}return p=ps.push(c[0]),ps};jsts.algorithm.ConvexHull.prototype.isBetween=function(c1,c2,c3){return CGAlgorithms.computeOrientation(c1,c2,c3)!==0?!1:c1.x!=c3.x&&(c1.x<=c2.x&&c2.x<=c3.x||c3.x<=c2.x&&c2.x<=c1.x)?!0:c1.y!=c3.y&&(c1.y<=c2.y&&c2.y<=c3.y||c3.y<=c2.y&&c2.y<=c1.y)?!0:!1};jsts.algorithm.ConvexHull.prototype.computeOctRing=function(inputPts){var octPts=this.computeOctPts(inputPts),coordList=new jsts.geom.CoordinateList;return(coordList.add(octPts,!1),coordList.size()<3)?null:(coordList.closeRing(),coordList.toCoordinateArray())};jsts.algorithm.ConvexHull.prototype.computeOctPts=function(inputPts){for(var i,pts=[],j=0;j<8;j++)pts[j]=inputPts[0];for(i=1;i<inputPts.length;i++)inputPts[i].x<pts[0].x&&(pts[0]=inputPts[i]),inputPts[i].x-inputPts[i].y<pts[1].x-pts[1].y&&(pts[1]=inputPts[i]),inputPts[i].y>pts[2].y&&(pts[2]=inputPts[i]),inputPts[i].x+inputPts[i].y>pts[3].x+pts[3].y&&(pts[3]=inputPts[i]),inputPts[i].x>pts[4].x&&(pts[4]=inputPts[i]),inputPts[i].x-inputPts[i].y>pts[5].x-pts[5].y&&(pts[5]=inputPts[i]),inputPts[i].y<pts[6].y&&(pts[6]=inputPts[i]),inputPts[i].x+inputPts[i].y<pts[7].x+pts[7].y&&(pts[7]=inputPts[i]);return pts};jsts.algorithm.ConvexHull.prototype.lineOrPolygon=function(coordinates){if(coordinates=this.cleanRing(coordinates),coordinates.length==3)return this.geomFactory.createLineString([coordinates[0],coordinates[1]]);var linearRing=this.geomFactory.createLinearRing(coordinates);return this.geomFactory.createPolygon(linearRing,null)};jsts.algorithm.ConvexHull.prototype.cleanRing=function(original){var cleanedRing,previousDistinctCoordinate,i,currentCoordinate,nextCoordinate,cleanedRingCoordinates;for(Assert.equals(original[0],original[original.length-1]),cleanedRing=new ArrayList,previousDistinctCoordinate=null,i=0;i<=original.length-2;i++)(currentCoordinate=original[i],nextCoordinate=original[i+1],currentCoordinate.equals(nextCoordinate))||previousDistinctCoordinate!=null&&this.isBetween(previousDistinctCoordinate,currentCoordinate,nextCoordinate)||(cleanedRing.add(currentCoordinate),previousDistinctCoordinate=currentCoordinate);return cleanedRing.add(original[original.length-1]),cleanedRingCoordinates=[],cleanedRing.toArray(cleanedRingCoordinates)}}(),function(){var ArrayList=javascript.util.ArrayList;jsts.geomgraph.index.SegmentIntersector=function(li,includeProper,recordIsolated){this.li=li;this.includeProper=includeProper;this.recordIsolated=recordIsolated};jsts.geomgraph.index.SegmentIntersector.isAdjacentSegments=function(i1,i2){return Math.abs(i1-i2)===1};jsts.geomgraph.index.SegmentIntersector.prototype._hasIntersection=!1;jsts.geomgraph.index.SegmentIntersector.prototype.hasProper=!1;jsts.geomgraph.index.SegmentIntersector.prototype.hasProperInterior=!1;jsts.geomgraph.index.SegmentIntersector.prototype.properIntersectionPoint=null;jsts.geomgraph.index.SegmentIntersector.prototype.li=null;jsts.geomgraph.index.SegmentIntersector.prototype.includeProper=null;jsts.geomgraph.index.SegmentIntersector.prototype.recordIsolated=null;jsts.geomgraph.index.SegmentIntersector.prototype.isSelfIntersection=null;jsts.geomgraph.index.SegmentIntersector.prototype.numIntersections=0;jsts.geomgraph.index.SegmentIntersector.prototype.numTests=0;jsts.geomgraph.index.SegmentIntersector.prototype.bdyNodes=null;jsts.geomgraph.index.SegmentIntersector.prototype.setBoundaryNodes=function(bdyNodes0,bdyNodes1){this.bdyNodes=[];this.bdyNodes[0]=bdyNodes0;this.bdyNodes[1]=bdyNodes1};jsts.geomgraph.index.SegmentIntersector.prototype.getProperIntersectionPoint=function(){return this.properIntersectionPoint};jsts.geomgraph.index.SegmentIntersector.prototype.hasIntersection=function(){return this._hasIntersection};jsts.geomgraph.index.SegmentIntersector.prototype.hasProperIntersection=function(){return this.hasProper};jsts.geomgraph.index.SegmentIntersector.prototype.hasProperInteriorIntersection=function(){return this.hasProperInterior};jsts.geomgraph.index.SegmentIntersector.prototype.isTrivialIntersection=function(e0,segIndex0,e1,segIndex1){if(e0===e1&&this.li.getIntersectionNum()===1){if(jsts.geomgraph.index.SegmentIntersector.isAdjacentSegments(segIndex0,segIndex1))return!0;if(e0.isClosed()){var maxSegIndex=e0.getNumPoints()-1;if(segIndex0===0&&segIndex1===maxSegIndex||segIndex1===0&&segIndex0===maxSegIndex)return!0}}return!1};jsts.geomgraph.index.SegmentIntersector.prototype.addIntersections=function(e0,segIndex0,e1,segIndex1){if(e0!==e1||segIndex0!==segIndex1){this.numTests++;var p00=e0.getCoordinates()[segIndex0],p01=e0.getCoordinates()[segIndex0+1],p10=e1.getCoordinates()[segIndex1],p11=e1.getCoordinates()[segIndex1+1];this.li.computeIntersection(p00,p01,p10,p11);this.li.hasIntersection()&&(this.recordIsolated&&(e0.setIsolated(!1),e1.setIsolated(!1)),this.numIntersections++,this.isTrivialIntersection(e0,segIndex0,e1,segIndex1)||(this._hasIntersection=!0,(this.includeProper||!this.li.isProper())&&(e0.addIntersections(this.li,segIndex0,0),e1.addIntersections(this.li,segIndex1,1)),this.li.isProper()&&(this.properIntersectionPoint=this.li.getIntersection(0).clone(),this.hasProper=!0,this.isBoundaryPoint(this.li,this.bdyNodes)||(this.hasProperInterior=!0))))}};jsts.geomgraph.index.SegmentIntersector.prototype.isBoundaryPoint=function(li,bdyNodes){var i,node,pt;if(bdyNodes===null)return!1;if(bdyNodes instanceof Array)return this.isBoundaryPoint(li,bdyNodes[0])?!0:this.isBoundaryPoint(li,bdyNodes[1])?!0:!1;for(i=bdyNodes.iterator();i.hasNext();)if(node=i.next(),pt=node.getCoordinate(),li.isIntersection(pt))return!0;return!1}}();Oskari.clazz.define("Oskari.lupapiste.bundle.shpimport.ShpImportBundle",function(){},{create:function(){return Oskari.clazz.create("Oskari.lupapiste.bundle.shpimport.ShpImportBundleInstance")},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-shpimport/instance.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-shpimport/Flyout.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-shpimport/service/MyPlacesImportService.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-shpimport/UserLayersTab.js"},{type:"text/css",src:"../../../../resources/lupapiste/bundle/lupapiste-shpimport/css/shpimport.css"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-shpimport/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-shpimport/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/lupapiste-shpimport/locale/en.js"}]},bundle:{manifest:{"Bundle-Identifier":"lupapiste-shpimport","Bundle-Name":"lupapiste-shpimport","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2014"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","jquery"],"Import-Bundle":{}}},dependencies:["jquery"]});Oskari.bundle_manager.installBundleClass("lupapiste-shpimport","Oskari.lupapiste.bundle.shpimport.ShpImportBundle");Oskari.clazz.define("Oskari.lupapiste.bundle.shpimport.ShpImportBundleInstance",function(){this.buttonGroup="myplaces";this.toolName="import";this.tool={iconCls:"upload-material",sticky:!0};this.importService=undefined;this.importUrl=undefined;this.tab=undefined},{start:function(){var me=this,conf=this.conf,sandboxName=(conf?conf.sandbox:null)||"sandbox",sandbox=Oskari.getSandbox(sandboxName),request;this.sandbox=sandbox;sandbox.register(this);conf&&conf.stateful===!0&&sandbox.registerAsStateful(this.mediator.bundleId,this);this.importUrl=conf.localImportUrl?location.protocol+"//"+location.hostname+"/"+conf.importUrl:conf.importUrl;this.tab=this.addTab(sandbox);this.importService=this.createService(sandbox);this.importService.init();request=sandbox.getRequestBuilder("userinterface.AddExtensionRequest")(this);sandbox.request(this,request);this.registerTool()},registerTool:function(){var me=this,loc=this.getLocalization(),sandbox=this.getSandbox(),reqBuilder=sandbox.getRequestBuilder("Toolbar.AddToolButtonRequest"),request;this.tool.callback=function(){me.startTool()};this.tool.tooltip=loc.tool.tooltip;reqBuilder&&(request=reqBuilder(this.toolName,this.buttonGroup,this.tool),sandbox.request(this,request))},startTool:function(){var sandbox=this.getSandbox(),reqBuilder=sandbox.getRequestBuilder("userinterface.UpdateExtensionRequest"),toolbarReqBuilder=sandbox.getRequestBuilder("Toolbar.SelectToolButtonRequest"),request,toolbarRequest;reqBuilder&&(request=reqBuilder(this,"attach",this.getName()),sandbox.request(this,request));toolbarReqBuilder&&(toolbarRequest=toolbarReqBuilder(),sandbox.request(this,toolbarRequest))},addUserData:function(formValues,featuresJson){if(featuresJson){var me=this,sandbox=this.getSandbox();this.getService().addUserDataToService(formValues,featuresJson,function(features,values){me.getTab().addRow(features,values);me.getTab().refresh()})}},createService:function(sandbox){var importService=Oskari.clazz.create("Oskari.lupapiste.bundle.shpimport.MyPlacesImportService",this,this.importUrl);return sandbox.registerService(importService),importService},getService:function(){return this.importService},addTab:function(sandbox){var loc=this.getLocalization(),userLayersTab=Oskari.clazz.create("Oskari.lupapiste.bundle.shpimport.UserLayersTab",this,loc.tab),addTabReqBuilder=sandbox.getRequestBuilder("PersonalData.AddTabRequest"),addTabReq;return addTabReqBuilder&&(addTabReq=addTabReqBuilder(loc.tab.title,userLayersTab.getContent()),sandbox.request(this,addTabReq)),userLayersTab},getTab:function(){return this.tab}},{extend:["Oskari.userinterface.extension.DefaultExtension"]});Oskari.clazz.define("Oskari.lupapiste.bundle.shpimport.Flyout",function(instance,locale){this.instance=instance;this.locale=locale;this.container=undefined;this.template=undefined},{__name:"Oskari.lupapiste.bundle.shpimport.Flyout",__templates:{iframe:'<iframe src="JavaScript:""" id="myplacesimport-target" name="myplacesimport-target" height="0" width="0" frameborder="0" scrolling="no"><\/iframe>',base:'<div class="content"><div class="info"><\/div><div class="state"><\/div><\/div>',file:'<div class="file-import"><form id="myplacesimport-form" method="post" enctype="multipart/form-data" target="myplacesimport-target"><input type="file" name="file-import"><\/input><input type="submit" value="Submit" class="primary" /><\/form><\/div>'},getName:function(){return this.__name},setTemplate:function(template){this.template&&template&&this.template.replaceWith(template);this.template=template},getTemplate:function(){return this.template},startPlugin:function(){var container=this.getEl(),iframe=jQuery(this.__templates.iframe).clone();container.addClass("myplacesimport");container.append(iframe);this.setTemplate(this.createUi());container.append(this.getTemplate())},stopPlugin:function(){this.template&&this.template.empty();this.setTemplate(undefined);this.container&&this.container.empty();this.container=undefined},refresh:function(){this.container.find("iframe").replaceWith(jQuery(this.__templates.iframe).clone());this.setTemplate(this.createUi())},createUi:function(){var locale=this.getLocalization(),template=jQuery(this.__templates.base).clone();return template.find("div.info").html(locale.description),template.find("div.state").html(this.__createFileImportTemplate(locale)),template},__createFileImportTemplate:function(locale){var me=this,file=jQuery(this.__templates.file).clone(),action=this.instance.getService().getFileImportUrl(),styleForm=Oskari.clazz.create("Oskari.userinterface.component.VisualizationForm");file.find("div.name label").html(locale.layer.name);file.find("div.desc label").html(locale.layer.desc);file.find("div.source label").html(locale.layer.source);file.find("div.style label").html(locale.layer.style);file.find("div.style-form").html(styleForm.getForm());file.find("form").attr("action",action).find("input[type=submit]").val(locale.file.submit).on("click",function(e){var form=jQuery(this).parent(),styleJson=JSON.stringify(me.__getStyleValues(styleForm));if(form.find("input[name=layer-style]").val(styleJson),me.__validateForm(form,locale))e.preventDefault();else me.container.find("iframe").on("load",function(){me.__finish(jQuery(this),locale)})});return file},__getFormValues:function(formObj){var values={};return values.name=formObj.find("input[name=layer-name]").val(),values.desc=formObj.find("input[name=layer-desc]").val(),values.source=formObj.find("input[name=layer-source]").val(),values.filename=formObj.find("input[name=file-import]").val().split("\\").pop(),values},__getStyleValues:function(styleForm){var formValues=styleForm.getValues(),values={};return formValues&&(values.dot={size:formValues.dot.size,color:"#"+formValues.dot.color,shape:formValues.dot.shape},values.line={size:formValues.line.width,color:"#"+formValues.line.color,cap:formValues.line.cap,corner:formValues.line.corner,style:formValues.line.style},values.area={size:formValues.area.lineWidth,lineColor:"#"+formValues.area.lineColor,fillColor:"#"+formValues.area.fillColor,lineStyle:formValues.area.lineStyle,fillStyle:formValues.area.fillStyle,lineCorner:formValues.area.lineCorner}),values},__validateForm:function(form,locale){var fileInput=form.find("input[type=file]"),nameInput=form.find("input[name=layer-name]"),errors=!1,errorTitle,errorMsg;return fileInput.val()||(errors=!0,errorTitle=locale.validations.error.title,errorMsg=locale.validations.error.message,this.__showMessage(errorTitle,errorMsg)),errors},__finish:function(iframe,locale){var title=locale.finish.success.title,msg=locale.finish.success.message,json,success=!0,formValues=this.__getFormValues(iframe.parent());try{json=JSON.parse(iframe.contents().find("pre").html());this.__jsonError(json)&&(success=!1)}catch(error){this.instance.getSandbox().printWarn("Error whilst parsing user layer json",error);success=!1}success===!0?this.instance.addUserData(formValues,json):(title=null,msg=locale.finish.failure.message);this.__showMessage(title,msg);this.refresh()},__showMessage:function(title,message){var me=this,loc=this._locale,dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup");dialog.show(title,message);dialog.fadeout(5e3)},__jsonError:function(json){var error=!1;return json===null||json===undefined?error=!0:json.error&&(error=!0),error}},{extend:["Oskari.userinterface.extension.DefaultFlyout"]});Oskari.clazz.define("Oskari.lupapiste.bundle.shpimport.UserLayersTab",function(instance,localization){this.instance=instance;this.loc=localization;this.layerMetaType="USERLAYER";this.visibleFields=["name","description","source","filename"];this.grid=undefined;this.container=undefined;this.data=[];this.nextId=1;this.template={};for(p in this.__templates)this.__templates.hasOwnProperty(p)&&(this.template[p]=jQuery(this.__templates[p]))},{__templates:{main:'<div class="oskari-user-layers-tab"><\/div>',link:'<a href="JavaScript:void(0);"><\/a>'},getContent:function(){var me=this,sandbox=me.instance.getSandbox(),grid=Oskari.clazz.create("Oskari.userinterface.component.Grid");return grid.setVisibleFields(this.visibleFields),_.each(this.visibleFields,function(field){grid.setColumnUIName(field,me.loc.grid[field])}),this.container=this.template.main.clone(),this.grid=grid,this.refresh(),this.container},addRow:function(features,values){values.id=this.nextId;this.nextId++;this.data.push(values)},refresh:function(){this.container.empty();this.grid.setDataModel(this._getGridModel());this.grid.renderTo(this.container)},_getGridModel:function(){var gridModel=Oskari.clazz.create("Oskari.userinterface.component.GridModel");return gridModel.setIdField("id"),_.each(this.data,function(data){gridModel.addData({id:data.id,name:data.name,description:data.desc,source:data.source,filename:data.filename,isBase:!0})}),gridModel}});Oskari.clazz.define("Oskari.lupapiste.bundle.shpimport.MyPlacesImportService",function(instance,importUrl){this.instance=instance;this.sandbox=instance.sandbox;this.layerName="LupapisteVectors";this.importUrl=importUrl},{__name:"ShpImport.MyPlacesImportService",__qname:"Oskari.lupapiste.bundle.shpimport.MyPlacesImportService",getQName:function(){return this.__qname},getName:function(){return this.__name},init:function(){},getFileImportUrl:function(){return this.importUrl},addUserDataToService:function(formValues,layerJson,cb){var me=this,mapModule=this.sandbox.findRegisteredModuleInstance("MainMapModule"),map,layers;if(mapModule!=null&&(map=mapModule.getMap(),map!=null)&&(layers=map.getLayersByName(this.layerName),layers!=null&&layers.length!=0)){var layer=layers[0],in_options={internalProjection:map.baseLayer.projection,externalProjection:map.baseLayer.projection},deserializer=new OpenLayers.Format.GeoJSON(in_options),features=deserializer.read(layerJson);me._addFeaturesAsPlaces(features,layer);_.isFunction(cb)&&cb(features,formValues)}},_addFeaturesToLayer:function(features,layer){var toRemove=[],item,itemsToRemove;for(idx in features){item=features[idx];itemsToRemove=layer.getFeaturesByAttribute("id",item.attributes.id);for(innerIdx in itemsToRemove)toRemove.push(itemsToRemove[innerIdx])}layer.removeFeatures(toRemove);layer.addFeatures(features)},_notifyDataAdded:function(features){var sandbox=this.sandbox,eventBuilder=sandbox.getEventBuilder("Lupapiste.FeaturesAdded"),event=eventBuilder(features);sandbox.notifyAll(event)},_addFeaturesAsPlaces:function(features,layer){var sandbox=this.sandbox,service=sandbox.getService("Oskari.lupapiste.bundle.myplaces2.service.MyPlacesService"),me=this,category=service.getDefaultCategory(),places=[],feature,place,callback;for(ix in features)feature=features[ix],place=this._mapFeatureToPlace(feature),place.setCategoryID(category.getId()),places.push(place);callback=function(success,list){var featuresToSave=[],placeObj,f;for(iy in list)placeObj=list[iy],f=new OpenLayers.Feature.Vector,f.geometry=placeObj.getGeometry(),f.attributes.id=placeObj.getId(),f.attributes.name=placeObj.getName(),f.attributes.link=placeObj.getLink(),f.attributes.desc=placeObj.getDescription(),f.attributes.height=placeObj.getHeight(),f.attributes.category=placeObj.getCategoryID(),f.attributes.area=placeObj.getArea(),f.attributes.length=placeObj.getLength(),featuresToSave.push(f);me._addFeaturesToLayer(featuresToSave,layer)};service.saveMyPlaces(places,callback)},_mapFeatureToPlace:function(feature){var place=Oskari.clazz.create("Oskari.lupapiste.bundle.myplaces2.model.MyPlace");return typeof feature.attributes.nimi!="undefined"&&feature.attributes.nimi!==null&&feature.attributes.nimi.length>0?place.setName(feature.attributes.nimi):place.setName("---"),place.setGeometry(feature.geometry),place}},{protocol:["Oskari.mapframework.service.Service"]});Oskari.registerLocalization({lang:"en",key:"ShpImport",value:{title:"Import data",desc:"",tool:{tooltip:"Import data"},flyout:{title:"Import data",description:"You can import you own file in shp zip format or kmz",actions:{cancel:"cancel",next:"next"},file:{submit:"send"},layer:{title:"Saved data",name:"Name",desc:"Description",source:"Source",style:"Style"},validations:{error:{title:"Error",message:"File and name cannot be empty"}},finish:{success:{title:"Import was successful",message:"You can find information on the level of their own menu"},failure:{message:"Import failed. Please try again later."}}},tab:{title:"Imported files",grid:{name:"Name",description:"Description",source:"Source"}},layer:{organization:"My data",inspire:"My data"}}});Oskari.registerLocalization({lang:"fi",key:"ShpImport",value:{title:"Omien aineistojen tuonti",desc:"",tool:{tooltip:"Tuo oma aineisto"},flyout:{title:"Omien aineistojen tuonti",description:"Voit tuoda omia aineistoja shape-formaatissa zip-muodossa (ETRS89 / ETRS-TM35FIN, EPSG:3067) ja kmz-tiedostoja (WGS 84, EPSG:4326).",actions:{cancel:"Peruuta",next:"Seuraava"},file:{submit:"Lhet"},layer:{title:"Tallenna tason tiedot:",name:"Nimi",desc:"Kuvaus",source:"Tietolhde",style:"Tason tyyli"},validations:{error:{title:"Virhe",message:"Tiedosto ja tason nimi puuttuvat."}},finish:{success:{title:"Tason tuonti onnistui",message:"Lydt tason omat tiedot -valikosta"},failure:{message:"Tason tuonti eponnistui. Yrit myhemmin uudelleen."}}},tab:{title:"Aineistot",grid:{name:"Nimi",description:"Kuvaus",source:"Tietolhde"}},layer:{organization:"Omat aineistot",inspire:"Omat aineistot"}}});Oskari.registerLocalization({lang:"sv",key:"ShpImport",value:{title:"Datamngd importering",desc:"",tool:{tooltip:"Importera egen datamngd"},flyout:{title:"Datamngd importering",description:"Du kan importera dina egna datamngder i shape-filformat i zip-paketet (ETRS89 / ETRS-TM35FIN, EPSG:3067) och kmz filformat (WGS 84, EPSG:4326).",actions:{cancel:"Avbryt",next:"Nsta"},file:{submit:"Skicka"},layer:{title:"Spara kartlager information:",name:"Namn",desc:"Beskrivning",source:"Dataklla",style:"Kartlager stil"},validations:{error:{title:"Fel",message:"Fil och kartlager namn fattas."}},finish:{success:{title:"Importering av datamngd lyckades.",message:'Du hittar kartlager i "Mina uppgifter".'},failure:{title:"Systemfel. Frsk p nytt senare."}}},tab:{title:"Datamngder",grid:{name:"Namn",description:"Beskrivning",source:"Dataklla",remove:"Ta bort",removeButton:"Ta bort"},confirmDeleteMsg:"Vill du ta bort:",buttons:{ok:"OK",cancel:"Avbryt","delete":"Ta bort"},notification:{deletedTitle:"Ta bort kartlager",deletedMsg:"Kartlagret borttaget"},error:{title:"Fel!",generic:"Systemfel. Frsk p nytt senare."}},layer:{organization:"Egna datamngder",inspire:"Egna datamngder"}}});Oskari.clazz.define("Oskari.mapframework.bundle.printout.PrintoutBundle",function(){},{create:function(){var me=this;return Oskari.clazz.create("Oskari.mapframework.bundle.printout.PrintoutBundleInstance")},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/jquery.imagesLoaded.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/Flyout.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/Tile.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/plugin/LegendPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/service/PrintService.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/view/StartView.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/view/BasicPrintout.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/request/PrintMapRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/request/PrintMapRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/event/PrintableContentEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/event/PrintWithoutUIEvent.js"},{type:"text/css",src:"../../../../resources/framework/bundle/printout/css/style.css"}],locales:[{lang:"am",type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/locale/am.js"},{lang:"bg",type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/locale/bg.js"},{lang:"cs",type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/locale/cs.js"},{lang:"da",type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/locale/da.js"},{lang:"de",type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/locale/de.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/locale/en.js"},{lang:"es",type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/locale/es.js"},{lang:"et",type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/locale/et.js"},{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/locale/fi.js"},{lang:"gr",type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/locale/gr.js"},{lang:"hr",type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/locale/hr.js"},{lang:"hu",type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/locale/hu.js"},{lang:"lv",type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/locale/lv.js"},{lang:"nl",type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/locale/nl.js"},{lang:"pl",type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/locale/pl.js"},{lang:"pt",type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/locale/pt.js"},{lang:"ro",type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/locale/ro.js"},{lang:"rs",type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/locale/rs.js"},{lang:"sl",type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/locale/sl.js"},{lang:"sk",type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/locale/sk.js"},{lang:"sq",type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/locale/sq.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/locale/sv.js"},{lang:"uk",type:"text/javascript",src:"../../../../bundles/framework/bundle/printout/locale/uk.js"}]},bundle:{manifest:{"Bundle-Identifier":"printout","Bundle-Name":"printout","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","jquery"],"Import-Bundle":{}}},dependencies:["jquery"]});Oskari.bundle_manager.installBundleClass("printout","Oskari.mapframework.bundle.printout.PrintoutBundle");
/*!
 * jQuery imagesLoaded plugin v2.1.1
 * http://github.com/desandro/imagesloaded
 *
 * MIT License. by Paul Irish et al.
 */
(function($,undefined){"use strict";var BLANK="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";$.fn.imagesLoaded=function(callback){function doneLoading(){var $proper=$(proper),$broken=$(broken);deferred&&(broken.length?deferred.reject($images,$proper,$broken):deferred.resolve($images));$.isFunction(callback)&&callback.call($this,$images,$proper,$broken)}function imgLoadedHandler(event){imgLoaded(event.target,event.type==="error")}function imgLoaded(img,isBroken){img.src!==BLANK&&$.inArray(img,loaded)===-1&&(loaded.push(img),isBroken?broken.push(img):proper.push(img),$.data(img,"imagesLoaded",{isBroken:isBroken,src:img.src}),hasNotify&&deferred.notifyWith($(img),[isBroken,$images,$(proper),$(broken)]),$images.length===loaded.length&&(setTimeout(doneLoading),$images.unbind(".imagesLoaded",imgLoadedHandler)))}var $this=this,deferred=$.isFunction($.Deferred)?$.Deferred():0,hasNotify=$.isFunction(deferred.notify),$images=$this.find("img").add($this.filter("img")),loaded=[],proper=[],broken=[];return $.isPlainObject(callback)&&$.each(callback,function(key,value){key==="callback"?callback=value:deferred&&deferred[key](value)}),$images.length?$images.bind("load.imagesLoaded error.imagesLoaded",imgLoadedHandler).each(function(i,el){var src=el.src,cached=$.data(el,"imagesLoaded");if(cached&&cached.src===src){imgLoaded(el,cached.isBroken);return}if(el.complete&&el.naturalWidth!==undefined){imgLoaded(el,el.naturalWidth===0||el.naturalHeight===0);return}(el.readyState||el.complete)&&(el.src=BLANK,el.src=src)}):doneLoading(),deferred?deferred.promise($this):$this}})(jQuery);Oskari.clazz.define("Oskari.mapframework.bundle.printout.PrintoutBundleInstance",function(){this.sandbox=undefined;this.started=!1;this.plugins={};this.localization=undefined;this.printout=undefined;this.buttonGroup="viewtools";this.ignoreEvents=!1;this.dialog=undefined;this.printoutHandler=undefined;this.isMapStateChanged=!0;this.state=undefined;this.geoJson=undefined;this.tileData=undefined;this.printService=undefined;this.legendPlugin=undefined;this.backendConfiguration={formatProducers:{"application/pdf":"","image/png":""},localBackend:!1}},{__name:"Printout",getName:function(){return this.__name},getSandbox:function(){return this.sandbox},getLocalization:function(key){return(this._localization||(this._localization=Oskari.getLocalization(this.getName())),key)?this._localization[key]:this._localization},start:function(){var me=this,p,serverPrefix,addBtnRequestBuilder,btns,tool,printService,request,map,layers,jsonFormat;if(!me.started){me.started=!0;var conf=this.conf,sandboxName=(conf?conf.sandbox:null)||"sandbox",sandbox=Oskari.getSandbox(sandboxName);me.sandbox=sandbox;this.localization=Oskari.getLocalization(this.getName());sandbox.register(me);for(p in me.eventHandlers)me.eventHandlers.hasOwnProperty(p)&&sandbox.registerForEventByName(me,p);conf?(serverPrefix="",conf.backendConfiguration.localBackend&&(serverPrefix=location.protocol+"//"+location.hostname+"/"),me.backendConfiguration.formatProducers["application/pdf"]=serverPrefix+conf.backendConfiguration.formatProducers["application/pdf"]||"",me.backendConfiguration.formatProducers["image/png"]=serverPrefix+conf.backendConfiguration.formatProducers["image/png"]||""):(me.backendConfiguration.formatProducers["application/pdf"]="",me.backendConfiguration.formatProducers["image/png"]="");this.printoutHandler=Oskari.clazz.create("Oskari.mapframework.bundle.printout.request.PrintMapRequestHandler",sandbox,function(){me.instance.sandbox.postRequestByName("userinterface.UpdateExtensionRequest",[me.instance,"attach"])});sandbox.addRequestHandler("printout.PrintMapRequest",this.printoutHandler);addBtnRequestBuilder=sandbox.getRequestBuilder("Toolbar.AddToolButtonRequest");btns={print:{iconCls:"tool-print",tooltip:this.localization.btnTooltip,sticky:!0,callback:function(){me.sandbox.postRequestByName("userinterface.UpdateExtensionRequest",[me,"attach"])}}};for(tool in btns)btns.hasOwnProperty(tool)&&sandbox.request(this,addBtnRequestBuilder(tool,this.buttonGroup,btns[tool]));printService=Oskari.clazz.create("Oskari.mapframework.bundle.printout.service.PrintService",me);sandbox.registerService(printService);this.printService=printService;var locale=me.getLocalization(),mapModule=sandbox.findRegisteredModuleInstance("MainMapModule"),pluginConfig=this.conf.legend,legendPlugin=Oskari.clazz.create("Oskari.mapframework.bundle.printout.plugin.LegendPlugin",me,pluginConfig,locale);mapModule.registerPlugin(legendPlugin);mapModule.startPlugin(legendPlugin);this.legendPlugin=legendPlugin;request=sandbox.getRequestBuilder("userinterface.AddExtensionRequest")(this);sandbox.request(this,request);me._createUi();sandbox.registerAsStateful(this.mediator.bundleId,this);this.tileData={};map=sandbox.findRegisteredModuleInstance("MainMapModule").getMap();layers=map.getLayersByName("LupapisteVectors");typeof layers!="undefined"&&layers!==null&&layers.length>0&&(jsonFormat=new OpenLayers.Format.GeoJSON,this.geoJson=jsonFormat.write(layers[0].features))}},init:function(){return null},update:function(){},onEvent:function(event){var handler=this.eventHandlers[event.getName()];if(handler)return handler.apply(this,[event])},eventHandlers:{MapLayerVisibilityChangedEvent:function(){this.printout&&this.printout.isEnabled&&this.isMapStateChanged&&(this.isMapStateChanged=!1,this.getSandbox().printDebug("PRINTOUT REFRESH"),this.printout.refresh(!0))},AfterMapMoveEvent:function(){this.isMapStateChanged=!0;this.printout&&this.printout.isEnabled&&this.printout.refresh(!1);this.isMapStateChanged=!0},AfterMapLayerAddEvent:function(){this.isMapStateChanged=!0;this.printout&&this.printout.isEnabled&&this.printout.refresh(!1)},AfterMapLayerRemoveEvent:function(){this.isMapStateChanged=!0;this.printout&&this.printout.isEnabled&&this.printout.refresh(!1)},AfterChangeMapLayerStyleEvent:function(){this.isMapStateChanged=!0;this.printout&&this.printout.isEnabled&&this.printout.refresh(!1)},"userinterface.ExtensionUpdatedEvent":function(event){var me=this,isOpen;event.getExtension().getName()===me.getName()&&(isOpen=event.getViewState()!=="close",me.displayContent(isOpen))},"Printout.PrintableContentEvent":function(event){var contentId=event.getContentId(),layer=event.getLayer(),layerId=layer&&layer.getId?layer.getId():null,tileData=event.getTileData(),geoJson=event.getGeoJsonData();geoJson&&(this.geoJson=geoJson);tileData&&layerId&&(this.tileData[layerId]=tileData)},"Printout.PrintWithoutUIEvent":function(event){var me=this,contentId=event.getContentId(),printParams=event.getPrintParams(),geoJson=event.getGeoJsonData(),map;geoJson&&(me.geoJson=geoJson);me.printout||(map=jQuery("#contentMap"),me.printout=Oskari.clazz.create("Oskari.mapframework.bundle.printout.view.BasicPrintout",this,this.getLocalization("BasicView"),this.backendConfiguration),this.printout.render(map),this.printout.setEnabled(!1),this.printout.hide());me.printout.printMap(printParams)}},stop:function(){var sandbox,p,request;this.printout&&(this.printout.destroy(),this.printout=undefined);this.geoJson=null;this.tileData=null;sandbox=this.sandbox();for(p in this.eventHandlers)this.eventHandlers.hasOwnProperty(p)&&sandbox.unregisterFromEventByName(this,p);sandbox.removeRequestHandler("printout.PrintMapRequest",this.printoutHandler);this.printoutHandler=null;request=sandbox.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);sandbox.request(this,request);this.sandbox.unregisterStateful(this.mediator.bundleId);this.sandbox.unregister(this);this.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.printout.Flyout",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},_createUi:function(){var me=this;this.plugins["Oskari.userinterface.Flyout"].createUi()},setPublishMode:function(blnEnabled){for(var me=this,map=jQuery("#contentMap"),tools=jQuery("#maptools"),selectedLayers=me.sandbox.findAllSelectedMapLayers(),layer,request,i=0;i<selectedLayers.length;i+=1)if(layer=selectedLayers[i],layer.getLayerType()==="stats"){request=me.sandbox.getRequestBuilder("StatsGrid.StatsGridRequest")(!1,layer);me.sandbox.request(me.getName(),request);break}blnEnabled?(jQuery(me.plugins["Oskari.userinterface.Flyout"].container).parent().parent().css("display","none"),this.printout||(this.printout=Oskari.clazz.create("Oskari.mapframework.bundle.printout.view.BasicPrintout",this,this.getLocalization("BasicView"),this.backendConfiguration),this.printout.render(map)),this.state&&this.state.form&&this.printout.setState(this.state.form),this.printout.show(),this.printout.setEnabled(!0),this.printout.refresh(!1),this.printout.refresh(!0)):this.printout&&(jQuery(me.plugins["Oskari.userinterface.Flyout"].container).parent().parent().css("display",""),request=me.sandbox.getRequestBuilder("userinterface.UpdateExtensionRequest")(me,"close",me.getName()),me.sandbox.request(me.getName(),request),this.printout.setEnabled(!1),this.printout.hide(),this.printout&&this.legendPlugin.clearLegendLayers())},displayContent:function(isOpen){isOpen&&this.plugins["Oskari.userinterface.Flyout"].refresh()},setState:function(state){this.state=state},getState:function(){var state=this.state||{},formState;return this.printout&&(formState=this.printout.getState(),state.form=formState),state}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension","Oskari.userinterface.Stateful"]});Oskari.clazz.define("Oskari.mapframework.bundle.printout.Flyout",function(instance){this.instance=instance;this.container=null;this.state=null;this.template=null;this.view=null},{getName:function(){return"Oskari.mapframework.bundle.printout.Flyout"},setEl:function(el){this.container=el[0];jQuery(this.container).hasClass("printout")||jQuery(this.container).addClass("printout")},startPlugin:function(){this.template=jQuery("<div><\/div>")},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("flyouttitle")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(state){this.state=state},createUi:function(){var me=this,flyout=jQuery(this.container);this.view=Oskari.clazz.create("Oskari.mapframework.bundle.printout.view.StartView",this.instance,this.instance.getLocalization("StartView"))},refresh:function(){var flyout=jQuery(this.container);flyout.empty();this.view.render(flyout)}},{protocol:["Oskari.userinterface.Flyout"]});Oskari.clazz.define("Oskari.mapframework.bundle.printout.Tile",function(instance){this.instance=instance;this.container=null;this.template=null},{getName:function(){return"Oskari.mapframework.bundle.printout.Tile"},setEl:function(el){this.container=jQuery(el)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(){},refresh:function(){}},{protocol:["Oskari.userinterface.Tile"]});Oskari.clazz.define("Oskari.mapframework.bundle.printout.plugin.LegendPlugin",function(instance,conf,locale){this.instance=instance;this.sandbox=instance.sandbox;this.mapModule=null;this.pluginName=null;this.conf=conf;this.conf||(this.conf={});this.locale=locale;this.headerLayer=null;this.printAreaLayer=null;this.boxesLayer=null;this._map=null},{__name:"LegendPlugin",__qname:"Oskari.mapframework.bundle.printout.plugin.LegendPlugin",getQName:function(){return this.__qname},getName:function(){return this.pluginName},getMap:function(){return this._map},register:function(){},unregister:function(){},startPlugin:function(sandbox){this._sandbox=sandbox;this._map=this.getMapModule().getMap();sandbox.register(this)},stopPlugin:function(sandbox){sandbox.unregister(this)},start:function(){},stop:function(){},init:function(){var smPrintArea=new OpenLayers.StyleMap({"default":this.conf.printAreaDefault}),smHeader,smBoxes;this.printAreaLayer=new OpenLayers.Layer.Vector("PrintArea",{styleMap:smPrintArea});smHeader=new OpenLayers.StyleMap({"default":this.conf.legendBoxDefault});this.headerLayer=new OpenLayers.Layer.Vector("LegendHeader",{styleMap:smHeader});smBoxes=new OpenLayers.StyleMap({"default":this.conf.colorBoxDefault});this.boxesLayer=new OpenLayers.Layer.Vector("LegendBoxes",{styleMap:smBoxes})},getMapModule:function(){return this.mapModule},setMapModule:function(mapModule){this.mapModule=mapModule;mapModule&&(this._map=mapModule.getMap(),this.pluginName=mapModule.getName()+this.__name)},plotLegend:function(title,ranges,printInfo,legend_pos){var map=this.getMapModule().getMap(),legend_geom;return map.getLayerIndex(this.printAreaLayer)===-1?(map.addLayer(this.printAreaLayer),map.setLayerIndex(this.printAreaLayer,10004)):map.raiseLayer(this.printAreaLayer,101),map.getLayerIndex(this.headerLayer)===-1?(map.addLayer(this.headerLayer),map.setLayerIndex(this.headerLayer,10005)):map.raiseLayer(this.headerLayer,102),map.getLayerIndex(this.boxesLayer===-1)?(map.addLayer(this.boxesLayer),map.setLayerIndex(this.boxesLayer,10006)):map.raiseLayer(this.boxesLayer,103),this.clearLegendLayers(),legend_geom=this._getLegendGeom(title,ranges,printInfo,legend_pos),this._plotLegendHeader(title,ranges,legend_geom),this._plotLegendBoxes(title,ranges,legend_geom),this._createPrintGeoJSON()},_maxLayerIndex:function(){for(var top=0,layers=this.instance.getSandbox().findAllSelectedMapLayers(),i=0;i<layers.length;i++)this.getMapModule().getMap().getLayerIndex(layers[i])>top&&(top=this.getMapModule().getMap().getLayerIndex(layers[i]));return top},_getLegendGeom:function(title,ranges,printInfo,legend_pos){var properties=printInfo.features[0].properties,pixel_width=properties.targetWidth,pixel_height=properties.targetHeight,coords=printInfo.features[0].geometry.coordinates[0],width=Number(coords[1][0])-Number(coords[0][0]),height=Number(coords[2][1])-Number(coords[1][1]),titles=[],i,titlesplit,titletemp,lside,acoord,coordp;if(title.length>this.conf.general.charsInrow){for(titlesplit=title.split(" "),titletemp="",i=0;i<titlesplit.length;i++)titletemp.length+titlesplit[i].length+1<this.conf.general.charsInrow?titletemp=titletemp+titlesplit[i]+" ":(titles.push(titletemp),titletemp=titlesplit[i]);titletemp.length>0&&titles.push(titletemp)}else titles.push(title);lside=width;height>width&&(lside=height);var l_height=this.conf.general.legendRowHeight*lside*(ranges.length+titles.length+1),l_width=this.conf.general.legendWidth*lside,box_size=l_height/(ranges.length+titles.length+1),lcoord=[];for(legend_pos==="LL"?(lcoord.push(new OpenLayers.Geometry.Point(coords[0][0],coords[0][1]+l_height)),lcoord.push(new OpenLayers.Geometry.Point(coords[0][0]+l_width,coords[0][1]+l_height)),lcoord.push(new OpenLayers.Geometry.Point(coords[0][0]+l_width,coords[0][1])),lcoord.push(new OpenLayers.Geometry.Point(coords[0][0],coords[0][1]))):legend_pos==="LU"?(lcoord.push(new OpenLayers.Geometry.Point(coords[0][0],coords[3][1])),lcoord.push(new OpenLayers.Geometry.Point(coords[0][0]+l_width,coords[3][1])),lcoord.push(new OpenLayers.Geometry.Point(coords[0][0]+l_width,coords[3][1]-l_height)),lcoord.push(new OpenLayers.Geometry.Point(coords[0][0],coords[3][1]-l_height))):legend_pos==="RU"?(lcoord.push(new OpenLayers.Geometry.Point(coords[2][0]-l_width,coords[2][1])),lcoord.push(new OpenLayers.Geometry.Point(coords[2][0],coords[2][1])),lcoord.push(new OpenLayers.Geometry.Point(coords[2][0],coords[2][1]-l_height)),lcoord.push(new OpenLayers.Geometry.Point(coords[2][0]-l_width,coords[2][1]-l_height))):legend_pos==="RL"&&(lcoord.push(new OpenLayers.Geometry.Point(coords[1][0]-l_width,coords[1][1]+l_height)),lcoord.push(new OpenLayers.Geometry.Point(coords[1][0],coords[1][1]+l_height)),lcoord.push(new OpenLayers.Geometry.Point(coords[1][0],coords[1][1])),lcoord.push(new OpenLayers.Geometry.Point(coords[1][0]-l_width,coords[1][1]))),acoord=[],i=0;coordp=coords[i++];)acoord.push(new OpenLayers.Geometry.Point(coordp[0],coordp[1]));return{print_area:acoord,bbox:lcoord,rangebox_size:box_size,properties:properties,titles:titles}},clearLegendLayers:function(){this.headerLayer&&this.headerLayer.removeAllFeatures();this.boxesLayer&&this.boxesLayer.removeAllFeatures();this.printAreaLayer&&this.printAreaLayer.removeAllFeatures()},_plotLegendHeader:function(title,ranges,legend_geom){var me=this,coords=legend_geom.bbox,points=coords,ring=new OpenLayers.Geometry.LinearRing(points),polygon=new OpenLayers.Geometry.Polygon([ring]),line=new OpenLayers.Geometry.LineString(legend_geom.print_area),fea_print_area=new OpenLayers.Feature.Vector(line,null),feature_bbox,titles,i;for(me.printAreaLayer.addFeatures([fea_print_area]),me.printAreaLayer.redraw(),feature_bbox=new OpenLayers.Feature.Vector(polygon,{color:"#FFFFFF",name:'\0'}),me.headerLayer.addFeatures([feature_bbox]),titles=legend_geom.titles,i=0;i<titles.length;i++){var point=coords[0].clone(),label_point=new OpenLayers.Geometry.Point(point.x+.2*legend_geom.rangebox_size,point.y-(i*legend_geom.rangebox_size+legend_geom.rangebox_size/2)),pattributes={name:titles[i]},feature_label=new OpenLayers.Feature.Vector(label_point,pattributes);me.headerLayer.addFeatures([feature_label])}me.headerLayer.redraw()},_plotLegendBoxes:function(title,ranges,legend_geom){for(var me=this,coords=legend_geom.bbox,titles=legend_geom.titles,box_size=legend_geom.rangebox_size,box_insize=.8*legend_geom.rangebox_size,point=coords[0].clone(),x_LU=point.x+.2*box_size,y_LU=point.y-box_size*titles.length,range,mycolor,pattributes,feature_label,i=0;i<ranges.length;i++){range=ranges[i];mycolor="#FFFFFF";range.boxcolor.split(":").length>1&&(mycolor=range.boxcolor.split(":")[1].replace(/^\s+|\s+$/g,""));var x=x_LU,y=y_LU,points=[new OpenLayers.Geometry.Point(x,y),new OpenLayers.Geometry.Point(x+box_insize,y),new OpenLayers.Geometry.Point(x+box_insize,y-box_insize),new OpenLayers.Geometry.Point(x,y-box_insize)],ring=new OpenLayers.Geometry.LinearRing(points),polygon=new OpenLayers.Geometry.Polygon([ring]),attributes={color:mycolor,name:'\0'},feature_bbox=new OpenLayers.Feature.Vector(polygon,attributes);me.boxesLayer.addFeatures([feature_bbox]);point=new OpenLayers.Geometry.Point(x+box_size,y-box_insize);pattributes={name:range.range};feature_label=new OpenLayers.Feature.Vector(point,pattributes);me.boxesLayer.addFeatures([feature_label]);y_LU=y_LU-box_size}me.boxesLayer.redraw()},_createPrintGeoJSON:function(){var geojson_format=new OpenLayers.Format.GeoJSON,geojsCollection=[],header=JSON.parse(geojson_format.write(this.headerLayer.features)),geojs={type:"geojson",name:this.headerLayer.name,id:this.headerLayer.name,data:{type:"FeatureCollection",features:header.features},styles:[]},boxes;return geojs.styles.push(this._getDefaultStyle(this.headerLayer.styleMap)),geojsCollection.push(geojs),boxes=JSON.parse(geojson_format.write(this.boxesLayer.features)),geojs={type:"geojson",name:this.boxesLayer.name,id:this.boxesLayer.name,data:{type:"FeatureCollection",features:boxes.features},styles:[]},geojs.styles.push(this._getDefaultStyle(this.boxesLayer.styleMap)),geojsCollection.push(geojs),geojsCollection},_getDefaultStyle:function(styleMap){var style=styleMap.styles["default"].defaultStyle,id=styleMap.styles["default"].id,printStyle={title:"Standard",name:id,styleMap:{"default":{}}};return printStyle.styleMap["default"]=this._cleanStyle(style,["labelXOffset","labelYOffset"]),printStyle},_cleanStyle:function(stylein,attrs_to_remove){for(var style=jQuery.extend(!0,{},stylein),key,i=0;i<attrs_to_remove.length;i++)key=attrs_to_remove[i],style[key]&&style[key].toString().indexOf("${delta")>-1&&delete style[key];return style},protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]});Oskari.clazz.define("Oskari.mapframework.bundle.printout.service.PrintService",function(instance){this.instance=instance;this.sandbox=instance.sandbox},{__name:"Printout.PrintService",__qname:"Oskari.mapframework.bundle.printout.service.PrintService",getQName:function(){return this.__qname},getName:function(){return this.__name},init:function(){},fetchPrintMapData:function(url,successCb,errorCb){jQuery.ajax({type:"GET",dataType:"json",beforeSend:function(x){x&&x.overrideMimeType&&x.overrideMimeType("application/j-son;charset=UTF-8")},url:url,success:function(pResp){successCb&&successCb(pResp)},error:function(jqXHR,textStatus){errorCb&&jqXHR.status!==0&&errorCb(jqXHR,textStatus)}})}},{protocol:["Oskari.mapframework.service.Service"]});Oskari.clazz.define("Oskari.mapframework.bundle.printout.view.StartView",function(instance,localization){this.instance=instance;this.template=jQuery("<div class='startview'><div class='content'><\/div><div class='buttons'><\/div><\/div>");this.templateError=jQuery('<div class="error"><ul><\/ul><\/div>');this.templateInfo=jQuery("<div class='icon-info'><\/div>");this.loc=localization;this.content=undefined;this.buttons={};this.alert=Oskari.clazz.create("Oskari.userinterface.component.Alert")},{_isTooManyLayers:function(){var layerCount=this.instance.getSandbox().findAllSelectedMapLayers().length;return layerCount>7},_isManyLayers:function(){var layerCount=this.instance.getSandbox().findAllSelectedMapLayers().length;return layerCount>2},render:function(container){var me=this,content=this.template.clone(),isMaxLayersExceeded,isManyLayersExceeded,continueButton,cancelButton;this.content=content;container.append(content);this.alert.insertTo(container);isMaxLayersExceeded=this._isTooManyLayers();isManyLayersExceeded=this._isManyLayers();isMaxLayersExceeded?this.alert.setContent(this.loc.info.maxLayers,"error"):isManyLayersExceeded?this.alert.setContent(this.loc.info.printoutProcessingTime,"info"):this.alert.setContent(this.loc.text,"default");isMaxLayersExceeded||(continueButton=Oskari.clazz.create("Oskari.userinterface.component.Button"),continueButton.addClass("primary"),continueButton.setTitle(this.loc.buttons["continue"]),continueButton.setHandler(function(){me.instance.setPublishMode(!0)}),this.buttons["continue"]=continueButton,continueButton.insertTo(content.find("div.buttons")));cancelButton=Oskari.clazz.create("Oskari.userinterface.component.Button");isMaxLayersExceeded&&cancelButton.addClass("primary");cancelButton.setTitle(this.loc.buttons.cancel);cancelButton.setHandler(function(){me.instance.sandbox.postRequestByName("userinterface.UpdateExtensionRequest",[me.instance,"close"])});this.buttons.cancel=cancelButton;cancelButton.insertTo(content.find("div.buttons"))}});Oskari.clazz.define("Oskari.mapframework.bundle.printout.view.BasicPrintout",function(instance,localization,backendConfiguration){var me=this,p,s,f;this.isEnabled=!1;this.instance=instance;this.loc=localization;this.backendConfiguration=backendConfiguration;this.legendInProcess=!1;this.template={};for(p in this.__templates)this.__templates.hasOwnProperty(p)&&(this.template[p]=jQuery(this.__templates[p]));for(this.sizeOptions=this.loc.size.options,this.sizeOptionsMap={},s=0;s<this.sizeOptions.length;s++)this.sizeOptionsMap[this.sizeOptions[s].id]=this.sizeOptions[s];for(this.formatOptions=this.loc.format.options,this.formatOptionsMap={},f=0;f<this.formatOptions.length;f++)this.formatOptionsMap[this.formatOptions[f].id]=this.formatOptions[f];for(this.contentOptions=this.loc.content.options,this.contentOptionsMap={},f=0;f<this.contentOptions.length;f++)this.contentOptionsMap[this.contentOptions[f].id]=this.contentOptions[f];for(this.legendOptions=this.loc.legend.options,this.legendOptionsMap={},f=0;f<this.legendOptions.length;f++)this.legendOptionsMap[this.legendOptions[f].id]=this.legendOptions[f];this.accordion=null;this.mainPanel=null;this.progressSpinner=Oskari.clazz.create("Oskari.userinterface.component.ProgressSpinner");this.alert=Oskari.clazz.create("Oskari.userinterface.component.Alert");this.previewContent=null;this.previewImgDiv=null;this.contentOptionDivs={}},{__templates:{preview:'<div class="preview"><img /><span><\/span><\/div>',previewNotes:'<div class="previewNotes"><span><\/span><\/div>',location:'<div class="location"><\/div>',tool:'<div class="tool "><input type="checkbox"/><label><\/label><\/div>',buttons:'<div class="buttons"><\/div>',help:'<div class="help icon-info"><\/div>',main:'<div class="basic_printout"><div class="header"><div class="icon-close"><\/div><h3><\/h3><\/div><div class="content"><\/div><form method="post" target="map_popup_111" id="oskari_print_formID" style="display:none" action="" ><input name="geojson" type="hidden" value="" id="oskari_geojson"/><input name="tiles" type="hidden" value="" id="oskari_tiles"/><\/form><\/div>',format:'<div class="printout_format_cont printout_settings_cont"><div class="printout_format_label"><\/div><\/div>',formatOptionTool:'<div class="tool "><input type="radio" name="format" /><label><\/label><\/div>',legend:'<div class="printout_legend_cont printout_settings_cont"><div class="printout_legend_label"><\/div><\/div>',legendOptionTool:'<div class="tool "><input type="radio" name="legend" /><label><\/label><\/div>',title:'<div class="printout_title_cont printout_settings_cont"><div class="printout_title_label"><\/div><input class="printout_title_field" type="text"><\/div>',option:'<div class="printout_option_cont printout_settings_cont"><input type="checkbox" /><label><\/label><\/div>',sizeOptionTool:'<div class="tool "><input type="radio" name="size" /><label><\/label><\/div>'},render:function(container){var me=this,content=this.template.main.clone(),contentDiv,accordion,sizePanel,settingsPanel,previewPanel,inputs,helper;this.mainPanel=content;content.find("div.header h3").append(this.loc.title);container.append(content);contentDiv=content.find("div.content");this.alert.insertTo(contentDiv);accordion=Oskari.clazz.create("Oskari.userinterface.component.Accordion");this.accordion=accordion;sizePanel=this._createSizePanel();sizePanel.open();accordion.addPanel(sizePanel);settingsPanel=this._createSettingsPanel();accordion.addPanel(settingsPanel);previewPanel=this._createPreviewPanel();previewPanel.open();accordion.addPanel(previewPanel);accordion.insertTo(contentDiv);this._setLegendVisibility();container.find("div.header div.icon-close").bind("click",function(){me.instance.setPublishMode(!1)});contentDiv.append(this._getButtons());inputs=this.mainPanel.find("input[type=text]");inputs.focus(function(){me.instance.sandbox.postRequestByName("DisableMapKeyboardMovementRequest")});inputs.blur(function(){me.instance.sandbox.postRequestByName("EnableMapKeyboardMovementRequest")});helper=Oskari.clazz.create("Oskari.userinterface.component.UIHelper",this.instance.sandbox);helper.processHelpLinks(this.loc.help,content,this.loc.error.title,this.loc.error.nohelp)},_createSizePanel:function(){var me=this,panel=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel"),contentPanel,tooltipCont,i,closureMagic;for(panel.setTitle(this.loc.size.label),contentPanel=panel.getContainer(),tooltipCont=this.template.help.clone(),tooltipCont.attr("title",this.loc.size.tooltip),contentPanel.append(tooltipCont),closureMagic=function(tool){return function(){for(var size=contentPanel.find("input[name=size]:checked").val(),i=0;i<me.sizeOptions.length;++i)me.sizeOptions[i].selected=!1;tool.selected=!0;me._cleanMapPreview();me._updateMapPreview();me._createLegend()}},i=0;i<this.sizeOptions.length;++i){var option=this.sizeOptions[i],toolContainer=this.template.sizeOptionTool.clone(),label=option.label;option.width&&option.height&&(label=label+" ("+option.width+" x "+option.height+"px)");toolContainer.find("label").append(label).attr({"for":option.id,"class":"printout_radiolabel"});option.selected&&toolContainer.find("input").attr("checked","checked");contentPanel.append(toolContainer);toolContainer.find("input").attr({value:option.id,name:"size",id:option.id});toolContainer.find("input").change(closureMagic(option))}return panel},_createSettingsPanel:function(){var me=this,panel=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel"),contentPanel,tooltipCont,closureMagic,format,i,f,option,toolContainer,label,mapTitle,dat,opt,closureMagic2,legend;for(panel.setTitle(this.loc.settings.label),contentPanel=panel.getContainer(),tooltipCont=this.template.help.clone(),tooltipCont.attr("title",this.loc.settings.tooltip),contentPanel.append(tooltipCont),closureMagic=function(tool){return function(){for(var format=contentPanel.find("input[name=format]:checked").val(),i=0;i<me.formatOptions.length;++i)me.formatOptions[i].selected=!1;tool.selected=!0}},format=this.template.format.clone(),format.find(".printout_format_label").html(this.loc.format.label),i=0;i<this.formatOptions.length;++i)option=this.formatOptions[i],toolContainer=this.template.formatOptionTool.clone(),label=option.label,toolContainer.find("label").append(label).attr({"for":option.id,"class":"printout_radiolabel"}),option.selected&&toolContainer.find("input").attr("checked","checked"),format.append(toolContainer),toolContainer.find("input").attr({value:option.format,name:"format",id:option.id}),toolContainer.find("input").change(closureMagic(option));for(contentPanel.append(format),mapTitle=this.template.title.clone(),mapTitle.find(".printout_title_label").html(this.loc.mapTitle.label),mapTitle.find(".printout_title_field").attr({value:"",placeholder:this.loc.mapTitle.label}),contentPanel.append(mapTitle),f=0;f<this.contentOptions.length;f++)dat=this.contentOptions[f],opt=this.template.option.clone(),opt.find("input").attr({id:dat.id,checked:dat.checked}),opt.find("label").html(dat.label).attr({"for":dat.id,"class":"printout_checklabel"}),this.contentOptionDivs[dat.id]=opt,contentPanel.append(opt);for(closureMagic2=function(tool){return function(){for(var legend=contentPanel.find("input[name=legend]:checked").val(),i=0;i<me.legendOptions.length;++i)me.legendOptions[i].selected=!1;tool.selected=!0}},legend=this.template.legend.clone(),legend.find(".printout_legend_label").html(this.loc.legend.label),i=0;i<this.legendOptions.length;++i)option=this.legendOptions[i],toolContainer=this.template.legendOptionTool.clone(),label=option.label,toolContainer.find("label").append(label).attr({"for":option.id,"class":"printout_radiolabel"}),option.selected&&toolContainer.find("input").attr("checked","checked"),legend.append(toolContainer),toolContainer.find("input").attr({value:option.loca,name:"location",id:option.id}),toolContainer.find("input").change(closureMagic2(option)),toolContainer.find('input[name="location"]').click(function(){me._createLegend()});return contentPanel.append(legend),panel},_createPreviewPanel:function(){var me=this,panel=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel"),contentPanel,tooltipCont,previewContent,previewImgDiv,previewSpan,p,previewNotes;panel.setTitle(this.loc.preview.label);contentPanel=panel.getContainer();tooltipCont=this.template.help.clone();tooltipCont.attr("title",this.loc.preview.tooltip);contentPanel.append(tooltipCont);previewContent=this.template.preview.clone();contentPanel.append(previewContent);me.progressSpinner.insertTo(previewContent);previewImgDiv=previewContent.find("img");previewImgDiv.click(function(){me.showFullScaleMapPreview()});previewSpan=previewContent.find("span");this.previewContent=previewContent;this.previewImgDiv=previewImgDiv;this.previewSpan=previewSpan;for(p in this.loc.preview.notes)this.loc.preview.notes.hasOwnProperty(p)&&(previewNotes=this.template.previewNotes.clone(),previewNotes.find("span").text(this.loc.preview.notes[p]),contentPanel.append(previewNotes));return panel},_createLocationAndScalePanel:function(){var me=this,panel=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel"),contentPanel,tooltipCont,locationContent;return panel.setTitle(this.loc.location.label),contentPanel=panel.getContainer(),tooltipCont=this.template.help.clone(),tooltipCont.attr("title",this.loc.location.tooltip),contentPanel.append(tooltipCont),locationContent=this.template.location.clone(),contentPanel.append(locationContent),panel},_cleanMapPreview:function(){var loc=this.loc,previewImgDiv=this.previewImgDiv,previewSpan=this.previewSpan;previewImgDiv.hide();previewSpan.text(loc.preview.pending)},_updateMapPreview:function(){var me=this,selections=this._gatherSelections("image/png"),urlBase=this.backendConfiguration.formatProducers[selections.format],maplinkArgs=selections.maplinkArgs,pageSizeArgs="&pageSize="+selections.pageSize,municipalityCode="&municipalityCode="+me._getURLParameter("municipality"),url=urlBase+maplinkArgs+pageSizeArgs+"&scaledWidth=200"+municipalityCode,previewImgDiv,previewSpan;this.previewContent.removeClass("preview-portrait");this.previewContent.removeClass("preview-landscape");this.previewContent.addClass(this.sizeOptionsMap[selections.pageSize].classForPreview);previewImgDiv=this.previewImgDiv;previewSpan=this.previewSpan;previewImgDiv.attr("src","");me.progressSpinner.start();window.setTimeout(function(){previewImgDiv.imagesLoaded(function(){previewSpan.text("");previewImgDiv.fadeIn("slow",function(){me.progressSpinner.stop()})});previewImgDiv.attr("src",url)},100)},showFullScaleMapPreview:function(){var selections=this._gatherSelections("image/png"),urlBase=this.backendConfiguration.formatProducers[selections.format],maplinkArgs=selections.maplinkArgs,pageSizeArgs="&pageSize="+selections.pageSize,url=urlBase+maplinkArgs+pageSizeArgs;this.openURLinWindow(url,selections)},_getButtons:function(){var me=this,buttonCont=this.template.buttons.clone(),cancelBtn=Oskari.clazz.create("Oskari.userinterface.component.Button"),saveBtn;return cancelBtn.setTitle(this.loc.buttons.cancel),cancelBtn.setHandler(function(){me.instance.setPublishMode(!1)}),cancelBtn.insertTo(buttonCont),saveBtn=Oskari.clazz.create("Oskari.userinterface.component.Button"),saveBtn.setTitle(this.loc.buttons.save),saveBtn.addClass("primary"),saveBtn.setHandler(function(){var map=me.instance.sandbox.getMap(),features=map.geojs===undefined||map.geojs===null?null:map.geojs,selections=me._gatherSelections();selections&&me._printMap(selections,features)}),saveBtn.insertTo(buttonCont),buttonCont},_gatherSelections:function(format){var container=this.mainPanel,sandbox=this.instance.getSandbox(),size=container.find("input[name=size]:checked").val(),selectedFormat=format!==null&&format!==undefined?format:container.find("input[name=format]:checked").val(),title=container.find(".printout_title_field").val(),maplinkArgs=sandbox.generateMapLinkParameters(),selections={pageTitle:title,pageSize:size,maplinkArgs:maplinkArgs,format:selectedFormat||"application/pdf"};for(var p in this.contentOptionsMap)this.contentOptionsMap.hasOwnProperty(p)&&(selections[p]=this.contentOptionDivs[p].find("input").prop("checked"));return selections},openURLinWindow:function(infoUrl,selections){var wopParm="location=1,status=1,scrollbars=1,width=850,height=1200",link;this._isLandscape(selections)&&(wopParm="location=1,status=1,scrollbars=1,width=1200,height=850");link=infoUrl;window.open(link,"BasicPrintout",wopParm)},openPostURLinWindow:function(geoJson,tileData,printUrl,selections){var me=this,wopParm="location=1,status=1,scrollbars=1,width=850,height=1200",link,textu8;this._isLandscape(selections)&&(wopParm="location=1,status=1,scrollbars=1,width=1200,height=850");link=printUrl;me.mainPanel.find("#oskari_print_formID").attr("action",link);geoJson&&(textu8=unescape(encodeURIComponent(geoJson)),me.mainPanel.find("input[name=geojson]").val(jQuery.base64.encode(textu8)));tileData&&me.mainPanel.find("input[name=tiles]").val(tileData);window.open("about:blank","map_popup_111",wopParm);me.mainPanel.find("#oskari_print_formID").submit()},printMap:function(printParams){var me=this;me._printMap(printParams,null)},_printMap:function(selections){var me=this,sandbox=this.instance.getSandbox(),url=this.backendConfiguration.formatProducers[selections.format],maplinkArgs=selections.maplinkArgs,pageSizeArgs="&pageSize="+selections.pageSize,pageTitleArgs="&pageTitle="+selections.pageTitle,saveFileArgs="",contentOptions,p,stringifiedJson,stringifiedTileData;selections.saveFile&&(saveFileArgs="&saveFile="+selections.saveFile);contentOptions=[];for(p in this.contentOptionsMap)this.contentOptionsMap.hasOwnProperty(p)&&selections[p]&&contentOptions.push("&"+p+"=true");var contentOptionArgs=contentOptions.join(""),formatArgs="&format="+selections.format,municipalityCode="&municipalityCode="+me._getURLParameter("municipality"),parameters=maplinkArgs+"&action_route=GetPreview"+pageSizeArgs+pageTitleArgs+contentOptionArgs+formatArgs+saveFileArgs+municipalityCode;url=url+parameters;this.instance.geoJson||!jQuery.isEmptyObject(this.instance.tileData)?(stringifiedJson=this._stringifyGeoJson(this.instance.geoJson),stringifiedTileData=this._stringifyTileData(this.instance.tileData),this.instance.getSandbox().printDebug("PRINT POST URL "+url),this.openPostURLinWindow(stringifiedJson,stringifiedTileData,url,selections)):(this.instance.getSandbox().printDebug("PRINT URL "+url),this.openURLinWindow(url,selections))},_isLandscape:function(selections){var ret=!1;return this.sizeOptionsMap[selections.pageSize].id.indexOf("Land")>-1&&(ret=!0),ret},_stringifyGeoJson:function(geoJson){var ret=null;return geoJson&&(ret=JSON.stringify(geoJson).replace('"','"')),ret},_stringifyTileData:function(tileData){if(!jQuery.isEmptyObject(tileData)){var dataArr=[],returnArr;for(var key in tileData)tileData.hasOwnProperty(key)&&dataArr.push(tileData[key]);return returnArr=[].concat.apply([],dataArr),JSON.stringify(returnArr)}return null},_setLegendVisibility:function(){var container=this.mainPanel;this._hasStatsLayers()?container.find(".printout_legend_cont").show():container.find(".printout_legend_cont").hide()},_hasStatsLayers:function(){for(var layers=this.instance.getSandbox().findAllSelectedMapLayers(),i=0;i<layers.length;i++)if(layers[i].isLayerOfType("STATS")&&layers[i].isVisible())return!0;return!1},_createLegend:function(){var me=this,legend;if(me._setLegendVisibility(),me._hasStatsLayers()){var map=this.instance.sandbox.getMap(),container=this.mainPanel,parentContainer=jQuery("#contentMap"),legend_pos=container.find("input[name=location]:checked").val();if(legend_pos==="NO")me.instance.getSandbox().getMap().GeoJSON&&(me.instance.getSandbox().getMap().GeoJSON=null),me.instance.legendPlugin.clearLegendLayers();else if(legend=parentContainer.find("div.geostats-legend"),legend.length>0){if(me.legendInProcess)return;me.legendInProcess=!0;this._printMapInfo(legend,function(data){var title=legend.find(".geostats-legend-title").html(),ranges=[],legendgjs;legend.find("div").each(function(){var myclass=jQuery(this).attr("class"),legend_row;(myclass===undefined||myclass===null)&&(legend_row={boxcolor:jQuery(this).find(".geostats-legend-block").attr("style"),range:jQuery(this).text()},ranges.push(legend_row))});legendgjs=me.instance.legendPlugin.plotLegend(title,ranges,data,legend_pos);me.instance.geoJson=legendgjs;me.legendInProcess=!1})}}},_printMapInfo:function(legend,callback){var me=this,selections=me._gatherSelections(),sandbox=this.instance.getSandbox(),url=sandbox.getAjaxUrl(),urlBase=this.backendConfiguration.formatProducers[selections.format],maplinkArgs=selections.maplinkArgs,pageSizeArgs="&pageSize="+selections.pageSize,pageTitleArgs="&pageTitle="+selections.pageTitle,contentOptions=[];for(var p in this.contentOptionsMap)this.contentOptionsMap.hasOwnProperty(p)&&selections[p]&&contentOptions.push("&"+p+"=true");var contentOptionArgs=contentOptions.join(""),formatArgs="&format="+selections.format,parameters=maplinkArgs+"&action_route=GetProxyRequest&serviceId=print"+pageSizeArgs+pageTitleArgs+contentOptionArgs+formatArgs;url=url+parameters;me.instance.printService.fetchPrintMapData(url,function(data){data?callback(data):alert("Error to fetch print info: ")},function(){alert("Error to fetch print info: ")})},_getURLParameter:function(sParam){for(var sParameterName,sPageURL=window.location.search.substring(1),sURLVariables=sPageURL.split("&"),i=0;i<sURLVariables.length;i++)if(sParameterName=sURLVariables[i].split("="),sParameterName[0]==sParam)return sParameterName[1]},destroy:function(){this.mainPanel.remove()},hide:function(){this.mainPanel.hide()},show:function(){this.mainPanel.show()},setEnabled:function(e){this.isEnabled=e},getEnabled:function(){return this.isEnabled},refresh:function(isUpdate){isUpdate?this._updateMapPreview():this._cleanMapPreview();this._createLegend()},getState:function(){return this._gatherSelections()},setState:function(){}});Oskari.clazz.define("Oskari.mapframework.bundle.printout.request.PrintMapRequest",function(selections){this._creator=null;this._selections=selections},{__name:"printout.PrintMapRequest",getName:function(){return this.__name},getSelections:function(){return this._selections}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.printout.request.PrintMapRequestHandler",function(sandbox,handlerFunc){this.sandbox=sandbox;this.cb=handlerFunc},{handleRequest:function(core,request){var selections=request.getSelections();this.sandbox.printDebug("[Oskari.mapframework.bundle.printout.request.PrintMapRequestHandler] printout requested");this.cb(selections)}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.bundle.printout.event.PrintableContentEvent",function(contentId,layer,tileData,geojsonData){this._contentId=contentId;this._layer=layer;this._tileData=tileData;this._geojsonData=geojsonData},{getName:function(){return"Printout.PrintableContentEvent"},getContentId:function(){return this._contentId},getLayer:function(){return this._layer},setLayer:function(layer){this._layer=layer},getTileData:function(){return this._tileData},setTileData:function(data){this._tileData=data},getGeoJsonData:function(){return this._geojsonData},setGeoJsonData:function(data){this._geojsonData=data}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.clazz.define("Oskari.mapframework.bundle.printout.event.PrintWithoutUIEvent",function(contentId,printParams,geojsonData){this._contentId=contentId;this._printParams=printParams;this._geojsonData=geojsonData},{getName:function(){return"Printout.PrintWithoutUIEvent"},getContentId:function(){return this._contentId},getPrintParams:function(){return this._printParams},getGeoJsonData:function(){return this._geojsonData}},{protocol:["Oskari.mapframework.event.Event"]});Oskari.registerLocalization({lang:"am",key:"Printout",value:{title:"  ",flyouttitle:"  ",desc:"",btnTooltip:"NOT TRANSLATED",BasicView:{title:"  ",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"NOT TRANSLATED",options:{fi:"NOT TRANSLATED",sv:"NOT TRANSLATED",en:"NOT TRANSLATED"},tooltip:"NOT TRANSLATED"},size:{label:"",tooltip:"  /    ",options:[{id:"A4",label:"A4 ",classForPreview:" ",selected:" "},{id:"A4 ",label:"A4 ",classForPreview:" "},{id:"A3",label:"A3 ",classForPreview:" "},{id:"A3 ",label:"A3 ",classForPreview:" "}]},preview:{label:"",tooltip:"        ",pending:"   ",notes:{extent:"         ",restriction:"       "}},buttons:{save:"",ok:"OK",cancel:""},location:{label:"   ",tooltip:"      ",zoomlevel:" "},settings:{label:" ",tooltip:"  ,   ,   "},format:{label:"",tooltip:"  ",options:[{id:"png",format:"/png",label:"PNG "},{id:"pdf",format:"/pdf",selected:" ",label:"PDF "}]},mapTitle:{label:" ",tooltip:"   "},content:{options:[{id:" ",label:" OSKARI ",tooltip:"     ",checked:""},{id:" ",label:"  ",tooltip:"  ",checked:""},{id:" ",label:" ",tooltip:"    ",checked:""}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"",error:{title:"",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"  ",saveFailed:"   / ",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"        ",info:{maxLayers:"    8  ",printoutProcessingTime:"          "},buttons:{"continue":"",cancel:""}}}});Oskari.registerLocalization({lang:"bg",key:"Printout",value:{title:"   ",flyouttitle:"   ",desc:"",btnTooltip:"NOT TRANSLATED",BasicView:{title:"   ",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"NOT TRANSLATED",options:{fi:"NOT TRANSLATED",sv:"NOT TRANSLATED",en:"NOT TRANSLATED"},tooltip:"NOT TRANSLATED"},size:{label:"",tooltip:"    /      ",options:[{id:"4",label:"4 ",classForPreview:"   ",selected:""},{id:"4 ",label:"4 ",classForPreview:"   "},{id:"3",label:"3 ",classForPreview:"   "},{id:"3 ",label:"3 ",classForPreview:"   "}]},preview:{label:"",tooltip:"   ,     -  ",pending:"    ",notes:{extent:"           ",restriction:"       "}},buttons:{save:"",ok:"",cancel:" / "},location:{label:"  ",tooltip:"          ",zoomlevel:""},settings:{label:" ",tooltip:"  ,  ,   "},format:{label:"",tooltip:" ",options:[{id:"png",format:"NOT TRANSLATED",label:"NOT TRANSLATED"},{id:"NOT TRANSLATED",format:"NOT TRANSLATED",selected:"",label:"PDF "}]},mapTitle:{label:"  ",tooltip:"   "},content:{options:[{id:"  ",label:"   Oskari",tooltip:"   ,   ",checked:""},{id:"  ",label:"   ",tooltip:"   ",checked:""},{id:"  ",label:" ",tooltip:"     ",checked:""}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"",error:{title:"",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"    ",saveFailed:"    |   - ",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"     ,    ",info:{maxLayers:"    8  ",printoutProcessingTime:"     ,     "},buttons:{"continue":"",cancel:""}}}});Oskari.registerLocalization({lang:"cs",key:"Printout",value:{title:"Tisknout zobrazen mapy",flyouttitle:"Tisknout zobrazen mapy",desc:"",btnTooltip:"Tisk",BasicView:{title:"Tisknout zobrazen mapy",name:{label:"The name of the map",placeholder:"required",tooltip:"Give your map a descriptive name. Please note the language of the user interface."},language:{label:"Jazyk",options:{fi:"fintina",sv:"vdtina",en:"anglitina",de:"nmina",es:"panltina",cs:"etina"},tooltip:"Select the language of the map interface and map data."},size:{label:"Velikost",tooltip:"Vyberte rozloen tisku| Souasn je aktualizovn nhled mapy.",options:[{id:"A4",label:"A4 na vku",classForPreview:"preview-portrait",selected:!0},{id:"A4_Landscape",label:"A4 na ku",classForPreview:"preview-landscape"},{id:"A3",label:"A3 na vku",classForPreview:"preview-portrait"},{id:"A3_Landscape",label:"A3 na ku",classForPreview:"preview-landscape"}]},preview:{label:"Nhled",tooltip:"Kliknte na mal nhled pro zvten",pending:"Nhled bude rychle aktualizovn",notes:{extent:"Nhled lze pout pro vpoet rozsahu mapy vtisku",restriction:"V nhledu nejsou zobrazeny vechny mapov vrstvy"}},buttons:{save:"Zskat vtisk",ok:"OK",cancel:"Storno"},location:{label:"Umstn a rove piblen",tooltip:"Mtko vtisku odpovd mtku mapy v prohlei.",zoomlevel:"rove piblen"},settings:{label:"Vce nastaven",tooltip:"Provst dodaten nastaven jako formt, titul a mtko"},format:{label:"Format",tooltip:"Vyberte formt souboru",options:[{id:"png",format:"image/png",label:"Obrzek PNG"},{id:"pdf",format:"application/pdf",selected:!0,label:"Dokument PDF"}]},mapTitle:{label:"Vloit nzev",tooltip:"vloit nzev mapy"},content:{options:[{id:"pageLogo",label:"Pidat logo Paikkatietoikkuna",tooltip:"Je-li to nezbytn, lze logo skrt",checked:"checked"},{id:"pageScale",label:"Vloit do mapy mtko",tooltip:"Vloit do mapy mtko",checked:"checked"},{id:"pageDate",label:"Vloit datum",tooltip:"Do vtisku lze vloit datum",checked:"checked"}]},legend:{label:"Legend",tooltip:"Select legend position",options:[{id:"oskari_legend_NO",loca:"NO",label:"No legend ",tooltip:"No legend plot",selected:!0},{id:"oskari_legend_LL",loca:"LL",label:"Left lower corner ",tooltip:"Legend position in left lower corner of print area"},{id:"oskari_legend_LU",loca:"LU",label:"Left upper corner ",tooltip:"Legend position in left upper corner of print area"},{id:"oskari_legend_RU",loca:"RU",label:"Right upper corner ",tooltip:"Legend position in right upper corner of print area"},{id:"oskari_legend_RL",loca:"RL",label:"Right lower corner ",tooltip:"Legend position in right lower corner of print area"}]},help:"Npovda",error:{title:"Chyba",size:"Error in size definitions",name:"Name is required information",nohelp:"Npovda nen dostupn",saveFailed:"Tisk mapy selhal. Zkuste to pozdji.",nameIllegalCharacters:"The name contains disallowed characters. Allowed characters are the letters a-z as well as ,  and , numbers, backspaces and hyphens."}},StartView:{text:"Zobrazen mapy, kter jste prv vytvoili, lze vytisknout.",info:{maxLayers:"Najednou lze vytisknout maximln 8 vrstev.",printoutProcessingTime:"Pokud je vybrn soutisk vce vrstev, tisk trv dle."},buttons:{"continue":"Pokrauj",cancel:"Storno"}}}});Oskari.registerLocalization({lang:"da",key:"Printout",value:{title:"Udskriv kortvisning",flyouttitle:"Udskriv kortvisning",desc:"",btnTooltip:"NOT TRANSLATED",BasicView:{title:"Udskriv kortvisning",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"NOT TRANSLATED",options:{fi:"NOT TRANSLATED",sv:"NOT TRANSLATED",en:"NOT TRANSLATED"},tooltip:"NOT TRANSLATED"},size:{label:"Strrelse",tooltip:"Vlg udskriftslayout Forhndsvisning af kort opdateres i overensstemmelse hermed",options:[{id:"A4",label:"A4 portrt",classForPreview:"forhndsvisning af portrt",selected:"Filename"},{id:"A4_Landscape",label:"A4 landskab",classForPreview:"forhndsvisning af landskab"},{id:"A3",label:"A3 portrt",classForPreview:"forhndsvisning af portrt"},{id:"A3_Landscape",label:"A3 landskab",classForPreview:"forhndsvisning af landskab"}]},preview:{label:"Forhndsvisning",tooltip:"Klik p den lille forhndsvisning for at bne en strre forhndsvisning",pending:"Forhndsvisning opdateres inden lnge",notes:{extent:"Forhndsvisning kan bruges til at bedmme kortstrrelsen til udskrift",restriction:"Ikke alle kortlag vises i forhndsvisning"}},buttons:{save:"Foretag udskrift",ok:"OK",cancel:"Annullr"},location:{label:"Placering og zoomniveau",tooltip:"Udskriftsskalering svarer til skaleringen af kortet i browseren",zoomlevel:"Zoomniveau"},settings:{label:"Flere indstillinger",tooltip:"Foretag yderligere indstillinger ssom format, titel og skalering"},format:{label:"Format",tooltip:"Vlg filformat",options:[{id:"png",format:"image/png",label:"PNG image"},{id:"pdf",format:"application/pdf",selected:"Filename",label:"PDF document"}]},mapTitle:{label:"Tilfj titel",tooltip:"tilfj en titel til kortet"},content:{options:[{id:"sideLogo",label:"Tilfj Oskari logo",tooltip:"Det er muligt at skjule logoet om ndvendigt",checked:"afkrydset"},{id:"sideSkalering",label:"Tilfj skalering til kortet",tooltip:"Tilfj skalering til kortet",checked:"afkrydset"},{id:"sideDato",label:"Tilfj dato",tooltip:"Du kan tilfje dato p udskriften",checked:"afkrydset"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Hjlp",error:{title:"Fejl",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Ingen hjlp tilgngelig",saveFailed:"Kortudskrift mislykketPrv igen senere",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Du kan udskrive den kortvisning, du lige har lavet",info:{maxLayers:"Du kan maksimalt udskrive 8 lag p n gang",printoutProcessingTime:"Udskrivning tager lgere tid nr der er valgt flere lag"},buttons:{"continue":"Fortst",cancel:"Annullr"}}}});Oskari.registerLocalization({lang:"de",key:"Printout",value:{title:"Kartenansicht drucken",flyouttitle:"Kartenansicht drucken",desc:"",btnTooltip:"Drucken",BasicView:{title:"Kartenansicht drucken",name:{label:"The name of the map",placeholder:"required",tooltip:"Give your map a descriptive name. Please note the language of the user interface."},language:{label:"Sprache",options:{fi:"Finnisch",sv:"Schwedisch",en:"Englisch",de:"Deutsch",es:"Spanisch",cs:"Tschechisch"},tooltip:"Select the language of the map interface and map data."},size:{label:"Gre",tooltip:"Whlen Sie das Druck-Layout. Die Vorschau wird entsprechend aktualisiert.",options:[{id:"A4",label:"A4 Hochformat",classForPreview:"preview-portrait",selected:!0},{id:"A4_Landscape",label:"A4 Querformat",classForPreview:"preview-landscape"},{id:"A3",label:"A3 Hochformat",classForPreview:"preview-portrait"},{id:"A3_Landscape",label:"A3 Querformat",classForPreview:"preview-landscape"}]},preview:{label:"Vorschau",tooltip:"Klicken Sie auf die Vorschau, um eine vergrerte Ansicht zu erhalten.",pending:"Die Vorschau wird in Krze aktualisiert",notes:{extent:"Die Vorschau kann verwendet werden, um die Gre des Druckbereichs festzustellen.",restriction:"Es werden nicht alle Kartenebenen in der Vorschau angezeigt."}},buttons:{save:"Ausdruck erstellen",ok:"OK",cancel:"Abbrechen"},location:{label:"Ort und Zoomstufe",tooltip:"Der Mastab des Ausdrucks entspricht dem der Karte im Browser.",zoomlevel:"Zoomstufe"},settings:{label:"Weitere Einstellungen",tooltip:"Geben Sie weitere Einstellungen ein: Format, Titel und Mastab"},format:{label:"Format",tooltip:"Dateiformat auswhlen",options:[{id:"png",format:"image/png",label:"PNG-Bild"},{id:"pdf",format:"application/pdf",selected:!0,label:"PDF-Dokument"}]},mapTitle:{label:"Titel hinzufgen",tooltip:"Fgen Sie der Karte einen Titel hinzu"},content:{options:[{id:"pageLogo",label:"Paikkatietoikkuna-Logo hinzufgen",tooltip:"Sie knnen das Logo bei Bedarf verbergen",checked:"checked"},{id:"pageScale",label:"Mastab zur Karte hinzufgen",tooltip:"Mastab zur Karte hinzufgen",checked:"checked"},{id:"pageDate",label:"Datum hinzufgen",tooltip:"Sie knnen dem Ausdruck ein Datum hinzufgen",checked:"checked"}]},legend:{label:"Legend",tooltip:"Select legend position",options:[{id:"oskari_legend_NO",loca:"NO",label:"No legend ",tooltip:"No legend plot",selected:!0},{id:"oskari_legend_LL",loca:"LL",label:"Left lower corner ",tooltip:"Legend position in left lower corner of print area"},{id:"oskari_legend_LU",loca:"LU",label:"Left upper corner ",tooltip:"Legend position in left upper corner of print area"},{id:"oskari_legend_RU",loca:"RU",label:"Right upper corner ",tooltip:"Legend position in right upper corner of print area"},{id:"oskari_legend_RL",loca:"RL",label:"Right lower corner ",tooltip:"Legend position in right lower corner of print area"}]},help:"Hilfe",error:{title:"Fehler",size:"Error in size definitions",name:"Name is required information",nohelp:"Keine Hilfe verfgbar",saveFailed:"Ausdrucken der Karte fehlgeschlagen. Bitte versuchen Sie es spter noch mal.",nameIllegalCharacters:"The name contains disallowed characters. Allowed characters are the letters a-z as well as ,  and , numbers, backspaces and hyphens."}},StartView:{text:"Sie knnen die gerade von Ihnen erzeugte Kartenansicht ausdrucken.",info:{maxLayers:"Sie knnen maximal 8 Kartenebenen gleichzeitg drucken.",printoutProcessingTime:"Das Ausdrucken nimmt etwas mehr Zeit in Anspruch, wenn mehrere Kartenebenen ausgewhlt sind."},buttons:{"continue":"Weiter",cancel:"Abbrechen"}}}});Oskari.registerLocalization({lang:"en",key:"Printout",value:{title:"Print Map view",flyouttitle:"Print Map view",desc:"",btnTooltip:"Print",BasicView:{title:"Print Map view",name:{label:"The name of the map",placeholder:"required",tooltip:"Give your map a descriptive name. Please note the language of the user interface."},language:{label:"Language",options:{fi:"Finnish",sv:"Swedish",en:"English"},tooltip:"Select the language of the map interface and map data."},size:{label:"Size",tooltip:"Choose print layout. Preview map is updated accordingly.",options:[{id:"A4",label:"A4 portrait",classForPreview:"preview-portrait",selected:!0},{id:"A4_Landscape",label:"A4 landscape",classForPreview:"preview-landscape"},{id:"A3",label:"A3 portrait",classForPreview:"preview-portrait"},{id:"A3_Landscape",label:"A3 landscape",classForPreview:"preview-landscape"}]},preview:{label:"Preview",tooltip:"Click the small preview to open a larger preview",pending:"Preview will be updated shortly",notes:{extent:"Preview can be used to figure out the map extent for printout",restriction:"Not all map layers are shown in the preview"}},buttons:{save:"Get Printout",ok:"OK",cancel:"Cancel"},location:{label:"Location and zoom level",tooltip:"Printout scale matches the scale of the map in browser.",zoomlevel:"Zoom level"},settings:{label:"More settings",tooltip:"Make additional settings like format, title, and scale"},format:{label:"Format",tooltip:"Select file format",options:[{id:"png",format:"image/png",label:"PNG image"},{id:"pdf",format:"application/pdf",selected:!0,label:"PDF document"}]},mapTitle:{label:"Add title",tooltip:"add a title for the map"},content:{options:[{id:"pageLogo",label:"Add the logo of Paikkatietoikkuna",tooltip:"You can hide the logo if necessary",checked:"checked"},{id:"pageScale",label:"Add scale to the map",tooltip:"Add scale to the map",checked:"checked"},{id:"pageDate",label:"Add date",tooltip:"You can add date to the printout",checked:"checked"}]},legend:{label:"Legend",tooltip:"Select legend position",options:[{id:"oskari_legend_NO",loca:"NO",label:"No legend ",tooltip:"No legend plot",selected:!0},{id:"oskari_legend_LL",loca:"LL",label:"Left lower corner ",tooltip:"Legend position in left lower corner of print area"},{id:"oskari_legend_LU",loca:"LU",label:"Left upper corner ",tooltip:"Legend position in left upper corner of print area"},{id:"oskari_legend_RU",loca:"RU",label:"Right upper corner ",tooltip:"Legend position in right upper corner of print area"},{id:"oskari_legend_RL",loca:"RL",label:"Right lower corner ",tooltip:"Legend position in right lower corner of print area"}]},help:"Help",error:{title:"Error",size:"Error in size definitions",name:"Name is required information",nohelp:"No help is available",saveFailed:"Map printout failed. Try again later.",nameIllegalCharacters:"The name contains disallowed characters. Allowed characters are the letters a-z as well as ,  and , numbers, backspaces and hyphens."}},StartView:{text:"You can print the Map view you just created.",info:{maxLayers:"Max layer count for printout is 8",printoutProcessingTime:"Printout processing takes some time when multiple layers are selected."},buttons:{"continue":"Continue",cancel:"Cancel"}}}});Oskari.registerLocalization({lang:"es",key:"Printout",value:{title:"Imprimir vista",flyouttitle:"Imprimir vista",desc:"",btnTooltip:"Imprimir",BasicView:{title:"Imprimir vista",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"NOT TRANSLATED",options:{fi:"NOT TRANSLATED",sv:"NOT TRANSLATED",en:"NOT TRANSLATED"},tooltip:"NOT TRANSLATED"},size:{label:"Tamao",tooltip:"Seleccione el modelo de impresin| La previsualizacin del mapa est actualizada correctamente",options:[{id:"A4",label:"A4 vertical",classForPreview:"Previsualizacin vertical",selected:"verdadero"},{id:"A4_Landscape",label:"A4 apaisado",classForPreview:"Previsualizacin apaisada"},{id:"A3",label:"A3 vertical",classForPreview:"Previsualizacin vertical"},{id:"A3_Landscape",label:"A3 apaisado",classForPreview:"Previsualizacin apaisada"}]},preview:{label:"Previsualizacin",tooltip:"Pulse la previsualizacin pequea para abrir una agrandada",pending:"La previsualizacin se actualizar en breve",notes:{extent:"La previsualizacin puede usarse para calcular la extensin del mapa para la impresin",restriction:"No se muestran todas las capas en la previsualizacin"}},buttons:{save:"Imprimir",ok:"Hecho",cancel:"Cancelar"},location:{label:"Localizacin y nivel de zoom",tooltip:"La escala de impresin coincide con la escala del mapa en el navegador",zoomlevel:"Nivel de zoom"},settings:{label:"Ms configuraciones",tooltip:"Realizar configuraciones adicionales como el formato, el ttulo y la escala"},format:{label:"Formato",tooltip:"Seleccionar el formato del fichero",options:[{id:"png",format:"image/png",label:"Imagen PNG"},{id:"pdf",format:"application/pdf",selected:"verdadero",label:"documento PDF"}]},mapTitle:{label:"Aadir ttulo",tooltip:"aadir un ttulo para el mapa"},content:{options:[{id:"pageLogo",label:"Aadir el logo de Oskari",tooltip:"Si es necesario, puede ocultar el logo",checked:"comprobado"},{id:"pageScale",label:"Aadir la escala al mapa",tooltip:"Aadir la escala al mapa",checked:"comprobado"},{id:"pageDate",label:"Aadir fecha",tooltip:"Puede aadir la fecha a la impresin",checked:"comprobado"}]},legend:{label:"Legend",tooltip:"Select legend position",options:[{id:"oskari_legend_NO",loca:"NO",label:"No legend ",tooltip:"No legend plot",selected:!0},{id:"oskari_legend_LL",loca:"LL",label:"Left lower corner ",tooltip:"Legend position in left lower corner of print area"},{id:"oskari_legend_LU",loca:"LU",label:"Left upper corner ",tooltip:"Legend position in left upper corner of print area"},{id:"oskari_legend_RU",loca:"RU",label:"Right upper corner ",tooltip:"Legend position in right upper corner of print area"},{id:"oskari_legend_RL",loca:"RL",label:"Right lower corner ",tooltip:"Legend position in right lower corner of print area"}]},help:"Ayuda",error:{title:"Error",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"No hay ayuda disponible",saveFailed:"La impresin del mapa ha fallado | Intntelo ms tarde",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Puede imprimir la vista que has creado",info:{maxLayers:"Puede imprimir un mximo de ocho capas de una vez",printoutProcessingTime:"El proceso de impresin tarda cuando se seleccionan varias capas"},buttons:{"continue":"Continuar",cancel:"Cancelar"}}}});Oskari.registerLocalization({lang:"et",key:"Printout",value:{title:"Prindi kaardivaade",flyouttitle:"Prindi kaardivaade",desc:"",btnTooltip:"Prindi",BasicView:{title:"Prindi kaardivaade",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"Keel",options:{fi:"Soome",sv:"Rootsi",en:"Inglise"},tooltip:"Vali kaardiliidese ja kaardiandmete keel."},size:{label:"Suurus",tooltip:"Vali trkimall. Vastavalt uuendatakse kaardi eelvaadet.",options:[{id:"A4",label:"A4 pstformaat",classForPreview:"preview-portrait",selected:!0},{id:"A4_Landscape",label:"A4 pikformaat",classForPreview:"preview-landscape"},{id:"A3",label:"A3 pstformaat",classForPreview:"preview-portrait"},{id:"A3_Landscape",label:"A3 pikformaat",classForPreview:"preview-landscape"}]},preview:{label:"Eelvaade",tooltip:"Suurema eelvaate avamiseks kliki viksel eelvaatel",pending:"Eelvaade uuendatakse kohe",notes:{extent:"Kaardi ulatust vljastuseks saab hinnata eelvaadel",restriction:"Eelvaade ei nita kiki kaardikihte"}},buttons:{save:"Tee vljatrkk",ok:"OK",cancel:"Thista"},location:{label:"Asukoht ja suumi tase ",tooltip:"Vljatrki mtkava vastab kaardi mtkavale lehitsejas.",zoomlevel:"Suumi tase"},settings:{label:"Veel seadeid",tooltip:"Mra lisaseaded nagu formaat, pealkiri ja mtkava"},format:{label:"Formaat",tooltip:"Vali failiformaat ",options:[{id:"png",format:"image/png",label:"PNG kujutis"},{id:"pdf",format:"application/pdf",selected:!0,label:"PDF dokument"}]},mapTitle:{label:"Lisa pealkiri",tooltip:"lisa kaardi pealkiri"},content:{options:[{id:"pageLogo",label:"Lisa Oskari logo",tooltip:"Vajadusel saab logo peita",checked:"checked"},{id:"pageScale",label:"Lisa kaardile mtkava",tooltip:"Lisa kaardile mtkava",checked:"checked"},{id:"pageDate",label:"Lisa kuupev",tooltip:"Vid lisada vljatrkile kuupeva",checked:"checked"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"oskari_legend_NO",loca:"NO",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"oskari_legend_LL",loca:"LL",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_LU",loca:"LU",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_RU",loca:"RU",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_RL",loca:"RL",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Abi",error:{title:"Viga",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Abi pole saadaval",saveFailed:"Kaardi vljatrkk ebannestus. Proovi hiljem uuesti.",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Vid just loodud kaardivaate printida.",info:{maxLayers:"Vid korraga printida kuni 8 kihti",printoutProcessingTime:"Vljatrki tegemine vtab aega kui on valitud mitu kihti."},buttons:{"continue":"Jtka",cancel:"Thista"}}}});Oskari.registerLocalization({lang:"fi",key:"Printout",value:{title:"Tulosta nkym",flyouttitle:"Siirry tulostamaan",desc:"",btnTooltip:"Tulosta",BasicView:{title:"Tulosta nkym",name:{label:"Kartan nimi",placeholder:"pakollinen",tooltip:"Anna nkymlle kuvaileva nimi. Huomioi kyttliittymn kieli."},language:{label:"Kieli",options:{fi:"Suomi",sv:"Ruotsi",en:"Englanti"},tooltip:"Valitse kartan kyttliittymn ja aineiston kieli."},size:{label:"Koko",tooltip:"Valitse arkkikoko. Net vaikutuksen esikatselukartassa.",options:[{id:"A4",label:"A4-tuloste",classForPreview:"preview-portrait",selected:!0},{id:"A4_Landscape",label:"A4-vaakatuloste",classForPreview:"preview-landscape"},{id:"A3",label:"A3-tuloste",classForPreview:"preview-portrait"},{id:"A3_Landscape",label:"A3-vaakatuloste",classForPreview:"preview-landscape"}]},preview:{label:"Esikatselu",tooltip:"Suuremman esikatselukuvan saat kuvaa napauttamalla.",pending:"Esikatselukuva pivitetn hetken kuluttua",notes:{extent:"Esikatselun avulla voit hahmottaa tulosteen kattavuuden",restriction:"Esikatselussa ei nytet kaikkia karttatasoja"}},buttons:{save:"Hae tuloste",ok:"OK",cancel:"Peruuta"},location:{label:"Sijainti ja mittakaavataso",tooltip:"Mittakaavataso vastaa toistaiseksi selaimen nkymn mittakaavaa.",zoomlevel:"Mittakaavataso"},settings:{label:"Lisasetukset",tooltip:"Valitse tulosteen formaatti, otsikko, mittakaava, pivmr "},format:{label:"Tiedostomuoto",tooltip:"Valitse tulosteen tiedostomuoto",options:[{id:"png",format:"image/png",label:"PNG kuva"},{id:"pdf",format:"application/pdf",label:"PDF dokumentti",selected:!0}]},mapTitle:{label:"Kartan otsikko",tooltip:"Nime kartta"},content:{options:[{id:"pageScale",label:"Nyt mittakaava",tooltip:"Voit halutessasi list karttaan mittakaavan",checked:"checked"},{id:"pageDate",label:"Nyt pivmr",tooltip:"Voit halutessasi list tulosteeseen pivmrn",checked:"checked"}]},legend:{label:"Legenda",tooltip:"Valitse legendan paikka - ei piirret, jos paikkaa ei ole valittuna",options:[{id:"oskari_legend_NO",loca:"NO",label:"Ei legendaa ",tooltip:"Ei piirret legendaa",selected:!0},{id:"oskari_legend_LL",loca:"LL",label:"Vasen alanurkka ",tooltip:"Sovitus vasempaan alanurkkaan"},{id:"oskari_legend_LU",loca:"LU",label:"Vasen ylnurkka ",tooltip:"Sovitus vasempaan ylnurkkaan"},{id:"oskari_legend_RU",loca:"RU",label:"Oikea ylnurkka ",tooltip:"Sovitus oikeaan ylnurkkaan"},{id:"oskari_legend_RL",loca:"RL",label:"Oikea alanurkka ",tooltip:"Sovitus oikeaan alanurkkaan"}]},help:"Ohje",error:{title:"Virhe",size:"Virhe kokomrityksiss",name:"Nimi on pakollinen tieto",nohelp:"Ohjetta ei lytynyt",saveFailed:"Nkymn tulostus eponnistui. Yrit myhemmin uudelleen.",nameIllegalCharacters:"Nimess on luvattomia merkkej. Sallittuja merkkej ovat kaikki suomen kielen aakkoset, numerot sek vlilynti ja yhdysmerkki."}},StartView:{text:"Voit tulostaa tekemsi karttankymn PNG kuvaksi tai PDF-tulosteeksi.",info:{maxLayers:"Tulostettavien karttatasojen lukumr on rajattu 8:aan.",printoutProcessingTime:"Kartan tulostus voi kest hetken, jos useita karttatasoja on valittuna."},buttons:{"continue":"Jatka",cancel:"Peruuta"}}}});Oskari.registerLocalization({lang:"gr",key:"Printout",value:{title:"Print Map view",flyouttitle:" ",desc:"",btnTooltip:"",BasicView:{title:" ",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"",options:{fi:"",sv:"",en:""},tooltip:"    interface     "},size:{label:"",tooltip:"   (print layout).     .",options:[{id:"A4",label:"4 ",classForPreview:"preview-portrait",selected:!0},{id:"A4_Landscape",label:"A4 landscape",classForPreview:"preview-landscape"},{id:"A3",label:"A3 ",classForPreview:"preview-portrait"},{id:"A3_Landscape",label:"A3 landscape",classForPreview:"preview-landscape"}]},preview:{label:"",tooltip:"         ",pending:"     ",notes:{extent:"             ",restriction:"       "}},buttons:{save:" ",ok:"OK",cancel:""},location:{label:"   ",tooltip:"          browser.",zoomlevel:" "},settings:{label:" ",tooltip:"    format,   "},format:{label:"Format",tooltip:"  format  ",options:[{id:"png",format:"image/png",label:"PNG image"},{id:"pdf",format:"application/pdf",selected:!0,label:" PDF"}]},mapTitle:{label:" ",tooltip:"   "},content:{options:[{id:"pageLogo",label:"    OSKARI",tooltip:"      ",checked:"checked"},{id:"pageScale",label:"   ",tooltip:"   ",checked:"checked"},{id:"pageDate",label:" ",tooltip:"     ",checked:"checked"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"oskari_legend_NO",loca:"NO",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"oskari_legend_LL",loca:"LL",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_LU",loca:"LU",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_RU",loca:"RU",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_RL",loca:"RL",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"",error:{title:"",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"  ",saveFailed:"    .   .",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"       .",info:{maxLayers:"     8    ",printoutProcessingTime:"          ."},buttons:{"continue":"",cancel:""}}}});Oskari.registerLocalization({lang:"hr",key:"Printout",value:{title:"Ispis prikaza karte",flyouttitle:"Ispis prikaza karte",desc:"",btnTooltip:"Ispis",BasicView:{title:"Ispis prikaza karte",name:{label:"Naziv karte",placeholder:"NOT TRANSLATED",tooltip:"Dajte karti opisni naziv. Jezik korisnikog suelja"},language:{label:"Jezik",options:{fi:"Finski",sv:"vedski",en:"Engleski"},tooltip:"Odaberi jezik suelja karte i podataka o karti"},size:{label:"Veliina",tooltip:"Odabir izgleda ispisa Prethodni pregled se aurira.",options:[{id:"A4",label:"A4 portret",classForPreview:"preview-portrait",selected:!0},{id:"A4_Landscape",label:"A4 pejza",classForPreview:"preview-landscape"},{id:"A3",label:"A3 portret",classForPreview:"preview-portrait"},{id:"A3_Landscape",label:"A3 pejza",classForPreview:"preview-landscape"}]},preview:{label:"Pregled",tooltip:"Klikni na mali pregled za otvaranje velikog pregleda",pending:"Pregled e se uskoro aurirati.",notes:{extent:"Pregled moe posluiti za ocjenu veliine karte koja se ispisuje",restriction:"Svi slojevi karte se ne prikazuju u pregledniku."}},buttons:{save:"Ispii",ok:"OK",cancel:"Poniti"},location:{label:"Lokacija i stupanj zumiranja",tooltip:"Razmjer ispisa odgovara razmjeru karte u pregledniku.",zoomlevel:"Stupanj zumiranja"},settings:{label:"Daljnje postavke",tooltip:"Dodatne postavke poput formata, naziva i razmjera"},format:{label:"Format",tooltip:"Odabir formata datoteke",options:[{id:"png",format:"image/png",label:"PNG slika"},{id:"pdf",format:"application/pdf",selected:!0,label:"PDF dokument"}]},mapTitle:{label:"Dodaj naziv",tooltip:"dodaj naziv karte"},content:{options:[{id:"pageLogo",label:"Dodaj logo Oskari",tooltip:"Ako je potrebno, logo se moe sakriti",checked:"checked"},{id:"pageScale",label:"Dodaj mjerilo na kartu",tooltip:"Dodaj mjerilo na kartu",checked:"checked"},{id:"pageDate",label:"Dodaj datum",tooltip:"Moete dodati datum ispisu",checked:"checked"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"oskari_legend_NO",loca:"NO",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"oskari_legend_LL",loca:"LL",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_LU",loca:"LU",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_RU",loca:"RU",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_RL",loca:"RL",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Pomo",error:{title:"Greka",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Nema dostupne pomoi",saveFailed:"Greka u ispisu karte Pokuajte ponovno kasnije",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Moete ispisati kartu koju ste upravo izradili.",info:{maxLayers:"Odjednom moete ispisati najvie 8 slojeva",printoutProcessingTime:"Kod odabira nekoliko slojeva obrada ispisa traje dulje."},buttons:{"continue":"Nastavi",cancel:"Poniti"}}}});Oskari.registerLocalization({lang:"hu",key:"Printout",value:{title:"Nyomtatsi trkpnzet",flyouttitle:"Nyomtatsi trkpnzet",desc:"",btnTooltip:"NOT TRANSLATED",BasicView:{title:"Nyomtatsi trkpnzet",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"NOT TRANSLATED",options:{fi:"NOT TRANSLATED",sv:"NOT TRANSLATED",en:"NOT TRANSLATED"},tooltip:"NOT TRANSLATED"},size:{label:"Mret",tooltip:"Nyomtatsi elrendezs kivlasztsa. Az elnzet ennek megfelelen frissl.",options:[{id:"A4",label:"A4 ll",classForPreview:"Elnzet-ll",selected:"Filename"},{id:"A4_Fekv",label:"A4 fekv",classForPreview:"elnzet-fekv"},{id:"A3",label:"A3 ll",classForPreview:"Elnzet-ll"},{id:"A3_Fekv",label:"A3 fekv",classForPreview:"elnzet-fekv"}]},preview:{label:"Elnzet",tooltip:"Kattintson a kis elnzetre egy nagyobb mret elnzethez.",pending:"Az elnzet hamarosan frisslni fog.",notes:{extent:"Az elnzetet a nyomtatsi mretnek belltshoz hasznlhatjuk.",restriction:"Nem minden trkprteg jelenik meg az elnzetben."}},buttons:{save:"Nyomtatsi kp mentse",ok:"OK",cancel:"Mgse"},location:{label:"Helyzet s nagytsi szint",tooltip:"A nyomtatsi mretarny megegyezik a bngszben belltott mretarnnyal.",zoomlevel:"Nagytsi szint"},settings:{label:"Tovbbi belltsok",tooltip:"Alkalmazzon tovbbi belltsokat, gymint formtum, cm s mretarny."},format:{label:"Formtum",tooltip:"Vlassza ki a fjlformtumot.",options:[{id:"png",format:"image/png",label:"PNG kp"},{id:"pdf",format:"application/pdf",selected:"Filename",label:"PDF dokumentum"}]},mapTitle:{label:"Cm hozzadsa",tooltip:"adjon cmet a trkpnek"},content:{options:[{id:"pageLogo",label:"Oskari logo hozzadsa",tooltip:"A logt elrejtheti, ha szksges.",checked:"ellenrztt"},{id:"pageScale",label:"Mretarny megadsa.",tooltip:"Adja meg a trkp mretarnyt.",checked:"ellenrztt"},{id:"pageDate",label:"Dtum megadsa",tooltip:"Megadhat dtumot is a nyomtatshoz.",checked:"ellenrztt"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Segtsg",error:{title:"Hiba",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Segtsg nem ll rendelkezsre.",saveFailed:"Trkpnyomtatsi hiba. Problja meg ksbb.",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"A most elksztett trkpnzetet kinyomtathatja.",info:{maxLayers:"Maximum 8 rteget nyomtathat egyszerre.",printoutProcessingTime:"A nyomtats feldolgozsa nmi idt vesz ignybe, amikor tbb rteget jellnk ki."},buttons:{"continue":"Folytats",cancel:"Mgsem"}}}});Oskari.registerLocalization({lang:"lv",key:"Printout",value:{title:"Drukt kartes skatu",flyouttitle:"Drukt kartes skatu",desc:"",btnTooltip:"NOT TRANSLATED",BasicView:{title:"Drukt kartes skatu",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"NOT TRANSLATED",options:{fi:"NOT TRANSLATED",sv:"NOT TRANSLATED",en:"NOT TRANSLATED"},tooltip:"NOT TRANSLATED"},size:{label:"Izmrs",tooltip:"Izvlties drukas izkrtojumu| Priekskatjuma karte tiek atbilstoi atjaunota",options:[{id:"A4",label:"A4 portrets",classForPreview:"Portretorientcija",selected:"patiess"},{id:"A4_Landscape",label:"A4 ainava",classForPreview:"Ainavorientcija"},{id:"A3",label:"A3 portrets",classForPreview:"Portretorientcija"},{id:"A3_Landscape",label:"A3 ainava",classForPreview:"Ainavorientcija"}]},preview:{label:"Priekskatjums",tooltip:"Klikiniet uz maz priekskatjuma, lai to atvrtu lielku",pending:"Priekskatjums drzum tiks atjaunints",notes:{extent:"Priekskatjums var tikt izmantots, lai noskaidrotu kartes izmrus izdrukai",restriction:"Priekskatjum nav attloti visi kartes sli"}},buttons:{save:"Saemt izdruku",ok:"Labi",cancel:"Atcelt"},location:{label:"Novietojums un tlummaias lmenis",tooltip:"Izdrukas mrogs atbilst kartes mrogam prlk",zoomlevel:"Tlummaias lmenis"},settings:{label:"Vairk iestatjumu",tooltip:"Izveidot tdus papildus iestatjumus, k formts, nosaukums un mrogs"},format:{label:"Formts",tooltip:"Izvlties datnes formtu",options:[{id:"png",format:"attls/png",label:"PNG attls"},{id:"pdf",format:"lietotne/pdf",selected:"patiess",label:"PDF dokuments"}]},mapTitle:{label:"Pievienot nosaukumu",tooltip:"pievienot nosaukumu kartei"},content:{options:[{id:"lapasLogotips",label:'Pievienot "Oskari" logotipu',tooltip:"Js varat paslpt logotipu, ja nepiecieams",checked:"prbaudts"},{id:"lapasMrogs",label:"Pievienot mrogu kartei",tooltip:"Pievienot mrogu kartei",checked:"prbaudts"},{id:"lapasDatums",label:"Pievienot datumu",tooltip:"Js varat pievienot datumu izdrukai",checked:"prbaudts"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Paldzba",error:{title:"Kda",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Paldzba nav pieejama",saveFailed:"Karti izdrukt neizdevs| Miniet vlreiz vlk",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Js varat izdrukt kartes skatu, ko tikko izveidojt",info:{maxLayers:"Vien reiz Js varat izdrukt ne vairk k 8 slus",printoutProcessingTime:"Izdrukas apstrde aizem ilgku laiku, kad izvlti vairki sli"},buttons:{"continue":"Turpint",cancel:"Atcelt"}}}});Oskari.registerLocalization({lang:"nl",key:"Printout",value:{title:"Print kaartbeeld",flyouttitle:"Print kaartbeeld",desc:"",btnTooltip:"Print",BasicView:{title:"Print kaartbeeld",name:{label:"Kaartnaam",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"Taal",options:{fi:"Fins",sv:"Zweeds",en:"Engels"},tooltip:"Kies de taal van de kaartinterface en kaartgegevens."},size:{label:"Grootte",tooltip:"Kies afdrukindeling| Voorbeeldkaart wordt dienovereenkomstig aangepast.",options:[{id:"A4",label:"A4 staand",classForPreview:"preview-portrait",selected:!0},{id:"A4_Landscape",label:"A4 liggend",classForPreview:"preview-landscape"},{id:"A3",label:"A3 staand",classForPreview:"preview-portrait"},{id:"A3_Landscape",label:"A3 liggend",classForPreview:"preview-landscape"}]},preview:{label:"Voorbeeld",tooltip:"Klik op het kleine voorbeeld om een groter voorbeeld te openen",pending:"Voorbeeld zal binnenkort worden bijgewerkt",notes:{extent:"Voorbeeld kan worden gebruikt om er achter te komen wat de kaartomvang is voor de afdruk",restriction:"Niet alle kaartlagen worden getoond in het voorbeeld"}},buttons:{save:"Krijg afdruk",ok:"OK",cancel:"Annuleren"},location:{label:"Locatie en het zoomniveau",tooltip:"Afdruk schaal komt overeen met de schaal van de kaart in de browser.",zoomlevel:"Zoomniveau"},settings:{label:"Meer instellingen",tooltip:"Maak extra instellingen, zoals formaat, titel en de schaal"},format:{label:"Formaat",tooltip:"Selecteer bestandsformaat",options:[{id:"png",format:"image/png",label:"PNG afbeelding"},{id:"pdf",format:"application/pdf",selected:!0,label:"PDF document"}]},mapTitle:{label:"Voeg titel toe",tooltip:"Voeg een titel toe aan de kaart"},content:{options:[{id:"pageLogo",label:"Voeg het Oskari logo toe",tooltip:"U kunt het logo indien nodig verbergen",checked:"checked"},{id:"pageScale",label:"Voeg schaal toe aan de kaart",tooltip:"Voeg schaal toe aan de kaart",checked:"checked"},{id:"pageDate",label:"Voeg datum toe",tooltip:"U kunt de datum toevoegen aan de afdruk",checked:"checked"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"oskari_legend_NO",loca:"NO",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"oskari_legend_LL",loca:"LL",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_LU",loca:"LU",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_RU",loca:"RU",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_RL",loca:"RL",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Help",error:{title:"Fout",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Er is geen hulp beschikbaar",saveFailed:"Kaart uitpinten mislukt. Probeer het later opnieuw.",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"U kunt de kaartweergave die u zojuist gemaakt heeft gemaakt printen.",info:{maxLayers:"U kunt maximaal 8 lagen in n keer uitprinten",printoutProcessingTime:"Verwerking van de afdruk zal enige tijd duren wanneer meerdere lagen geselecteerd zijn."},buttons:{"continue":"Doorgaan",cancel:"Annuleren"}}}});Oskari.registerLocalization({lang:"pl",key:"Printout",value:{title:"Widok wydruku mapy",flyouttitle:"Widok wydruku mapy",desc:"",btnTooltip:"Drukuj",BasicView:{title:"Widok wydruku mapy",name:{label:"Nazwa mapy",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"Jzyk",options:{fi:"Fiski",sv:"Szwedzki",en:"Angielski"},tooltip:"Wybierz jzyk interfejsu i danych mapy."},size:{label:"Rozmiar",tooltip:"Wybierz ukad drukowania Podgld mapy jest odpowiednio zaktualizowany.",options:[{id:"A4",label:"A4 portret",classForPreview:"preview-portrait",selected:!0},{id:"A4_Landscape",label:"A4 landscape",classForPreview:"preview-landscape"},{id:"A3",label:"A3 portret",classForPreview:"preview-portrait"},{id:"A3_Landscape",label:"A3 landscape",classForPreview:"preview-landscape"}]},preview:{label:"Podgld",tooltip:"Kliknij may podgld aby otworzy duy podgld",pending:"Podgld bdzie aktualizowany wkrtce",notes:{extent:"Z podgldu mona wywnioskowa zakres mapy do wydruku",restriction:"Nie wszystkie warstwy mapy s widoczne w podgldzie"}},buttons:{save:"Wydruk",ok:"OK",cancel:"Anuluj"},location:{label:"Lokalizacja i powikszenie",tooltip:"Wydruk skali odpowiada skali mapy w przegldarce.",zoomlevel:"Poziom powikszenia"},settings:{label:"Wicej ustawie",tooltip:"Stwrz dodatkowe ustawienia jak format, tytu i skala"},format:{label:"Format",tooltip:"wybierz format pliku",options:[{id:"png",format:"image/png",label:"obraz PNG"},{id:"pdf",format:"application/pdf",selected:!0,label:"dokument PDF"}]},mapTitle:{label:"dodaj tytu",tooltip:"dodaj tytu mapy"},content:{options:[{id:"pageLogo",label:"Dodaj logo Oskari",tooltip:"Moesz ukry logo w razie potrzeby",checked:"checked"},{id:"pageScale",label:"Dodaj skal mapy",tooltip:"Dodaj skal mapy",checked:"checked"},{id:"pageDate",label:"Dodaj dat",tooltip:"Moesz doda dat do wydruku",checked:"checked"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"oskari_legend_NO",loca:"NO",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"oskari_legend_LL",loca:"LL",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_LU",loca:"LU",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_RU",loca:"RU",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"oskari_legend_RL",loca:"RL",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Pomoc",error:{title:"Bd",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Brak dostpnej pomocy",saveFailed:"Wydruk mapy nie powid si. Sprbuj ponownie pniej.",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Moesz wydrukowa widok Mapy, ktry wanie utworzye.",info:{maxLayers:"Moesz wydrukowa maksymalnie 8 warstw jednoczenie",printoutProcessingTime:"Wydruk moe troch potrwa gdy wybranych jest kilka warstw."},buttons:{"continue":"Kontynuuj",cancel:"Anuluj"}}}});Oskari.registerLocalization({lang:"pt",key:"Printout",value:{title:"Imprimir vista",flyouttitle:"Imprimir Vista",desc:"",btnTooltip:"NOT TRANSLATED",BasicView:{title:"Imprimir vista",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"NOT TRANSLATED",options:{fi:"NOT TRANSLATED",sv:"NOT TRANSLATED",en:"NOT TRANSLATED"},tooltip:"NOT TRANSLATED"},size:{label:"Dimenso",tooltip:"Escolher aspeto da impresso| Pr-visualizao  atualizada em consonncia",options:[{id:"A4",label:"A4 retrato",classForPreview:"Pr-visualizao retrato",selected:"verdadeiro"},{id:"A4_Landscape",label:"A4 paisagem",classForPreview:"pr-visualizao paisagem"},{id:"A3",label:"A3 retrato",classForPreview:"Pr-visualizao retrato"},{id:"A3_Landscape",label:"A3 paisagem",classForPreview:"pr-visualizao paisagem"}]},preview:{label:"Pr-visualizao",tooltip:"Clique na pr-visualizao menor para abrir uma maior",pending:"Pr-visualizao vai ser atualizada em breve",notes:{extent:"Pr-visualizao pode ser usada para ter noo do contedo da carta na impresso",restriction:"Nem todas as camadas aparecem na pr-visualizao"}},buttons:{save:"Obter impresso",ok:"OK",cancel:"Cancelar"},location:{label:"Localizao e nvel de ampliao",tooltip:"Escala de impresso coincide com escala da carta no navegador web",zoomlevel:"Nvel de ampliao"},settings:{label:"Mais definies",tooltip:"Atribuir definies adicionais como formato, ttulo e escala"},format:{label:"Formato",tooltip:"Selecionar formato do ficheiro",options:[{id:"png",format:"imagem/png",label:"Imagem PNG"},{id:"pdf",format:"aplicao/pdf",selected:"verdadeiro",label:"Documento pdf"}]},mapTitle:{label:"Adicionar ttulo",tooltip:"Adicionar ttulo  carta"},content:{options:[{id:"Logtipo",label:"Adicionar o logtipo Oskari",tooltip:"Pode esconder o logtipo se necessrio",checked:"verificado"},{id:"Escala da pgina",label:"Adicionar escala  carta",tooltip:"Adicionar escala  carta",checked:"verificado"},{id:"data da pgina",label:"Adicionar data",tooltip:"Pode adicionar data  impresso",checked:"verificado"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Ajuda",error:{title:"Erro",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Ajuda indisponvel",saveFailed:"Falha na impresso| Tente mais tarde",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Pode imprimir a vista que criou",info:{maxLayers:"Pode imprimir at 8 camadas em simultneo",printoutProcessingTime:"Processo de impresso  demorado quando se seleciona vrias camadas"},buttons:{"continue":"Continuar",cancel:"Cancelar"}}}});Oskari.registerLocalization({lang:"ro",key:"Printout",value:{title:"Imprimare vedere hart",flyouttitle:"Imprimare vedere hart",desc:"",btnTooltip:"NOT TRANSLATED",BasicView:{title:"Imprimare vedere hart",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"NOT TRANSLATED",options:{fi:"NOT TRANSLATED",sv:"NOT TRANSLATED",en:"NOT TRANSLATED"},tooltip:"NOT TRANSLATED"},size:{label:"Dimensiune",tooltip:"Alegere format de imprimare",options:[{id:"A4",label:"A4 portret",classForPreview:"previzualizare-portret",selected:"Adevrat"},{id:"A4_peisaj",label:"A4 peisaj",classForPreview:"previzualizare_peisaj"},{id:"A3",label:"A3 portret",classForPreview:"previzualizare-portret"},{id:"A3_peisaj",label:"A3 peisaj",classForPreview:"previzualizare-peisaj"}]},preview:{label:"Previzualizare",tooltip:"Click pe previzualizarea mic pentru a deschide o previzualizare mai mare",pending:"Previzualizarea va fi actualizat imediat",notes:{extent:"Previzualizarea poate fi folosit pentru a determina dimensiunea hrii de imprimat",restriction:"Nu toate straturile hrii sunt afiate n previzualizare"}},buttons:{save:"Imprimare",ok:"OK",cancel:"Anulare"},location:{label:"Localizare i nivel de mrire/micorare",tooltip:"Scara hrii imprimate se potrivete cu scara hrii n browser",zoomlevel:"Nivel de mrire/micorare"},settings:{label:"Mai multe setri",tooltip:"Realizare setri adiionale precum format, titlu, scar"},format:{label:"Format",tooltip:"Selectare format fiier",options:[{id:"png",format:"image/png",label:"imagine PNG"},{id:"pdf",format:"application/pdf",selected:"adevrat",label:"document PDF"}]},mapTitle:{label:"Adugare titlu",tooltip:"adugare titlu hart"},content:{options:[{id:"Siglpagin",label:"Adugare sigl Oskari",tooltip:"Putei ascunde sigla dac este necesar",checked:"verificat"},{id:"Scar",label:"Adugare scar hart",tooltip:"Adugare scar hart",checked:"verificat"},{id:"Data",label:"Adugare dat",tooltip:"Putei aduga data pe harta tiprit",checked:"verificat"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Ajutor",error:{title:"Eroare",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Nu exist asisten disponibil",saveFailed:"Imprimare hart nereuit | ncercai mai trziu",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Putei imprima vederea Hrii pe care ai creat-o",info:{maxLayers:"Putei imprima maximum 8 straturi la un moment dat",printoutProcessingTime:"Procesul de imprimare dureaz mai mult cnd sunt selectate mai multe straturi"},buttons:{"continue":"Continuare",cancel:"Anulare"}}}});Oskari.registerLocalization({lang:"rs",key:"Printout",value:{title:"Prikaz mape za tampu",flyouttitle:"Prikaz mape za tampu",desc:"",btnTooltip:"NOT TRANSLATED",BasicView:{title:"Prikaz mape za tampu",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"NOT TRANSLATED",options:{fi:"NOT TRANSLATED",sv:"NOT TRANSLATED",en:"NOT TRANSLATED"},tooltip:"NOT TRANSLATED"},size:{label:"Veliina",tooltip:"Izaberi prikaz tampe. Prikaz je auriran",options:[{id:"A4",label:"A4 uspravno",classForPreview:"prikaz-uspravno",selected:"ispravno"},{id:"A4 poloeno",label:"A4 poloeno",classForPreview:"prikaz-poloeno"},{id:"A3",label:"A3 uspravno",classForPreview:"prikaz-uspravno"},{id:"A3 uspravno",label:"A3 poloeno",classForPreview:"prikaz-poloeno"}]},preview:{label:"Prikaz",tooltip:"Klik na mali prikaz da otvorite veliki prikaz",pending:"Prikaz se aurira",notes:{extent:"Prikaz se koristiti za pregled podruja za tampu",restriction:"Nisu svi slojevi prikazani"}},buttons:{save:"Prihvati podeavanja tampe",ok:"Potvrdi",cancel:"Odustani"},location:{label:"Podruje i razmera",tooltip:"Razmera tampe odgovara razmeri u kartografskom pregledu",zoomlevel:"Razmera"},settings:{label:"Dodatna podeavanja",tooltip:"Zadavanje dodatnih podeavanja kao format, naslov i razmera"},format:{label:"Format",tooltip:"Izaberi format datoteke",options:[{id:"png",format:"image/png",label:"PNG slika"},{id:"pdf",format:"application/pdf",selected:"ispravno",label:"PDF dokument"}]},mapTitle:{label:"Dodaj naslov",tooltip:"Dodaj naslov za mapu"},content:{options:[{id:"Logo",label:"Dodaj OSKARI logo",tooltip:"Moete sakriti logo ako je potrebno",checked:"provereno"},{id:"razmera",label:"Dodaj razmeru na mapu",tooltip:"Dodavanje razmere na mapu",checked:"provereno"},{id:"datum",label:"Dodati datum",tooltip:"Moete dodati datum za tampu",checked:"provereno"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Pomo",error:{title:"Greka",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Pomo nije dostupna",saveFailed:"Greka. Probajte kasnije",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Moete odtampati mapu koju ste napravili",info:{maxLayers:"Moete odtampati najvie 8 slojeva istovremeno",printoutProcessingTime:"Priprema za tampu moe potrajiti za vie slojeva"},buttons:{"continue":"Nastavi",cancel:"Odustani"}}}});Oskari.registerLocalization({lang:"sl",key:"Printout",value:{title:"Natisni kartni pogled",flyouttitle:"Natisni kartni pogled",desc:"",btnTooltip:"NOT TRANSLATED",BasicView:{title:"Natisni kartni pogled",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"NOT TRANSLATED",options:{fi:"NOT TRANSLATED",sv:"NOT TRANSLATED",en:"NOT TRANSLATED"},tooltip:"NOT TRANSLATED"},size:{label:"Velikost",tooltip:"Izberi nastavitve strani tiskanja| Predogled karte je potrebno posodobiti,",options:[{id:"A4",label:"A4 stojee",classForPreview:"predogled-stojee",selected:"pravilno"},{id:"A4_Landscape",label:"A4 leee",classForPreview:"predogled-leee"},{id:"A3",label:"A3 stojee",classForPreview:"predogled-stojee"},{id:"A3_Landscape",label:"A3 leee",classForPreview:"predogled-leee"}]},preview:{label:"Predogled",tooltip:"Za odprtje vejega predogleda klikni na majhen predogled",pending:"Predogled bo kmalu osveen",notes:{extent:"Predogled se lahko uporablja, da ugotovimo koliken je obseg karte na natisu",restriction:"V predogledu niso vidi vsi sloji karte"}},buttons:{save:"Natisni",ok:"V redu",cancel:"Prekini"},location:{label:"Lokacija in poveava",tooltip:"Merilo natis se ujema z merilo na karti in v brskalniku",zoomlevel:"Poveava"},settings:{label:"Ve nastavitev",tooltip:"Naredi dodatne nastavitve kot so format, naslov in lestvica"},format:{label:"Format",tooltip:"Izberi format",options:[{id:"png",format:"slika/png",label:"PNG slika"},{id:"pdf",format:"aplikacija/pdf",selected:"pravilno",label:"PDF dokument"}]},mapTitle:{label:"Dodaj naslov",tooltip:"dodaj naslov za karto"},content:{options:[{id:"Logo strani",label:"Dodaj Oskari logo",tooltip:"Po potrebi lahko logo skrije",checked:"preverjeno"},{id:"stranMerilo",label:"Dodaj merilo na karto",tooltip:"Dodaj merilo na karto",checked:"preverjeno"},{id:"stranDatum",label:"Dodaj datum",tooltip:"Natisu lahko doda datum",checked:"preverjeno"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Pomo",error:{title:"Napaka",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Pomo ni na voljo.",saveFailed:"Natis karte ni uspel| Poskusi kasneje.",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Izdelan kartni pogled lahko natisne",info:{maxLayers:"Natisne lahko najve 8 slojev na enkrat",printoutProcessingTime:"Pri izbiri ve slojev na enkrat postopek natisa traja malo dlje"},buttons:{"continue":"Nadaljuj",cancel:"Prekini"}}}});Oskari.registerLocalization({lang:"sk",key:"Printout",value:{title:"Vytlai zobrazenie mapy",flyouttitle:"Vytlai zobrazenie mapy",desc:"",btnTooltip:"NOT TRANSLATED",BasicView:{title:"Vytlai zobrazenie mapy",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"NOT TRANSLATED",options:{fi:"NOT TRANSLATED",sv:"NOT TRANSLATED",en:"NOT TRANSLATED"},tooltip:"NOT TRANSLATED"},size:{label:"Vekos",tooltip:"Vybra rozvrhnutie tlae| Nhad mapy sa priebene aktualizuje",options:[{id:"A4",label:"A4 na vku",classForPreview:"nhad-na vku",selected:"dobre"},{id:"A4_Landscape",label:"A4 na rku",classForPreview:"nhad-na rku"},{id:"A3",label:"A3 na vku",classForPreview:"nhad-na vku"},{id:"A3_Landscape",label:"A3 na rku",classForPreview:"nhad-na rku"}]},preview:{label:"Nhad",tooltip:"Kliknite na mal nhad aby sa otvoril v nhad",pending:"Nhad sa o chvu aktualizuje",notes:{extent:"Nhad sa me poui na vypotanie rozsahu mapy pre tla",restriction:"Nie vetky mapov vrstvy s v nhade zobrazen"}},buttons:{save:"Vytlate to",ok:"OK",cancel:"Zrui"},location:{label:"rove umiestnenia a priblenia",tooltip:"Mierka vtlaku sa zhoduje s mierkou mapy v prehliadai",zoomlevel:"rove priblenia"},settings:{label:"Viac nastaven",tooltip:"Vytvori dodaton nastavenia ako formt, nzov a mierka"},format:{label:"Formt",tooltip:"Vyberte formt sboru",options:[{id:"png",format:"obrzok/png",label:"PNG obrzok"},{id:"pdf",format:"aplikcia/pdf",selected:"sprvnos",label:"PDF dokument"}]},mapTitle:{label:"Prida nzov",tooltip:"prida nzov k mape"},content:{options:[{id:"logoStrnky",label:"Prida logo Oskari",tooltip:"Ak je to nutn, mete skry logo",checked:"skontrolovan"},{id:"strnkaMierka",label:"Prida mierku k mape",tooltip:"Prida mierku k mape",checked:"skontrolovan"},{id:"strnkaDtum",label:"Prida dtum",tooltip:"Mete prida dtum k vtlaku",checked:"skontrolovan"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Pomoc",error:{title:"Chyba",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Pomoc nie je k dispozcii",saveFailed:"Tlaenie mapy zlyhalo| Skste neskr",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Mete vytlai Zobrazenie mapy, ktor ste prve vytvorili",info:{maxLayers:"Mete vytlai maximlne 8 vrstiev naraz",printoutProcessingTime:"Proces tlaenia trv dlhie ak sa vybralo viacero vrstiev"},buttons:{"continue":"Pokraova",cancel:"Zrui"}}}});Oskari.registerLocalization({lang:"sq",key:"Printout",value:{title:"Shtyp pamjen e harts",flyouttitle:"Shtyp pamjen e harts",desc:"",btnTooltip:"NOT TRANSLATED",BasicView:{title:"Shtyp pamjen e harts",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"NOT TRANSLATED",options:{fi:"NOT TRANSLATED",sv:"NOT TRANSLATED",en:"NOT TRANSLATED"},tooltip:"NOT TRANSLATED"},size:{label:"Madhsia",tooltip:"Zgjidh formn (modelin) e shtypjes I",options:[{id:"A4",label:"A4 Vertikal (portrait)",classForPreview:"parapamje pr shtypje vertikale",selected:"e vrtet"},{id:"A4_Landscape",label:"A4 Horizontal (landscape)",classForPreview:"parapamje pr shtypje horizontale"},{id:"A3",label:"A3 Vertikal (portrait)",classForPreview:"parapamje pr shtypje vertikale"},{id:"A3_Landscape",label:"A3 Horizontal (landscape)",classForPreview:"parapamje pr shtypje horizontale"}]},preview:{label:"Parapamje pr shtypje",tooltip:"Kliko n parapamjen e vogl pr shtypje pr t hapur parapamjen e madhe pr shtypje",pending:"Parapamja pr shtypje do t azhurnohet s shpejti",notes:{extent:"Parapamja pr shtypje mund t prdoret pr t vendosur pr shtrirjen e harts pr shtypje",restriction:"Jo t gjitha shtresat e harts jan paraqitur n parapamjen pr shtypje"}},buttons:{save:"Merr shtypjen (printout)",ok:"OK (prano)",cancel:"Anulo"},location:{label:"Lokacioni dhe niveli i zmadhimit",tooltip:"Shkalla e shtypjes prputhet me shkalln e harts n shfletues",zoomlevel:"Niveli i zmadhimit"},settings:{label:"M shum panele (settings)",tooltip:"Bj m shum panele (settings) si jan formati, titulli dhe shkalla"},format:{label:"Formati",tooltip:"Przgjedh formatin e skedarit",options:[{id:"png",format:"imazh/png",label:"PNG imazh"},{id:"pdf",format:"aplikacion/pdf",selected:"e vrtet",label:"PDF dokument"}]},mapTitle:{label:"Shto titullin",tooltip:"Shto titullin pr hartn"},content:{options:[{id:"Llogoja e harts",label:"Shto llogon Oskari",tooltip:"Ju mund ta fshihni llogon nse sht e nevojshme",checked:"E kontrolluar"},{id:"Shkalla e faqes",label:"Shto harts shkallt",tooltip:"Shto harts shkallt",checked:"E kontrolluar"},{id:"Data e faqs",label:"Shto datn",tooltip:"Ju mund t'ia shtoni datn shtypjes",checked:"E kontrolluar"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"Ndihm",error:{title:"Gabim",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"Nuk ka ndihm n dispozicion",saveFailed:"Dshtoi shtypja e harts I Ju lutem provoni m von",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"Ju mund ta shtypni pajmen n hart t ciln sapo e keni krijuar",info:{maxLayers:"Ju mund t shtypni maksimum 8 shtresa prnjher",printoutProcessingTime:"Procesimi i shtypjes merr pak koh kur disa shtresa jan zgjedhur"},buttons:{"continue":"Vazhdo",cancel:"Anulo"}}}});Oskari.registerLocalization({lang:"sv",key:"Printout",value:{title:"Skriv ut kartvyn",flyouttitle:"Skriv ut kartvyn",desc:"",btnTooltip:"Skriv ut",BasicView:{title:"Skriv ut kartvyn",name:{label:"Kartans namn",placeholder:"obligatorisk uppgift",tooltip:"Ge kartan ett beskrivande namn. Observera anvndargrnssnittets sprk"},language:{label:"Sprk",options:{fi:"Finska",sv:"Svenska",en:"Engelska"},tooltip:"Vlj sprk fr kartmaterial och anvndargrnssnitt."},size:{label:"Storlek",tooltip:"Vlj storleken p kartan. Kartan frhandsvisas i den valda storleken.",options:[{id:"A4",label:"A4",classForPreview:"preview-portrait",selected:!0},{id:"A4_Landscape",label:"A4-horisontell",classForPreview:"preview-landscape"},{id:"A3",label:"A3",classForPreview:"preview-portrait"},{id:"A3_Landscape",label:"A3-horisontell",classForPreview:"preview-landscape"}]},preview:{label:"Frhandsgransningsvy",tooltip:"Klicka p den lilla frhandsgransningsvyn fr att ppna en strre frhandsgransningsvy",pending:"Frhandsgransningsvyn uppdateras om en stund",notes:{extent:"Frhandsgransningsvy visar kartans lge",restriction:"Inte alla maplager visas i frhandsgransningsvyn"}},buttons:{save:"Ladda ned utskriften",ok:"OK",cancel:"Avbryt"},location:{label:"Lge och skalniv.",tooltip:"Utskriftens skalniv motsvarar skalnivn i webblsaren.",zoomlevel:"Skalniv"},settings:{label:"vriga instllningar",tooltip:"Gr vriga instllningar ssom format, rubrik, och skala"},format:{label:"Format",tooltip:"Vlj fil format",options:[{id:"png",format:"image/png",label:"PNG bild"},{id:"pdf",format:"application/pdf",label:"PDF dokument",selected:!0}]},mapTitle:{label:"Lgg till rubrik",tooltip:"Lgg till rubrik fr kartan"},content:{options:[{id:"pageScale",label:"Lgg till skala till kartan",tooltip:"Lgg till skala till kartan",checked:"checked"},{id:"pageDate",label:"Lgg till datum",tooltip:"Det r mjligt att lgga till datumet till utskriften",checked:"checked"}]},legend:{label:"Legend",tooltip:"Vlj legend position",options:[{id:"oskari_legend_NO",loca:"NO",label:"Ingen legend ",tooltip:"Ingen legend print",selected:!0},{id:"oskari_legend_LL",loca:"LL",label:"Vnster nere hrn ",tooltip:"Legend position i vnster nere hrn"},{id:"oskari_legend_LU",loca:"LU",label:"Vnster uppe hrn ",tooltip:"Legend position i vnster uppe hrn"},{id:"oskari_legend_RU",loca:"RU",label:"Hger uppe hrn ",tooltip:"Legend position i hger uppe hrn"},{id:"oskari_legend_RL",loca:"RL",label:"Hger nere hrn ",tooltip:"Legend position i hger nere hrn"}]},help:"Anvisning",error:{title:"Fel",size:"Fel i storleksdefinitionerna",name:"Namnet r en ndvndig uppgift",nohelp:"Ingen anvisning",saveFailed:"Avskiljandet av kartan misslyckades. Frsk p nytt senare.",nameIllegalCharacters:"I namnet ingr otilltna tecken. Tilltna r alla bokstver i det svenska alfabetet, siffror, mellanslag och bindestreck."}},StartView:{text:"Du kan skriva ut den kartvy som du definierat till PDF-utskrift eller PNG-bildfilen",info:{maxLayers:"Hgst 8 kartlager kan skrivs ut",printoutProcessingTime:"Det tar en stund att skriva ut kartvyn med mnga kartlager."},buttons:{"continue":"Fortstt",cancel:"Tillbaka"}}}});Oskari.registerLocalization({lang:"uk",key:"Printout",value:{title:"  ",flyouttitle:"  ",desc:"",btnTooltip:"NOT TRANSLATED",BasicView:{title:"  ",name:{label:"NOT TRANSLATED",placeholder:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},language:{label:"NOT TRANSLATED",options:{fi:"NOT TRANSLATED",sv:"NOT TRANSLATED",en:"NOT TRANSLATED"},tooltip:"NOT TRANSLATED"},size:{label:"",tooltip:"  |    ",options:[{id:"4",label:"4 ",classForPreview:"preview-portrait",selected:"true"},{id:"A4_Landscape",label:"4 ",classForPreview:"preview-landscape"},{id:"3",label:"3 ",classForPreview:"preview-portrait"},{id:"A3_Landscape",label:"3 ",classForPreview:"preview-landscape"}]},preview:{label:" ",tooltip:"          ",pending:"   ",notes:{extent:"      ",restriction:"        "}},buttons:{save:"",ok:"",cancel:""},location:{label:"  ",tooltip:"        ",zoomlevel:""},settings:{label:" ",tooltip:"     ,   "},format:{label:"",tooltip:"  ",options:[{id:"png",format:"image/png",label:"PNG "},{id:"pdf",format:"application/pdf",selected:"true",label:"PDF "}]},mapTitle:{label:" ",tooltip:"   "},content:{options:[{id:"pageLogo",label:"  Oskari",tooltip:"   ,   ",checked:"checked"},{id:"pageScale",label:"   ",tooltip:"   ",checked:"checked"},{id:"pageDate",label:" ",tooltip:"      ",checked:"checked"}]},legend:{label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",options:[{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED",selected:!0},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"},{id:"NOT TRANSLATED",loca:"NOT TRANSLATED",label:"NOT TRANSLATED",tooltip:"NOT TRANSLATED"}]},help:"",error:{title:"",size:"NOT TRANSLATED",name:"NOT TRANSLATED",nohelp:"  ",saveFailed:"   |  ",nameIllegalCharacters:"NOT TRANSLATED"}},StartView:{text:"      ",info:{maxLayers:"      8 ",printoutProcessingTime:"         "},buttons:{"continue":"",cancel:""}}}});Oskari.clazz.define("Oskari.mapframework.bundle.userguide.UserGuideBundle",function(){},{create:function(){return Oskari.clazz.create("Oskari.mapframework.bundle.userguide.UserGuideBundleInstance")},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/request/ShowUserGuideRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/request/ShowUserGuideRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/service/UserGuideService.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/Tile.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/Flyout.js"},{type:"text/css",src:"../../../../resources/framework/bundle/userguide/css/style.css"}],locales:[{lang:"am",type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/am.js"},{lang:"cs",type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/cs.js"},{lang:"da",type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/da.js"},{lang:"de",type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/de.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/en.js"},{lang:"es",type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/es.js"},{lang:"et",type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/et.js"},{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/fi.js"},{lang:"gr",type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/gr.js"},{lang:"hr",type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/hr.js"},{lang:"hu",type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/hu.js"},{lang:"lv",type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/lv.js"},{lang:"nl",type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/nl.js"},{lang:"pl",type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/pl.js"},{lang:"pt",type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/pt.js"},{lang:"sl",type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/sl.js"},{lang:"sk",type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/sk.js"},{lang:"sq",type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/sq.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/sv.js"},{lang:"uk",type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/uk.js"}]},bundle:{manifest:{"Bundle-Identifier":"userguide","Bundle-Name":"userguide","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:"userguide",Title:"userguide"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}});Oskari.bundle_manager.installBundleClass("userguide","Oskari.mapframework.bundle.userguide.UserGuideBundle");Oskari.clazz.define("Oskari.mapframework.bundle.userguide.UserGuideBundleInstance",function(){this.sandbox=null;this.started=!1;this.plugins={};this.localization=null;this.ui=null;this._requestHandlers={};this.attachedToDefault=!1;this.helper=null;this.isContentLoaded=!1},{templates:{userguide:'<div class="oskari-userguide"><span class="oskari-prompt"><\/span><br /><\/div>'},__name:"userinterface.UserGuide",getName:function(){return this.__name},setSandbox:function(sandbox){this.sandbox=sandbox},getSandbox:function(){return this.sandbox},getLocalization:function(key){return key?this._localization[key]:this._localization},start:function(){var me=this,title,popover,p,request,helper;if(!me.started){me.started=!0;var conf=this.conf,sandboxName=(conf?conf.sandbox:null)||"sandbox",sandbox=Oskari.getSandbox(sandboxName);me.sandbox=sandbox;this._localization=Oskari.getLocalization(this.getName());title=this.getLocalization("title");popover=Oskari.clazz.create("Oskari.userinterface.component.Popover",title,"");this.ui=popover;popover.setContent($(this.templates.userguide));sandbox.register(me);for(p in me.eventHandlers)me.eventHandlers.hasOwnProperty(p)&&sandbox.registerForEventByName(me,p);this._requestHandlers["userguide.ShowUserGuideRequest"]=Oskari.clazz.create("Oskari.mapframework.bundle.userguide.request.ShowUserGuideRequestHandler",sandbox,this);sandbox.addRequestHandler("userguide.ShowUserGuideRequest",this._requestHandlers["userguide.ShowUserGuideRequest"]);request=sandbox.getRequestBuilder("userinterface.AddExtensionRequest")(this);sandbox.request(this,request);me.createUi();helper=Oskari.clazz.create("Oskari.userinterface.component.UIHelper",sandbox);this.helper=helper}},init:function(){return null},update:function(){},onEvent:function(event){var handler=this.eventHandlers[event.getName()];if(handler)return handler.apply(this,[event])},eventHandlers:{"userinterface.ExtensionUpdatedEvent":function(event){var me=this,isOpen;event.getExtension().getName()===me.getName()&&(isOpen=event.getViewState()!=="close",me.displayContent(isOpen))}},displayContent:function(isOpen){var me=this,helpContentPart,tagsTxt,content;isOpen&&(me.isContentLoaded||(helpContentPart="help.contentPart",me.getLocalization("help")&&me.getLocalization("help").contentPart&&(helpContentPart=me.getLocalization("help").contentPart),tagsTxt="help.tags",this.getLocalization("help")&&this.getLocalization("help").tags&&(tagsTxt=this.getLocalization("help").tags),this.conf.displayLocalContent?(content=this.getLocalization("articles")[0].content,me.plugins["Oskari.userinterface.Flyout"].setContent(content[helpContentPart]),me.isContentLoaded=!0):this.helper.getHelpArticle(tagsTxt,function(isSuccess,pContent){var content=pContent,errorTxt="error.generic";me.getLocalization("error")&&me.getLocalization("error").generic&&(errorTxt=me.getLocalization("error").generic);isSuccess?content[helpContentPart]&&(content=content[helpContentPart]):content=errorTxt;me.plugins["Oskari.userinterface.Flyout"].setContent(content);me.isContentLoaded=!0})))},toggleUserInterface:function(doOpen){var me=this,popover=this.ui,el2;doOpen?(me.attachedToDefault||(el2=me.plugins["Oskari.userinterface.Tile"].getEl(),popover.setPlacement("right"),popover.attachTo(el2),me.attachedToDefault=!0),popover.show()):popover.hide()},scheduleShowUserGuide:function(request){var me=this,popover=me.ui,isToggle=request.isToggle(),el,placement;if(isToggle&&popover.shown){me.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[this,"close"]);return}me.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[this,"attach"]);var userGuideContent=jQuery(this.templates.userguide),userGuideData=jQuery("<div />"),lang=Oskari.getLang(),d=userGuideData.clone(),reqContent=request.getContent();reqContent?userGuideContent.append(reqContent):(d.append("Lang: "+lang),userGuideContent.append(d),d=userGuideData.clone(),d.append("Extension: "+request.getExtension()),userGuideContent.append(d),d=userGuideData.clone(),d.append("Context: "+request.getContext()),userGuideContent.append(d),d=userGuideData.clone(),d.append("Element: "+(request.getEl()?"YES":"NO")),userGuideContent.append(d));el=request.getEl();placement=request.getPlacement();placement&&popover.setPlacement(placement);el?(popover.hide(),me.attachedToDefault=!1,popover.attachTo(el)):me.attachedToDefault||(el=me.plugins["Oskari.userinterface.Tile"].getEl(),popover.attachTo(el),me.attachedToDefault=!0);popover.setContent(userGuideContent)},stop:function(){var sandbox=this.sandbox(),p,request;for(p in this.eventHandlers)this.eventHandlers.hasOwnProperty(p)&&sandbox.unregisterFromEventByName(this,p);sandbox.removeRequestHandler("userguide.ShowUserGuideRequest",this._requestHandlers["userguide.ShowUserGuideRequest"]);request=sandbox.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);sandbox.request(this,request);this.sandbox.unregister(this);this.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.userguide.Flyout",this);this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.mapframework.bundle.userguide.Tile",this,this.getLocalization("tile"))},stopExtension:function(){this.plugins["Oskari.userinterface.Tile"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){var me=this;this.plugins["Oskari.userinterface.Tile"].refresh();this.plugins["Oskari.userinterface.Flyout"].setContent("")}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]});Oskari.clazz.define("Oskari.mapframework.bundle.userguide.request.ShowUserGuideRequest",function(conf){var config=conf||{};this._creator=null;this._el=config.el;this._context=config.context;this._extension=config.extension;this._toggle=config.toggle;this._placement=config.placement;this._content=config.content},{__name:"userguide.ShowUserGuideRequest",getName:function(){return this.__name},getUuid:function(){return this._uuid},getContext:function(){return this._context},getExtension:function(){return this._extension},getEl:function(){return this._el},isToggle:function(){return this._toggle},getPlacement:function(){return this._placement},getContent:function(){return this._content}},{protocol:["Oskari.mapframework.request.Request"]});Oskari.clazz.define("Oskari.mapframework.bundle.userguide.request.ShowUserGuideRequestHandler",function(sandbox,instance){this.sandbox=sandbox;this.instance=instance},{handleRequest:function(core,request){this.sandbox.printDebug("[Oskari.mapframework.bundle.userguide.request.ShowUserGuideRequestHandler] Show UserGuide: "+request.getUuid());this.instance.scheduleShowUserGuide(request)}},{protocol:["Oskari.mapframework.core.RequestHandler"]});Oskari.clazz.define("Oskari.mapframework.bundle.userguide.Tile",function(instance,locale){this.instance=instance;this.locale=locale;this.container=null;this.template=null},{getName:function(){return"Oskari.mapframework.bundle.userguide.Tile"},setEl:function(el){this.container=jQuery(el);var status=this.container.children(".oskari-tile-status")},getEl:function(){return this.container},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.locale.title},getDescription:function(){return this.locale.desciption},getOptions:function(){},refresh:function(){var me=this,instance=me.instance,cel=this.container,tpl=this.template,sandbox=instance.getSandbox()}},{protocol:["Oskari.userinterface.Tile"]});Oskari.clazz.define("Oskari.mapframework.bundle.userguide.Flyout",function(instance){this.instance=instance;this.container=null;this.state=null;this.template=null},{getName:function(){return"Oskari.mapframework.bundle.userguide.Flyout"},setEl:function(el){this.container=el[0];jQuery(this.container).hasClass("userguide")||jQuery(this.container).addClass("userguide")},startPlugin:function(){this.template=jQuery('<div class="userguide"><\/div>')},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(state){this.state=state},getState:function(){return this.state?this.state:{}},setContent:function(content){var me=this,sandbox=me.instance.getSandbox(),flyout=jQuery(this.container),container;flyout.empty();container=this.template.clone();container.append(content);flyout.append(container)}},{protocol:["Oskari.userinterface.Flyout"]});Oskari.registerLocalization({lang:"am",key:"userinterface.UserGuide",value:{title:"",desc:"",flyout:{title:"Oskari  "},tile:{title:"  "},error:{title:"",generic:"   . "},help:{tags:"NOT TRANSLATED",contentPart:"NOT TRANSLATED"}}});Oskari.registerLocalization({lang:"cs",key:"userinterface.UserGuide",value:{title:"Npovda",desc:"",flyout:{title:"Uivatelsk pruka Paikkatietoikkuna"},tile:{title:"Uivatelsk pruka mapy"},error:{title:"Chyba!",generic:"Nahrvn uivatelsk pruky selhalo. Zkuste to prosm pozdji."},help:{tags:"map window,user guide",contentPart:"body"}}});Oskari.registerLocalization({lang:"da",key:"userinterface.UserGuide",value:{title:"Hjlp",desc:"",flyout:{title:"Oskari brugervejledning"},tile:{title:"Kortbrugervejledning"},error:{title:"Fejl!",generic:"Fejl ved indlsning af brugervejledning. Prv venligst igen senere."},help:{tags:"NOT TRANSLATED",contentPart:"NOT TRANSLATED"}}});Oskari.registerLocalization({lang:"de",key:"userinterface.UserGuide",value:{title:"Hilfe",desc:"",flyout:{title:"Paikkatietoikkuna Benutzerhandbuch"},tile:{title:"Kartennutzerhandbuch"},error:{title:"Fehler!",generic:"Fehler beim Laden des Benutzerhandbuchs. Bitte versuchen Sie es spter noch einmal."},help:{tags:"map window,user guide",contentPart:"body"}}});Oskari.registerLocalization({lang:"en",key:"userinterface.UserGuide",value:{title:"Help",desc:"",flyout:{title:"Paikkatietoikkuna user guide"},tile:{title:"Map user guide"},error:{title:"Error!",generic:"Loading user guide failed. Please try again later."},help:{tags:"map window,user guide",contentPart:"body"},articles:[{content:{abstract:"<p> Paikkatietoikkuna is a service, where anyone can study geodatasets and use geodata services provided by several different organisations.<\/p>",body:'<p> This Paikkatietoikkuna user guide contains information about the map window and its functions. In the <a href="/web/en/map-window/">Map window<\/a> you can compile map views and browse geographic datasets by opening map layers one at a time or several transparent levels on top of one another. You can also embed maps on your own website or share a link with external users. This guide contains information about how the map window works. In addition, the map window offers interactive guidance in various situations.<\/p> <p> <strong><a name="table-of-content"><\/a>Table of Contents:<\/strong><br /> - <a href="#basics">The basics<\/a><br /> - <a href="#how-to-use-the-map">How to use the map<\/a><br /> - <a href="#map-view">How to compile and save a map view and send a link<\/a><br /> - <a href="#how-to-create-and-embed-a-map-view">How to create a map view<\/a><br /> - <a href="#my-places">My objects<\/a><br /> - <a href="#my-map-layers">My map layers<\/a><br /> - <a href="#registering-etc">Registering, user information and password<\/a><\/p> <p> <strong>Additional information:<\/strong><br /> - <a href="/web/en/about-paikkatietoikkuna">Information about Paikkatietoikkuna<\/a><\/p> <p> &nbsp;<\/p> <h2> <a name="basics"><\/a>The basics<\/h2> <p> <img alt="" src="img/userguide/en/2a102f2d-c2eb-4c93-9864-89e5d2bb8c3a.png" style="width: 372px; height: 238px; float: right;" />In Paikkatietoikkuna you can compile your own map views using various kinds of map datasets, e.g. map layers.<br /> A map view can be:<br /> 1. saved for viewing later<br /> 2. shared with others through a link<br /> 3. embedded on your own website as a part of an online service<\/p> <p> <a href="#table-of-content">Go to table of contents<\/a><\/p> <h2> <a name="how-to-use-the-map"><\/a>How to use the map<\/h2> <p> A map consists of different map layers, which have been made available in Paikkatietoikkuna by gov-ernmental, regional and municipal authorities or by private individuals. The first thing you see when you open the Paikkatietoikkuna map window is the default view. If you clicked a link to Paikkatietoikkuna elsewhere online, you will see the map view compiled by someone else. You can delete your map whenever you wish by clicking Restore defaults in Tools at the bottom left and in the centre of the panning controls.<\/p> <h3> Basic functions<\/h3> <p> <strong>Move the map<\/strong> by clicking and dragging it or by clicking the panning controls in the top right corner. When you are looking for a specific object or location, use the Search function.<\/p> <p> <strong>Zoom in and out<\/strong> by clicking the + and - signs next to the scale selector, or click and drag the switch to directly select a specific scale level.<\/p> <p> <strong>The coordinates <\/strong>show the location of the mouse pointer on the map.<\/p> <p> <strong>The Index map<\/strong> shows the map view in a smaller scale. You can show and hide the index map by clicking the right bottom corner of the map window.<\/p> <p> <strong>Objects <\/strong>on the map often contain additional information. Click an object on the map to view any addi-tional information. Data products display on a list any objects that are located within the area shown in the map window. You can set conditions to limit your selection to particular kinds of objects in a data product. A list of object information is shown when you click the Object data link to the right of the map.<\/p> <h3> <img alt="" src="img/userguide/en/0724e332-1370-4fef-9b9f-a2b17a5202fa.png" style="width: 719px; height: 448px;" /><br /> Menus<\/h3> <p> <strong>Use the<\/strong> <strong>Search <\/strong>menu to find a place name and centre the map on that location.<\/p> <p> <strong>Use the Map layers<\/strong> menu to search for and select datasets provided by various providers. The datasets have been sorted according to theme and data provider. Datasets:<br /> &nbsp; Map layer <img alt="" src="img/userguide/278431.png" style="width: 16px; height: 16px; float: left;" /><br /> &nbsp; Background map <img alt="" src="img/userguide/278435.png" style="width: 16px; height: 16px; float: left;" /><br /> &nbsp; Data product provided by search service <img alt="" src="img/userguide/278425.png" style="width: 16px; height: 16px; float: left;" /><\/p> <p> A grey symbol means that the dataset concerned cannot be viewed on the selected scale level. When you select a data product, an Object data link is shown to the right of the map. Click this link to view a list of object data about objects in the area covered by the map.<\/p> <p> Use the <strong>Selected map layers<\/strong> menu to see which datasets are currently displayed in the map view. You can adjust the order and transparency of map layers or delete them. A bubble to the right of the menu shows the number of selected map layers.<\/p> <p> Use the<strong> My information<\/strong> menu to see all saved <a href="#my-places">M<\/a><a href="#my-places">y objects<\/a>, My views (see Tools below) and <a href="#how-to-create-and-embed-a-map-view">the maps you have embedded<\/a> elsewhere. Here you can also &quot;un-embed&quot; a map. The menu also contains your user information and allows you to change it. You must be logged in to Paikkatietoikkuna to use this function.<\/p> <p> Use the<strong> Create map<\/strong> menu to create the code you need to embed the map view you have compiled, which you then can embed on your own website or on a company website. You need to be logged in to Paikkatietoikkuna to use this function.<\/p> <p> <strong>The Map legend<\/strong> menu contains a description of the symbols used on the map layers.<\/p> <p> <strong>The User guide<\/strong> menu contains this user guide. If you need more help, the i-symbol or more information link contain additional information.<br /> Please note, that you can always reset the default settings and undo or redo any changes. These tools are located in the left margin below the menus (see Tools).<\/p> <h3> Tools<\/h3> <p> <img alt="" src="img/userguide/en/aa288d0e-8430-4eb0-8c09-0a5736339441.png" style="width: 719px; height: 234px;" /><\/p> <p> <a href="#table-of-content">Go to table of contents<\/a><\/p> <h3> <a name="map-view"><\/a>Map view<\/h3> <p> Create your own map view by selecting map layers in the <em>Map layers<\/em> menu or from the map layers you have saved in <em>My map layers<\/em>. Use the <em>Selected map layers<\/em> menu to change the order of your map layers by clicking and dragging and to change the transparency of your map layers.<\/p> <p> <strong>How to compile a map view:<\/strong><br /> 1.&nbsp;&nbsp; &nbsp;Select the map layers you want to display in the <em>Map layers<\/em> menu<br /> 2.&nbsp;&nbsp; <em>&nbsp;<\/em>Use the <em>Selected map layers<\/em> menu to change the order of your map layers by clicking and drag-ging them in the map layer stack, and to change their transparency if necessary<\/p> <p> <strong>How to save a map view<\/strong><br /> Use the <em>Save <\/em>tool to save a map view. Information about selected map layers, their order and transparency, selected location and scale level will be saved in <em>My map views<\/em>. Saved map views are listed on the <em>My map views<\/em> tab in the <em>My data<\/em> menu.<\/p> <p> <strong>How to share a map view<\/strong><br /> <em>The Link to map view<\/em> tool creates a direct link to a compiled map view. You can use it to share the map view with other Internet users. Please note that you cannot yet share your own places and map layers.<\/p> <p> <strong>See also:<\/strong><br /> - <a href="#my-map-layers">My map layers<\/a><br /> - <a href="#map-view">How to use the map<\/a><\/p> <p> <img alt="" src="img/userguide/en/29a9eb96-cbea-4ca6-9f78-d63db0411762.png" style="width: 611px; height: 350px;" /><\/p> <p> Image: Use the <em>Map layers<\/em> menu to select map layers.<\/p> <p> <img alt="" src="img/userguide/en/f8e7674e-4c99-478d-9b5e-2bd610815598.png" style="width: 611px; height: 255px;" /><\/p> <p> Image: Use the <em>Selected map layers<\/em> menu to show, hide and delete map layers, adjust transparency and view the status of the map. Some map layers show the data they contain only when you have selected a suitable scale level, while the data on other map layers may only cover a part of Finland. Some layers cannot be embedded on your own website, even though they may be viewed in the Paikkatietoikkuna map window.<\/p> <p> <img alt="" src="img/userguide/en/efa19d83-46e2-42ca-bb8a-f28224775028.png" style="width: 719px; height: 72px;" /><\/p> <p> Image: Use the Tools to save, share and print a map view.<\/p> <p> <a href="#table-of-content">Go to table of contents<\/a><\/p> <h3> <a name="how-to-create-and-embed-a-map-view"><\/a>How to create and embed a map view<\/h3> <p> You can compile a map view and make it public by embedding it on another website by copying and pasting a few lines of html-code. Start by clicking the<em> Create map<\/em> menu. You need to be logged in to Paikkatietoikkuna to use the feature.<a href="/web/en/login"> Log in<\/a> or Register (linkki).<\/p> <p> To create a map, you simply give the map a name, define its size and type the URL of the website where the map will be embedded. You can also select the tools that will be shown on the map, such as the scale selector and place name search function.<\/p> <p> Finally, you will be given a few lines of html-code. Copy and paste it in to the webpage where you want to display the map.<\/p> <p> <strong>How to edit map layers in embedded maps<\/strong><\/p> <p> Currently, it is not possible to edit a map in Paikkatietoikkuna. If you want to edit map layers, you will need to embed the map again.<\/p> <ol> <li> Open an embedded map within Paikkatietoikkuna by clicking on its name in the Embedded maps list <em>(My data<\/em> menu).<\/li> <li> Embed (publish) the map again<\/li> <li> Copy and paste the new html-code in to your website.<\/li> <\/ol> <p> <img alt="" src="img/userguide/en/4d17137a-bdff-42aa-9a80-2367d5b748d2.png" style="width: 719px; height: 386px;" /><\/p> <p> Image: Use the Map layers function to define one or more background map layers, so that the user can switch between them (say, between an orthophoto and a background map). The user will always see one of the selected background map layers; the Background map and Orthophotos are good choices. The map preview will instantly display your selection.<\/p> <p> <em>Tip: When you display the Map layers menu on your map, use the map preview to open it. This way, you can select a new default background map layer.<\/em><\/p> <p> <a href="#table-of-content">Go to table of contents<\/a><\/p> <h3> <strong><a name="my-places"><\/a>My places/objects<\/strong><\/h3> <p> You can add your own places/objects to the map in Paikkatietoikkuna. An object can be a dot, a route or an area with a name and a description. When you have marked an object on the map, click &quot;Save&quot; to save it on one of your own map layers or create a new map layer. You can use different map layers to look at objects belonging to the same theme together. You need to be logged in to Paikkatietoikkuna to save, edit and delete your own objects. <a href="/web/fi/login/">Log in<\/a> or register (linkit).<\/p> <p> <strong>Where are My places? <\/strong><br /> The objects/places you save can be found in the <em>My data<\/em> menu on the <em>Places<\/em> tab.<\/p> <p> <strong>How to view My places: <\/strong><br /> Click the name of an object on the <em>Places<\/em> tab to view it.<\/p> <p> <strong>How to share My places: <\/strong><br /> Currently, it is not possible to share links to objects/places that you have saved.<\/p> <p> <strong>How to edit My places:<\/strong><br /> Use the <em>Edit <\/em>function to edit the name, description or map layer of a saved place/object.<\/p> <p> <strong>How to delete My places: <\/strong><br /> Use the <em>Delete <\/em>function to delete a saved place/object from the map layer.<\/p> <p> <strong>See also:<\/strong><br /> - <a href="#my-map-layers">My map layers<\/a><br /> <br /> <img alt="" src="img/userguide/en/f26f6451-db26-41f5-91fb-7687a430732a.png" style="width: 611px; height: 425px;" /><\/p> <p> Image: The objects/places you have saved can be found in the <em>My data<\/em> menu on the <em>Places <\/em>menu. When you click on an object, the map view shows it in the centre of the map window.<\/p> <p> <img alt="" src="img/userguide/en/618ccfaf-3bf2-4420-ac7f-5ca116628f4f.png" style="width: 611px; height: 330px;" /><\/p> <p> Image: You can change the name, description and location of an object as well as move it from one map layer to another with the Edit function. You can edit the colour and thickness of points and lines on the map (its style) on the <em>Places<\/em> tab with <em>Edit map layer<\/em>.<\/p> <p> <a href="#table-of-content">Go to table of contents<\/a><\/p> <h3> <strong><a name="my-map-layers"><\/a>My map layers<\/strong><\/h3> <p> You can save objects/places on your map layers. Use different map layers to separate one theme from another. You can find them by selecting <em>My map layers<\/em> from the drop-down menu on the <em>Places<\/em> tab on the <em>My data<\/em> menu.<\/p> <p> <strong>How to create a new map layer:<br /> <\/strong>When you save or edit a place/object, you automatically create a map layer. (You must be logged in to Paikkatietoikkuna to save or edit.)<\/p> <p> <strong>How to view My map layers:<br /> <\/strong>You can view one of the map layers you have saved when you click an object in the My places list or by ticking the layer <em>My places<\/em> in the category Places in the <em>Map layers<\/em> menu.<\/p> <p> <strong>How to edit and delete My map layers:<br /> <\/strong>You can edit the name or style of a map layer by clicking the <em>Edit <\/em>option.<\/p> <p> <strong>The privacy settings of My map layers:<br /> <\/strong>My map layers and the objects/places they contain are private by default.<\/p> <p> <strong>How to make My map layers public:<br /> <\/strong>Currently, it is not possible to make user-created map layers public.<br /> &nbsp;<\/p> <p> <img alt="" src="img/userguide/en/ba99d8c9-9613-4e6d-aa25-34f2e7aad7d9.png" style="width: 611px; height: 425px;" /><\/p> <p> Image: You can <em>edit <\/em>the name and style of a map layer and if necessary <em>delete <\/em>the map layer on the Places tab in the My data menu.<\/p> <p> <a href="#table-of-content">Go to table of contents<\/a><\/p> <h3> <a name="registering-etc"><\/a>Registering, user information and password<\/h3> <p> Many map window functions require that you are logged in to Paikkatietoikkuna. You can change your user information and password by clicking your user name at the top of the page when you have logged in.<br /> - <a href="/web/fi/login/">Log in<\/a><br /> - <a href="/web/en/profile">Edit user information and change password<\/a><br /> - <a href="/web/en/login?p_p_id=58&amp;p_p_lifecycle=0&amp;p_p_state=normal&amp;p_p_mode=view&amp;p_p_col_id=column-1&amp;p_p_col_count=1&amp;_58_struts_action=%2Flogin%2Fforgot_password">Forgotten password recovery<\/a><br /> - <a href="/web/en/login?p_p_id=58&amp;p_p_lifecycle=1&amp;p_p_state=maximized&amp;p_p_mode=view&amp;p_p_col_id=column-1&amp;p_p_col_count=1&amp;saveLastPath=0&amp;_58_struts_action=%2Flogin%2Fcreate_account">Register as a user of Paikkatietoikkuna<\/a><\/p> <p> <a href="#table-of-content">Go to table of contents<\/a><\/p>',title:"User guide - Map window","link-url":"","link-to-page":"",Blue_Subject:"",Intro:"Paikkatietoikkuna is a service, where anyone can study geodatasets and use geodata services provided by several different organisations.","small-image":""},id:"314262"},{content:{abstract:"",body:'<p><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="Word.Document" name="ProgId"><meta content="Microsoft Word 12" name="Generator"><meta content="Microsoft Word 12" name="Originator"><link href="file:///C:\\TEMP\\msohtmlclip1\\01\\clip_filelist.xml" rel="File-List" /><link href="file:///C:\\TEMP\\msohtmlclip1\\01\\clip_themedata.thmx" rel="themeData" /><link href="file:///C:\\TEMP\\msohtmlclip1\\01\\clip_colorschememapping.xml" rel="colorSchemeMapping" /><!--[if gte mso 9]><xml> <w:WordDocument> <w:View>Normal<\/w:View> <w:Zoom>0<\/w:Zoom> <w:TrackMoves /> <w:TrackFormatting /> <w:DoNotShowRevisions /> <w:DoNotPrintRevisions /> <w:DoNotShowMarkup /> <w:DoNotShowComments /> <w:DoNotShowInsertionsAndDeletions /> <w:DoNotShowPropertyChanges /> <w:HyphenationZone>21<\/w:HyphenationZone> <w:PunctuationKerning /> <w:ValidateAgainstSchemas /> <w:SaveIfXMLInvalid>false<\/w:SaveIfXMLInvalid> <w:IgnoreMixedContent>false<\/w:IgnoreMixedContent> <w:AlwaysShowPlaceholderText>false<\/w:AlwaysShowPlaceholderText> <w:DoNotPromoteQF /> <w:LidThemeOther>FI<\/w:LidThemeOther> <w:LidThemeAsian>X-NONE<\/w:LidThemeAsian> <w:LidThemeComplexScript>X-NONE<\/w:LidThemeComplexScript> <w:Compatibility> <w:BreakWrappedTables /> <w:SnapToGridInCell /> <w:WrapTextWithPunct /> <w:UseAsianBreakRules /> <w:DontGrowAutofit /> <w:SplitPgBreakAndParaMark /> <w:DontVertAlignCellWithSp /> <w:DontBreakConstrainedForcedTables /> <w:DontVertAlignInTxbx /> <w:Word11KerningPairs /> <w:CachedColBalance /> <\/w:Compatibility> <m:mathPr> <m:mathFont m:val="Cambria Math" /> <m:brkBin m:val="before" /> <m:brkBinSub m:val="&#45;-" /> <m:smallFrac m:val="off" /> <m:dispDef /> <m:lMargin m:val="0" /> <m:rMargin m:val="0" /> <m:defJc m:val="centerGroup" /> <m:wrapIndent m:val="1440" /> <m:intLim m:val="subSup" /> <m:naryLim m:val="undOvr" /> <\/m:mathPr><\/w:WordDocument> <\/xml><![endif]--><!--[if gte mso 9]><xml> <w:LatentStyles DefLockedState="false" DefUnhideWhenUsed="true" DefSemiHidden="true" DefQFormat="false" DefPriority="99" LatentStyleCount="267"> <w:LsdException Locked="false" Priority="0" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="Normal" /> <w:LsdException Locked="false" Priority="9" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="heading 1" /> <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 2" /> <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 3" /> <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 4" /> <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 5" /> <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 6" /> <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 7" /> <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 8" /> <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 9" /> <w:LsdException Locked="false" Priority="39" Name="toc 1" /> <w:LsdException Locked="false" Priority="39" Name="toc 2" /> <w:LsdException Locked="false" Priority="39" Name="toc 3" /> <w:LsdException Locked="false" Priority="39" Name="toc 4" /> <w:LsdException Locked="false" Priority="39" Name="toc 5" /> <w:LsdException Locked="false" Priority="39" Name="toc 6" /> <w:LsdException Locked="false" Priority="39" Name="toc 7" /> <w:LsdException Locked="false" Priority="39" Name="toc 8" /> <w:LsdException Locked="false" Priority="39" Name="toc 9" /> <w:LsdException Locked="false" Priority="35" QFormat="true" Name="caption" /> <w:LsdException Locked="false" Priority="10" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="Title" /> <w:LsdException Locked="false" Priority="1" Name="Default Paragraph Font" /> <w:LsdException Locked="false" Priority="11" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="Subtitle" /> <w:LsdException Locked="false" Priority="22" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="Strong" /> <w:LsdException Locked="false" Priority="20" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="Emphasis" /> <w:LsdException Locked="false" Priority="59" SemiHidden="false" UnhideWhenUsed="false" Name="Table Grid" /> <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Placeholder Text" /> <w:LsdException Locked="false" Priority="1" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="No Spacing" /> <w:LsdException Locked="false" Priority="60" SemiHidden="false" UnhideWhenUsed="false" Name="Light Shading" /> <w:LsdException Locked="false" Priority="61" SemiHidden="false" UnhideWhenUsed="false" Name="Light List" /> <w:LsdException Locked="false" Priority="62" SemiHidden="false" UnhideWhenUsed="false" Name="Light Grid" /> <w:LsdException Locked="false" Priority="63" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 1" /> <w:LsdException Locked="false" Priority="64" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 2" /> <w:LsdException Locked="false" Priority="65" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 1" /> <w:LsdException Locked="false" Priority="66" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 2" /> <w:LsdException Locked="false" Priority="67" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 1" /> <w:LsdException Locked="false" Priority="68" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 2" /> <w:LsdException Locked="false" Priority="69" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 3" /> <w:LsdException Locked="false" Priority="70" SemiHidden="false" UnhideWhenUsed="false" Name="Dark List" /> <w:LsdException Locked="false" Priority="71" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Shading" /> <w:LsdException Locked="false" Priority="72" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful List" /> <w:LsdException Locked="false" Priority="73" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Grid" /> <w:LsdException Locked="false" Priority="60" SemiHidden="false" UnhideWhenUsed="false" Name="Light Shading Accent 1" /> <w:LsdException Locked="false" Priority="61" SemiHidden="false" UnhideWhenUsed="false" Name="Light List Accent 1" /> <w:LsdException Locked="false" Priority="62" SemiHidden="false" UnhideWhenUsed="false" Name="Light Grid Accent 1" /> <w:LsdException Locked="false" Priority="63" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 1 Accent 1" /> <w:LsdException Locked="false" Priority="64" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 2 Accent 1" /> <w:LsdException Locked="false" Priority="65" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 1 Accent 1" /> <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Revision" /> <w:LsdException Locked="false" Priority="34" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="List Paragraph" /> <w:LsdException Locked="false" Priority="29" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="Quote" /> <w:LsdException Locked="false" Priority="30" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="Intense Quote" /> <w:LsdException Locked="false" Priority="66" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 2 Accent 1" /> <w:LsdException Locked="false" Priority="67" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 1 Accent 1" /> <w:LsdException Locked="false" Priority="68" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 2 Accent 1" /> <w:LsdException Locked="false" Priority="69" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 3 Accent 1" /> <w:LsdException Locked="false" Priority="70" SemiHidden="false" UnhideWhenUsed="false" Name="Dark List Accent 1" /> <w:LsdException Locked="false" Priority="71" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Shading Accent 1" /> <w:LsdException Locked="false" Priority="72" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful List Accent 1" /> <w:LsdException Locked="false" Priority="73" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Grid Accent 1" /> <w:LsdException Locked="false" Priority="60" SemiHidden="false" UnhideWhenUsed="false" Name="Light Shading Accent 2" /> <w:LsdException Locked="false" Priority="61" SemiHidden="false" UnhideWhenUsed="false" Name="Light List Accent 2" /> <w:LsdException Locked="false" Priority="62" SemiHidden="false" UnhideWhenUsed="false" Name="Light Grid Accent 2" /> <w:LsdException Locked="false" Priority="63" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 1 Accent 2" /> <w:LsdException Locked="false" Priority="64" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 2 Accent 2" /> <w:LsdException Locked="false" Priority="65" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 1 Accent 2" /> <w:LsdException Locked="false" Priority="66" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 2 Accent 2" /> <w:LsdException Locked="false" Priority="67" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 1 Accent 2" /> <w:LsdException Locked="false" Priority="68" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 2 Accent 2" /> <w:LsdException Locked="false" Priority="69" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 3 Accent 2" /> <w:LsdException Locked="false" Priority="70" SemiHidden="false" UnhideWhenUsed="false" Name="Dark List Accent 2" /> <w:LsdException Locked="false" Priority="71" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Shading Accent 2" /> <w:LsdException Locked="false" Priority="72" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful List Accent 2" /> <w:LsdException Locked="false" Priority="73" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Grid Accent 2" /> <w:LsdException Locked="false" Priority="60" SemiHidden="false" UnhideWhenUsed="false" Name="Light Shading Accent 3" /> <w:LsdException Locked="false" Priority="61" SemiHidden="false" UnhideWhenUsed="false" Name="Light List Accent 3" /> <w:LsdException Locked="false" Priority="62" SemiHidden="false" UnhideWhenUsed="false" Name="Light Grid Accent 3" /> <w:LsdException Locked="false" Priority="63" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 1 Accent 3" /> <w:LsdException Locked="false" Priority="64" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 2 Accent 3" /> <w:LsdException Locked="false" Priority="65" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 1 Accent 3" /> <w:LsdException Locked="false" Priority="66" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 2 Accent 3" /> <w:LsdException Locked="false" Priority="67" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 1 Accent 3" /> <w:LsdException Locked="false" Priority="68" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 2 Accent 3" /> <w:LsdException Locked="false" Priority="69" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 3 Accent 3" /> <w:LsdException Locked="false" Priority="70" SemiHidden="false" UnhideWhenUsed="false" Name="Dark List Accent 3" /> <w:LsdException Locked="false" Priority="71" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Shading Accent 3" /> <w:LsdException Locked="false" Priority="72" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful List Accent 3" /> <w:LsdException Locked="false" Priority="73" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Grid Accent 3" /> <w:LsdException Locked="false" Priority="60" SemiHidden="false" UnhideWhenUsed="false" Name="Light Shading Accent 4" /> <w:LsdException Locked="false" Priority="61" SemiHidden="false" UnhideWhenUsed="false" Name="Light List Accent 4" /> <w:LsdException Locked="false" Priority="62" SemiHidden="false" UnhideWhenUsed="false" Name="Light Grid Accent 4" /> <w:LsdException Locked="false" Priority="63" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 1 Accent 4" /> <w:LsdException Locked="false" Priority="64" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 2 Accent 4" /> <w:LsdException Locked="false" Priority="65" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 1 Accent 4" /> <w:LsdException Locked="false" Priority="66" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 2 Accent 4" /> <w:LsdException Locked="false" Priority="67" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 1 Accent 4" /> <w:LsdException Locked="false" Priority="68" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 2 Accent 4" /> <w:LsdException Locked="false" Priority="69" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 3 Accent 4" /> <w:LsdException Locked="false" Priority="70" SemiHidden="false" UnhideWhenUsed="false" Name="Dark List Accent 4" /> <w:LsdException Locked="false" Priority="71" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Shading Accent 4" /> <w:LsdException Locked="false" Priority="72" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful List Accent 4" /> <w:LsdException Locked="false" Priority="73" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Grid Accent 4" /> <w:LsdException Locked="false" Priority="60" SemiHidden="false" UnhideWhenUsed="false" Name="Light Shading Accent 5" /> <w:LsdException Locked="false" Priority="61" SemiHidden="false" UnhideWhenUsed="false" Name="Light List Accent 5" /> <w:LsdException Locked="false" Priority="62" SemiHidden="false" UnhideWhenUsed="false" Name="Light Grid Accent 5" /> <w:LsdException Locked="false" Priority="63" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 1 Accent 5" /> <w:LsdException Locked="false" Priority="64" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 2 Accent 5" /> <w:LsdException Locked="false" Priority="65" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 1 Accent 5" /> <w:LsdException Locked="false" Priority="66" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 2 Accent 5" /> <w:LsdException Locked="false" Priority="67" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 1 Accent 5" /> <w:LsdException Locked="false" Priority="68" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 2 Accent 5" /> <w:LsdException Locked="false" Priority="69" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 3 Accent 5" /> <w:LsdException Locked="false" Priority="70" SemiHidden="false" UnhideWhenUsed="false" Name="Dark List Accent 5" /> <w:LsdException Locked="false" Priority="71" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Shading Accent 5" /> <w:LsdException Locked="false" Priority="72" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful List Accent 5" /> <w:LsdException Locked="false" Priority="73" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Grid Accent 5" /> <w:LsdException Locked="false" Priority="60" SemiHidden="false" UnhideWhenUsed="false" Name="Light Shading Accent 6" /> <w:LsdException Locked="false" Priority="61" SemiHidden="false" UnhideWhenUsed="false" Name="Light List Accent 6" /> <w:LsdException Locked="false" Priority="62" SemiHidden="false" UnhideWhenUsed="false" Name="Light Grid Accent 6" /> <w:LsdException Locked="false" Priority="63" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 1 Accent 6" /> <w:LsdException Locked="false" Priority="64" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 2 Accent 6" /> <w:LsdException Locked="false" Priority="65" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 1 Accent 6" /> <w:LsdException Locked="false" Priority="66" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 2 Accent 6" /> <w:LsdException Locked="false" Priority="67" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 1 Accent 6" /> <w:LsdException Locked="false" Priority="68" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 2 Accent 6" /> <w:LsdException Locked="false" Priority="69" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 3 Accent 6" /> <w:LsdException Locked="false" Priority="70" SemiHidden="false" UnhideWhenUsed="false" Name="Dark List Accent 6" /> <w:LsdException Locked="false" Priority="71" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Shading Accent 6" /> <w:LsdException Locked="false" Priority="72" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful List Accent 6" /> <w:LsdException Locked="false" Priority="73" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Grid Accent 6" /> <w:LsdException Locked="false" Priority="19" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="Subtle Emphasis" /> <w:LsdException Locked="false" Priority="21" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="Intense Emphasis" /> <w:LsdException Locked="false" Priority="31" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="Subtle Reference" /> <w:LsdException Locked="false" Priority="32" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="Intense Reference" /> <w:LsdException Locked="false" Priority="33" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="Book Title" /> <w:LsdException Locked="false" Priority="37" Name="Bibliography" /> <w:LsdException Locked="false" Priority="39" QFormat="true" Name="TOC Heading" /> <\/w:LatentStyles> <\/xml><![endif]--><style type="text/css"> <!-- /* Font Definitions */ @font-face {font-family:"Cambria Math"; panose-1:2 4 5 3 5 4 6 3 2 4; mso-font-charset:1; mso-generic-font-family:roman; mso-font-format:other; mso-font-pitch:variable; mso-font-signature:0 0 0 0 0 0;} @font-face {font-family:Calibri; panose-1:2 15 5 2 2 2 4 3 2 4; mso-font-charset:0; mso-generic-font-family:swiss; mso-font-pitch:variable; mso-font-signature:-1610611985 1073750139 0 0 159 0;} /* Style Definitions */ p.MsoNormal, li.MsoNormal, div.MsoNormal {mso-style-unhide:no; mso-style-qformat:yes; mso-style-parent:""; margin-top:0cm; margin-right:0cm; margin-bottom:10.0pt; margin-left:0cm; line-height:115%; mso-pagination:widow-orphan; font-size:11.0pt; font-family:"Calibri","sans-serif"; mso-fareast-font-family:Calibri; mso-bidi-font-family:"Times New Roman"; mso-fareast-language:EN-US;} .MsoChpDefault {mso-style-type:export-only; mso-default-props:yes; mso-ascii-font-family:Arial; mso-fareast-font-family:Calibri; mso-fareast-theme-font:minor-latin; mso-hansi-font-family:Arial;} .MsoPapDefault {mso-style-type:export-only; margin-top:0cm; margin-right:0cm; margin-bottom:12.0pt; margin-left:64.9pt; text-indent:-64.9pt;} @page Section1 {size:595.3pt 841.9pt; margin:1.0cm 39.7pt 1.0cm 2.0cm; mso-header-margin:1.0cm; mso-footer-margin:1.0cm; mso-paper-source:0;} div.Section1 {page:Section1;} --> <\/style><!--[if gte mso 10]> <style> /* Style Definitions */ table.MsoNormalTable {mso-style-name:"Normaali taulukko"; mso-tstyle-rowband-size:0; mso-tstyle-colband-size:0; mso-style-noshow:yes; mso-style-priority:99; mso-style-qformat:yes; mso-style-parent:""; mso-padding-alt:0cm 5.4pt 0cm 5.4pt; mso-para-margin-top:0cm; mso-para-margin-right:0cm; mso-para-margin-bottom:12.0pt; mso-para-margin-left:64.9pt; text-indent:-64.9pt; mso-pagination:widow-orphan; font-size:11.0pt; font-family:"Calibri","sans-serif"; mso-ascii-font-family:Calibri; mso-ascii-theme-font:minor-latin; mso-fareast-font-family:"Times New Roman"; mso-fareast-theme-font:minor-fareast; mso-hansi-font-family:Calibri; mso-hansi-theme-font:minor-latin; mso-bidi-font-family:"Times New Roman"; mso-bidi-theme-font:minor-bidi;} <\/style> <![endif]--> <\/meta><\/meta><\/meta><\/meta><\/p><p class="MsoNormal"><b style=""><span lang="EN-GB" style="font-size: 14pt; line-height: 115%;">Paikkatietoikkuna / quick guide for map window<o:p><\/o:p><\/span><\/b><\/p> <p class="MsoNormal"><span lang="EN-GB" style="">Paikkatietoikkuna&rsquo;s map window service offers several<br /> different map layers for browsing purposes. The map layers,<br /> produced by various organisations, can be viewed separately<br /> or transparent one on the other in different map scales.<br /> Feature information is available for some data.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="EN-GB" style="">It is possible that the content presented in Paikkatietoikkuna is<br /> protected in accordance with copyright law and international <br />agreements. The user is allowed to print individual maps for <br />private use. Any other copying and reproduction of maps is<br /> prohibited; more information about this in the Terms of Service. <o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><b style=""><span lang="EN-GB" style="">Default view<o:p><\/o:p><\/span><\/b><\/p> <p class="MsoNormal"><span lang="EN-GB" style="">Karttaikkuna&rsquo;s default view features a background map of Finland,<br /> visible in different map scales. The map layer has been &ldquo;dimmed&rdquo;<br /> by adjusting its transparency. If you want, you can adjust the<br /> brightness of the map by clicking and dragging the adjuster<br /> slider in the left lower corner where you can see the <br />&ldquo;Selected map layers&rdquo; in the &ldquo;NLS background maps&rdquo; section. <br />You can always access to the initial state by clicking the<br /> &ldquo;MAP WINDOW&rdquo; tab above the map.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><b style=""><span lang="EN-GB" style="">Navigation<o:p><\/o:p><\/span><\/b><\/p> <p class="MsoNormal"><span lang="EN-GB" style="">The map scale can be adjusted from the map scale bar by <br />clicking plus or minus or the desired point in the map scale bar <br />- or by clicking and dragging the adjuster slider and placing it to<br /> the point of your choice. When the cursor is placed on the map<br /> scale bar, info markers for the map scale are displayed next <br />to the scale bar.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="EN-GB" style="">The map scale can be enlarged (zoomed) by choosing the<br /> magnifying glass tool. By pressing and holding the mouse button,<br /> it is possible to drag a rectangle over the map where the map is<br /> then zoomed to. The map can be zoomed also by double-clicking<br /> it, in which case the cursor point will become the middle point of the map.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="EN-GB" style="">The map can be scrolled in different directions by clicking and<br /> dragging it with the cursor in the direction of your choice. The map<br /> can be scrolled in different directions also by using the arrow keys.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="EN-GB" style="">In the navigation history, it is possible to move back and forward<br /> by clicking the triangular buttons above the map scale bar.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><b style=""><span lang="EN-GB" style="">Place name and address search<o:p><\/o:p><\/span><\/b><\/p> <p class="MsoNormal"><span lang="EN-GB" style="">In the right upper corner of the map window, there is the <br />&ldquo;Find places/addresses&rdquo; field. When typing a place name or an <br />address in the field, a list of search results, according to town<br /> and object type, appears below the search field. By clicking <br />a name on the list, the place will appear as the centre of the map.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="EN-GB" style="">The &ldquo;*&rdquo; mark can be used in the search field at the beginning or<br /> at the end of the text. In this case, the search is for a name that<br /> contains the typed beginning or end. Address number and, if <br />desired, the name of the town can be typed along with the <br />street/road name.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><b style=""><span lang="EN-GB" style="">Selecting the map layer<\/span><\/b><span lang="EN-GB" style=""><o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="EN-GB" style="">Map layer can be selected from the list on the left side. The list<br /> contains different themes (subject matters). By clicking a theme,<br /> such as Geology, a list of available map layers related to the<br /> theme in question opens. Alternatively, a list of the organisations<br /> that produce data opens. By clicking the name of an organisation, <br />a list of the map layers the organisation provides opens. <o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="EN-GB" style="">Map layers can be searched also by typing letters in the search<br /> field above the list, in which case only the map layers with titles<br /> containing the letters in question in consecutive order will be listed.<br /> Resetting the list can be done by clicking the grey &ldquo;x&rdquo; button next<br /> to the search field.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="EN-GB" style="">Map layer is selected by clicking its title or the green &ldquo;+&rdquo; circle, in<br /> which case the title of the map layer appears in the <br />&ldquo;Selected map layers&rdquo; section. The title of the map layer is shown <br />as black text when it is available in the scale of map window, and<br /> as <i style="">grey italics<\/i> when the map layer is not visible in the valid map scale.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="EN-GB" style="">By clicking the blue &ldquo;i&rdquo; circle, the map layer description appears<br /> on the right side of the map.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="EN-GB" style="">Deleting the map layer selection can be done by clicking the <br />red &ldquo;x&rdquo; circle.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><b style=""><span lang="EN-GB" style="">Adjusting the map picture<o:p><\/o:p><\/span><\/b><\/p> <p class="MsoNormal"><span lang="EN-GB" style="">Transparency of the selected map layer can be adjusted in per <br />cents by clicking and dragging the adjuster slider. The map layer<br /> is completely transparent, meaning that it is not visible at all<br /> when it is set for 0% and non-transparent when it is set for 100%.<br /> Some map layers are all-covering, whereas other map layers have<br /> only individual points.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="EN-GB" style="">Map layer can contain many styles, in which case a style menu <br />appears below the transparency adjuster. It is possible to select<br /> one style at a time from the menu. For example the Primar nautical<br /> charts have numerous styles.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="EN-GB" style="">In addition to the transparency adjustment of the map layers, the <br />order of the selected map layers affects to the appearance of the<br /> map picture. The order of the selected map layers can be changed<br /> by clicking the map layer title and dragging it above or below another<br /> layer.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><b style=""><span lang="EN-GB" style="">Measuring<o:p><\/o:p><\/span><\/b><\/p> <p class="MsoNormal"><span lang="EN-GB" style="">Measuring length and area is done by selecting the corresponding<br /> ruler tool.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="EN-GB" style="">To start the measuring of length, you point a starting point and then<br /> a way-point; the end point of the route is pointed with a double click.<br /> The measured length appears as a figure below the map.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="EN-GB" style="">To start the measuring of area, you point one edge point and then <br />the next; the last edge point is pointed with a double click. The area <br />appears as a figure below the map.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><b style=""><span lang="EN-GB" style="">Searching feature information<o:p><\/o:p><\/span><\/b><\/p> <p class="MsoNormal"><span lang="EN-GB" style="">Searching feature information about the objects on the map can be<br /> done by selecting the &ldquo;i arrow&rdquo; tool. In addition, you have to active out<br /> of the selected map layers the one whose feature information you <br />want to view. Activating is done by clicking the map layer, in which case<br /> orange borders appear round the grey box. The search function of the<br /> feature information is available limitedly only for some map layers&rsquo; part<br />, such as for Ancient sites&rsquo;. If the function is not available for the activated <br />map layer, it will be noted in the text appearing on the right side of the map.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="EN-GB" style="">Searching feature information is done by clicking the object on the map.<br /> The information is displayed on the right side of the map. Information <br />about all targets is not necessarily available. <o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><b style=""><span lang="EN-GB" style="">Map link<o:p><\/o:p><\/span><\/b><\/p> <p class="MsoNormal"><span lang="EN-GB" style="">A link can be added to the displayed map picture by clicking the link <br />chain tool. The link can be copied and even sent by e-mail. By clicking<br /> the link, the same map picture, which is visible when creating the link, appears. <o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><b style=""><span lang="EN-GB" style="">Index map<o:p><\/o:p><\/span><\/b><\/p> <p class="MsoNormal"><span lang="EN-GB" style="">The index map can be opened from the right lower corner. The index map<br /> shows the location of the map picture. By clicking the index map,<br /> the map window shows the pointed place.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><b style=""><span lang="EN-GB" style="">Big map window<o:p><\/o:p><\/span><\/b><\/p> <p class="MsoNormal"><span lang="EN-GB" style="">It is possible to open from the right upper corner a big map window, <br />which fills the whole browser window. By clicking the same button<br /> again, the map window is restored to its original size. <o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><b style=""><span lang="EN-GB" style="">Adjusting the left and the right column<o:p><\/o:p><\/span><\/b><\/p> <p class="MsoNormal"><span lang="EN-GB" style="">Adjusting the width of the columns on the left and the right side of the <br />map window can be done by clicking and dragging the edge of the<br /> column. The column can be closed by clicking the double arrow<br /> button on top of the column and opened/closed by clicking the<br /> diminutive triangle in the middle of the column edge.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="EN-GB" style=""><o:p>&nbsp;<\/o:p><\/span><\/p><p>&nbsp;<\/p>',"show-date":"true",e:"","link-to-page":"",theme:"",n:"","verkkopositio-issue":"",title:"Map window quick guide","link-url":"","link-text":"",producer:"",paivamaara:"","small-image":""},id:"127279"}]}});Oskari.registerLocalization({lang:"es",key:"userinterface.UserGuide",value:{title:"Ayuda",desc:"",flyout:{title:"Gua de usuario de Oskari"},tile:{title:"Gua de usuario del mapa"},error:{title:"Error!",generic:"Fallo al cargar la gua de usuario. Por favor, intntelo ms tarde."},help:{tags:"NOT TRANSLATED",contentPart:"NOT TRANSLATED"}}});Oskari.registerLocalization({lang:"et",key:"userinterface.UserGuide",value:{title:"Abi",desc:"",flyout:{title:"Oskari kasutusjuhend"},tile:{title:"Kaardi kasutusjuhend"},error:{title:"Viga!",generic:"Kasutusjuhendi laadimine ebannestus. Palun proovi hiljem uuesti."},help:{tags:"map window,user guide",contentPart:"body"}}});Oskari.registerLocalization({lang:"fi",key:"userinterface.UserGuide",value:{title:"Ohje",desc:"",flyout:{title:"Kartan ohje"},tile:{title:"Kartan ohje"},error:{title:"Virhe!",generic:"Ohjeen lataaminen eponnistui. Yrit myhemmin uudelleen."},help:{tags:"karttaikkuna,pikaohje",contentPart:"body"},articles:[{content:{abstract:"<p><\/p>",body:'<p>Tm ohje esittelee Lupapisteen karttaikkunan ja sen toiminnot. Karttaikkunassa kokoat paikkatietoaineistoista karttankymi ja tarkastelet aineistoja avaamalla karttatasoja erikseen tai lpinkyvin pllekkin. Tm ohje opastaa kartan kytn periaatteisiin ja tarjoaa opastusta eri tilanteisiin.<\/p><h3>Perusksitteet lyhyesti<\/h3><p>Karttaikkunassa voit muokata omaa karttankym erilaisista kartta-aineistoista eli karttatasoista.<\/p><h2>Kartan kytt<\/h2><p>Kartta muodostuu erilaisista karttatasoista, joita viranomaiset ja  palveluntarjoaja ovat julkaisseet Lupapisteeseen. Lupapisteess hankkeen sijainti mritetn osoittamalla se Aloitusnkymn kartalta:<br/><img style="max-width: 650px;" src="img/userguide/fi/1.png" alt="Aloitusnkym"/><br/>Lupapisteess neuvontapyynnn tai lupahakemuksen tekeminen aloitetaan osoittamalla sijainti kartalta.<br/><img style="max-width: 650px;" src="img/userguide/fi/2.png" alt="Uusi hanke"/><br/>Hae osoitteella ja tarkista, ett kiinteisttunnus on oikein. Karttaa klikkaamalla voit tarkentaa sijaintia.<br/>Hakemusnkymss on pieni kuvakekartta:<br/><img style="max-width: 650px;" src="img/userguide/fi/3.png" alt="Kuvakekartta"/><br/>Suurempi kartta avataan pienen kartan suurennuslasi-kuvaketta painamalla.<\/p><h3>Tykalut<\/h3><p>Lupapisteen karttankymn avautuvat oletuksena seuraavissa luvuissa esiteltvt tykalut ja karttatasot.<br/>Lupapiste-kartassa on kytss seuraavat tykalut ja valikot:<br/><img style="max-width: 650px;" src="img/userguide/fi/4.png" alt="Valikko"/><br/><img style="max-width: 650px;" src="img/userguide/fi/5.png" alt="Mittakaavapalkki"/><br/><\/p><h3>Perustoiminnot<\/h3><p><b>Siirr kartta<\/b> haluamaasi sijaintiin raahaamalla karttaa ksi-tykalulla.<br/><b>Lhenn ja loitonna<\/b> halutulle mittakaavatasolle askel kerrallaan painelemalla + ja - -merkkej mittakaavastimess tai siirry suoraan halutulle tasolle mittakaavastimell, joka sijaitsee kartan oikeassa reunassa.<br/><b>Kohteet<\/b> kartalla voivat tietyiss karttatasoissa sislt ominaisuustietoja. Klikkaamalla kohdetta saat kohteen tiedot nkyviin.<br/><b>Mittakaavajana<\/b> sijaitsee kartan vasemassa alakulmassa.<br/><\/p><h3>Valikot<\/h3><p><b>Karttatasot<\/b>-valikosta net, mit aineistoja karttankymss nkyy parhaillaan. Voit st karttatasojen jrjestyst, lpinkyvyytt tai poistaa niit. Valikon nimest net, kuinka monta tasoa on valittuna karttaikkunaan.<br/><b>Kartan ohje<\/b>-valikon alta avautuu tm ohje.<br/><img style="max-width: 650px;" src="img/userguide/fi/6.png" alt="Tykalut"/><br/><\/p><h2>Karttankym<\/h2><p>Muokkaa omaa karttankym valitsemalla karttatasoja Karttatasot -valikosta. Valikossa voit muuttaa tasojen jrjestyst raahaamalla ne haluamaasi jrjestykseen, sek st tason lpinkyvyytt. Tason kohdalla olevasta Piilota-linkist, saat kyseisen tason pois nkyvist. Joillakin karttatasoilla aineisto nkyy vasta kun olet siirtynyt sopivalle mittakaavatasolle, joidenkin tasojen aineisto kattaa vain pienen osan Suomea.<br/><img style="max-width: 650px;" src="img/userguide/fi/7.png" alt="Karttatasot"/><br/><\/p><h2>Omat kohteet<\/h2><p>Tiettyjen lupatyyppien yhteydess voit list kartalle omia kohteita. Kohde voi olla muodoltaan piste, viiva tai alue, jolla on nimi ja kuvaus. Kun kohde on piirretty, klikkaa "Valmis", tallentaaksesi sen kartan valikon kohtaan Omat tiedot. Omien kohteiden muokkaaminen ja poistaminen onnistuu vain kyseisell hakemuksella, kun olet rekisteritynyt ja kirjautunut palveluun.<br/><p><b>Mist omat kohteet lytyvt?<\/b><br/>Kohteet tallentuvat Omat tiedot -valikkoon.<\/p><p><b>Oman kohteen katseleminen ja tietojen muokkaaminen<\/b><br/>Saat oman kohteen nkyviin klikkaamalla sen nime Omissa tiedoissa, jolloin kartta kohdentuu ja kohde korostuu. Sen jlkeen voit muokata kohteen tietoja valikossa, joka avautuu tuplaklikkaamalla kohdetta.<\/p><p><b>Oman kohteen poistaminen<\/b><br/>Poista oma kohde karttatasolta valitsemalla kohde Omat tiedot valikosta, tuplaklikkaa kohdetta kartalla ja valitse Poista avautuvasta valikosta.<\/p><img style="max-width: 650px;" src="img/userguide/fi/8.png" alt="Omat kohteet"/><br/>Muokatessasi kohteen tietoja voit muuttaa sen nime, kuvausta ja mittoja. Muista tallentaa muutokset. Voit mys poistaa kohteen.<\/p><h2>Rekisterityminen, omat kyttjtiedot ja salasana<\/h2><p>Kartan kyttminen edellytt kirjautumista Lupapisteeseen. Voit muuttaa kyttjtietojasi ja salasanaasi Lupapisteen psivulla sivun yllaidassa klikkaamalla kyttjnime palveluun kirjauduttuasi.<\/p>',title:"Karttaikkunan kyttohje","link-url":"","link-to-page":"",Blue_Subject:"",Intro:"","small-image":""},id:"127227"}]}});Oskari.registerLocalization({lang:"gr",key:"userinterface.UserGuide",value:{title:"",desc:"",flyout:{title:"  OSKARI"},tile:{title:"  "},error:{title:"!",generic:"     .    ."},help:{tags:"map window,user guide",contentPart:"body"}}});Oskari.registerLocalization({lang:"hr",key:"userinterface.UserGuide",value:{title:"Pomo",desc:"",flyout:{title:"Oskari vodi za upotrebu"},tile:{title:"Vodi za upotrebu karte"},error:{title:"Greka!",generic:"Greka u uitavanju vodia za upotrebu. Pokuajte kasnije."},help:{tags:"map window,user guide",contentPart:"body"}}});Oskari.registerLocalization({lang:"hu",key:"userinterface.UserGuide",value:{title:"Segtsg",desc:"",flyout:{title:"Oskari hasznlati tmutat"},tile:{title:"Trkpkezelsi tmutat"},error:{title:"Hiba!",generic:"Hasznlati tmutat betltse sikertelen. Krem prblja ksbb."},help:{tags:"NOT TRANSLATED",contentPart:"NOT TRANSLATED"}}});Oskari.registerLocalization({lang:"lv",key:"userinterface.UserGuide",value:{title:"Paldzba",desc:"",flyout:{title:'"Oskari" lietotja rokasgrmata'},tile:{title:"Kartes lietotja rokasgrmata"},error:{title:"Kda!",generic:"Lietotja rokasgrmatu atvrt neizdevs. Ldzu miniet vlk."},help:{tags:"NOT TRANSLATED",contentPart:"NOT TRANSLATED"}}});Oskari.registerLocalization({lang:"nl",key:"userinterface.UserGuide",value:{title:"Help",desc:"",flyout:{title:"Oskari gebruikershandleiding"},tile:{title:"Kaart gebruikershandleiding"},error:{title:"Fout!",generic:"Laden gebruikershandleiding is mislukt. Probeer het later opnieuw."},help:{tags:"map window,user guide",contentPart:"body"}}});Oskari.registerLocalization({lang:"pl",key:"userinterface.UserGuide",value:{title:"Pomoc",desc:"",flyout:{title:"Oskari instrukcja uytkownika"},tile:{title:"Instrukcja korzystania z mapy"},error:{title:"Bd!",generic:"Pobranie instrukcji uytkownika nie powiodo si. Sprbuj ponownie pniej."},help:{tags:"map window,user guide",contentPart:"body"}}});Oskari.registerLocalization({lang:"pt",key:"userinterface.UserGuide",value:{title:"Ajuda",desc:"",flyout:{title:"Guia do utilizador do Oskari"},tile:{title:"Guia do utilizador da cartografia"},error:{title:"Erro!",generic:"Falha no carregamento do guia do utilizador. Por favor tente mais tarde"},help:{tags:"vista, guia do utilizador",contentPart:"corpo"}}});Oskari.registerLocalization({lang:"sl",key:"userinterface.UserGuide",value:{title:"Pomo",desc:"",flyout:{title:"Oskari uporabniki prironik"},tile:{title:"Uporabniki prironik za karto"},error:{title:"Napaka!",generic:"Nalaganje uporabnikega prironika ni uspelo. Prosim poskusi kasneje."},help:{tags:"NOT TRANSLATED",contentPart:"NOT TRANSLATED"}}});Oskari.registerLocalization({lang:"sk",key:"userinterface.UserGuide",value:{title:"Pomocnk",desc:"",flyout:{title:"Nvod na obsluhu pre Oskari"},tile:{title:"Nvod na obsluhu pre mapu"},error:{title:"Chyba!",generic:"Natavanie nvodu na obsluhu zlyhalo. Skste neskr, prosm."},help:{tags:"NOT TRANSLATED",contentPart:"NOT TRANSLATED"}}});Oskari.registerLocalization({lang:"sq",key:"userinterface.UserGuide",value:{title:"Ndihm",desc:"",flyout:{title:"Udhzues i prdoruesit Oskari"},tile:{title:"Harta udhzuese t prdoruesit"},error:{title:"Gabim!",generic:"Dshtoi ngarkimi i udhzuesit t prdoruesit. Ju lutem provoni m von."},help:{tags:"NOT TRANSLATED",contentPart:"NOT TRANSLATED"}}});Oskari.registerLocalization({lang:"sv",key:"userinterface.UserGuide",value:{title:"Hjlp",desc:"",flyout:{title:"S hr anvnder du Paikkatietoikkuna"},tile:{title:"Bruksanvisningar"},error:{title:"Fel!",generic:"Laddningen av anvisningarna misslyckades. Frsk p nytt senare."},help:{tags:"kartfnstret,snappguide",contentPart:"body"},articles:[{content:{abstract:"<p> Paikkatietoikkuna r en tjnst, dr vem som helst kan blddra bland geodataprodukter och anvnda geodatatjnster som flera olika organisationer har producerat.<\/p>",body:'<p> I dessa anvisningar presenteras kartfnstret och dess funktioner. I <a href="/web/sv/kartfonstret">Kartfnstret<\/a> kan du stta ihop flera geodatamngder till kartvyer och blddra i datamaterialet genom att ppna ett kartlager skilt fr sig eller flera genomskinliga lager p varandra, inbdda dem p din egen hemsida eller skicka en lnk till din kartvy till anvndare som inte r med i tjnsten. I dessa anvisningar fr du rd om principerna fr hur du kan anvnda kartorna. Dessutom finns situationsanpassad hjlp att tillg i kartfnstret.<\/p> <p> <strong><a name="Innehallsforteckning"><\/a>Innehllsfrteckning:<\/strong><br /> - <a href="#Kort-om-grundbegreppen">Kort om grundbegreppen<\/a><br /> - <a href="#Sa-har-anvander-du-kartan">S hr anvnder du kartan och dess verktyg<\/a><br /> - <a href="#Kartvy">S hr skapar och lagrar du en kartvy samt skickar lnk<\/a><br /> - <a href="#sa-har-inbaddar-du-en-kartvy">S hr inbddar du en kartvy<\/a><br /> - <a href="#mina-objekt">Mina objekt<\/a><br /> - <a href="#mina-kartlager">Mina kartlager<\/a><br /> - <a href="#Registrering-etc">Registrering, anvndaruppgifter och lsenord<\/a><\/p> <p> <strong>Mera information:<\/strong><br /> - <a href="/web/sv/information-om-paikkatietoikkuna/">Kort om Paikkatietoikkuna<\/a><br /> - <a href="/web/sv/webbtjanstavtal/">Webbtjnstavtal fr frmedling av geodata via Paikkatietoikkuna<\/a><\/p> <h2> <a name="Kort-om-grundbegreppen"><\/a>Kort om grundbegreppen<\/h2> <p> <img alt="" src="img/userguide/sv/0e112c69-eab1-43a7-987d-c7034544206a.png" style="width: 372px; height: 238px; float: right;" />I Paikkatietoikkuna kan du sjlv sammanstlla kartvyer utgende frn olika kartmaterial, dvs. kartlager.<br /> Kartlagret kan du:<\/p> <ol> <li> lagra fr att studera den senare<\/li> <li> skicka till andra som en lnk<\/li> <li> inbdda i din egen webbtjnst<\/li> <\/ol> <p> <a href="#Innehallsforteckning">Till innehllsfrteckningen<\/a><\/p> <h2> <a name="Sa-har-anvander-du-kartan"><\/a>S hr anvnder du kartan<\/h2> <p> Kartorna bestr av olika kartlager som myndigheter och privatpersoner har gjort tillgngliga i Paikkati-etoikkuna. Nr du ppnar Paikkatietoikkuna, ser du frst standardvyn. Om du kom till Paikkatietoikku-na via en lnk, ser du en kartvy som ngon annan har satt ihop. Du kan nr som helst "nollstlla kartan" och tervnda till startvyn med funktionen terstll startlget, som du hittar bland verktygen nere till vnster samt i mitten av panoreringspilarna.<\/p> <h3> Basfunktioner<\/h3> <p> <strong>Flytta p kartvyn<\/strong> genom att klicka och dra p kartan eller med hjlp av panoreringspilarna. Anvnd skfunktionen om du vill hitta ngot bestmt objekt p kartan.<\/p> <p> <strong>Zooma in och ut<\/strong> tills du nr nskad skalniv genom att klicka p tecknen + och - i nrheten av skalans glidreglage, eller anvnd glidreglaget fr att direkt visa kartan i nskad skala.<\/p> <p> <strong>Koordinaterna <\/strong>bestms av muspekarens lge p kartan.<\/p> <p> <strong>Indexkartan <\/strong>visar kartvyn i en mindre skala. Du kan visa och dlja indexkartan genom att klicka p kartfnstrets nedre hgra hrn.<\/p> <p> <strong>Objekt<\/strong> p kartan innehller ofta tillggsuppgifter. Genom att klicka p ett objekt kan du se dess tillggsuppgifter. Nr du studerar en dataprodukt kan du se objekten som ingr i omrdet som kartan visar p en lista. Du kan vlja vissa objekt enligt egna villkor frn dataprodukterna. Du kan se listan genom att klicka p lnken Objektuppgifter till hger om kartan.<\/p> <h3> <img alt="" src="img/userguide/sv/59b4d334-b266-4d00-b63d-0fc59b7cc405.png" style="width: 719px; height: 447px;" /><br /> &nbsp;<br /> Menyer<\/h3> <p> I menyn <strong>Sk <\/strong>kan du ska med ortnamn och visa den nskade platsen p kartan.<br /> I menyn <strong>Kartlager <\/strong>kan du ska och blddra i datamngder frn olika dataproducenter. Datamngderna har sorterats enligt tema och dataproducent. Materialen frdelas i:<br /> &nbsp;&nbsp;&nbsp; Kartlager<img alt="" src="img/userguide/278431.png" style="width: 16px; height: 16px; float: left;" /><br /> &nbsp;&nbsp;&nbsp; Bakgrundskarta<img alt="" src="img/userguide/278435.png" style="width: 16px; height: 16px; float: left;" /><br /> &nbsp;&nbsp;&nbsp; Dataprodukt frn sktjnst<img alt="" src="img/userguide/278425.png" style="width: 16px; height: 16px; float: left;" /><\/p> <p> Om symbolen r gr syns den valda datamngden inte p den skalniv du valt. Nr du vljer en data-produkt, syns lnken Objektuppgifter till hger om kartan. Genom att klicka p lnken kan du se en lista ver objektuppgifter p kartfnstrets omrde.<\/p> <p> I menyn <strong>Valda kartlager<\/strong> finns uppgifter om de datamngder som visas i kartvyn som bst. Du kan ndra kartlagrens ordning, gra dem mer eller mindre genomskinliga eller ta bort dem. I en bubbla i menyns hgra kant ser du hur mnga niver som visas i kartfnstret.<\/p> <p> I menyn <strong>Mina Uppgifter<\/strong> lagras alla <a href="#mina-objekt">Mina objekt<\/a>, <a href="#sa-har-inbaddar-du-en-kartvy">Mina vyer<\/a> (se verktygen nedan) och kartorna som du har avskilt och inbddat p din webbplats. Hr kan du ven terta inbddandet av kartor. Via menyn fr du tillgng till dina anvndaruppgifter och kan ndra p dem. Dessa uppgifter visas nr du har loggat in i Paikkatietoikkuna.<\/p> <p> I menyn <strong>Skapa karta<\/strong> kan du skapa koden till den kartvy som du har satt ihop. Med hjlp av koden kan du inbdda kartan p din egen eller ditt fretags webbplats. Du fr tillgng till funktionen genom att logga in i tjnsten.<\/p> <p> I menyn <strong>Teckenfrklaring<\/strong> ingr en beskrivning av de karttecken som anvnds p kartlagren.<\/p> <p> I menyn <strong>Bruksanvisningar <\/strong>finns dessa anvisningar. Om du behver mera hjlp kan du klicka p i-tecknet eller lnkar till ytterligare information.<\/p> <p> Mrk, att d du ndrar p ngot i kartvyn kan du alltid terg till startlget, terkalla en ndring eller gra den p nytt. Dessa verktyg finns vnster om kartan under menyerna (se Verktyg).<\/p> <h3> Verktyg<\/h3> <p> <img alt="" src="img/userguide/sv/f302316a-4231-4325-aa6e-5b063305c6fb.png" style="width: 719px; height: 234px;" /><\/p> <p> <a href="#Innehallsforteckning">Till innehllsfrteckningen<\/a><\/p> <h2> <a name="Kartvy"><\/a>Kartvy<\/h2> <p> Skapa din egen kartvy genom att vlja kartvyer i menyn <em>Kartlager <\/em>eller bland de kartlager som du har lagrat i <em>Mina uppgifter<\/em>. I menyn <em>Valda kartlager<\/em> kan du ndra p kartlagrens ordning genom att klicka och dra dem, samt ndra deras genomskinlighet med hjlp av ett glidreglage.<\/p> <p> <strong>S hr stter du ihop en kartvy:<\/strong><\/p> <ol> <li> Vlj kartlagren som du vill visa i menyn <em>Kartlager<\/em><\/li> <li> I menyn <em>Valda kartlager<\/em> kan du ndra p kartlagrens ordning genom att klicka och dra dem till nskat stlle och vid behov justera deras genomskinlighet<\/li> <\/ol> <p> <strong>S hr lagrar du en kartvy<\/strong><br /> Du kan lagra en kartvy med verktyget <em>Lagra<\/em>. I <em>Mina kartvyer<\/em> lagras uppgifter om de kartlager som du valt, deras ordningsfljd och genomskinlighet, vilket omrde som visas p kartan samt skalniv. Kart-lagren som du har lagrat visas p fliken <em>Mina kartvyer<\/em> i <em>Mina uppgifter<\/em>.<\/p> <p> <strong>Skicka lnk till kartvy<\/strong><br /> Du fr en direkt lnk till en kartvy som du har satt ihop genom att klicka p verktyget <em>Skicka lnk<\/em>. Med hjlp av lnken kan du distribuera vyn till andra internetanvndare. Mrk, att du tillsvidare inte kan distribuera dina egna objekt eller kartniver.<\/p> <p> <strong>Se ven:<\/strong><br /> - <a href="#mina-kartlager">Mina kartlager<\/a><br /> - <a href="#Sa-har-anvander-du-kartan">Kartans anvndning och funktioner<\/a><\/p> <p> <img alt="" src="img/userguide/sv/0a90726a-2bb7-4d69-8165-1495d6b67745.png" style="width: 611px; height: 354px;" /><\/p> <p> Bild: Vlj vilka kartlager som visas i menyn <em>Kartlager<\/em>.<\/p> <p> <img alt="" src="img/userguide/sv/6b4aa26c-df4b-4959-8ecc-266dfdddaf59.png" style="width: 719px; height: 276px;" /><\/p> <p> Bild: I menyn <em>Valda kartlager<\/em> kan du vlja, dlja och ta bort kartlager, justera genomskinligheten och se kartans status. P vissa kartlager syns datamaterialet frst nr du har gtt till en lmplig skalniv, p andra tcker datamaterialet endast en liten del av Finland. Vissa datamaterial fr inte publiceras p din egen webbplats, men du kan studera dem i Paikkatietoikkuna.<\/p> <p> <img alt="" src="img/userguide/sv/2d27d20a-a6bb-4756-8d82-0703b644becd.png" style="width: 719px; height: 72px;" /><br /> &nbsp;<br /> Bild: Du kan lagra, distribuera och skriva ut en kartvy med hjlp av verktyg.<\/p> <p> <a href="#Innehallsforteckning">Till innehllsfrteckningen<\/a><\/p> <h2> <a name="sa-har-inbaddar-du-en-kartvy"><\/a>S hr inbddar du en kartvy<\/h2> <p> Du kan inbdda den kartvy som du har satt ihop p din webbplats genom att kopiera och klistra en bit html-kod. Brja med att klicka menyn<em> Skapa karta<\/em>. Funktionen r tillgnglig nr du har loggat in i Paikkatietoikkuna. <a href="/web/sv/login/">Logga in<\/a> eller Registrera (linkki) dig som anvndare i tjnsten.<\/p> <p> Nr du skapar din karta ger du kartan ett namn och vljer dess storlek, samt anger webbplatsen dr kar-tan ska inbddas. Du kan ven vlja verktygen som visas i det inbddade kartfnstret, exempelvis skalans glidreglage och skfunktionen.<\/p> <p> Till slut fr du ngra rader html-kod som du ska kopiera och klistra p den webbsida dr du vill att kar-tan ska visas.<\/p> <p> <strong>ndra kartlager i en inbddad karta<\/strong><br /> Tillsvidare kan man inte editera en inbddad karta i Paikkatietoikkuna. Om du vill ndra p kartniverna mste du skapa en ny karta och inbdda den p nytt:<\/p> <ol> <li> ppna den inbddade kartan som du vill editera i Paikkatietoikkuna genom att klicka p kartans namn i listan ver inbddade kartor (menyn <em>Mina uppgifter<\/em>).<\/li> <li> Inbdda kartan p nytt.<\/li> <li> Kopiera och klistra den nya html-koden p din webbplats.<\/li> <\/ol> <p> <img alt="" src="img/userguide/sv/11c46548-4b03-475c-8967-6a47306f629c.png" style="width: 719px; height: 373px;" /><br /> Bild: Med funktionen <em>Kartlager <\/em>kan du definiera en eller flera alternativa kartbottnar, som anvndaren kan visa i tur och ordning (t.ex. en flygbild och en bakgrundskarta). Anvndaren ser alltid ngon av de valda kartbottnarna. Bakgrundskartan och Ortofotona r bra kartbottnar. Du kan se hur funktionen fungerar p den frhandsvisade kartan direkt.<\/p> <p> <em>Tips: Om du visar menyn Kartlager p din karta, kan du ppna den genom att klicka p den frhandsvisade kartan, och vlja vilket kartbotten som ska visas som standardinstllning<\/em>.<\/p> <p> <a href="#Innehallsforteckning">Till innehllsfrteckningen<\/a><\/p> <h2> <a name="mina-objekt"><\/a>Mina objekt<\/h2> <p> Du kan placera dina egna objekt p kartan i Paikkatietoikkuna. Objektet kan vara en punkt, en rutt eller ett omrde som har ett namn och en beskrivning. Nr du har mrkt ut objektet kan du klicka "Frdig" och lagra den p ngot av dina kartlager eller p ett nytt kartlager. Med hjlp av olika kartlager kan du gra en sammanstllning av olika objekt inom samma tema. Du mste vara inloggad i Paikkatietoikkuna fr att kunna lagra, editera och ta bort dina egna objekt. <a href="/web/sv/login/">Logga in<\/a> eller Registrera (linkki) dig som anvndare i tjnsten.<\/p> <p> <strong>Var finns mina objekt?<\/strong><br /> Objekten lagras i menyn <em>Mina uppgifter<\/em> p fliken <em>Mina objekt<\/em>.<br /> <br /> <strong>Hur kan jag se mina objekt?<\/strong><br /> Du kan se ett objekt genom att klicka p dess namn p fliken <em>Mina objekt<\/em>.<br /> <br /> <strong>Hur kan jag distribuera mina objekt?<\/strong><br /> Tillsvidare kan du inte distribuera dina objekt till andra internetanvndare.<br /> <br /> <strong>Hur kan jag editera mina objekt?<\/strong><br /> Editera objektsuppgifterna fr ett objekt med hjlp av funktionen <em>Editera<\/em>.<br /> <br /> <strong>Hur kan jag ta bort ett av mina objekt?<\/strong><br /> Med hjlp av funktionen <strong>Ta bort<\/strong> kan du ta bort dina egna objekt frn ett kartlager.<br /> <br /> <strong>Se ven:<\/strong><br /> - <a href="#mina-kartlager">Mina kartlager<\/a><\/p> <p> <img alt="" src="img/userguide/sv/95abfe6f-758e-40d0-8f32-afe7ca209ecf.png" style="width: 719px; height: 423px;" /><br /> Bild: Du hittar de objekt som du har lagrat i menyn <em>Mina uppgifter<\/em> p fliken<em> Mina objekt<\/em>. Nr du klickar p objektets namn flyttas kartvyn till objektet.<\/p> <p> <img alt="" src="img/userguide/sv/7268107a-dcee-4684-ac0a-349d45d5c3cc.png" style="width: 611px; height: 342px;" /><br /> Bild: Genom att editera uppgifterna om objektet kan du ndra dess namn, beskrivning och lge samt flytta den frn ett kartlager till ett annat. Du kan editera objektets still p fliken <em>Mina objekt<\/em> nr du vljer funktionen <em>Editera kartlager<\/em>.<\/p> <p> <a href="#Innehallsforteckning">Till innehllsfrteckningen<\/a><\/p> <h2> <a name="mina-kartlager"><\/a>Mina kartlager<\/h2> <p> Du kan lagra objekt p dina egna kartlager. Med hjlp av olika kartlager kan du skilja mellan olika teman. Dina Kartlager finns p fliken <em>Mina objekt<\/em> i menyn <em>Mina uppgifter<\/em>.<\/p> <p> <strong>S hr skapar du en ny kartvy<\/strong><br /> Du skapar en ny kartvy nr du lagrar eller editerar ett objekt. (Du kan lagra objekt nr du r inloggad i Paikkatietoikkuna.)<\/p> <p> <strong>Blddra i dina kartlager<\/strong><br /> En kartniv visas nr du klickar p ngot objekt i listan <em>Mina objekt<\/em> eller genom att bocka rutan fr kartlagret i kategorin "Mina objekt" i menyn <em>Kartlager<\/em>.<\/p> <p> <strong>S hr editerar du dina kartlager och tar bort dem<\/strong><br /> ndra kartlagrets namn och frg genom att klicka p lnken <em>Editera<\/em>.<\/p> <p> <strong>Privata kartlager<\/strong><br /> Standardinstllningen fr dina egna kartlager och objekten som ingr i dem r privat.<\/p> <p> <strong>Kan jag publicera mina kartlager?<\/strong><br /> Tillsvidare r det inte mjligt att publicera egna kartlager.<\/p> <p> <img alt="" src="img/userguide/sv/8c2acb3a-5049-445a-a584-8498103f9f91.png" style="width: 719px; height: 423px;" /><br /> Bild: P fliken Mina objekt kan du <em>editera kartlagrets<\/em> namn och frg samt vid behov<em> ta bort kartlager<\/em>.<\/p> <p> <a href="#Innehallsforteckning">Till innehllsfrteckningen<\/a><\/p> <h3> <a name="Registrering-etc"><\/a>Registrering, anvndaruppgifter och lsenord<\/h3> <p> Mnga funktioner i kartfnstret krver att du r inloggad i Paikkatietoikkuna. Efter inloggning kan du ndra dina anvndaruppgifter och ditt lsenord genom att klicka p ditt anvndarnamn som visas verst p sidan.<br /> - <a href="/web/sv/login/">Logga in i tjnsten<\/a><br /> - <a href="/web/sv/profil">Editera dina anvndaruppgifter och byt lsenord<\/a><br /> - <a href="/web/sv/login?p_p_id=58&amp;p_p_lifecycle=0&amp;p_p_state=normal&amp;p_p_mode=view&amp;p_p_col_id=column-1&amp;p_p_col_count=1&amp;_58_struts_action=%2Flogin%2Fforgot_password">Jag har glmt mitt lsenord<\/a><br /> - <a href="/web/sv/login?p_p_id=58&amp;p_p_lifecycle=1&amp;p_p_state=maximized&amp;p_p_mode=view&amp;p_p_col_id=column-1&amp;p_p_col_count=1&amp;saveLastPath=0&amp;_58_struts_action=%2Flogin%2Fcreate_account">Registrera dig som anvndare<\/a><\/p> <p> <a href="#Innehallsforteckning">Till innehllsfrteckningen<\/a><\/p>',title:"Bruksanvisningar - kartfnstret","link-url":"","link-to-page":"",Blue_Subject:"",Intro:"Paikkatietoikkuna r en tjnst, dr vem som helst kan blddra bland geodataprodukter och anvnda geodatatjnster som flera olika organisationer har producerat.","small-image":""},id:"315140"},{content:{abstract:"",body:'<p><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="ProgId" content="Word.Document"><meta name="Generator" content="Microsoft Word 12"><meta name="Originator" content="Microsoft Word 12"><link rel="File-List" href="file:///C:\\TEMP\\msohtmlclip1\\01\\clip_filelist.xml" /><link rel="themeData" href="file:///C:\\TEMP\\msohtmlclip1\\01\\clip_themedata.thmx" /><link rel="colorSchemeMapping" href="file:///C:\\TEMP\\msohtmlclip1\\01\\clip_colorschememapping.xml" /><!--[if gte mso 9]><xml> <w:WordDocument> <w:View>Normal<\/w:View> <w:Zoom>0<\/w:Zoom> <w:TrackMoves /> <w:TrackFormatting /> <w:DoNotShowRevisions /> <w:DoNotPrintRevisions /> <w:DoNotShowMarkup /> <w:DoNotShowComments /> <w:DoNotShowInsertionsAndDeletions /> <w:DoNotShowPropertyChanges /> <w:HyphenationZone>21<\/w:HyphenationZone> <w:PunctuationKerning /> <w:ValidateAgainstSchemas /> <w:SaveIfXMLInvalid>false<\/w:SaveIfXMLInvalid> <w:IgnoreMixedContent>false<\/w:IgnoreMixedContent> <w:AlwaysShowPlaceholderText>false<\/w:AlwaysShowPlaceholderText> <w:DoNotPromoteQF /> <w:LidThemeOther>FI<\/w:LidThemeOther> <w:LidThemeAsian>X-NONE<\/w:LidThemeAsian> <w:LidThemeComplexScript>X-NONE<\/w:LidThemeComplexScript> <w:Compatibility> <w:BreakWrappedTables /> <w:SnapToGridInCell /> <w:WrapTextWithPunct /> <w:UseAsianBreakRules /> <w:DontGrowAutofit /> <w:SplitPgBreakAndParaMark /> <w:DontVertAlignCellWithSp /> <w:DontBreakConstrainedForcedTables /> <w:DontVertAlignInTxbx /> <w:Word11KerningPairs /> <w:CachedColBalance /> <\/w:Compatibility> <m:mathPr> <m:mathFont m:val="Cambria Math" /> <m:brkBin m:val="before" /> <m:brkBinSub m:val="&#45;-" /> <m:smallFrac m:val="off" /> <m:dispDef /> <m:lMargin m:val="0" /> <m:rMargin m:val="0" /> <m:defJc m:val="centerGroup" /> <m:wrapIndent m:val="1440" /> <m:intLim m:val="subSup" /> <m:naryLim m:val="undOvr" /> <\/m:mathPr><\/w:WordDocument> <\/xml><![endif]--><!--[if gte mso 9]><xml> <w:LatentStyles DefLockedState="false" DefUnhideWhenUsed="true" DefSemiHidden="true" DefQFormat="false" DefPriority="99" LatentStyleCount="267"> <w:LsdException Locked="false" Priority="0" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="Normal" /> <w:LsdException Locked="false" Priority="9" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="heading 1" /> <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 2" /> <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 3" /> <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 4" /> <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 5" /> <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 6" /> <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 7" /> <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 8" /> <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 9" /> <w:LsdException Locked="false" Priority="39" Name="toc 1" /> <w:LsdException Locked="false" Priority="39" Name="toc 2" /> <w:LsdException Locked="false" Priority="39" Name="toc 3" /> <w:LsdException Locked="false" Priority="39" Name="toc 4" /> <w:LsdException Locked="false" Priority="39" Name="toc 5" /> <w:LsdException Locked="false" Priority="39" Name="toc 6" /> <w:LsdException Locked="false" Priority="39" Name="toc 7" /> <w:LsdException Locked="false" Priority="39" Name="toc 8" /> <w:LsdException Locked="false" Priority="39" Name="toc 9" /> <w:LsdException Locked="false" Priority="35" QFormat="true" Name="caption" /> <w:LsdException Locked="false" Priority="10" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="Title" /> <w:LsdException Locked="false" Priority="1" Name="Default Paragraph Font" /> <w:LsdException Locked="false" Priority="11" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="Subtitle" /> <w:LsdException Locked="false" Priority="22" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="Strong" /> <w:LsdException Locked="false" Priority="20" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="Emphasis" /> <w:LsdException Locked="false" Priority="59" SemiHidden="false" UnhideWhenUsed="false" Name="Table Grid" /> <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Placeholder Text" /> <w:LsdException Locked="false" Priority="1" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="No Spacing" /> <w:LsdException Locked="false" Priority="60" SemiHidden="false" UnhideWhenUsed="false" Name="Light Shading" /> <w:LsdException Locked="false" Priority="61" SemiHidden="false" UnhideWhenUsed="false" Name="Light List" /> <w:LsdException Locked="false" Priority="62" SemiHidden="false" UnhideWhenUsed="false" Name="Light Grid" /> <w:LsdException Locked="false" Priority="63" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 1" /> <w:LsdException Locked="false" Priority="64" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 2" /> <w:LsdException Locked="false" Priority="65" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 1" /> <w:LsdException Locked="false" Priority="66" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 2" /> <w:LsdException Locked="false" Priority="67" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 1" /> <w:LsdException Locked="false" Priority="68" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 2" /> <w:LsdException Locked="false" Priority="69" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 3" /> <w:LsdException Locked="false" Priority="70" SemiHidden="false" UnhideWhenUsed="false" Name="Dark List" /> <w:LsdException Locked="false" Priority="71" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Shading" /> <w:LsdException Locked="false" Priority="72" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful List" /> <w:LsdException Locked="false" Priority="73" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Grid" /> <w:LsdException Locked="false" Priority="60" SemiHidden="false" UnhideWhenUsed="false" Name="Light Shading Accent 1" /> <w:LsdException Locked="false" Priority="61" SemiHidden="false" UnhideWhenUsed="false" Name="Light List Accent 1" /> <w:LsdException Locked="false" Priority="62" SemiHidden="false" UnhideWhenUsed="false" Name="Light Grid Accent 1" /> <w:LsdException Locked="false" Priority="63" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 1 Accent 1" /> <w:LsdException Locked="false" Priority="64" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 2 Accent 1" /> <w:LsdException Locked="false" Priority="65" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 1 Accent 1" /> <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Revision" /> <w:LsdException Locked="false" Priority="34" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="List Paragraph" /> <w:LsdException Locked="false" Priority="29" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="Quote" /> <w:LsdException Locked="false" Priority="30" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="Intense Quote" /> <w:LsdException Locked="false" Priority="66" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 2 Accent 1" /> <w:LsdException Locked="false" Priority="67" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 1 Accent 1" /> <w:LsdException Locked="false" Priority="68" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 2 Accent 1" /> <w:LsdException Locked="false" Priority="69" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 3 Accent 1" /> <w:LsdException Locked="false" Priority="70" SemiHidden="false" UnhideWhenUsed="false" Name="Dark List Accent 1" /> <w:LsdException Locked="false" Priority="71" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Shading Accent 1" /> <w:LsdException Locked="false" Priority="72" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful List Accent 1" /> <w:LsdException Locked="false" Priority="73" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Grid Accent 1" /> <w:LsdException Locked="false" Priority="60" SemiHidden="false" UnhideWhenUsed="false" Name="Light Shading Accent 2" /> <w:LsdException Locked="false" Priority="61" SemiHidden="false" UnhideWhenUsed="false" Name="Light List Accent 2" /> <w:LsdException Locked="false" Priority="62" SemiHidden="false" UnhideWhenUsed="false" Name="Light Grid Accent 2" /> <w:LsdException Locked="false" Priority="63" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 1 Accent 2" /> <w:LsdException Locked="false" Priority="64" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 2 Accent 2" /> <w:LsdException Locked="false" Priority="65" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 1 Accent 2" /> <w:LsdException Locked="false" Priority="66" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 2 Accent 2" /> <w:LsdException Locked="false" Priority="67" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 1 Accent 2" /> <w:LsdException Locked="false" Priority="68" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 2 Accent 2" /> <w:LsdException Locked="false" Priority="69" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 3 Accent 2" /> <w:LsdException Locked="false" Priority="70" SemiHidden="false" UnhideWhenUsed="false" Name="Dark List Accent 2" /> <w:LsdException Locked="false" Priority="71" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Shading Accent 2" /> <w:LsdException Locked="false" Priority="72" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful List Accent 2" /> <w:LsdException Locked="false" Priority="73" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Grid Accent 2" /> <w:LsdException Locked="false" Priority="60" SemiHidden="false" UnhideWhenUsed="false" Name="Light Shading Accent 3" /> <w:LsdException Locked="false" Priority="61" SemiHidden="false" UnhideWhenUsed="false" Name="Light List Accent 3" /> <w:LsdException Locked="false" Priority="62" SemiHidden="false" UnhideWhenUsed="false" Name="Light Grid Accent 3" /> <w:LsdException Locked="false" Priority="63" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 1 Accent 3" /> <w:LsdException Locked="false" Priority="64" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 2 Accent 3" /> <w:LsdException Locked="false" Priority="65" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 1 Accent 3" /> <w:LsdException Locked="false" Priority="66" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 2 Accent 3" /> <w:LsdException Locked="false" Priority="67" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 1 Accent 3" /> <w:LsdException Locked="false" Priority="68" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 2 Accent 3" /> <w:LsdException Locked="false" Priority="69" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 3 Accent 3" /> <w:LsdException Locked="false" Priority="70" SemiHidden="false" UnhideWhenUsed="false" Name="Dark List Accent 3" /> <w:LsdException Locked="false" Priority="71" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Shading Accent 3" /> <w:LsdException Locked="false" Priority="72" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful List Accent 3" /> <w:LsdException Locked="false" Priority="73" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Grid Accent 3" /> <w:LsdException Locked="false" Priority="60" SemiHidden="false" UnhideWhenUsed="false" Name="Light Shading Accent 4" /> <w:LsdException Locked="false" Priority="61" SemiHidden="false" UnhideWhenUsed="false" Name="Light List Accent 4" /> <w:LsdException Locked="false" Priority="62" SemiHidden="false" UnhideWhenUsed="false" Name="Light Grid Accent 4" /> <w:LsdException Locked="false" Priority="63" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 1 Accent 4" /> <w:LsdException Locked="false" Priority="64" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 2 Accent 4" /> <w:LsdException Locked="false" Priority="65" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 1 Accent 4" /> <w:LsdException Locked="false" Priority="66" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 2 Accent 4" /> <w:LsdException Locked="false" Priority="67" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 1 Accent 4" /> <w:LsdException Locked="false" Priority="68" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 2 Accent 4" /> <w:LsdException Locked="false" Priority="69" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 3 Accent 4" /> <w:LsdException Locked="false" Priority="70" SemiHidden="false" UnhideWhenUsed="false" Name="Dark List Accent 4" /> <w:LsdException Locked="false" Priority="71" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Shading Accent 4" /> <w:LsdException Locked="false" Priority="72" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful List Accent 4" /> <w:LsdException Locked="false" Priority="73" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Grid Accent 4" /> <w:LsdException Locked="false" Priority="60" SemiHidden="false" UnhideWhenUsed="false" Name="Light Shading Accent 5" /> <w:LsdException Locked="false" Priority="61" SemiHidden="false" UnhideWhenUsed="false" Name="Light List Accent 5" /> <w:LsdException Locked="false" Priority="62" SemiHidden="false" UnhideWhenUsed="false" Name="Light Grid Accent 5" /> <w:LsdException Locked="false" Priority="63" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 1 Accent 5" /> <w:LsdException Locked="false" Priority="64" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 2 Accent 5" /> <w:LsdException Locked="false" Priority="65" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 1 Accent 5" /> <w:LsdException Locked="false" Priority="66" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 2 Accent 5" /> <w:LsdException Locked="false" Priority="67" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 1 Accent 5" /> <w:LsdException Locked="false" Priority="68" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 2 Accent 5" /> <w:LsdException Locked="false" Priority="69" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 3 Accent 5" /> <w:LsdException Locked="false" Priority="70" SemiHidden="false" UnhideWhenUsed="false" Name="Dark List Accent 5" /> <w:LsdException Locked="false" Priority="71" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Shading Accent 5" /> <w:LsdException Locked="false" Priority="72" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful List Accent 5" /> <w:LsdException Locked="false" Priority="73" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Grid Accent 5" /> <w:LsdException Locked="false" Priority="60" SemiHidden="false" UnhideWhenUsed="false" Name="Light Shading Accent 6" /> <w:LsdException Locked="false" Priority="61" SemiHidden="false" UnhideWhenUsed="false" Name="Light List Accent 6" /> <w:LsdException Locked="false" Priority="62" SemiHidden="false" UnhideWhenUsed="false" Name="Light Grid Accent 6" /> <w:LsdException Locked="false" Priority="63" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 1 Accent 6" /> <w:LsdException Locked="false" Priority="64" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Shading 2 Accent 6" /> <w:LsdException Locked="false" Priority="65" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 1 Accent 6" /> <w:LsdException Locked="false" Priority="66" SemiHidden="false" UnhideWhenUsed="false" Name="Medium List 2 Accent 6" /> <w:LsdException Locked="false" Priority="67" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 1 Accent 6" /> <w:LsdException Locked="false" Priority="68" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 2 Accent 6" /> <w:LsdException Locked="false" Priority="69" SemiHidden="false" UnhideWhenUsed="false" Name="Medium Grid 3 Accent 6" /> <w:LsdException Locked="false" Priority="70" SemiHidden="false" UnhideWhenUsed="false" Name="Dark List Accent 6" /> <w:LsdException Locked="false" Priority="71" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Shading Accent 6" /> <w:LsdException Locked="false" Priority="72" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful List Accent 6" /> <w:LsdException Locked="false" Priority="73" SemiHidden="false" UnhideWhenUsed="false" Name="Colorful Grid Accent 6" /> <w:LsdException Locked="false" Priority="19" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="Subtle Emphasis" /> <w:LsdException Locked="false" Priority="21" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="Intense Emphasis" /> <w:LsdException Locked="false" Priority="31" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="Subtle Reference" /> <w:LsdException Locked="false" Priority="32" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="Intense Reference" /> <w:LsdException Locked="false" Priority="33" SemiHidden="false" UnhideWhenUsed="false" QFormat="true" Name="Book Title" /> <w:LsdException Locked="false" Priority="37" Name="Bibliography" /> <w:LsdException Locked="false" Priority="39" QFormat="true" Name="TOC Heading" /> <\/w:LatentStyles> <\/xml><![endif]--><style type="text/css"> <!-- /* Font Definitions */ @font-face {font-family:"Cambria Math"; panose-1:2 4 5 3 5 4 6 3 2 4; mso-font-charset:1; mso-generic-font-family:roman; mso-font-format:other; mso-font-pitch:variable; mso-font-signature:0 0 0 0 0 0;} @font-face {font-family:Calibri; panose-1:2 15 5 2 2 2 4 3 2 4; mso-font-charset:0; mso-generic-font-family:swiss; mso-font-pitch:variable; mso-font-signature:-1610611985 1073750139 0 0 159 0;} /* Style Definitions */ p.MsoNormal, li.MsoNormal, div.MsoNormal {mso-style-unhide:no; mso-style-qformat:yes; mso-style-parent:""; margin-top:0cm; margin-right:0cm; margin-bottom:10.0pt; margin-left:0cm; line-height:115%; mso-pagination:widow-orphan; font-size:11.0pt; font-family:"Calibri","sans-serif"; mso-fareast-font-family:Calibri; mso-bidi-font-family:"Times New Roman"; mso-fareast-language:EN-US;} .MsoChpDefault {mso-style-type:export-only; mso-default-props:yes; font-size:10.0pt; mso-ansi-font-size:10.0pt; mso-bidi-font-size:10.0pt; mso-ascii-font-family:Calibri; mso-fareast-font-family:Calibri; mso-hansi-font-family:Calibri;} @page Section1 {size:595.3pt 841.9pt; margin:70.85pt 2.0cm 70.85pt 2.0cm; mso-header-margin:35.4pt; mso-footer-margin:35.4pt; mso-paper-source:0;} div.Section1 {page:Section1;} --> <\/style><!--[if gte mso 10]> <style> /* Style Definitions */ table.MsoNormalTable {mso-style-name:"Normaali taulukko"; mso-tstyle-rowband-size:0; mso-tstyle-colband-size:0; mso-style-noshow:yes; mso-style-priority:99; mso-style-qformat:yes; mso-style-parent:""; mso-padding-alt:0cm 5.4pt 0cm 5.4pt; mso-para-margin:0cm; mso-para-margin-bottom:.0001pt; mso-pagination:widow-orphan; font-size:11.0pt; font-family:"Calibri","sans-serif"; mso-ascii-font-family:Calibri; mso-ascii-theme-font:minor-latin; mso-fareast-font-family:"Times New Roman"; mso-fareast-theme-font:minor-fareast; mso-hansi-font-family:Calibri; mso-hansi-theme-font:minor-latin; mso-bidi-font-family:"Times New Roman"; mso-bidi-theme-font:minor-bidi;} <\/style> <![endif]--> <\/meta><\/meta><\/meta><\/meta><\/p><p style="text-align: left;" class="MsoNormal"><b style=""><span lang="SV" style="font-size: 14pt; line-height: 115%;">Paikkatietoikkuna / snabbanvisning fr kartfnstret<o:p><\/o:p><\/span><\/b><\/p> <p class="MsoNormal"><span lang="SV" style="">I Paikkatietoikkunas kartfnster r det mjligt att <span style="">&nbsp;<\/span>blddra<br /> i mnga olika kartlager producerade av diverse organisationer.<br /> Det r mjligt att titta p kartlager i olika skalor, antingen<br /> separat eller ovanp varandra, eftersom det gr att justera<br /> deras genomsynlighet i tjnsten. Fr vissa material gr<br /> det att ska nrmare uppgifter om objekten. <o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="SV" style="">Det innehll som visas i Paikkatietoikkuna r eventuellt<br /> skyddat av upphovsrtt och enligt internationella avtal.<br /> Anvndaren har tillstnd att skriva ut enskilda kartor fr<br /> privat bruk. vrig kopiering och avskiljning av kartor frn<br /> tjnsten r frbjuden; fr ytterligare uppgifter ls tjnstens<br /> anvndningsvillkor. <o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><b style=""><span lang="SV" style="">Frsta sidan<o:p><\/o:p><\/span><\/b><\/p> <p class="MsoNormal"><span lang="SV" style="">Bakgrundskartan p kartfnstrets frsta sida tcker hela<br /> Finlands omrde, och skalan kan ndras. <span style="">&nbsp;<\/span>Kartlagret har<br /> &rdquo;avtonats&rdquo; genom att justera dess genomsynlighet. Om<br /> du vill kan du ndra kartans ljusstyrka genom att gripa<br /> tag i och dra balken i nedre vnstra hrnet dr de valda<br /> kartlagren syns nedanfr rubriken LMV bakgrundskartor.<br /> Tillbaka till det frvalda kartfnstret kommer du alltid<br /> genom att klicka p fliken KARTFNSTER ovanfr kartan.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><b style=""><span lang="SV" style="">Navigering<o:p><\/o:p><\/span><\/b><\/p> <p class="MsoNormal"><span lang="SV" style="">Kartans skala kan justeras med hjlp av skalnivbalken<br /> genom att klicka p minus eller plus, eller sjlva balken<br /> p nskat stlle - eller genom att gripa tag i indikatorn<br /> och fra den till nskat stlle. Nr muspekaren frs<br /> ovanp skalnivbalken blir skalfrklaringarna synliga. <o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="SV" style="">Kartans skala kan frstoras, dvs. zoomas genom att vlja<br /> frstoringsglasverktyget. Med musknappen nedtryckt<br /> kan du dra p kartan en rektangel till vilken kartan<br /> zoomas. Kartan kan zoomas ven genom att dubbelklicka<br /> med musen varvid kartan centreras kring den punkt<br /> som du klickade p.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="SV" style="">Du kan flytta kartan i olika riktningar genom att dra den<br /> till nskad riktning med musknappen nedtryckt. Kartan<br /> kan flyttas ven i olika riktningar med hjlp av<br /> piltangenterna.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="SV" style="">Du kan g tillbaka och framt i navigeringshistorien<br /> genom att klicka p triangelknapparna ovanfr<br />skalnivbalken.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><b style=""><span lang="SV" style="">Skning med ortnamn och adress<o:p><\/o:p><\/span><\/b><\/p> <p class="MsoNormal"><span lang="SV" style="">I vre hgra hrnet av kartfnstret finns fltet<br /> Sk platser/adresser. I fltet kan du skriva ett ortnamn<br /> eller en adress varvid alla skresultat listas nedanfr<br /> fltet, enligt kommun och objekttyp. Genom att klicka p<br /> ett namn i listan centreras kartan kring denna plats.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="SV" style="">Du kan skriva *-tecknet i slutet eller i brjan av texten i<br /> fltet. D sks namn som brjar eller slutar med de<br /> bokstver du matade in. Efter gatu-/vgnamnet kan du<br /> skriva adressnummer eller eventuellt kommunnamn.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><b style=""><span lang="SV" style="">Val av kartlager<o:p><\/o:p><\/span><\/b><\/p> <p class="MsoNormal"><span lang="SV" style="">Du kan vlja kartlager i listan som finns till vnster.<br /> I listan finns olika teman. Genom att klicka p temat,<br /> t.ex. Geologi, ppnas en lista ver de kartlager som finns<br /> tillgngliga fr temat i frga. Ett alternativ till temalistan<br /> r en organisationsfrteckning ver dataproducenter.<br /> Genom att klicka p namnet p organisationen ppnas<br /> en lista ver de kartlager som den erbjuder. <o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="SV" style="">Kartlager kan ven skas genom att skriva bokstver<br /> i skfltet ovanfr listan varvid endast sdana kartlager<br /> listas vilka innehller de angivna bokstverna i den angivna<br /> ordningen. Genom att klicka p det <span style="color: rgb(153, 153, 153);">gra x-tecknet<\/span> efter<br /> skfltet visas listan igen i ofrndrad form.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="SV" style="">Kartlager vljs genom att klicka p dess namn eller den<br /> <span style="color: rgb(0, 255, 0);">grna cirkeln med +<\/span><span style="color: rgb(51, 153, 102);"> <\/span>varvid kartlagernamnet blir synligt under<br /> rubriken Valda kartlager. Namnet p kartlagret r skrivet<br /> med svart text nr kartlagret r tillgngligt i kartfnstrets<br /> skala och med <span style="color: rgb(153, 153, 153);"><i style="">gr kursiv<\/i><\/span> nr det inte finns tillgngligt i den<br /> valda skalan. <o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="SV" style="">Genom att klicka p den <span style="color: rgb(0, 255, 255);">bla cirkeln med bokstaven &rdquo;i&rdquo;<\/span> <br />visas kartlagrets materialbeskrivning till hger om kartan. <o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="SV" style="">Det valda kartlagret kan tas bort genom att klicka p den<br /> <span style="color: rgb(255, 0, 0);">rda cirkeln med &rdquo;x&rdquo;<\/span>.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><b style=""><span lang="SV" style="">Att justera kartbilden<o:p><\/o:p><\/span><\/b><\/p> <p class="MsoNormal"><span lang="SV" style="">Genomsynligheten av det valda kartlagret kan justeras<br /> i procent genom att gripa tag i styrbrickan. Vid 0 % r <br />kartlagret helt genomsynligt, det syns allts inte alls,<br /> och vid 100 % helt ogenomsynligt. Vissa kartlager r<br /> tckande medan andra kartlager innehller t.ex. endast<br /> enstaka punkter.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="SV" style="">Ett kartlager kan ha flera stilar varvid en stilmeny visas<br /> nedanfr genomsynlighetsbalken. I menyn kan du vlja<br /> en stil t gngen. Exempelvis Primar-sjkort har flera<br /> olika stilar.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="SV" style="">Frutom justeringen av kartlagrens genomsynlighet <br />pverkar ocks de valda kartlagrens ordningsfljd p hur<br /> kartbilden ser ut. Ordningsfljden p de valda kartlagren<br /> kan ndras genom att gripa tag i kartlagernamnet och dra<br /> det ovanfr eller nedafr ett annat kartlager. <o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><b style=""><span lang="SV" style="">Att mta<o:p><\/o:p><\/span><\/b><\/p> <p class="MsoNormal"><span lang="SV" style="">Fr att mta avstnd eller berkna areal ska du vlja <br />respektive linjalverktyg. <o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="SV" style="">Nr du mter avstnd anger du frst begynnelsepunkten och<br /> sedan ruttpunkter genom att klicka med musen. Mtningen<br /> avslutas genom att dubbelklicka med musen. <br />Det mtta avstndet visas nedanfr kartan.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="SV" style="">Nr du berknar areal anger du punkter p kartan som bildar<br /> omrdet vars areal du vill berkna. Markeringen avslutas<br /> genom att dubbelklicka med musen. <br />Arealen visas nedanfr kartan.<\/span><\/p><h3><span lang="SV" style="">Koordinatsystem<\/span><\/h3><p class="MsoNormal"><span lang="SV" style="">Kartlager och koordinater anges i ETRS-TM35FIN-koordinatsystemet.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><b style=""><span lang="SV" style="">Att ska egenskapsuppgifter<o:p><\/o:p><\/span><\/b><\/p> <p class="MsoNormal"><span lang="SV" style="">Uppgifter om de objekt som r synliga p kartlagret kan skas<br /> genom att ta i bruk i-pil-verktyget. Att kunna ska<br /> egenskapsuppgifter frutstter dessutom att du aktiverar<br /> respektive kartlager genom att klicka p det varvid en <span style="color: rgb(255, 153, 0);">orange<\/span><br /> kantlinje blir synlig runt den gra ldan. Skningen av <br />egenskapsuppgifter r begrnsad och tillgnglig endast fr<br /> vissa kartlager ssom fornminnen. Ifall fuktionen inte r<br /> tillgnglig fr det aktiverade kartlagret meddelas anvndaren<br /> om detta till hger om kartan.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><span lang="SV" style="">Egenskapsuppgifter sks genom att klicka p objekt p kartan.<br /> Egenskapsuppgifterna visas till hger om kartan. Uppgifterna<br /> r inte ndvndigtvis tillgngliga fr alla objekt. <o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><b style=""><span lang="SV" style="">Kartlnk<o:p><\/o:p><\/span><\/b><\/p> <p class="MsoNormal"><span lang="SV" style="">Du kan skapa en lnk till den synliga kartan genom att klicka p<br /> ktting-verktyget. Du kan kopiera lnken och skicka den per e-post.<br /> Genom lnken ppnas samma kartbild som var synlig nr<br /> lnken skapades.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><b style=""><span lang="SV" style="">Positioneringskarta<o:p><\/o:p><\/span><\/b><\/p> <p class="MsoNormal"><span lang="SV" style="">I nedre hgra hrnet av kartfnstret kan du ppna en <br />positioneringskarta. Den anger vilken del av Finland den synliga<br /> kartan visar. Om du klickar p positioneringskartan centreras <br />kartan kring den punkt som du klickade p.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><b style=""><span lang="SV" style="">Stort kartfnster<o:p><\/o:p><\/span><\/b><\/p> <p class="MsoNormal"><span lang="SV" style="">Genom att klicka p knappen i vre hgra hrnet om <br />kartfnstret kan du ppna ett stort kartfnster som fyller<br /> hela webblsaren. Genom att klicka p samma knapp p<br /> nytt fr du tillbaka den ursprungliga storleken.<o:p><\/o:p><\/span><\/p> <p class="MsoNormal"><b style=""><span lang="SV" style="">Att justera hger och vnster spalt<o:p><\/o:p><\/span><\/b><\/p> <p class="MsoNormal"><span lang="SV" style="">Bredden av spalterna till hger och vnster om kartfnstret<br /> kan justeras genom att gripa tag i spaltens kant och dra. <br />Du kan stnga spalten genom att klicka p dubbelpilknappen <br />i vre kanten och ppna/stnga genom att klicka p den <br />pyttelilla triangeln i mitten av spaltens kant.<o:p><\/o:p><\/span><span lang="SV" style=""><o:p><\/o:p><\/span><span lang="SV" style=""><span style=""><br /><\/span><o:p><\/o:p><\/span><\/p><p>&nbsp;<\/p>',"show-date":"true",e:"","link-to-page":"",theme:"",n:"","verkkopositio-issue":"",title:"Kartfnstret snabbanvisning","link-url":"","link-text":"",producer:"",paivamaara:"","small-image":""},id:"127257"}]}});Oskari.registerLocalization({lang:"uk",key:"userinterface.UserGuide",value:{title:"",desc:"",flyout:{title:"  Oskari"},tile:{title:"  "},error:{title:"!",generic:"     . -,  "},help:{tags:"NOT TRANSLATED",contentPart:"NOT TRANSLATED"}}});Oskari.clazz.define("Oskari.lupapiste.bundle.planbundle.PlanBundleInstance",function(){},{create:function(){var me=this;return Oskari.clazz.create("Oskari.lupapiste.bundle.planbundle.PlanBundleInstance")},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/planbundle/instance.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/planbundle/Flyout.js"},{type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/planbundle/Tile.js"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/planbundle/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/planbundle/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/lupapiste/bundle/planbundle/locale/en.js"}]},bundle:{manifest:{"Bundle-Identifier":"planbundle","Bundle-Name":"planbundle","Bundle-Author":[{Name:"ev",Organisation:"",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}},dependencies:["jquery"]});Oskari.bundle_manager.installBundleClass("planbundle","Oskari.lupapiste.bundle.planbundle.PlanBundleInstance");Oskari.clazz.define("Oskari.lupapiste.bundle.planbundle.Flyout",function(instance){this.instance=instance;this.container=null;this.state=null;this.template=null;me=this},{getName:function(){return"Oskari.lupapiste.bundle.planbundle.Flyout"},setEl:function(el){this.container=el[0];jQuery(this.container).hasClass("planbundle")||jQuery(this.container).addClass("planbundle")},startPlugin:function(){this.template=jQuery("<div><\/div>")},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("flyouttitle")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(state){this.state=state},createUI:function(){var sandbox=me.instance.getSandbox(),cel=jQuery(this.container),content;cel.empty();content=this.template.clone();content.append(this.instance.getLocalization("flyout").instructions);cel.append(content)},search:function(x,y){var container=jQuery(this.container);container.empty();this.instance.urbanPlans&&this.searchUrban(x,y);this.instance.urbanPlansLiiteri&&this.searchUrbanLiiteri(x,y);this.instance.generalPlans&&this.searchGeneral(x,y)},searchGeneral:function(x,y){var container=jQuery(this.container),generalContainer=jQuery('<div id="generalPlans"><h4>'+this.instance.getLocalization("flyout").titleGeneral+"<\/h4><\/div>"),cel;container.append(generalContainer);cel=jQuery('<div id="generalPlanResults"><\/div>');generalContainer.append(cel);cel.append(this.instance.getLocalization("flyout").searchingGeneral+"<\/br>");cel.append('<img src="'+Oskari.app.appConfig.lupakartta.conf.ajaxloader+'" />');jQuery.ajax({url:Oskari.app.appConfig.lupakartta.conf.ajaxurl+"/general-plan-urls-by-point",data:{x:x,y:y},dataType:"json",success:function(data){var content,item,button;if(cel.empty(),content="",data.length>0){content=content+"<table>";content=content+"<tr><td>"+me.instance.getLocalization("flyout").id+"<\/td><td>"+me.instance.getLocalization("flyout").nimi+"<\/td><td>"+me.instance.getLocalization("flyout").tyyppi+"<\/td><td>"+me.instance.getLocalization("flyout").oikeusvaik+"<\/td><td>"+me.instance.getLocalization("flyout").pvm+"<\/td><td>"+me.instance.getLocalization("flyout").lisatieto+"<\/td><td>"+me.instance.getLocalization("flyout").link+"<\/td><\/tr>";for(item in data)content=content+"<tr>",content=content+"<td>"+data[item].id+"<\/td>",content=content+"<td>"+data[item].nimi+"<\/td>",content=content+"<td>"+data[item].tyyppi+"<\/td>",content=content+"<td>"+data[item].oikeusvaik+"<\/td>",content=content+"<td>"+data[item].pvm+"<\/td>",content=content+"<td>"+data[item].lisatieto+"<\/td>",content=content+"<td><a target='_blank' href='/proxy/plandocument?id="+data[item].id+"'>Pdf<\/a><\/td>",content=content+"<\/tr>";content=content+"<\/table>";cel.append(content)}else cel.empty(),cel.append(me.instance.getLocalization("flyout").notfound);cel.append("<\/br>");button=jQuery("<button/>");button.text(me.instance.getLocalization("flyout").newsearch).click(function(){me.createUI();me.instance.isActive=!0});cel.append(button)},error:function(){cel.empty();cel.append(me.instance.getLocalization("flyout").error);cel.append("<\/br>");var button=jQuery("<button/>");button.text(me.instance.getLocalization("flyout").newsearch).click(function(){me.createUI();me.instance.isActive=!0});cel.append(button)}})},searchUrban:function(x,y){var container=jQuery(this.container),urbanContainer=jQuery('<div id="urbanPlans"><h4>'+this.instance.getLocalization("flyout").titleUrban+"<\/h4><\/div>"),cel;container.append(urbanContainer);cel=jQuery('<div id="urbanPlanResults"><\/div>');urbanContainer.append(cel);cel.append(this.instance.getLocalization("flyout").searchingUrban+"<\/br>");cel.append('<img src="'+Oskari.app.appConfig.lupakartta.conf.ajaxloader+'" />');jQuery.ajax({url:Oskari.app.appConfig.lupakartta.conf.ajaxurl+"/plan-urls-by-point",data:{x:x,y:y,municipality:Oskari.app.appConfig.lupakartta.conf.municipality},dataType:"json",success:function(data){var content,item;if(cel.empty(),content="",data.length>0){content=content+"<table>";content=content+"<tr><td>"+me.instance.getLocalization("flyout").id+"<\/td><td>"+me.instance.getLocalization("flyout").link+"<\/td><\/tr>";for(item in data)content=content+"<tr>",content=content+"<td>"+data[item].kaavanro+"<\/td>",content=content+"<td><a target='_blank' href='"+data[item].linkki+"'>Pdf<\/a><\/td>",content=content+"<\/tr>";content=content+"<\/table>";cel.append(content)}else cel.empty(),cel.append(me.instance.getLocalization("flyout").notfound)},error:function(){cel.empty();cel.append(me.instance.getLocalization("flyout").error)}})},searchUrbanLiiteri:function(x,y){var container=jQuery(this.container),urbanContainer=jQuery('<div id="urbanPlansLiiteri"><h4>'+this.instance.getLocalization("flyout").titleUrbanLiiteri+"<\/h4><\/div>"),cel;container.append(urbanContainer);cel=jQuery('<div id="urbanPlanLiiteriResults"><\/div>');urbanContainer.append(cel);cel.append(this.instance.getLocalization("flyout").searchingUrbanLiiteri+"<\/br>");cel.append('<img src="'+Oskari.app.appConfig.lupakartta.conf.ajaxloader+'" />');jQuery.ajax({url:Oskari.app.appConfig.lupakartta.conf.ajaxurl+"/plan-urls-by-point",data:{x:x,y:y,municipality:"liiteri"},dataType:"json",success:function(data){var content,item;if(cel.empty(),content="",data.length>0){content=content+"<table>";content=content+"<tr><td>"+me.instance.getLocalization("flyout").id+"<\/td><td>"+me.instance.getLocalization("flyout").link+"<\/td><\/tr>";for(item in data)content=content+"<tr>",content=content+"<td>"+data[item].kaavanro+"<\/td><td>",content=typeof data[item].linkki===undefined||data[item].linkki===null||data[item].linkki.length===0?content+me.instance.getLocalization("flyout").notAvailable:content+"<a target='_blank' href='"+data[item].linkki+"'>Pdf<\/a>",content=content+"<\/td><\/tr>";content=content+"<\/table>";cel.append(content)}else cel.empty(),cel.append(me.instance.getLocalization("flyout").notfound)},error:function(){cel.empty();cel.append(me.instance.getLocalization("flyout").error)}})}},{protocol:["Oskari.userinterface.Flyout"]});Oskari.clazz.define("Oskari.lupapiste.bundle.planbundle.PlanBundleInstance",function(){this.sandbox=null;this.plugins={};this._localization=null;this.mediator=null;this.isActive=!1;this.urbanPlans=!1;this.urbanPlansLiiteri=!1;this.generalPlans=!1},{__name:"PlanBundle",getName:function(){return this.__name},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},getSandbox:function(){return this.sandbox},update:function(){},getLocalization:function(key){return(this._localization||(this._localization=Oskari.getLocalization(this.getName())),key)?this._localization[key]:this._localization},startExtension:function(){var me=this;this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.lupapiste.bundle.planbundle.Flyout",this);this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.lupapiste.bundle.planbundle.Tile",this)},stopExtension:function(){var me=this;for(var pluginType in me.plugins)pluginType&&(me.plugins[pluginType]=null)},getPlugins:function(){return this.plugins},start:function(){var me=this,conf=me.conf,sandboxName=(conf?conf.sandbox:null)||"sandbox",sandbox=Oskari.getSandbox(sandboxName),p,request;if(this.sandbox=sandbox,this.urbanPlans=conf.urbanPlans||sandbox._modulesByName.lupakartta.conf.municipality==="491",this.urbanPlansLiiteri=conf.urbanPlansLiiteri,this.generalPlans=conf.generalPlans,this.generalPlans||this.urbanPlans||this.urbanPlansLiiteri){this.localization=Oskari.getLocalization(this.getName());sandbox.register(me);for(p in me.eventHandlers)p&&sandbox.registerForEventByName(me,p);request=sandbox.getRequestBuilder("userinterface.AddExtensionRequest")(this);sandbox.request(this,request);me._createUI()}},init:function(){return null},onEvent:function(event){var me=this,handler=me.eventHandlers[event.getName()];if(handler)return handler.apply(this,[event])},eventHandlers:{"userinterface.ExtensionUpdatedEvent":function(event){if(event.getExtension().getName()===this.getName())if(event.getViewState()==="close")this.isActive=!1;else if(event.getViewState()==="attach"){this.isActive=!0;var plugin=this.plugins["Oskari.userinterface.Flyout"];plugin.createUI()}},MapClickedEvent:function(event){if(this.isActive){var plugin=this.plugins["Oskari.userinterface.Flyout"],x=event.getLonLat().lon,y=event.getLonLat().lat;this.isActive=!1;plugin.search(x,y)}}},stop:function(){var me=this,sandbox=me.sandbox(),p,request;for(p in me.eventHandlers)p&&sandbox.unregisterFromEventByName(me,p);request=sandbox.getRequestBuilder("userinterface.RemoveExtensionRequest")(me);sandbox.request(me,request);me.sandbox.unregister(me)},_createUI:function(){var me=this;for(var pluginType in me.plugins)pluginType&&me.plugins[pluginType].createUI()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]});Oskari.clazz.define("Oskari.lupapiste.bundle.planbundle.Tile",function(instance){this.instance=instance;this.container=null;this.template=null},{getName:function(){return"Oskari.lupapiste.bundle.planbundle.Tile"},setEl:function(el){this.container=jQuery(el)},startPlugin:function(){this.createUI()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){},getOptions:function(){},setState:function(){},createUI:function(){}},{protocol:["Oskari.userinterface.Tile"]});Oskari.registerLocalization({lang:"en",key:"PlanBundle",value:{title:"Plan documents",flyouttitle:"City plan documents",desc:"",flyout:{instructions:"Click location on the map to search city plan document",searching:"Searching city plan documents.",id:"Id",link:"Link",notfound:"No city plan documents found.",newsearch:"New search",error:"Searching city plan documents failed."}}});Oskari.registerLocalization({lang:"fi",key:"PlanBundle",value:{title:"Kaavamrykset",flyouttitle:"Kaavamrykset",desc:"",flyout:{instructions:"Osoita kartalta haettavan kaavamryksen sijainti.",searchingUrban:"Haetaan asemakaavamryksi.",searchingUrbanLiiteri:"Haetaan asemakaavamryksi Liiteri asemakaavapalvelusta.",searchingGeneral:"Haetaan yleiskaavamryksi.",titleUrban:"Asemakaavamrykset",titleUrbanLiiteri:"Asemakaavamrykset Liiteri asemakaavapalvelusta",titleGeneral:"Yleiskaavamrykset",id:"Tunnus",link:"Linkki",notAvailable:"Mryksi ei ole saatavilla",nimi:"Nimi",pvm:"Ptksen pivys",tyyppi:"Tyypittely",oikeusvaik:"Oikeusvaikutteisuus",lisatieto:"Listieto",notfound:"Kaavamryksi ei lytynyt.",newsearch:"Uusi haku",error:"Kaavamrysten hakeminen eponnistui"}}});Oskari.registerLocalization({lang:"sv",key:"PlanBundle",value:{title:"Planbestmmelser",flyouttitle:"Planbestmmelser",desc:"",flyout:{instructions:"Visa platsen fr nskad planbestmmelse p kartan.",searchingUrban:"Detaljplanebestmmelser hmtas.",searchingUrbanLiiteri:"Detaljplanebestmmelser hmtas frn Liiteri detaljplaneservice.",searchingGeneral:"Generalplanebestmmelser hmtas.",titleUrban:"Detaljplanebestmmelser",titleUrbanLiiteri:"Detaljplanebestmmelser frn Liiteri detaljplaneservice",titleGeneral:"Generalplanebestmmelser",id:"Beteckning",link:"Lnk",notAvailable:"Detaljplanebestmmelser r inte tillgnglig",nimi:"Namn",pvm:"Beslutsdatum",tyyppi:"Typindelning",oikeusvaik:"Rttsverkan",lisatieto:"Tillggsuppgift",notfound:"Inga planbestmmelser hittades.",newsearch:"Ny skning",error:"Hmtningen av planbeteckningar misslyckades"}}})