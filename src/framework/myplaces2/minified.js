/**
 * jscolor, JavaScript Color Picker
 *
 * @version 1.3.13
 * @license GNU Lesser General Public License, http://www.gnu.org/copyleft/lesser.html
 * @author  Jan Odvarko, http://odvarko.cz
 * @created 2008-06-15
 * @updated 2012-01-19
 * @link    http://jscolor.com
 */

/* http://keith-wood.name/svg.html
   SVG for jQuery v1.4.5.
   Written by Keith Wood (kbwood{at}iinet.com.au) August 2007.
   Dual licensed under the GPL (http://dev.jquery.com/browser/trunk/jquery/GPL-LICENSE.txt) and 
   MIT (http://dev.jquery.com/browser/trunk/jquery/MIT-LICENSE.txt) licenses. 
   Please attribute the author if you use it. */

Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.event.FinishedDrawingEvent",function(e,t){this._drawing=e,this._modification=t==1},{__name:"DrawPlugin.FinishedDrawingEvent",getName:function(){return this.__name},getDrawing:function(){return this._drawing},isModification:function(){return this._modification}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/event/FinishedDrawingEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.event.AddedFeatureEvent",function(e,t){this._drawing=e,this._drawingMode=t},{__name:"DrawPlugin.AddedFeatureEvent",getName:function(){return this.__name},getDrawing:function(){return this._drawing},getDrawingMode:function(){return this._drawingMode}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/event/AddedFeatureEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.myplaces.event.MyPlaceHoverEvent",function(e,t,n){this._creator=null,this._lonlat=e,this._hoverEvent=t,this._zoom=n},{__name:"MyPlaces.MyPlaceHoverEvent",getName:function(){return this.__name},getHoverEvent:function(){return this._hoverEvent},getLonLat:function(){return this._lonlat},getZoomLevel:function(){return this._zoom}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/myplaces2/event/MyPlaceHoverEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.myplaces.event.MyPlacesChangedEvent",function(e){},{__name:"MyPlaces.MyPlacesChangedEvent",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/myplaces2/event/MyPlacesChangedEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.event.SelectedDrawingEvent",function(e,t){this._creator=null,this._place=e,this._dblClick=t},{__name:"DrawPlugin.SelectedDrawingEvent",getName:function(){return this.__name},getPlace:function(){return this._place},isDblClick:function(){return this._dblClick}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/event/SelectedDrawingEvent",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.model.MyPlace",function(){this.id=undefined,this.name=undefined,this.description=undefined,this.categoryID=undefined,this.geometry=undefined,this.link=undefined,this.createDate=undefined,this.updateDate=undefined},{setId:function(e){this.id=e},getId:function(){return this.id},setName:function(e){this.name=e},getName:function(){return this.name},setDescription:function(e){this.description=e},getDescription:function(){return this.description},setLink:function(e){this.link=e},getLink:function(){return this.link},setImageLink:function(e){this.imageLink=e},getImageLink:function(){return this.imageLink},setCategoryID:function(e){this.categoryID=e},getCategoryID:function(){return this.categoryID},setGeometry:function(e){this.geometry=e},getGeometry:function(){return this.geometry},setCreateDate:function(e){this.createDate=e},getCreateDate:function(){return this.createDate},setUpdateDate:function(e){this.updateDate=e},getUpdateDate:function(){return this.updateDate},setUUID:function(e){this.uuid=e},getUUID:function(){return this.uuid}}),define("bundles/framework/bundle/myplaces2/model/MyPlace",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.model.MyPlacesCategory",function(){this.id=undefined,this.name=undefined,this._isDefault=!1,this._isPublic=!1,this.lineStyle="",this.lineCap=0,this.lineCorner=0,this.lineWidth=1,this.lineColor="3233ff",this.areaLineWidth=1,this.areaLineCorner=0,this.areaLineStyle="",this.areaLineColor="000000",this.areaFillColor="ffde00",this.areaFillStyle=-1,this.dotShape=1,this.dotSize=3,this.dotColor="000000",this.uuid=undefined},{setId:function(e){this.id=e},getId:function(){return this.id},setName:function(e){this.name=e},getName:function(){return this.name},setDefault:function(e){this._isDefault=e==1},isDefault:function(){return this._isDefault==1},setPublic:function(e){this._isPublic=e==1},isPublic:function(){return this._isPublic==1},setLineStyle:function(e){this.lineStyle=e},getLineStyle:function(){return this.lineStyle},setLineCap:function(e){this.lineCap=e},getLineCap:function(){return this.lineCap},setLineCorner:function(e){this.lineCorner=e},getLineCorner:function(){return this.lineCorner},setLineWidth:function(e){this.lineWidth=e},getLineWidth:function(){return this.lineWidth},setLineColor:function(e){this.lineColor=e},getLineColor:function(){return this.lineColor},setAreaLineWidth:function(e){this.areaLineWidth=e},getAreaLineWidth:function(){return this.areaLineWidth},setAreaLineCorner:function(e){this.areaLineCorner=e},getAreaLineCorner:function(){return this.areaLineCorner},setAreaLineStyle:function(e){this.areaLineStyle=e},getAreaLineStyle:function(){return this.areaLineStyle},setAreaLineColor:function(e){this.areaLineColor=e},getAreaLineColor:function(){return this.areaLineColor},setAreaFillColor:function(e){this.areaFillColor=e},getAreaFillColor:function(){return this.areaFillColor},setAreaFillStyle:function(e){this.areaFillStyle=e},getAreaFillStyle:function(){return this.areaFillStyle},setDotShape:function(e){this.dotShape=e},getDotShape:function(){return this.dotShape},setDotSize:function(e){this.dotSize=e},getDotSize:function(){return this.dotSize},setDotColor:function(e){this.dotColor=e},getDotColor:function(){return this.dotColor},setUUID:function(e){this.uuid=e},getUUID:function(){return this.uuid}}),define("bundles/framework/bundle/myplaces2/model/MyPlacesCategory",function(){}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.drawControls=null,this.drawLayer=null,this.editMode=!1,this.currentDrawMode=null,this.prefix="DrawPlugin.",e&&e.id&&(this.prefix=e.id+"."),e&&e.graphicFill&&(this.graphicFill=e.graphicFill),this.multipart=e&&e.multipart===!0},{__name:"DrawPlugin",getName:function(){return this.prefix+this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this._map=e.getMap(),this.pluginName=e.getName()+this.__name},startDrawing:function(e){if(e.isModify)this.modifyControls.select.select(this.drawLayer.features[0]);else{this.drawLayer.destroyFeatures();if(e.geometry){this.editMode=!0;var t=[new OpenLayers.Feature.Vector(e.geometry)];this.drawLayer.addFeatures(t),this.modifyControls.select.select(this.drawLayer.features[0])}else this.editMode=!1,this.toggleControl(e.drawMode)}},stopDrawing:function(){this.toggleControl(),this.drawLayer.destroyFeatures()},forceFinishDraw:function(){try{this.finishedDrawing(!0)}catch(e){this.stopDrawing();var t=this._sandbox.getEventBuilder("DrawPlugin.SelectedDrawingEvent")();this._sandbox.notifyAll(t)}},finishedDrawing:function(e){if(!this.multipart||e){var t=this._getActiveDrawControls(),n,r;for(n=0;n<t.length;n++)if(typeof this.drawControls[t[n]].handler.finishGeometry==typeof Function){switch(t[n]){case"line":if(this.drawControls.line.handler.line.geometry.components.length<2)continue;break;case"area":r=this.drawControls.area.handler.polygon.geometry.components;if(r[r.length-1].components.length<3)continue}this.drawControls[t[n]].handler.finishGeometry()}this.toggleControl()}if(!this.editMode){var i=this.drawLayer.features.length-1;this.modifyControls.select.select(this.drawLayer.features[i])}var s;!this.multipart||e?(s=this._sandbox.getEventBuilder("DrawPlugin.FinishedDrawingEvent")(this.getDrawing(),this.editMode),this._sandbox.notifyAll(s)):(s=this._sandbox.getEventBuilder("DrawPlugin.AddedFeatureEvent")(this.getDrawing(),this.currentDrawMode),this._sandbox.notifyAll(s))},toggleControl:function(e){this.currentDrawMode=e;var t,n;for(t in this.drawControls)this.drawControls.hasOwnProperty(t)&&(n=this.drawControls[t],e===t?n.activate():n.deactivate())},init:function(e){var t=this;this.requestHandlers={startDrawingHandler:Oskari.clazz.create("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StartDrawingRequestPluginHandler",e,t),stopDrawingHandler:Oskari.clazz.create("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StopDrawingRequestPluginHandler",e,t),getGeometryHandler:Oskari.clazz.create("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.GetGeometryRequestPluginHandler",e,t)},this.drawLayer=new OpenLayers.Layer.Vector(this.prefix+"DrawLayer",{eventListeners:{featuresadded:function(e){t.finishedDrawing()}}}),this.drawControls={point:new OpenLayers.Control.DrawFeature(t.drawLayer,OpenLayers.Handler.Point),line:new OpenLayers.Control.DrawFeature(t.drawLayer,OpenLayers.Handler.Path),area:new OpenLayers.Control.DrawFeature(t.drawLayer,OpenLayers.Handler.Polygon,{handlerOptions:{holeModifier:"altKey"}}),box:new OpenLayers.Control.DrawFeature(t.drawLayer,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:4,irregular:!0}})};if(this.graphicFill!==null&&this.graphicFill!==undefined){var n=this.graphicFill,r=new OpenLayers.Format.SLD,i=r.read(n),s;if(i&&i.namedLayers)for(s in i.namedLayers)if(i.namedLayers.hasOwnProperty(s)){this.drawLayer.styleMap.styles["default"]=i.namedLayers[s].userStyles[0],this.drawLayer.redraw();break}}this.modifyControls={modify:new OpenLayers.Control.ModifyFeature(t.drawLayer,{standalone:!0})},this.modifyControls.select=new OpenLayers.Control.SelectFeature(t.drawLayer,{onBeforeSelect:this.modifyControls.modify.beforeSelectFeature,onSelect:this.modifyControls.modify.selectFeature,onUnselect:this.modifyControls.modify.unselectFeature,scope:this.modifyControls.modify}),this._map.addLayers([t.drawLayer]);var o;for(o in this.drawControls)this.drawControls.hasOwnProperty(o)&&this._map.addControl(this.drawControls[o]);for(o in this.modifyControls)this.modifyControls.hasOwnProperty(o)&&this._map.addControl(this.modifyControls[o]);this.modifyControls.modify.activate()},getDrawing:function(){if(this.drawLayer.features.length===0)return null;var e=this.drawLayer.features[0].geometry.CLASS_NAME;if(e==="OpenLayers.Geometry.MultiPoint"||e==="OpenLayers.Geometry.MultiLineString"||e==="OpenLayers.Geometry.MultiPolygon")return this.drawLayer.features[0].geometry;var t=null,n=[],r;for(r=0;r<this.drawLayer.features.length;r++)n.push(this.drawLayer.features[r].geometry);switch(e){case"OpenLayers.Geometry.Point":t=new OpenLayers.Geometry.MultiPoint(n);break;case"OpenLayers.Geometry.LineString":t=new OpenLayers.Geometry.MultiLineString(n);break;case"OpenLayers.Geometry.Polygon":t=new OpenLayers.Geometry.MultiPolygon(n)}return t},_getActiveDrawControls:function(){var e=[],t;for(t in this.drawControls)this.drawControls.hasOwnProperty(t)&&this.drawControls[t].active&&e.push(t);return e},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,e.register(this),e.addRequestHandler("DrawPlugin.StartDrawingRequest",this.requestHandlers.startDrawingHandler),e.addRequestHandler("DrawPlugin.StopDrawingRequest",this.requestHandlers.stopDrawingHandler),e.addRequestHandler("DrawPlugin.GetGeometryRequest",this.requestHandlers.getGeometryHandler)},stopPlugin:function(e){e.removeRequestHandler("DrawPlugin.StartDrawingRequest",this.requestHandlers.startDrawingHandler),e.removeRequestHandler("DrawPlugin.StopDrawingRequest",this.requestHandlers.stopDrawingHandler),e.removeRequestHandler("DrawPlugin.GetGeometryRequest",this.requestHandlers.getGeometryHandler),e.unregister(this),this._map=null,this._sandbox=null},start:function(e){},stop:function(e){}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/DrawPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.plugin.HoverPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null},{__name:"MyPlaces.HoverPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this._map=e.getMap(),this.pluginName=e.getName()+this.__name},init:function(e){var t=this;OpenLayers.Control.Hover=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{delay:500,pixelTolerance:null,stopMove:!1},initialize:function(e){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions),OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Hover(this,{pause:this.onPause,move:this.onMove},this.handlerOptions)},onPause:function(e){},onMove:function(e){}}),this.hoverControl=new OpenLayers.Control.Hover({handlerOptions:{delay:500,pixelTolerance:6},onPause:function(n){var r=t._map.getLonLatFromPixel(n.xy),i=e.getEventBuilder("MyPlaces.MyPlaceHoverEvent")(r,n,t._map.getZoom());e.notifyAll(i)}}),this._map.addControl(this.hoverControl)},activate:function(){this.hoverControl.activate()},deactivate:function(){this.hoverControl.deactivate()},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,e.register(this)},stopPlugin:function(e){e.unregister(this),this._map=null,this._sandbox=null},start:function(e){},stop:function(e){}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/myplaces2/plugin/HoverPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.MyPlacesTab",function(e,t){this.instance=e,this.loc=t,this.tabsContainer=undefined,this.tabPanels={},this.linkTemplate=jQuery('<a href="JavaScript:void(0);"></a>'),this.iconTemplate=jQuery('<div class="icon"></div>')},{getName:function(){return"MyPlaces2.MyPlaces"},getTitle:function(){return this.loc.title},getTabsContainer:function(){return this.tabsContainer},getContent:function(){return this.tabsContainer.ui},initContainer:function(){this.tabsContainer=Oskari.clazz.create("Oskari.userinterface.component.TabDropdownContainer",this.loc.nocategories)},addTabContent:function(e){var t=this;this.initTabContent(),this.tabsContainer.ui.addClass("peikko"),e.append(this.tabsContainer.ui)},eventHandlers:{"MyPlaces.MyPlacesChangedEvent":function(e){var t=this.instance.sandbox.getService("Oskari.mapframework.bundle.myplaces2.service.MyPlacesService"),n=t.getAllCategories(),r=t.getAllMyPlaces(),i=this,s=function(e){return function(){var t=i.instance.sandbox.getRequestBuilder("MyPlaces.EditCategoryRequest")(e);return i.instance.sandbox.request(i.instance,t),!1}},o=function(e){return function(){var t=i.instance.sandbox.getRequestBuilder("MyPlaces.DeleteCategoryRequest")(e);return i.instance.sandbox.request(i.instance,t),!1}},u,a,f;for(u=0;u<n.length;++u){a=n[u].getId(),f=this.tabPanels[a],f?(f.setTitle(n[u].name),i.tabsContainer.updatePanel(f)):(f=this._createCategoryTab(n[u]),this.tabsContainer.addPanel(f),this.tabPanels[a]=f),this._populatePlaces(a),f.getContainer().empty(),f.grid.renderTo(f.getContainer());var l=this.linkTemplate.clone();l.addClass("categoryOp"),l.append(this.loc.editCategory),l.bind("click",s(a)),f.getContainer().append(l);var c=this.linkTemplate.clone();c.addClass("categoryOp"),c.append(this.loc.deleteCategory),c.bind("click",o(a)),f.getContainer().append(c)}this._removeObsoleteCategories()}},_showPlace:function(e,t){var n=e.getCentroid(),r=this.instance.sandbox.getRequestBuilder("MapMoveRequest")(n.x,n.y,e.getBounds(),!1);this.instance.sandbox.request(this.instance,r);var i="myplaces_"+t,s=this.instance.sandbox.findMapLayerFromSelectedMapLayers(i);if(!s){var o=this.instance.sandbox.getRequestBuilder("AddMapLayerRequest")(i,!0);this.instance.sandbox.request(this.instance,o)}},_editPlace:function(e){this._showPlace(e.geometry,e.categoryId);var t=this.instance.sandbox.getRequestBuilder("MyPlaces.EditPlaceRequest")(e.id);this.instance.sandbox.request(this.instance,t)},_deletePlace:function(e){var t=this,n=this.instance.sandbox,r=this.loc.notification["delete"],i=Oskari.clazz.create("Oskari.userinterface.component.Popup"),s=Oskari.clazz.create("Oskari.userinterface.component.Button");s.setTitle(r.btnDelete),s.addClass("primary"),s.setHandler(function(){i.close();var s=n.getService("Oskari.mapframework.bundle.myplaces2.service.MyPlacesService"),o=function(s){var o=e.categoryId,u="myplaces_"+o,a=n.findMapLayerFromSelectedMapLayers(u);if(a){var f=n.getRequestBuilder("MapModulePlugin.MapLayerUpdateRequest"),l=f(u,!0);n.request(t.instance,l)}s?i.show(r.title,r.success):i.show(r.title,r.error),i.fadeout()};s.deleteMyPlace(e.id,o)});var o=i.createCloseButton(r.btnCancel),u=r.confirm+'"'+e.name+'"'+"?";i.show(r.title,u,[o,s]),i.makeModal()},_getDrawModeFromGeometry:function(e){if(e===null)return null;var t=e.CLASS_NAME,n=null;if("OpenLayers.Geometry.MultiPoint"===t||"OpenLayers.Geometry.Point"===t)n="point";else if("OpenLayers.Geometry.MultiLineString"===t||"OpenLayers.Geometry.LineString"===t)n="line";else if("OpenLayers.Geometry.MultiPolygon"===t||"OpenLayers.Geometry.Polygon"===t)n="area";return n},_createCategoryTab:function(e){var t=this,n=e.getId(),r=Oskari.clazz.create("Oskari.userinterface.component.TabPanel");r.setId(n),r.setTitle(e.getName()),r.grid=Oskari.clazz.create("Oskari.userinterface.component.Grid");var i=["name","desc","createDate","updateDate","edit","delete"];r.grid.setVisibleFields(i);var s=function(e,n){var r=t.linkTemplate.clone(),i=t.iconTemplate.clone(),s=t._getDrawModeFromGeometry(n.geometry);return i.addClass("myplaces-"+s),r.append(i),r.append(e),r.bind("click",function(){return t._showPlace(n.geometry,n.categoryId),!1}),r};r.grid.setColumnValueRenderer("name",s);var o=function(e,n){var r=t.linkTemplate.clone();return r.append(e),r.bind("click",function(){return t._editPlace(n),!1}),r};r.grid.setColumnValueRenderer("edit",o);var u=function(e,n){var r=t.linkTemplate.clone();return r.append(e),r.bind("click",function(){return t._deletePlace(n),!1}),r};r.grid.setColumnValueRenderer("delete",u);var a,f;for(a=0;a<i.length;++a)f=i[a],r.grid.setColumnUIName(f,this.loc.grid[f]);return r},_populatePlaces:function(e){var t=this.instance.sandbox.getService("Oskari.mapframework.bundle.myplaces2.service.MyPlacesService"),n=t.getAllMyPlaces(),r=this.tabPanels[e],i=Oskari.clazz.create("Oskari.userinterface.component.GridModel");i.setIdField("id"),r.grid.setDataModel(i);var s;for(s=0;s<n.length;++s)n[s].getCategoryID()===e&&i.addData({id:n[s].getId(),name:n[s].getName(),desc:n[s].getDescription(),geometry:n[s].getGeometry(),categoryId:n[s].getCategoryID(),edit:this.loc.edit,"delete":this.loc["delete"],createDate:this._formatDate(t,n[s].getCreateDate()),updateDate:this._formatDate(t,n[s].getUpdateDate())})},_formatDate:function(e,t){var n=e.parseDate(t),r="";return n.length>0&&(r=n[0]),r},_removeObsoleteCategories:function(){var e=this.instance.sandbox.getService("Oskari.mapframework.bundle.myplaces2.service.MyPlacesService"),t,n;for(t in this.tabPanels)this.tabPanels.hasOwnProperty(t)&&(n=e.findCategory(t),n||(this.tabsContainer.removePanel(this.tabPanels[t]),this.tabPanels[t].grid=undefined,delete this.tabPanels[t].grid,this.tabPanels[t]=undefined,delete this.tabPanels[t]))},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(!t)return;return t.apply(this,[e])},bindEvents:function(){var e=this.instance,t=e.getSandbox(),n;for(n in this.eventHandlers)this.eventHandlers.hasOwnProperty(n)&&t.registerForEventByName(this,n)},unbindEvents:function(){var e=this.instance,t=e.getSandbox(),n;for(n in this.eventHandlers)this.eventHandlers.hasOwnProperty(n)&&t.unregisterFromEventByName(this,n)}}),define("bundles/framework/bundle/myplaces2/MyPlacesTab",function(){}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StopDrawingRequest",function(e){this._creator=null,this._isCancel=e==1},{__name:"DrawPlugin.StopDrawingRequest",getName:function(){return this.__name},isCancel:function(){return this._isCancel===!0}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StopDrawingRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StartDrawingRequest",function(e){if(e.geometry)this._geometry=e.geometry;else if(e.continueCurrent)this._continueCurrent=e.continueCurrent;else{if(!this.drawModes[e.drawMode])throw"Unknown draw mode '"+e.drawMode+"'";this._drawMode=e.drawMode}},{__name:"DrawPlugin.StartDrawingRequest",getName:function(){return this.__name},isModify:function(){return this._continueCurrent?!0:!1},drawModes:{point:"point",line:"line",area:"area",cut:"cut",box:"box"},getDrawMode:function(){return this._drawMode},getGeometry:function(){return this._geometry}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StartDrawingRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.GetGeometryRequest",function(e){this._creator=null,this._callbackMethod=e},{__name:"DrawPlugin.GetGeometryRequest",getName:function(){return this.__name},getCallBack:function(){return this._callbackMethod}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/GetGeometryRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.GetGeometryRequestPluginHandler",function(e,t){this.sandbox=e,this.drawPlugin=t},{handleRequest:function(e,t){var n=t.getCallBack();this.sandbox.printDebug("[Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.GetGeometryRequestPluginHandler] geometry requested");var r=this.drawPlugin.getDrawing();n(r.geometry)}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/GetGeometryRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StartDrawingRequestPluginHandler",function(e,t){this.sandbox=e,this.drawPlugin=t},{handleRequest:function(e,t){var n=t.getDrawMode();this.sandbox.printDebug("[Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StartDrawingRequestPluginHandler] Start Drawing: "+n),this.drawPlugin.startDrawing({drawMode:t.getDrawMode(),geometry:t.getGeometry(),isModify:t.isModify(),style:""})}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StartDrawingRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StopDrawingRequestPluginHandler",function(e,t){this.sandbox=e,this.drawPlugin=t},{handleRequest:function(e,t){this.sandbox.printDebug("[Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StopDrawingRequestPluginHandler] Stop drawing"),t.isCancel()?this.drawPlugin.stopDrawing():this.drawPlugin.forceFinishDraw()}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StopDrawingRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.request.EditPlaceRequest",function(e){this._placeId=e},{__name:"MyPlaces.EditPlaceRequest",getName:function(){return this.__name},getId:function(){return this._placeId}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/myplaces2/request/EditPlaceRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.request.EditCategoryRequest",function(e){this._categoryId=e},{__name:"MyPlaces.EditCategoryRequest",getName:function(){return this.__name},getId:function(){return this._categoryId}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/myplaces2/request/EditCategoryRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.request.DeleteCategoryRequest",function(e){this._categoryId=e},{__name:"MyPlaces.DeleteCategoryRequest",getName:function(){return this.__name},getId:function(){return this._categoryId}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/myplaces2/request/DeleteCategoryRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.request.PublishCategoryRequest",function(e,t){this._categoryId=e,this._isPublic=t==1},{__name:"MyPlaces.PublishCategoryRequest",getName:function(){return this.__name},getId:function(){return this._categoryId},isPublic:function(){return this._isPublic}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/myplaces2/request/PublishCategoryRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.request.EditRequestHandler",function(e,t){this.sandbox=e,this.instance=t},{handleRequest:function(e,t){var n=e.getSandbox();t.getName()=="MyPlaces.EditPlaceRequest"?this._handleEditPlace(n,t):t.getName()=="MyPlaces.EditCategoryRequest"?this._handleEditCategory(n,t):t.getName()=="MyPlaces.DeleteCategoryRequest"?this._handleDeleteCategory(n,t):t.getName()=="MyPlaces.PublishCategoryRequest"&&this._handlePublishCategory(n,t)},_handleEditPlace:function(e,t){this.sandbox.printDebug("[Oskari.mapframework.bundle.myplaces2.request.EditRequestHandler] edit requested for place "+t.getId());var n=this.instance.getService(),r=n.findMyPlace(t.getId());if(r){var i=r.getGeometry().getCentroid(),s={lon:i.x,lat:i.y};this.instance.getDrawPlugin().startDrawing({geometry:r.getGeometry()}),this.instance.getMainView().showPlaceForm(s,r)}},_handleEditCategory:function(e,t){this.sandbox.printDebug("[Oskari.mapframework.bundle.myplaces2.request.EditRequestHandler] edit requested for category "+t.getId());var n=this.instance.getService(),r=n.findCategory(t.getId());r&&this.instance.getCategoryHandler().editCategory(r)},_handleDeleteCategory:function(e,t){this.sandbox.printDebug("[Oskari.mapframework.bundle.myplaces2.request.EditRequestHandler] delete requested for category "+t.getId());var n=this.instance.getService(),r=n.findCategory(t.getId());r&&this.instance.getCategoryHandler().confirmDeleteCategory(r)},_handlePublishCategory:function(e,t){this.sandbox.printDebug("[Oskari.mapframework.bundle.myplaces2.request.EditRequestHandler] (un/)publish requested for category "+t.getId());var n=this.instance.getService(),r=n.findCategory(t.getId());r&&this.instance.getCategoryHandler().confirmPublishCategory(r,t.isPublic())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/myplaces2/request/EditRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.service.MyPlacesService",function(e,t,n,r,i){this._categoryList=[],this._placesList=[],this.wfstStore=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.service.MyPlacesWFSTStore",e,t,i.featureNS),this._sandbox=n,this.defaultCategory=null,this.defaults=r,this._instance=i},{__qname:"Oskari.mapframework.bundle.myplaces2.service.MyPlacesService",getQName:function(){return this.__qname},__name:"MyPlacesService",getName:function(){return this.__name},init:function(){var e=this;this.wfstStore.connect();var t=!1,n=!1,r=function(){n&&t&&e._notifyDataChanged()},i=function(n){if(n){var i;for(i=0;i<n.length;++i)e._addCategory(n[i])}var s=function(){t=!0,r()};e.getDefaultCategory()?s():e._createDefaultCategory(s)},s=function(t){t&&(e._placesList=t),n=!0,r()};this.wfstStore.getCategories(i),this.wfstStore.getMyPlaces(s)},_createDefaultCategory:function(e){var t=this,n=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.model.MyPlacesCategory");n.setName(t.defaultCategoryName),t.defaultCategoryName||n.setName("My map layer"),n.setName(this.defaults.name),n.setDotShape(this.defaults.point.shape),n.setDotColor(this.defaults.point.color),n.setDotSize(this.defaults.point.size),n.setLineStyle(this.defaults.line.style),n.setLineCap(this.defaults.line.cap),n.setLineCorner(this.defaults.line.corner),n.setLineWidth(this.defaults.line.width),n.setLineColor(this.defaults.line.color),n.setAreaLineWidth(this.defaults.area.linewidth),n.setAreaLineCorner(this.defaults.area.linecorner),n.setAreaLineStyle(this.defaults.area.linestyle),n.setAreaLineColor(this.defaults.area.linecolor),n.setAreaFillColor(this.defaults.area.color),n.setAreaFillStyle(this.defaults.area.fill),n.setDefault(!0);var r=function(){t.getAllCategories().length===0?t._instance.forceDisable():e()};this.saveCategory(n,r)},_addCategory:function(e){e.isDefault()&&(this.defaultCategory=e),this._categoryList.push(e)},_movePlacesToCategory:function(e,t,n){var r=this,i=r.getPlacesInCategory(e),s;if(i.length===0){n(!0);return}for(s=0;s<i.length;s++)i[s].setCategoryID(t);var o=function(e,t){r._notifyDataChanged(),n(e)};this.wfstStore.commitMyPlaces(i,o)},_deletePlacesInCategory:function(e,t){var n=this.getPlacesInCategory(e),r=[],i;for(i=0;i<n.length;i++)r.push(n[i].getId());if(r.length===0){t(!0);return}var s=this,o=function(e,r){if(e){var i;for(i=0;i<n.length;i++)s._removeMyPlace(r[i]);s._notifyDataChanged()}t(e)};this.wfstStore.deleteMyPlaces(r,o)},parseDate:function(e){if(!e&&e.length<10)return[];var t=e.substring(0,4),n=e.substring(5,7),r=e.substring(8,10),i=[r+"."+n+"."+t],s="";if(e.length===29){s=e.substring(11);var o=s.split("+");s=o[0],s=s.split(".")[0];var u=s.split(":"),a=u[0],f=u[1],l=u[2];s=a+":"+f+":"+l,i.push(s)}return i},getPlacesInCategory:function(e){var t=[],n;for(n=0;n<this._placesList.length;n++)this._placesList[n].getCategoryID()===e&&t.push(this._placesList[n]);return t},deleteCategory:function(e,t,n){var r=this,i=function(t){t?r._deleteEmptyCategory(e,n):n(t)};if(t===!0){var s=r.getDefaultCategory();r._movePlacesToCategory(e,s.getId(),i)}else r._deletePlacesInCategory(e,i)},_deleteEmptyCategory:function(e,t){var n=this,r=function(e,r){e&&n._removeCategory(r[0]),t(e),n._notifyDataChanged()};this.wfstStore.deleteCategories([e],r)},_removeCategory:function(e){var t;for(t=0;t<this._categoryList.length;t++)if(this._categoryList[t].getId()===e){this._categoryList.splice(t,1);break}},saveCategory:function(e,t){var n=this,r=!e.getId(),i=function(i,s){if(r&&i)n._addCategory(s[0]);else{var o=n.findCategory(s[0].getId());o?(o.setName(e.getName()),o.setDotSize(e.getDotSize()),o.setDotColor(e.getDotColor()),o.setDotShape(e.getDotShape()),o.setLineWidth(e.getLineWidth()),o.setLineColor(e.getLineColor()),o.setLineCap(e.getLineCap()),o.setLineCorner(e.getLineCorner()),o.setLineStyle(e.getLineStyle()),o.setAreaLineWidth(e.getAreaLineWidth()),o.setAreaLineCorner(e.getAreaLineCorner()),o.setAreaLineStyle(e.getAreaLineStyle()),o.setAreaLineColor(e.getAreaLineColor()),o.setAreaFillColor(e.getAreaFillColor()),o.setAreaFillStyle(e.getAreaFillStyle()),o.setDefault(e.isDefault())):i=!1}n._notifyDataChanged(),t(i,s[0],r)};this.wfstStore.commitCategories([e],i)},getAllCategories:function(){return this._categoryList},getDefaultCategory:function(){return this.defaultCategory},_addMyPlace:function(e){this._placesList.push(e)},_removeMyPlace:function(e){var t=this.findBy(this._placesList,"id",e);t!==-1&&this._placesList.splice(t,1)},_notifyDataChanged:function(){var e=this._sandbox.getEventBuilder("MyPlaces.MyPlacesChangedEvent")();this._sandbox.notifyAll(e)},deleteMyPlace:function(e,t){var n=this,r=function(e,r){e&&(n._removeMyPlace(r[0]),n._notifyDataChanged()),t(e,r[0])};this.wfstStore.deleteMyPlaces([e],r)},findMyPlaceByLonLat:function(e,t){var n=[],r=this.getAllMyPlaces(),i,s,o,u;for(i=0;i<r.length;++i)s=r[i].getGeometry(),o=!1,"OpenLayers.Geometry.Point"===s.CLASS_NAME?(u=720-t*t*5,t>10?u=5:t>8?u=20:t>5&&(u=50),o=s.atPoint(e,u,u)):o=s.atPoint(e),o&&n.push(r[i]);return n},findMyPlace:function(e){var t=this.findBy(this._placesList,"id",e);return t!==-1?this._placesList[t]:null},findCategory:function(e){var t=this.findBy(this._categoryList,"id",e);return t!==-1?this._categoryList[t]:null},findBy:function(e,t,n){var r;for(r=0;r<e.length;r++)if(e[r][t]===n)return r;return-1},saveMyPlace:function(e,t){var n=this,r=!e.getId(),i=function(i,s){if(r&&i)n._addMyPlace(s[0]);else if(s.length<1)i=!1;else{var o=n.findMyPlace(s[0].getId());o?(o.setName(e.getName()),o.setDescription(e.getDescription()),o.setLink(e.getLink()),o.setCategoryID(e.getCategoryID()),o.setGeometry(e.getGeometry()),o.setUpdateDate(s[0].getUpdateDate())):i=!1}n._notifyDataChanged(),t(i,s[0],r)};this.wfstStore.commitMyPlaces([e],i)},getAllMyPlaces:function(){return this._placesList},publishCategory:function(e,t,n){var r=this.findCategory(e);r||n(!1);var i=this,s=this._sandbox.getAjaxUrl();jQuery.ajax({type:"GET",dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},data:{id:r.getId(),makePublic:t},url:s+"action_route=PublishMyPlaceLayer",success:function(e){e?(r.setPublic(t),n(!0),i._notifyDataChanged()):n(!1)},error:function(e,t){e.status!==0&&n(!1)}})}},{protocol:["Oskari.mapframework.service.Service"]}),define("bundles/framework/bundle/myplaces2/service/MyPlacesService",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.service.MyPlacesWFSTStore",function(e,t,n){this.uuid=t,this.protocols={},this.url=e,this.featureNS=n},{connect:function(){var e=this.url;this.protocols.categories=new OpenLayers.Protocol.WFS({version:"1.1.0",srsName:"EPSG:3067",featureType:"categories",featureNS:this.featureNS,url:e}),this.protocols.my_places=new OpenLayers.Protocol.WFS({version:"1.1.0",srsName:"EPSG:3067",geometryName:"geometry",featureType:"my_places",featureNS:this.featureNS,url:e})},getCategories:function(e){var t=this.uuid,n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"uuid",value:t}),r=this.protocols.categories,i=this;r.read({filter:n,callback:function(t){i._handleCategoriesResponse(t,e)}})},_handleCategoriesResponse:function(e,t){var n=this.uuid,r=e.features;if(r===null||r===undefined||r.length===0){t&&t();return}var i=[],s,o,u,a,f;for(s=0;s<r.length;s++)o=r[s],u=o.attributes,a=this._parseNumericId(o.fid),f=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.model.MyPlacesCategory"),f.setId(a),f.setName(u.category_name),f.setDefault("true"===u["default"]),f.setLineWidth(u.stroke_width),f.setLineStyle(u.stroke_dasharray),f.setLineCap(u.stroke_linecap),f.setLineCorner(u.stroke_linejoin),f.setLineColor(this._formatColorFromServer(u.stroke_color)),f.setAreaLineWidth(u.border_width),f.setAreaLineStyle(u.border_dasharray),f.setAreaLineCorner(u.border_linejoin),f.setAreaLineColor(this._formatColorFromServer(u.border_color)),f.setAreaFillColor(this._formatColorFromServer(u.fill_color)),f.setAreaFillStyle(u.fill_pattern),f.setDotShape(u.dot_shape),f.setDotColor(this._formatColorFromServer(u.dot_color)),f.setDotSize(u.dot_size),f.setUUID(n),u.publisher_name&&f.setPublic(!0),i.push(f);t&&t(i)},_formatColorFromServer:function(e){return e.charAt(0)==="#"?e.substring(1):e},_prefixColorForServer:function(e){return e.charAt(0)!=="#"?"#"+e:e},commitCategories:function(e,t){var n=this.uuid,r=this.protocols.categories,i=this,s=[],o,u,a,f,l;for(o=0;o<e.length;o++)u=e[o],a=u.getId(),f={category_name:u.getName(),"default":u.isDefault(),stroke_width:u.getLineWidth(),stroke_dasharray:u.getLineStyle(),stroke_linecap:u.getLineCap(),stroke_linejoin:u.getLineCorner(),stroke_color:this._prefixColorForServer(u.getLineColor()),border_width:u.getAreaLineWidth(),border_dasharray:u.getAreaLineStyle(),border_linejoin:u.getAreaLineCorner(),border_color:this._prefixColorForServer(u.getAreaLineColor()),fill_color:this._prefixColorForServer(u.getAreaFillColor()),fill_pattern:u.getAreaFillStyle(),dot_color:this._prefixColorForServer(u.getDotColor()),dot_size:u.getDotSize(),dot_shape:u.getDotShape(),uuid:n},l=new OpenLayers.Feature.Vector(null,f),a?(l.fid=r.featureType+"."+a,l.state=OpenLayers.State.UPDATE):l.toState(OpenLayers.State.INSERT),s.push(l);r.commit(s,{callback:function(n){i._handleCommitCategoriesResponse(n,e,t)}})},_handleCommitCategoriesResponse:function(e,t,n){if(e.success()){var r=e.reqFeatures,i,s,o=[],u=e.insertIds||[],a,f,l;for(a=0,l=r.length;a<l;++a)s=r[a],i=s.state,i&&(i===OpenLayers.State.INSERT&&(s.fid=u[a],s.attributes.id=s.fid,f=this._parseNumericId(s.fid),t[a].setId(f)),s.state=null);n(!0,t)}else n(!1,t)},deleteCategories:function(e,t){var n=this.protocols.categories,r=this.uuid,i=[],s,o,u,a;for(s=0;s<e.length;s++){o=e[s];if(!o)continue;u={uuid:r},a=new OpenLayers.Feature.Vector(null,u),a.fid=n.featureType+"."+o,a.state=OpenLayers.State.DELETE,i.push(a)}var f=this;n.commit(i,{callback:function(n){f._handleDeleteCategoriesResponse(n,e,t)}})},_handleDeleteCategoriesResponse:function(e,t,n){e.success()?n(!0,t):n(!1,t)},_parseNumericId:function(e){var t=e.split(".")[1];return t},getMyPlaces:function(e){var t=this.uuid,n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"uuid",value:t}),r=this.protocols.my_places,i=this;r.read({filter:n,callback:function(t){i._handleMyPlacesResponse(t,e)}})},_handleMyPlacesResponse:function(e,t){var n=this.uuid,r=[],i=e.features;if(i===null||i===undefined||i.length===0||jQuery.isEmptyObject(i)){t&&t(r);return}var s,o,u,a,f;for(s=0;s<i.length;s++)o=i[s],u=o.attributes,a=this._parseNumericId(o.fid),f=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.model.MyPlace"),f.setId(a),f.setName(u.name),f.setDescription(u.place_desc),f.setLink(u.link),f.setImageLink(u.image_url),f.setCategoryID(u.category_id),f.setCreateDate(u.created),f.setUpdateDate(u.updated),f.setGeometry(o.geometry),f.setUUID(n),r.push(f);t&&t(r)},getMyPlacesByIdList:function(e,t){var n=this.uuid,r=this.protocols.my_places,i=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"uuid",value:n}),new OpenLayers.Filter.FeatureId({fids:e})]}),s=this;r.read({filter:i,callback:function(e){s._handleMyPlacesResponse(e,t)}})},commitMyPlaces:function(e,t){var n=this.protocols.my_places,r=this.uuid,i=[],s,o,u,a,f,l;for(s=0;s<e.length;s++)o=e[s],u=o.getId(),a=o.getGeometry(),f={name:o.getName(),place_desc:o.getDescription(),link:o.getLink(),image_url:o.getImageLink(),category_id:o.getCategoryID(),uuid:r},l=new OpenLayers.Feature.Vector(a,f),u?(l.fid=n.featureType+"."+u,l.state=OpenLayers.State.UPDATE):l.toState(OpenLayers.State.INSERT),i.push(l);var c=this;n.commit(i,{callback:function(n){c._handleCommitMyPlacesResponse(n,e,t)}})},_handleCommitMyPlacesResponse:function(e,t,n){if(e.success()){var r=e.reqFeatures,i,s,o=[],u=e.insertIds||[],a=[],f,l,c;for(f=0,c=r.length;f<c;++f)s=r[f],i=s.state,i&&(i===OpenLayers.State.INSERT?(s.fid=u[f],s.attributes.id=s.fid,l=this._parseNumericId(s.fid),t[f].setId(l),a.push(l)):a.push(t[f].getId()),s.state=null);var h=function(e){e.length<1?n(!1,e):n(!0,e)};this.getMyPlacesByIdList(a,h)}else n(!1,t)},deleteMyPlaces:function(e,t){var n=this.protocols.my_places,r=this.uuid,i=[],s,o,u,a;for(s=0;s<e.length;s++){o=e[s];if(!o)continue;u={uuid:r},a=new OpenLayers.Feature.Vector(null,u),a.fid=n.featureType+"."+o,a.state=OpenLayers.State.DELETE,i.push(a)}var f=this;n.commit(i,{callback:function(n){f._handleDeleteMyPlacesResponse(n,e,t)}})},_handleDeleteMyPlacesResponse:function(e,t,n){e.success()?n(!0,t):n(!1,t)},disconnect:function(){}}),define("bundles/framework/bundle/myplaces2/service/MyPlacesWFSTStore",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.view.MainView",function(e){this.instance=e,this.popupId="myplacesForm",this.form=undefined},{__name:"MyPlacesMainView",getName:function(){return this.__name},getSandbox:function(){return this.instance.sandbox},init:function(){},start:function(){var e=this,t=this.instance.sandbox,n;t.register(e);for(n in e.eventHandlers)e.eventHandlers.hasOwnProperty(n)&&t.registerForEventByName(e,n);var r=t.findRegisteredModuleInstance("MainMapModule"),i={id:"MyPlaces",multipart:!0},s=Oskari.clazz.create("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin",i);r.registerPlugin(s),r.startPlugin(s),this.drawPlugin=s},stop:function(){var e=this.instance.sandbox,t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.unregisterFromEventByName(this,t);e.unregister(this)},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(!t)return;return t.apply(this,[e])},eventHandlers:{"Toolbar.ToolSelectedEvent":function(e){this._cleanupPopup()},"DrawPlugin.FinishedDrawingEvent":function(e){this._handleFinishedDrawingEvent(e)}},_handleFinishedDrawingEvent:function(e){var t=e.getDrawing().getCentroid(),n={lon:t.x,lat:t.y};this.showPlaceForm(n)},showPlaceForm:function(e,t){var n=this,r=this.instance.sandbox;r.postRequestByName("DisableMapKeyboardMovementRequest");var i=this.instance.getLocalization();this.form=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.view.PlaceForm",this.instance);var s=this.instance.getService().getAllCategories();if(t){var o={place:{id:t.getId(),name:t.getName(),link:t.getLink(),imageLink:t.getImageLink(),desc:t.getDescription(),category:t.getCategoryID()}};this.form.setValues(o)}var u=[{html:n.form.getForm(s),useButtons:!0,primaryButton:i.buttons.save,actions:{}}];u[0].actions[i.buttons.cancel]=function(){n._cleanupPopup();var e=n.instance.sandbox.getRequestBuilder("Toolbar.SelectToolButtonRequest")();n.instance.sandbox.request(n,e)},u[0].actions[i.buttons.save]=function(){n._saveForm()};var a=r.getRequestBuilder("InfoBox.ShowInfoBoxRequest")(this.popupId,i.placeform.title,u,e,!0);r.request(n.getName(),a)},_validateForm:function(e){var t=[],n=this.instance.getCategoryHandler();t=n.validateCategoryFormValues(e.category);var r=this.instance.getLocalization("validation");return e.place.name?n.hasIllegalChars(e.place.name)&&t.push({name:"name",error:r.placeNameIllegal}):t.push({name:"name",error:r.placeName}),n.hasIllegalChars(e.place.desc)&&t.push({name:"desc",error:r.descIllegal}),t},_showValidationErrorMessage:function(e){var t=this.instance.getLocalization(),n=Oskari.clazz.create("Oskari.userinterface.component.Popup"),r=n.createCloseButton(t.buttons.ok),i=jQuery("<ul></ul>"),s,o;for(s=0;s<e.length;++s)o=jQuery("<li></li>"),o.append(e[s].error),i.append(o);n.show(t.validation.title,i,[r])},_saveForm:function(){if(!this.form)return;var e=this,t=this.form.getValues(),n=this._validateForm(t);if(n.length!==0){this._showValidationErrorMessage(n);return}if(t.category){var r=this.instance.getCategoryHandler().getCategoryFromFormValues(t.category),i=function(n,r,i){if(n)t.place.category=r.getId(),e.__savePlace(t.place);else{var s=e.instance.getLocalization("notification").error;i?e.instance.showMessage(s.title,s.addCategory):e.instance.showMessage(s.title,s.editCategory)}};this.instance.getService().saveCategory(r,i)}else this.__savePlace(t.place)},__savePlace:function(e){var t=this,n;if(!e){n=t.instance.getLocalization("notification").error,t.instance.showMessage(n.title,n.savePlace);return}var r=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.model.MyPlace"),i=-1;e.id&&(r=this.instance.getService().findMyPlace(e.id),i=r.getCategoryID()),r.setId(e.id),r.setName(e.name),r.setLink(e.link),r.setImageLink(e.imageLink),r.setDescription(e.desc),r.setCategoryID(e.category),r.setGeometry(this.drawPlugin.getDrawing());var s=this.instance.sandbox,o=function(e,o,u){if(e){var a=t.instance.getCategoryHandler()._getMapLayerId(r.getCategoryID()),f=s.getRequestBuilder("AddMapLayerRequest"),l=s.getRequestBuilder("MapModulePlugin.MapLayerUpdateRequest"),c,h=f(a,!0);s.request(t,h),u?(c=l(a,!0),s.request(t,c)):(c=l(a,!0),s.request(t,c),i!==r.getCategoryID()&&(a=t.instance.getCategoryHandler()._getMapLayerId(i),h=f(a,!0),s.request(t,h))),t._cleanupPopup();var p=Oskari.clazz.create("Oskari.userinterface.component.Popup");n=t.instance.getLocalization("notification").placeAdded,p.show(n.title,n.message),p.fadeout(),t.drawPlugin.stopDrawing()}else n=t.instance.getLocalization("notification").error,t.instance.showMessage(n.title,n.savePlace)};this.instance.getService().saveMyPlace(r,o)},_cleanupPopup:function(){if(!this.form)return;var e=this.instance.sandbox,t=e.getRequestBuilder("InfoBox.HideInfoBoxRequest")(this.popupId);e.request(this,t),this.form.destroy(),this.form=undefined,e.postRequestByName("EnableMapKeyboardMovementRequest"),this.instance.enableGfi(!0)}},{protocol:["Oskari.mapframework.module.Module"]}),define("bundles/framework/bundle/myplaces2/view/MainView",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.view.PlaceForm",function(e){this.instance=e,this.newCategoryId="-new-",this.placeId=undefined,this.initialValues=undefined;var t=e.getLocalization("placeform");this.template=jQuery('<div class="myplacesform"><div class="field"><div class="help icon-info" title="'+t.tooltip+'"></div>'+'<input type="text" name="placename" placeholder="'+t.placename.placeholder+'"/>'+"</div>"+'<div class="field">'+'<textarea name="placedesc" placeholder="'+t.placedesc.placeholder+'">'+"</textarea>"+"</div>"+'<div class="field">'+'<input type="text" name="placelink" placeholder="'+t.placelink.placeholder+'"/>'+"</div>"+'<div class="field">'+'<input type="text" name="imagelink" placeholder="'+t.imagelink.placeholder+'"/>'+"</div>"+'<div class="field imagePreview">'+"<label>"+t.imagelink.previewLabel+'</label><br clear="all" />'+'<a class="myplaces_imglink" target="_blank"><img src=""></img></a>'+"</div>"+'<div class="field" id="newLayerForm">'+'<label for="category">'+'<a href="#" class="newLayerLink">'+t.category.newLayer+"</a>"+t.category.choose+'</label><br clear="all" />'+'<select name="category" autofocus>'+"</select>"+"</div>"+"</div>"),this.templateOption=jQuery("<option></option>"),this.categoryForm=undefined},{getForm:function(e){var t=this.template.clone(),n=this.instance.getLocalization("placeform");if(e){var r=t.find("select[name=category]"),i,s,o;for(s=0;s<e.length;++s)o=e[s],i=this.templateOption.clone(),i.append(o.getName()),i.attr("value",o.getId()),this.initialValues?this.initialValues.place.category===o.getId()&&i.attr("selected","selected"):o.isDefault()&&i.attr("selected","selected"),r.append(i);this._bindCategoryChange()}return this._bindImageUrlChange(),this._bindCreateNewLayer(),this.initialValues&&(t.find("input[name=placename]").attr("value",this.initialValues.place.name),t.find("textarea[name=placedesc]").append(this.initialValues.place.desc),t.find("input[name=placelink]").attr("value",this.initialValues.place.link),t.find("input[name=imagelink]").attr("value",this.initialValues.place.imageLink)),t},getValues:function(){var e={},t=this._getOnScreenForm();if(t.length>0){var n=t.find("input[name=placename]").val(),r=t.find("textarea[name=placedesc]").val(),i=t.find("input[name=placelink]").val();if(i){if(i.indexOf("://")===-1||i.indexOf("://")>6)i="http://"+i;i=i.replace("<",""),i=i.replace(">","")}var s=t.find("input[name=imagelink]").val(),o=t.find("select[name=category]").val();e.place={name:n,desc:r,link:i,imageLink:s,category:o},this.placeId&&(e.place.id=this.placeId)}return this.categoryForm&&(e.category=this.categoryForm.getValues()),e},setValues:function(e){this.placeId=e.place.id;var t=this._getOnScreenForm();t.length>0&&(t.find("input[name=placename]").val(e.place.name),t.find("textarea[name=placedesc]").val(e.place.desc),t.find("input[name=placelink]").val(e.place.link),t.find("input[name=imagelink]").val(e.place.imageLink),t.find("select[name=category]").val(e.place.category)),this.initialValues=e},_bindCategoryChange:function(){var e=this,t=this._getOnScreenForm();t.find("select[name=category]").live("change",function(){e.categoryForm&&(e.categoryForm.destroy(),e.categoryForm=undefined)})},_bindImageUrlChange:function(){var e=this,t=e._getOnScreenForm();t.find("input[name=imagelink]").live("change",function(){var t=e._getOnScreenForm(),n=jQuery(this).val();t.find("div.imagePreview").find("img").attr("src",n),t.find("a.myplaces_imglink").attr({href:n})})},_bindCreateNewLayer:function(){var e=this,t=e._getOnScreenForm();t.find("a.newLayerLink").live("click",function(t){var n=e._getOnScreenForm();t.preventDefault(),e.categoryForm=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.view.CategoryForm",e.instance),n.find("div#newLayerForm").html(e.categoryForm.getForm()),e.categoryForm.start()})},destroy:function(){var e=this._getOnScreenForm();e.find("select[name=category]").die(),e.find("input[name=imagelink]").die(),e.find("a.newLayerLink").die(),this.categoryForm&&(this.categoryForm.destroy(),this.categoryForm=undefined)},_getOnScreenForm:function(){return jQuery("div.myplacesform")}}),define("bundles/framework/bundle/myplaces2/view/PlaceForm",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.view.PointForm",function(e){this.instance=e,this.loc=e.getLocalization("pointform"),this.defaultValues={size:e.myPlacesService.defaults.point.size,color:e.myPlacesService.defaults.point.color,shape:e.myPlacesService.defaults.point.shape},this.values={size:this.defaultValues.size,color:this.defaultValues.color,shape:this.defaultValues.shape},this.instance.conf&&this.instance.conf.defaults&&this.instance.conf.defaults.dotMinSize?this.minSize=this.instance.conf.defaults.dotMinSize:this.minSize=1,this.instance.conf&&this.instance.conf.defaults&&this.instance.conf.defaults.dotMaxSize?this.maxSize=this.instance.conf.defaults.dotMaxSize:this.maxSize=5,this.basicColors=["#ffffff","#666666","#ffde00","#f8931f","#ff3334","#bf2652","#000000","#cccccc","#652d90","#3233ff","#26bf4b","#00ff01"],this.activeColorCell=6,this.symbolButtons={square:{iconCls:"marker-square",iconId:1,shape:{data:{paths:[],polygons:[[[310,68],[112,68],[112,266],[166.615,266],[210.583,335.832],[254.551,266],[310,266]]],circles:[]},offset:[210.583,335.832]}},dot:{iconCls:"marker-dot",iconId:5,shape:{data:{paths:[],polygons:[],circles:[{cx:195.782,cy:185.718,r:93.782}]},offset:[195.782,185.718]}},arrow:{iconCls:"marker-arrow",iconId:6,shape:{data:{paths:[],polygons:[[[249,214],[249,69],[162,69],[162,214],[101.123,214],[205.25,331.832],[309.377,214]]],circles:[]},offset:[205.25,331.832]}},pin:{iconCls:"marker-pin",iconId:3,shape:{data:{paths:[],polygons:[[[183.893,323],[210.506,212.198],[191.684,208.229],[164.713,323]]],circles:[{cx:217.199,cy:131,r:68}]},offset:[174.303,323]}},pin2:{iconCls:"marker-pin2",iconId:2,shape:{data:{paths:[[["move",[197.282,57.936],!1],["curveC",[-51.795,0,-93.782,41.988,-93.782,93.782],!0],["curveC",[0,51.795,93.782,174.782,93.782,174.782],!0],["smoothC",[93.782,-122.987,93.782,-174.782],!0],["curveC",[291.064,99.923,249.076,57.936,197.282,57.936],!1],["close","",""]],[["move",[197.5,190.5],!1],["curveC",[-21.263,0,-38.5,-17.236,-38.5,-38.5],!0],["smoothC",[17.237,-38.5,38.5,-38.5],!0],["smoothC",[236,130.736,236,152],!1],["smoothC",[218.763,190.5,197.5,190.5],!1],["close","",""]]],polygons:[],circles:[]},offset:[197.282,57.936]}},stud:{iconCls:"marker-stud",iconId:0,shape:{data:{paths:[[["move",[228.465,61.808],!1],["curveC",[-34.129,-6.2,-74.84,2.725,-67.242,18.748],!0],["curveC",[10.313,21.754,18.316,38.636,24.535,51.754],!0],["curveC",[-13.525,13.08,-32.082,31.028,-57.578,55.687],!0],["curveC",[-15.447,14.94,26.929,42.415,68.291,49.929],!0],["curveC",[41.36,7.514,90.696,-3.301,81.49,-22.719],!0],["curveC",[-15.194,-32.051,-26.254,-55.379,-34.314,-72.38],!0],["curveC",[10.436,-10.093,23.865,-23.081,41.171,-39.818],!0],["curveC",[297.564,90.681,262.596,68.009,228.465,61.808],!1],["close","",""]]],polygons:[[[187.893,328],[201.506,253.198],[182.684,249.229],[168.713,328]]],circles:[]},offset:[178.303,328]}},flag:{iconCls:"marker-flag",iconId:4,shape:{data:{paths:[],polygons:[[[270.732,341],[333.817,76.259],[313.429,76.248],[250.647,341]],[[117.579,76],[144.322,145.722],[85,215],[265.541,215],[298.314,76]]],circles:[]},offset:[260.6895,341]}}},this.templateSymbolDialogContent=jQuery('<div class="pointform"><div class="container"><div class="column1"><label>'+this.loc.symbol.label+"</label>"+'<div class="symbols icon-buttons"></div>'+"<label>"+this.loc.size.label+"</label><br>"+'<div class="sizer-values"></div>'+'<div class="sizer"></div>'+"</div>"+'<div class="column2">'+'<div class="column21">'+"<label>"+this.loc.color.label+"</label>"+'<div class="color-grid">'+'<div class="color-rectangle"></div>'+"</div>"+'<div class="color-label">'+"<label>"+this.loc.color.labelOr+"</label>"+"</div>"+'<div class="color-source-selector">'+"<label>"+this.loc.color.labelCustom+"</label>"+"</div>"+'<div class="custom-colors"></div>'+"</div>"+'<div class="column22">'+"<label>"+this.loc.preview.label+"</label>"+'<div class="preview"></div>'+"</div>"+"</div>"+"</div>"+"</div>"),this.templateSymbolButton=jQuery('<div class="icon-button"></div>'),this.templateColorCell=jQuery('<div class="color-cell"></div>'),this.templateCustomColor=jQuery('<div class="custom-color-editor"><div class="colorcontainer"><div class="colorcolumn1"></div><div class="colorcolumn2"><div class="colorcolumn21"></div><div class="colorcolumn22"></div></div></div>'),this.templateColorSource=jQuery('<input type="checkbox" name="colorInput" value = "custom" class="color-source">'),this.templateColorValue=jQuery('<label class="color-label"></label><br><input type="text" name="color-input" value="0" disabled="disabled" class="custom-color">'),this.templateSizerValue=jQuery('<div class="sizer-value"></div>'),this.previewSize=50},{showForm:function(e,t){var n=this;t!==null&&t!==undefined&&jQuery.extend(!0,n.values,t.dot);var r=Oskari.clazz.create("Oskari.userinterface.component.Popup");r.addClass("renderdialog"),r.addClass("pointvisualization");var i=n.loc.title,s=n.templateSymbolDialogContent.clone(),o=s.find("div.symbols"),u,a,f;for(u in this.symbolButtons)this.symbolButtons.hasOwnProperty(u)&&(a=this.templateSymbolButton.clone(),f=this.symbolButtons[u],a.addClass(f.iconCls),a.attr("id",f.iconId+"marker"),f.iconId===n.values.shape&&a.css("border","2px solid"),a.click(function(){n.values.shape=parseInt(jQuery(this).attr("id").charAt(0),10),n._selectButton(n.values.shape),n._updatePreview(s)}),o.append(a));var l=10,c=110,h=n.maxSize-n.minSize,p=c/h,d=0,v,m,g;o=s.find(".sizer-values");for(v=1;v<=l;v++)m=n.templateSizerValue.clone(),m.html(v),m.addClass("value"+v),v<n.minSize||v>n.maxSize?m.hide():(g=d*p.toString()+"px",m.css("left",g),m.show(),d+=1),o.append(m);o=s.find(".sizer"),o.slider({range:"min",min:n.minSize,max:n.maxSize,value:this.values.size,slide:function(e,t){n.values.size=t.value,n._updatePreview(s)}});var y=!1,b,w,E;o=s.find(".color-rectangle");for(v=0;v<n.basicColors.length;v++)b=n.templateColorCell.clone(),b.css("background-color",n.basicColors[v]),w="ColorCell",E=v+w,E.length===w.length+1&&(E="0"+E),b.attr("id",E),b.click(function(){if(jQuery(".color-source").prop("checked"))return;var e=parseInt(this.id.substring(0,2),10);if(e===n.activeColorCell)return;if(n.activeColorCell>-1){var t=n.activeColorCell.toString();n.activeColorCell<10&&(t="0"+t),jQuery("#"+t+"ColorCell").css("border","1px solid #000000")}n.values.color=n.instance.rgbToHex(this.style.backgroundColor),n.activeColorCell=e,e<10&&(e="0"+e.toString()),jQuery("#"+e+"ColorCell").css("border","3px solid #ffffff"),n._updatePreview(s)}),"#"+n.values.color===n.basicColors[v]&&(b.css("border","3px solid #ffffff"),n.activeColorCell=v,y=!0),o.append(b);o=s.find(".color-source-selector");var S=n.templateColorSource.clone();S.change(function(){jQuery("input.custom-color").prop("disabled",!this.checked);var e=jQuery("#"+n.activeColorCell+"ColorCell");this.checked?e.css("border","1px solid #000000"):e.css("border","3px solid #ffffff"),n._updatePreview(s)}),o.prepend(S),y||(S.checked=!0,o.find("input.color-source").prop("disabled",!1).attr("checked","checked")),o=s.find(".custom-colors");var x=this.templateCustomColor.clone();o.append(x);var T=n.templateColorValue.clone();T.addClass("custom-red-value"),s.find(".colorcolumn1").append(T),s.find("label.custom-red-value").text("R");var N=n.templateColorValue.clone();N.addClass("custom-green-value"),s.find(".colorcolumn21").append(N),s.find("label.custom-green-value").text("G");var C=n.templateColorValue.clone();C.addClass("custom-blue-value"),s.find(".colorcolumn22").append(C),s.find("label.custom-blue-value").text("B");if(!y){var k=n.instance.hexToRgb(n.values.color);s.find("input.custom-color.custom-red-value").val(k.r),s.find("input.custom-color.custom-green-value").val(k.g),s.find("input.custom-color.custom-blue-value").val(k.b),s.find("input.custom-color").prop("disabled",!1)}s.find(".custom-color").change(function(){var e=[],t,r;e[0]=jQuery("input.custom-color.custom-red-value").val(),e[1]=jQuery("input.custom-color.custom-green-value").val(),e[2]=jQuery("input.custom-color.custom-blue-value").val();for(t=0;t<3;t++){r=parseInt(e[t]);if(r<0||r>255)return;e[t]=r.toString(16),e[t].length===1&&(e[t]="0"+e[t])}n.values.color=e.join(""),n._updatePreview()}),this._supportsSVG()&&this._updatePreview(s);var L=Oskari.clazz.create("Oskari.userinterface.component.Button");L.setTitle(n.loc.buttons.save),L.addClass("primary showSelection"),L.setHandler(function(){r.close()});var A=Oskari.clazz.create("Oskari.userinterface.component.Button");return A.setTitle(n.loc.buttons.cancel),A.setHandler(function(){n.values.size=n.defaultValues.size,n.values.color=n.defaultValues.color,n.values.shape=n.defaultValues.shape,r.close()}),r.show(i,s,[L,A]),r.moveTo(e,"top"),r},_selectButton:function(e){var t,n,r;for(t in this.symbolButtons)this.symbolButtons.hasOwnProperty(t)&&(n=this.symbolButtons[t],r=jQuery("div#"+n.iconId+"marker.icon-button"),n.iconId.toString()===e.toString()?r.css("border","2px solid"):r.css("border","1px solid"))},_updatePreview:function(e){var t=this,n=e===undefined||e===null?jQuery(".pointform"):e,r=n.find(".preview"),i=t.values.size/35,s=400,o=s*i,u=.5*(t.previewSize-o),a={fill:"#"+t.values.color},f=[];r.svg("destroy"),r.svg({onLoad:function(e){var n=null,r,s,o,l,c,h,p,d,v,m,g;for(r in t.symbolButtons)if(t.symbolButtons.hasOwnProperty(r)){s=t.symbolButtons[r];if(s.iconId.toString()===t.values.shape.toString()){n=s.shape.data;break}}for(o=0;o<n.polygons.length;o++){f=[];for(l=0;l<n.polygons[o].length;l++){f.push([]);for(c=0;c<2;c++)f[l][c]=i*n.polygons[o][l][c]+u}e.polygon(f,a)}for(o=0;o<n.circles.length;o++)h=i*n.circles[o].cx+u,p=i*n.circles[o].cy+u,d=i*n.circles[o].r,e.circle(h,p,d,a);if(n.paths.length>0){v=e.createPath(),m=v.move(0,0,!1);for(o=0;o<n.paths.length;o++)for(l=0;l<n.paths[o].length;l++){g=n.paths[o][l],f=[];for(c=0;c<g[1].length;c++)f[c]=i*g[1][c],g[2]||(f[c]=f[c]+u);switch(g[0]){case"move":m.move(f[0],f[1],g[2]);break;case"curveC":m.curveC(f[0],f[1],f[2],f[3],f[4],f[5],g[2]);break;case"smoothC":m.smoothC(f[0],f[1],f[2],f[3],g[2]);break;case"close":m.close()}}e.path(m,a)}}})},_getOnScreenForm:function(){return jQuery("div.renderdialog")},getValues:function(){var e=null,t,n;for(t in this.symbolButtons)if(this.symbolButtons.hasOwnProperty(t)){n=this.symbolButtons[t];if(n.iconId.toString()===this.values.shape.toString()){e=n.iconId;break}}return{color:this.values.color,size:this.values.size,shape:e}},_supportsSVG:function(){return!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect}}),define("bundles/framework/bundle/myplaces2/view/PointForm",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.view.LineForm",function(e){this.instance=e,this.loc=e.getLocalization("lineform"),this.defaultValues={style:e.myPlacesService.defaults.line.style,cap:e.myPlacesService.defaults.line.cap,corner:e.myPlacesService.defaults.line.corner,width:e.myPlacesService.defaults.line.width,color:e.myPlacesService.defaults.line.color},this.values={style:this.defaultValues.style,cap:this.defaultValues.cap,corner:this.defaultValues.corner,width:this.defaultValues.width,color:this.defaultValues.color},this.styleButtonNames=["icon-line-basic","icon-line-dashed","icon-double-line"],this.capButtonNames=["icon-line-flat_cap","icon-line-round_cap"],this.cornerButtonNames=["icon-corner-sharp","icon-corner-round"],this.basicColors=["#ffffff","#666666","#ffde00","#f8931f","#ff3334","#bf2652","#000000","#cccccc","#652d90","#3233ff","#26bf4b","#00ff01"],this.activeColorCell=-1;var t;for(t=0;t<this.basicColors.length;t++)if(this.basicColors[t]==="#"+this.values.color){this.activeColorCell=t;break}this.templateLineStyleDialogContent=jQuery('<div class="lineform"><div class="container"><div class="column1"><label>'+this.loc.style.label+"</label>"+'<div class="style icon-buttons"></div>'+"<label>"+this.loc.cap.label+"</label>"+'<div class="cap icon-buttons"></div>'+"<label>"+this.loc.corner.label+"</label>"+'<div class="corner icon-buttons"></div>'+"<label>"+this.loc.width.label+"</label><br>"+'<div class="width"></div>'+"</div>"+'<div class="column2">'+'<div class="column21">'+"<label>"+this.loc.color.label+"</label>"+'<div class="color-grid">'+'<div class="color-rectangle"></div>'+"</div>"+'<div class="color-label">'+"<label>"+this.loc.color.labelOr+"</label>"+"</div>"+'<div class="color-source-selector">'+"<label>"+this.loc.color.labelCustom+"</label>"+"</div>"+'<div class="custom-colors"></div>'+"</div>"+'<div class="column22">'+"<label>"+this.loc.preview.label+"</label>"+'<div class="preview"></div>'+"</div>"+"</div>"+"</div>"+"</div>"),this.templateButton=jQuery('<div class="icon-button"></div>'),this.templateColorCell=jQuery('<div class="color-cell"></div>'),this.templateCustomColor=jQuery('<div class="custom-color-editor"><div class="colorcontainer"><div class="colorcolumn1"></div><div class="colorcolumn2"><div class="colorcolumn21"></div><div class="colorcolumn22"></div></div></div>'),this.templateColorSource=jQuery('<input type="checkbox" name="colorInput" value = "custom" class="color-source">'),this.templateColorValue=jQuery('<label class="color-label"></label><br><input type="text" name="color-input" value="0" disabled="disabled" class="custom-color">'),this.minWidth=1,this.maxWidth=10,this.templateWidthValue=jQuery('<input type="number" name="width" class="linewidth" min="'+this.minWidth+'" max="'+this.maxWidth+'" step=1 value="'+this.values.width+'">'),this.previewSize=50,this.selectColor="#dddddd"},{showForm:function(e,t){var n=this;t!==null&&t!==undefined&&(jQuery.extend(!0,n.values,t.line),n.values.width=Number(n.values.size));var r=Oskari.clazz.create("Oskari.userinterface.component.Popup");r.addClass("renderdialog"),r.addClass("linevisualization");var i=n.loc.title,s=n.templateLineStyleDialogContent.clone(),o=s.find("div.style"),u,a,f,l;n.values.style.length===0&&(n.values.style=0);for(u=0;u<n.styleButtonNames.length;u++)a=n.templateButton.clone(),a.addClass(n.styleButtonNames[u]),a.attr("id",u+"linestyle"),u===n.values.style&&this._styleSelectedButton(a),a.click(function(){var e=parseInt(jQuery(this).attr("id").charAt(0),10);n._selectButton("style",e),n.values.style=e,n._updatePreview(s)}),o.append(a);o=s.find("div.cap");for(u=0;u<n.capButtonNames.length;u++)f=n.templateButton.clone(),f.addClass(n.capButtonNames[u]),f.attr("id",u+"linecap"),u===n.values.cap&&this._styleSelectedButton(f),f.click(function(){var e=parseInt(jQuery(this).attr("id").charAt(0),10);n._selectButton("cap",e),n.values.cap=e,n._updatePreview(s)}),o.append(f);o=s.find("div.corner");for(u=0;u<n.cornerButtonNames.length;u++)l=n.templateButton.clone(),l.addClass(n.cornerButtonNames[u]),l.attr("id",u+"linecorner"),u===n.values.corner&&this._styleSelectedButton(l),l.click(function(){var e=parseInt(jQuery(this).attr("id").charAt(0),10);n._selectButton("corner",e),n.values.corner=e,n._updatePreview(s)}),o.append(l);o=s.find("div.width");var c=n.templateWidthValue.clone();c.change(function(){var e=parseInt(c.val(),10);isNaN(e)||(n.values.width=e,n._updatePreview())}),c.val(n.values.size!==null&&n.values.size!==undefined?n.values.size:1),o.append(c);var h=!1;o=s.find(".color-rectangle");for(u=0;u<n.basicColors.length;u++){var p=n.templateColorCell.clone();p.css("background-color",n.basicColors[u]);var d="ColorCell",v=u+d;v.length===d.length+1&&(v="0"+v),p.attr("id",v),p.click(function(){if(jQuery(".color-source").prop("checked"))return;var e=parseInt(this.id.substring(0,2),10);if(e===n.activeColorCell)return;if(n.activeColorCell>-1){var t=n.activeColorCell.toString();n.activeColorCell<10&&(t="0"+t),jQuery("#"+t+"ColorCell").css("border","1px solid #000000")}n.values.color=n.instance.rgbToHex(this.style.backgroundColor),n.activeColorCell=e,e<10&&(e="0"+e.toString()),jQuery("#"+e+"ColorCell").css("border","3px solid #ffffff"),n._updatePreview(s)}),"#"+n.values.color===n.basicColors[u]&&(p.css("border","3px solid #ffffff"),n.activeColorCell=u,h=!0),o.append(p)}o=s.find(".color-source-selector");var m=n.templateColorSource.clone();n.activeColorCell===-1&&m.attr("checked",!0),m.change(function(){jQuery("input.custom-color").prop("disabled",!this.checked);var e=n.activeColorCell.toString();n.activeColorCell<10&&(e="0"+e);var t=jQuery("#"+e+"ColorCell");this.checked&&(t.css("border","1px solid #000000"),jQuery(".custom-red-value").val(parseInt(n.values.color.substring(0,2),16)),jQuery(".custom-green-value").val(parseInt(n.values.color.substring(2,4),16)),jQuery(".custom-blue-value").val(parseInt(n.values.color.substring(4),16)),n.activeColorCell=-1),n._updatePreview(s)}),o.prepend(m),h||(m.checked=!0,o.find("input.color-source").prop("disabled",!1).attr("checked","checked")),o=s.find(".custom-colors");var g=this.templateCustomColor.clone();o.append(g);var y=n.templateColorValue.clone();y.addClass("custom-red-value"),n.activeColorCell===-1&&(y.val(parseInt(n.values.color.substring(0,2),16)),y.prop("disabled",!1)),s.find(".colorcolumn1").append(y),s.find("label.custom-red-value").text("R");var b=n.templateColorValue.clone();b.addClass("custom-green-value"),n.activeColorCell===-1&&(b.val(parseInt(n.values.color.substring(2,4),16)),b.prop("disabled",!1)),s.find(".colorcolumn21").append(b),s.find("label.custom-green-value").text("G");var w=n.templateColorValue.clone();w.addClass("custom-blue-value"),n.activeColorCell===-1&&(w.val(parseInt(n.values.color.substring(4),16)),w.prop("disabled",!1)),s.find(".colorcolumn22").append(w),s.find("label.custom-blue-value").text("B");if(!h){var E=n.instance.hexToRgb(n.values.color);s.find("input.custom-color.custom-red-value").val(E.r),s.find("input.custom-color.custom-green-value").val(E.g),s.find("input.custom-color.custom-blue-value").val(E.b),s.find("input.custom-color").prop("disabled",!1)}s.find(".custom-color").change(function(){var e=[],t,r;e[0]=jQuery("input.custom-color.custom-red-value").val(),e[1]=jQuery("input.custom-color.custom-green-value").val(),e[2]=jQuery("input.custom-color.custom-blue-value").val();for(t=0;t<3;t++){r=parseInt(e[t]);if(r<0||r>255)return;e[t]=r.toString(16),e[t].length===1&&(e[t]="0"+e[t])}n.values.color=e.join(""),n._updatePreview()}),this._supportsSVG()&&this._updatePreview(s);var S=Oskari.clazz.create("Oskari.userinterface.component.Button");S.setTitle(n.loc.buttons.save),S.addClass("primary showSelection"),S.setHandler(function(){r.close()});var x=Oskari.clazz.create("Oskari.userinterface.component.Button");return x.setTitle(n.loc.buttons.cancel),x.setHandler(function(){n.values.size=n.defaultValues.size,n.values.color=n.defaultValues.color,n.values.shape=n.defaultValues.shape,r.close()}),r.show(i,s,[S,x]),r.moveTo(e,"top"),n._updatePreview(),r},_selectButton:function(e,t){this._styleUnselectedButton(jQuery("div#"+this.values[e]+"line"+e+".icon-button")),this._styleSelectedButton(jQuery("div#"+t+"line"+e+".icon-button"))},_updatePreview:function(e){var t=this,n=e===null||e===undefined?jQuery(".lineform"):e,r=n.find(".preview");r.svg("destroy"),r.svg({onLoad:function(e){var n=e.createPath(),r=e.group({stroke:"#"+t.values.color,fill:"none",strokeWidth:t.values.width,strokeLineJoin:t.values.corner===0?"miter":"round",strokeLineCap:t.values.cap===0?"butt":"round",strokeDashArray:t.values.style===1?[3,2+.25*t.values.width]:null}),i=[10,15],s=[20,35],o=[40,25];if(t.values.style!==2)e.path(r,n.move(i[0],i[1],!1).line([s,o]));else{var u=1.5+.5*t.values.width,a=[i[0]+2*u/Math.sqrt(5),i[1]-u/Math.sqrt(5)],f=[i[0]-2*u/Math.sqrt(5),i[1]+u/Math.sqrt(5)],l=[];l[0]=s[0]+.5*u*(Math.sqrt(3)-1),l[1]=s[1]-.5*u*(Math.sqrt(3)+1);var c=[];c[0]=s[0]-.5*u*(Math.sqrt(3)-1),c[1]=s[1]+.5*u*(Math.sqrt(3)+1);var h=[o[0]-u/Math.sqrt(5),o[1]-2*u/Math.sqrt(5)],p=[o[0]+u/Math.sqrt(5),o[1]+2*u/Math.sqrt(5)];e.path(r,n.move(a[0],a[1],!1).line([l,h]).move(f[0],f[1],!1).line([c,p]))}}})},_getOnScreenForm:function(){return jQuery("div.renderdialog")},getValues:function(){var e=null,t,n;for(t in this.symbolButtons)if(this.symbolButtons.hasOwnProperty(t)){n=this.symbolButtons[t];if(n.iconId.toString()===this.values.shape.toString()){e=n.iconId;break}}return{color:this.values.color,width:this.values.size,shape:e}},_styleSelectedButton:function(e){e.css("border","2px solid"),e.css("background-color",this.selectColor)},_styleUnselectedButton:function(e){e.css("border","1px solid"),e.css("background-color","transparent")},_supportsSVG:function(){return!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect}}),define("bundles/framework/bundle/myplaces2/view/LineForm",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.view.AreaForm",function(e){this.instance=e,this.loc=e.getLocalization("areaform"),this.defaultValues={color:[e.myPlacesService.defaults.area.linecolor,e.myPlacesService.defaults.area.color],line:{style:e.myPlacesService.defaults.area.linestyle,corner:e.myPlacesService.defaults.area.linecorner,width:e.myPlacesService.defaults.area.linewidth,color:e.myPlacesService.defaults.area.linecolor},fill:e.myPlacesService.defaults.area.fill},this.values={lineWidth:this.defaultValues.line.width,lineCorner:this.defaultValues.line.corner,lineStyle:this.defaultValues.line.style,lineColor:this.defaultValues.color[0],fillColor:this.defaultValues.color[1],fillStyle:this.defaultValues.fill},this.styleButtonNames=["icon-line-basic","icon-line-dashed","icon-double-line"],this.cornerButtonNames=["icon-corner-sharp","icon-corner-round"],this.colorTypes=["line","fill"],this.basicColors=["#ffffff","#666666","#ffde00","#f8931f","#ff3334","#bf2652","#000000","#cccccc","#652d90","#3233ff","#26bf4b","#00ff01"],this.activeColorCell=[-1,-1];var t,n;for(t=0;t<this.basicColors.length;t++)for(n=0;n<this.basicColors.length;n++)if(this.basicColors[n]==="#"+this.values.fillColor[t]){this.activeColorCell[t]=n;break}this.fillButtonNames=["icon-line-thin-diagonal","icon-line-wide-diagonal","icon-line-thin-horizontal","icon-line-wide-horizontal"],this.templateAreaStyleDialogContent=jQuery('<div class="areaform"><div class="container"><div class="column1"><label>'+this.loc.linestyle.label+"</label>"+'<div class="style icon-buttons"></div>'+"<label>"+this.loc.linecorner.label+"</label>"+'<div class="corner icon-buttons"></div>'+"<label>"+this.loc.linewidth.label+"</label><br>"+'<div class="width"></div>'+"</div>"+'<div class="column2">'+'<div class="column21">'+"<label>"+this.loc.linecolor.label+"</label>"+'<div class="color-grid">'+'<div class="color-rectangle line"></div>'+"</div>"+'<div class="color-label">'+"<label>"+this.loc.linecolor.labelOr+"</label>"+"</div>"+'<div class="color-source-selector-line">'+"<label>"+this.loc.linecolor.labelCustom+"</label>"+"</div>"+'<div class="custom-colors-line"></div>'+"</div>"+'<div class="column22">'+'<div class="column221">'+"<label>"+this.loc.color.label+"</label>"+'<div class="color-grid">'+'<div class="color-rectangle fill"></div>'+"</div>"+'<div class="color-label">'+"<label>"+this.loc.color.labelOr+"</label>"+"</div>"+'<div class="color-source-selector-fill">'+"<label>"+this.loc.color.labelCustom+"</label>"+"</div>"+'<div class="custom-colors-fill"></div>'+"<label>"+this.loc.fill.label+"</label>"+'<div class="fill icon-buttons"></div>'+"</div>"+'<div class="column222">'+"<label>"+this.loc.preview.label+"</label>"+'<div class="preview"></div>'+"</div>"+"</div>"+"</div>"+"</div>"+"</div>"),this.templateButton=jQuery('<div class="icon-button"></div>'),this.templateColorCell=jQuery('<div class="color-cell"></div>'),this.templateCustomColor=jQuery('<div class="custom-color-editor"><div class="colorcontainer"><div class="colorcolumn1"></div><div class="colorcolumn2"><div class="colorcolumn21"></div><div class="colorcolumn22"></div></div></div>'),this.templateColorSource=jQuery('<input type="checkbox" name="colorInput" value = "custom" class="color-source">'),this.templateColorValue=jQuery('<label class="color-label"></label><br><input type="text" name="color-input" value="0" disabled="disabled" class="custom-color">'),this.minWidth=1,this.maxWidth=5,this.templateWidthValue=jQuery('<input type="number" name="width" class="linewidth" min="'+this.minWidth+'" max="'+this.maxWidth+'" step=1 value="'+this.values.lineWidth+'">'),this.previewSize=50,this.selectColor="#dddddd"},{showForm:function(e,t){var n=this;t!==null&&t!==undefined&&jQuery.extend(!0,n.values,t.area);var r=Oskari.clazz.create("Oskari.userinterface.component.Popup");r.addClass("renderdialog"),r.addClass("areavisualization");var i=n.loc.title,s=n.templateAreaStyleDialogContent.clone(),o=s.find("div.style"),u,a,f;n.values.lineStyle.length===0&&(n.values.lineStyle=0);for(u=0;u<n.styleButtonNames.length;u++)a=n.templateButton.clone(),a.addClass(n.styleButtonNames[u]),a.attr("id",u+"linestyle"),u===n.values.lineStyle&&this._styleSelectedButton(a),a.click(function(){var e=parseInt(jQuery(this).attr("id").charAt(0),10);n._selectButton("lineStyle",e),n.values.lineStyle=e,n._updatePreview(s)}),o.append(a);o=s.find("div.corner");for(u=0;u<n.cornerButtonNames.length;u++)f=n.templateButton.clone(),f.addClass(n.cornerButtonNames[u]),f.attr("id",u+"linecorner"),u===n.values.lineCorner&&this._styleSelectedButton(f),f.click(function(){var e=parseInt(jQuery(this).attr("id").charAt(0),10);n._selectButton("lineCorner",e),n.values.lineCorner=e,n._updatePreview(s)}),o.append(f);o=s.find("div.width");var l=n.templateWidthValue.clone();l.val(n.values.lineWidth!==null&&n.values.lineWidth!==undefined?n.values.lineWidth:1),l.change(function(){var e=parseInt(l.val(),10);isNaN(e)||(n.values.lineWidth=e,n._updatePreview())}),o.append(l);var c,h,p,d,v,m;for(c=0;c<2;c++){h=!1,p=c===0?"lineColor":"fillColor",o=s.find(".color-rectangle."+n.colorTypes[c]);for(u=0;u<n.basicColors.length;u++)d=n.templateColorCell.clone(),d.css("background-color",n.basicColors[u]),v="ColorCell",m=u.toString()+c.toString()+v,m.length===v.length+2&&(m="0"+m),d.attr("id",m),d.click(function(){var e=parseInt(this.id.substring(0,2),10),t=parseInt(this.id.substring(2,3),10);if(jQuery("#"+t+"color-checkbox").prop("checked"))return;if(e===n.activeColorCell[t])return;if(n.activeColorCell[t]>-1){var r=n.activeColorCell[t].toString();n.activeColorCell[t]<10&&(r="0"+r),jQuery("#"+r+t+"ColorCell").css("border","1px solid #000000")}n.values[t===0?"lineColor":"fillColor"]=n.instance.rgbToHex(this.style.backgroundColor),n.activeColorCell[t]=e,e<10&&(e="0"+e.toString()),jQuery("#"+e+t+"ColorCell").css("border","3px solid #ffffff"),n._updatePreview(s)}),"#"+n.values[p]===n.basicColors[u]&&(d.css("border","3px solid #ffffff"),n.activeColorCell[c]=u,h=!0),o.append(d);o=s.find(".color-source-selector-"+n.colorTypes[c]);var g=n.templateColorSource.clone();g.attr("id",c+"color-checkbox"),n.activeColorCell[c]===-1&&g.attr("checked",!0),g.change(function(){var e=this.id.substring(0,1),t=e==="0"?"lineColor":"fillColor";jQuery("input.custom-color."+n.colorTypes[e]).prop("disabled",!this.checked);var r=n.activeColorCell[e].toString();n.activeColorCell[e]<10&&(r="0"+r);var i=jQuery("#"+r+e+"ColorCell");this.checked&&(i.css("border","1px solid #000000"),jQuery(".custom-red-value."+n.colorTypes[e]).val(parseInt(n.values[t].substring(0,2),16)),jQuery(".custom-green-value."+n.colorTypes[e]).val(parseInt(n.values[t].substring(2,4),16)),jQuery(".custom-blue-value."+n.colorTypes[e]).val(parseInt(n.values[t].substring(4),16)),n.activeColorCell[e]=-1),n._updatePreview(s)}),o.prepend(g),h||(g.checked=!0,o.find("input.color-source").prop("disabled",!1).attr("checked","checked")),o=s.find(".custom-colors-"+n.colorTypes[c]);var y=this.templateCustomColor.clone();y.addClass(n.colorTypes[c]),o.append(y);var b=n.templateColorValue.clone();b.addClass("custom-red-value"),b.addClass(n.colorTypes[c]),n.activeColorCell[c]===-1&&(b.val(parseInt(n.values.lineColor.substring(0,2),16)),b.prop("disabled",!1)),o.find(".colorcolumn1").append(b),o.find("label.custom-red-value").text("R"),o.find("input.custom-red-value").attr("id",c+"red-value");var w=n.templateColorValue.clone();w.addClass("custom-green-value"),w.addClass(n.colorTypes[c]),n.activeColorCell[c]===-1&&(w.val(parseInt(n.values[p].substring(2,4),16)),w.prop("disabled",!1)),o.find(".colorcolumn21").append(w),o.find("label.custom-green-value").text("G"),o.find("input.custom-green-value").attr("id",c+"green-value");var E=n.templateColorValue.clone();E.addClass("custom-blue-value"),E.addClass(n.colorTypes[c]),n.activeColorCell[c]===-1&&(E.val(parseInt(n.values[p].substring(4),16)),E.prop("disabled",!1)),o.find(".colorcolumn22").append(E),o.find("label.custom-blue-value").text("B"),o.find("input.custom-blue-value").attr("id",c+"blue-value");if(!h){var S=n.instance.hexToRgb(n.values[p]);o.find("input.custom-color.custom-red-value").val(S.r),o.find("input.custom-color.custom-green-value").val(S.g),o.find("input.custom-color.custom-blue-value").val(S.b),s.find("input#"+c.toString()+"red-value.custom-color").prop("disabled",!1),s.find("input#"+c.toString()+"green-value.custom-color").prop("disabled",!1),s.find("input#"+c.toString()+"blue-value.custom-color").prop("disabled",!1)}o.find(".custom-color").change(function(){var e=this.id.substring(0,1),t=[],r,i;t[0]=jQuery("input#"+e+"red-value").val(),t[1]=jQuery("input#"+e+"green-value").val(),t[2]=jQuery("input#"+e+"blue-value").val();for(r=0;r<3;r++){i=parseInt(t[r]);if(i<0||i>255)return;t[r]=i.toString(16),t[r].length===1&&(t[r]="0"+t[r])}n.values[e==="0"?"lineColor":"fillColor"]=t.join(""),n._updatePreview()})}o=s.find("div.fill.icon-buttons");for(u=0;u<n.fillButtonNames.length;u++){var x=n.templateButton.clone();x.addClass(n.fillButtonNames[u]),x.attr("id",u+"fillstyle"),u===n.values.fillStyle&&this._styleSelectedButton(x),x.click(function(){var e=parseInt(jQuery(this).attr("id").charAt(0),10);n.values.fillStyle===e?(n.values.fillStyle=-1,n._styleUnselectedButton(jQuery("div#"+e+"fillstyle.icon-button"))):(n.values.fillStyle!==-1&&n._styleUnselectedButton(jQuery("div#"+n.values.fillStyle+"fillstyle.icon-button")),n._styleSelectedButton(jQuery("div#"+e+"fillstyle.icon-button")),n.values.fillStyle=e),n._updatePreview(s)}),o.append(x)}this._supportsSVG()&&this._updatePreview(s);var T=Oskari.clazz.create("Oskari.userinterface.component.Button");T.setTitle(n.loc.buttons.save),T.addClass("primary showSelection"),T.setHandler(function(){r.close()});var N=Oskari.clazz.create("Oskari.userinterface.component.Button");return N.setTitle(n.loc.buttons.cancel),N.setHandler(function(){n.values.lineWidth=n.defaultValues.line.width,n.values.lineCorner=n.defaultValues.line.corner,n.values.lineStyle=n.defaultValues.line.style,n.values.lineColor=n.defaultValues.color[0],n.values.fillColor=n.defaultValues.color[1],n.values.fillStyle=n.defaultValues.fill,r.close()}),r.show(i,s,[T,N]),r.moveTo(e,"top"),r},_selectButton:function(e,t){var n=e.substring(4).toLowerCase();this._styleUnselectedButton(jQuery("div#"+this.values[e]+"line"+n+".icon-button")),this._styleSelectedButton(jQuery("div#"+t+"line"+n+".icon-button"))},_updatePreview:function(e){var t=this,n=e===null||e===undefined?jQuery(".areaform"):e,r=n.find(".preview");r.svg("destroy"),r.svg({onLoad:function(e){var n=e.createPath(),r=t.values.fillStyle<0?"#"+t.values.fillColor:"url(#"+t.fillButtonNames[t.values.fillStyle]+")",i=e.group({stroke:"#"+t.values.lineColor,fill:r,strokeWidth:t.values.lineWidth,strokeLineJoin:t.values.lineCorner===0?"miter":"round",strokeDashArray:t.values.lineStyle===1?[3,2+.25*t.values.lineWidth]:null});if(t.values.fillStyle>=0){var s=null,o=e.createPath();switch(t.values.fillStyle){case 0:s=e.pattern(t.fillButtonNames[t.values.fillStyle],0,0,4,4,0,0,4,4,{patternUnits:"userSpaceOnUse"}),e.path(s,o.move(0,4,!1).line([[4,0]]),{strokeWidth:1,stroke:"#"+t.values.fillColor,fill:"none"});break;case 1:s=e.pattern(t.fillButtonNames[t.values.fillStyle],0,0,6,6,0,0,6,6,{patternUnits:"userSpaceOnUse"}),e.path(s,o.move(-1,1,!1).line([[1,-1]]).move(0,6,!1).line([[6,0]]).move(5,7,!1).line([[7,5]]),{strokeWidth:2,stroke:"#"+t.values.fillColor,fill:"none"});break;case 2:s=e.pattern(t.fillButtonNames[t.values.fillStyle],0,4,4,4,0,0,4,4,{patternUnits:"userSpaceOnUse"}),e.path(s,o.move(0,.5,!1).line([[4,.5]]),{strokeWidth:1,stroke:"#"+t.values.fillColor,fill:"none"});break;case 3:s=e.pattern(t.fillButtonNames[t.values.fillStyle],0,0,5,5,0,0,5,5,{patternUnits:"userSpaceOnUse"}),e.path(s,o.move(0,2,!1).line([[5,2]]),{strokeWidth:2,stroke:"#"+t.values.fillColor,fill:"none"})}}var u=[10,17],a=[40,12],f=[29,40];e.path(i,n.move(u[0],u[1],!1).line([a,f]).close());if(t.values.lineStyle===2){var l=2*(2+t.values.lineWidth),c=Math.atan(Math.abs((a[1]-u[1])/(a[0]-u[0]))),h=[u[0]+l*Math.sin(Math.PI/3+c),u[1]+l*Math.cos(Math.PI/3+c)],p=Math.atan(Math.abs((f[1]-a[1])/(f[0]-a[0]))),d=[a[0]-l*Math.sin(Math.PI/3+p),a[1]-l*Math.cos(Math.PI/3+p)],v=Math.atan(Math.abs((u[1]-f[1])/(u[0]-f[0]))),m=[f[0]-l*Math.cos(Math.PI/6+v),f[1]-l*Math.sin(Math.PI/6+v)];e.path(i,n.move(h[0],h[1],!1).line([d,m]).close())}}})},_getOnScreenForm:function(){return jQuery("div.renderdialog")},_styleSelectedButton:function(e){e.css("border","2px solid"),e.css("background-color",this.selectColor)},_styleUnselectedButton:function(e){e.css("border","1px solid"),e.css("background-color","transparent")},_supportsSVG:function(){return!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect}}),define("bundles/framework/bundle/myplaces2/view/AreaForm",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.view.CategoryForm",function(e){this.instance=e;var t=null,n=null;e.conf&&e.conf.defaults&&(t=e.conf.defaults.dotMinSize,n=e.conf.defaults.dotMaxSize);var r={forms:["point","line","area"],formValues:{point:{size:e.myPlacesService.defaults.point.size,color:e.myPlacesService.defaults.point.color,shape:e.myPlacesService.defaults.point.shape,dotMinSize:t,dotMaxSize:n},line:{style:e.myPlacesService.defaults.line.style,cap:e.myPlacesService.defaults.line.cap,corner:e.myPlacesService.defaults.line.corner,width:e.myPlacesService.defaults.line.width,color:e.myPlacesService.defaults.line.color},area:{line:{style:e.myPlacesService.defaults.area.linestyle,corner:e.myPlacesService.defaults.area.linecorner,width:e.myPlacesService.defaults.area.linewidth,color:e.myPlacesService.defaults.area.linecolor},fill:{style:e.myPlacesService.defaults.area.fill,color:e.myPlacesService.defaults.area.color}}}};this.visualizationForm=Oskari.clazz.create("Oskari.userinterface.component.VisualizationForm",r);var i=e.getLocalization("categoryform");this.template=jQuery('<div class="myplacescategoryform"><div class="field"><label for="categoryname">'+i.name.label+'</label><br clear="all" />'+'<input type="text" name="categoryname" placeholder="'+i.name.placeholder+'"/>'+"</div>"+'<div class="field drawing">'+"<label>"+i.drawing.label+'</label><br clear="all" />'+'<div class="rendering"></div>'+"</div>"+'<div class="field visibleFields">'+"<label>"+i.visibleFields.label+'</label><br clear="all" />'+'<input type="checkbox" name="placename" checked="checked" />'+i.visibleFields.placename+"<br/>"+'<input type="checkbox" name="placedesc" checked="checked" />'+i.visibleFields.placedesc+"<br/>"+'<input type="checkbox" name="image" checked="checked" />'+i.visibleFields.image+"<br/>"+"</div>"+"</div>"),this.templateTableRow=jQuery("<tr></tr>"),this.templateTableCell=jQuery("<td></td>"),this.templateTextInput=jQuery('<input type="text"/>'),this.categoryId=undefined,this._isDefault=undefined},{start:function(){},getForm:function(){var e=this.template.clone(),t=e.find("div.drawing table"),n=e.find("div.rendering");return n.append(this.visualizationForm.getForm()),e},getValues:function(){var e={},t=this._getOnScreenForm();if(t.length>0){e.name=t.find("input[name=categoryname]").val(),this.categoryId&&(e.id=this.categoryId),e._isDefault=this._isDefault||!1;var n=this.visualizationForm.getValues();e.dot=n.point,e.line=n.line,e.area=n.area,e.visibleFields=[],t.find("div.visibleFields").find("input[type=checkbox]:checked").each(function(){e.visibleFields.push(this.name)})}return e},setValues:function(e){this.categoryId=e.id,this._isDefault=e._isDefault;var t=this._getOnScreenForm();t.length>0&&this._checkVisibleFields(t,e.visibleFields),this.visualizationForm.setValues(e)},_getOnScreenForm:function(){return jQuery("div.myplacescategoryform")},_checkVisibleFields:function(e,t){e.find("div.visibleFields input[type=checkbox]").each(function(e,n){n.removeAttr("checked");var r,i=t?t.length:0;for(r=0;r<fLen;++r)t[r]===n.attr("name")&&n.attr("checked","checked")})},destroy:function(){this.dialog&&this.dialog.close();var e=this._getOnScreenForm();e.remove()}}),define("bundles/framework/bundle/myplaces2/view/CategoryForm",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.ButtonHandler",function(e){this.instance=e,this.buttonGroup="myplaces",this.ignoreEvents=!1,this.dialog=null;var t=this;this.buttons={point:{iconCls:"myplaces-draw-point",tooltip:"",sticky:!0,callback:function(){t.startNewDrawing({drawMode:"point"})}},line:{iconCls:"myplaces-draw-line",tooltip:"",sticky:!0,callback:function(){t.startNewDrawing({drawMode:"line"})}},area:{iconCls:"myplaces-draw-area",tooltip:"",sticky:!0,callback:function(){t.startNewDrawing({drawMode:"area"})}}},this.templateGuide=jQuery('<div><div class="guide"></div><div class="buttons"><div class="cancel button"></div><div class="finish button"></div></div></div>')},{__name:"MyPlacesButtonHandler",getName:function(){return this.__name},init:function(){var e=this.instance.getLocalization("tools"),t=this.instance.sandbox.getUser(),n=" - "+this.instance.getLocalization("guest").loginShort,r,i;for(r in this.buttons)this.buttons.hasOwnProperty(r)&&(i=e[r].tooltip,t.isLoggedIn()||(i+=n),this.buttons[r].tooltip=i)},start:function(){var e=this,t=e.instance.sandbox,n,r;t.register(e);for(n in e.eventHandlers)e.eventHandlers.hasOwnProperty(n)&&t.registerForEventByName(e,n);var i=t.getRequestBuilder("Toolbar.AddToolButtonRequest");for(r in this.buttons)this.buttons.hasOwnProperty(r)&&t.request(this,i(r,this.buttonGroup,this.buttons[r]));var s=this.instance.sandbox.getUser();s.isLoggedIn()||this.disableButtons()},disableButtons:function(){var e=this.instance.sandbox,t=e.getRequestBuilder("Toolbar.ToolButtonStateRequest");e.request(this,t(undefined,this.buttonGroup,!1))},startNewDrawing:function(e){var t=this.instance.sandbox.getEventBuilder("DrawPlugin.SelectedDrawingEvent")();this.instance.sandbox.notifyAll(t),this.sendDrawRequest(e),this.instance.enableGfi(!1)},sendDrawRequest:function(e){var t=this,n=this.instance.sandbox.getRequestBuilder("DrawPlugin.StartDrawingRequest")(e);this.instance.sandbox.request(this,n),e.geometry||this._showDrawHelper(e.drawMode)},_showDrawHelper:function(e){var t=this,n=this.instance.getLocalization("tools")[e],r=this.instance.getLocalization("buttons"),i=this.instance.getLocalization("title"),s=n.add,o=Oskari.clazz.create("Oskari.userinterface.component.Popup");this.dialog=o;var u=[],a=Oskari.clazz.create("Oskari.userinterface.component.Button");a.setTitle(r.cancel),a.setHandler(function(){var e=t.instance.sandbox.getRequestBuilder("Toolbar.SelectToolButtonRequest")();t.instance.sandbox.request(t,e),t.sendStopDrawRequest(!0)}),u.push(a);var f=Oskari.clazz.create("Oskari.userinterface.component.Button");f.setTitle(r.finish),f.addClass("primary"),f.setHandler(function(){t.sendStopDrawRequest()}),u.push(f),o.show(i,s,u),o.addClass("myplaces2"),o.moveTo("#toolbar div.toolrow[tbgroup=default-myplaces]","top")},sendStopDrawRequest:function(e){var t=this,n=this.instance.sandbox.getRequestBuilder("DrawPlugin.StopDrawingRequest")(e);this.instance.sandbox.request(this,n),this.dialog&&this.dialog.close()},stop:function(){jQuery("div.myplaces2 div.button").die()},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(!t)return;return t.apply(this,[e])},eventHandlers:{"Toolbar.ToolSelectedEvent":function(e){this.ignoreEvents||(this.sendStopDrawRequest(!0),this.instance.enableGfi(!0))},"DrawPlugin.SelectedDrawingEvent":function(e){if(!e.getPlace()){var t=this.instance.sandbox.getRequestBuilder("Toolbar.SelectToolButtonRequest")();this.instance.sandbox.request(this,t)}},"DrawPlugin.FinishedDrawingEvent":function(e){this.ignoreEvents=!0;var t=this.instance.sandbox.getRequestBuilder("Toolbar.SelectToolButtonRequest")();this.instance.sandbox.request(this,t),this.ignoreEvents=!1,this.instance.enableGfi(!1),this.dialog&&this.dialog.close()},"DrawPlugin.AddedFeatureEvent":function(e){if(e.getDrawingMode()!==undefined&&e.getDrawingMode()!==null){var t=this.instance.getLocalization("tools"),n=t[e.getDrawingMode()].next;this.dialog.getContent()!==n&&(this.dialog.setContent(n),this.dialog.moveTo("#toolbar div.toolrow[tbgroup=default-myplaces]","top"))}}}},{protocol:["Oskari.mapframework.module.Module"]}),define("bundles/framework/bundle/myplaces2/ButtonHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.CategoryHandler",function(e){this.instance=e,this.initialLoad=!0,this.validateTool=Oskari.clazz.create("Oskari.userinterface.component.FormInput")},{__name:"MyPlacesCategoryHandler",getName:function(){return this.__name},init:function(){},start:function(){var e=this,t=this.instance.sandbox,n=t.getUser(),r;if(n.isLoggedIn()){t.register(e);for(r in e.eventHandlers)e.eventHandlers.hasOwnProperty(r)&&t.registerForEventByName(e,r)}},stop:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(!t)return;return t.apply(this,[e])},eventHandlers:{"MyPlaces.MyPlacesChangedEvent":function(e){this._handlePlacesChanged()}},_handlePlacesChanged:function(){var e=this.instance.sandbox,t=e.getService("Oskari.mapframework.service.MapLayerService"),n=this.instance.getService().getAllCategories(),r=t.getAllLayersByMetaType(this.instance.idPrefix),i,s,o,u,a;for(i=0;i<r.length;++i){s=r[i],o=!1;for(u=0;u<n.length;++u)a=n[u],this._getMapLayerId(a.getId())===s.getId()&&(o=!0);o||(e.requestByName(this.getName(),"RemoveMapLayerRequest",[s.getId()]),t.removeLayer(s.getId()))}for(u=0;u<n.length;++u){a=n[u],o=!1;for(i=0;i<r.length;++i)if(this._getMapLayerId(a.getId())===r[i].getId()){o=!0;if(a.getName()!==r[i].getName()){var f={name:a.getName()};t.updateLayer(r[i].getId(),f)}}if(!o){var l=this._getMapLayerJson(a),c=t.createMapLayer(l);t.addLayer(c,this.initialLoad)}}if(this.initialLoad){var h=e.getEventBuilder("MapLayerEvent")(null,"add");e.notifyAll(h),this._processStartupLinkLayers(e),this.initialLoad=!1}},addLayerToMap:function(e){var t=this._getMapLayerId(e),n=this.sandbox.findMapLayerFromSelectedMapLayers(t);if(!n){var r=this.sandbox.getRequestBuilder("AddMapLayerRequest")(t,!0);this.sandbox.request(this.getName(),r)}},addLayerToService:function(e){var t=this._sandbox.getService("Oskari.mapframework.service.MapLayerService"),n=this._getMapLayerJson(e),r=t.createMapLayer(n);t.addLayer(r)},_getMapLayerId:function(e){if(!e){var t=this.myPlacesService.getDefaultCategory();t?e=t.getId():e="-99"}return this.instance.idPrefix+"_"+e},_getMapLayerJson:function(e){var t=this._getMapLayerJsonBase();return t.wmsUrl=this.instance.conf.wmsUrl+e.getId()+"&",t.name=e.getName(),t.id=this._getMapLayerId(e.getId()),e.isPublic()?t.permissions={publish:"publication_permission_ok"}:t.permissions={publish:"no_publication_permission"},t},_getMapLayerJsonBase:function(){var e=this.instance.getLocalization("category"),t={wmsName:"ows:my_places_categories",type:"wmslayer",isQueryable:!0,opacity:90,metaType:this.instance.idPrefix,orgName:e.organization,inspire:e.inspire};if(this.instance.conf&&this.instance.conf.layerDefaults&&typeof this.instance.conf.layerDefaults=="object"){var n=this.instance.conf.layerDefaults,r;for(r in n)n.hasOwnProperty(r)&&(t[r]=n[r])}return t},_processStartupLinkLayers:function(e){var t=e.getRequestParameter("mapLayers");if(t===null||t==="")return;var n=t.split(","),r=!0,i,s,o,u,a,f;for(i=0;i<n.length;i++)s=n[i].split("+"),o=s[0],u=s[1],o!==null&&o.indexOf(this.instance.idPrefix)!==-1&&(a=null,f=null,a=e.getRequestBuilder("AddMapLayerRequest"),f=a(o,r),e.request(this.getName(),f),a=e.getRequestBuilder("ChangeMapLayerOpacityRequest"),f=a(o,u),e.request(this.getName(),f))},editCategory:function(e){var t=this;this.instance.sandbox.postRequestByName("DisableMapKeyboardMovementRequest");var n=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.view.CategoryForm",t.instance),r={name:e.getName(),id:e.getId(),_isDefault:e.isDefault(),dot:{size:e.getDotSize(),color:e.getDotColor(),shape:e.getDotShape()!==null&&e.getDotShape()!==undefined?e.getDotShape():1},line:{cap:e.getLineCap(),corner:e.getLineCorner(),style:e.getLineStyle(),size:e.getLineWidth(),color:e.getLineColor()},area:{lineWidth:e.getAreaLineWidth(),lineCorner:e.getAreaLineCorner(),lineStyle:e.getAreaLineStyle(),lineColor:e.getAreaLineColor(),fillColor:e.getAreaFillColor(),fillStyle:e.getAreaFillStyle()}};n.setValues(r);var i=n.getForm();i.find("input[name=categoryname]").val(e.name);var s=Oskari.clazz.create("Oskari.userinterface.component.Popup"),o=[],u=Oskari.clazz.create("Oskari.userinterface.component.Button"),a=this.instance.getLocalization("buttons"),f=this.instance.getLocalization("categoryform").edit;u.setTitle(a.save),u.addClass("primary"),u.setHandler(function(){var e=n.getValues(),r=t.validateCategoryFormValues(e);if(r.length!==0){t.showValidationErrorMessage(r);return}var i=t.getCategoryFromFormValues(e);t.saveCategory(i),s.close(),t.instance.sandbox.postRequestByName("EnableMapKeyboardMovementRequest")});var l=Oskari.clazz.create("Oskari.userinterface.component.Button");l.setTitle(a.cancel),l.setHandler(function(){s.close()}),o.push(l),o.push(u),s.show(f.title,i,o),s.moveTo("div.personaldata ul li select","right"),s.makeModal(),n.start()},showValidationErrorMessage:function(e){var t=this.instance.getLocalization(),n=Oskari.clazz.create("Oskari.userinterface.component.Popup"),r=Oskari.clazz.create("Oskari.userinterface.component.Button");r.setTitle(t.buttons.ok),r.addClass("primary"),r.setHandler(function(){n.close(!0)});var i=jQuery("<ul></ul>"),s,o;for(s=0;s<e.length;++s)o=jQuery("<li></li>"),o.append(e[s].error),i.append(o);n.show(t.validation.title,i,[r])},_showMessage:function(e,t){var n=this.instance.getLocalization(),r=Oskari.clazz.create("Oskari.userinterface.component.Popup"),i=Oskari.clazz.create("Oskari.userinterface.component.Button");i.setTitle(n.buttons.ok),i.addClass("primary"),i.setHandler(function(){r.close(!0)}),r.show(e,t,[i])},hasIllegalChars:function(e){return this.validateTool.setValue(e),!this.validateTool.checkValue()},_validateNumber:function(e,t,n){return this.validateTool.validateNumberRange(e,t,n)},_isColor:function(e){return this.validateTool.validateHexColor(e)},validateCategoryFormValues:function(e){var t=[];if(!e)return t;var n=this.instance.getLocalization("validation");return e.name?this.hasIllegalChars(e.name)&&t.push({field:"name",error:n.categoryNameIllegal}):t.push({field:"name",error:n.categoryName}),this._validateNumber(e.dot.shape,0,6)||t.push({field:"dotShape",error:n.dotShape}),this._validateNumber(e.dot.size,1,5)||t.push({field:"dotSize",error:n.dotSize}),this._isColor(e.dot.color)||t.push({field:"dotColor",error:n.dotColor}),this._validateNumber(e.line.width,1,50)||t.push({field:"lineWidth",error:n.lineSize}),this._isColor(e.line.color)||t.push({field:"lineColor",error:n.lineColor}),this._validateNumber(e.area.lineWidth,0,50)||t.push({field:"areaLineWidth",error:n.areaLineSize}),this._isColor(e.area.lineColor)||t.push({field:"areaLineColor",error:n.areaLineColor}),this._isColor(e.area.fillColor)||t.push({field:"areaFillColor",error:n.areaFillColor}),t},getCategoryFromFormValues:function(e){var t=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.model.MyPlacesCategory");return t.setName(e.name),t.setId(e.id),t.setDotSize(e.dot.size),t.setDotColor(e.dot.color),t.setDotShape(e.dot.shape),t.setLineWidth(e.line.width),t.setLineColor(e.line.color),t.setLineCap(e.line.cap),t.setLineCorner(e.line.corner),t.setLineStyle(e.line.style),t.setAreaLineWidth(e.area.lineWidth),t.setAreaLineColor(e.area.lineColor),t.setAreaLineCorner(e.area.lineCorner),t.setAreaLineStyle(e.area.lineStyle),t.setAreaFillColor(e.area.fillColor),t.setAreaFillStyle(e.area.fillStyle),t.setDefault(e._isDefault),t},saveCategory:function(e){var t=this,n=t.instance.getLocalization("notification"),r=function(r,i,s){if(r){var o=Oskari.clazz.create("Oskari.userinterface.component.Popup");o.show(n.categorySaved.title,n.categorySaved.message),o.fadeout();var u=t._getMapLayerId(e.getId()),a=t.instance.sandbox.getRequestBuilder("MapModulePlugin.MapLayerUpdateRequest")(u,!0);t.instance.sandbox.request(t,a)}else s?t.instance.showMessage(n.error.title,n.error.addCategory):t.instance.showMessage(n.error.title,n.error.editCategory)};this.instance.getService().saveCategory(e,r)},confirmDeleteCategory:function(e){var t=this,n=t.instance.getLocalization("buttons"),r=this.instance.getService(),i=r.getDefaultCategory(),s=Oskari.clazz.create("Oskari.userinterface.component.Popup"),o,u;if(i.getId()===e.getId()){o=t.instance.getLocalization();var a=s.createCloseButton(o.buttons.ok);s.show(o.notification.error.title,o.notification.error.deleteDefault,[a]);return}var f=r.getPlacesInCategory(e.getId()),l=[],c=s.createCloseButton(n.cancel);l.push(c),o=t.instance.getLocalization("notification");var h="";if(f.length>0){u=Oskari.clazz.create("Oskari.userinterface.component.Button"),u.setTitle(n.deleteCategoryAndPlaces),u.setHandler(function(){s.close(),t._deleteCategory(e,!1)}),l.push(u);var p=Oskari.clazz.create("Oskari.userinterface.component.Button");p.setTitle(n.movePlaces),p.addClass("primary"),p.setHandler(function(){s.close(),t._deleteCategory(e,!0)}),l.push(p);var d=[e.getName(),f.length,i.getName()];h=this._formatMessage(o.categoryDelete.deleteConfirmMove,d)}else u=Oskari.clazz.create("Oskari.userinterface.component.Button"),u.setTitle(n.deleteCategory),u.addClass("primary"),l.push(u),u.setHandler(function(){s.close(),t._deleteCategory(e,!1)}),h=this._formatMessage(o.categoryDelete.deleteConfirm,[e.getName()]);s.show(o.categoryDelete.title,h,l),s.makeModal()},_formatMessage:function(e,t){var n=e,r;for(r=0;r<t.length;++r)n=n.replace("{"+r+"}",t[r]);return n},_deleteCategory:function(e,t){var n=this,r=e.getId(),i=function(e){n._deleteCategoryCallback(e,t,r)},s=this.instance.getService();s.deleteCategory(r,t,i)},_deleteCategoryCallback:function(e,t,n){var r=Oskari.clazz.create("Oskari.userinterface.component.Popup"),i=this.instance.getService(),s=this,o;if(e){if(t){var u=i.getDefaultCategory(),a=this._getMapLayerId(u.getId()),f=this.instance.sandbox.getRequestBuilder("MapModulePlugin.MapLayerUpdateRequest")(a,!0);this.instance.sandbox.request(this,f)}o=s.instance.getLocalization(),r.show(o.notification.categoryDelete.title,o.notification.categoryDelete.deleted),r.fadeout()}else{o=s.instance.getLocalization();var l=r.createCloseButton(o.buttons.ok);r.show(o.notification.error.title,o.notification.error.deleteCategory,[l])}},confirmPublishCategory:function(e,t){var n=this,r=n.instance.getLocalization(),i=Oskari.clazz.create("Oskari.userinterface.component.Popup"),s=this.instance.getService(),o=[],u,a=i.createCloseButton(r.buttons.cancel);o.push(a);var f=Oskari.clazz.create("Oskari.userinterface.component.Button");f.addClass("primary"),f.setHandler(function(){s.publishCategory(e.getId(),t,function(r){n._handlePublishCategory(e,t,r)}),i.close()}),o.push(f);var l=[e.getName()];t?(f.setTitle(r.buttons.changeToPublic),u=this._formatMessage(r.notification.categoryToPublic.message,l),i.show(r.notification.categoryToPublic.title,u,o)):(f.setTitle(r.buttons.changeToPrivate),u=this._formatMessage(r.notification.categoryToPrivate.message,l),i.show(r.notification.categoryToPrivate.title,u,o))},_handlePublishCategory:function(e,t,n){var r;if(!n){r=this.instance.getLocalization("notification"),this._showMessage(r.error.title,r.error.generic);return}var i=this.instance.sandbox,s=i.getService("Oskari.mapframework.service.MapLayerService"),o=this._getMapLayerId(e.getId()),u=s.findMapLayer(o);if(!u){r=this.instance.getLocalization("notification"),this._showMessage(r.error.title,r.error.generic);return}t?u.addPermission("publish","publication_permission_ok"):u.addPermission("publish","no_publication_permission");var a=i.getEventBuilder("MapLayerEvent")(o,"update");i.notifyAll(a)}},{protocol:["Oskari.mapframework.module.Module"]}),define("bundles/framework/bundle/myplaces2/CategoryHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.MyPlacesBundleInstance",function(){this._localization=null,this.sandbox=null,this.buttons=undefined,this.categoryHandler=undefined,this.myPlacesService=undefined,this.featureNS=undefined,this.idPrefix="myplaces"},{__name:"MyPlaces2",getName:function(){return this.__name},getSandbox:function(){return this.sandbox},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization&&this._localization[e]?this._localization[e]:e:this._localization},showMessage:function(e,t){var n=this.getLocalization(),r=Oskari.clazz.create("Oskari.userinterface.component.Popup"),i=Oskari.clazz.create("Oskari.userinterface.component.Button");i.setTitle(n.buttons.ok),i.addClass("primary"),i.setHandler(function(){r.close(!0)}),r.show(e,t,[i])},forceDisable:function(){this.buttons.disableButtons();var e=this.getLocalization();this.showMessage(e.category.organization+" - "+e.notification.error.title,e.notification.error.generic)},enableGfi:function(e){var t=this.sandbox.getRequestBuilder("MapModulePlugin.GetFeatureInfoActivationRequest");t&&this.sandbox.request(this.buttons,t(e))},getService:function(){return this.myPlacesService},getDrawPlugin:function(){return this.view.drawPlugin},getCategoryHandler:function(){return this.categoryHandler},getMainView:function(){return this.view},update:function(){},init:function(){},start:function(){var e=this,t=e.conf,n=(t?t.sandbox:null)||"sandbox",r=Oskari.getSandbox(n);this.sandbox=r,this.featureNS=t?t.featureNS:null;if(!this.featureNS)return;r.printDebug("Initializing my places module..."),this.buttons=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.ButtonHandler",this),this.buttons.start();var i=r.getUser();if(!i.isLoggedIn())return;r.register(e),this.categoryHandler=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.CategoryHandler",this),this.categoryHandler.start();var s=this._getCategoryDefaults(),o=this.conf.queryUrl;this.myPlacesService=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.service.MyPlacesService",o,i.getUuid(),r,s,this),this.sandbox.registerService(this.myPlacesService),this.myPlacesService.init(),this.view=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.view.MainView",this),this.view.start(),this.editRequestHandler=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.request.EditRequestHandler",r,e),r.addRequestHandler("MyPlaces.EditPlaceRequest",this.editRequestHandler),r.addRequestHandler("MyPlaces.EditCategoryRequest",this.editRequestHandler),r.addRequestHandler("MyPlaces.DeleteCategoryRequest",this.editRequestHandler),r.addRequestHandler("MyPlaces.PublishCategoryRequest",this.editRequestHandler);var u=this.getLocalization("tab");tab=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.MyPlacesTab",this,u),tab.initContainer(),tab.bindEvents&&tab.bindEvents();var a=tab.getTitle(),f=tab.getContent(),l=!0,c="PersonalData.AddTabRequest",h=r.getRequestBuilder(c),p=h(a,f,l);r.request(this,p)},stop:function(){this.sandbox=null},_getCategoryDefaults:function(){var e={name:this.getLocalization("category").defaultName,point:{shape:1,color:"000000",size:3},line:{style:"",cap:0,corner:0,width:1,color:"3233ff"},area:{linestyle:"",linecorner:0,linewidth:1,linecolor:"000000",color:"ffde00",fill:-1}};if(!this.conf)return e;if(!this.conf.defaults)return e;for(var t in e)this.conf.defaults[t]&&(e[t]=this.conf.defaults[t]);return e},hexToRgb:function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,n,r){return t+t+n+n+r+r});var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null},rgbToHex:function(e){if(e.charAt(0)==="#")return e.substring(1);var t=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);delete t[0];for(var n=1;n<=3;++n)t[n]=parseInt(t[n]).toString(16),t[n].length==1&&(t[n]="0"+t[n]);return t.join("")}},{protocol:["Oskari.bundle.BundleInstance"]}),define("bundles/framework/bundle/myplaces2/instance",function(){});var jscolor={dir:"",bindClass:"color",binding:!0,preloading:!0,install:function(){jscolor.addEvent(window,"load",jscolor.init)},init:function(){jscolor.binding&&jscolor.bind(),jscolor.preloading&&jscolor.preload()},getDir:function(){if(!jscolor.dir){var e=jscolor.detectDir();jscolor.dir=e!==!1?e:"jscolor/"}return jscolor.dir},detectDir:function(){var e=location.href,t=document.getElementsByTagName("base");for(var n=0;n<t.length;n+=1)t[n].href&&(e=t[n].href);var t=document.getElementsByTagName("script");for(var n=0;n<t.length;n+=1)if(t[n].src&&/(^|\/)jscolor\.js([?#].*)?$/i.test(t[n].src)){var r=new jscolor.URI(t[n].src),i=r.toAbsolute(e);return i.path=i.path.replace(/[^\/]+$/,""),i.query=null,i.fragment=null,i.toString()}return!1},bind:function(){var matchClass=new RegExp("(^|\\s)("+jscolor.bindClass+")\\s*(\\{[^}]*\\})?","i"),e=document.getElementsByTagName("input");for(var i=0;i<e.length;i+=1){var m;if(!e[i].color&&e[i].className&&(m=e[i].className.match(matchClass))){var prop={};if(m[3])try{eval("prop="+m[3])}catch(eInvalidProp){}e[i].color=new jscolor.color(e[i],prop)}}},preload:function(){for(var e in jscolor.imgRequire)jscolor.imgRequire.hasOwnProperty(e)&&jscolor.loadImage(e)},images:{pad:[181,101],sld:[16,101],cross:[15,15],arrow:[7,11]},imgRequire:{},imgLoaded:{},requireImage:function(e){jscolor.imgRequire[e]=!0},loadImage:function(e){jscolor.imgLoaded[e]||(jscolor.imgLoaded[e]=new Image,jscolor.imgLoaded[e].src=jscolor.getDir()+e)},fetchElement:function(e){return typeof e=="string"?document.getElementById(e):e},addEvent:function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)},fireEvent:function(e,t){if(!e)return;if(document.createEvent){var n=document.createEvent("HTMLEvents");n.initEvent(t,!0,!0),e.dispatchEvent(n)}else if(document.createEventObject){var n=document.createEventObject();e.fireEvent("on"+t,n)}else e["on"+t]&&e["on"+t]()},getElementPos:function(e){var t=e,n=e,r=0,i=0;if(t.offsetParent)do r+=t.offsetLeft,i+=t.offsetTop;while(t=t.offsetParent);while((n=n.parentNode)&&n.nodeName.toUpperCase()!=="BODY")r-=n.scrollLeft,i-=n.scrollTop;return[r,i]},getElementSize:function(e){return[e.offsetWidth,e.offsetHeight]},getRelMousePos:function(e){var t=0,n=0;return e||(e=window.event),typeof e.offsetX=="number"?(t=e.offsetX,n=e.offsetY):typeof e.layerX=="number"&&(t=e.layerX,n=e.layerY),{x:t,y:n}},getViewPos:function(){return typeof window.pageYOffset=="number"?[window.pageXOffset,window.pageYOffset]:document.body&&(document.body.scrollLeft||document.body.scrollTop)?[document.body.scrollLeft,document.body.scrollTop]:document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)?[document.documentElement.scrollLeft,document.documentElement.scrollTop]:[0,0]},getViewSize:function(){return typeof window.innerWidth=="number"?[window.innerWidth,window.innerHeight]:document.body&&(document.body.clientWidth||document.body.clientHeight)?[document.body.clientWidth,document.body.clientHeight]:document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?[document.documentElement.clientWidth,document.documentElement.clientHeight]:[0,0]},URI:function(e){function t(e){var t="";while(e)if(e.substr(0,3)==="../"||e.substr(0,2)==="./")e=e.replace(/^\.+/,"").substr(1);else if(e.substr(0,3)==="/./"||e==="/.")e="/"+e.substr(3);else if(e.substr(0,4)==="/../"||e==="/..")e="/"+e.substr(4),t=t.replace(/\/?[^\/]*$/,"");else if(e==="."||e==="..")e="";else{var n=e.match(/^\/?[^\/]*/)[0];e=e.substr(n.length),t+=n}return t}this.scheme=null,this.authority=null,this.path="",this.query=null,this.fragment=null,this.parse=function(e){var t=e.match(/^(([A-Za-z][0-9A-Za-z+.-]*)(:))?((\/\/)([^\/?#]*))?([^?#]*)((\?)([^#]*))?((#)(.*))?/);return this.scheme=t[3]?t[2]:null,this.authority=t[5]?t[6]:null,this.path=t[7],this.query=t[9]?t[10]:null,this.fragment=t[12]?t[13]:null,this},this.toString=function(){var e="";return this.scheme!==null&&(e=e+this.scheme+":"),this.authority!==null&&(e=e+"//"+this.authority),this.path!==null&&(e+=this.path),this.query!==null&&(e=e+"?"+this.query),this.fragment!==null&&(e=e+"#"+this.fragment),e},this.toAbsolute=function(e){var e=new jscolor.URI(e),n=this,r=new jscolor.URI;return e.scheme===null?!1:(n.scheme!==null&&n.scheme.toLowerCase()===e.scheme.toLowerCase()&&(n.scheme=null),n.scheme!==null?(r.scheme=n.scheme,r.authority=n.authority,r.path=t(n.path),r.query=n.query):(n.authority!==null?(r.authority=n.authority,r.path=t(n.path),r.query=n.query):(n.path===""?(r.path=e.path,n.query!==null?r.query=n.query:r.query=e.query):(n.path.substr(0,1)==="/"?r.path=t(n.path):(e.authority!==null&&e.path===""?r.path="/"+n.path:r.path=e.path.replace(/[^\/]+$/,"")+n.path,r.path=t(r.path)),r.query=n.query),r.authority=e.authority),r.scheme=e.scheme),r.fragment=n.fragment,r)},e&&this.parse(e)},color:function(target,prop){function RGB_HSV(e,t,n){var r=Math.min(Math.min(e,t),n),i=Math.max(Math.max(e,t),n),s=i-r;if(s===0)return[null,0,i];var o=e===r?3+(n-t)/s:t===r?5+(e-n)/s:1+(t-e)/s;return[o===6?0:o,s/i,i]}function HSV_RGB(e,t,n){if(e===null)return[n,n,n];var r=Math.floor(e),i=r%2?e-r:1-(e-r),s=n*(1-t),o=n*(1-t*i);switch(r){case 6:case 0:return[n,o,s];case 1:return[o,n,s];case 2:return[s,n,o];case 3:return[s,o,n];case 4:return[o,s,n];case 5:return[n,s,o]}}function removePicker(){delete jscolor.picker.owner,document.getElementsByTagName("body")[0].removeChild(jscolor.picker.boxB)}function drawPicker(e,t){function a(){var e=THIS.pickerInsetColor.split(/\s+/),t=e.length<2?e[0]:e[1]+" "+e[0]+" "+e[0]+" "+e[1];s.btn.style.borderColor=t}if(!jscolor.picker){jscolor.picker={box:document.createElement("div"),boxB:document.createElement("div"),pad:document.createElement("div"),padB:document.createElement("div"),padM:document.createElement("div"),sld:document.createElement("div"),sldB:document.createElement("div"),sldM:document.createElement("div"),btn:document.createElement("div"),btnS:document.createElement("span"),btnT:document.createTextNode(THIS.pickerCloseText)};for(var n=0,r=4;n<jscolor.images.sld[1];n+=r){var i=document.createElement("div");i.style.height=r+"px",i.style.fontSize="1px",i.style.lineHeight="0",jscolor.picker.sld.appendChild(i)}jscolor.picker.sldB.appendChild(jscolor.picker.sld),jscolor.picker.box.appendChild(jscolor.picker.sldB),jscolor.picker.box.appendChild(jscolor.picker.sldM),jscolor.picker.padB.appendChild(jscolor.picker.pad),jscolor.picker.box.appendChild(jscolor.picker.padB),jscolor.picker.box.appendChild(jscolor.picker.padM),jscolor.picker.btnS.appendChild(jscolor.picker.btnT),jscolor.picker.btn.appendChild(jscolor.picker.btnS),jscolor.picker.box.appendChild(jscolor.picker.btn),jscolor.picker.boxB.appendChild(jscolor.picker.box)}var s=jscolor.picker;s.box.onmouseup=s.box.onmouseout=function(){target.focus()},s.box.onmousedown=function(){abortBlur=!0},s.box.onmousemove=function(e){if(holdPad||holdSld)holdPad&&setPad(e),holdSld&&setSld(e),document.selection?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges(),dispatchImmediateChange()},s.padM.onmouseup=s.padM.onmouseout=function(){holdPad&&(holdPad=!1,jscolor.fireEvent(valueElement,"change"))},s.padM.onmousedown=function(e){switch(modeID){case 0:THIS.hsv[2]===0&&THIS.fromHSV(null,null,1);break;case 1:THIS.hsv[1]===0&&THIS.fromHSV(null,1,null)}holdPad=!0,setPad(e),dispatchImmediateChange()},s.sldM.onmouseup=s.sldM.onmouseout=function(){holdSld&&(holdSld=!1,jscolor.fireEvent(valueElement,"change"))},s.sldM.onmousedown=function(e){holdSld=!0,setSld(e),dispatchImmediateChange()};var o=getPickerDims(THIS);s.box.style.width=o[0]+"px",s.box.style.height=o[1]+"px",s.boxB.style.position="absolute",s.boxB.style.clear="both",s.boxB.style.left=e+"px",s.boxB.style.top=t+"px",s.boxB.style.zIndex=THIS.pickerZIndex,s.boxB.style.border=THIS.pickerBorder+"px solid",s.boxB.style.borderColor=THIS.pickerBorderColor,s.boxB.style.background=THIS.pickerFaceColor,s.pad.style.width=jscolor.images.pad[0]+"px",s.pad.style.height=jscolor.images.pad[1]+"px",s.padB.style.position="absolute",s.padB.style.left=THIS.pickerFace+"px",s.padB.style.top=THIS.pickerFace+"px",s.padB.style.border=THIS.pickerInset+"px solid",s.padB.style.borderColor=THIS.pickerInsetColor,s.padM.style.position="absolute",s.padM.style.left="0",s.padM.style.top="0",s.padM.style.width=THIS.pickerFace+2*THIS.pickerInset+jscolor.images.pad[0]+jscolor.images.arrow[0]+"px",s.padM.style.height=s.box.style.height,s.padM.style.cursor="crosshair",s.sld.style.overflow="hidden",s.sld.style.width=jscolor.images.sld[0]+"px",s.sld.style.height=jscolor.images.sld[1]+"px",s.sldB.style.display=THIS.slider?"block":"none",s.sldB.style.position="absolute",s.sldB.style.right=THIS.pickerFace+"px",s.sldB.style.top=THIS.pickerFace+"px",s.sldB.style.border=THIS.pickerInset+"px solid",s.sldB.style.borderColor=THIS.pickerInsetColor,s.sldM.style.display=THIS.slider?"block":"none",s.sldM.style.position="absolute",s.sldM.style.right="0",s.sldM.style.top="0",s.sldM.style.width=jscolor.images.sld[0]+jscolor.images.arrow[0]+THIS.pickerFace+2*THIS.pickerInset+"px",s.sldM.style.height=s.box.style.height;try{s.sldM.style.cursor="pointer"}catch(u){s.sldM.style.cursor="hand"}s.btn.style.display=THIS.pickerClosable?"block":"none",s.btn.style.position="absolute",s.btn.style.left=THIS.pickerFace+"px",s.btn.style.bottom=THIS.pickerFace+"px",s.btn.style.padding="0 15px",s.btn.style.height="18px",s.btn.style.border=THIS.pickerInset+"px solid",a(),s.btn.style.color=THIS.pickerButtonColor,s.btn.style.font="12px sans-serif",s.btn.style.textAlign="center";try{s.btn.style.cursor="pointer"}catch(u){s.btn.style.cursor="hand"}s.btn.onmousedown=function(){THIS.hidePicker()},s.btnS.style.lineHeight=s.btn.style.height;switch(modeID){case 0:var f="hs.png";break;case 1:var f="hv.png"}s.padM.style.backgroundImage="url('"+jscolor.getDir()+"cross.gif')",s.padM.style.backgroundRepeat="no-repeat",s.sldM.style.backgroundImage="url('"+jscolor.getDir()+"arrow.gif')",s.sldM.style.backgroundRepeat="no-repeat",s.pad.style.backgroundImage="url('"+jscolor.getDir()+f+"')",s.pad.style.backgroundRepeat="no-repeat",s.pad.style.backgroundPosition="0 0",redrawPad(),redrawSld(),jscolor.picker.owner=THIS,document.getElementsByTagName("body")[0].appendChild(s.boxB)}function getPickerDims(e){var t=[2*e.pickerInset+2*e.pickerFace+jscolor.images.pad[0]+(e.slider?2*e.pickerInset+2*jscolor.images.arrow[0]+jscolor.images.sld[0]:0),e.pickerClosable?4*e.pickerInset+3*e.pickerFace+jscolor.images.pad[1]+e.pickerButtonHeight:2*e.pickerInset+2*e.pickerFace+jscolor.images.pad[1]];return t}function redrawPad(){switch(modeID){case 0:var e=1;break;case 1:var e=2}var t=Math.round(THIS.hsv[0]/6*(jscolor.images.pad[0]-1)),n=Math.round((1-THIS.hsv[e])*(jscolor.images.pad[1]-1));jscolor.picker.padM.style.backgroundPosition=THIS.pickerFace+THIS.pickerInset+t-Math.floor(jscolor.images.cross[0]/2)+"px "+(THIS.pickerFace+THIS.pickerInset+n-Math.floor(jscolor.images.cross[1]/2))+"px";var r=jscolor.picker.sld.childNodes;switch(modeID){case 0:var i=HSV_RGB(THIS.hsv[0],THIS.hsv[1],1);for(var s=0;s<r.length;s+=1)r[s].style.backgroundColor="rgb("+i[0]*(1-s/r.length)*100+"%,"+i[1]*(1-s/r.length)*100+"%,"+i[2]*(1-s/r.length)*100+"%)";break;case 1:var i,o,u=[THIS.hsv[2],0,0],s=Math.floor(THIS.hsv[0]),a=s%2?THIS.hsv[0]-s:1-(THIS.hsv[0]-s);switch(s){case 6:case 0:i=[0,1,2];break;case 1:i=[1,0,2];break;case 2:i=[2,0,1];break;case 3:i=[2,1,0];break;case 4:i=[1,2,0];break;case 5:i=[0,2,1]}for(var s=0;s<r.length;s+=1)o=1-1/(r.length-1)*s,u[1]=u[0]*(1-o*a),u[2]=u[0]*(1-o),r[s].style.backgroundColor="rgb("+u[i[0]]*100+"%,"+u[i[1]]*100+"%,"+u[i[2]]*100+"%)"}}function redrawSld(){switch(modeID){case 0:var e=2;break;case 1:var e=1}var t=Math.round((1-THIS.hsv[e])*(jscolor.images.sld[1]-1));jscolor.picker.sldM.style.backgroundPosition="0 "+(THIS.pickerFace+THIS.pickerInset+t-Math.floor(jscolor.images.arrow[1]/2))+"px"}function isPickerOwner(){return jscolor.picker&&jscolor.picker.owner===THIS}function blurTarget(){valueElement===target&&THIS.importColor(),THIS.pickerOnfocus&&THIS.hidePicker()}function blurValue(){valueElement!==target&&THIS.importColor()}function setPad(e){var t=jscolor.getRelMousePos(e),n=t.x-THIS.pickerFace-THIS.pickerInset,r=t.y-THIS.pickerFace-THIS.pickerInset;switch(modeID){case 0:THIS.fromHSV(n*(6/(jscolor.images.pad[0]-1)),1-r/(jscolor.images.pad[1]-1),null,leaveSld);break;case 1:THIS.fromHSV(n*(6/(jscolor.images.pad[0]-1)),null,1-r/(jscolor.images.pad[1]-1),leaveSld)}}function setSld(e){var t=jscolor.getRelMousePos(e),n=t.y-THIS.pickerFace-THIS.pickerInset;switch(modeID){case 0:THIS.fromHSV(null,null,1-n/(jscolor.images.sld[1]-1),leavePad);break;case 1:THIS.fromHSV(null,1-n/(jscolor.images.sld[1]-1),null,leavePad)}}function dispatchImmediateChange(){THIS.onImmediateChange&&(typeof THIS.onImmediateChange=="string"?eval(THIS.onImmediateChange):THIS.onImmediateChange(THIS))}this.required=!0,this.adjust=!0,this.hash=!1,this.caps=!0,this.slider=!0,this.valueElement=target,this.styleElement=target,this.onImmediateChange=null,this.hsv=[0,0,1],this.rgb=[1,1,1],this.pickerOnfocus=!0,this.pickerMode="HSV",this.pickerPosition="bottom",this.pickerSmartPosition=!0,this.pickerButtonHeight=20,this.pickerClosable=!1,this.pickerCloseText="Close",this.pickerButtonColor="ButtonText",this.pickerFace=10,this.pickerFaceColor="ThreeDFace",this.pickerBorder=1,this.pickerBorderColor="ThreeDHighlight ThreeDShadow ThreeDShadow ThreeDHighlight",this.pickerInset=1,this.pickerInsetColor="ThreeDShadow ThreeDHighlight ThreeDHighlight ThreeDShadow",this.pickerZIndex=1e4;for(var p in prop)prop.hasOwnProperty(p)&&(this[p]=prop[p]);this.hidePicker=function(){isPickerOwner()&&removePicker()},this.showPicker=function(){if(!isPickerOwner()){var e=jscolor.getElementPos(target),t=jscolor.getElementSize(target),n=jscolor.getViewPos(),r=jscolor.getViewSize(),i=getPickerDims(this),s,o,u;switch(this.pickerPosition.toLowerCase()){case"left":s=1,o=0,u=-1;break;case"right":s=1,o=0,u=1;break;case"top":s=0,o=1,u=-1;break;default:s=0,o=1,u=1}var a=(t[o]+i[o])/2;if(!this.pickerSmartPosition)var f=[e[s],e[o]+t[o]-a+a*u];else var f=[-n[s]+e[s]+i[s]>r[s]?-n[s]+e[s]+t[s]/2>r[s]/2&&e[s]+t[s]-i[s]>=0?e[s]+t[s]-i[s]:e[s]:e[s],-n[o]+e[o]+t[o]+i[o]-a+a*u>r[o]?-n[o]+e[o]+t[o]/2>r[o]/2&&e[o]+t[o]-a-a*u>=0?e[o]+t[o]-a-a*u:e[o]+t[o]-a+a*u:e[o]+t[o]-a+a*u>=0?e[o]+t[o]-a+a*u:e[o]+t[o]-a-a*u];drawPicker(f[s],f[o])}},this.importColor=function(){valueElement?this.adjust?!this.required&&/^\s*$/.test(valueElement.value)?(valueElement.value="",styleElement.style.backgroundImage=styleElement.jscStyle.backgroundImage,styleElement.style.backgroundColor=styleElement.jscStyle.backgroundColor,styleElement.style.color=styleElement.jscStyle.color,this.exportColor(leaveValue|leaveStyle)):this.fromString(valueElement.value)||this.exportColor():this.fromString(valueElement.value,leaveValue)||(styleElement.style.backgroundImage=styleElement.jscStyle.backgroundImage,styleElement.style.backgroundColor=styleElement.jscStyle.backgroundColor,styleElement.style.color=styleElement.jscStyle.color,this.exportColor(leaveValue|leaveStyle)):this.exportColor()},this.exportColor=function(e){if(!(e&leaveValue)&&valueElement){var t=this.toString();this.caps&&(t=t.toUpperCase()),this.hash&&(t="#"+t),valueElement.value=t}!(e&leaveStyle)&&styleElement&&(styleElement.style.backgroundImage="none",styleElement.style.backgroundColor="#"+this.toString(),styleElement.style.color=.213*this.rgb[0]+.715*this.rgb[1]+.072*this.rgb[2]<.5?"#FFF":"#000"),!(e&leavePad)&&isPickerOwner()&&redrawPad(),!(e&leaveSld)&&isPickerOwner()&&redrawSld()},this.fromHSV=function(e,t,n,r){e<0&&(e=0)||e>6&&(e=6),t<0&&(t=0)||t>1&&(t=1),n<0&&(n=0)||n>1&&(n=1),this.rgb=HSV_RGB(e===null?this.hsv[0]:this.hsv[0]=e,t===null?this.hsv[1]:this.hsv[1]=t,n===null?this.hsv[2]:this.hsv[2]=n),this.exportColor(r)},this.fromRGB=function(e,t,n,r){e<0&&(e=0)||e>1&&(e=1),t<0&&(t=0)||t>1&&(t=1),n<0&&(n=0)||n>1&&(n=1);var i=RGB_HSV(e===null?this.rgb[0]:this.rgb[0]=e,t===null?this.rgb[1]:this.rgb[1]=t,n===null?this.rgb[2]:this.rgb[2]=n);i[0]!==null&&(this.hsv[0]=i[0]),i[2]!==0&&(this.hsv[1]=i[1]),this.hsv[2]=i[2],this.exportColor(r)},this.fromString=function(e,t){var n=e.match(/^\W*([0-9A-F]{3}([0-9A-F]{3})?)\W*$/i);return n?(n[1].length===6?this.fromRGB(parseInt(n[1].substr(0,2),16)/255,parseInt(n[1].substr(2,2),16)/255,parseInt(n[1].substr(4,2),16)/255,t):this.fromRGB(parseInt(n[1].charAt(0)+n[1].charAt(0),16)/255,parseInt(n[1].charAt(1)+n[1].charAt(1),16)/255,parseInt(n[1].charAt(2)+n[1].charAt(2),16)/255,t),!0):!1},this.toString=function(){return(256|Math.round(255*this.rgb[0])).toString(16).substr(1)+(256|Math.round(255*this.rgb[1])).toString(16).substr(1)+(256|Math.round(255*this.rgb[2])).toString(16).substr(1)};var THIS=this,modeID=this.pickerMode.toLowerCase()==="hvs"?1:0,abortBlur=!1,valueElement=jscolor.fetchElement(this.valueElement),styleElement=jscolor.fetchElement(this.styleElement),holdPad=!1,holdSld=!1,leaveValue=1,leaveStyle=2,leavePad=4,leaveSld=8;jscolor.addEvent(target,"focus",function(){THIS.pickerOnfocus&&THIS.showPicker()}),jscolor.addEvent(target,"blur",function(){abortBlur?abortBlur=!1:window.setTimeout(function(){abortBlur||blurTarget(),abortBlur=!1},0)});if(valueElement){var updateField=function(){THIS.fromString(valueElement.value,leaveValue),dispatchImmediateChange()};jscolor.addEvent(valueElement,"keyup",updateField),jscolor.addEvent(valueElement,"input",updateField),jscolor.addEvent(valueElement,"blur",blurValue),valueElement.setAttribute("autocomplete","off")}styleElement&&(styleElement.jscStyle={backgroundImage:styleElement.style.backgroundImage,backgroundColor:styleElement.style.backgroundColor,color:styleElement.style.color});switch(modeID){case 0:jscolor.requireImage("hs.png");break;case 1:jscolor.requireImage("hv.png")}jscolor.requireImage("cross.gif"),jscolor.requireImage("arrow.gif"),this.importColor()}};jscolor.install(),define("libraries/jscolor/jscolor",function(){}),function(e){function t(){this._settings=[],this._extensions=[],this.regional=[],this.regional[""]={errorLoadingText:"Error loading",notSupportedText:"This browser does not support SVG"},this.local=this.regional[""],this._uuid=(new Date).getTime(),this._renesis=n("RenesisX.RenesisCtrl")}function n(e){try{return!!(window.ActiveXObject&&new ActiveXObject(e))}catch(t){return!1}}function i(t,n){this._svg=t,this._container=n;for(var r=0;r<e.svg._extensions.length;r++){var i=e.svg._extensions[r];this[i[0]]=new i[1](this)}}function s(){this._path=""}function o(){this._parts=[]}function u(e){return e&&e.constructor==Array}var r="svgwrapper";e.extend(t.prototype,{markerClassName:"hasSVG",svgNS:"http://www.w3.org/2000/svg",xlinkNS:"http://www.w3.org/1999/xlink",_wrapperClass:i,_attrNames:{class_:"class",in_:"in",alignmentBaseline:"alignment-baseline",baselineShift:"baseline-shift",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorRendering:"color-rendering",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",underlinePosition:"underline-position",underlineThickness:"underline-thickness",vertAdvY:"vert-adv-y",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode"},_attachSVG:function(t,n){var r=t.namespaceURI==this.svgNS?t:null,t=r?null:t;if(e(t||r).hasClass(this.markerClassName))return;typeof n=="string"?n={loadURL:n}:typeof n=="function"&&(n={onLoad:n}),e(t||r).addClass(this.markerClassName);try{r||(r=document.createElementNS(this.svgNS,"svg"),r.setAttribute("version","1.1"),t.clientWidth>0&&r.setAttribute("width",t.clientWidth),t.clientHeight>0&&r.setAttribute("height",t.clientHeight),t.appendChild(r)),this._afterLoad(t,r,n||{})}catch(i){e.browser.msie?(t.id||(t.id="svg"+this._uuid++),this._settings[t.id]=n,t.innerHTML='<embed type="image/svg+xml" width="100%" height="100%" src="'+(n.initPath||"")+'blank.svg" '+'pluginspage="http://www.adobe.com/svg/viewer/install/main.html"/>'):t.innerHTML='<p class="svg_error">'+this.local.notSupportedText+"</p>"}},_registerSVG:function(){for(var t=0;t<document.embeds.length;t++){var n=document.embeds[t].parentNode;if(!e(n).hasClass(e.svg.markerClassName)||e.data(n,r))continue;var i=null;try{i=document.embeds[t].getSVGDocument()}catch(s){setTimeout(e.svg._registerSVG,250);return}i=i?i.documentElement:null,i&&e.svg._afterLoad(n,i)}},_afterLoad:function(t,n,i){var i=i||this._settings[t.id];this._settings[t?t.id:""]=null;var s=new this._wrapperClass(n,t);e.data(t||n,r,s);try{i.loadURL&&s.load(i.loadURL,i),i.settings&&s.configure(i.settings),i.onLoad&&!i.loadURL&&i.onLoad.apply(t||n,[s])}catch(o){alert(o)}},_getSVG:function(t){return t=typeof t=="string"?e(t)[0]:t.jquery?t[0]:t,e.data(t,r)},_destroySVG:function(t){var n=e(t);if(!n.hasClass(this.markerClassName))return;n.removeClass(this.markerClassName),t.namespaceURI!=this.svgNS&&n.empty(),e.removeData(t,r)},addExtension:function(e,t){this._extensions.push([e,t])},isSVGElem:function(t){return t.nodeType==1&&t.namespaceURI==e.svg.svgNS}}),e.extend(i.prototype,{_width:function(){return this._container?this._container.clientWidth:this._svg.width},_height:function(){return this._container?this._container.clientHeight:this._svg.height},root:function(){return this._svg},configure:function(t,n,r){t.nodeName||(r=n,n=t,t=this._svg);if(r)for(var i=t.attributes.length-1;i>=0;i--){var s=t.attributes.item(i);s.nodeName!="onload"&&s.nodeName!="version"&&s.nodeName.substring(0,5)!="xmlns"&&t.attributes.removeNamedItem(s.nodeName)}for(var o in n)t.setAttribute(e.svg._attrNames[o]||o,n[o]);return this},getElementById:function(e){return this._svg.ownerDocument.getElementById(e)},change:function(t,n){if(t)for(var r in n)n[r]==null?t.removeAttribute(e.svg._attrNames[r]||r):t.setAttribute(e.svg._attrNames[r]||r,n[r]);return this},_args:function(t,n,r){n.splice(0,0,"parent"),n.splice(n.length,0,"settings");var i={},s=0;t[0]!=null&&t[0].jquery&&(t[0]=t[0][0]),t[0]!=null&&(typeof t[0]!="object"||!t[0].nodeName)&&(i.parent=null,s=1);for(var o=0;o<t.length;o++)i[n[o+s]]=t[o];return r&&e.each(r,function(e,t){typeof i[t]=="object"&&(i.settings=i[t],i[t]=null)}),i},title:function(e,t,n){var r=this._args(arguments,["text"]),i=this._makeNode(r.parent,"title",r.settings||{});return i.appendChild(this._svg.ownerDocument.createTextNode(r.text)),i},describe:function(e,t,n){var r=this._args(arguments,["text"]),i=this._makeNode(r.parent,"desc",r.settings||{});return i.appendChild(this._svg.ownerDocument.createTextNode(r.text)),i},defs:function(t,n,r){var i=this._args(arguments,["id"],["id"]);return this._makeNode(i.parent,"defs",e.extend(i.id?{id:i.id}:{},i.settings||{}))},symbol:function(t,n,r,i,s,o,u){var a=this._args(arguments,["id","x1","y1","width","height"]);return this._makeNode(a.parent,"symbol",e.extend({id:a.id,viewBox:a.x1+" "+a.y1+" "+a.width+" "+a.height},a.settings||{}))},marker:function(t,n,r,i,s,o,u,a){var f=this._args(arguments,["id","refX","refY","mWidth","mHeight","orient"],["orient"]);return this._makeNode(f.parent,"marker",e.extend({id:f.id,refX:f.refX,refY:f.refY,markerWidth:f.mWidth,markerHeight:f.mHeight,orient:f.orient||"auto"},f.settings||{}))},style:function(t,n,r){var i=this._args(arguments,["styles"]),s=this._makeNode(i.parent,"style",e.extend({type:"text/css"},i.settings||{}));return s.appendChild(this._svg.ownerDocument.createTextNode(i.styles)),e.browser.opera&&e("head").append('<style type="text/css">'+i.styles+"</style>"),s},script:function(t,n,r,i){var s=this._args(arguments,["script","type"],["type"]),o=this._makeNode(s.parent,"script",e.extend({type:s.type||"text/javascript"},s.settings||{}));return o.appendChild(this._svg.ownerDocument.createTextNode(s.script)),e.browser.mozilla||e.globalEval(s.script),o},linearGradient:function(t,n,r,i,s,o,u,a){var f=this._args(arguments,["id","stops","x1","y1","x2","y2"],["x1"]),l=e.extend({id:f.id},f.x1!=null?{x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2}:{});return this._gradient(f.parent,"linearGradient",e.extend(l,f.settings||{}),f.stops)},radialGradient:function(t,n,r,i,s,o,u,a,f){var l=this._args(arguments,["id","stops","cx","cy","r","fx","fy"],["cx"]),c=e.extend({id:l.id},l.cx!=null?{cx:l.cx,cy:l.cy,r:l.r,fx:l.fx,fy:l.fy}:{});return this._gradient(l.parent,"radialGradient",e.extend(c,l.settings||{}),l.stops)},_gradient:function(t,n,r,i){var s=this._makeNode(t,n,r);for(var o=0;o<i.length;o++){var u=i[o];this._makeNode(s,"stop",e.extend({offset:u[0],stopColor:u[1]},u[2]!=null?{stopOpacity:u[2]}:{}))}return s},pattern:function(t,n,r,i,s,o,u,a,f,l,c){var h=this._args(arguments,["id","x","y","width","height","vx","vy","vwidth","vheight"],["vx"]),p=e.extend({id:h.id,x:h.x,y:h.y,width:h.width,height:h.height},h.vx!=null?{viewBox:h.vx+" "+h.vy+" "+h.vwidth+" "+h.vheight}:{});return this._makeNode(h.parent,"pattern",e.extend(p,h.settings||{}))},clipPath:function(t,n,r,i){var s=this._args(arguments,["id","units"]);return s.units=s.units||"userSpaceOnUse",this._makeNode(s.parent,"clipPath",e.extend({id:s.id,clipPathUnits:s.units},s.settings||{}))},mask:function(t,n,r,i,s,o,u){var a=this._args(arguments,["id","x","y","width","height"]);return this._makeNode(a.parent,"mask",e.extend({id:a.id,x:a.x,y:a.y,width:a.width,height:a.height},a.settings||{}))},createPath:function(){return new s},createText:function(){return new o},svg:function(t,n,r,i,s,o,u,a,f,l){var c=this._args(arguments,["x","y","width","height","vx","vy","vwidth","vheight"],["vx"]),h=e.extend({x:c.x,y:c.y,width:c.width,height:c.height},c.vx!=null?{viewBox:c.vx+" "+c.vy+" "+c.vwidth+" "+c.vheight}:{});return this._makeNode(c.parent,"svg",e.extend(h,c.settings||{}))},group:function(t,n,r){var i=this._args(arguments,["id"],["id"]);return this._makeNode(i.parent,"g",e.extend({id:i.id},i.settings||{}))},use:function(t,n,r,i,s,o,u){var a=this._args(arguments,["x","y","width","height","ref"]);typeof a.x=="string"&&(a.ref=a.x,a.settings=a.y,a.x=a.y=a.width=a.height=null);var f=this._makeNode(a.parent,"use",e.extend({x:a.x,y:a.y,width:a.width,height:a.height},a.settings||{}));return f.setAttributeNS(e.svg.xlinkNS,"href",a.ref),f},link:function(t,n,r){var i=this._args(arguments,["ref"]),s=this._makeNode(i.parent,"a",i.settings);return s.setAttributeNS(e.svg.xlinkNS,"href",i.ref),s},image:function(t,n,r,i,s,o,u){var a=this._args(arguments,["x","y","width","height","ref"]),f=this._makeNode(a.parent,"image",e.extend({x:a.x,y:a.y,width:a.width,height:a.height},a.settings||{}));return f.setAttributeNS(e.svg.xlinkNS,"href",a.ref),f},path:function(t,n,r){var i=this._args(arguments,["path"]);return this._makeNode(i.parent,"path",e.extend({d:i.path.path?i.path.path():i.path},i.settings||{}))},rect:function(t,n,r,i,s,o,u,a){var f=this._args(arguments,["x","y","width","height","rx","ry"],["rx"]);return this._makeNode(f.parent,"rect",e.extend({x:f.x,y:f.y,width:f.width,height:f.height},f.rx?{rx:f.rx,ry:f.ry}:{},f.settings||{}))},circle:function(t,n,r,i,s){var o=this._args(arguments,["cx","cy","r"]);return this._makeNode(o.parent,"circle",e.extend({cx:o.cx,cy:o.cy,r:o.r},o.settings||{}))},ellipse:function(t,n,r,i,s,o){var u=this._args(arguments,["cx","cy","rx","ry"]);return this._makeNode(u.parent,"ellipse",e.extend({cx:u.cx,cy:u.cy,rx:u.rx,ry:u.ry},u.settings||{}))},line:function(t,n,r,i,s,o){var u=this._args(arguments,["x1","y1","x2","y2"]);return this._makeNode(u.parent,"line",e.extend({x1:u.x1,y1:u.y1,x2:u.x2,y2:u.y2},u.settings||{}))},polyline:function(e,t,n){var r=this._args(arguments,["points"]);return this._poly(r.parent,"polyline",r.points,r.settings)},polygon:function(e,t,n){var r=this._args(arguments,["points"]);return this._poly(r.parent,"polygon",r.points,r.settings)},_poly:function(t,n,r,i){var s="";for(var o=0;o<r.length;o++)s+=r[o].join()+" ";return this._makeNode(t,n,e.extend({points:e.trim(s)},i||{}))},text:function(t,n,r,i,s){var o=this._args(arguments,["x","y","value"]);return typeof o.x=="string"&&arguments.length<4&&(o.value=o.x,o.settings=o.y,o.x=o.y=null),this._text(o.parent,"text",o.value,e.extend({x:o.x&&u(o.x)?o.x.join(" "):o.x,y:o.y&&u(o.y)?o.y.join(" "):o.y},o.settings||{}))},textpath:function(t,n,r,i){var s=this._args(arguments,["path","value"]),o=this._text(s.parent,"textPath",s.value,s.settings||{});return o.setAttributeNS(e.svg.xlinkNS,"href",s.path),o},_text:function(t,n,r,i){var s=this._makeNode(t,n,i);if(typeof r=="string")s.appendChild(s.ownerDocument.createTextNode(r));else for(var o=0;o<r._parts.length;o++){var u=r._parts[o];if(u[0]=="tspan"){var a=this._makeNode(s,u[0],u[2]);a.appendChild(s.ownerDocument.createTextNode(u[1])),s.appendChild(a)}else if(u[0]=="tref"){var a=this._makeNode(s,u[0],u[2]);a.setAttributeNS(e.svg.xlinkNS,"href",u[1]),s.appendChild(a)}else if(u[0]=="textpath"){var f=e.extend({},u[2]);f.href=null;var a=this._makeNode(s,u[0],f);a.setAttributeNS(e.svg.xlinkNS,"href",u[2].href),a.appendChild(s.ownerDocument.createTextNode(u[1])),s.appendChild(a)}else s.appendChild(s.ownerDocument.createTextNode(u[1]))}return s},other:function(e,t,n){var r=this._args(arguments,["name"]);return this._makeNode(r.parent,r.name,r.settings||{})},_makeNode:function(t,n,r){t=t||this._svg;var i=this._svg.ownerDocument.createElementNS(e.svg.svgNS,n);for(var n in r){var s=r[n];s!=null&&s!=null&&(typeof s!="string"||s!="")&&i.setAttribute(e.svg._attrNames[n]||n,s)}return t.appendChild(i),i},add:function(t,n){var r=this._args(arguments.length==1?[null,t]:arguments,["node"]),i=this;r.parent=r.parent||this._svg,r.node=r.node.jquery?r.node:e(r.node);try{if(e.svg._renesis)throw"Force traversal";r.parent.appendChild(r.node.cloneNode(!0))}catch(s){r.node.each(function(){var e=i._cloneAsSVG(this);e&&r.parent.appendChild(e)})}return this},clone:function(t,n){var r=this,i=this._args(arguments.length==1?[null,t]:arguments,["node"]);i.parent=i.parent||this._svg,i.node=i.node.jquery?i.node:e(i.node);var s=[];return i.node.each(function(){var e=r._cloneAsSVG(this);e&&(e.id="",i.parent.appendChild(e),s.push(e))}),s},_cloneAsSVG:function(t){var n=null;if(t.nodeType==1){n=this._svg.ownerDocument.createElementNS(e.svg.svgNS,this._checkName(t.nodeName));for(var r=0;r<t.attributes.length;r++){var i=t.attributes.item(r);i.nodeName!="xmlns"&&i.nodeValue&&(i.prefix=="xlink"?n.setAttributeNS(e.svg.xlinkNS,i.localName||i.baseName,i.nodeValue):n.setAttribute(this._checkName(i.nodeName),i.nodeValue))}for(var r=0;r<t.childNodes.length;r++){var s=this._cloneAsSVG(t.childNodes[r]);s&&n.appendChild(s)}}else if(t.nodeType==3)e.trim(t.nodeValue)&&(n=this._svg.ownerDocument.createTextNode(t.nodeValue));else if(t.nodeType==4&&e.trim(t.nodeValue))try{n=this._svg.ownerDocument.createCDATASection(t.nodeValue)}catch(o){n=this._svg.ownerDocument.createTextNode(t.nodeValue.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"))}return n},_checkName:function(e){return e=e.substring(0,1)>="A"&&e.substring(0,1)<="Z"?e.toLowerCase():e,e.substring(0,4)=="svg:"?e.substring(4):e},load:function(t,n){n=typeof n=="boolean"?{addTo:n}:typeof n=="function"?{onLoad:n}:typeof n=="string"?{parent:n}:typeof n=="object"&&n.nodeName?{parent:n}:typeof n=="object"&&n.jquery?{parent:n}:n||{},!n.parent&&!n.addTo&&this.clear(!1);var r=[this._svg.getAttribute("width"),this._svg.getAttribute("height")],i=this,s=function(t){t=e.svg.local.errorLoadingText+": "+t,n.onLoad?n.onLoad.apply(i._container||i._svg,[i,t]):i.text(null,10,20,t)},o=function(e){var t=new ActiveXObject("Microsoft.XMLDOM");return t.validateOnParse=!1,t.resolveExternals=!1,t.async=!1,t.loadXML(e),t.parseError.errorCode!=0?(s(t.parseError.reason),null):t},u=function(t){if(!t)return;if(t.documentElement.nodeName!="svg"){var o=t.getElementsByTagName("parsererror"),u=o.length?o[0].getElementsByTagName("div"):[];s(o.length?(u.length?u[0]:o[0]).firstChild.nodeValue:"???");return}var a=n.parent?e(n.parent)[0]:i._svg,f={};for(var l=0;l<t.documentElement.attributes.length;l++){var c=t.documentElement.attributes.item(l);c.nodeName!="version"&&c.nodeName.substring(0,5)!="xmlns"&&(f[c.nodeName]=c.nodeValue)}i.configure(a,f,!n.parent);var h=t.documentElement.childNodes;for(var l=0;l<h.length;l++)try{if(e.svg._renesis)throw"Force traversal";a.appendChild(i._svg.ownerDocument.importNode(h[l],!0)),h[l].nodeName=="script"&&e.globalEval(h[l].textContent)}catch(p){i.add(a,h[l])}n.changeSize||i.configure(a,{width:r[0],height:r[1]}),n.onLoad&&n.onLoad.apply(i._container||i._svg,[i])};return t.match("<svg")?u(e.browser.msie?o(t):(new DOMParser).parseFromString(t,"text/xml")):e.ajax({url:t,dataType:e.browser.msie?"text":"xml",success:function(t){u(e.browser.msie?o(t):t)},error:function(e,t,n){s(t+(n?" "+n.message:""))}}),this},remove:function(e){return e=e.jquery?e[0]:e,e.parentNode.removeChild(e),this},clear:function(e){e&&this.configure({},!0);while(this._svg.firstChild)this._svg.removeChild(this._svg.firstChild);return this},toSVG:function(e){return e=e||this._svg,typeof XMLSerializer=="undefined"?this._toSVG(e):(new XMLSerializer).serializeToString(e)},_toSVG:function(t){var n="";if(!t)return n;if(t.nodeType==3)n=t.nodeValue;else if(t.nodeType==4)n="<![CDATA["+t.nodeValue+"]]>";else{n="<"+t.nodeName;if(t.attributes)for(var r=0;r<t.attributes.length;r++){var i=t.attributes.item(r);e.trim(i.nodeValue)!=""&&!i.nodeValue.match(/^\[object/)&&!i.nodeValue.match(/^function/)&&(n+=" "+(i.namespaceURI==e.svg.xlinkNS?"xlink:":"")+i.nodeName+'="'+i.nodeValue+'"')}if(t.firstChild){n+=">";var s=t.firstChild;while(s)n+=this._toSVG(s),s=s.nextSibling;n+="</"+t.nodeName+">"}else n+="/>"}return n}}),e.extend(s.prototype,{reset:function(){return this._path="",this},move:function(e,t,n){return n=u(e)?t:n,this._coords(n?"m":"M",e,t)},line:function(e,t,n){return n=u(e)?t:n,this._coords(n?"l":"L",e,t)},horiz:function(e,t){return this._path+=(t?"h":"H")+(u(e)?e.join(" "):e),this},vert:function(e,t){return this._path+=(t?"v":"V")+(u(e)?e.join(" "):e),this},curveC:function(e,t,n,r,i,s,o){return o=u(e)?t:o,this._coords(o?"c":"C",e,t,n,r,i,s)},smoothC:function(e,t,n,r,i){return i=u(e)?t:i,this._coords(i?"s":"S",e,t,n,r)},curveQ:function(e,t,n,r,i){return i=u(e)?t:i,this._coords(i?"q":"Q",e,t,n,r)},smoothQ:function(e,t,n){return n=u(e)?t:n,this._coords(n?"t":"T",e,t)},_coords:function(e,t,n,r,i,s,o){if(u(t))for(var a=0;a<t.length;a++){var f=t[a];this._path+=(a==0?e:" ")+f[0]+","+f[1]+(f.length<4?"":" "+f[2]+","+f[3]+(f.length<6?"":" "+f[4]+","+f[5]))}else this._path+=e+t+","+n+(r==null?"":" "+r+","+i+(s==null?"":" "+s+","+o));return this},arc:function(e,t,n,r,i,s,o,a){a=u(e)?t:a,this._path+=a?"a":"A";if(u(e))for(var f=0;f<e.length;f++){var l=e[f];this._path+=(f==0?"":" ")+l[0]+","+l[1]+" "+l[2]+" "+(l[3]?"1":"0")+","+(l[4]?"1":"0")+" "+l[5]+","+l[6]}else this._path+=e+","+t+" "+n+" "+(r?"1":"0")+","+(i?"1":"0")+" "+s+","+o;return this},close:function(){return this._path+="z",this},path:function(){return this._path}}),s.prototype.moveTo=s.prototype.move,s.prototype.lineTo=s.prototype.line,s.prototype.horizTo=s.prototype.horiz,s.prototype.vertTo=s.prototype.vert,s.prototype.curveCTo=s.prototype.curveC,s.prototype.smoothCTo=s.prototype.smoothC,s.prototype.curveQTo=s.prototype.curveQ,s.prototype.smoothQTo=s.prototype.smoothQ,s.prototype.arcTo=s.prototype.arc,e.extend(o.prototype,{reset:function(){return this._parts=[],this},string:function(e){return this._parts[this._parts.length]=["text",e],this},span:function(e,t){return this._parts[this._parts.length]=["tspan",e,t],this},ref:function(e,t){return this._parts[this._parts.length]=["tref",e,t],this},path:function(t,n,r){return this._parts[this._parts.length]=["textpath",n,e.extend({href:t},r||{})],this}}),e.fn.svg=function(t){var n=Array.prototype.slice.call(arguments,1);return typeof t=="string"&&t=="get"?e.svg["_"+t+"SVG"].apply(e.svg,[this[0]].concat(n)):this.each(function(){typeof t=="string"?e.svg["_"+t+"SVG"].apply(e.svg,[this].concat(n)):e.svg._attachSVG(this,t||{})})},e.svg=new t}(jQuery),define("libraries/jquery/plugins/jquery.svg.package-1.4.5/jquery.svg",function(){}),define("normalize",["require","module"],function(e,t){function o(e,t,n){if(e.indexOf("data:")===0)return e;e=r(e);if(e.match(/^\//)||e.match(s))return e;var i=n.match(s),o=t.match(s);return o&&(!i||i[1]!=o[1]||i[2]!=o[2])?u(e,t):a(u(e,t),n)}function u(e,t){e.substr(0,2)=="./"&&(e=e.substr(2));var n=t.split("/"),r=e.split("/");n.pop();while(curPart=r.shift())curPart==".."?n.pop():n.push(curPart);return n.join("/")}function a(e,t){var n=t.split("/");n.pop(),t=n.join("/")+"/",i=0;while(t.substr(i,1)==e.substr(i,1))i++;while(t.substr(i,1)!="/")i--;t=t.substr(i+1),e=e.substr(i+1),n=t.split("/");var r=e.split("/");out="";while(n.shift())out+="../";while(curPart=r.shift())out+=curPart+"/";return out.substr(0,out.length-1)}var n=/([^:])\/+/g,r=function(e){return e.replace(n,"$1/")},s=/[^\:\/]*:\/\/([^\/])*/,f=function(e,t,n,i){t=r(t),n=r(n);var s=/@import\s*("([^"]*)"|'([^']*)')|url\s*\(\s*(\s*"([^"]*)"|'([^']*)'|[^\)]*\s*)\s*\)/ig,u,a,e;while(u=s.exec(e)){a=u[3]||u[2]||u[5]||u[6]||u[4];var f;i&&a.substr(0,1)=="/"?f=i+a:f=o(a,t,n);var l=u[5]||u[6]?1:0;e=e.substr(0,s.lastIndex-a.length-l-1)+f+e.substr(s.lastIndex-l-1),s.lastIndex=s.lastIndex+(f.length-a.length)}return e};return f.convertURIBase=o,f}),define("css",["./normalize"],function(e){function n(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}var t=0;if(typeof window=="undefined")return{load:function(e,t,n){n()}};var r=!1,i=document.getElementsByTagName("head")[0],s=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)/),o=!1;!s||(s[1]||s[7]?(o=parseInt(s[1])<6||parseInt(s[7])<=9,s="trident"):s[2]?(o=!0,s="webkit"):s[3]||(s[4]?(o=parseInt(s[4])<18,s="gecko"):r&&alert("Engine detection failed")));var u={},a=/^\/|([^\:\/]*:)/;u.pluginBuilder="./css-builder";var f=[],l={},c=[];u.addBuffer=function(e){if(n(f,e)!=-1)return;if(n(c,e)!=-1)return;f.push(e),c.push(e)},u.setBuffer=function(t,n){var r=window.location.pathname.split("/");r.pop(),r=r.join("/")+"/";var i=require.toUrl("base_url").split("/");i.pop();var s=i.join("/")+"/";s=e.convertURIBase(s,r,"/"),s.match(a)||(s="/"+s),s.substr(s.length-1,1)!="/"&&(s+="/"),u.inject(e(t,s,r));for(var o=0;o<f.length;o++)(n&&f[o].substr(f[o].length-5,5)==".less"||!n&&f[o].substr(f[o].length-4,4)==".css")&&(function(e){l[e]=l[e]||!0,setTimeout(function(){typeof l[e]=="function"&&l[e](),delete l[e]},7)}(f[o]),f.splice(o--,1))},u.attachBuffer=function(e,t){for(var r=0;r<f.length;r++)if(f[r]==e)return l[e]=t,!0;if(l[e]===!0)return l[e]=t,!0;if(n(c,e)!=-1)return t(),!0};var h=function(e,t){setTimeout(function(){for(var n=0;n<document.styleSheets.length;n++){var r=document.styleSheets[n];if(r.href==e.href)return t()}h(e,t)},10)},p=function(e,t){setTimeout(function(){try{return e.sheet.cssRules,t()}catch(n){}p(e,t)},10)};if(s=="trident"&&o)var d=[],v=[],m=0,g=function(e,t){var n;v.push({url:e,cb:t}),n=d.shift(),!n&&m++<31&&(n=document.createElement("style"),i.appendChild(n)),n&&y(n)},y=function(e){var t=v.shift();if(!t){e.onload=w,d.push(e);return}e.onload=function(){t.cb(t.ss),y(e)};try{var n=e.styleSheet;t.ss=n.imports[n.addImport(t.url)]}catch(r){alert("Got Error:"+r)}};var b=function(e){var t=document.createElement("link");return t.type="text/css",t.rel="stylesheet",t.href=e,t},w=function(){};u.linkLoad=function(e,t){var n=setTimeout(function(){r&&alert("timeout"),t()},A*1e3-100),u=function(){clearTimeout(n),a&&(a.onload=w),setTimeout(t,7)};if(!o){var a=b(e);a.onload=u,i.appendChild(a)}else if(s=="webkit"){var a=b(e);h(a,u),i.appendChild(a)}else if(s=="gecko"){var f=document.createElement("style");f.textContent='@import "'+e+'"',p(f,u),i.appendChild(f)}else s=="trident"&&g(e,u)};var E=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],S={},x=function(e,t,n){if(S[e]){t(S[e]);return}var r,i,s;if(typeof XMLHttpRequest!="undefined")r=new XMLHttpRequest;else if(typeof ActiveXObject!="undefined")for(i=0;i<3;i+=1){s=E[i];try{r=new ActiveXObject(s)}catch(o){}if(r){E=[s];break}}r.open("GET",e,requirejs.inlineRequire?!1:!0),r.onreadystatechange=function(i){var s,o;r.readyState===4&&(s=r.status,s>399&&s<600?(o=new Error(e+" HTTP status: "+s),o.xhr=r,n(o)):(S[e]=r.responseText,t(r.responseText)))},r.send(null)},T=0,N;u.inject=function(e){T<31&&(N=document.createElement("style"),N.type="text/css",i.appendChild(N),T++),N.styleSheet?N.styleSheet.cssText+=e:N.appendChild(document.createTextNode(e))};var C=/@import\s*(url)?\s*(('([^']*)'|"([^"]*)")|\(('([^']*)'|"([^"]*)"|([^\)]*))\))\s*;?/g,k=window.location.pathname.split("/");k.pop(),k=k.join("/")+"/";var L=function(t,n,r){t.match(a)||(t="/"+e.convertURIBase(t,k,"/")),x(t,function(i){i=e(i,t,k);var s=[],o=[],u=[],a;while(a=C.exec(i)){var f=a[4]||a[5]||a[7]||a[8]||a[9];s.push(f),o.push(C.lastIndex-a[0].length),u.push(a[0].length)}var l=0;for(var c=0;c<s.length;c++)(function(e){L(s[e],function(t){i=i.substr(0,o[e])+t+i.substr(o[e]+u[e]);var r=t.length-u[e];for(var a=e+1;a<s.length;a++)o[a]+=r;l++,l==s.length&&n(i)},r)})(c);s.length==0&&n(i)},r)};u.normalize=function(e,t){return e.substr(e.length-4,4)==".css"&&(e=e.substr(0,e.length-4)),t(e)};var A,O=!1;return u.load=function(e,t,n,i,s){A=A||i.waitSeconds||7;var a=e+(s?".less":".css");if(u.attachBuffer(a,n))return;var f=t.toUrl(a);!O&&r&&(alert(o?"hacking links":"not hacking"),O=!0),s?L(f,function(e){s&&(e=s(e,function(e){u.inject(e),setTimeout(n,7)}))}):u.linkLoad(f,n)},r&&(u.inspect=function(){if(stylesheet.styleSheet)return stylesheet.styleSheet.cssText;if(stylesheet.innerHTML)return stylesheet.innerHTML}),u}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/myplaces2/css/myplaces.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.registerLocalization({lang:"fi",key:"MyPlaces2",value:{title:"Kohteet",desc:"",category:{defaultName:"Oma karttataso",organization:"Omat kohteet",inspire:"Omat kohteet"},guest:{loginShort:"Kirjaudu sisn kyttksesi"},tab:{title:"Kohteet",nocategories:"Et ole viel tallentanut kohteita.",publishCategory:{privateTooltip:"Taso on yksityinen. Muuta taso julkiseksi klikkaamalla.",publicTooltip:"Taso on julkinen. Muuta taso yksityiseksi klikkaamalla."},editCategory:"Muokkaa tasoa",deleteCategory:"Poista taso",edit:"Muokkaa","delete":"Poista",grid:{name:"Nimi",desc:"Kuvaus",createDate:"Luotu",updateDate:"Pivitetty",edit:" ","delete":" "},notification:{"delete":{title:"Kohteen poistaminen",confirm:"Haluatko poistaa kohteen?",btnDelete:"Poista",btnCancel:"Peruuta",success:"Kohde on poistettu.",error:"Kohteen poistaminen eponnistui. Kokeile uudestaan myhemmin.",cancel:"Kohdetta ei ole poistettu."}}},tools:{point:{tooltip:"Lis piste",add:"Lis piste klikkaamalla karttaa.",next:"Voit tallentaa tai piirt pisteit samaan kohteeseen.",edit:"Siirr pistett raahaamalla.",save:"Tallenna sijainti"},line:{tooltip:"Lis viiva",add:"Lis viivan taitepiste klikkaamalla karttaa. Lopeta piirto tuplaklikkauksella tai painamalla 'Lopeta piirto'.",next:"Voit tallentaa tai piirt lis viivoja samaan kohteeseen.",edit:"Muokkaa viivaa raahaamalla viivan taitepisteit.",save:"Tallenna muoto"},area:{tooltip:"Lis alue",add:"Lis alueen taitepisteet klikkaamalla karttaa. Lopeta piirto tuplaklikkauksella tai painamalla 'Lopeta piirto'. Voit piirt alueeseen rein pitmll pohjassa Alt-nppint.",next:"Voit tallentaa tai piirt lis alueita samaan kohteeseen.",edit:"Muokkaa muotoa raahaamalla reunaviivan taitepisteit.",save:"Tallenna muoto"}},buttons:{ok:"OK",cancel:"Peruuta",finish:"Lopeta piirto",save:"Tallenna",movePlaces:"Siirr kohteet ja poista",deleteCategory:"Poista",deleteCategoryAndPlaces:"Poista kohteineen",changeToPublic:"Muuta julkiseksi",changeToPrivate:"Muuta yksityiseksi"},placeform:{title:"Kohteen tiedot",tooltip:"Kun list kohteen kartalle, se tallentuu Omiin tietoihisi. Anna kohteelle nimi ja kuvaus. Voit valita, mille karttatasolle tallennat kohteen tai list uuden karttatason valitsemalla 'Uusi taso' karttatasojen pudotusvalikosta.",placename:{placeholder:"Anna kohteelle nimi"},placelink:{placeholder:"Anna URL-osoite"},placedesc:{placeholder:"Kuvaile kohdetta"},category:{label:"Karttataso",newLayer:"Luo uusi karttataso",choose:" tai valitse olemassa olevista tasoista:"},imagelink:{placeholder:"Kuva-URL",previewLabel:"Valokuvan esikatselu",add:"Uusi taso"},rendering:{label:"Tason kohteiden esitystavat",point:{tooltip:"Piste"}}},categoryform:{name:{label:"Nimi",placeholder:"Anna tasolle nimi"},drawing:{label:"Piirtojlki",point:{label:"Piste",color:"Vri",size:"Koko"},line:{label:"Viiva",color:"Vri",size:"Paksuus"},area:{label:"Alue",fillcolor:"Tyttvri",linecolor:"Viivan vri",size:"Viivan paksuus"}},visibleFields:{label:"Nytettvt kohteen tiedot",placename:"Nimi",placedesc:"Kuvaus",image:"Kuva"},edit:{title:"Muokkaa karttatasoa",save:"Tallenna",cancel:"Peruuta"},rendering:{label:"Tason kohteiden esitystavat",point:{tooltip:"Muokkaa pisteen esitystapaa"},area:{tooltip:"Muokkaa alueen esitystapaa"},line:{tooltip:"Muokkaa viivan esitystapaa"}}},pointform:{title:"Pistekohteen esitystapa",tooltip:"",symbol:{label:"Pistekohteen kuvake"},size:{label:"Koko"},color:{label:"Vri",labelOr:"tai",labelCustom:"Oma RGB-vri (0-255)"},preview:{label:"Esikatselu"},buttons:{save:"Tallenna",cancel:"Peruuta"}},lineform:{title:"Viivan esitystapa",tooltip:"",style:{label:"Viivan tyyli"},cap:{label:"Viivan pdyt"},corner:{label:"Kulmat"},width:{label:"Leveys"},color:{label:"Vri",labelOr:"tai",labelCustom:"Oma RGB-vri (0-255)"},preview:{label:"Esikatselu"},buttons:{save:"Tallenna",cancel:"Peruuta"}},areaform:{title:"Alueen esitystapa",tooltip:"",linestyle:{label:"Alueen viivan tyyli"},linecap:{label:"Alueen viivan pdyt"},linecorner:{label:"Kulmat"},linewidth:{label:"Leveys"},linecolor:{label:"Viivan vri",labelOr:"tai",labelCustom:"Oma RGB-vri (0-255)"},color:{label:"Alueen tyttvri",labelOr:"tai",labelCustom:"Oma RGB-vri (0-255)"},fill:{label:"Alueen tyttkuvio"},preview:{label:"Esikatselu"},buttons:{save:"Tallenna",cancel:"Peruuta"}},notification:{placeAdded:{title:"Kohde tallennettu",message:"Lydt kohteen Omat Tiedot -valikosta."},categorySaved:{title:"Karttataso tallennettu",message:"Karttatason muutokset on tallennettu."},categoryDelete:{title:"Karttatason poisto",deleteConfirmMove:"Karttataso: {0} sislt kohteita {1} kpl. Haluatko poistaa tason ja siirt sen kohteet oletuskarttatasolle {2}?",deleteConfirm:"Haluatko poistaa karttatason {0}?",deleted:"Karttataso poistettu."},categoryToPublic:{title:"Muuta karttataso julkiseksi",message:'Olet muuttamassa karttatasoa "{0}" julkiseksi. Voit jakaa julkisen karttatason verkossa tai julkaista sen karttana toiseen verkkopalveluun. Muut kyttjt voivat mys katsoa karttatasoa Paikkatietoikkunassa.'},categoryToPrivate:{title:"Muuta karttataso yksityiseksi",message:'Olet muuttamassa karttatasoa "{0}" yksityiseksi. Tmn jlkeen et voi jakaa tai julkaista karttana, eivtk muut kyttjt ne sit Paikkatietoikkunassa.'},error:{addCategory:"Tason tallennus eponnistui. Kohdetta ei ole tallennettu.",editCategory:"Tason tallennus eponnistui.",savePlace:"Kohteen tallentaminen ei onnistunut.",title:"Virhe!",generic:"Jrjestelmss tapahtui virhe. Yrit uudelleen myhemmin.",deleteCategory:"Virhe poistossa!",deleteDefault:"Oletuskarttatasoa ei voi poistaa."}},validation:{title:"Tiedoissa puutteita:",placeName:"Kohteen nimi puuttuu.",categoryName:"Tason nimi puuttuu.",placeNameIllegal:"Kohteen nimess on luvattomia merkkej. Sallittuja merkkej ovat kaikki suomen kielen aakkoset, numerot sek vlilynti ja yhdysmerkki.",descIllegal:"Kohteen kuvauksessa on luvattomia merkkej. Sallittuja merkkej ovat kaikki suomen kielen aakkoset, numerot sek vlilynti ja yhdysmerkki.",categoryNameIllegal:"Tason nimess on luvattomia merkkej. Sallittuja merkkej ovat kaikki suomen kielen aakkoset, numerot sek vlilynti ja yhdysmerkki.",dotSize:"Pisteen koko ei ole sallituissa rajoissa (1-5).",dotColor:"Pisteen vri virheellinen.",dotShape:"Pisteen muoto virheellinen.",lineSize:"Viivan koko ei ole sallituissa rajoissa (1-50).",lineColor:"Viivan vri virheellinen.",areaLineSize:"Alueen viivan koko ei ole sallituissa rajoissa (0-50).",areaLineColor:"Alueen viivan vri virheellinen.",areaFillColor:"Alueen tyttvri virheellinen."}}}),define("bundles/framework/bundle/myplaces2/locale/fi",function(){}),Oskari.registerLocalization({lang:"sv",key:"MyPlaces2",value:{title:"Objekt",desc:"",category:{defaultName:"Mitt kartlager",organization:"Mina objekt",inspire:"Mina objekt"},guest:{loginShort:"Logga in fr att anvnda"},tab:{title:"Objekt",nocategories:"Du har nnu inte lagrat objekten.",publishCategory:{privateTooltip:"Kartlagret r privat. Klicka p lagret fr att offentliggra det.",publicTooltip:"Kartlagret r offentliggra. Klicka p lagret fr att privat det."},editCategory:"Editera kartlager",deleteCategory:"Ta bort kartlager",edit:"Editera","delete":"Ta bort",grid:{name:"Namn",desc:"Beskrivning",createDate:"Skapad",updateDate:"Uppdaterad",edit:" ","delete":" "},notification:{"delete":{title:"Ta bort objekt",confirm:"Vill du ta bort detta objekt?",btnDelete:"Ta bort",btnCancel:"Tillbaka",success:"Objektet har tagits bort.",error:"Objektet kunde inte tas bort. Prova p nytt senare.",cancel:"Objektet har inte tagits bort."}}},tools:{point:{tooltip:"Tillgg punkt",add:"Tillgg punkt genom att klicka p kartan.",next:"Du kan lagra eller tillgga fler punkter till samma omrdet.",edit:"Flytta p punkten genom att klicka och dra.",save:"Lagra lge"},line:{tooltip:"Tillgg linje",add:"Tillgg en brytningspunkt p linjen genom att klicka p kartan. Sluta rita genom att dubbelklicka eller klicka p 'Sluta rita'.",next:"Du kan lagra eller tillgga fler linjer till samma omrdet.",edit:"Editera linjen genom att klicka och dra brytningspunkterna.",save:"Lagra form"},area:{tooltip:"Tillgg omrde",add:"Tillgg omrdets hrnpunkter genom att klicka p kartan. Sluta rita genom att dubbelklicka eller klicka p 'Sluta rita'. Hll ned Alt-tangenten fr att skapa hl i polygonerna.",next:"Du kan lagra eller tillgga fler polygoner till samma omrdet.",edit:"Editera omrdets form genom att klicka och dra brytningspunkterna p omkretslinjen.",save:"Lagra form"}},buttons:{ok:"OK",cancel:"Tillbaka",finish:"Sluta rita",save:"Lagra",movePlaces:"Flytta objekt och ta bort",deleteCategory:"Ta bort",deleteCategoryAndPlaces:"Ta bort kategori inklusive objekt",changeToPublic:"ndra till offentlig",changeToPrivate:"ndra till privat"},placeform:{title:"Uppgifter om objektet",tooltip:"Nr du lgger ett objekt p kartan lagras det i dina objekt. Ge objektet ett namn och en beskrivning. Du kan vlja vilket kartlager du vill lagra objektet p eller tillgga ett nytt kartlager genom att vlja 'Ny niv' frn rullgardinsmenyn fr kartlager.",placename:{placeholder:"Namnge objektet"},placelink:{placeholder:"Ge URL-address"},placedesc:{placeholder:"Beskriv objektet"},category:{label:"Kartlager",newLayer:"Ny niv...",choose:" eller vlj frn niver:"},imagelink:{placeholder:"Bild-URL",previewLabel:"Frhandsvisning av fotot",add:"Ny niv"},rendering:{label:"",point:{tooltip:"Punkt"}}},categoryform:{name:{label:"Namn",placeholder:"Namnge kartlagret"},drawing:{label:"Stil",point:{label:"Punkt",color:"Frg",size:"Storlek"},line:{label:"Linje",color:"Frg",size:"Tjocklek"},area:{label:"Omrde",fillcolor:"Ifyllnadsfrg",linecolor:"Linjens frg",size:"Linjens tjocklek"}},visibleFields:{label:"Uppgifter om objektet som visas",placename:"Namn",placedesc:"Beskrivning",image:"Bild"},edit:{title:"Editera kartlagret",save:"Lagra",cancel:"Tillbaka"},rendering:{label:"",point:{tooltip:"Editera punktens stil"},area:{tooltip:"Editera omrdets stil"},line:{tooltip:"Editera linjens stil"}}},pointform:{title:"Visualisering av punktobjekt",tooltip:"Punktens stil",symbol:{label:"Ikon fr punktobjekt"},size:{label:"Storlek"},color:{label:"Frg",labelOr:"eller",labelCustom:"Egen RGB-frg (0-255)"},preview:{label:"Frhandsgranska"},buttons:{save:"Lagra",cancel:"Tillbaka"}},lineform:{title:"Visualisering av linje",tooltip:"",style:{label:"Linjens stil"},cap:{label:"Linjens ndpunkter"},corner:{label:"Hrn"},width:{label:"Bredd"},color:{label:"Frg",labelOr:"eller",labelCustom:"Egen RGB-frg (0-255)"},preview:{label:"Frhandsgranska"},buttons:{save:"Lagra",cancel:"Tillbaka"}},areaform:{title:"Visualisering av omrdet",tooltip:"",linestyle:{label:"Konturlinjens stil"},linecap:{label:"Linjens ndpunkter"},linecorner:{label:"Hrn"},linewidth:{label:"Bredd"},linecolor:{label:"Linjens frg",labelOr:"eller",labelCustom:"Egen RGB-frg (0-255)"},color:{label:"Ifyllnadsfrg fr omrde",labelOr:"eller",labelCustom:"Egen RGB-frg (0-255)"},fill:{label:"Ifyllnandsmnster fr omrde"},preview:{label:"Frhandsvisning"},buttons:{save:"Lagra",cancel:"Tillbaka"}},notification:{placeAdded:{title:"Objektet har lagrats",message:"Objektet finns i menyn Mina uppgifter"},categorySaved:{title:"Kartlagret har lagrats",message:"ndringar i kartlagret har lagrats"},categoryDelete:{title:"Ta bort kartlager",deleteConfirmMove:"Kartlager: {0} innehller {1} st. objekt. Vill du ta bort nivn och flytta objekten p den till det frvalda kartlagret {2} ?",deleteConfirm:"Vill du ta bort kartlagret {0}?",deleted:"Kartlagret borttaget"},categoryToPublic:{title:"Offentliggr kartlagret",message:'Du hller p att offentliggra kartlagret "{0}". Du kan skicka lnkar till ett offentligt kartlager till andra internetanvndare eller inbdda det som en karta i en annan webbtjnst. Andra anvndare kan ven titta p kartlagret i Paikkatietoikkuna.'},categoryToPrivate:{title:"Gr kartlagret privat",message:'Du hller p att gra kartlagret "{0}" privat. Efter detta kan du inte lngre skicka lnkar frn kart-lagret eller inbdda det som en karta, andra anvndare kan inte heller titta p det i Paikkatietoikkuna.'},error:{addCategory:"Kartlagret kunde inte lagras. Objektet har inte lagrats.",editCategory:"Kartlagret kunde inte lagras.",savePlace:"Objektet kunde inte lagras.",title:"Fel!",generic:"Systemfel. Frsk p nytt senare.",deleteCategory:"Fel i borttagningen!",deleteDefault:"Den frvalda kartlagret kan inte tas bort."}},validation:{title:"Brister i uppgifterna:",placeName:"Objektets namn saknas.",categoryName:"kartlagrets namn saknas.",placeNameIllegal:"I objekts namnet ingr otilltna tecken. Tilltna r alla bokstver i det svenska alfabetet, siffror, mellanslag och bindestreck.",descIllegal:"I objekts beskrivning ingr otilltna tecken. Tilltna r alla bokstver i det svenska alfabetet, siffror, mellanslag och bindestreck.",categoryNameIllegal:"I kartlagers beskrivning ingr otilltna tecken. Tilltna r alla bokstver i det svenska alfabetet, siffror, mellanslag och bindestreck.",dotSize:"Punkternas storlek r utanfr de tilltna grnserna (1-5).",dotColor:"Punktens frg r felaktig.",dotShape:"Punktens form r felaktig.",lineSize:"Linjens storlek r utanfr de tilltna grnserna (1-50).",lineColor:"Linjens frg r felaktig.",areaLineSize:"Omrdets konturlinje r utanfr de tilltna grnserna (0-50).",areaLineColor:"Frgen p omrdets omkretslinje r felaktig.",areaFillColor:"Omrdets ifyllnadsfrg r felaktig."}}}),define("bundles/framework/bundle/myplaces2/locale/sv",function(){}),Oskari.registerLocalization({lang:"en",key:"MyPlaces2",value:{title:"Places",desc:"",category:{defaultName:"My map layer",organization:"My places",inspire:"My places"},guest:{loginShort:"Log in to use"},tab:{title:"Places",nocategories:"You have not yet saved the places.",publishCategory:{privateTooltip:"The map layer is private. Click the map layer to make it public.",publicTooltip:"The map layer is public. Click the map layer to make it private."},editCategory:"Edit map layer",deleteCategory:"Delete map layer",edit:"Edit","delete":"Delete",grid:{name:"Name",desc:"Description",createDate:"Created",updateDate:"Updated",edit:" ","delete":" "},notification:{"delete":{title:"Delete place",confirm:"Do you want to delete this place?",btnDelete:"Delete",btnCancel:"Cancel",success:"The place has been deleted.",error:"The place could not be deleted. Please try again later.",cancel:"The object has not been deleted."}}},tools:{point:{tooltip:"Add point",add:"Add point by clicking the map.",next:"You can save or draw more points into the same drawing.",edit:"Move point by clicking and dragging.",save:"Save location"},line:{tooltip:"Add line",add:"Add a break point on the line by clicking the map. Stop drawing by double clicking or by clicking 'Finish drawing'.",next:"You can save or draw more lines into the same drawing.",edit:"Edit the line by clicking and dragging its break points.",save:"Save shape"},area:{tooltip:"Add area",add:"Add break points to your area polygon by clicking the map. Stop drawing by double clicking or by clicking 'Finish drawing'. To create holes in polygons, hold down the Alt key.",next:"You can save or draw more polygons into the same drawing.",edit:"Edit the shape of the area by clicking and dragging the break points on its edge line.",save:"Save shape"}},buttons:{ok:"OK",cancel:"Cancel",finish:"Finish drawing",save:"Save",movePlaces:"Move places and delete",deleteCategory:"Delete",deleteCategoryAndPlaces:"Delete category and places",changeToPublic:"Make public",changeToPrivate:"Make private"},placeform:{title:"Place data",tooltip:"A place put on the map will be saved in My places. Give the place a name and describe it. You can select the map layer where the place will be stored, or choose a new map layer by selecting 'New layer' in the map layer drop-down menu.",placename:{placeholder:"Give the place a name"},placelink:{placeholder:"Give a URL"},placedesc:{placeholder:"Describe the place"},category:{label:"Map layer",newLayer:"Create a new layer",choose:" or choose from your layers:"},imagelink:{placeholder:"Image URL",previewLabel:"Image preview",add:"New layer..."},rendering:{label:"Object rendering",point:{tooltip:"Point"}}},categoryform:{name:{label:"Name",placeholder:"Give the map layer a name"},drawing:{label:"Style",point:{label:"Point",color:"Colour",size:"Size"},line:{label:"Line",color:"Colour",size:"Thickness"},area:{label:"Area",fillcolor:"Fill-in colour",linecolor:"Line colour",size:"Line thickness"}},visibleFields:{label:"Visible fields",placename:"Name",placedesc:"Description",image:"Image"},edit:{title:"Edit map layer",save:"Save",cancel:"Back"},rendering:{label:"Layer's features' style",point:{tooltip:"Edit point style"},area:{tooltip:"Edit area style"},line:{tooltip:"Edit line style"}}},pointform:{title:"Point feature portrayal",tooltip:"",symbol:{label:"Point feature icon"},size:{label:"Size"},color:{label:"Colour",labelOr:"or",labelCustom:"Custom RGB color (0-255)"},preview:{label:"Preview"},buttons:{save:"Save",cancel:"Cancel"}},lineform:{title:"Line portrayal",tooltip:"",style:{label:"Line style"},cap:{label:"Line endigs"},corner:{label:"Corners"},width:{label:"Width"},color:{label:"Colour",labelOr:"or",labelCustom:"Custom RGB colour (0-255)"},preview:{label:"Preview"},buttons:{save:"Save",cancel:"Cancel"}},areaform:{title:"Area portrayal",tooltip:"",linestyle:{label:"Area line style"},linecap:{label:"Area line endings"},linecorner:{label:"Corners"},linewidth:{label:"Width"},linecolor:{label:"Line colour",labelOr:"or",labelCustom:"Custom RGB colour (0-255)"},color:{label:"Area fill colour",labelOr:"or",labelCustom:"Own RGB colour (0-255)"},fill:{label:"Area fill pattern"},preview:{label:"Preview"},buttons:{save:"Save",cancel:"Cancel"}},notification:{placeAdded:{title:"The place has been saved",message:"The place can be found in the My data menu"},categorySaved:{title:"Map layer saved",message:"Map layer edits saved"},categoryDelete:{title:"Delete map layer",deleteConfirmMove:"Map layer {0} contains {1} objects. Do you want to delete the map layer and move the places on it to the default map layer {2} ?",deleteConfirm:"Delete map layer {0}?",deleted:"Map layer deleted"},categoryToPublic:{title:"Make map layer public",message:'You are making the map layer "{0}" public. You can share links to a public map layer with other internet users or embed the map layer as a map window on another website. Other users can also view the map layer in Paikkatietoikkuna.'},categoryToPrivate:{title:"Make map layer private",message:'You are making the map layer "{0}" private. After this it will no longer be possible to share it with other users or embed it on another website. Other users can no longer view the map layer in Paikkatietoikkuna.'},error:{addCategory:"The map layer could not be saved. The place has not been saved.",editCategory:"The map layer could not be saved.",savePlace:"The place could not be saved.",title:"Error!",generic:"System error. Please try again later.",deleteCategory:"Error occurred while deleting!",deleteDefault:"The default map layer cannot be deleted."}},validation:{title:"Data contains errors:",placeName:"Place name missing.",categoryName:"Map layer name missing.",placeNameIllegal:"The object name contains disallowed characters. Allowed characters are the letters a-z as well as ,  and , numbers, backspaces and hyphens.",descIllegal:"The object description contains disallowed characters. Allowed characters are the letters a-z as well as ,  and , numbers, backspaces and hyphens.",categoryNameIllegal:"The layer description contains disallowed characters. Allowed characters are the letters a-z as well as ,  and , numbers, backspaces and hyphens.",dotSize:"The dot size does not fit the size limits (1-5).",dotColor:"Wrong dot colour.",dotShape:"Wrong dot shape.",lineSize:"The line size does not fit the size limits (1-50).",lineColor:"Wrong line colour.",areaLineSize:"The area edge size does not fit the limits (0-50).",areaLineColor:"Wrong area edge line colour.",areaFillColor:"Wrong fill-in colour."}}}),define("bundles/framework/bundle/myplaces2/locale/en",function(){}),Oskari.registerLocalization({lang:"cs",key:"MyPlaces2",value:{title:"Msta",desc:"",category:{defaultName:"Moje mapov vrstva",organization:"Moje msta",inspire:"Moje msta"},guest:{loginShort:"Pro pouit se pihlate"},tab:{title:"Msta",nocategories:"Msta jste jet neuloil.",publishCategory:{privateTooltip:"Mapa je soukrom| Kliknte na mapovou vrstvu pro jej veejn zpstupnn.",publicTooltip:"Mapa je veejn| Kliknte na mapovou vrstvu pro jej zmnu na soukromou."},editCategory:"Upravit mapovou vrstvu",deleteCategory:"Smazat mapovou vrstvu",edit:"Upravit","delete":"Smazat",grid:{name:"Jmno",desc:"Popis",createDate:"Vytvoeno",updateDate:"Aktualizovno",edit:" ","delete":" "},notification:{"delete":{title:"Smazat msto",confirm:"Chcete toto msto smazat?",btnDelete:"Smazat",btnCancel:"Storno",success:"Msto bylo smazno.",error:"Msto nelze smazat, zkuste to prosm pozdji.",cancel:"Tento objekt nebyl smazn."}}},tools:{point:{tooltip:"Pidat bod","new":"Pidat bod kliknutm v map",next:"Lze uloit nebo umstit vce bod ve stejnm vkresu.",edit:"Pesun bodu kliknutm a taenm.",save:"Uloit polohu"},line:{tooltip:"Pidat dek","new":'Pidat lomov bod do linie kliknutm v map. Ukonit kreslen dvojitm kliknutm nebo kliknutm na "Ukonit kreslen".',next:"Lze uloit nebo umstit vce lini ve stejnm vkresu.",edit:"Upravit linii kliknutm a taenm jejch lomovch bod.",save:"Uloit tvar"},area:{tooltip:"Pidat plochu","new":'Pidat lomov body do plochy polygonu kliknutm do mapy. Ukonit kreslen dvojitm kliknutm nebo kliknutm "Ukonit kreslen". Pro vytvoen dr v polygonech, pidrte stisknutou klvesu Alt.',next:"Lze uloit nebo umstit vce polygon ve stejnm vkresu.",edit:"Upravit tvar plochy kliknutm a taenm jejch lomovch bod.",save:"Uloit tvar"}},buttons:{ok:"OK",cancel:"Storno",finish:"Ukonit kreslen",save:"Uloit",movePlaces:"Posunot msta a smazat",deleteCategory:"Smazat",deleteCategoryAndPlaces:"Smazat kategorii a msta",changeToPublic:"Zmnit na veejn",changeToPrivate:"Zmnit na soukrom"},placeform:{title:"Umstit data",tooltip:'Msto vloen do mapy bude uloeno v "Mch mstech". Pojmenujte msto a popite jej. Lze vybrat mapovou vrstvu, ve kter bude msto uloeno nebo vybrat novou mapovou vrstvu pomoc "Nov vrstva" v roletovm menu mapovch vrstev.',placename:{placeholder:"Pojmenovat msto"},placelink:{placeholder:"Uvst URL"},placedesc:{placeholder:"Popsat msto"},category:{label:"Mapov vrstva","new":"Nov vrstva..."}},categoryform:{name:{label:"Jmno",placeholder:"Pojmenovat mapovou vrstvu"},drawing:{label:"Styl",point:{label:"Bod",color:"Barva",size:"Velikost"},line:{label:"ra",color:"Barva",size:"Tlouka"},area:{label:"Plocha",fillcolor:"Barva vpln",linecolor:"Barva ry",size:"Tlouka ry"}},edit:{title:"Upravit mapovou vrstvu",save:"Uloit",cancel:"Zpt"}},notification:{placeAdded:{title:"Msto bylo uloeno",message:"Msto lze nalzt v menu M data"},categorySaved:{title:"Mapov vrstva uloena",message:"Zmny mapov vrstvy uloeny"},categoryDelete:{title:"Smazat mapovou vrstvu",deleteConfirmMove:"Mapov vrstva {0} obsahuje {1} objekt. Chcete smazat mapovou vrstvu a penst msta v n do defaultn mapov vrstvy {2}?",deleteConfirm:"Smazat mapovou vrstvu {0}?",deleted:"Mapov vrstva smazna"},categoryToPublic:{title:"Zmnit mapovou vrstvu na veejnou",message:"Mnte mapovou vrstvu {0} na veejnou. Mete sdlet odkazy na veejnou mapovou vrstvu s jinmi uivateli internetu nebo vloit mapovou vrstvu do mapovho okna na jin webov strnce. Ostatn uivatel tuto mapovou vrstvu uvid tak."},categoryToPrivate:{title:"Zmnit mapovou vrstvu na soukromou",message:"Mnte mapovou vrstvu {0} na soukromou. Pak nebude mon ji sdlet s jinmi uivateli nebo ji vkldat do jin webov strnky. Ostatn uivatel tuto mapovou vrstvu ji neuvid."},error:{addCategory:"Mapovou vrstvu nelze uloit. Msto nebylo uloeno.",editCategory:"Mapovou vrstvu nelze uloit.",savePlace:"Msto nelze uloit.",title:"Chyba!",generic:"Systmov chyba. Prosm, zkuste znovu pozdji.",deleteCategory:"Bhem mazn se vyskytla chyba.",deleteDefault:"Defaultn mapovou vrstvu nelze smazat."}},validation:{title:"V datech se vyskytuj chyby:",placeName:"Msto nen pojmenovno.",categoryName:"Mapov vrstva nen pojmenovna.",placeNameIllegal:"Jmno objektu obsahuje nepovolen znaky. Povolen znaky jsou a-z, ,  a , sla, mezery a pomlky.",descIllegal:"Popis objektu  obsahuje nepovolen znaky. Povolen znaky jsou a-z, ,  a , sla, mezery a pomlky.",categoryNameIllegal:"Popis vrstvy obsahuje nepovolen znaky. Povolen znaky jsou a-z, ,  a , sla, mezery a pomlky.",dotSize:"Velikost bodu nespluje velikostn omezen (1-5).",dotColor:"Chybn barva bodu.",lineSize:"Velikost linie nespluje velikostn omezen (1-50).",lineColor:"Chybn barva ry",areaLineSize:"Velikost hranice plochy nespluje velikostn omezen (0-50).",areaLineColor:"Chybn barva hranice plochy.",areaFillColor:"Chybn barva vpln."}}}),define("bundles/framework/bundle/myplaces2/locale/cs",function(){}),Oskari.registerLocalization({lang:"de",key:"MyPlaces2",value:{title:"Orte",desc:"",category:{defaultName:"Meine Kartenebene",organization:"Meine Orte",inspire:"Meine orte"},guest:{loginShort:"Melden Sie sich an, um den Dienst zu nutzen"},tab:{title:"Orte",nocategories:"Sie haben die Orte bisher nicht gespeichert.",publishCategory:{privateTooltip:"Die Kartenebene ist nicht ffentlich.| Klicken Sie auf die Kartenebene, um sie ffentlich zu machen.",publicTooltip:"Die Kartenebene ist ffentlich| Klicken Sie auf die Kartenebene, um sie nicht ffentlich zu machen."},editCategory:"Kartenebene bearbeiten",deleteCategory:"Kartenebene lschen",edit:"Bearbeiten","delete":"Lschen",grid:{name:"Name",desc:"Beschreibung",createDate:"Erstellt",updateDate:"Aktualisiert",edit:" ","delete":" "},notification:{"delete":{title:"Ort lschen",confirm:"Mchten Sie diesen Ort lschen?",btnDelete:"Abbrechen",btnCancel:"Cancel",success:"Der Ort wurde gelscht.",error:"Dieser Ort konnte nicht gelscht werden. Bitte versuchen Sie es spter noch einmal.",cancel:"Der Ort wurde nicht gelscht."}}},tools:{point:{tooltip:"Punkt hinzufgen","new":"Punkt durch Klicken auf die Karte hinzufgen.",next:"Speichern oder weitere Punkte hinzufgen.",edit:"Bewegen Sie den Punkt durch Anklicken und Ziehen.",save:"Punkt speichern"},line:{tooltip:"Linie hinzufgen","new":'Fgen Sie eine Linie ein, indem Sie auf die Karte klicken, um Sttzpunkte hinzuzufgen. Sie beenden das Zeichnen durch einen Doppelklick oder durch einen Klick auf "Zeichnen beenden".',next:"Speichern oder weitere Linien hinzufgen.",edit:"Bearbeiten Sie die Linie, indem Sie die Sttzpunkte anklicken und verschieben.",save:"Linie speichern"},area:{tooltip:"Flche hinzufgen","new":'Fgen Sie eine Flche ein, indem Sie auf die Karte klicken, um Sttzpunkte hinzuzufgen. Sie beenden das Zeichnen durch einen Doppelklick oder durch einen Klick auf "Zeichnen beenden". Um Lcher in Flchen zu erzeugen, halten Sie die ALT-Taste gedrckt.',next:"Speichern oder weitere Flchen hinzufgen.",edit:"Bearbeiten Sie die Flche, indem Sie die Sttzpunkte anklicken und verschieben.",save:"Flche speichern"}},buttons:{ok:"OK",cancel:"Abbrechen",finish:"Zeichnen beenden",save:"Speichern",movePlaces:"Orte verschieben und lschen",deleteCategory:"Lschen",deleteCategoryAndPlaces:"Kategorien und Orte lschen",changeToPublic:"ffentlich machen",changeToPrivate:"Nicht ffentlich machen"},placeform:{title:"Ortsdaten",tooltip:'Ein Ort, der auf der Karte positioniert wurde, wird unter "Meine Orte" gespeichert. Geben Sie dem Ort einen Namen und beschreiben Sie ihn. Sie knnen die Kartenebene auswhlen auf der der Ort gespeichert wird oder eine neue Ebene unter "Neue Ebene", im Drop-Down Men der Kartenebenen, auswhlen.',placename:{placeholder:"Geben Sie dem Ort einen Namen"},placelink:{placeholder:"Fgen Sie eine URL hinzu"},placedesc:{placeholder:"Beschreiben Sie den Ort"},category:{label:"Kartenebene","new":"Neue Ebene..."}},categoryform:{name:{label:"Name",placeholder:"Geben Sie der Kartenebene einen Namen"},drawing:{label:"Darstellung",point:{label:"Punkt",color:"Farbe",size:"Gre"},line:{label:"Linie",color:"Farbe",size:"Linienstrke"},area:{label:"Flche",fillcolor:"Fllfarbe",linecolor:"Linienfarbe",size:"Linienstrke"}},edit:{title:"Kartenebene bearbeiten",save:"Speichern",cancel:"Zurck"}},notification:{placeAdded:{title:"Der Ort wurde gespeichert",message:'Der Ort kann unter "Meine Daten" gefunden werden'},categorySaved:{title:"Kartenebene gespeichert",message:"nderung in der Kartenebene gespeichert"},categoryDelete:{title:"Kartenebene lschen",deleteConfirmMove:"Kartenebene {0} beinhaltet {1} Objekt/e. Mchten Sie die Kartenebene lschen und die Orte zur Standardkartenebene {2} verschieben?",deleteConfirm:"Karteneben {0} lschen?",deleted:"Kartenebene gelscht"},categoryToPublic:{title:"Kartenebene ffentlich machen",message:"Sie machen die Kartenebene {0} ffentlich. Sie knnen Links zu einer ffentlichen Kartenebene mit anderen Internetnutzern teilen oder die Kartenebene in ein Kartenfenster auf einer anderen Webseite einbinden. Andere Nutzer knnen ebenfalls die Kartenebene betrachten."},categoryToPrivate:{title:"Kartenebene nicht verffentlichen",message:"Sie machen die Kartenebene {0} nicht ffentlich. Damit ist es nicht mehr mglich, sie mit anderen Nutzern zu teilen oder auf anderen Webseiten einzubinden. Andere Nutzer knnen die Kartenebene nicht lnger betrachten."},error:{addCategory:"Die Kartenebene konnte nicht gespeichert werden. Der Ort wurde nicht gespeichert.",editCategory:"Die Kartenebene konnte nicht gespeichert werden..",savePlace:"Der Ort konnte nicht gespeichert werden.",title:"Fehler!",generic:"Systemfehler! Bitte versuchen Sie es spter noch einmal.",deleteCategory:"Fehler beim Lschen!",deleteDefault:"Die Standardkartenebene kann nicht gelscht werden."}},validation:{title:"Daten sind fehlerhaft:",placeName:"Ortsname fehlt.",categoryName:"Name der Kartenebene fehlt.",placeNameIllegal:"Der Ortsname enthlt unzulssige Zeichen. Erlaubte Zeichen sind die Buchstaben a-z, , ,  sowie Zahlen, Bindestriche und die Backspace-Taste.",descIllegal:"Die Beschreibung enthlt unzulssige Zeichen. Erlaubte Zeichen sind die Buchstaben a-z, , ,  sowie Zahlen, Bindestriche und die Backspace-Taste.",categoryNameIllegal:"Die Ebenenbeschreibung enthlt unzulssige Zeichen. Erlaubte Zeichen sind die Buchstaben a-z, , ,  sowie Zahlen, Bindestriche und die Backspace-Taste.",dotSize:"Die Punktgre liegt auerhalb der Grenbeschrnkung (1-5).",dotColor:"Falsche Punktfarbe.",lineSize:"Die Linienstrke liegt auerhalb der Grenbeschrnkung (1-50).",lineColor:"Falsche Linienfarbe.",areaLineSize:"Die Linienstrke liegt auerhalb der Grenbeschrnkungen (0-50).",areaLineColor:"Falsche Farbe der Flchenrnder.",areaFillColor:"Falsche Fllfarbe."}}}),define("bundles/framework/bundle/myplaces2/locale/de",function(){}),Oskari.registerLocalization({lang:"es",key:"MyPlaces2",value:{title:"Sitios",desc:"",category:{defaultName:"Mi capa",organization:"Mis sitios",inspire:"Mis sitios"},guest:{loginShort:"Identificarse para usar"},tab:{title:"Sitios",nocategories:"Todava no ha guardado los sitios.",publishCategory:{privateTooltip:"La capa es privada. Pulse en la capa para publicarla.",publicTooltip:"La capa es pblica. Pulse en la capa para despublicarla."},editCategory:"Editar capa",deleteCategory:"Borrar capa",edit:"Editar","delete":"Borrar",grid:{name:"Nombre",desc:"Descripcin",createDate:"Creada",updateDate:"Actualizada",edit:" ","delete":" "},notification:{"delete":{title:"Borrar sitio",confirm:"Desea borrar este sitio?",btnDelete:"Borrar",btnCancel:"Cancelar",success:"Se ha borrado el sitio.",error:"El sitio no puede borrarse. Por favor, intntelo ms tarde.",cancel:"No se ha borrado el objeto."}}},tools:{point:{tooltip:"Aadir punto","new":"Aadir punto mediante un click en el mapa.",next:"Puedes guardar o dibujar ms puntos en el mismo dibujo.",edit:"Mover el punto pulsando y arrastrando.",save:"Guardar localizacin"},line:{tooltip:"Aadir lnea","new":'Aadir un hito sobre la lnea haciendo click en el mapa. Parar la edicin mediante doble click o pulsando "Fin de edicin"',next:"Puedes guardar o dibujar ms lneas en el mismo dibujo.",edit:"Editar la lnea pulsando y arrastrando sus hitos.",save:"Guardar forma"},area:{tooltip:"Aadir rea","new":'Aadir hitos al rea de tu polgono haciendo click en el mapa. Parar la edicin mediante doble click o pulsando "Fin de edicin". Para crear agujeros en los polgonos, mantn pulsada la tecla Alt.',next:"Puede guardar o dibujar ms polgonos en el mismo dibujo.",edit:"Editar la forma del rea pulsando y arrastrando los hitos de su contorno.",save:"Guardar forma"}},buttons:{ok:"Hecho",cancel:"Cancelar",finish:"Fin de edicin",save:"Guardar",movePlaces:"Mover sitios y borrar",deleteCategory:"Borrar",deleteCategoryAndPlaces:"Borrar categoras y sitios",changeToPublic:"Publicar",changeToPrivate:"Despublicar"},placeform:{title:"Datos del sitio",tooltip:'Se guardar el sitio indicado en el mapa, en Mis sitios . Asigne un nombre al sitio y descrbalo. Puede seleccionar la capa donde se almacenar el sitio o elegir una nueva capa seleccionando "Nueva capa" en el men desplegable de la capa.',placename:{placeholder:"Asigne un nombre al sitio"},placelink:{placeholder:"Asigne una URL"},placedesc:{placeholder:"Describa el sitio"},category:{label:"Capa","new":"Nueva capa..."}},categoryform:{name:{label:"Nombre",placeholder:"Asigne un nombre a la capa"},drawing:{label:"Estilo",point:{label:"Punto",color:"Color",size:"Tamao"},line:{label:"Lnea",color:"Color",size:"Grosor"},area:{label:"Area",fillcolor:"Color de relleno",linecolor:"Color de lnea",size:"Grosor de lnea"}},edit:{title:"Editar capa",save:"Guardar",cancel:"Atrs"}},notification:{placeAdded:{title:"El sitio se ha guardado",message:"Puede encontrarse el sitio en el men Mis datos"},categorySaved:{title:"Capa guardada",message:"Guardados los cambios en la capa"},categoryDelete:{title:"Borrar capa",deleteConfirmMove:"La capa {0} contiene {1} objetos. Desea borrar la capa y mover sus sitios a la capa por defecto {2}?",deleteConfirm:"Borrar la capa {0}?",deleted:"Capa borrada"},categoryToPublic:{title:"Despublicar capa",message:"Est publicando la capa {0}. Puede compartir enlaces a la capa pblica con otros usuarios de Internet o incorporar la capa como un visualizador en otro portal web. Otros usuarios tambin podrn ver la capa."},categoryToPrivate:{title:"Make map layer private",message:"Est despublicando la capa {0}. A partir de ahora no ser posible compartirla con otros usuarios o incorporarla en otro portal web. Otros usuarios ya no vern la capa."},error:{addCategory:"La capa no pudo guardarse. El sitio no se ha guardado.",editCategory:"La capa no pudo guardarse.",savePlace:"El sitio no pudo guardarse.",title:"Error!",generic:"Error del sistema. Por favor, intntalo ms tarde.",deleteCategory:"Se produjo un error durante el borrado!",deleteDefault:"No puede borrarse el mapa por defecto."}},validation:{title:"Los datos contienen errores:",placeName:"No se ha rellenado el nombre del sitio.",categoryName:"No se ha rellenado el nombre de la capa.",placeNameIllegal:"El nombre del objeto contiene caracteres no permitidos. Los caracteres permitidos son las letras entre a-z, nmeros, espacios y guiones.",descIllegal:"La descripcin del objeto contiene caracteres no permitidos. Los caracteres permitidos son las letras entre a-z, nmeros, espacios y guiones.",categoryNameIllegal:"La descripcin de la capa contiene caracteres no permitidos. Los caracteres permitidos son las letras entre a-z, nmeros, espacios y guiones.",dotSize:"El tamao del punto no est dentro de los lmites de tamao (1-5).",dotColor:"Color de punto incorrecto",lineSize:"El tamao de la lnea no est dentro de los lmites de tamao (1-50).",lineColor:"Color de lnea incorrecto",areaLineSize:"El tamao del contorno del rea no est dentro de los lmites de tamao (1-50).",areaLineColor:"Color de la lnea del contorno de rea incorrecto",areaFillColor:"Color de relleno incorrecto"}}}),define("bundles/framework/bundle/myplaces2/locale/es",function(){}),define("src/framework/myplaces2/module",["oskari","jquery","bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/event/FinishedDrawingEvent","bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/event/AddedFeatureEvent","bundles/framework/bundle/myplaces2/event/MyPlaceHoverEvent","bundles/framework/bundle/myplaces2/event/MyPlacesChangedEvent","bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/event/SelectedDrawingEvent","bundles/framework/bundle/myplaces2/model/MyPlace","bundles/framework/bundle/myplaces2/model/MyPlacesCategory","bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/DrawPlugin","bundles/framework/bundle/myplaces2/plugin/HoverPlugin","bundles/framework/bundle/myplaces2/MyPlacesTab","bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StopDrawingRequest","bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StartDrawingRequest","bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/GetGeometryRequest","bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/GetGeometryRequestHandler","bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StartDrawingRequestHandler","bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StopDrawingRequestHandler","bundles/framework/bundle/myplaces2/request/EditPlaceRequest","bundles/framework/bundle/myplaces2/request/EditCategoryRequest","bundles/framework/bundle/myplaces2/request/DeleteCategoryRequest","bundles/framework/bundle/myplaces2/request/PublishCategoryRequest","bundles/framework/bundle/myplaces2/request/EditRequestHandler","bundles/framework/bundle/myplaces2/service/MyPlacesService","bundles/framework/bundle/myplaces2/service/MyPlacesWFSTStore","bundles/framework/bundle/myplaces2/view/MainView","bundles/framework/bundle/myplaces2/view/PlaceForm","bundles/framework/bundle/myplaces2/view/PointForm","bundles/framework/bundle/myplaces2/view/LineForm","bundles/framework/bundle/myplaces2/view/AreaForm","bundles/framework/bundle/myplaces2/view/CategoryForm","bundles/framework/bundle/myplaces2/ButtonHandler","bundles/framework/bundle/myplaces2/CategoryHandler","bundles/framework/bundle/myplaces2/instance","libraries/jscolor/jscolor","libraries/jquery/plugins/jquery.svg.package-1.4.5/jquery.svg","css!resources/framework/bundle/myplaces2/css/myplaces.css","bundles/framework/bundle/myplaces2/locale/fi","bundles/framework/bundle/myplaces2/locale/sv","bundles/framework/bundle/myplaces2/locale/en","bundles/framework/bundle/myplaces2/locale/cs","bundles/framework/bundle/myplaces2/locale/de","bundles/framework/bundle/myplaces2/locale/es"],function(e,t){return e.bundleCls("myplaces2").category({create:function(){return e.clazz.create("Oskari.mapframework.bundle.myplaces2.MyPlacesBundleInstance")},update:function(e,t,n,r){e.alert("RECEIVED update notification "+r)}})}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.setBuffer('div.myplacesform div.help {\r\n  float: right; }\r\n\r\n/* Wide fields for place inputs  */\r\ndiv.myplacesform div.field, div.myplacescategoryform div.field {\r\n  padding-bottom: 10px; }\r\n\r\ndiv.myplacesform input[type="text"] {\r\n  width: 83%; }\r\n\r\ndiv.myplacesform input[type="checkbox"], div.myplacescategoryform input[type="checkbox"] {\r\n  margin: 0.5em; }\r\n\r\ndiv.myplacesform textarea {\r\n  width: 80%; }\r\n\r\ndiv.myplacesform select {\r\n  width: 80%; }\r\n\r\ndiv.myplacesform .imagePreview {\r\n  cursor: pointer; }\r\n\r\ndiv.myplacesform div.renderButton, div.myplacescategoryform div.renderButton {\r\n  margin: 5px; }\r\n\r\ndiv.simpleColorChooser {\r\n  background-color: #ffffff; }\r\n\r\n/* Smaller fields for category inputs in table */\r\ndiv.myplacescategoryform table input {\r\n  width: 50px; }\r\n\r\ndiv.myplacescategoryform input.oskaricolor {\r\n  height: 20px;\r\n  width: 50px;\r\n  border: 1px solid;\r\n  padding: 3px;\r\n  border-radius: 5px;\r\n  font-size: 0; }\r\n\r\ndiv.myplaces2 div.buttons div.button {\r\n  margin: 10px;\r\n  padding: 10px;\r\n  border: 1px solid;\r\n  border-radius: 5px;\r\n  box-shadow: 5px 5px 5px #888; }\r\n\r\n.divmanazerpopup.myplaces2 {\r\n  max-width: 260px; }\r\n\r\ndiv.simpleColorChooser {\r\n  background-color: #ffffff;\r\n  z-index: 10; }\r\n\r\ndiv.imagePreview img {\r\n  max-height: 350px;\r\n  max-width: 350px; }\r\n')}),requirejs.s.contexts._.nextTick=requirejs.nextTick;