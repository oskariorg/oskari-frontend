/*!
 * jQuery imagesLoaded plugin v2.1.1
 * http://github.com/desandro/imagesloaded
 *
 * MIT License. by Paul Irish et al.
 */

/*,{
                        "id" : "pageLegend",
                        "label" : "Näytä karttaselitteet",
                        "tooltip" : "Voit halutessasi lisätä tulosteeseen karttaselitteet",
                        "checked" : "checked"
                    },{
                        "id" : "pageCopyleft",
                        "label" : "Näytä copyright tieto",
                        "tooltip" : "Voit halutessasi lisätä tulosteeseen copyright tiedon",
                        "checked" : "checked"
                    }*/

/*, {
                    "id" : "pageLegend",
                    "label" : "Lägg till Förklaringar",
                    "tooltip" : "Det är möjligt att lägga till förklaringar till utskriften",
                        "checked" : "checked"
                }, {
                    "id" : "pageCopyleft",
                    "label" : "Lägg till copyright information",
                    "tooltip" : "Det är möjligt att lägga till copyright till utskriften",
                        "checked" : "checked"
                }*/

/*, {
                    "id" : "pageLegend",
                    "label" : "Add legend",
                    "tooltip" : "You can add legend to the printout",
                        "checked" : "checked"
                }, {
                    "id" : "pageCopyleft",
                    "label" : "Add copyright information",
                    "tooltip" : "You can add copyright to the printout",
                        "checked" : "checked"
                }*/

(function(e,t){var n="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";e.fn.imagesLoaded=function(r){function c(){var t=e(f),n=e(l);s&&(l.length?s.reject(u,t,n):s.resolve(u)),e.isFunction(r)&&r.call(i,u,t,n)}function h(e){p(e.target,e.type==="error")}function p(t,r){if(t.src===n||e.inArray(t,a)!==-1)return;a.push(t),r?l.push(t):f.push(t),e.data(t,"imagesLoaded",{isBroken:r,src:t.src}),o&&s.notifyWith(e(t),[r,u,e(f),e(l)]),u.length===a.length&&(setTimeout(c),u.unbind(".imagesLoaded",h))}var i=this,s=e.isFunction(e.Deferred)?e.Deferred():0,o=e.isFunction(s.notify),u=i.find("img").add(i.filter("img")),a=[],f=[],l=[];return e.isPlainObject(r)&&e.each(r,function(e,t){e==="callback"?r=t:s&&s[e](t)}),u.length?u.bind("load.imagesLoaded error.imagesLoaded",h).each(function(r,i){var s=i.src,o=e.data(i,"imagesLoaded");if(o&&o.src===s){p(i,o.isBroken);return}if(i.complete&&i.naturalWidth!==t){p(i,i.naturalWidth===0||i.naturalHeight===0);return}if(i.readyState||i.complete)i.src=n,i.src=s}):c(),s?s.promise(i):i}})(jQuery),define("bundles/framework/bundle/printout/jquery.imagesLoaded",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.printout.PrintoutBundleInstance",function(){this.sandbox=undefined,this.started=!1,this.plugins={},this.localization=undefined,this.printout=undefined,this.buttonGroup="viewtools",this.ignoreEvents=!1,this.dialog=undefined,this.printoutHandler=undefined,this.isMapStateChanged=!0,this.state=undefined,this.geoJson=undefined,this.tileData=undefined,this.printService=undefined,this.legendPlugin=undefined,this.conf={backendConfiguration:{formatProducers:{"application/pdf":"http://wps.paikkatietoikkuna.fi/dataset/map/process/imaging/service/thumbnail/maplink.pdf?","image/png":"http://wps.paikkatietoikkuna.fi/dataset/map/process/imaging/service/thumbnail/maplink.png?"}}}},{__name:"Printout",getName:function(){return this.__name},getSandbox:function(){return this.sandbox},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},start:function(){var e=this;if(e.started)return;e.started=!0;var t=this.conf,n=(t?t.sandbox:null)||"sandbox",r=Oskari.getSandbox(n);e.sandbox=r,this.localization=Oskari.getLocalization(this.getName()),r.register(e);for(p in e.eventHandlers)r.registerForEventByName(e,p);this.printoutHandler=Oskari.clazz.create("Oskari.mapframework.bundle.printout.request.PrintMapRequestHandler",r,function(){e.instance.sandbox.postRequestByName("userinterface.UpdateExtensionRequest",[e.instance,"attach"])}),r.addRequestHandler("printout.PrintMapRequest",this.printoutHandler);var i=r.getRequestBuilder("Toolbar.AddToolButtonRequest"),s={print:{iconCls:"tool-print",tooltip:this.localization.btnTooltip,sticky:!0,callback:function(){e.sandbox.postRequestByName("userinterface.UpdateExtensionRequest",[e,"attach"])}}};for(var o in s)r.request(this,i(o,this.buttonGroup,s[o]));var u=Oskari.clazz.create("Oskari.mapframework.bundle.printout.service.PrintService",e);r.registerService(u),this.printService=u;var a=e.getLocalization(),f=r.findRegisteredModuleInstance("MainMapModule"),l=this.conf.legend,c=Oskari.clazz.create("Oskari.mapframework.bundle.printout.plugin.LegendPlugin",e,l,a);f.registerPlugin(c),f.startPlugin(c),this.legendPlugin=c;var h=r.getRequestBuilder("userinterface.AddExtensionRequest")(this);r.request(this,h),e._createUi(),r.registerAsStateful(this.mediator.bundleId,this),this.tileData={}},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(!t)return;return t.apply(this,[e])},eventHandlers:{MapLayerVisibilityChangedEvent:function(e){this.printout&&this.printout.isEnabled&&this.isMapStateChanged&&(this.isMapStateChanged=!1,this.getSandbox().printDebug("PRINTOUT REFRESH"),this.printout.refresh(!0))},AfterMapMoveEvent:function(e){this.isMapStateChanged=!0,this.printout&&this.printout.isEnabled&&this.printout.refresh(!1),this.isMapStateChanged=!0},AfterMapLayerAddEvent:function(e){this.isMapStateChanged=!0,this.printout&&this.printout.isEnabled&&this.printout.refresh(!1)},AfterMapLayerRemoveEvent:function(e){this.isMapStateChanged=!0,this.printout&&this.printout.isEnabled&&this.printout.refresh(!1)},AfterChangeMapLayerStyleEvent:function(e){this.isMapStateChanged=!0,this.printout&&this.printout.isEnabled&&this.printout.refresh(!1)},"userinterface.ExtensionUpdatedEvent":function(e){var t=this;if(e.getExtension().getName()!=t.getName())return;var n=e.getViewState()!="close";t.displayContent(n)},"Printout.PrintableContentEvent":function(e){var t=e.getContentId(),n=e.getLayer(),r=n&&n.getId?n.getId():null,i=e.getTileData(),s=e.getGeoJsonData();s&&(this.geoJson=s),i&&r&&(this.tileData[r]=i)}},stop:function(){this.printout&&(this.printout.destroy(),this.printout=undefined),this.geoJson=null,this.tileData=null;var e=this.sandbox();for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.removeRequestHandler("printout.PrintMapRequest",this.printoutHandler),this.printoutHandler=null;var t=e.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);e.request(this,t),this.sandbox.unregisterStateful(this.mediator.bundleId),this.sandbox.unregister(this),this.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.printout.Flyout",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},_createUi:function(){var e=this;this.plugins["Oskari.userinterface.Flyout"].createUi()},setPublishMode:function(e){var t=this,n=jQuery("#contentMap"),r=jQuery("#maptools");if(e==1){var i=t.sandbox.getRequestBuilder("userinterface.UpdateExtensionRequest")(t,"close",t.getName());t.sandbox.request(t.getName(),i),this.printout||(this.printout=Oskari.clazz.create("Oskari.mapframework.bundle.printout.view.BasicPrintout",this,this.getLocalization("BasicView"),this.conf.backendConfiguration),this.printout.render(n)),this.state&&this.state.form&&this.printout.setState(this.state.form),this.printout.show(),this.printout.setEnabled(!0),this.printout.refresh(!1),this.printout.refresh(!0)}else this.printout&&(this.printout.setEnabled(!1),this.printout.hide(),this.printout&&this.legendPlugin.clearLegendLayers())},displayContent:function(e){e&&this.plugins["Oskari.userinterface.Flyout"].refresh()},setState:function(e){this.state=e},getState:function(){var e=this.state||{};if(this.printout){var t=this.printout.getState();e.form=t}return e}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension","Oskari.userinterface.Stateful"]}),define("bundles/framework/bundle/printout/instance",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.printout.Flyout",function(e){this.instance=e,this.container=null,this.state=null,this.template=null,this.view=null},{getName:function(){return"Oskari.mapframework.bundle.printout.Flyout"},setEl:function(e,t,n){this.container=e[0],jQuery(this.container).hasClass("printout")||jQuery(this.container).addClass("printout")},startPlugin:function(){this.template=jQuery("<div></div>")},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("flyouttitle")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){this.state=e},createUi:function(){var e=this,t=jQuery(this.container);this.view=Oskari.clazz.create("Oskari.mapframework.bundle.printout.view.StartView",this.instance,this.instance.getLocalization("StartView"))},refresh:function(){var e=jQuery(this.container);e.empty(),this.view.render(e)}},{protocol:["Oskari.userinterface.Flyout"]}),define("bundles/framework/bundle/printout/Flyout",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.printout.Tile",function(e){this.instance=e,this.container=null,this.template=null},{getName:function(){return"Oskari.mapframework.bundle.printout.Tile"},setEl:function(e,t,n){this.container=jQuery(e)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){},refresh:function(){}},{protocol:["Oskari.userinterface.Tile"]}),define("bundles/framework/bundle/printout/Tile",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.printout.plugin.LegendPlugin",function(e,t,n){this.instance=e,this.sandbox=e.sandbox,this.mapModule=null,this.pluginName=null,this.conf=t,this.conf||(this.conf={}),this.locale=n,this.headerLayer=null,this.printAreaLayer=null,this.boxesLayer=null,this._map=null},{__name:"LegendPlugin",__qname:"Oskari.mapframework.bundle.printout.plugin.LegendPlugin",getQName:function(){return this.__qname},getName:function(){return this.pluginName},getMap:function(){return this._map},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this)},stopPlugin:function(e){e.unregister(this)},start:function(e){},stop:function(e){},init:function(){var e=new OpenLayers.StyleMap({"default":this.conf.printAreaDefault});this.printAreaLayer=new OpenLayers.Layer.Vector("PrintArea",{styleMap:e});var t=new OpenLayers.StyleMap({"default":this.conf.legendBoxDefault});this.headerLayer=new OpenLayers.Layer.Vector("LegendHeader",{styleMap:t});var n=new OpenLayers.StyleMap({"default":this.conf.colorBoxDefault});this.boxesLayer=new OpenLayers.Layer.Vector("LegendBoxes",{styleMap:n})},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this._map=e.getMap(),this.pluginName=e.getName()+this.__name)},plotLegend:function(e,t,n,r){var i=this.getMapModule().getMap();i.getLayerIndex(this.printAreaLayer)==-1?(i.addLayer(this.printAreaLayer),i.setLayerIndex(this.printAreaLayer,10004)):i.raiseLayer(this.printAreaLayer,101),i.getLayerIndex(this.headerLayer)==-1?(i.addLayer(this.headerLayer),i.setLayerIndex(this.headerLayer,10005)):i.raiseLayer(this.headerLayer,102),i.getLayerIndex(this.boxesLayer==-1)?(i.addLayer(this.boxesLayer),i.setLayerIndex(this.boxesLayer,10006)):i.raiseLayer(this.boxesLayer,103),this.clearLegendLayers();var s=this._getLegendGeom(e,t,n,r);return this._plotLegendHeader(e,t,s),this._plotLegendBoxes(e,t,s),this._createPrintGeoJSON()},_maxLayerIndex:function(){var e=0,t=this.instance.getSandbox().findAllSelectedMapLayers();for(var n=0;n<t.length;n++)this.getMapModule().getMap().getLayerIndex(t[n])>e&&(e=this.getMapModule().getMap().getLayerIndex(t[n]));return e},_getLegendGeom:function(e,t,n,r){var i=n.features[0].properties,s=i.targetWidth,o=i.targetHeight,u=n.features[0].geometry.coordinates[0],a=Number(u[1][0])-Number(u[0][0]),f=Number(u[2][1])-Number(u[1][1]),l=[];if(e.length>this.conf.general.charsInrow){var c=e.split(" "),h="";for(var p=0;p<c.length;p++)h.length+c[p].length+1<this.conf.general.charsInrow?h=h+c[p]+" ":(l.push(h),h=c[p]);h.length>0&&l.push(h)}else l.push(e);var d=a;f>a&&(d=f);var v=this.conf.general.legendRowHeight*d*(t.length+l.length+1),m=this.conf.general.legendWidth*d,g=v/(t.length+l.length+1),y=[];r=="LL"?(y.push(new OpenLayers.Geometry.Point(u[0][0],u[0][1]+v)),y.push(new OpenLayers.Geometry.Point(u[0][0]+m,u[0][1]+v)),y.push(new OpenLayers.Geometry.Point(u[0][0]+m,u[0][1])),y.push(new OpenLayers.Geometry.Point(u[0][0],u[0][1]))):r=="LU"?(y.push(new OpenLayers.Geometry.Point(u[0][0],u[3][1])),y.push(new OpenLayers.Geometry.Point(u[0][0]+m,u[3][1])),y.push(new OpenLayers.Geometry.Point(u[0][0]+m,u[3][1]-v)),y.push(new OpenLayers.Geometry.Point(u[0][0],u[3][1]-v))):r=="RU"?(y.push(new OpenLayers.Geometry.Point(u[2][0]-m,u[2][1])),y.push(new OpenLayers.Geometry.Point(u[2][0],u[2][1])),y.push(new OpenLayers.Geometry.Point(u[2][0],u[2][1]-v)),y.push(new OpenLayers.Geometry.Point(u[2][0]-m,u[2][1]-v))):r=="RL"&&(y.push(new OpenLayers.Geometry.Point(u[1][0]-m,u[1][1]+v)),y.push(new OpenLayers.Geometry.Point(u[1][0],u[1][1]+v)),y.push(new OpenLayers.Geometry.Point(u[1][0],u[1][1])),y.push(new OpenLayers.Geometry.Point(u[1][0]-m,u[1][1])));var b=[],p=0;while(coordp=u[p++])b.push(new OpenLayers.Geometry.Point(coordp[0],coordp[1]));var w={print_area:b,bbox:y,rangebox_size:g,properties:i,titles:l};return w},clearLegendLayers:function(){this.headerLayer&&this.headerLayer.removeAllFeatures(),this.boxesLayer&&this.boxesLayer.removeAllFeatures(),this.printAreaLayer&&this.printAreaLayer.removeAllFeatures()},_plotLegendHeader:function(e,t,n){var r=this,i=n.bbox,s=i,o=new OpenLayers.Geometry.LinearRing(s),u=new OpenLayers.Geometry.Polygon([o]),a="\0",f={color:"#FFFFFF",name:a},l=new OpenLayers.Geometry.LineString(n.print_area),c=new OpenLayers.Feature.Vector(l,null);r.printAreaLayer.addFeatures([c]),r.printAreaLayer.redraw();var h=new OpenLayers.Feature.Vector(u,f);r.headerLayer.addFeatures([h]);var p=n.titles;for(var d=0;d<p.length;d++){var v=i[0].clone(),m=new OpenLayers.Geometry.Point(v.x+.2*n.rangebox_size,v.y-(d*n.rangebox_size+n.rangebox_size/2)),g={name:p[d]},y=new OpenLayers.Feature.Vector(m,g);r.headerLayer.addFeatures([y])}r.headerLayer.redraw()},_plotLegendBoxes:function(e,t,n){var r=this,i="\0",s=n.bbox,o=n.titles,u=n.rangebox_size,a=.8*n.rangebox_size,f=s[0].clone(),l=f.x+.2*u,c=f.y-u*o.length;for(var h=0;h<t.length;h++){var p=t[h],d="#FFFFFF";p.boxcolor.split(":").length>1&&(d=p.boxcolor.split(":")[1]);var v=l,m=c,g=[new OpenLayers.Geometry.Point(v,m),new OpenLayers.Geometry.Point(v+a,m),new OpenLayers.Geometry.Point(v+a,m-a),new OpenLayers.Geometry.Point(v,m-a)],y=new OpenLayers.Geometry.LinearRing(g),b=new OpenLayers.Geometry.Polygon([y]),w={color:d,name:i},E=new OpenLayers.Feature.Vector(b,w);r.boxesLayer.addFeatures([E]);var f=new OpenLayers.Geometry.Point(v+u,m-a),S={name:p.range},x=new OpenLayers.Feature.Vector(f,S);r.boxesLayer.addFeatures([x]),c-=u}r.boxesLayer.redraw()},_createPrintGeoJSON:function(){var e=new OpenLayers.Format.GeoJSON,t=[],n=JSON.parse(e.write(this.headerLayer.features)),r={type:"geojson",name:this.headerLayer.name,id:this.headerLayer.name,data:{type:"FeatureCollection",features:n.features},styles:[]};r.styles.push(this._getDefaultStyle(this.headerLayer.styleMap)),t.push(r);var i=JSON.parse(e.write(this.boxesLayer.features)),r={type:"geojson",name:this.boxesLayer.name,id:this.boxesLayer.name,data:{type:"FeatureCollection",features:i.features},styles:[]};return r.styles.push(this._getDefaultStyle(this.boxesLayer.styleMap)),t.push(r),t},_getDefaultStyle:function(e){var t=e.styles["default"].defaultStyle,n=e.styles["default"].id,r={title:"Standard",name:n,styleMap:{"default":{}}};return r.styleMap["default"]=this._cleanStyle(t,["labelXOffset","labelYOffset"]),r},_cleanStyle:function(e,t){var n=jQuery.extend(!0,{},e);for(var r=0;r<t.length;r++){var i=t[r];n[i]&&n[i].toString().indexOf("${delta")>-1&&delete n[i]}return n},protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),define("bundles/framework/bundle/printout/plugin/LegendPlugin",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.printout.service.PrintService",function(e){this.instance=e,this.sandbox=e.sandbox},{__name:"Printout.PrintService",__qname:"Oskari.mapframework.bundle.printout.service.PrintService",getQName:function(){return this.__qname},getName:function(){return this.__name},init:function(){},fetchPrintMapData:function(e,t,n){jQuery.ajax({type:"GET",dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},url:e,success:function(e){t&&t(e)},error:function(e,t){n&&e.status!=0&&n(e,t)}})}},{protocol:["Oskari.mapframework.service.Service"]}),define("bundles/framework/bundle/printout/service/PrintService",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.printout.view.StartView",function(e,t){this.instance=e,this.template=jQuery("<div class='startview'><div class='content'></div><div class='buttons'></div></div>"),this.templateError=jQuery('<div class="error"><ul></ul></div>'),this.templateInfo=jQuery("<div class='icon-info'></div>"),this.loc=t,this.content=undefined,this.buttons={},this.alert=Oskari.clazz.create("Oskari.userinterface.component.Alert")},{_isTooManyLayers:function(){var e=this.instance.getSandbox().findAllSelectedMapLayers().length,t=e>7;return t},_isManyLayers:function(){var e=this.instance.getSandbox().findAllSelectedMapLayers().length,t=e>2;return t},render:function(e){var t=this,n=this.template.clone();this.content=n,e.append(n),this.alert.insertTo(e);var r=this._isTooManyLayers(),i=this._isManyLayers();r?this.alert.setContent(this.loc.info.maxLayers,"error"):i?this.alert.setContent(this.loc.info.printoutProcessingTime,"info"):this.alert.setContent(this.loc.text,"default");if(!r){var s=Oskari.clazz.create("Oskari.userinterface.component.Button");s.addClass("primary"),s.setTitle(this.loc.buttons["continue"]),s.setHandler(function(){t.instance.setPublishMode(!0)}),this.buttons["continue"]=s,s.insertTo(n.find("div.buttons"))}var o=Oskari.clazz.create("Oskari.userinterface.component.Button");r&&o.addClass("primary"),o.setTitle(this.loc.buttons.cancel),o.setHandler(function(){t.instance.sandbox.postRequestByName("userinterface.UpdateExtensionRequest",[t.instance,"close"])}),this.buttons.cancel=o,o.insertTo(n.find("div.buttons"))}}),define("bundles/framework/bundle/printout/view/StartView",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.printout.view.BasicPrintout",function(e,t,n){var r=this;this.isEnabled=!1,this.instance=e,this.loc=t,this.backendConfiguration=n,this.legendInProcess=!1,this.template={};for(p in this.__templates)this.template[p]=jQuery(this.__templates[p]);this.sizeOptions=this.loc.size.options,this.sizeOptionsMap={};for(var i=0;i<this.sizeOptions.length;i++)this.sizeOptionsMap[this.sizeOptions[i].id]=this.sizeOptions[i];this.formatOptions=this.loc.format.options,this.formatOptionsMap={};for(var s=0;s<this.formatOptions.length;s++)this.formatOptionsMap[this.formatOptions[s].id]=this.formatOptions[s];this.contentOptions=this.loc.content.options,this.contentOptionsMap={};for(var s=0;s<this.contentOptions.length;s++)this.contentOptionsMap[this.contentOptions[s].id]=this.contentOptions[s];this.legendOptions=this.loc.legend.options,this.legendOptionsMap={};for(var s=0;s<this.legendOptions.length;s++)this.legendOptionsMap[this.legendOptions[s].id]=this.legendOptions[s];this.accordion=null,this.mainPanel=null,this.progressSpinner=Oskari.clazz.create("Oskari.userinterface.component.ProgressSpinner"),this.alert=Oskari.clazz.create("Oskari.userinterface.component.Alert"),this.previewContent=null,this.previewImgDiv=null,this.contentOptionDivs={}},{__templates:{preview:'<div class="preview"><img /><span></span></div>',previewNotes:'<div class="previewNotes"><span></span></div>',location:'<div class="location"></div>',tool:'<div class="tool "><input type="checkbox"/><label></label></div>',buttons:'<div class="buttons"></div>',help:'<div class="help icon-info"></div>',main:'<div class="basic_printout"><div class="header"><div class="icon-close"></div><h3></h3></div><div class="content"></div><form method="post" target="map_popup_111" id="oskari_print_formID" style="display:none" action="" ><input name="geojson" type="hidden" value="" id="oskari_geojson"/><input name="tiles" type="hidden" value="" id="oskari_tiles"/></form></div>',format:'<div class="printout_format_cont printout_settings_cont"><div class="printout_format_label"></div></div>',formatOptionTool:'<div class="tool "><input type="radio" name="format" /><label></label></div>',legend:'<div class="printout_legend_cont printout_settings_cont"><div class="printout_legend_label"></div></div>',legendOptionTool:'<div class="tool "><input type="radio" name="legend" /><label></label></div>',title:'<div class="printout_title_cont printout_settings_cont"><div class="printout_title_label"></div><input class="printout_title_field" type="text"></div>',option:'<div class="printout_option_cont printout_settings_cont"><input type="checkbox" /><label></label></div>',sizeOptionTool:'<div class="tool "><input type="radio" name="size" /><label></label></div>'},render:function(e){var t=this,n=this.template.main.clone();this.mainPanel=n,n.find("div.header h3").append(this.loc.title),e.append(n);var r=n.find("div.content");this.alert.insertTo(r);var i=Oskari.clazz.create("Oskari.userinterface.component.Accordion");this.accordion=i;var s=this._createSizePanel();s.open(),i.addPanel(s);var o=this._createSettingsPanel();i.addPanel(o);var u=this._createPreviewPanel();u.open(),i.addPanel(u),i.insertTo(r),this._setLegendVisibility(),e.find("div.header div.icon-close").bind("click",function(){t.instance.setPublishMode(!1)}),r.append(this._getButtons());var a=this.mainPanel.find("input[type=text]");a.focus(function(){t.instance.sandbox.postRequestByName("DisableMapKeyboardMovementRequest")}),a.blur(function(){t.instance.sandbox.postRequestByName("EnableMapKeyboardMovementRequest")});var f=Oskari.clazz.create("Oskari.userinterface.component.UIHelper",this.instance.sandbox);f.processHelpLinks(this.loc.help,n,this.loc.error.title,this.loc.error.nohelp)},_createSizePanel:function(){var e=this,t=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel");t.setTitle(this.loc.size.label);var n=t.getContainer(),r=this.template.help.clone();r.attr("title",this.loc.size.tooltip),n.append(r);var i=function(t){return function(){var r=n.find("input[name=size]:checked").val();for(var i=0;i<e.sizeOptions.length;++i)e.sizeOptions[i].selected=!1;t.selected=!0,e._cleanMapPreview(),e._updateMapPreview(),e._createLegend()}};for(var s=0;s<this.sizeOptions.length;++s){var o=this.sizeOptions[s],u=this.template.sizeOptionTool.clone(),a=o.label;o.width&&o.height&&(a=a+" ("+o.width+" x "+o.height+"px)"),u.find("label").append(a).attr({"for":o.id,"class":"printout_radiolabel"}),o.selected&&u.find("input").attr("checked","checked"),n.append(u),u.find("input").attr({value:o.id,name:"size",id:o.id}),u.find("input").change(i(o))}return t},_createSettingsPanel:function(){var e=this,t=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel");t.setTitle(this.loc.settings.label);var n=t.getContainer(),r=this.template.help.clone();r.attr("title",this.loc.settings.tooltip),n.append(r);var i=function(t){return function(){var r=n.find("input[name=format]:checked").val();for(var i=0;i<e.formatOptions.length;++i)e.formatOptions[i].selected=!1;t.selected=!0}},s=this.template.format.clone();s.find(".printout_format_label").html(this.loc.format.label);for(var o=0;o<this.formatOptions.length;++o){var u=this.formatOptions[o],a=this.template.formatOptionTool.clone(),f=u.label;a.find("label").append(f).attr({"for":u.id,"class":"printout_radiolabel"}),u.selected&&a.find("input").attr("checked","checked"),s.append(a),a.find("input").attr({value:u.format,name:"format",id:u.id}),a.find("input").change(i(u))}n.append(s);var l=this.template.title.clone();l.find(".printout_title_label").html(this.loc.mapTitle.label),l.find(".printout_title_field").attr({value:"",placeholder:this.loc.mapTitle.label}),n.append(l);for(var c=0;c<this.contentOptions.length;c++){var h=this.contentOptions[c],p=this.template.option.clone();p.find("input").attr({id:h.id,checked:h.checked}),p.find("label").html(h.label).attr({"for":h.id,"class":"printout_checklabel"}),this.contentOptionDivs[h.id]=p,n.append(p)}var d=function(t){return function(){var r=n.find("input[name=legend]:checked").val();for(var i=0;i<e.legendOptions.length;++i)e.legendOptions[i].selected=!1;t.selected=!0}},v=this.template.legend.clone();v.find(".printout_legend_label").html(this.loc.legend.label);for(var o=0;o<this.legendOptions.length;++o){var u=this.legendOptions[o],a=this.template.legendOptionTool.clone(),f=u.label;a.find("label").append(f).attr({"for":u.id,"class":"printout_radiolabel"}),u.selected&&a.find("input").attr("checked","checked"),v.append(a),a.find("input").attr({value:u.loca,name:"location",id:u.id}),a.find("input").change(d(u)),a.find('input[name="location"]').click(function(){e._createLegend()})}return n.append(v),t},_createPreviewPanel:function(){var e=this,t=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel");t.setTitle(this.loc.preview.label);var n=t.getContainer(),r=this.template.help.clone();r.attr("title",this.loc.preview.tooltip),n.append(r);var i=this.template.preview.clone();n.append(i),e.progressSpinner.insertTo(i);var s=i.find("img");s.click(function(){e.showFullScaleMapPreview()});var o=i.find("span");this.previewContent=i,this.previewImgDiv=s,this.previewSpan=o;for(var u in this.loc.preview.notes){var a=this.template.previewNotes.clone();a.find("span").text(this.loc.preview.notes[u]),n.append(a)}return t},_createLocationAndScalePanel:function(){var e=this,t=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel");t.setTitle(this.loc.location.label);var n=t.getContainer(),r=this.template.help.clone();r.attr("title",this.loc.location.tooltip),n.append(r);var i=this.template.location.clone();return n.append(i),t},_cleanMapPreview:function(){var e=this.loc,t=this.previewImgDiv,n=this.previewSpan;t.hide(),n.text(e.preview.pending)},_updateMapPreview:function(){var e=this,t=this._gatherSelections("image/png");this.backendConfiguration={formatProducers:{"application/pdf":"http://wps.paikkatietoikkuna.fi/dataset/map/process/imaging/service/thumbnail/maplink.pdf?","image/png":"http://wps.paikkatietoikkuna.fi/dataset/map/process/imaging/service/thumbnail/maplink.png?"}};var n=this.backendConfiguration.formatProducers[t.format],r=t.maplinkArgs,i="&pageSize="+t.pageSize,s="&scaledWidth=200",o=n+r+i+s;this.previewContent.removeClass("preview-portrait"),this.previewContent.removeClass("preview-landscape"),this.previewContent.addClass(this.sizeOptionsMap[t.pageSize].classForPreview);var u=this.previewImgDiv,a=this.previewSpan;e.progressSpinner.start(),window.setTimeout(function(){u.imagesLoaded(function(){a.text(""),u.fadeIn("slow",function(){e.progressSpinner.stop()})}),u.attr("src",o)},100)},showFullScaleMapPreview:function(){var e=this._gatherSelections("image/png"),t=this.backendConfiguration.formatProducers[e.format],n=e.maplinkArgs,r="&pageSize="+e.pageSize,i=t+n+r;this.openURLinWindow(i,e)},_getButtons:function(){var e=this,t=this.template.buttons.clone(),n=Oskari.clazz.create("Oskari.userinterface.component.Button");n.setTitle(this.loc.buttons.cancel),n.setHandler(function(){e.instance.setPublishMode(!1)}),n.insertTo(t);var r=Oskari.clazz.create("Oskari.userinterface.component.Button");return r.setTitle(this.loc.buttons.save),r.addClass("primary"),r.setHandler(function(){var t=e.instance.sandbox.getMap(),n=typeof t.geojs=="undefined"?null:t.geojs,r=e._gatherSelections();r&&e._printMap(r,n)}),r.insertTo(t),t},_gatherSelections:function(e){var t=this.mainPanel,n=this.instance.getSandbox(),r=t.find("input[name=size]:checked").val(),i=e!=null?e:t.find("input[name=format]:checked").val(),s=t.find(".printout_title_field").val(),o=n.generateMapLinkParameters(),u={pageTitle:s,pageSize:r,maplinkArgs:o,format:i||"application/pdf"};for(var a in this.contentOptionsMap)u[a]=this.contentOptionDivs[a].find("input").prop("checked");return u},openURLinWindow:function(e,t){var n="location=1,status=1,scrollbars=1,width=850,height=1200";this._isLandscape(t)&&(n="location=1,status=1,scrollbars=1,width=1200,height=850");var r=e;window.open(r,"BasicPrintout",n)},openPostURLinWindow:function(e,t,n,r){var i=this,s="location=1,status=1,scrollbars=1,width=850,height=1200";this._isLandscape(r)&&(s="location=1,status=1,scrollbars=1,width=1200,height=850");var o=n;i.mainPanel.find("#oskari_print_formID").attr("action",o);if(e){var u=unescape(encodeURIComponent(e));i.mainPanel.find("input[name=geojson]").val(jQuery.base64.encode(u))}t&&i.mainPanel.find("input[name=tiles]").val(t),window.open("about:blank","map_popup_111",s),i.mainPanel.find("#oskari_print_formID").submit()},_printMap:function(e,t){var n=this,r=this.instance.getSandbox(),i=r.getAjaxUrl(),s=this.backendConfiguration.formatProducers[e.format],o=e.maplinkArgs,u="&pageSize="+e.pageSize,a="&pageTitle="+e.pageTitle,f=[];for(var l in this.contentOptionsMap)e[l]&&f.push("&"+l+"=true");var c=f.join(""),h="&format="+e.format,p=o+"&action_route=GetPreview"+u+a+c+h;i+=p;if(this.instance.geoJson||!jQuery.isEmptyObject(this.instance.tileData)){var d=this._stringifyGeoJson(this.instance.geoJson),v=this._stringifyTileData(this.instance.tileData);this.instance.getSandbox().printDebug("PRINT POST URL "+i),this.openPostURLinWindow(d,v,i,e)}else this.instance.getSandbox().printDebug("PRINT URL "+i),this.openURLinWindow(i,e)},_isLandscape:function(e){return this.sizeOptionsMap[e.pageSize].id.indexOf("Land")>-1?!0:!1},_stringifyGeoJson:function(e){return e?JSON.stringify(e).replace('"','"'):null},_stringifyTileData:function(e){if(!jQuery.isEmptyObject(e)){var t=[],n;for(var r in e)t.push(e[r]);return n=[].concat.apply([],t),JSON.stringify(n)}return null},_setLegendVisibility:function(){var e=this.mainPanel;this._hasStatsLayers()?e.find(".printout_legend_cont").show():e.find(".printout_legend_cont").hide()},_hasStatsLayers:function(){var e=this.instance.getSandbox().findAllSelectedMapLayers();for(var t=0;t<e.length;t++)if(e[t].isLayerOfType("STATS")&&e[t].isVisible())return!0;return!1},_createLegend:function(){var e=this;e._setLegendVisibility();if(!e._hasStatsLayers())return;var t=this.instance.sandbox.getMap(),n=this.mainPanel,r=jQuery("#contentMap"),i=n.find("input[name=location]:checked").val();if(i=="NO")e.instance.getSandbox().getMap().GeoJSON&&(e.instance.getSandbox().getMap().GeoJSON=null),e.instance.legendPlugin.clearLegendLayers();else{var s=r.find("div.geostats-legend");if(s.length>0){if(e.legendInProcess)return;e.legendInProcess=!0,this._printMapInfo(s,function(t){var n=s.find(".geostats-legend-title").html(),r=[];s.find("div").each(function(){var e=jQuery(this).attr("class");if(e==undefined){var t={boxcolor:jQuery(this).find(".geostats-legend-block").attr("style"),range:jQuery(this).text()};r.push(t)}});var o=e.instance.legendPlugin.plotLegend(n,r,t,i);e.instance.geoJson=o,e.legendInProcess=!1})}}},_printMapInfo:function(e,t){var n=this,r=n._gatherSelections(),i=this.instance.getSandbox(),s=i.getAjaxUrl(),o=this.backendConfiguration.formatProducers[r.format],u=r.maplinkArgs,a="&pageSize="+r.pageSize,f="&pageTitle="+r.pageTitle,l=[];for(var c in this.contentOptionsMap)r[c]&&l.push("&"+c+"=true");var h=l.join(""),p="&format="+r.format,d=u+"&action_route=GetProxyRequest&serviceId=print"+a+f+h+p;s+=d,n.instance.printService.fetchPrintMapData(s,function(e){e?t(e):alert("Error to fetch print info: ")},function(e,t){alert("Error to fetch print info: ")})},destroy:function(){this.mainPanel.remove()},hide:function(){this.mainPanel.hide()},show:function(){this.mainPanel.show()},setEnabled:function(e){this.isEnabled=e},getEnabled:function(){return this.isEnabled},refresh:function(e){e?this._updateMapPreview():this._cleanMapPreview(),this._createLegend()},getState:function(){return this._gatherSelections()},setState:function(e){}}),define("bundles/framework/bundle/printout/view/BasicPrintout",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.printout.request.PrintMapRequest",function(e){this._creator=null,this._selections=e},{__name:"printout.PrintMapRequest",getName:function(){return this.__name},getSelections:function(){return this._selections}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/printout/request/PrintMapRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.printout.request.PrintMapRequestHandler",function(e,t){this.sandbox=e,this.cb=t},{handleRequest:function(e,t){var n=t.getSelections();this.sandbox.printDebug("[Oskari.mapframework.bundle.printout.request.PrintMapRequestHandler] printout requested"),this.cb(n)}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/printout/request/PrintMapRequestHandler",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.printout.event.PrintableContentEvent",function(e,t,n,r){this._contentId=e,this._layer=t,this._tileData=n,this._geojsonData=r},{getName:function(){return"Printout.PrintableContentEvent"},getContentId:function(){return this._contentId},getLayer:function(){return this._layer},setLayer:function(e){this._layer=e},getTileData:function(){return this._tileData},setTileData:function(e){this._tileData=e},getGeoJsonData:function(){return this._geojsonData},setGeoJsonData:function(e){this._geojsonData=e}},{protocol:["Oskari.mapframework.event.Event"]}),define("bundles/framework/bundle/printout/event/PrintableContentEvent",function(){}),define("normalize",["require","module"],function(e,t){function o(e,t,n){if(e.indexOf("data:")===0)return e;e=r(e);if(e.match(/^\//)||e.match(s))return e;var i=n.match(s),o=t.match(s);return o&&(!i||i[1]!=o[1]||i[2]!=o[2])?u(e,t):a(u(e,t),n)}function u(e,t){e.substr(0,2)=="./"&&(e=e.substr(2));var n=t.split("/"),r=e.split("/");n.pop();while(curPart=r.shift())curPart==".."?n.pop():n.push(curPart);return n.join("/")}function a(e,t){var n=t.split("/");n.pop(),t=n.join("/")+"/",i=0;while(t.substr(i,1)==e.substr(i,1))i++;while(t.substr(i,1)!="/")i--;t=t.substr(i+1),e=e.substr(i+1),n=t.split("/");var r=e.split("/");out="";while(n.shift())out+="../";while(curPart=r.shift())out+=curPart+"/";return out.substr(0,out.length-1)}var n=/([^:])\/+/g,r=function(e){return e.replace(n,"$1/")},s=/[^\:\/]*:\/\/([^\/])*/,f=function(e,t,n,i){t=r(t),n=r(n);var s=/@import\s*("([^"]*)"|'([^']*)')|url\s*\(\s*(\s*"([^"]*)"|'([^']*)'|[^\)]*\s*)\s*\)/ig,u,a,e;while(u=s.exec(e)){a=u[3]||u[2]||u[5]||u[6]||u[4];var f;i&&a.substr(0,1)=="/"?f=i+a:f=o(a,t,n);var l=u[5]||u[6]?1:0;e=e.substr(0,s.lastIndex-a.length-l-1)+f+e.substr(s.lastIndex-l-1),s.lastIndex=s.lastIndex+(f.length-a.length)}return e};return f.convertURIBase=o,f}),define("css",["./normalize"],function(e){function t(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}if(typeof window=="undefined")return{load:function(e,t,n){n()}};var n=!1,r=document.getElementsByTagName("head")[0],i=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)/),s=!1;!i||(i[1]||i[7]?(s=parseInt(i[1])<6||parseInt(i[7])<=9,i="trident"):i[2]?(s=!0,i="webkit"):i[3]||(i[4]?(s=parseInt(i[4])<18,i="gecko"):n&&alert("Engine detection failed")));var o={},u=/^\/|([^\:\/]*:)/;o.pluginBuilder="./css-builder";var a=[],f={},l=[];o.addBuffer=function(e){if(t(a,e)!=-1)return;if(t(l,e)!=-1)return;a.push(e),l.push(e)},o.setBuffer=function(t,n){var r=window.location.pathname.split("/");r.pop(),r=r.join("/")+"/";var i=require.toUrl("base_url").split("/");i.pop();var s=i.join("/")+"/";s=e.convertURIBase(s,r,"/"),s.match(u)||(s="/"+s),s.substr(s.length-1,1)!="/"&&(s+="/"),o.inject(e(t,s,r));for(var l=0;l<a.length;l++)(n&&a[l].substr(a[l].length-5,5)==".less"||!n&&a[l].substr(a[l].length-4,4)==".css")&&(function(e){f[e]=f[e]||!0,setTimeout(function(){typeof f[e]=="function"&&f[e](),delete f[e]},7)}(a[l]),a.splice(l--,1))},o.attachBuffer=function(e,n){for(var r=0;r<a.length;r++)if(a[r]==e)return f[e]=n,!0;if(f[e]===!0)return f[e]=n,!0;if(t(l,e)!=-1)return n(),!0};var c=function(e,t){setTimeout(function(){for(var n=0;n<document.styleSheets.length;n++){var r=document.styleSheets[n];if(r.href==e.href)return t()}c(e,t)},10)},h=function(e,t){setTimeout(function(){try{return e.sheet.cssRules,t()}catch(n){}h(e,t)},10)};if(i=="trident"&&s)var p=[],d=[],v=0,m=function(e,t){var n;d.push({url:e,cb:t}),n=p.shift(),!n&&v++<31&&(n=document.createElement("style"),r.appendChild(n)),n&&g(n)},g=function(e){var t=d.shift();if(!t){e.onload=b,p.push(e);return}e.onload=function(){t.cb(t.ss),g(e)};var n=e.styleSheet;t.ss=n.imports[n.addImport(t.url)]};var y=function(e){var t=document.createElement("link");return t.type="text/css",t.rel="stylesheet",t.href=e,t},b=function(){};o.linkLoad=function(e,t){var o=setTimeout(function(){n&&alert("timeout"),t()},L*1e3-100),u=function(){clearTimeout(o),a&&(a.onload=b),setTimeout(t,7)};if(!s){var a=y(e);a.onload=u,r.appendChild(a)}else if(i=="webkit"){var a=y(e);c(a,u),r.appendChild(a)}else if(i=="gecko"){var f=document.createElement("style");f.textContent='@import "'+e+'"',h(f,u),r.appendChild(f)}else i=="trident"&&m(e,u)};var w=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],E={},S=function(e,t,n){if(E[e]){t(E[e]);return}var r,i,s;if(typeof XMLHttpRequest!="undefined")r=new XMLHttpRequest;else if(typeof ActiveXObject!="undefined")for(i=0;i<3;i+=1){s=w[i];try{r=new ActiveXObject(s)}catch(o){}if(r){w=[s];break}}r.open("GET",e,requirejs.inlineRequire?!1:!0),r.onreadystatechange=function(i){var s,o;r.readyState===4&&(s=r.status,s>399&&s<600?(o=new Error(e+" HTTP status: "+s),o.xhr=r,n(o)):(E[e]=r.responseText,t(r.responseText)))},r.send(null)},x=0,T;o.inject=function(e){x<31&&(T=document.createElement("style"),T.type="text/css",r.appendChild(T),x++),T.styleSheet?T.styleSheet.cssText+=e:T.appendChild(document.createTextNode(e))};var N=/@import\s*(url)?\s*(('([^']*)'|"([^"]*)")|\(('([^']*)'|"([^"]*)"|([^\)]*))\))\s*;?/g,C=window.location.pathname.split("/");C.pop(),C=C.join("/")+"/";var k=function(t,n,r){t.match(u)||(t="/"+e.convertURIBase(t,C,"/")),S(t,function(i){i=e(i,t,C);var s=[],o=[],u=[],a;while(a=N.exec(i)){var f=a[4]||a[5]||a[7]||a[8]||a[9];s.push(f),o.push(N.lastIndex-a[0].length),u.push(a[0].length)}var l=0;for(var c=0;c<s.length;c++)(function(e){k(s[e],function(t){i=i.substr(0,o[e])+t+i.substr(o[e]+u[e]);var r=t.length-u[e];for(var a=e+1;a<s.length;a++)o[a]+=r;l++,l==s.length&&n(i)},r)})(c);s.length==0&&n(i)},r)};o.normalize=function(e,t){return e.substr(e.length-4,4)==".css"&&(e=e.substr(0,e.length-4)),t(e)};var L,A=!1;return o.load=function(e,t,r,i,u){L=L||i.waitSeconds||7;var a=e+(u?".less":".css");if(o.attachBuffer(a,r))return;var f=t.toUrl(a);!A&&n&&(alert(s?"hacking links":"not hacking"),A=!0),u?k(f,function(e){u&&(e=u(e,function(e){o.inject(e),setTimeout(r,7)}))}):o.linkLoad(f,r)},n&&(o.inspect=function(){if(stylesheet.styleSheet)return stylesheet.styleSheet.cssText;if(stylesheet.innerHTML)return stylesheet.innerHTML}),o}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/printout/css/style.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.registerLocalization({lang:"fi",key:"Printout",value:{title:"Tulosta näkymä",flyouttitle:"Siirry tulostamaan",desc:"",btnTooltip:"Tulosta",BasicView:{title:"Tulosta näkymä",name:{label:"Kartan nimi",placeholder:"pakollinen",tooltip:"Anna näkymälle kuvaileva nimi. Huomioi käyttöliittymän kieli."},language:{label:"Kieli",options:{fi:"Suomi",sv:"Ruotsi",en:"Englanti"},tooltip:"Valitse kartan käyttöliittymän ja aineiston kieli."},size:{label:"Koko",tooltip:"Valitse arkkikoko. Näet vaikutuksen esikatselukartassa.",options:[{id:"A4",label:"A4-tuloste",classForPreview:"preview-portrait",selected:!0},{id:"A4_Landscape",label:"A4-vaakatuloste",classForPreview:"preview-landscape"},{id:"A3",label:"A3-tuloste",classForPreview:"preview-portrait"},{id:"A3_Landscape",label:"A3-vaakatuloste",classForPreview:"preview-landscape"}]},preview:{label:"Esikatselu",tooltip:"Suuremman esikatselukuvan saat kuvaa napauttamalla.",pending:"Esikatselukuva päivitetään hetken kuluttua",notes:{extent:"Esikatselun avulla voit hahmottaa tulosteen kattavuuden",restriction:"Esikatselussa ei näytetä kaikkia karttatasoja"}},buttons:{save:"Hae tuloste",ok:"OK",cancel:"Peruuta"},location:{label:"Sijainti ja mittakaavataso",tooltip:"Mittakaavataso vastaa toistaiseksi selaimen näkymän mittakaavaa.",zoomlevel:"Mittakaavataso"},settings:{label:"Lisäasetukset",tooltip:"Valitse tulosteen formaatti, otsikko, mittakaava, päivämäärä "},format:{label:"Tiedostomuoto",tooltip:"Valitse tulosteen tiedostomuoto",options:[{id:"png",format:"image/png",label:"PNG kuva"},{id:"pdf",format:"application/pdf",label:"PDF dokumentti",selected:!0}]},mapTitle:{label:"Kartan otsikko",tooltip:"Nimeä kartta"},content:{options:[{id:"pageLogo",label:"Näytä paikkatietoikkunan logo",tooltip:"Voit halutessasi piilottaa logon",checked:"checked"},{id:"pageScale",label:"Näytä mittakaava",tooltip:"Voit halutessasi lisätä karttaan mittakaavan",checked:"checked"},{id:"pageDate",label:"Näytä päivämäärä",tooltip:"Voit halutessasi lisätä tulosteeseen päivämäärän",checked:"checked"}]},legend:{label:"Legenda",tooltip:"Valitse legendan paikka - ei piirretä, jos paikkaa ei ole valittuna",options:[{id:"oskari_legend_NO",loca:"NO",label:"Ei legendaa ",tooltip:"Ei piirretä legendaa",selected:!0},{id:"oskari_legend_LL",loca:"LL",label:"Vasen alanurkka ",tooltip:"Sovitus vasempaan alanurkkaan"},{id:"oskari_legend_LU",loca:"LU",label:"Vasen ylänurkka ",tooltip:"Sovitus vasempaan ylänurkkaan"},{id:"oskari_legend_RU",loca:"RU",label:"Oikea ylänurkka ",tooltip:"Sovitus oikeaan ylänurkkaan"},{id:"oskari_legend_RL",loca:"RL",label:"Oikea alanurkka ",tooltip:"Sovitus oikeaan alanurkkaan"}]},help:"Ohje",error:{title:"Virhe",size:"Virhe kokomäärityksissä",name:"Nimi on pakollinen tieto",nohelp:"Ohjetta ei löytynyt",saveFailed:"Näkymän tulostus epäonnistui. Yritä myöhemmin uudelleen.",nameIllegalCharacters:"Nimessä on luvattomia merkkejä. Sallittuja merkkejä ovat kaikki suomen kielen aakkoset, numerot sekä välilyönti ja yhdysmerkki."}},StartView:{text:"Voit tulostaa tekemäsi karttanäkymän PNG kuvaksi tai PDF-tulosteeksi.",info:{maxLayers:"Tulostettavien karttatasojen lukumäärä on rajattu 8:aan.",printoutProcessingTime:"Kartan tulostus voi kestää hetken, jos useita karttatasoja on valittuna."},buttons:{"continue":"Jatka",cancel:"Peruuta"}}}}),define("bundles/framework/bundle/printout/locale/fi",function(){}),Oskari.registerLocalization({lang:"sv",key:"Printout",value:{title:"Skriv ut kartvyn",flyouttitle:"Skriv ut kartvyn",desc:"",btnTooltip:"Skriv ut",BasicView:{title:"Skriv ut kartvyn",name:{label:"Kartans namn",placeholder:"obligatorisk uppgift",tooltip:"Ge kartan ett beskrivande namn. Observera användargränssnittets språk"},language:{label:"Språk",options:{fi:"Finska",sv:"Svenska",en:"Engelska"},tooltip:"Välj språk för kartmaterial och användargränssnitt."},size:{label:"Storlek",tooltip:"Välj storleken på kartan. Kartan förhandsvisas i den valda storleken.",options:[{id:"A4",label:"A4",classForPreview:"preview-portrait",selected:!0},{id:"A4_Landscape",label:"A4-horisontell",classForPreview:"preview-landscape"},{id:"A3",label:"A3",classForPreview:"preview-portrait"},{id:"A3_Landscape",label:"A3-horisontell",classForPreview:"preview-landscape"}]},preview:{label:"Förhandsgransningsvy",tooltip:"Klicka på den lilla förhandsgransningsvyn för att öppna en större förhandsgransningsvy",pending:"Förhandsgransningsvyn uppdateras om en stund",notes:{extent:"Förhandsgransningsvy visar kartans läge",restriction:"Inte alla maplager visas i förhandsgransningsvyn"}},buttons:{save:"Ladda ned utskriften",ok:"OK",cancel:"Avbryt"},location:{label:"Läge och skalnivå.",tooltip:"Utskriftens skalnivå motsvarar skalnivån i webbläsaren.",zoomlevel:"Skalnivå"},settings:{label:"Övriga inställningar",tooltip:"Gör övriga inställningar såsom format, rubrik, och skala"},format:{label:"Format",tooltip:"Välj fil format",options:[{id:"png",format:"image/png",label:"PNG bild"},{id:"pdf",format:"application/pdf",label:"PDF dokument",selected:!0}]},mapTitle:{label:"Lägg till rubrik",tooltip:"Lägg till rubrik för kartan"},content:{options:[{id:"pageLogo",label:"Lägg till Paikkatietoikkunas logo",tooltip:"Det är möjligt att gömma logon ifall det behövs",checked:"checked"},{id:"pageScale",label:"Lägg till skala till kartan",tooltip:"Lägg till skala till kartan",checked:"checked"},{id:"pageDate",label:"Lägg till datum",tooltip:"Det är möjligt att lägga till datumet till utskriften",checked:"checked"}]},legend:{label:"Legend",tooltip:"Väljä legend position",options:[{id:"oskari_legend_NO",loca:"NO",label:"Ingen legend ",tooltip:"Ingen legend print",selected:!0},{id:"oskari_legend_LL",loca:"LL",label:"Vänster nere hörn ",tooltip:"Legend position i vänster nere hörn"},{id:"oskari_legend_LU",loca:"LU",label:"Vänster uppe hörn ",tooltip:"Legend position i vänster uppe hörn"},{id:"oskari_legend_RU",loca:"RU",label:"Höger uppe hörn ",tooltip:"Legend position i höger uppe hörn"},{id:"oskari_legend_RL",loca:"RL",label:"Höger nere hörn ",tooltip:"Legend position i höger nere hörn"}]},help:"Anvisning",error:{title:"Fel",size:"Fel i storleksdefinitionerna",name:"Namnet är en nödvändig uppgift",nohelp:"Ingen anvisning",saveFailed:"Avskiljandet av kartan misslyckades. Försök på nytt senare.",nameIllegalCharacters:"I namnet ingår otillåtna tecken. Tillåtna är alla bokstäver i det svenska alfabetet, siffror, mellanslag och bindestreck."}},StartView:{text:"Du kan skriva ut den kartvy som du definierat till PDF-utskrift eller PNG-bildfilen",info:{maxLayers:"Högst 8 kartlager kan skrivs ut",printoutProcessingTime:"Det tar en stund att skriva ut kartvyn med många kartlager."},buttons:{"continue":"Fortsätt",cancel:"Tillbaka"}}}}),define("bundles/framework/bundle/printout/locale/sv",function(){}),Oskari.registerLocalization({lang:"en",key:"Printout",value:{title:"Print Map view",flyouttitle:"Print Map view",desc:"",btnTooltip:"Print",BasicView:{title:"Print Map view",name:{label:"The name of the map",placeholder:"required",tooltip:"Give your map a descriptive name. Please note the language of the user interface."},language:{label:"Language",options:{fi:"Finnish",sv:"Swedish",en:"English"},tooltip:"Select the language of the map interface and map data."},size:{label:"Koko",tooltip:"Valitse arkkikoko. Näet vaikutuksen esikatselukartassa.",options:[{id:"A4",label:"A4 portrait",classForPreview:"preview-portrait",selected:!0},{id:"A4_Landscape",label:"A4 landscape",classForPreview:"preview-landscape"},{id:"A3",label:"A3 portrait",classForPreview:"preview-portrait"},{id:"A3_Landscape",label:"A3 landscape",classForPreview:"preview-landscape"}]},preview:{label:"Preview",tooltip:"Click the small preview to open a larger preview",pending:"Preview will be updated shortly",notes:{extent:"Preview can be used to figure out the map extent for printout",restriction:"Not all map layers are shown in the preview"}},buttons:{save:"Get Printout",ok:"OK",cancel:"Cancel"},location:{label:"Location and zoom level",tooltip:"Printout scale matches the scale of the map in browser.",zoomlevel:"Zoom level"},settings:{label:"More settings",tooltip:"Make additional settings like format, title, and scale"},format:{label:"Format",tooltip:"Select file format",options:[{id:"png",format:"image/png",label:"PNG image"},{id:"pdf",format:"application/pdf",selected:!0,label:"PDF document"}]},mapTitle:{label:"Add title",tooltip:"add a title for the map"},content:{options:[{id:"pageLogo",label:"Add the logo of Paikkatietoikkuna",tooltip:"You can hide the logo if necessary",checked:"checked"},{id:"pageScale",label:"Add scale to the map",tooltip:"Add scale to the map",checked:"checked"},{id:"pageDate",label:"Add date",tooltip:"You can add date to the printout",checked:"checked"}]},legend:{label:"Legend",tooltip:"Select legend position",options:[{id:"oskari_legend_NO",loca:"NO",label:"No legend ",tooltip:"No legend plot",selected:!0},{id:"oskari_legend_LL",loca:"LL",label:"Left lower corner ",tooltip:"Legend position in left lower corner of print area"},{id:"oskari_legend_LU",loca:"LU",label:"Left upper corner ",tooltip:"Legend position in left upper corner of print area"},{id:"oskari_legend_RU",loca:"RU",label:"Right upper corner ",tooltip:"Legend position in right upper corner of print area"},{id:"oskari_legend_RL",loca:"RL",label:"Right lower corner ",tooltip:"Legend position in right lower corner of print area"}]},help:"Help",error:{title:"Error",size:"Error in size definitions",name:"Name is required information",nohelp:"No help is available",saveFailed:"Map printout failed. Try again later.",nameIllegalCharacters:"The name contains disallowed characters. Allowed characters are the letters a-z as well as å, ä and ö, numbers, backspaces and hyphens."}},StartView:{text:"You can print the Map view you just created.",info:{maxLayers:"Max layer count for printout is 8",printoutProcessingTime:"Printout processing takes some time when multiple layers are selected."},buttons:{"continue":"Continue",cancel:"Cancel"}}}}),define("bundles/framework/bundle/printout/locale/en",function(){}),define("bundles/framework/bundle/printout/module",["oskari","jquery","./jquery.imagesLoaded","./instance","./Flyout","./Tile","./plugin/LegendPlugin","./service/PrintService","./view/StartView","./view/BasicPrintout","./request/PrintMapRequest","./request/PrintMapRequestHandler","./event/PrintableContentEvent","css!resources/framework/bundle/printout/css/style.css","./locale/fi","./locale/sv","./locale/en"],function(e,t){return e.bundleCls("printout").category({create:function(){var t=this,n=e.clazz.create("Oskari.mapframework.bundle.printout.PrintoutBundleInstance");return n},update:function(e,t,n,r){}})}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.setBuffer("div.notLoggedIn {\n  padding: 10px; }\n\n\n/*#contentMap.mapPrintoutMode {\r\n margin-left: 255px;\r\n }*/\n#contentMap div.basic_printout {\n  background: white;\n  position: absolute;\n  height: 100%;\n  top: 0;\n  left: 40px;\n  z-index: 1500;\n  width: 255px; }\n\n#contentMap div.basic_publisher div.content {\n  padding: 10px; }\n\ndiv.printout div.startview div.icon-info, div.basic_printout div.icon-info {\n  float: right; }\n\ndiv.printout div.startview div.error ul li {\n  color: red; }\n\ndiv.basic_printout > div.header {\n  background-color: #FDF8D9;\n  padding: 5px 10px; }\n\ndiv.basic_printout > div.header div.icon-close {\n  float: right; }\n\ndiv.basic_printout div.form div.field input, div.field select {\n  width: 80%;\n  background-color: white;\n  filter: Alpha(opacity=100) !important;\n  /* unquote for libsass bug */ }\n\ndiv.basic_printout > div.content {\n  overflow: auto;\n  height: 89%; }\n\ndiv.basic_printout div.tool {\n  margin: 5px; }\n\ndiv.basic_printout div.tool input, div.basic_printout div.printout_settings_cont input {\n  margin-right: 10px; }\n\n.printout_radiolabel, .printout_checklabel {\n  padding: 3px 6px;\n  -webkit-border-radius: 2px;\n  -moz-border-radius: 2px;\n  -o-border-radius: 2px;\n  -ms-border-radius: 2px;\n  border-radius: 2px; }\n\n.printout_radiolabel:hover, .printout_checklabel:hover {\n  background-color: #eee; }\n\n.printout_format_label, .printout_title_label, .printout_legend_label {\n  font-weight: bold;\n  margin: 5px 0; }\n\n.printout_settings_cont {\n  margin: 10px 5px; }\n\n/* Buttons */\ndiv.basic_printout div.buttons, div.printout div.startview div.buttons {\n  margin: 10px;\n  text-align: center; }\n\ndiv.basic_printout div.buttons input, div.printout div.startview div.buttons input {\n  margin-left: 10px;\n  margin-right: 10px; }\n\ndiv.basic_printout div.preview-portrait {\n  margin: 8px;\n  padding: 5px;\n  width: 200px;\n  height: 290px;\n  background-color: white;\n  border-bottom-color: #C0D0E0;\n  border-bottom-style: solid;\n  border-bottom-width: 1pt;\n  border-top-color: #C0D0E0;\n  border-top-style: solid;\n  border-top-width: 1pt;\n  box-shadow: 0 0 8px #D0D0D0;\n  cursor: pointer; }\n\ndiv.basic_printout div.preview-landscape {\n  margin: 8px;\n  padding: 5px;\n  width: 200px;\n  height: 140px;\n  background-color: white;\n  border-bottom-color: #C0D0E0;\n  border-bottom-style: solid;\n  border-bottom-width: 1pt;\n  border-top-color: #C0D0E0;\n  border-top-style: solid;\n  border-top-width: 1pt;\n  box-shadow: 0 0 8px #D0D0D0;\n  cursor: pointer; }\n\ndiv.basic_printout div.location {\n  height: 30px; }\n\ndiv.basic_printout div.previewNotes {\n  margin-left: 8px;\n  margin-right: 8px;\n  margin-bottom: 2px; }\n")}),requirejs.s.contexts._.nextTick=requirejs.nextTick;